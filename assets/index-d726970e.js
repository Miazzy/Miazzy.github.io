var m=(I,C,c)=>new Promise((t,l)=>{var r=i=>{try{d(c.next(i))}catch(p){l(p)}},w=i=>{try{d(c.throw(i))}catch(p){l(p)}},d=i=>i.done?t(i.value):Promise.resolve(i.value).then(r,w);d((c=c.apply(I,C)).next())});import{B as U}from"./BasicTable-0434a334.js";import{T as j}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as K}from"./useTable-109483b3.js";import{a2 as v}from"./antd-15ac76ed.js";import{au as W,b as G,a7 as Q,av as h,ax as Z,az as J,bQ as X,bR as ee,aA as te,_ as ae}from"./index.js";import{P as se}from"./index-20519caf.js";import"./index-74ac3212.js";import{_ as ne}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{g as E,a as oe,b as le}from"./askReport-bafaf7e2.js";import{d as re,r as M,k as x,ax as ie,o as ue,al as _,Z as P,a9 as B,aa as o,$ as D,f as s,E as y,u,ac as ce}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./useRender-21ce56fb.js";const me={class:"fix-basic-table"},de={class:"tab-button-div"},pe={class:"tab-table-div"},fe=re({__name:"index",setup(I){const{createConfirm:C}=W(),{t:c}=G(),t=M({name:null,startDate:null,endDate:null,status:null}),l=M({searchTime:null}),r=x([]),w=oe();ie(),x([{label:"草稿",value:"0"},{label:"处理中",value:"1"},{label:"通过",value:"2"},{label:"不通过",value:"3"},{label:"已取消",value:"4"},{label:"已终止",value:"5"},{label:"退回",value:"6"}]);const d=x([]),i=()=>m(this,null,function*(){let e=yield le(t);return d.value=e.result,e.result}),p={baseColProps:{lg:6,md:8},labelWidth:90,schemas:[]},[L,{reload:f,getPaginationRef:F}]=K({title:"请示报告列表",api:()=>m(this,null,function*(){const e=F();return t.pageNo=e.current,t.pageSize=e.pageSize,yield i()}),columns:w,useSearchForm:!1,formConfig:p,showTableSetting:!0,bordered:!0,rowKey:"id",rowSelection:{type:"radio",onChange:Y},sortFn:e=>{e.order?(t.sortField=e.field,t.sortOrder=e.order.replace("end","")):(t.sortField=null,t.sortOrder=null)}});function Y(e,a){a.length>0?r.value=[e[0]]:r.value=[]}function H(){Z("/oa/askreport/detail","添加请示报告",{id:""})}function R(e){e.status==0||e.status==1,J(e.id)}const O=e=>m(this,null,function*(){const a=yield E({id:e.id}),{value:T}=yield X.prompt("请输入取消原因","取消流程",{confirmButtonText:c("common.okText"),cancelButtonText:c("common.cancelText"),inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"取消原因不能为空"});yield ee(a.result.processInstanceId,T),v.success("已取消"),f()});function N(){return m(this,null,function*(){if(!$())return;const e=yield E({id:r.value[0]});C({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return m(this,null,function*(){if(e.result.status!=0){v.error("非草稿状态不能删除。");return}yield te(e.result.processInstanceId),v.success("已删除。"),r.value=[],f()})}})})}function V(){t.name=null,t.startDate=null,t.endDate=null,t.status=null,l.searchTime=null,f()}function z(){l.searchTime!=null&&(t.startDate=l.searchTime[0],t.endDate=l.searchTime[1]),f()}function $(){return r.value.length==0||r.value.length>1||!r.value[0]?(v.error("请选择一行数据"),!1):!0}return ue(()=>{Q.getInstance().listen("askreport",function(){setTimeout(()=>{f()},500)})}),(e,a)=>{const T=_("a-input"),b=_("a-form-item"),q=_("a-range-picker"),g=_("a-button"),A=_("a-form");return P(),B(u(se),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:o(()=>[D("div",me,[D("div",de,[s(A,{model:t,name:"searchInfo",layout:"inline",autocomplete:"off",class:"search-form"},{default:o(()=>[s(b,{name:"name",label:"主题",labelCol:{span:12},rules:[{required:!1,message:"请输入主题"}],style:{width:"26.5%"},colon:!1},{default:o(()=>[s(T,{value:t.name,"onUpdate:value":a[0]||(a[0]=n=>t.name=n),placeholder:"请输入主题",style:{width:"100%"}},null,8,["value"])]),_:1}),s(b,{name:"startDate",label:"呈报时间",labelCol:{span:6},rules:[{required:!1,message:"请选择呈报时间"}],style:{width:"26.5%"},colon:!1},{default:o(()=>[s(q,{value:l.searchTime,"onUpdate:value":a[1]||(a[1]=n=>l.searchTime=n),format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:00",style:{width:"100%"},"show-time":""},null,8,["value"])]),_:1}),s(b,{name:"status",label:"审批状态",labelCol:{span:12},rules:[{required:!1,message:"请选择审批状态"}],style:{width:"26.5%"},colon:!1},{default:o(()=>[s(ne,{type:"bpm_process_instance_result",onChange:a[2]||(a[2]=n=>"()=> searchInfo.status = value"),value:t.status,"onUpdate:value":a[3]||(a[3]=n=>t.status=n),width:"100%"},null,8,["value"])]),_:1}),s(b,{class:"search-btns"},{default:o(()=>[s(g,{style:{margin:"0 8px"},onClick:V},{default:o(()=>[y("重置")]),_:1}),s(g,{type:"primary",class:"tab-button",onClick:z},{default:o(()=>[y("查询")]),_:1})]),_:1})]),_:1},8,["model"])]),D("div",pe,[s(u(U),{onRegister:u(L),onResizeColumn:a[4]||(a[4]=(n,S)=>S.width=n),onRowDbClick:a[5]||(a[5]=n=>R(n))},{toolbar:o(()=>[s(g,{type:"primary",preIcon:u(h).ADD,onClick:H},{default:o(()=>[y("添加")]),_:1},8,["preIcon"]),s(g,{class:"red-btn",preIcon:u(h).DELETE,onClick:N},{default:o(()=>[y("删除")]),_:1},8,["preIcon"])]),bodyCell:o(({column:n,text:S,record:k})=>[n.key==="action"?(P(),B(u(j),{key:0,actions:[{icon:u(h).LOG,label:"进度",onClick:R.bind(null,k)},{icon:u(h).DELETE,danger:!0,label:"取消",ifShow:()=>k.status==0,onClick:O.bind(null,k)}]},null,8,["actions"])):ce("",!0)]),_:1},8,["onRegister"])])])]),_:1})}}});const qe=ae(fe,[["__scopeId","data-v-c7da88ff"]]);export{qe as default};
//# sourceMappingURL=index-d726970e.js.map
