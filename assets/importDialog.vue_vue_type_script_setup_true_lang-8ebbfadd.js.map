{"version":3,"file":"importDialog.vue_vue_type_script_setup_true_lang-8ebbfadd.js","sources":["../../src/views/bpm/manage/workflow/importDialog.vue"],"sourcesContent":["<template>\n  <Dialog\n    :visible=\"dialogVisible\"\n    @update:visible=\"updateVisible\"\n    title=\"导入流程\"\n    :width=\"600\"\n    :height=\"500\"\n    :overflowY=\"'scroll'\"\n    @confirm=\"confirm\"\n    @cancel=\"cancel\"\n  >\n    <div style=\"padding-top: 20px\">\n      <el-upload\n        ref=\"uploadRef\"\n        v-model:file-list=\"fileList\"\n        :action=\"importUrl\"\n        :auto-upload=\"false\"\n        :data=\"formData\"\n        :disabled=\"formLoading\"\n        :headers=\"uploadHeaders\"\n        :limit=\"1\"\n        :on-error=\"submitFormError\"\n        :on-exceed=\"handleExceed\"\n        :on-success=\"submitFormSuccess\"\n        accept=\".bpmn, .xml\"\n        drag\n        name=\"bpmnFile\"\n      >\n        <Icon class=\"el-icon--upload\" icon=\"ep:upload-filled\" />\n        <div class=\"el-upload__text\"> 将文件拖到此处，或 <em>点击上传</em></div>\n        <template #tip>\n          <div class=\"el-upload__tip\" style=\"color: red\">\n            提示：仅允许导入“bpm”或“xml”格式文件！\n          </div>\n          <div>\n            <el-form ref=\"formRef\" :model=\"formData\" :rules=\"formRules\" label-width=\"120px\">\n              <el-form-item label=\"流程标识\" prop=\"key\">\n                <el-input\n                  v-model=\"formData.key\"\n                  placeholder=\"请输入流标标识\"\n                  style=\"width: 250px\"\n                />\n              </el-form-item>\n              <el-form-item label=\"流程名称\" prop=\"name\">\n                <el-input v-model=\"formData.name\" clearable placeholder=\"请输入流程名称\" />\n              </el-form-item>\n              <el-form-item label=\"流程描述\" prop=\"description\">\n                <el-input v-model=\"formData.description\" clearable type=\"textarea\" />\n              </el-form-item>\n            </el-form>\n          </div>\n        </template>\n      </el-upload>\n    </div>\n  </Dialog>\n</template>\n<script lang=\"ts\" setup>\n  import { ref, reactive, watch, onMounted } from 'vue';\n  import { useMessage } from '/@/hooks/web/useMessage';\n  import Dialog from '@/components/Framework/Modal/Dialog.vue';\n  import Icon from '@/components/Icon/Icon.vue';\n  import { useUserStore } from '/@/store/modules/user';\n\n  defineOptions({ name: 'ImportDialog' });\n\n  const message = useMessage(); // 消息弹窗\n  const userStore = useUserStore();\n\n  const props = defineProps({\n    visible: Boolean, // 是否显示弹框\n    category: String, // 流程分类\n  });\n\n  const dialogVisible = ref(false); // 弹窗的是否展示\n  const formLoading = ref(false); // 表单的加载中\n  const formData = ref({\n    key: '',\n    name: '',\n    description: '',\n    category: '',\n  });\n  const formRules = reactive({\n    key: [{ required: true, message: '流程标识不能为空', trigger: 'blur' }],\n    name: [{ required: true, message: '流程名称不能为空', trigger: 'blur' }],\n  });\n  const formRef = ref(); // 表单 Ref\n  const uploadRef = ref(); // 上传 Ref\n  const importUrl = '/admin-api/bpm/model/import'; // TODO 请调整导入路径\n  const uploadHeaders = ref(); // 上传 Header 头\n  const fileList = ref([]); // 文件列表\n\n  /** 打开弹窗 */\n  const open = async () => {\n    resetForm();\n  };\n  defineExpose({ open }); // 提供 open 方法，用于打开弹窗\n\n  /** 提交表单 */\n  const confirm = async () => {\n    // 校验表单\n    if (!formRef.value) return;\n    const valid = await formRef.value.validate();\n    if (!valid) return;\n    if (fileList.value.length == 0) {\n      message.error('请上传文件');\n      return;\n    }\n    // 提交请求\n    uploadHeaders.value = {\n      Authorization: 'Bearer ' + userStore.getToken,\n    };\n    formLoading.value = true;\n    formData.value.category = props.category;\n    uploadRef.value!.submit();\n  };\n\n  /** 文件上传成功 */\n  const emit = defineEmits(['update:visible', 'success']); // 定义 success 事件，用于操作成功后的回调\n  const submitFormSuccess = async (response: any) => {\n    if (response.code !== 0) {\n      message.error(response.msg);\n      formLoading.value = false;\n      return;\n    }\n    // 提示成功\n    message.success('导入流程成功！请点击【设计流程】按钮，进行编辑保存后，才可以进行【发布流程】');\n    // 发送操作成功的事件\n    emit('success');\n  };\n\n  /** 上传错误提示 */\n  const submitFormError = (): void => {\n    message.error('导入流程失败，请您重新上传！');\n    formLoading.value = false;\n  };\n\n  /** 重置表单 */\n  const resetForm = () => {\n    // 重置上传状态和文件\n    formLoading.value = false;\n    uploadRef.value?.clearFiles();\n    // 重置表单\n    formData.value = {\n      key: '',\n      name: '',\n      description: '',\n    };\n    formRef.value?.resetFields();\n  };\n\n  /** 文件数超出提示 */\n  const handleExceed = (): void => {\n    message.error('最多只能上传一个文件！');\n  };\n\n  const updateVisible = ($event) => {\n    dialogVisible.value = $event;\n    emit('update:visible', false); // 关闭弹框\n  };\n\n  const cancel = () => {\n    dialogVisible.value = false;\n    emit('update:visible', false); // 关闭弹框\n  };\n\n  watch(\n    () => props.visible,\n    (newValue) => {\n      dialogVisible.value = newValue;\n    },\n  );\n\n  // watch(\n  //   () => props.category,\n  //   (newValue) => {\n  //     formData.value.category = newValue;\n  //   },\n  // );\n\n  onMounted(() => {\n    dialogVisible.value = props.visible; // 根据传入参数控制Dialog显示\n  });\n</script>\n"],"names":["importUrl","message","useMessage","userStore","useUserStore","dialogVisible","ref","formLoading","formData","formRules","reactive","formRef","uploadRef","uploadHeaders","fileList","__expose","__async","resetForm","confirm","props","submitFormSuccess","response","emit","submitFormError","_a","_b","handleExceed","updateVisible","$event","cancel","watch","newValue","onMounted"],"mappings":"ymBAuFQA,EAAY,8LAtBZC,EAAUC,IACVC,EAAYC,IAOZC,EAAgBC,EAAI,EAAK,EACzBC,EAAcD,EAAI,EAAK,EACvBE,EAAWF,EAAI,CACnB,IAAK,GACL,KAAM,GACN,YAAa,GACb,SAAU,EAAA,CACX,EACKG,EAAYC,EAAS,CACzB,IAAK,CAAC,CAAE,SAAU,GAAM,QAAS,WAAY,QAAS,OAAQ,EAC9D,KAAM,CAAC,CAAE,SAAU,GAAM,QAAS,WAAY,QAAS,OAAQ,CAAA,CAChE,EACKC,EAAUL,IACVM,EAAYN,IAEZO,EAAgBP,IAChBQ,EAAWR,EAAI,CAAA,CAAE,EAMVS,EAAA,CAAE,KAHF,IAAYC,EAAA,sBACbC,GAAA,GAES,EAGrB,MAAMC,EAAU,IAAYF,EAAA,sBAI1B,GAFI,GAACL,EAAQ,OAET,EADU,MAAMA,EAAQ,MAAM,SAAS,IAEvC,IAAAG,EAAS,MAAM,QAAU,EAAG,CAC9Bb,EAAQ,MAAM,OAAO,EACrB,MACF,CAEAY,EAAc,MAAQ,CACpB,cAAe,UAAYV,EAAU,QAAA,EAEvCI,EAAY,MAAQ,GACXC,EAAA,MAAM,SAAWW,EAAM,SAChCP,EAAU,MAAO,SAAO,GAKpBQ,EAA2BC,GAAkBL,EAAA,sBAC7C,GAAAK,EAAS,OAAS,EAAG,CACfpB,EAAA,MAAMoB,EAAS,GAAG,EAC1Bd,EAAY,MAAQ,GACpB,MACF,CAEAN,EAAQ,QAAQ,wCAAwC,EAExDqB,EAAK,SAAS,CAAA,GAIVC,EAAkB,IAAY,CAClCtB,EAAQ,MAAM,gBAAgB,EAC9BM,EAAY,MAAQ,EAAA,EAIhBU,EAAY,IAAM,SAEtBV,EAAY,MAAQ,IACpBiB,EAAAZ,EAAU,QAAV,MAAAY,EAAiB,aAEjBhB,EAAS,MAAQ,CACf,IAAK,GACL,KAAM,GACN,YAAa,EAAA,GAEfiB,EAAAd,EAAQ,QAAR,MAAAc,EAAe,aAAY,EAIvBC,EAAe,IAAY,CAC/BzB,EAAQ,MAAM,aAAa,CAAA,EAGvB0B,EAAiBC,GAAW,CAChCvB,EAAc,MAAQuB,EACtBN,EAAK,iBAAkB,EAAK,CAAA,EAGxBO,EAAS,IAAM,CACnBxB,EAAc,MAAQ,GACtBiB,EAAK,iBAAkB,EAAK,CAAA,EAG9B,OAAAQ,EACE,IAAMX,EAAM,QACXY,GAAa,CACZ1B,EAAc,MAAQ0B,CACxB,CAAA,EAUFC,EAAU,IAAM,CACd3B,EAAc,MAAQc,EAAM,OAAA,CAC7B"}