{"version":3,"file":"index-5f660976.js","sources":["../../src/views/oa/info/officedoc/index.ts","../../src/views/oa/info/officedoc/index.vue"],"sourcesContent":["import { BasicColumn, FormSchema, useRender } from '@/components/Table';\nimport { defHttp } from '@/utils/http/axios';\n\nenum Api {\n  getPage = '/oa/official-doc-release/page',\n  getData = '/oa/official-doc-release/get',\n  updateStatus = '/oa/official-doc-release/update',\n  // exportData = '/oa/official-doc-release/export-excel',\n}\n// 查询列表\nexport function getPage(params) {\n  return defHttp.get({ url: Api.getPage, params });\n}\nexport function updateStatus(params) {\n  return defHttp.put({ url: Api.updateStatus, params });\n}\n//查询详情\nexport function getData(params) {\n  return defHttp.get({ url: Api.getData, params });\n}\n// 导出\n// export function exportData(params) {\n//   return defHttp.download({ url: Api.exportData, params }, { isReturnNativeResponse: true });\n// }\nconst statusColor = {\n  0: '#dc0000', // 草稿\n  1: '#338ed1', // 处理中\n  2: '#30ca5a', // 通过\n  3: '#929292', // 不通过\n  4: '#929292', // 已取消\n  5: '#929292', // 已终止\n  6: '#fda941', // 退回/驳回\n};\nexport const columns: BasicColumn[] = [\n  { title: '发文主题', dataIndex: 'subject',align: 'left',headAlign:'center', width: '15%',sorter: true,resizable: true },\n  { title: '信息类型', dataIndex: 'infoKindName', width: '10%',sorter: true,resizable: true },\n  { title: '发文分类', dataIndex: 'dispatchKindName', width: '10%',sorter: true,resizable: true },\n  { title: '所在部门', dataIndex: 'responsibleDeptName',align: 'left',headAlign:'center', width: '10%',sorter: true,resizable: true },\n  { title: '发布时间', dataIndex: 'effectiveTime', width: '10%',sorter: true,resizable: true },\n  { title: '发文年份', dataIndex: 'dispatchYear',align: 'right',headAlign:'center', width: '10%',sorter: true,resizable: true },\n  { title: '发文编号', dataIndex: 'dispatchSequence',align: 'right',headAlign:'center', width: '10%',sorter: true,resizable: true },\n  {\n    title: '流程状态',\n    dataIndex: 'statusText',\n    width: '10%',sorter: true,resizable: true,\n    customRender: ({ text, record }) => {\n      return useRender.renderTag(text, statusColor[record.status]);\n    },\n  },\n  { title: '状态', dataIndex: 'bizStatusText', width: '10%',sorter: true,resizable: true },\n];\nexport const searchFormSchema: FormSchema[] = [\n  { label: '发文主题', field: 'subject', component: 'Input', colProps: { span: 8 } },\n  {\n    label: '发文分类',\n    field: 'dispatchKind',\n    component: 'DictSelectBox',\n    componentProps: {\n      type: 'dispatch_kind',\n    },\n    colProps: { span: 8 },\n  },\n  {\n    field: '[startEffectiveTime, endEffectiveTime]',\n    label: '发布时间',\n    component: 'RangePicker',\n    colProps: { span: 8 },\n    componentProps: {\n      format: 'YYYY-MM-DD',\n      valueFormat: 'YYYY-MM-DD',\n      placeholder: ['开始日期', '结束日期'],\n    },\n  },\n  { \n    label: '状态', \n    field: 'bizStatus', \n    component: 'DictSelectBox', \n    colProps: { span: 8 },  \n    componentProps: {\n      type: 'enable_or_disable',\n    }, \n  }\n];\n","<template>\n  <PageWrapper dense contentFullHeight fixedHeight  contentClass=\"flex\" style=\"position: relative\">\n    <BasicTable @register=\"registerTable\"  \n    @resize-column=\"(w, col) => (col.width = w)\"\n    @selection-change=\"handleSelectChange\"\n    @row-dbClick=\"dbClick\">\n      <template #toolbar>\n        <a-button type=\"primary\" :preIcon=\"IconEnum.ADD\" @click=\"handleCreate\">\n          {{ '添加' }}\n        </a-button>\n        <a-button class=\"red-btn\" :disabled=\"selectedRowId == ''\" :preIcon=\"IconEnum.DELETE\" @click=\"handleCancel\">\n          {{ '删除' }}\n        </a-button>\n        <a-button type=\"warning\" :disabled=\"selectedRowId == ''\" :preIcon=\"IconEnum.ENABLE\" @click=\"handleEnable\">\n          {{ '启用' }}\n        </a-button>\n        <a-button type=\"warning\" :disabled=\"selectedRowId == ''\" :preIcon=\"IconEnum.DISABLE\" @click=\"handleDisable\">\n          {{ '禁用' }}\n        </a-button>\n      </template>\n    </BasicTable>\n  </PageWrapper>\n</template>\n\n<script lang=\"ts\" setup>\n\timport * as CommonUtil from '/@/utils/common';\n  import { PageWrapper } from '/@/components/Page';\n  // import { useI18n } from '@/hooks/web/useI18n';\n  import { IconEnum } from '@/enums/appEnum';\n  import { BasicTable, useTable,SorterResult } from '@/components/Table';\n  import { ref, onMounted } from 'vue';\n  // import { ElMessageBox } from 'element-plus';\n  import { deleteProcessInstance } from '@/api/bpm/processInstance';\n  import { addTabPage } from '@/utils/route';\n  import { SysMessage,useMessage } from '/@/hooks/web/useMessage';\n  import { MsgManager } from '/@/message/MsgManager';\n  import { columns, searchFormSchema, getPage, updateStatus } from './index';\n  \n  const { createConfirm } = useMessage();\n  let selectedRowId = ref('');\n  const queryParam:any = ref({\n    status: '',\n    subject: '',\n    dispatchKind: '',\n    startEffectiveTime: '',\n    endEffectiveTime: '',\n    pageNo: 1,\n    pageSize: 10,\n    sortField: 'fillinDate',\n    sortOrder: 'desc'\n  });\n\n  const handleDisable = () => {\n    let keys = getSelectRowKeys();\n    if (keys.length != 1) {\n      SysMessage.getInstance().info('请选择一行记录操作');\n      return;\n    }\n    let rows = getSelectRows();\n    if (rows[0].status != 2) {\n      SysMessage.getInstance().info('已完成得数据才能操作');\n      return;\n    }\n    updateStatus({ id: keys[0], bizStatus: 0 }).then((rsp) => {\n      if (rsp.code == 0) {\n        SysMessage.getInstance().info('禁用成功.');\n        reload();\n      } else {\n        SysMessage.getInstance().error('禁用成功.原因:' + rsp.message);\n      }\n    });\n  };\n  const handleEnable = () => {\n    let keys = getSelectRowKeys();\n    if (keys.length != 1) {\n      SysMessage.getInstance().info('请选择一行记录操作');\n      return;\n    }\n    let rows = getSelectRows();\n    if (rows[0].status != 2) {\n      SysMessage.getInstance().info('已完成得数据才能操作');\n      return;\n    }\n    updateStatus({ id: keys[0], bizStatus: 1 }).then((rsp) => {\n      if (rsp.code == 0) {\n        SysMessage.getInstance().info('启用成功.');\n        reload();\n      } else {\n        SysMessage.getInstance().error('启用成功.原因:' + rsp.message);\n      }\n    });\n  };\n  const [registerTable, { reload, getPaginationRef, getSelectRowKeys, getSelectRows }] = useTable({\n    title: '公文发布',\n    api: async () => {\n      const paginationRef = getPaginationRef() as any;\n      queryParam.value.pageNo = paginationRef.current;\n      queryParam.value.pageSize = paginationRef.pageSize;\n      let dataObj = await getPage(queryParam.value);\n      return dataObj.result;\n    },\n    columns,\n    rowKey: 'id',\n    bordered: true,\n    showTableSetting: true,\n    formConfig: { \n      schemas: searchFormSchema,\n      labelWidth: 120, \n      showAdvancedButton:true,\n      autoAdvancedLine:1, \n    },\n    sortFn: (sortInfo: SorterResult) => {\n      if (sortInfo.order) {\n        queryParam.value.sortField = sortInfo.field.replace('Text', '');\n        queryParam.value.sortOrder = sortInfo.order.replace('end', '');\n      } else {\n          queryParam.value.sortField = 'fillinDate';\n          queryParam.value.sortOrder = 'desc';\n        }\n    },\n    useSearchForm: true,\n    rowSelection: {\n      type: 'radio',\n      fixed: true,\n      onSelect: onSelect\n    },\n    handleSearchInfoFn(info) {\n      for (const key in info) {\n        queryParam.value[key] = info[key];\n      }\n    }\n  });\n  function onSelect(record, selected) {\n    if (selected) {\n      selectedRowId.value = record.id;\n    } else {\n      selectedRowId.value = '';\n    }\n  }\n  function handleSelectChange({ keys, rows }) {\n    if (rows && rows.length > 0) {\n      const record = rows[0];\n      selectedRowId.value = record.id;\n    } else {\n      selectedRowId.value = '';\n    }\n  }\n  function handleCreate() {\n    addTabPage(`/oa/info/officedoc/create?id=`, '添加公文发布');\n  }\n  const dbClick=(record, index, event)=>{\n    \n    handleEdit(record);\n  }\n  function handleEdit(record) {\n    // let str='';\n    // if(record.status==0){\n    //   str='修改'\n    // } else if (record.status==1){\n    //   str='审批'\n    // } else {\n    //   str='查看'\n    // }\n   \n    // addTabPage(\n    //   `/oa/info/officedoc/create?id=${record.id}&processInstanceId=${record.processInstanceId}`,\n    //   (str+'公文发布')\n    // );\n    CommonUtil.toFlowPage(record.id);\n  }\n\n  const handleCancel = async () => {\n    let rows = getSelectRows();\n    if(rows.length != 1){\n      SysMessage.getInstance().success('请选择一行数据');\n      return;\n    }\n    let record = rows[0];\n\n    createConfirm({\n      title: '提示',\n      iconType: 'warning',\n      content: '确定要删除选中的记录？',\n      async onOk() {\n        if(record.status !=0){\n          SysMessage.getInstance().success('非草稿状态不能删除');\n          return;\n        }\n        await deleteProcessInstance(record.processInstanceId);\n        SysMessage.getInstance().success('删除成功');\n        reload();\n      },\n    });\n   \n  };\n  onMounted(() => {\n    MsgManager.getInstance().listen('office-doc',  ()=>{\n      reload()\n    });\n  });\n</script>\n"],"names":["getPage","params","defHttp","updateStatus","statusColor","columns","text","record","useRender","searchFormSchema","createConfirm","useMessage","selectedRowId","ref","queryParam","handleDisable","keys","getSelectRowKeys","SysMessage","getSelectRows","rsp","reload","handleEnable","registerTable","getPaginationRef","useTable","__async","paginationRef","sortInfo","onSelect","info","key","selected","handleSelectChange","rows","handleCreate","addTabPage","dbClick","index","event","handleEdit","CommonUtil.toFlowPage","handleCancel","deleteProcessInstance","onMounted","MsgManager"],"mappings":"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"}