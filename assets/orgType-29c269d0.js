var K=(L,k,m)=>new Promise((l,u)=>{var v=t=>{try{g(m.next(t))}catch(h){u(h)}},y=t=>{try{g(m.throw(t))}catch(h){u(h)}},g=t=>t.done?l(t.value):Promise.resolve(t.value).then(v,y);g((m=m.apply(L,k)).next())});import{d as fe,r as M,k as c,o as me,al as I,Z as T,a9 as A,aa as o,f as a,$ as ve,u as f,E as S,ad as N,ac as C,_ as U,F as ge,v as O,A as B}from"./vue-71d1abb3.js";import{B as _e}from"./BasicTable-0434a334.js";import{m as Ie}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as ye}from"./useTable-109483b3.js";import{a2 as d}from"./antd-15ac76ed.js";import{au as he,b as be,aj as Ke,av as P,_ as Te}from"./index.js";import{P as Se}from"./index-20519caf.js";import H from"./SysCommonTree-90bc100f.js";import{s as $,d as we,u as xe,c as Ce,a as ke,g as Fe}from"./data-1198e351.js";import{D as W}from"./Dialog-0a006d82.js";import{a as De}from"./assign-37f1c13d.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./CommonTree-c4ed7838.js";import"./index-3801a970.js";import"./index-66d20ba6.js";const Re={class:"right-table-layout"},Ee={key:0,style:{color:"#19be6b"}},Me={key:1,style:{color:"red"}},Ne=fe({__name:"orgType",setup(L){const{createConfirm:k}=he(),{t:m}=be(),l=M({}),u=M({}),v=c(!1),y=M({}),g=c(!1),t=c({}),h=c();let{params:n}=Ke();const r=c({}),w=c(""),_=c("");me(()=>{n.orgKindId=="ogn"&&(l.orgKindId="ogn",r.value.title="机构类型",_.value="sys_ogn",w.value="机构类型列表"),n.orgKindId=="dpt"&&(l.orgKindId="dpt",r.value.title="部门类型",_.value="sys_dept",w.value="部门类型列表"),n.orgKindId=="pos"&&(l.orgKindId="pos",r.value.title="岗位类型",_.value="sys_pos",w.value="岗位类型列表")});const F=c([]),Z=()=>K(this,null,function*(){let e=yield Fe(l);return F.value=e,e});function G(e){return F.value.total>0&&d.warn("该节点存在系统参数,不能删除。"),F.value.total==0}const[J,{reload:b,getPaginationRef:Q,getSelectRows:X,getDataSource:Y,clearSelectedRowKeys:ee}]=ye({title:w,api:()=>K(this,null,function*(){const e=Q();return l.pageNo=e.current,l.pageSize=e.pageSize,yield Z()}),columns:Ce,useSearchForm:!0,formConfig:ke,showTableSetting:!1,bordered:!0,rowKey:"id",pagination:{defaultPageSize:1,pageSize:20},rowSelection:{type:"radio"},handleSearchInfoFn(e){return n.orgKindId=="ogn"&&(l.orgKindId="ogn"),n.orgKindId=="dpt"&&(l.orgKindId="dpt"),n.orgKindId=="pos"&&(l.orgKindId="pos"),De(l,e),e}});function te(e){l.typeFullId=null,e&&(l.typeFullId=e.fullId,l.folderId=e.id,l.folderName=e.name,u.folderId=e.id,u.nodeType=e.parentId,u.existChildNode=e.children.length>0),e.parentId=="root"&&(l.folderId=""),b()}function ae(e){l.typeFullId=null,e&&(y.folderId=e.id,y.nodeType=e.parentId),b()}function oe(){return K(this,null,function*(){if(!u.folderId){d.error("请选择树节点类型。");return}if(u.nodeType=="root"){d.error("根节点不能添加业务数据。");return}t.value={},n.orgKindId=="ogn"&&(t.value.orgKindId="ogn",r.value.title="添加机构类型"),n.orgKindId=="dpt"&&(t.value.orgKindId="dpt",r.value.title="添加部门类型"),n.orgKindId=="pos"&&(t.value.orgKindId="pos",r.value.title="添加岗位类型"),t.value.folderId=u.folderId,t.value.status="1",v.value=!0})}function le(){v.value=!1}function re(){x().id&&(n.orgKindId=="ogn"&&(_.value="sys_ogn",r.value.title="移动机构类型"),n.orgKindId=="dpt"&&(_.value="sys_dept",r.value.title="移动部门类型"),n.orgKindId=="pos"&&(_.value="sys_pos",r.value.title="移动岗位类型"),g.value=!0)}function ne(){h.value.validateFields().then(()=>{$(t.value).then(()=>{v.value=!1,d.success("操作成功。"),b()})})}function se(){const e=x();if(y.nodeType=="root"){d.error("根节点不能添加业务数据。");return}t.value=e,t.value.folderId=y.folderId,$(t.value).then(()=>{g.value=!1,d.success("操作成功。"),b()})}function x(){const e=X();return e.length==0?(d.error("请选择一行数据。"),!1):e[0]}function ie(){const e=x();e.id&&(n.orgKindId=="ogn"&&(t.value.orgKindId="ogn",r.value.title="修改机构类型"),n.orgKindId=="dpt"&&(t.value.orgKindId="dpt",r.value.title="修改部门类型"),n.orgKindId=="pos"&&(t.value.orgKindId="pos",r.value.title="修改岗位类型"),t.value=e,t.value.status=String(e.status),v.value=!0)}function de(){return K(this,null,function*(){const e=x();e.id&&k({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return K(this,null,function*(){we(e.id).then(()=>{d.success("已删除"),ee(),b()})})}})})}function ue(){const e=Y(),s=c([]);e.forEach(p=>{if(!p.sort)throw d.error("排序不能为空。"),Error("排序不能为空。");s.value.push({id:p.id,sort:p.sort})}),xe(s.value).then(()=>{d.success("保存排序成功。"),b()})}return(e,s)=>{const p=I("a-button"),pe=I("a-input-number"),z=I("a-input"),D=I("a-form-item"),R=I("a-col"),E=I("a-row"),V=I("a-form");return T(),A(f(Se),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:o(()=>[a(H,{treeClass:"left-tree-layout",toolbar:!0,search:!0,title:r.value.title,treeType:_.value,onSelect:te,beforeDelete:G},null,8,["title","treeType"]),ve("div",Re,[a(f(_e),{onRegister:f(J),class:"fix-basic-table",searchInfo:l},{toolbar:o(()=>[a(p,{type:"primary",preIcon:f(P).ADD,onClick:oe},{default:o(()=>[S(N(f(m)("common.action.create")),1)]),_:1},8,["preIcon"]),a(p,{type:"primary",preIcon:f(P).EDIT,onClick:ie},{default:o(()=>[S(N(f(m)("common.action.edit")),1)]),_:1},8,["preIcon"]),a(p,{class:"red-btn",preIcon:f(P).DELETE,onClick:de},{default:o(()=>[S(N(f(m)("common.delText")),1)]),_:1},8,["preIcon"]),a(p,{type:"primary",onClick:ue},{default:o(()=>[S("保存排序号")]),_:1}),a(p,{type:"primary",onClick:re},{default:o(()=>[S("移动")]),_:1})]),bodyCell:o(({column:i,record:j,text:q})=>[i.dataIndex==="sort"?(T(),A(pe,{key:0,value:j[i.dataIndex],"onUpdate:value":ce=>j[i.dataIndex]=ce,min:1,max:999,step:1,precision:0,status:"error"},null,8,["value","onUpdate:value"])):C("",!0),i.dataIndex==="status"?(T(),U(ge,{key:1},[q==1?(T(),U("span",Ee,"启用")):C("",!0),q==0?(T(),U("span",Me,"禁用")):C("",!0)],64)):C("",!0)]),_:1},8,["onRegister","searchInfo"])]),a(W,{visible:v.value,"onUpdate:visible":s[3]||(s[3]=i=>v.value=i),title:r.value.title,maskClosable:!1,height:350,width:600,smode:"normal",onOk:ne,onCancel:le},{default:o(()=>[a(V,{ref_key:"fromRef",ref:h,model:t.value,name:"userForm"},{default:o(()=>[a(E,{gutter:24},{default:o(()=>[O(a(R,{span:23},{default:o(()=>[a(D,{label:"编码",name:"code",labelCol:{span:6},rules:[{required:!0,max:30}]},{default:o(()=>[a(z,{value:t.value.code,"onUpdate:value":s[0]||(s[0]=i=>t.value.code=i),maxlength:64},null,8,["value"])]),_:1})]),_:1},512),[[B,!0]])]),_:1}),a(E,null,{default:o(()=>[O(a(R,{span:23},{default:o(()=>[a(D,{label:"名称",name:"name",labelCol:{span:6},rules:[{required:!0,max:30}]},{default:o(()=>[a(z,{value:t.value.name,"onUpdate:value":s[1]||(s[1]=i=>t.value.name=i),maxlength:64},null,8,["value"])]),_:1})]),_:1},512),[[B,!0]])]),_:1}),a(E,null,{default:o(()=>[O(a(R,{span:23},{default:o(()=>[a(D,{name:"status",label:"状态",labelCol:{span:6},rules:[{required:!0,message:"请选择状态"}]},{default:o(()=>[a(Ie,{value:t.value.status,"onUpdate:value":s[2]||(s[2]=i=>t.value.status=i),type:"enable_or_disable"},null,8,["value"])]),_:1})]),_:1},512),[[B,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),a(W,{visible:g.value,"onUpdate:visible":s[4]||(s[4]=i=>g.value=i),title:r.value.title,maskClosable:!1,onOk:se,toolbar:!1,search:!1,height:650,width:600,smode:"normal"},{default:o(()=>[a(V,{ref:"moveFromRef",model:t.value,name:"userForm"},{default:o(()=>[a(H,{title:r.value.title,treeClass:"w-6/6",treeType:_.value,onSelect:ae},null,8,["title","treeType"])]),_:1},8,["model"])]),_:1},8,["visible","title"])]),_:1})}}});const ct=Te(Ne,[["__scopeId","data-v-a3147220"]]);export{ct as default};
//# sourceMappingURL=orgType-29c269d0.js.map
