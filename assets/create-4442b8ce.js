var c=(D,h,p)=>new Promise((o,r)=>{var m=e=>{try{g(p.next(e))}catch(f){r(f)}},_=e=>{try{g(p.throw(e))}catch(f){r(f)}},g=e=>e.done?o(e.value):Promise.resolve(e.value).then(m,_);g((p=p.apply(D,h)).next())});import{d as O,al as i,Z as B,a9 as S,aa as l,E as K,ax as L,u as U,k as y,r as F,o as Q,$ as x,f as a,ac as Z,v,A as b,q as G}from"./vue-71d1abb3.js";import{B as X}from"./BillTitle-d17ab3e4.js";import{ak as ee,aB as te,at as ae,a7 as se,aC as le,bP as oe,_ as ne}from"./index.js";import{W as ie}from"./WfApproveBox-a3448232.js";import{b as P,d as re,e as ue}from"./daily-77449ffc.js";import{U as de}from"./UploadBox-636ecf02.js";import{p as ce}from"./print-a0e9f882.js";import{P as pe}from"./index-20519caf.js";import{a as q}from"./assign-37f1c13d.js";import"./antd-15ac76ed.js";import"./index.esm-c216ed00.js";import"./index-fda2d66c.js";import"./BasicTable-0434a334.js";import"./useForm-dea3ed18.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-f4fc48e6.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./Dialog-0a006d82.js";import"./OrganDialog-dd1023ce.js";import"./uniqBy-92d3bc7f.js";import"./index-085d06c7.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useTable-109483b3.js";import"./index-c0893416.js";import"./index-33af41d1.js";import"./tree-fc0e156a.js";import"./useRender-21ce56fb.js";import"./useContentViewHeight-7f845167.js";const me=O({__name:"PrintButton",props:{config:{type:Object,default:{}}},setup(D){const h=D,p={printable:"app",type:"html",maxWidth:1100,scanStyles:!1,css:"./css/printStyle.css"},o=()=>{let r={};Object.assign(r,p,h.config),ce(r)};return(r,m)=>{const _=i("a-button");return B(),S(_,{class:"print-btn",onClick:o},{default:l(()=>[K("打印")]),_:1})}}}),_e={class:"load"},fe={class:"process-box"},ve={class:"header-box"},be={class:"content"},ge={class:"left-panel"},Ie=O({__name:"create",setup(D){const h=L(),{currentRoute:p}=h;U(p);const o=ee.getInstance().getQuery(),r=y(null),m=y(!1),_=y(""),g=y(),e=F({status:0}),f=y([]),N=y([]),w=F({});w.subject="日常评价",w.infoItems=[];const k=()=>c(this,null,function*(){const t=yield re(e);if(t.length>0){N.value=t;let s=[];t.forEach(I=>{s.push({label:I.indexName,value:I.id})}),f.value=s,e.evaluationTemplateDtlId&&(yield z())}}),z=()=>c(this,null,function*(){let t=N.value.find(s=>s.id==e.evaluationTemplateDtlId);return e.evaluationTemplateId=t.evaluationTemplateId,e.assessTarget=t.assessTarget,e.scoreRuleDesc=t.scoreRuleDesc,e}),j=()=>{A(0)},V=()=>{A(1)},A=t=>{g.value.validateFields().then(()=>{e.status=t,ue(e).then(s=>{ae.getInstance().success("保存成功"),_.value=s.result,C()}).catch(()=>{}),t>=1&&setTimeout(function(){se.getInstance().sendMsg("daily-evaluation",{}),le()},200)})};function M(t){return c(this,null,function*(){let{billCode:s,fillinDate:I,personMemberName:u,deptName:d}=t;Object.assign(w,{billCode:s,fillinDate:I,personMemberName:u,deptName:d})})}function C(){return c(this,null,function*(){const t=yield P({id:_.value});m.value=t.status>0,M(t),yield q(e,t),e.processInstanceId||(e.processInstanceId=o.processInstanceId),G(()=>c(this,null,function*(){yield k()}))})}const W=()=>c(this,null,function*(){oe().then(t=>{e.bizFileId=t})});return Q(()=>c(this,null,function*(){if(q(e,o),o.id)_.value=o.id,yield C();else if(o.processInstanceId)r.value=o.processInstanceId,te(r.value).then(t=>c(this,null,function*(){_.value=t.businessKey,C()})).catch(t=>{console.error(t),alert("getProcessInstance请求失败。error:"+t)});else if(o.stationId){const t=yield P({id:""});M(t),e.billCode=t.billCode,e.fillinDate=t.fillinDate,e.stationName=o.stationName,e.stationId=o.stationId,W()}})),(t,s)=>{const I=i("a-input"),u=i("a-form-item"),d=i("a-col"),Y=i("a-date-picker"),E=i("a-select"),H=i("a-input-number"),T=i("a-textarea"),J=i("a-row"),R=i("a-card"),$=i("a-form");return B(),S(U(pe),{detail:!0,dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"fix-detail-page",style:{position:"relative"}},{default:l(()=>[x("div",_e,[x("div",fe,[x("div",ve,[a(X,{options:w},null,8,["options"]),e.status===2?(B(),S(me,{key:0})):Z("",!0),a(ie,{onSave:j,onSubmit:V,processStatus:e.status,processInstanceId:e.processInstanceId},null,8,["processStatus","processInstanceId"])]),x("div",be,[x("div",ge,[a($,{ref_key:"dailyFormRef",ref:g,model:e,name:"dailyForm"},{default:l(()=>[a(R,{title:"基础信息",bordered:!1},{default:l(()=>[a(J,null,{default:l(()=>[v(a(d,{span:12},{default:l(()=>[a(u,{label:"电站名称",name:"stationName",labelAlign:"right",labelCol:{span:4},rules:[{required:!0}]},{default:l(()=>[a(I,{value:e.stationName,"onUpdate:value":s[0]||(s[0]=n=>e.stationName=n),disabled:"",style:{width:"100%"},maxlength:"128"},null,8,["value"])]),_:1})]),_:1},512),[[b,!0]]),v(a(d,{span:12},{default:l(()=>[a(u,{label:"评价日期",name:"evaluationDate",labelAlign:"right",labelCol:{span:4},rules:[{required:!0,message:"请选择日期"}]},{default:l(()=>[a(Y,{value:e.evaluationDate,"onUpdate:value":s[1]||(s[1]=n=>e.evaluationDate=n),disabled:m.value,onChange:k,style:{"min-width":"100%"},"value-format":"YYYY-MM-DD",picker:"date"},null,8,["value","disabled"])]),_:1})]),_:1},512),[[b,!0]]),v(a(d,{span:12},{default:l(()=>[a(u,{label:"评价指标",name:"evaluationTemplateDtlId",labelAlign:"right",labelCol:{span:4},rules:[{required:!0,message:"请选择评价指标"}]},{default:l(()=>[a(E,{value:e.evaluationTemplateDtlId,"onUpdate:value":s[2]||(s[2]=n=>e.evaluationTemplateDtlId=n),"allow-clear":"",style:{width:"100%"},placeholder:"请选择评价指标",options:f.value,onChange:z,disabled:f.value.length==0||m.value},null,8,["value","options","disabled"])]),_:1})]),_:1},512),[[b,!0]]),v(a(d,{span:12},{default:l(()=>[a(u,{label:"评价分数",name:"score",labelAlign:"right",labelCol:{span:4},rules:[{required:!0,message:"请输入评价分数"}]},{default:l(()=>[a(H,{value:e.score,"onUpdate:value":s[3]||(s[3]=n=>e.score=n),disabled:m.value,style:{"min-width":"100%"}},null,8,["value","disabled"])]),_:1})]),_:1},512),[[b,!0]]),v(a(d,{span:24,class:"textarea-item"},{default:l(()=>[a(u,{label:"考核目标",name:"assessTarget",labelAlign:"right",labelCol:{span:2}},{default:l(()=>[a(T,{disabled:"",rows:2,value:e.assessTarget,"onUpdate:value":s[4]||(s[4]=n=>e.assessTarget=n)},null,8,["value"])]),_:1})]),_:1},512),[[b,!0]]),v(a(d,{span:24,class:"textarea-item"},{default:l(()=>[a(u,{label:"评分规则描述",name:"scoreRuleDesc",labelAlign:"right",labelCol:{span:2}},{default:l(()=>[a(T,{disabled:"",rows:3,value:e.scoreRuleDesc,"onUpdate:value":s[5]||(s[5]=n=>e.scoreRuleDesc=n)},null,8,["value"])]),_:1})]),_:1},512),[[b,!0]]),v(a(d,{span:24,class:"textarea-item"},{default:l(()=>[a(u,{label:"评价说明",name:"evaluationDesc",labelAlign:"right",labelCol:{span:2}},{default:l(()=>[a(T,{rows:3,value:e.evaluationDesc,"onUpdate:value":s[6]||(s[6]=n=>e.evaluationDesc=n),maxlength:1e3,disabled:m.value,"show-count":""},null,8,["value","disabled"])]),_:1})]),_:1},512),[[b,!0]])]),_:1})]),_:1})]),_:1},8,["model"]),a(R,{title:"日常评价附件",bordered:!1},{default:l(()=>[a(de,{width:800,height:550,maxCount:20,maxSize:100*1024*1024,application:"po",module:"evaluationDaily",vmode:e.status==0?"box":"view",bizId:e.bizFileId},null,8,["vmode","bizId"])]),_:1})])])])])]),_:1})}}});const at=ne(Ie,[["__scopeId","data-v-7f70da3b"]]);export{at as default};
//# sourceMappingURL=create-4442b8ce.js.map
