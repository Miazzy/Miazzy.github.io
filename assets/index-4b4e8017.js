var h=(e,i,l)=>new Promise((m,r)=>{var u=a=>{try{p(l.next(a))}catch(t){r(t)}},f=a=>{try{p(l.throw(a))}catch(t){r(t)}},p=a=>a.done?m(a.value):Promise.resolve(a.value).then(u,f);p((l=l.apply(e,i)).next())});import{B as I}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as x}from"./useTable-109483b3.js";import{K as S}from"./antd-15ac76ed.js";import{a0 as y,a5 as d,b as Y,au as C,av as P}from"./index.js";import{e as O}from"./download-03e71dd5.js";import{P as z}from"./index-20519caf.js";import{d as D,r as M,al as R,Z as T,a9 as v,aa as g,f as b,u as c,E as N,ad as _}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";const F=e=>d.post({url:"/bi/elec/export-loss-detail",params:e,responseType:"blob"},{isReturnNativeResponse:!0}),k=e=>d.get({url:"/bi/elec/lossDetail",params:e},{isOnlyResult:!0}),E=e=>d.get({url:"/bi/common/org/info",params:e},{isOnlyResult:!0}),B=e=>d.post({url:"/baseset/common/list-station",params:e}),q={labelWidth:120,actionColOptions:{span:24},autoAdvancedLine:1,showAdvancedButton:!0,baseColProps:{span:7},autoSubmitOnEnter:!0,noHideBtnFlag:!0,schemas:[{field:"dateCycle",label:"时间维度",component:"Select",required:!0,defaultValue:"year",componentProps:{options:[{value:"year",label:"年份"},{value:"month",label:"月份"},{value:"day",label:"自然日"}]}},{field:"yearValue",label:"年份",component:"YearPicker",defaultValue:S(new Date).format("YYYY"),componentProps:{format:"YYYY",valueFormat:"YYYY",style:{width:"100%"}},show:({values:e})=>e.dateCycle=="year",dynamicRules:({values:e})=>e.dateCycle=="year"?[{required:!0,message:"年份必填"}]:[]},{field:"[startMonth, endMonth]",label:"月份",component:"RangePicker",componentProps:{picker:"month",format:"YYYY-MM",valueFormat:"YYYY-MM",style:{width:"100%"},placeholder:["开始月份","结束月份"]},show:({values:e})=>e.dateCycle=="month",dynamicRules:({values:e})=>e.dateCycle=="month"?[{required:!0,message:"月份必填"}]:[]},{field:"[startDate, endDate]",label:"时间段",component:"RangePicker",componentProps:{format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",style:{width:"100%"},placeholder:["开始时间","结束时间"]},show:({values:e})=>e.dateCycle=="day",dynamicRules:({values:e})=>e.dateCycle=="day"?[{required:!0,message:"时间段必填"}]:[]},{field:"orgId",label:"所属公司",component:"ApiSelect",componentProps:{options:[],api:E,placeholder:"请选择所属公司"},show:y().isMultiOrganization},{field:"stationId",label:"电站名称",component:"ApiSelect",componentProps:{options:[],api:()=>h(void 0,null,function*(){const e=yield B({}),i=[];return e.result.forEach(l=>{i.push({value:l.powerStationId,label:l.powerStationName})}),i}),placeholder:"请输入电站名称"}},{field:"lossType",label:"损失类型",component:"DictSelectBox",componentProps:{type:"elecLossCate",placeholder:"请选择损失类型"}},{field:"lossReason",label:"损失原因",component:"DictSelectBox",componentProps:{type:"elecLossType",placeholder:"请选择损失原因"}},{field:"equipmentName",label:"设备名称",component:"Input",componentProps:{placeholder:"请输入设备名称"}},{field:"factoryName",label:"生产厂家",component:"Input",componentProps:{autocomplete:"off",placeholder:"请输入生产厂家"}}]},w=[{title:"所属公司",dataIndex:"stationOrganName",width:150,customCell:e=>({rowSpan:e.rowOrgSpan}),resizable:!0,ifShow:y().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",width:150,customCell:e=>({rowSpan:e.rowStationSpan}),resizable:!0},{title:"期数",dataIndex:"periodName",width:150,customCell:e=>({rowSpan:e.rowPeriodSpan}),resizable:!0},{title:"发生日期",dataIndex:"startTime",width:150,resizable:!0},{title:"结束日期",dataIndex:"endTime",width:150,resizable:!0},{title:"损失电量(Kwh)",dataIndex:"lossElec",width:150,resizable:!0},{title:"损失类型",dataIndex:"lossTypeName",width:150,resizable:!0},{title:"损失原因",dataIndex:"lossReasonName",width:150,resizable:!0},{title:"损失描述",dataIndex:"reason",width:200,resizable:!0},{title:"设备名称",dataIndex:"equipmentName",width:150,resizable:!0},{title:"生产厂家",dataIndex:"factoryName",width:150,resizable:!0}],de=D({__name:"index",setup(e){const{t:i}=Y(),{createConfirm:l,createMessage:m}=C(),r=M({});function u(){l({title:i("common.message.confirmTitle"),iconType:"warning",content:i("common.message.exportMessage"),onOk(){return h(this,null,function*(){Object.assign(r,p().getFieldsValue()),r.filename="损失电量明细.xls",r.excelList=w,yield F(r).then(t=>{O(t==null?void 0:t.data,r.filename)}),r.filename=null,r.excelList=null,m.success(i("common.exportSuccessText"))})}})}const[f,{getForm:p}]=x({title:"损失电量明细",api:k,columns:w,formConfig:q,useSearchForm:!0,bordered:!0,pagination:!1,showIndexColumn:!0,showTableSetting:!0,tableSetting:{redo:!1,size:!1,setting:!0,fullScreen:!1},afterFetch:function(a){const t={};for(let s=0;s<a.length;s++){const o=a[s];t[o.stationOrganId]&&t[o.stationOrganId]++,t[o.stationId]&&t[o.stationId]++,t[o.periodId]&&t[o.periodId]++,t[o.stationOrganId]||(t[o.stationOrganId]=1),t[o.stationId]||(t[o.stationId]=1),t[o.periodId]||(t[o.periodId]=1)}for(let s=0;s<a.length;s++){const o=a[s];for(const n in t)o.stationOrganId===n&&(o.rowOrgSpan=t[n],t[n]=0),o.stationId===n&&(o.rowStationSpan=t[n],t[n]=0),o.periodId===n&&(o.rowPeriodSpan=t[n],t[n]=0)}return a}});return(a,t)=>{const s=R("a-button");return T(),v(c(z),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:g(()=>[b(c(I),{onRegister:c(f),onResizeColumn:t[0]||(t[0]=(o,n)=>n.width=o)},{toolbar:g(()=>[b(s,{class:"yellow-btn",preIcon:c(P).EXPORT,onClick:u},{default:g(()=>[N(_(c(i)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])]),_:1})}}});export{de as default};
//# sourceMappingURL=index-4b4e8017.js.map
