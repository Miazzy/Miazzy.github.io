var F=(E,f,i)=>new Promise((c,g)=>{var t=n=>{try{d(i.next(n))}catch(m){g(m)}},_=n=>{try{d(i.throw(n))}catch(m){g(m)}},d=n=>n.done?c(n.value):Promise.resolve(n.value).then(t,_);d((i=i.apply(E,f)).next())});import{d as P,k as v,r as $,e as K,u as e,o as U,Z as J,_ as V,v as R,A as k,f as a,aa as o,E as w,ad as S,af as z,F as G}from"./vue-71d1abb3.js";import{u as q,a as W,b as Z,L,_ as j}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-6ef51999.js";import{au as H,u as Q,a0 as X,b as Y,_ as ee}from"./index.js";import{m as se}from"./crypto-ca21d37f.js";import{aI as b,ae as N,aD as ae,ai as h,aJ as oe,aK as te}from"./antd-15ac76ed.js";const ne=P({__name:"LoginForm",setup(E){const f=oe,i=te,c=b.Item,g=N.Password,{t}=Y(),{notification:_,createErrorModal:d}=H(),{prefixCls:n}=Q("login"),m=X(),{setLoginState:C,getLoginState:D}=q(),{getFormRules:O}=W(),I=v(),y=v(!1),p=v(!1),u=$({account:"",password:""}),{validForm:T}=Z(I),x=K(()=>e(D)===L.LOGIN);function M(){return F(this,null,function*(){const r=yield T();if(r)try{y.value=!0;const s=yield m.login({loginName:r.account,password:se(r.password),mode:"none"});if(s){const l={remember:p.value,account:r.account,password:r.password};p.value?localStorage.setItem("REMEMBER_ME_INFO",JSON.stringify(l)):localStorage.setItem("REMEMBER_ME_INFO",""),localStorage.setItem("LOGIN_TIMESTAMP",String(new Date().getTime()));const A=s.username||s.userId;_.success({message:t("sys.login.loginSuccessTitle"),description:`${t("sys.login.loginSuccessDesc")}: ${A}`,duration:3})}}catch(s){d({title:t("sys.api.errorTip"),content:s.message||t("sys.api.networkExceptionMsg"),getContainer:()=>document.body.querySelector(`.${n}`)||document.body})}finally{y.value=!1}})}const B=()=>{const r=localStorage.getItem("REMEMBER_ME_INFO");if(r){const s=JSON.parse(r);p.value=s.remember,u.account=s.account,u.password=s.password}};return U(()=>{B()}),(r,s)=>(J(),V(G,null,[R(a(j,{class:"enter-x"},null,512),[[k,x.value]]),R(a(e(b),{class:"p-4 enter-x",model:u,rules:e(O),ref_key:"formRef",ref:I,onKeypress:z(M,["enter"])},{default:o(()=>[a(e(c),{name:"account",class:"enter-x"},{default:o(()=>[a(e(N),{value:u.account,"onUpdate:value":s[0]||(s[0]=l=>u.account=l),placeholder:e(t)("sys.login.userName"),class:"fix-auto-fill"},null,8,["value","placeholder"])]),_:1}),a(e(c),{name:"password",class:"enter-x"},{default:o(()=>[a(e(g),{visibilityToggle:"",value:u.password,"onUpdate:value":s[1]||(s[1]=l=>u.password=l),placeholder:e(t)("sys.login.password")},null,8,["value","placeholder"])]),_:1}),a(e(i),{class:"enter-x"},{default:o(()=>[a(e(f),{span:12},{default:o(()=>[a(e(c),null,{default:o(()=>[a(e(ae),{checked:p.value,"onUpdate:checked":s[2]||(s[2]=l=>p.value=l),size:"small"},{default:o(()=>[w(S(e(t)("sys.login.rememberMe")),1)]),_:1},8,["checked"])]),_:1})]),_:1}),a(e(f),{span:12,class:"forget-password"},{default:o(()=>[a(e(c),{style:{"text-align":"right"}},{default:o(()=>[a(e(h),{type:"link",size:"small",onClick:s[3]||(s[3]=l=>e(C)(e(L).RESET_PASSWORD))},{default:o(()=>[w(S(e(t)("sys.login.forgetPassword")),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(e(c),{class:"enter-x"},{default:o(()=>[a(e(h),{type:"primary",block:"",onClick:M,loading:y.value},{default:o(()=>[w(S(e(t)("sys.login.loginButton")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules","onKeypress"]),[[k,x.value]])],64))}});const me=ee(ne,[["__scopeId","data-v-c3436575"]]);export{me as default};
//# sourceMappingURL=LoginForm-b88b47a8.js.map
