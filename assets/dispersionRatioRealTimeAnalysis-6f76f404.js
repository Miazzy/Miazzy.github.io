var u=(f,A,v)=>new Promise((l,w)=>{var b=c=>{try{y(v.next(c))}catch(s){w(s)}},C=c=>{try{y(v.throw(c))}catch(s){w(s)}},y=c=>c.done?l(c.value):Promise.resolve(c.value).then(b,C);y((v=v.apply(f,A)).next())});import{d as te,k as n,e as P,o as oe,al as x,Z as z,_ as F,f as r,aa as m,$ as o,v as V,A as $,u as D,E as G,a5 as se,ac as le,aG as ie,aH as ne}from"./vue-71d1abb3.js";import{C as re}from"./CommonTree-c4ed7838.js";import{B as ce}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as de}from"./useTable-109483b3.js";import{ah as ue}from"./antd-15ac76ed.js";import{au as pe,av as me,_ as ve}from"./index.js";import{_ as _e}from"./NtgaleChart.vue_vue_type_script_setup_true_lang-0930fb50.js";import{o as he,h as fe,H as ge,I as ye,J as xe}from"./monitorApi-44e70004.js";import{e as we}from"./download-03e71dd5.js";import"./index-3801a970.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./index-d8a2358f.js";import"./install-58e0bd81.js";import"./NoData-1ab5cc7b.js";const E=f=>(ie("data-v-ef237854"),f=f(),ne(),f),be={class:"real-time-analysis"},Ce={class:"right-box"},Ie={class:"right-row-box"},Te=E(()=>o("div",{class:"box-header"}," 离散率分布 ",-1)),Re={class:"box-content"},Se={class:"chart-box"},De={id:"customerChart",class:"chart-element"},Ee={class:"chart-element"},Ae={class:"right-row-box"},ke={class:"data-table-box"},Ne=E(()=>o("div",{class:"table-title-line"},null,-1)),Ke={class:"select-box"},Le=E(()=>o("div",{class:"select-label-box"},"区域",-1)),Be={class:"select-box"},Me=E(()=>o("div",{class:"select-label-box"},"设备类型",-1)),Oe={style:{"margin-top":"-7px","padding-left":"8px"}},Pe=te({__name:"dispersionRatioRealTimeAnalysis",setup(f){const{createConfirm:A}=pe(),v=n([]),l=n(""),w=ue.PRESENTED_IMAGE_SIMPLE,b=P(()=>[l.value]),C=n([]);function y(){return u(this,null,function*(){let e=yield he();v.value=e,setTimeout(()=>{C.value=[e[0].id,e[0].children[0].id],b.value=[e[0].children[0].id],l.value=e[0].children[0].id,R({current:1}),L(),B(),T()},500)})}function c(){return u(this,arguments,function*(e={}){l.value=null,e.id!=null&&e.nodeKindId=="station"&&(l.value=e.powerStationId,R({current:1}),L(),B())})}const s=n([]),K=n([]),H=e=>{console.log(`selected ${e}`),s.value=e,R({current:1}),T()},L=()=>u(this,null,function*(){s.value=[];let e=yield fe({stationId:l.value});if(e!=null&&e.length){let a=[];e.forEach(t=>{a.push({value:t.id,label:t.name})}),s.value.length==0&&s.value.push(e[0].id),K.value=a,T()}}),g=n("StringFormation"),U=n([{value:"StringFormation",label:"组串式逆变器"},{value:"Concentrate",label:"直流汇流箱"}]);function q(){s.value="",g.value=""}function J(){A({title:"提示",iconType:"warning",content:"确定要导出所有记录？",onOk(){return u(this,null,function*(){let a={stationId:l.value,areaIds:s.value,deviceType:g.value};a.fileName="离散率数据",a.excelList=k.value,yield ge(a).then(t=>{we(t==null?void 0:t.data,a.fileName)})})}})}const I=n({pieData:[]}),B=()=>u(this,null,function*(){let e={stationId:l.value,deviceType:g.value},a=yield ye(e);a&&(I.value.pieData=a)}),X=e=>{R({current:1}),T()},M=P(()=>I.value.pieData&&I.value.pieData.length),k=n([]),N=n([]),Z=()=>u(this,null,function*(){let e=[];N.value.length>0&&(N.value.forEach(a=>{var _;let t={title:a.name+a.unit,dataIndex:a.code,width:120};if(((_=a.subColumn)==null?void 0:_.length)>0){let i=[];a.subColumn.forEach(d=>{var p;let h={title:d.name+a.unit,dataIndex:d.code,width:120};if(((p=d.subColumn)==null?void 0:p.length)>0){let S=[];d.subColumn.forEach(O=>{let ae={title:O.name+a.unit,dataIndex:O.code,width:120};S.push(ae)}),h.children=S}i.push(h)}),t.children=i}e.push(t)}),k.value=e)}),j={normal:"green",alarm:"red",interrupt:"grey",halt:"white"},Q=n([]),W=()=>u(this,null,function*(){if(l.value=="")return;const e=ee();let a={stationId:l.value,areaIds:s.value,deviceType:g.value,pageNo:e.current,pageSize:e.pageSize},t=yield xe(a);if(N.value=t.columns,yield Z(),t){let _=[];t.page.list.forEach(i=>{if(i.serials!=null){let d=i.serials;for(let h in i.serials)i["serials_"+h]=d[h];_.push(i)}}),Q.value=_}return t.page}),[Y,{reload:T,getPaginationRef:ee,setPagination:R}]=de({api:W,columns:k,bordered:!0,pagination:{pageSize:20,pageSizeOptions:["20","50","100","200"]}});return oe(()=>u(this,null,function*(){yield y()})),(e,a)=>{const t=x("a-col"),_=x("a-empty"),i=x("a-select"),d=x("a-button"),h=x("a-row");return z(),F("div",be,[r(h,{class:"real-time-analysis-row",type:"flex",wrap:!1},{default:m(()=>[r(t,{flex:"298px"},{default:m(()=>[r(re,{toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,class:"fit-common-tree",title:"电站组织",value:v.value,fieldNames:{key:"id",title:"name"},onSelect:c,selectedKeys:b.value,expandedKeys:C.value},null,8,["value","selectedKeys","expandedKeys"])]),_:1}),r(t,{flex:"auto"},{default:m(()=>[o("div",Ce,[o("div",Ie,[Te,o("div",Re,[o("div",Se,[V(o("div",De,[r(_e,{id:"omChart",width:800,height:350,data:I.value.pieData,showLabel:"",roseType:!1,radius:[0,120]},null,8,["data"])],512),[[$,M.value]]),V(o("div",Ee,[r(_,{image:D(w)},null,8,["image"])],512),[[$,!M.value]])])])]),o("div",Ae,[o("div",ke,[Ne,r(D(ce),{onRegister:D(Y)},{tableTitle:m(()=>[o("div",Ke,[Le,r(i,{value:s.value,"onUpdate:value":a[0]||(a[0]=p=>s.value=p),"allow-clear":"",mode:"multiple",style:{"min-width":"256px"},placeholder:"选择区域",options:K.value,"max-tag-count":2,showArrow:"",onChange:H},null,8,["value","options"])]),o("div",Be,[Me,r(i,{value:g.value,"onUpdate:value":a[1]||(a[1]=p=>g.value=p),"allow-clear":"",style:{"min-width":"256px"},placeholder:"选择设备类型",options:U.value,showArrow:"",onChange:X},null,8,["value","options"])])]),toolbar:m(()=>[o("div",Oe,[r(d,{onClick:q},{default:m(()=>[G(" 重置 ")]),_:1}),r(d,{class:"yellow-btn",style:{"margin-left":"8px"},onClick:J,preIcon:D(me).EXPORT},{default:m(()=>[G(" 导出 ")]),_:1},8,["preIcon"])])]),bodyCell:m(({column:p,record:S})=>[p.key==="status"?(z(),F("span",{key:0,class:se(["status-icon",j[S.status]])},null,2)):le("",!0)]),_:1},8,["onRegister"])])])])]),_:1})]),_:1})])}}});const _a=ve(Pe,[["__scopeId","data-v-ef237854"]]);export{_a as default};
//# sourceMappingURL=dispersionRatioRealTimeAnalysis-6f76f404.js.map
