var C=(n,t,v)=>new Promise((p,k)=>{var o=r=>{try{f(v.next(r))}catch(g){k(g)}},I=r=>{try{f(v.throw(r))}catch(g){k(g)}},f=r=>r.done?p(r.value):Promise.resolve(r.value).then(o,I);f((v=v.apply(n,t)).next())});import{B as fe}from"./BasicTable-0434a334.js";import{T as ve}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as Ie}from"./useTable-109483b3.js";import{a8 as _e,a2 as y}from"./antd-15ac76ed.js";import{a5 as R,b as be,au as he,av as B,_ as ge}from"./index.js";import{D as Ce}from"./Dialog-0a006d82.js";import{P as we}from"./index-20519caf.js";import{C as ye}from"./CommonTree-c4ed7838.js";import{n as Se,d as Re,r as z,k as m,e as ke,o as Ke,al as b,Z as D,a9 as O,aa as s,f as l,$ as M,u as h,E as q,ad as U,ac as V,_ as Pe,aG as Fe,aH as Te}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";const H=n=>R.get({url:"/baseset/areaset/periods",params:n},{}),S=(n,t)=>Se(_e,{title:n.record[t]},()=>n.record[t]);function xe(n){return[{title:"电站名称",dataIndex:"stationName",width:150,align:"center",resizable:!0,customRender:t=>S(t,"stationName")},{title:"分期",dataIndex:"stationPeriodId",editRow:!0,editComponent:"Select",editComponentProps:{options:n,labelField:"label",valueField:"value"},editRender:t=>S(t,"stationPeriodName"),resizable:!0,width:120},{title:"区域编码",dataIndex:"code",align:"center",customRender:t=>S(t,"code"),width:120,resizable:!0},{title:"设备数量",dataIndex:"deviceCount",width:120,align:"center",customRender:t=>S(t,"deviceCount"),resizable:!0},{title:"区域名称",dataIndex:"name",editRow:!0,width:120,editRule:(t,v)=>C(this,null,function*(){return(t==null?void 0:t.length)>20?"名称长度不能超过20":""}),resizable:!0,editComponent:"Input",editRender:t=>S(t,"name")},{title:"描述信息",dataIndex:"description",editRow:!0,width:400,resizable:!0,editRule:(t,v)=>C(this,null,function*(){return(t==null?void 0:t.length)>100?"名称长度不能超过100":""}),editRender:t=>S(t,"description")}]}const Ae=n=>R.post({url:"/baseset/common/list-orgStationPeriodTree",params:n},{}),De=n=>R.post({url:"/baseset/areaset/list",params:n},{}),Ne=n=>R.post({url:"/baseset/areaset/create",params:n},{}),Ee=n=>R.put({url:"/baseset/areaset/update",params:n},{}),Le=n=>R.delete({url:"/baseset/areaset/delete",params:n},{}),Be=n=>(Fe("data-v-d8dc44a7"),n=n(),Te(),n),ze={class:"right-table-layout"},Oe=Be(()=>M("span",{style:{display:"inline-block",height:"32px","margin-bottom":"24px","line-height":"32px"}},"-",-1)),qe={key:0,class:"dialog-mask"},Ue=Re({__name:"areaSet",setup(n){const{t}=be(),{createConfirm:v}=he(),p=z({}),k=m([]),o=m({}),I=m({}),f=m(!1),r=m(!1),g=m(!1),w=m(""),F=m(""),u=m([]),T=m([]),G=xe(T),d=z({startCode:"",endCode:"",stationPeriodId:""}),N=m(),W=()=>C(this,null,function*(){return o.value.nodeKindId==null?[]:(o.value.sortField=p.sortField,o.value.sortOrder=p.sortOrder,(yield De(o.value)).result)}),[Y,{reload:P,getDataSource:Z}]=Ie({title:"区域列表",api:W,columns:G,useSearchForm:!1,showTableSetting:!0,pagination:!1,bordered:!0,rowKey:"id",rowSelection:{type:"checkbox",selectedRowKeys:u,onSelect:$,onSelectAll:j},handleSearchInfoFn(e){return e},actionColumn:{title:"操作",dataIndex:"action"},sortFn:e=>{e.order?(p.sortField=e.field,p.sortOrder=e.order.replace("end","")):(p.sortField="",p.sortOrder="")}});function $(e,a){a?u.value=[...u.value,e.id]:u.value=u.value.filter(i=>i!==e.id)}function j(e,a,i){const K=i.map(_=>_.id);e?u.value=[...u.value,...K]:u.value=u.value.filter(_=>!K.includes(_))}const J=ke(()=>u.value.length>0);function Q(){return C(this,null,function*(){const e=yield Ae({});k.value=e.result})}function X(){if(o.value.stationId==null){y.error("请先选择电站或分期。");return}o.value.nodeKindId=="station"&&(x(),F.value="新增区域-"+o.value.stationName),o.value.nodeKindId=="period"&&(x(),F.value="新增区域-"+o.value.stationName),f.value=!0,d.startCode=1,d.endCode=20}function ee(){let e=Z();for(let i=0;i<e.length;i++)if(u.value.includes(e[i].id)&&e[i].deviceCount>0)return y.error("存在设备的区域不能删除。"),!1;v({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return C(this,null,function*(){Le(u.value).then(()=>{y.success("已删除。"),P()})})}})}function te(){N.value.validateFields().then(()=>{d.stationId=o.value.stationId,r.value=!0,Ne(d).then(()=>{y.success("创建成功"),P(),r.value=!1,f.value=!1}).catch(()=>{r.value=!1})})}function ae(){f.value=!1,r.value=!1}function x(){let e={stationId:I.value.stationId};H(e).then(a=>{T.value=a.result,window.ASoptions=a.result,o.value.nodeKindId=="station"?(g.value=!1,d.stationPeriodId=a.result[0].value):o.value.nodeKindId=="period"&&(d.stationPeriodId=o.value.periodId,g.value=!0)})}function ne(e={}){if(o.value.stationId=null,e.nodeKindId=="station"&&(o.value.stationId=e.powerStationId,o.value.stationName=e.name,I.value.stationId=e.powerStationId),e.nodeKindId=="period"&&(o.value.stationId=e.powerStationId,o.value.periodId=e.powerStationPeriodId,I.value.stationId=e.powerStationId,o.value.stationName=e.name),o.value.nodeKindId=e.nodeKindId,I.value.nodeKindId=e.nodeKindId,o.value.searchId=e.id,w.value!="")return y.error("请先完成编辑。"),!1;P()}function oe(e){var a;I.value.stationId=e.stationId,I.value.nodeKindId="station",x(),w.value=E(e),(a=e.onEdit)==null||a.call(e,!0)}const E=e=>Reflect.has(e,"key")?Reflect.get(e,"key"):Reflect.has(e,"id")?Reflect.get(e,"id"):"",le=e=>w.value?w.value!==E(e):!1;function se(e){return C(this,null,function*(){var i;(yield(i=e.onValid)==null?void 0:i.call(e))&&Ee(e).then(()=>{w.value="",y.success("已修改"),P()})})}function ie(e){var a;w.value="",(a=e.onEdit)==null||a.call(e,!1,!1)}function re(e){return e.editable?[{label:"保存",onClick:se.bind(null,e)},{label:"取消",popConfirm:{title:"是否取消修改",confirm:ie.bind(null,e)}}]:[{label:"修改",icon:"clarity:bullet-list-line",disabled:le(e),onClick:oe.bind(null,e)}]}function de(){H({stationId:""}).then(e=>{window.ASoptions=e.result})}return Ke(()=>{Q(),de()}),(e,a)=>{const i=b("a-button"),K=b("a-input-number"),_=b("a-form-item"),ue=b("a-space"),L=b("a-col"),ce=b("a-select"),me=b("a-row"),pe=b("a-form");return D(),O(h(we),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:s(()=>[l(ye,{title:"电站组织",onSelect:ne,value:k.value,canEdit:!1,canAdd:!1,canDelete:!1,class:"left-tree-layout",isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),M("div",ze,[l(h(fe),{class:"fix-basic-table",onRegister:h(Y),tooltip:!1,searchInfo:p,onResizeColumn:a[0]||(a[0]=(c,A)=>A.width=c)},{toolbar:s(()=>[l(i,{type:"primary",preIcon:h(B).ADD,onClick:X},{default:s(()=>[q(U(h(t)("common.action.create")),1)]),_:1},8,["preIcon"]),l(i,{class:"tab-button",type:"error",disabled:!J.value,preIcon:h(B).DELETE,onClick:ee},{default:s(()=>[q(U(h(t)("common.delText")),1)]),_:1},8,["disabled","preIcon"])]),bodyCell:s(({column:c,record:A})=>[c.key==="action"?(D(),O(h(ve),{key:0,actions:re(A)},null,8,["actions"])):V("",!0)]),_:1},8,["onRegister","searchInfo"])]),l(Ce,{visible:f.value,"onUpdate:visible":a[4]||(a[4]=c=>f.value=c),height:300,width:500,smode:"normal",overflowY:"auto",title:F.value,onConfirm:te,onCancel:ae},{default:s(()=>[l(pe,{ref_key:"modalFormRef",ref:N,model:d,name:"userForm"},{default:s(()=>[l(me,null,{default:s(()=>[l(L,{span:22},{default:s(()=>[l(_,{label:"编码范围",name:"startCode",labelCol:{span:5},rules:[{required:!0,message:"请选择编码范围"}]},{default:s(()=>[l(ue,null,{default:s(()=>[l(_,{name:"startCode",rules:[{required:!0,message:"请选择编码范围"}]},{default:s(()=>[l(K,{value:d.startCode,"onUpdate:value":a[1]||(a[1]=c=>d.startCode=c),min:1,max:"999"},null,8,["value"])]),_:1}),Oe,l(_,{name:"endCode",rules:[{required:!0,message:"请选择编码范围"}]},{default:s(()=>[l(K,{value:d.endCode,"onUpdate:value":a[2]||(a[2]=c=>d.endCode=c),min:1,max:"999"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),l(L,{span:22},{default:s(()=>[l(_,{label:"电站分期",name:"stationPeriodId",labelCol:{span:5},rules:[{required:!0,message:"请选择电站分期"}]},{default:s(()=>[l(ce,{value:d.stationPeriodId,"onUpdate:value":a[3]||(a[3]=c=>d.stationPeriodId=c),"allow-clear":"",style:{width:"100%"},placeholder:"请选择分期",options:T.value,disabled:g.value,onChange:e.handleChange},null,8,["value","options","disabled","onChange"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),r.value?(D(),Pe("div",qe)):V("",!0)]),_:1})}}});const vt=ge(Ue,[["__scopeId","data-v-d8dc44a7"]]);export{vt as default};
//# sourceMappingURL=areaSet-466db7e2.js.map
