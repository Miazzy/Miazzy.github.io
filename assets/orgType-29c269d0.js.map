{"version":3,"file":"orgType-29c269d0.js","sources":["../../src/views/system/configuration/orgType/orgType.vue"],"sourcesContent":["<template>\n  <PageWrapper dense contentFullHeight fixedHeight contentClass=\"flex\" style=\"position: relative\">\n    <SysCommonTree\n      treeClass=\"left-tree-layout\"\n      :toolbar=\"true\"\n      :search=\"true\"\n      :title=\"webInfo.title\"\n      :treeType=\"treeType\"\n      @select=\"handleSelect\"\n      :beforeDelete=\"beforeDelete\"\n    />\n    <!-- 数据表格 -->\n    <div class=\"right-table-layout\">\n      <BasicTable @register=\"registerTable\" class=\"fix-basic-table\" :searchInfo=\"searchInfo\">\n        <template #toolbar>\n          <a-button type=\"primary\" :preIcon=\"IconEnum.ADD\" @click=\"handleCreateIndex\">\n            {{ t('common.action.create') }}\n          </a-button>\n          <a-button type=\"primary\" :preIcon=\"IconEnum.EDIT\" @click=\"handleUpdateIndex\">{{\n            t('common.action.edit')\n          }}</a-button>\n          <a-button class=\"red-btn\" :preIcon=\"IconEnum.DELETE\" @click=\"handleDelete\">{{\n            t('common.delText')\n          }}</a-button>\n          <a-button type=\"primary\" @click=\"handleUpdateSortIndex\">保存排序号</a-button>\n          <a-button type=\"primary\" @click=\"handleMoveIndex\">移动</a-button>\n        </template>\n        <template #bodyCell=\"{ column, record, text }\">\n          <template v-if=\"column.dataIndex === 'sort'\">\n            <a-input-number\n              v-model:value=\"record[column.dataIndex]\"\n              :min=\"1\"\n              :max=\"999\"\n              :step=\"1\"\n              :precision=\"0\"\n              status=\"error\"\n            />\n          </template>\n          <template v-if=\"column.dataIndex === 'status'\">\n            <span style=\"color: #19be6b\" v-if=\"text == 1\">启用</span>\n            <span style=\"color: red\" v-if=\"text == 0\">禁用</span>\n          </template>\n        </template>\n      </BasicTable>\n    </div>\n\n    <!-- 弹窗 -->\n    <Dialog\n      v-model:visible=\"orgTypeModal\"\n      :title=\"webInfo.title\"\n      :maskClosable=\"false\"\n      :height=\"350\"\n      :width=\"600\"\n      smode=\"normal\"\n      @ok=\"handleSaveFrom\"\n      @cancel=\"handleClosedModal\"\n    >\n      <a-form ref=\"fromRef\" :model=\"formState\" name=\"userForm\">\n        <a-row :gutter=\"24\">\n          <a-col v-show=\"true\" :span=\"23\">\n            <a-form-item\n              label=\"编码\"\n              name=\"code\"\n              :labelCol=\"{ span: 6 }\"\n              :rules=\"[{ required: true, max: 30 }]\"\n            >\n              <a-input v-model:value=\"formState.code\" :maxlength=\"64\" />\n            </a-form-item>\n          </a-col>\n        </a-row>\n        <a-row>\n          <a-col v-show=\"true\" :span=\"23\">\n            <a-form-item\n              label=\"名称\"\n              name=\"name\"\n              :labelCol=\"{ span: 6 }\"\n              :rules=\"[{ required: true, max: 30 }]\"\n            >\n              <a-input v-model:value=\"formState.name\" :maxlength=\"64\" />\n            </a-form-item>\n          </a-col>\n        </a-row>\n        <a-row>\n          <a-col v-show=\"true\" :span=\"23\">\n            <a-form-item\n              name=\"status\"\n              label=\"状态\"\n              :labelCol=\"{ span: 6 }\"\n              :rules=\"[{ required: true, message: '请选择状态' }]\"\n            >\n              <DictRadioGroup v-model:value=\"formState.status\" :type=\"`enable_or_disable`\" />\n            </a-form-item>\n          </a-col>\n        </a-row>\n        <!-- <a-row>\n          <a-col v-show=\"true\" :span=\"23\">\n            <a-form-item\n              label=\"排序号\"\n              name=\"sort\"\n              :labelCol=\"{ span: 6 }\"\n              :rules=\"[{ required: true, max: 30 }]\"\n            >\n              <a-input-number v-model:value=\"formState.sort\" :min=\"1\" :max=\"999\" />\n            </a-form-item>\n          </a-col>\n        </a-row> -->\n      </a-form>\n    </Dialog>\n\n    <!-- 弹窗 -->\n    <Dialog\n      v-model:visible=\"moveModal\"\n      :title=\"webInfo.title\"\n      :maskClosable=\"false\"\n      @ok=\"handleSaveMoveFrom\"\n      :toolbar=\"false\"\n      :search=\"false\"\n      :height=\"650\"\n      :width=\"600\"\n      smode=\"normal\"\n    >\n      <a-form ref=\"moveFromRef\" :model=\"formState\" name=\"userForm\">\n        <SysCommonTree\n          :title=\"webInfo.title\"\n          treeClass=\"w-6/6\"\n          :treeType=\"treeType\"\n          @select=\"handleMoveSelect\"\n        />\n      </a-form>\n    </Dialog>\n  </PageWrapper>\n</template>\n<script lang=\"ts\" setup>\n  import { reactive, ref, onMounted } from 'vue';\n  import { BasicTable, useTable } from '/@/components/Table';\n  import { PageWrapper } from '/@/components/Page';\n  import SysCommonTree from '@/views/system/configuration/commontree/SysCommonTree.vue';\n  import { message, FormInstance } from 'ant-design-vue';\n  import { assign } from 'lodash-es';\n  import DictRadioGroup from '@/components/Framework/Radio/DictRadioGroup.vue';\n  import {\n    columns,\n    searchFormSchema,\n    saveOrgType,\n    deleteOrgType,\n    updateSort,\n    getOrgTypeList,\n  } from './data';\n  import { urlToPath } from '/@/utils/route';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { IconEnum } from '@/enums/appEnum';\n  import { useMessage } from '@/hooks/web/useMessage';\n  import Dialog from '@/components/Framework/Modal/Dialog.vue';\n\n  const { createConfirm } = useMessage();\n  const { t } = useI18n();\n\n  // 查询信息\n  const searchInfo = reactive<any>({});\n  // 被选择的树节点\n  const selectedNode = reactive<any>({});\n  const orgTypeModal = ref<boolean>(false);\n  const selectedMoveNode = reactive<any>({});\n  const moveModal = ref<boolean>(false);\n  const formState = ref<any>({});\n  const fromRef = ref<FormInstance>();\n  let { params } = urlToPath() as any;\n\n  const webInfo = ref<any>({});\n  const tableTitle = ref('');\n  const treeType = ref('');\n  // 启动执行代码\n  onMounted(() => {\n    if (params.orgKindId == 'ogn') {\n      searchInfo.orgKindId = 'ogn';\n      webInfo.value.title = '机构类型';\n      treeType.value = 'sys_ogn';\n      tableTitle.value = '机构类型列表';\n    }\n    if (params.orgKindId == 'dpt') {\n      searchInfo.orgKindId = 'dpt';\n      webInfo.value.title = '部门类型';\n      treeType.value = 'sys_dept';\n      tableTitle.value = '部门类型列表';\n    }\n    if (params.orgKindId == 'pos') {\n      searchInfo.orgKindId = 'pos';\n      webInfo.value.title = '岗位类型';\n      treeType.value = 'sys_pos';\n      tableTitle.value = '岗位类型列表';\n    }\n  });\n\n  const indexList = ref<Array<any>>([]);\n  const getIndexListByParam = async () => {\n    let list = await getOrgTypeList(searchInfo);\n    indexList.value = list;\n    return list;\n  };\n\n  // 删除\n  function beforeDelete(node) {\n    if (indexList.value.total > 0) {\n      message.warn('该节点存在系统参数,不能删除。');\n    }\n    //你的代码\n    return indexList.value.total == 0;\n  }\n\n  const [\n    registerTable,\n    { reload, getPaginationRef, getSelectRows, getDataSource, clearSelectedRowKeys },\n  ] = useTable({\n    title: tableTitle,\n    // api: getOrgTypeList,\n    api: async () => {\n      const paginationRef = getPaginationRef() as any;\n      searchInfo.pageNo = paginationRef.current;\n      searchInfo.pageSize = paginationRef.pageSize;\n      let dataObj = await getIndexListByParam();\n      return dataObj;\n    },\n    columns: columns,\n    useSearchForm: true,\n    formConfig: searchFormSchema,\n    showTableSetting: false,\n    bordered: true,\n    rowKey: 'id',\n    pagination: {\n      defaultPageSize: 1,\n      pageSize: 20,\n    },\n    rowSelection: {\n      type: 'radio',\n    },\n    handleSearchInfoFn(info) {\n      if (params.orgKindId == 'ogn') {\n        searchInfo.orgKindId = 'ogn';\n      }\n      if (params.orgKindId == 'dpt') {\n        searchInfo.orgKindId = 'dpt';\n      }\n      if (params.orgKindId == 'pos') {\n        searchInfo.orgKindId = 'pos';\n      }\n      assign(searchInfo, info);\n      return info;\n    },\n  });\n\n  // 左侧树状菜单选中事件\n  function handleSelect(node) {\n    searchInfo.typeFullId = null;\n    if (node) {\n      searchInfo.typeFullId = node.fullId;\n      searchInfo.folderId = node.id;\n      searchInfo.folderName = node.name;\n      selectedNode.folderId = node.id;\n      selectedNode.nodeType = node.parentId;\n      selectedNode.existChildNode = node.children.length > 0;\n    }\n    if (node.parentId == 'root') {\n      searchInfo.folderId = '';\n    }\n    reload();\n  }\n\n  function handleMoveSelect(node) {\n    searchInfo.typeFullId = null;\n    if (node) {\n      selectedMoveNode.folderId = node.id;\n      selectedMoveNode.nodeType = node.parentId;\n    }\n    reload();\n  }\n\n  // 添加\n  async function handleCreateIndex() {\n    if (!selectedNode.folderId) {\n      message.error('请选择树节点类型。');\n      return;\n    }\n    if (selectedNode.nodeType == 'root') {\n      message.error('根节点不能添加业务数据。');\n      return;\n    }\n    formState.value = {};\n    if (params.orgKindId == 'ogn') {\n      formState.value.orgKindId = 'ogn';\n      webInfo.value.title = '添加机构类型';\n    }\n    if (params.orgKindId == 'dpt') {\n      formState.value.orgKindId = 'dpt';\n      webInfo.value.title = '添加部门类型';\n    }\n    if (params.orgKindId == 'pos') {\n      formState.value.orgKindId = 'pos';\n      webInfo.value.title = '添加岗位类型';\n    }\n    formState.value.folderId = selectedNode.folderId;\n    formState.value.status = '1';\n    orgTypeModal.value = true;\n  }\n\n  function handleClosedModal() {\n    orgTypeModal.value = false;\n  }\n\n  function handleMoveIndex() {\n    const row = checkSelectData();\n    if (!row.id) {\n      return;\n    }\n    if (params.orgKindId == 'ogn') {\n      treeType.value = 'sys_ogn';\n      webInfo.value.title = '移动机构类型';\n    }\n    if (params.orgKindId == 'dpt') {\n      treeType.value = 'sys_dept';\n      webInfo.value.title = '移动部门类型';\n    }\n    if (params.orgKindId == 'pos') {\n      treeType.value = 'sys_pos';\n      webInfo.value.title = '移动岗位类型';\n    }\n    moveModal.value = true;\n  }\n\n  //保存\n  function handleSaveFrom() {\n    fromRef.value.validateFields().then(() => {\n      saveOrgType(formState.value).then(() => {\n        orgTypeModal.value = false;\n        message.success('操作成功。');\n        reload();\n      });\n    });\n  }\n\n  function handleSaveMoveFrom() {\n    const row = checkSelectData();\n    if (selectedMoveNode.nodeType == 'root') {\n      message.error('根节点不能添加业务数据。');\n      return;\n    }\n    formState.value = row;\n    formState.value.folderId = selectedMoveNode.folderId;\n    saveOrgType(formState.value).then(() => {\n      moveModal.value = false;\n      message.success('操作成功。');\n      reload();\n    });\n  }\n\n  //获取表格选择数据\n  function checkSelectData() {\n    const selectRows = getSelectRows();\n    if (selectRows.length == 0) {\n      message.error('请选择一行数据。');\n      return false;\n    }\n    return selectRows[0] as any;\n  }\n\n  // 修改\n  function handleUpdateIndex() {\n    const row = checkSelectData();\n    if (!row.id) {\n      return;\n    }\n    if (params.orgKindId == 'ogn') {\n      formState.value.orgKindId = 'ogn';\n      webInfo.value.title = '修改机构类型';\n    }\n    if (params.orgKindId == 'dpt') {\n      formState.value.orgKindId = 'dpt';\n      webInfo.value.title = '修改部门类型';\n    }\n    if (params.orgKindId == 'pos') {\n      formState.value.orgKindId = 'pos';\n      webInfo.value.title = '修改岗位类型';\n    }\n\n    formState.value = row;\n    formState.value.status = String(row.status);\n\n    orgTypeModal.value = true;\n  }\n\n  // 删除\n  async function handleDelete() {\n    const row = checkSelectData();\n    if (!row.id) {\n      return;\n    }\n    createConfirm({\n      title: '提示',\n      iconType: 'warning',\n      content: '确定要删除选中记录？',\n      async onOk() {\n        deleteOrgType(row.id).then(() => {\n          message.success('已删除');\n          clearSelectedRowKeys();\n          reload();\n        });\n      },\n    });\n  }\n  //排序号\n  function handleUpdateSortIndex() {\n    const orgTypeList = getDataSource();\n    const params = ref<Array<any>>([]);\n    orgTypeList.forEach((item) => {\n      if (!item.sort) {\n        message.error('排序不能为空。');\n        throw Error('排序不能为空。');\n      }\n      params.value.push({ id: item.id, sort: item.sort });\n    });\n    updateSort(params.value).then(() => {\n      message.success('保存排序成功。');\n      reload();\n    });\n  }\n</script>\n<style lang=\"less\" scoped>\n  :deep(.left-tree-layout) {\n    flex-shrink: 0;\n    width: 298px;\n    border-radius: 2px;\n  }\n\n  .right-table-layout {\n    width: calc(100% - 308px);\n  }\n\n  .fix-basic-table {\n    :deep(&.vben-basic-table .ant-table-wrapper) {\n      padding: 10px 16px 12px;\n    }\n\n    :deep(.table-settings) {\n      margin-right: 0;\n    }\n\n    :deep(.table-settings .anticon-setting) {\n      margin-right: 0;\n    }\n  }\n</style>\n"],"names":["createConfirm","useMessage","t","useI18n","searchInfo","reactive","selectedNode","orgTypeModal","ref","selectedMoveNode","moveModal","formState","fromRef","params","urlToPath","webInfo","tableTitle","treeType","onMounted","indexList","getIndexListByParam","__async","list","getOrgTypeList","beforeDelete","node","message","registerTable","reload","getPaginationRef","getSelectRows","getDataSource","clearSelectedRowKeys","useTable","paginationRef","columns","searchFormSchema","info","assign","handleSelect","handleMoveSelect","handleCreateIndex","handleClosedModal","handleMoveIndex","checkSelectData","handleSaveFrom","saveOrgType","handleSaveMoveFrom","row","selectRows","handleUpdateIndex","handleDelete","deleteOrgType","handleUpdateSortIndex","orgTypeList","item","updateSort"],"mappings":"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"}