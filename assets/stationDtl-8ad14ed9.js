var i=(E,C,p)=>new Promise((w,v)=>{var g=t=>{try{_(p.next(t))}catch(u){v(u)}},m=t=>{try{_(p.throw(t))}catch(u){v(u)}},_=t=>t.done?w(t.value):Promise.resolve(t.value).then(g,m);_((p=p.apply(E,C)).next())});import{d as J,ax as tt,u as F,k as h,r as O,o as et,al as r,Z as L,_ as P,$ as I,f as e,aa as a,v as x,A as D,E as y,F as at,ad as A,ac as ot}from"./vue-71d1abb3.js";import{B as lt}from"./BillTitle-d17ab3e4.js";import{au as nt,ak as st,av as R,ax as it,_ as rt}from"./index.js";import"./index-74ac3212.js";import{a as dt,o as ut,n as ct,p as pt}from"./monthly-62dfedc7.js";import{a as B}from"./assign-37f1c13d.js";import{j as mt}from"./Export2Excel-389a8fc9.js";import{a2 as _t}from"./antd-15ac76ed.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useForm-dea3ed18.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./uniqBy-92d3bc7f.js";import"./index-085d06c7.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useRender-21ce56fb.js";const ft={class:"load"},vt={class:"process-box"},gt={class:"header-box"},yt={class:"content"},bt={style:{display:"flex","justify-content":"flex-end"}},ht=J({__name:"stationDtl",setup(E){const{createConfirm:C}=nt(),p=tt(),{currentRoute:w}=p;F(w);const v=st.getInstance().getQuery(),g=h([]),m=h([]),_=h(),t=O({status:0}),u=O({}),M=h([{label:"aaa",value:1}]);u.subject="电站得分详情",u.infoItems=[];const V=()=>i(this,null,function*(){let o=yield ct({monthlyEvaluationId:t.id}),l=[];o.forEach(s=>{l.push({value:s.stationId,label:s.stationName})}),M.value=l}),f=O({}),k=()=>i(this,null,function*(){let o={id:t.id,stationId:t.stationId,evaluationTemplateDtlId:t.evaluationTemplateDtlId,sortField:f.sortField,sortOrder:f.sortOrder},l=yield pt(o);m.value=l}),z=()=>i(this,null,function*(){_.value.validateFields().then(()=>i(this,null,function*(){let o=yield getMonthlyByPeriod({evaluationPeriod:t.evaluationPeriod});o==null?(t.id="",t.evaluationTemplateDtlId=""):B(t,o),k()}))});function Y(){t.stationId=null}const U=(o,l,s)=>{s.order?(f.sortField=s.field,f.sortOrder=s.order.replace("end","")):(f.sortField="",f.sortOrder=""),k()};function q(){t.evaluationTemplateId!=null&&it(`/po/integrated/assessmentevaluation/template/templateCreate?id=${t.evaluationTemplateId}`,"查看评价模板")}function W(){var o;if(((o=m.value)==null?void 0:o.length)>0){let l;C({title:"提示",iconType:"warning",content:"确定要导出所有记录？",onOk(){return i(this,null,function*(){let s=[],c={};m.value.forEach(n=>{delete n.monthlyEvaluationDtlId,delete n.indexKind,delete n.evaluationMethod,s.push(n)}),g.value.forEach(n=>{c[n.dataIndex]=n.title}),mt({data:s,header:c,filename:"电站得分详情.xlsx"})})}})}else _t.info("无数据，不能导出。")}const $=()=>i(this,null,function*(){if(t.id!=null){let o=yield dt(t.id);B(t,o),K(o),V(),k()}}),K=o=>i(this,null,function*(){let{billCode:l,fillinDate:s,personMemberName:c,deptName:n}=o;Object.assign(u,{billCode:l,fillinDate:s,personMemberName:c,deptName:n})}),Q=()=>i(this,null,function*(){g.value=ut()});return et(()=>i(this,null,function*(){B(t,v),yield Q(),v.id&&$()})),(o,l)=>{const s=r("a-input"),c=r("a-form-item"),n=r("a-col"),X=r("a-date-picker"),S=r("a-row"),Z=r("a-select"),b=r("a-button"),j=r("a-card"),G=r("a-form"),H=r("a-table");return L(),P("div",ft,[I("div",vt,[I("div",gt,[e(lt,{options:u},null,8,["options"])]),I("div",yt,[e(G,{ref_key:"templateFormRef",ref:_,model:t,name:"Form"},{default:a(()=>[e(j,{title:"基础信息",bordered:!1},{default:a(()=>[e(S,{gutter:32},{default:a(()=>[x(e(n,{span:12},{default:a(()=>[e(c,{label:"主题",name:"subject",labelAlign:"right",labelCol:{span:4}},{default:a(()=>[e(s,{value:t.subject,"onUpdate:value":l[0]||(l[0]=d=>t.subject=d),disabled:"",style:{width:"100%"},maxlength:"128"},null,8,["value"])]),_:1})]),_:1},512),[[D,!0]]),x(e(n,{span:12},{default:a(()=>[e(c,{label:"评价周期",name:"evaluationPeriod",labelAlign:"right",labelCol:{span:4}},{default:a(()=>[e(X,{value:t.evaluationPeriod,"onUpdate:value":l[1]||(l[1]=d=>t.evaluationPeriod=d),"value-format":"YYYY-MM",disabled:"",style:{"min-width":"100%"},picker:"month"},null,8,["value"])]),_:1})]),_:1},512),[[D,!0]])]),_:1}),e(S,{gutter:32},{default:a(()=>[x(e(n,{span:12},{default:a(()=>[e(c,{label:"电站",name:"stationId",labelAlign:"right",rules:[{required:!0,message:"请输选择电站"}],labelCol:{span:4}},{default:a(()=>[e(Z,{value:t.stationId,"onUpdate:value":l[2]||(l[2]=d=>t.stationId=d),"allow-clear":"",placeholder:"请选择电站",options:M.value},null,8,["value","options"])]),_:1})]),_:1},512),[[D,!0]]),x(e(n,{span:12,style:{"text-align":"right"}},{default:a(()=>[e(b,{style:{"margin-right":"10px"},onClick:Y},{default:a(()=>[y("重置")]),_:1}),e(b,{type:"primary",onClick:z},{default:a(()=>[y("查询")]),_:1})]),_:1},512),[[D,!0]])]),_:1})]),_:1})]),_:1},8,["model"]),e(j,{title:"得分详情",bordered:!1},{extra:a(()=>[I("div",bt,[e(b,{class:"tab-button",preIcon:F(R).VIEW,onClick:q},{default:a(()=>[y("查看评价模板")]),_:1},8,["preIcon"]),e(b,{class:"tab-button",style:{"margin-right":"16px"},preIcon:F(R).DOWNLOAD,onClick:W},{default:a(()=>[y("导出")]),_:1},8,["preIcon"])])]),_:1}),e(H,{style:{margin:"0 8px"},columns:g.value,"data-source":m.value,pagination:!1,size:"small",bordered:"",scroll:{x:480,y:600},onChange:U,onResizeColumn:l[3]||(l[3]=(d,T)=>T.width=d)},{bodyCell:a(({column:d,text:T,record:N})=>[d.dataIndex==="weightScore"&&N.difference!=0?(L(),P(at,{key:0},[y(A(T)+"("+A(N.difference)+") ",1)],64)):ot("",!0)]),_:1},8,["columns","data-source"])])])])}}});const Qt=rt(ht,[["__scopeId","data-v-14d8d0f2"]]);export{Qt as default};
//# sourceMappingURL=stationDtl-8ad14ed9.js.map
