{"version":3,"file":"index-ff1695ff.js","sources":["../../src/views/hr/manage/oaleave/oaLeave.data.ts","../../src/views/hr/manage/oaleave/index.vue"],"sourcesContent":["import { assign, forEach } from 'min-dash';\nimport type { DescItem } from '@/components/Description';\nimport type { BasicColumn, FormSchema } from '@/components/Table';\nimport { useRender } from '@/components/Table';\n\nconst oaLeaveTypeOptions = [\n  {\n    dictType: 'bpm_oa_leave_type',\n    value: '1',\n    label: '病假',\n    colorType: 'primary',\n    cssClass: '',\n  },\n  {\n    dictType: 'bpm_oa_leave_type',\n    value: '2',\n    label: '事假',\n    colorType: 'info',\n    cssClass: '',\n  },\n  {\n    dictType: 'bpm_oa_leave_type',\n    value: '3',\n    label: '婚假',\n    colorType: 'warning',\n    cssClass: '',\n  },\n];\n\nconst bpmProcessInstanceResult = [\n  {\n    dictType: 'bpm_process_instance_result',\n    value: '0',\n    label: '草稿',\n    colorType: 'primary',\n    cssClass: '',\n  },\n  {\n    dictType: 'bpm_process_instance_result',\n    value: '1',\n    label: '处理中',\n    colorType: 'primary',\n    cssClass: '',\n  },\n  {\n    dictType: 'bpm_process_instance_result',\n    value: '2',\n    label: '通过',\n    colorType: 'success',\n    cssClass: '',\n  },\n  {\n    dictType: 'bpm_process_instance_result',\n    value: '3',\n    label: '不通过',\n    colorType: 'danger',\n    cssClass: '',\n  },\n  {\n    dictType: 'bpm_process_instance_result',\n    value: '4',\n    label: '已取消',\n    colorType: 'info',\n    cssClass: '',\n  },\n  {\n    dictType: 'bpm_process_instance_result',\n    value: '5',\n    label: '已终止',\n    colorType: 'info',\n    cssClass: '',\n  },\n  {\n    dictType: 'bpm_process_instance_result',\n    value: '6',\n    label: '退回/驳回',\n    colorType: 'info',\n    cssClass: '',\n  },\n];\n\nexport const columns: BasicColumn[] = [\n  {\n    title: '申请编号',\n    dataIndex: 'id',\n    width: 100,\n  },\n  {\n    title: '状态',\n    dataIndex: 'status',\n    width: 100,\n    customRender: ({ text }) => {\n      return getInstanceResult(text)['label'];\n      //return useRender.renderDict(text, DICT_TYPE.BPM_PROCESS_INSTANCE_RESULT);\n    },\n  },\n  {\n    title: '开始时间',\n    dataIndex: 'startTime',\n    width: 120,\n    customRender: ({ text }) => {\n      return useRender.renderDate(text);\n    },\n  },\n  {\n    title: '结束时间',\n    dataIndex: 'endTime',\n    width: 120,\n    customRender: ({ text }) => {\n      return useRender.renderDate(text);\n    },\n  },\n  {\n    title: '请假类型',\n    dataIndex: 'type',\n    width: 150,\n    customRender: ({ text }) => {\n      return getTypeObj(text)['label'];\n      //return useRender.renderDict(text, DICT_TYPE.BPM_OA_LEAVE_TYPE);\n    },\n  },\n  {\n    title: '原因',\n    dataIndex: 'reason',\n    width: 180,\n  },\n  {\n    title: '申请时间',\n    dataIndex: 'fillinDate',\n    width: 120,\n    customRender: ({ text }) => {\n      return useRender.renderDate(text);\n    },\n  },\n];\n\nexport const searchFormSchema: FormSchema[] = [\n  {\n    label: '请假类型',\n    field: 'type',\n    component: 'Select',\n    componentProps: {\n      // options: getDictOptions(DICT_TYPE.BPM_OA_LEAVE_TYPE),\n      options: oaLeaveTypeOptions,\n    },\n    colProps: { span: 8 },\n  },\n  {\n    label: '申请时间',\n    field: 'createTime',\n    component: 'RangePicker',\n    colProps: { span: 8 },\n    componentProps: {\n      showTime: true,\n      format: 'YYYY-MM-DD HH:mm:ss',\n      valueFormat: 'x',\n    },\n  },\n  {\n    label: '结果',\n    field: 'result',\n    component: 'Select',\n    componentProps: {\n      options: bpmProcessInstanceResult,\n      //options: getDictOptions(DICT_TYPE.BPM_PROCESS_INSTANCE_RESULT),\n    },\n    colProps: { span: 8 },\n  },\n  {\n    label: '原因',\n    field: 'reason',\n    component: 'Input',\n    colProps: { span: 8 },\n  },\n];\n\nexport const formSchema: FormSchema[] = [\n  {\n    label: '请假类型',\n    field: 'type',\n    required: true,\n    component: 'Select',\n    componentProps: {\n      // options: getDictOptions(DICT_TYPE.BPM_OA_LEAVE_TYPE),\n      options: oaLeaveTypeOptions,\n    },\n  },\n  {\n    label: '开始时间',\n    field: 'startTime',\n    required: true,\n    component: 'DatePicker',\n    componentProps: {\n      showTime: true,\n      format: 'YYYY-MM-DD HH:mm:ss',\n      valueFormat: 'x',\n    },\n  },\n  {\n    label: '结束时间',\n    field: 'endTime',\n    required: true,\n    component: 'DatePicker',\n    componentProps: {\n      showTime: true,\n      format: 'YYYY-MM-DD HH:mm:ss',\n      valueFormat: 'x',\n    },\n  },\n  {\n    label: '原因',\n    field: 'reason',\n    required: true,\n    component: 'Input',\n  },\n];\n\nexport const descSchema: DescItem[] = [\n  {\n    label: '请假类型',\n    field: 'merchantOrderId',\n    render: (curVal) => {\n      return useRender.renderTag(curVal);\n    },\n  },\n  {\n    label: '开始时间',\n    field: 'startTime',\n    render: (curVal) => {\n      return useRender.renderDate(curVal, 'YYYY-MM-DD');\n    },\n  },\n  {\n    label: '结束时间',\n    field: 'endTime',\n    render: (curVal) => {\n      return useRender.renderDate(curVal, 'YYYY-MM-DD');\n    },\n  },\n  {\n    label: '原因',\n    field: 'reason',\n  },\n];\n\nexport function getInstanceResult(value: any) {\n  const obj = {};\n  forEach(bpmProcessInstanceResult, function (def) {\n    if (def.value === value.toString()) {\n      assign(obj, def);\n    }\n  });\n  return obj;\n}\n\nexport function getTypeObj(type: any) {\n  const obj = {};\n  forEach(oaLeaveTypeOptions, function (def) {\n    if (def.value === type.toString()) {\n      assign(obj, def);\n    }\n  });\n  return obj;\n}\n\nexport function getTypeOption(type: any) {\n  const obj = {};\n  forEach(oaLeaveTypeOptions, function (def) {\n    if (def.label === type.toString()) {\n      assign(obj, def);\n    }\n  });\n  return obj;\n}\n","<script lang=\"ts\" setup>\n  import { onMounted } from 'vue';\n  import { ElMessageBox } from 'element-plus';\n  import { columns, searchFormSchema } from './oaLeave.data';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { useMessage } from '@/hooks/web/useMessage';\n  import { IconEnum } from '@/enums/appEnum';\n  import { BasicTable, useTable, TableAction } from '@/components/Table';\n  import { exportOaLeave, getOaLeavePage } from '@/api/hr/oaleave';\n  import { deleteProcessInstance } from '@/api/bpm/processInstance';\n  import { exportExcelFile } from '@/utils/file/download';\n  import { addTabPage } from '@/utils/route';\n  import { MsgManager } from '/@/message/MsgManager';\n\n  defineOptions({ name: 'OaLeave' });\n\n  const { t } = useI18n();\n  const { createConfirm, createMessage } = useMessage();\n\n  const [registerTable, { getForm, reload }] = useTable({\n    title: 'OA 请假申请列表',\n    api: getOaLeavePage,\n    columns,\n    formConfig: { labelWidth: 120, schemas: searchFormSchema },\n    useSearchForm: true,\n    showTableSetting: true,\n    actionColumn: {\n      width: 140,\n      title: t('common.operate'),\n      dataIndex: 'action',\n      fixed: 'right',\n    },\n  });\n\n  async function handleExport() {\n    createConfirm({\n      title: t('common.exportTitle'),\n      iconType: 'warning',\n      content: t('common.message.exportMessage'),\n      async onOk() {\n        await exportOaLeave(getForm().getFieldsValue()).then((res) => {\n          exportExcelFile(res?.data, 'OA 请假申请.xls');\n        });\n        createMessage.success(t('common.exportSuccessText'));\n      },\n    });\n  }\n\n  /** 添加操作 */\n  function handleCreate() {\n    addTabPage('/hr/manage/OALeaveCreate', '添加请假');\n  }\n\n  /** 取消请假操作 */\n  async function cancelLeave(row) {\n    const { value } = await ElMessageBox.prompt('请输入取消原因', '取消流程', {\n      confirmButtonText: t('common.ok'),\n      cancelButtonText: t('common.cancel'),\n      inputPattern: /^[\\s\\S]*.*\\S[\\s\\S]*$/, // 判断非空，且非空格\n      inputErrorMessage: '取消原因不能为空',\n    });\n    // 发起取消\n    await deleteProcessInstance(row.processInstanceId, value);\n    createMessage.success(t('common.delSuccessText'));\n    reload();\n  }\n\n  /** 审批进度 */\n  function handleProcessDetail(record: any) {\n    addTabPage('/hr/manage/OALeaveCreate', '请假详情', {\n      processInstanceId: record.processInstanceId,\n    });\n  }\n\n  onMounted(() => {\n    MsgManager.getInstance().listen('oaleave-page', reload);\n  });\n</script>\n<template>\n  <div>\n    <BasicTable @register=\"registerTable\">\n      <template #toolbar>\n        <a-button type=\"primary\" :pre-icon=\"IconEnum.ADD\" @click=\"handleCreate\">\n          发起请假\n        </a-button>\n        <a-button type=\"warning\" :preIcon=\"IconEnum.EXPORT\" @click=\"handleExport\">\n          {{ t('common.action.export') }}\n        </a-button>\n      </template>\n      <template #bodyCell=\"{ column, record }\">\n        <template v-if=\"column.key === 'action'\">\n          <TableAction\n            :actions=\"[\n              {\n                icon: IconEnum.LOG,\n                label: '进度',\n                onClick: handleProcessDetail.bind(null, record),\n              },\n              {\n                icon: IconEnum.DELETE,\n                danger: true,\n                label: '删除',\n                ifShow: () => {\n                  return record.status <= 1;\n                },\n                onClick: cancelLeave.bind(null, record),\n              },\n            ]\"\n          />\n        </template>\n      </template>\n    </BasicTable>\n  </div>\n</template>\n"],"names":["oaLeaveTypeOptions","bpmProcessInstanceResult","columns","text","getInstanceResult","useRender","getTypeObj","searchFormSchema","value","obj","forEach","def","assign","type","useI18n","createConfirm","createMessage","useMessage","registerTable","getForm","reload","useTable","getOaLeavePage","handleExport","__async","exportOaLeave","res","exportExcelFile","handleCreate","addTabPage","cancelLeave","row","ElMessageBox","deleteProcessInstance","handleProcessDetail","record","onMounted","MsgManager"],"mappings":"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"}