{"version":3,"file":"LockPage-8b0cf783.js","sources":["../../src/views/sys/lock/useNow.ts","../../src/views/sys/lock/LockPage.vue"],"sourcesContent":["import { dateUtil } from '/@/utils/dateUtil';\nimport { reactive, toRefs } from 'vue';\nimport { tryOnMounted, tryOnUnmounted } from '@vueuse/core';\n\nexport function useNow(immediate = true) {\n  let timer: IntervalHandle;\n\n  const state = reactive({\n    year: 0,\n    month: 0,\n    week: '',\n    day: 0,\n    hour: '',\n    minute: '',\n    second: 0,\n    meridiem: '',\n  });\n\n  const update = () => {\n    const now = dateUtil();\n\n    const h = now.format('HH');\n    const m = now.format('mm');\n    const s = now.get('s');\n\n    state.year = now.get('y');\n    state.month = now.get('M') + 1;\n    state.week = '星期' + ['日', '一', '二', '三', '四', '五', '六'][now.day()];\n    state.day = now.get('date');\n    state.hour = h;\n    state.minute = m;\n    state.second = s;\n\n    state.meridiem = now.format('A');\n  };\n\n  function start() {\n    update();\n    clearInterval(timer);\n    timer = setInterval(() => update(), 1000);\n  }\n\n  function stop() {\n    clearInterval(timer);\n  }\n\n  tryOnMounted(() => {\n    immediate && start();\n  });\n\n  tryOnUnmounted(() => {\n    stop();\n  });\n\n  return {\n    ...toRefs(state),\n    start,\n    stop,\n  };\n}\n","<template>\n  <div\n    :class=\"prefixCls\"\n    class=\"fixed inset-0 flex h-screen w-screen bg-black items-center justify-center\"\n  >\n    <div\n      :class=\"`${prefixCls}__unlock`\"\n      class=\"absolute top-0 left-1/2 flex pt-5 h-16 items-center justify-center sm:text-md xl:text-xl text-white flex-col cursor-pointer transform translate-x-1/2\"\n      @click=\"handleShowForm(false)\"\n      v-show=\"showDate\"\n    >\n      <LockOutlined />\n      <span>{{ t('sys.lock.unlock') }}</span>\n    </div>\n\n    <div class=\"flex w-screen h-screen justify-center items-center\">\n      <div :class=\"`${prefixCls}__hour`\" class=\"relative mr-5 md:mr-20 w-2/5 h-2/5 md:h-4/5\">\n        <span>{{ hour }}</span>\n        <span class=\"meridiem absolute left-5 top-5 text-md xl:text-xl\" v-show=\"showDate\">\n          {{ meridiem }}\n        </span>\n      </div>\n      <div :class=\"`${prefixCls}__minute w-2/5 h-2/5 md:h-4/5 `\">\n        <span> {{ minute }}</span>\n      </div>\n    </div>\n    <transition name=\"fade-slide\">\n      <div :class=\"`${prefixCls}-entry`\" v-show=\"!showDate\">\n        <div :class=\"`${prefixCls}-entry-content`\">\n          <div :class=\"`${prefixCls}-entry__header enter-x`\">\n            <img :src=\"userinfo.avatar || headerImg\" :class=\"`${prefixCls}-entry__header-img`\" />\n            <p :class=\"`${prefixCls}-entry__header-name`\">\n              {{ userinfo.realName }}\n            </p>\n          </div>\n          <InputPassword\n            :placeholder=\"t('sys.lock.placeholder')\"\n            class=\"enter-x\"\n            v-model:value=\"password\"\n          />\n          <span :class=\"`${prefixCls}-entry__err-msg enter-x`\" v-if=\"errMsg\">\n            {{ t('sys.lock.alert') }}\n          </span>\n          <div :class=\"`${prefixCls}-entry__footer enter-x`\">\n            <a-button\n              type=\"link\"\n              size=\"small\"\n              class=\"mt-2 mr-2 enter-x\"\n              :disabled=\"loading\"\n              @click=\"handleShowForm(true)\"\n            >\n              {{ t('common.back') }}\n            </a-button>\n            <a-button\n              type=\"link\"\n              size=\"small\"\n              class=\"mt-2 mr-2 enter-x\"\n              :disabled=\"loading\"\n              @click=\"goLogin\"\n            >\n              {{ t('sys.lock.backToLogin') }}\n            </a-button>\n            <a-button class=\"mt-2\" type=\"link\" size=\"small\" @click=\"unLock()\" :loading=\"loading\">\n              {{ t('sys.lock.entry') }}\n            </a-button>\n          </div>\n        </div>\n      </div>\n    </transition>\n\n    <div class=\"absolute bottom-5 w-full text-gray-300 xl:text-xl 2xl:text-3xl text-center enter-y\">\n      <div class=\"text-5xl mb-4 enter-x\" v-show=\"!showDate\">\n        {{ hour }}:{{ minute }} <span class=\"text-3xl\">{{ meridiem }}</span>\n      </div>\n      <div class=\"text-2xl\">{{ year }}/{{ month }}/{{ day }} {{ week }}</div>\n    </div>\n  </div>\n</template>\n<script lang=\"ts\" setup>\n  import { ref, computed } from 'vue';\n  import { Input } from 'ant-design-vue';\n  import { useUserStore } from '/@/store/modules/user';\n  import { useLockStore } from '/@/store/modules/lock';\n  import { useI18n } from '/@/hooks/web/useI18n';\n  import { useNow } from './useNow';\n  import { useDesign } from '/@/hooks/web/useDesign';\n  import { LockOutlined } from '@ant-design/icons-vue';\n  import headerImg from '/@/assets/images/header.jpg';\n\n  const InputPassword = Input.Password;\n\n  const password = ref('');\n  const loading = ref(false);\n  const errMsg = ref(false);\n  const showDate = ref(true);\n\n  const { prefixCls } = useDesign('lock-page');\n  const lockStore = useLockStore();\n  const userStore = useUserStore();\n\n  const { hour, month, minute, meridiem, year, day, week } = useNow(true);\n\n  const { t } = useI18n();\n\n  const userinfo = computed(() => {\n    return userStore.getUserInfo || {};\n  });\n\n  /**\n   * @description: unLock\n   */\n  async function unLock() {\n    if (!password.value) {\n      return;\n    }\n    let pwd = password.value;\n    try {\n      loading.value = true;\n      const res = await lockStore.unLock(pwd);\n      errMsg.value = !res;\n    } finally {\n      loading.value = false;\n    }\n  }\n\n  function goLogin() {\n    lockStore.resetLockInfo();\n  }\n\n  function handleShowForm(show = false) {\n    showDate.value = show;\n  }\n</script>\n<style lang=\"less\" scoped>\n  @prefix-cls: ~'@{namespace}-lock-page';\n\n  .@{prefix-cls} {\n    z-index: @lock-page-z-index;\n\n    &__unlock {\n      transform: translate(-50%, 0);\n    }\n\n    &__hour,\n    &__minute {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      border-radius: 30px;\n      background-color: #141313;\n      color: #bababa;\n      font-weight: 700;\n\n      @media screen and (max-width: @screen-md) {\n        span:not(.meridiem) {\n          font-size: 160px;\n        }\n      }\n\n      @media screen and (min-width: @screen-md) {\n        span:not(.meridiem) {\n          font-size: 160px;\n        }\n      }\n\n      @media screen and (max-width: @screen-sm) {\n        span:not(.meridiem) {\n          font-size: 90px;\n        }\n      }\n\n      @media screen and (min-width: @screen-lg) {\n        span:not(.meridiem) {\n          font-size: 220px;\n        }\n      }\n\n      @media screen and (min-width: @screen-xl) {\n        span:not(.meridiem) {\n          font-size: 260px;\n        }\n      }\n\n      @media screen and (min-width: @screen-2xl) {\n        span:not(.meridiem) {\n          font-size: 320px;\n        }\n      }\n    }\n\n    &-entry {\n      display: flex;\n      position: absolute;\n      top: 0;\n      left: 0;\n      align-items: center;\n      justify-content: center;\n      width: 100%;\n      height: 100%;\n      background-color: rgb(0 0 0 / 50%);\n      backdrop-filter: blur(8px);\n\n      &-content {\n        width: 260px;\n      }\n\n      &__header {\n        text-align: center;\n\n        &-img {\n          width: 70px;\n          margin: 0 auto;\n          border-radius: 50%;\n        }\n\n        &-name {\n          margin-top: 5px;\n          color: #bababa;\n          font-weight: 500;\n        }\n      }\n\n      &__err-msg {\n        display: inline-block;\n        margin-top: 10px;\n        color: @error-color;\n      }\n\n      &__footer {\n        display: flex;\n        justify-content: space-between;\n      }\n    }\n  }\n</style>\n"],"names":["useNow","immediate","timer","state","reactive","update","now","dateUtil","h","m","s","start","stop","tryOnMounted","tryOnUnmounted","__spreadProps","__spreadValues","toRefs","InputPassword","Input","password","ref","loading","errMsg","showDate","prefixCls","useDesign","lockStore","useLockStore","userStore","useUserStore","hour","month","minute","meridiem","year","day","week","t","useI18n","userinfo","computed","unLock","__async","pwd","res","goLogin","handleShowForm","show"],"mappings":"s/BAIgB,SAAAA,GAAOC,EAAY,GAAM,CACnC,IAAAC,EAEJ,MAAMC,EAAQC,EAAS,CACrB,KAAM,EACN,MAAO,EACP,KAAM,GACN,IAAK,EACL,KAAM,GACN,OAAQ,GACR,OAAQ,EACR,SAAU,EAAA,CACX,EAEKC,EAAS,IAAM,CACnB,MAAMC,EAAMC,KAENC,EAAIF,EAAI,OAAO,IAAI,EACnBG,EAAIH,EAAI,OAAO,IAAI,EACnBI,EAAIJ,EAAI,IAAI,GAAG,EAEfH,EAAA,KAAOG,EAAI,IAAI,GAAG,EACxBH,EAAM,MAAQG,EAAI,IAAI,GAAG,EAAI,EAC7BH,EAAM,KAAO,KAAO,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAG,EAAEG,EAAI,IAAK,CAAA,EAC3DH,EAAA,IAAMG,EAAI,IAAI,MAAM,EAC1BH,EAAM,KAAOK,EACbL,EAAM,OAASM,EACfN,EAAM,OAASO,EAETP,EAAA,SAAWG,EAAI,OAAO,GAAG,CAAA,EAGjC,SAASK,GAAQ,CACRN,IACP,cAAcH,CAAK,EACnBA,EAAQ,YAAY,IAAMG,EAAO,EAAG,GAAI,CAC1C,CAEA,SAASO,GAAO,CACd,cAAcV,CAAK,CACrB,CAEA,OAAAW,GAAa,IAAM,CACjBZ,GAAaU,EAAM,CAAA,CACpB,EAEDG,GAAe,IAAM,CACdF,GAAA,CACN,EAEMG,EAAAC,EAAA,GACFC,EAAOd,CAAK,GADV,CAEL,MAAAQ,EACA,KAAAC,CAAA,EAEJ,kSC8BE,MAAMM,EAAgBC,GAAM,SAEtBC,EAAWC,EAAI,EAAE,EACjBC,EAAUD,EAAI,EAAK,EACnBE,EAASF,EAAI,EAAK,EAClBG,EAAWH,EAAI,EAAI,EAEnB,CAAE,UAAAI,CAAA,EAAcC,GAAU,WAAW,EACrCC,EAAYC,KACZC,EAAYC,KAEZ,CAAE,KAAAC,EAAM,MAAAC,EAAO,OAAAC,EAAQ,SAAAC,EAAU,KAAAC,EAAM,IAAAC,EAAK,KAAAC,CAAA,EAASrC,GAAO,EAAI,EAEhE,CAAE,EAAAsC,GAAMC,KAERC,EAAWC,EAAS,IACjBZ,EAAU,aAAe,EACjC,EAKD,SAAea,GAAS,QAAAC,EAAA,sBAClB,GAAA,CAACvB,EAAS,MACZ,OAEF,IAAIwB,EAAMxB,EAAS,MACf,GAAA,CACFE,EAAQ,MAAQ,GAChB,MAAMuB,EAAM,MAAMlB,EAAU,OAAOiB,CAAG,EACtCrB,EAAO,MAAQ,CAACsB,CAAA,QAChB,CACAvB,EAAQ,MAAQ,EAClB,CACF,GAEA,SAASwB,GAAU,CACjBnB,EAAU,cAAc,CAC1B,CAES,SAAAoB,EAAeC,EAAO,GAAO,CACpCxB,EAAS,MAAQwB,CACnB"}