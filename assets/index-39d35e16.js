var x=(d,s,m)=>new Promise((w,y)=>{var l=c=>{try{g(m.next(c))}catch(v){y(v)}},e=c=>{try{g(m.throw(c))}catch(v){y(v)}},g=c=>c.done?w(c.value):Promise.resolve(c.value).then(l,e);g((m=m.apply(d,s)).next())});import{d as j,k as p,r as O,o as W,al as f,Z as X,a9 as Z,aa as r,$ as M,f as i,u as b,v as D,A as N,E as Y}from"./vue-71d1abb3.js";import{B as $}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as G}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{a0 as J,a5 as _,b as K,au as Q,av as ee,_ as te}from"./index.js";import{P as ae}from"./index-20519caf.js";import{e as ne}from"./download-03e71dd5.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";const le=[{title:"所属公司",dataIndex:"stationOrganName",width:150,resizable:!0,headAlign:"center",align:"left",customCell:d=>({rowSpan:d.rowOrgSpan}),ifShow:J().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",width:150,headAlign:"center",align:"left",resizable:!0},{title:"计划停运",dataIndex:"",resizable:!0,children:[{title:"停运次数",dataIndex:"planNum",headAlign:"center",align:"right",width:100,resizable:!0},{title:"停运时长(小时)",dataIndex:"planHour",width:100,headAlign:"center",align:"right",customRender:({text:d,record:s})=>s.planHour.toFixed(2),resizable:!0}]},{title:"非计划停运",dataIndex:"",resizable:!0,children:[{title:"停运次数",dataIndex:"unPlannedNum",headAlign:"center",align:"right",width:100,resizable:!0},{title:"停运时长(小时)",dataIndex:"unPlannedHour",width:100,headAlign:"center",align:"right",customRender:({text:d,record:s})=>s.unPlannedHour.toFixed(2),resizable:!0}]},{title:"停运总时长(小时)",dataIndex:"sumHour",width:150,headAlign:"center",align:"right",customRender:({text:d,record:s})=>(s.planHour+s.unPlannedHour).toFixed(2),resizable:!0},{title:"日报停运损失电量(kWh)",headAlign:"center",align:"right",dataIndex:"sumLossElec",width:150,resizable:!0},{title:"占比本期上网电量",dataIndex:"",width:150,headAlign:"center",align:"right",customRender:({text:d,record:s})=>{if(s.sumOnlineElec!=0)return(s.sumLossElec/s.sumOnlineElec*100).toFixed(2)+"%"},resizable:!0}],oe=d=>_.download({url:"/bi/maintenance/export-excel",params:d},{isReturnNativeResponse:!0}),se={class:"fix-basic-table"},ie={class:"tab-button-div"},re={class:"tab-table-div"},ue=j({__name:"index",setup(d){const{t:s}=K();p(!1);const m=p([]),w=p([]);let y=p([{label:"年度",value:"year"},{label:"月度",value:"month"},{label:"月度范围",value:"monthRange"}]);const l=O({searchMonth:null,searchDate:null}),e=O({ognId:null,stationId:null,dateCycle:"year",yearValue:new Date().getFullYear()+"",month:null,startMonth:null,endMonth:null,startDate:null,endDate:null}),g=p([]),c=()=>x(this,null,function*(){let a=yield v(e);return e.stationId!=null&&(e.stationId=e.stationId.split("|"),e.stationName=e.stationName.split("|")),g.value=a,a}),v=a=>_.get({url:"/bi/maintenance/powerCut",params:a},{isOnlyResult:!0}),R=a=>_.get({url:"/bi/common/station/info",params:a},{}),F=a=>_.get({url:"/bi/common/org/info",params:a},{});function z(a,t){a.length==0&&(e.stationId=void 0,e.stationName=void 0)}function A(){R({}).then(a=>{a.result&&a.result.length>0&&a.result.forEach(t=>{m.value.push({value:t.stationName,lable:t.id})})}),F({}).then(a=>{a.result&&a.result.length>0&&a.result.forEach(t=>{w.value.push({value:t.label,lable:t.value})})})}W(()=>x(this,null,function*(){A()}));const[E,{reload:k,redoHeight:de}]=G({title:"检修停电统计",api:c,columns:le,useSearchForm:!1,bordered:!0,pagination:!1,showIndexColumn:!1,showTableSetting:!1,tableSetting:{fullScreen:!0},afterFetch:function(a){const t={};for(let n=0;n<a.length;n++){const o=a[n];if(t[o.stationOrganId]){t[o.stationOrganId]++;continue}t[o.stationOrganId]=1}for(let n=0;n<a.length;n++){const o=a[n];for(const h in t)o.stationOrganId===h&&(o.rowOrgSpan=t[h],t[h]=0)}return a}});function S(){e.ognId=null,e.stationId=void 0,e.ognName=null,e.stationName=void 0,e.dateCycle="year",e.yearValue=new Date().getFullYear()+"",e.startMonth=null,e.endMonth=null,e.startDate=null,e.endDate=null,l.searchDate=null,l.searchMonth=null,k()}const I=p();function H(){let a=[],t=[];I.value&&I.value.validateFields().then(()=>{if(Array.isArray(e.stationName))if(e.stationName.forEach(n=>{n.option!=null&&(a.push(n.option.value),t.push(n.option.lable))}),a.length>0){let n=a.join("|"),o=t.join("|");e.stationId=o,e.stationName=n}else{let n=e.stationName.join("|"),o=e.stationId.join("|");e.stationId=o,e.stationName=n}l.searchMonth!=null&&(e.startMonth=l.searchMonth[0],e.endMonth=l.searchMonth[1]),l.searchDate!=null&&(e.startDate=l.searchDate[0],e.endDate=l.searchDate[1]),k()})}const T=()=>{e.startMonth=null,e.endMonth=null,e.startDate=null,e.endDate=null,l.searchMonth!=null&&(e.startMonth=l.searchMonth[0],e.endMonth=l.searchMonth[1]),l.searchDate!=null&&(e.startDate=l.searchDate[0],e.endDate=l.searchDate[1])},{createConfirm:P,createMessage:V}=Q();function q(){P({title:s("common.message.confirmTitle"),iconType:"warning",content:s("common.message.exportMessage"),onOk(){return x(this,null,function*(){const t=e;t.filename="检修停电统计.xls",yield oe(t).then(n=>{ne(n==null?void 0:n.data,t.filename)}),t.filename=null,V.success(s("common.exportSuccessText"))})}})}return(a,t)=>{const n=f("a-select"),o=f("a-form-item"),h=f("a-date-picker"),L=f("a-range-picker"),C=f("a-button"),U=f("a-form");return X(),Z(b(ae),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:r(()=>[M("div",se,[M("div",ie,[i(U,{model:e,name:"searchInfo",layout:"inline",autocomplete:"off",class:"search-form",ref_key:"searchFormRef",ref:I},{default:r(()=>[i(o,{label:"时间纬度",name:"dateCycle",rules:[{required:!0,max:30}],labelCol:{span:15},style:{width:"26.5%"}},{default:r(()=>[i(n,{value:e.dateCycle,"onUpdate:value":t[0]||(t[0]=u=>e.dateCycle=u),"allow-clear":"",options:b(y),style:{width:"100%"}},null,8,["value","options"])]),_:1}),D(i(o,{name:"yearValue",label:"年度",labelCol:{span:6},rules:[{required:e.dateCycle=="year",message:"请选择年度"}],style:{width:"26.5%"}},{default:r(()=>[i(h,{value:e.yearValue,"onUpdate:value":t[1]||(t[1]=u=>e.yearValue=u),"value-format":"YYYY",style:{width:"100%"},picker:"year"},null,8,["value"])]),_:1},8,["rules"]),[[N,e.dateCycle=="year"]]),D(i(o,{name:"month",label:"月度",labelCol:{span:6},rules:[{required:e.dateCycle=="month",message:"请选择月份"}],style:{width:"26.5%"}},{default:r(()=>[i(h,{value:e.month,"onUpdate:value":t[2]||(t[2]=u=>e.month=u),"value-format":"YYYY-MM",style:{width:"100%"},picker:"month"},null,8,["value"])]),_:1},8,["rules"]),[[N,e.dateCycle=="month"]]),D(i(o,{name:"startMonth",label:"月度范围",labelCol:{span:6},rules:[{required:e.dateCycle=="monthRange",message:"请选择月份"}],style:{width:"26.5%"}},{default:r(()=>[i(L,{value:l.searchMonth,"onUpdate:value":t[3]||(t[3]=u=>l.searchMonth=u),format:"YYYY-MM","value-format":"YYYY-MM",style:{width:"100%"},picker:"month",onChange:T},null,8,["value"])]),_:1},8,["rules"]),[[N,e.dateCycle=="monthRange"]]),i(o,{name:"stationName",label:"电站",labelCol:{span:6},rules:[{required:!1,message:"请选择电站"}],style:{width:"26.5%"}},{default:r(()=>[i(n,{value:e.stationName,"onUpdate:value":t[4]||(t[4]=u=>e.stationName=u),"show-search":"","allow-clear":"",mode:"multiple",style:{width:"100%"},placeholder:"请选择电站",options:m.value,onChange:z,labelInValue:"","max-tag-count":"responsive"},null,8,["value","options"])]),_:1}),i(o,{class:"tab-button"},{default:r(()=>[i(C,{style:{margin:"0 8px"},onClick:S},{default:r(()=>[Y("重置")]),_:1}),i(C,{type:"primary",class:"tab-button",onClick:H},{default:r(()=>[Y("查询")]),_:1})]),_:1})]),_:1},8,["model"])]),M("div",re,[i(b($),{onRegister:b(E),onResizeColumn:t[5]||(t[5]=(u,B)=>B.width=u)},{toolbar:r(()=>[i(C,{class:"yellow-btn",preIcon:b(ee).EXPORT,onClick:q},{default:r(()=>[Y("导出")]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])])])]),_:1})}}});const Se=te(ue,[["__scopeId","data-v-95faf2ec"]]);export{Se as default};
//# sourceMappingURL=index-39d35e16.js.map
