var f=(e,o,r)=>new Promise((u,n)=>{var p=a=>{try{s(r.next(a))}catch(t){n(t)}},h=a=>{try{s(r.throw(a))}catch(t){n(t)}},s=a=>a.done?u(a.value):Promise.resolve(a.value).then(p,h);s((r=r.apply(e,o)).next())});import{B as y}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as I}from"./useTable-109483b3.js";import{K as Y}from"./antd-15ac76ed.js";import{a0 as w,a5 as m,b as z,au as S,av as C}from"./index.js";import{e as v}from"./download-03e71dd5.js";import{P as O}from"./index-20519caf.js";import{d as M,r as R,al as P,Z as D,a9 as T,aa as b,f as g,u as c,E as _,ad as F}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";const k=e=>m.post({url:"/bi/elec/export-environmental",params:e,responseType:"blob"},{isReturnNativeResponse:!0}),E=e=>m.get({url:"/bi/elec/environmental",params:e},{isOnlyResult:!0}),W=e=>m.get({url:"/bi/common/org/info",params:e},{isOnlyResult:!0}),B=e=>m.post({url:"/baseset/common/list-station",params:e}),N={labelWidth:120,actionColOptions:{span:24},autoAdvancedLine:1,showAdvancedButton:!0,baseColProps:{span:7},autoSubmitOnEnter:!0,noHideBtnFlag:!0,schemas:[{field:"dateCycle",label:"时间维度",component:"Select",required:!0,defaultValue:"year",componentProps:{options:[{value:"year",label:"年份"},{value:"month",label:"月份"},{value:"day",label:"自然日"}]}},{field:"yearValue",label:"年份",component:"YearPicker",defaultValue:Y(new Date).format("YYYY"),componentProps:{format:"YYYY",valueFormat:"YYYY",style:{width:"100%"}},show:({values:e})=>e.dateCycle=="year",dynamicRules:({values:e})=>e.dateCycle=="year"?[{required:!0,message:"年份必填"}]:[]},{field:"[startMonth, endMonth]",label:"月份",component:"RangePicker",componentProps:{picker:"month",format:"YYYY-MM",valueFormat:"YYYY-MM",style:{width:"100%"},placeholder:["开始月份","结束月份"]},show:({values:e})=>e.dateCycle=="month",dynamicRules:({values:e})=>e.dateCycle=="month"?[{required:!0,message:"月份必填"}]:[]},{field:"[startDate, endDate]",label:"时间段",component:"RangePicker",componentProps:{format:"YYYY-MM-DD",style:{width:"100%"},valueFormat:"YYYY-MM-DD",placeholder:["开始时间","结束时间"]},show:({values:e})=>e.dateCycle=="day",dynamicRules:({values:e})=>e.dateCycle=="day"?[{required:!0,message:"时间段必填"}]:[]},{field:"orgId",label:"所属公司",component:"ApiSelect",componentProps:{options:[],api:W,placeholder:"请选择所属公司"},show:w().isMultiOrganization},{field:"stationId",label:"电站名称",component:"ApiSelect",componentProps:{options:[],api:()=>f(void 0,null,function*(){const e=yield B({}),o=[];return e.result.forEach(r=>{o.push({value:r.powerStationId,label:r.powerStationName})}),o}),placeholder:"请输入电站名称"}}]},x=[{title:"所属公司",dataIndex:"stationOrganName",width:150,customCell:e=>({rowSpan:e.rowOrgSpan}),resizable:!0,ifShow:w().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",width:150,resizable:!0},{title:"并网容量(MW)",dataIndex:"connectCapacity",width:150,resizable:!0},{title:"辐照量(万KJ/m²)",dataIndex:"dayRadiation",children:[{title:"辐照量",dataIndex:"radiation",width:100,resizable:!0},{title:"同比(%)",dataIndex:"tbRadiation",width:100,resizable:!0}]},{title:"天气情况",dataIndex:"weather",children:[{title:"晴天天数",dataIndex:"dayWeather",width:100,resizable:!0},{title:"平均风速",dataIndex:"avgWind",width:100,resizable:!0},{title:"同比",dataIndex:"tbWind",width:100,resizable:!0},{title:"平均温度",dataIndex:"avgTemp",width:100,resizable:!0},{title:"同比",dataIndex:"tbTemp",width:100,resizable:!0},{title:"最高温度",dataIndex:"maxTemp",width:100,resizable:!0},{title:"最大风速",dataIndex:"maxWind",width:100,resizable:!0}]},{title:"千瓦发电量(kwh)",dataIndex:"dayDwfd",children:[{title:"千瓦发电量",dataIndex:"dwfd",width:100,resizable:!0},{title:"同比",dataIndex:"tbDwfd",width:100,resizable:!0}]},{title:"能效指标",dataIndex:"daySys",children:[{title:"系统效率(%)",dataIndex:"sys",width:100,resizable:!0},{title:"同比",dataIndex:"tbSys",width:100,resizable:!0},{title:"利用小时数(h)",dataIndex:"uth",width:100,resizable:!0},{title:"同比",dataIndex:"tbUth",width:100,resizable:!0}]}],me=M({__name:"index",setup(e){const{t:o}=z(),{createConfirm:r,createMessage:u}=S(),n=R({});function p(){r({title:o("common.message.confirmTitle"),iconType:"warning",content:o("common.message.exportMessage"),onOk(){return f(this,null,function*(){Object.assign(n,s().getFieldsValue()),n.filename="环境资源统计.xls",n.excelList=x,yield k(n).then(t=>{v(t==null?void 0:t.data,n.filename)}),n.filename=null,n.excelList=null,u.success(o("common.exportSuccessText"))})}})}const[h,{getForm:s}]=I({title:"环境资源统计",api:E,columns:x,formConfig:N,useSearchForm:!0,bordered:!0,pagination:!1,showIndexColumn:!0,showTableSetting:!0,tableSetting:{redo:!1,size:!1,setting:!1,fullScreen:!1},afterFetch:function(a){const t={};for(let i=0;i<a.length;i++){const l=a[i];t[l.stationOrganId]&&t[l.stationOrganId]++,t[l.stationOrganId]||(t[l.stationOrganId]=1)}for(let i=0;i<a.length;i++){const l=a[i];for(const d in t)l.stationOrganId===d&&(l.rowOrgSpan=t[d],t[d]=0)}return a}});return(a,t)=>{const i=P("a-button");return D(),T(c(O),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:b(()=>[g(c(y),{onRegister:c(h),onResizeColumn:t[0]||(t[0]=(l,d)=>d.width=l)},{toolbar:b(()=>[g(i,{class:"yellow-btn",preIcon:c(C).EXPORT,onClick:p},{default:b(()=>[_(F(c(o)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])]),_:1})}}});export{me as default};
//# sourceMappingURL=index-bf381db3.js.map
