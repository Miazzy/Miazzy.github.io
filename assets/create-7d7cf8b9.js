var h=(m,I,c)=>new Promise((v,_)=>{var g=d=>{try{e(c.next(d))}catch(f){_(f)}},u=d=>{try{e(c.throw(d))}catch(f){_(f)}},e=d=>d.done?v(d.value):Promise.resolve(d.value).then(g,u);e((c=c.apply(m,I)).next())});import{P as B}from"./index-20519caf.js";import{a5 as F,a0 as z,aj as O,aB as P,aD as A,at as S,a7 as R,aC as Y}from"./index.js";import{S as j}from"./SearchBox-22bb02d6.js";import{B as H}from"./BillTitle-d17ab3e4.js";import{W as V}from"./WfApproveBox-a3448232.js";import{U as W}from"./UploadBox-636ecf02.js";import{d as K,J as L,e as J,k as D,r as U,o as Z,al as p,Z as $,a9 as E,aa as s,$ as y,f as a,u as w}from"./vue-71d1abb3.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./antd-15ac76ed.js";import"./index.esm-c216ed00.js";import"./index-fda2d66c.js";import"./BasicTable-0434a334.js";import"./useForm-dea3ed18.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-f4fc48e6.js";import"./index-316f6ffb.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./Dialog-0a006d82.js";import"./OrganDialog-dd1023ce.js";import"./uniqBy-92d3bc7f.js";import"./index-085d06c7.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useTable-109483b3.js";import"./index-c0893416.js";import"./index-33af41d1.js";import"./tree-fc0e156a.js";const G="/po/safety-tools/pageView";function Q(m){return F.get({url:"/po/safety-tools-scrap/get",params:m})}function X(m){return F.post({url:"/po/safety-tools-scrap/create",params:m})}const ee=[{title:"工器具编号",dataIndex:"code",width:80},{title:"工器具名称",dataIndex:"name",width:80},{title:"规格型号",dataIndex:"specification",width:80}],ae={class:"load"},te={class:"process-box"},se={class:"header-box"},le={class:"content"},Pe=K({__name:"create",setup(m){const I=z(),c=L(I.getUserInfo),v=J(()=>e.status!=0||e.status==0&&e.personMemberId!=""&&e.personMemberId.substring(0,32)!=c.userId),_=D(""),g=D();let{params:u}=O();const e=U({id:u.id||"",status:0,stationOrganId:u.stationOrganId||"",stationOrganName:u.stationOrganName||"",stationId:u.stationId||"",stationName:u.stationName||"",safetyToolsId:"",name:"",scrapDate:"",personMemberId:"",remark:"",billCode:"",spinning:!1,fillinDate:"",materialCode:"",materialFullName:"",code:"",specification:"",factoryName:"",supplierName:"",productionDate:"",bizFileId:""}),d=()=>{e.spinning=!0,X(e).then(n=>{n.result!=""?(e.id=n.result,S.getInstance().success(e.status==1?"提交成功":"保存成功"),e.status==1&&setTimeout(()=>{R.getInstance().sendMsg("safety-tools-scrap",{}),Y()},100)):(e.status=0,S.getInstance().error("保存失败.")),e.spinning=!1}).catch(n=>{e.status=0,e.spinning=!1,console.log(n)})},f=U({subject:"工器具报废"}),N={handleAgree:n=>{console.log("同意",n)},handleSave:n=>{console.log("保存",n),e.status=0,d()},handleSubmit:n=>{console.log("提交",n),e.status=1;const t=g.value;t&&t.validateFields().then(()=>{d()}).catch(l=>{console.log(l),e.status=0})}},M=(n,t)=>{let l=t.record;e.materialCode=l.materialCode,e.materialFullName=l.materialFullName,e.code=l.code,e.name=l.name,e.specification=l.specification,e.factoryName=l.factoryName,e.supplierName=l.supplierName,e.productionDate=l.productionDate,e.safetyToolsId=l.key};return Z(()=>h(this,null,function*(){if(_.value=u.processInstanceId,!e.id&&u.processInstanceId){const b=yield P(u.processInstanceId);e.id=b.businessKey}const t=(yield Q({id:e.id})).result;if(e.id){for(let b in t)e[b]=t[b];e.status=Number(e.status)}else e.billCode=t.billCode,e.personMemberName=t.personMemberName,e.deptName=t.deptName,e.fillinDate=t.fillinDate,e.bizFileId=A();let{billCode:l,fillinDate:i,personMemberName:r,deptName:x}=t;Object.assign(f,{billCode:l,fillinDate:i,personMemberName:r,deptName:x})})),(n,t)=>{const l=p("a-input"),i=p("a-form-item"),r=p("a-col"),x=p("a-date-picker"),b=p("a-textarea"),q=p("a-row"),C=p("a-card"),k=p("a-form"),T=p("a-spin");return $(),E(w(B),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:s(()=>[y("div",ae,[a(T,{spinning:e.spinning,tip:"Loading..."},{default:s(()=>[y("div",te,[y("div",se,[a(H,{options:f},null,8,["options"]),a(V,{processInstanceId:_.value,onAgree:N.handleAgree,onSave:N.handleSave,onSubmit:N.handleSubmit,processStatus:e.status,listenMessage:"safety-tools-scrap"},null,8,["processInstanceId","onAgree","onSave","onSubmit","processStatus"])]),y("div",le,[a(k,{model:e,name:"basic",ref_key:"formRef",ref:g,autocomplete:"off",onFinish:d},{default:s(()=>[a(C,{title:"基本信息",bordered:!1},{default:s(()=>[a(q,{gutter:32},{default:s(()=>[a(r,{span:12},{default:s(()=>[a(i,{label:"电站名称",name:"stationName",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:s(()=>[a(l,{value:e.stationName,"onUpdate:value":t[0]||(t[0]=o=>e.stationName=o),disabled:""},null,8,["value"])]),_:1})]),_:1}),a(r,{span:12},{default:s(()=>[a(i,{label:"工器具名称",name:"safetyToolsId",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"工器具名称不能为空。"}]},{default:s(()=>[a(j,{value:e.name,"onUpdate:value":t[1]||(t[1]=o=>e.name=o),columns:w(ee),disabled:v.value,api:w(G),searchKey:"queryParam",apiParamFunc:()=>({stationId:e.stationId}),pagination:!0,style:{width:"100%"},onChange:M},null,8,["value","columns","disabled","api","apiParamFunc"])]),_:1})]),_:1}),a(r,{span:12},{default:s(()=>[a(i,{label:"物料编码",name:"materialCode",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:s(()=>[a(l,{value:e.materialCode,"onUpdate:value":t[2]||(t[2]=o=>e.materialCode=o),disabled:"true"},null,8,["value"])]),_:1})]),_:1}),a(r,{span:12},{default:s(()=>[a(i,{label:"物料全称",name:"materialFullName",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:s(()=>[a(l,{value:e.materialFullName,"onUpdate:value":t[3]||(t[3]=o=>e.materialFullName=o),disabled:"true"},null,8,["value"])]),_:1})]),_:1}),a(r,{span:12},{default:s(()=>[a(i,{label:"工器具编码",name:"code",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:s(()=>[a(l,{value:e.code,"onUpdate:value":t[4]||(t[4]=o=>e.code=o),disabled:"true"},null,8,["value"])]),_:1})]),_:1}),a(r,{span:12},{default:s(()=>[a(i,{label:"规格型号",name:"specification",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:s(()=>[a(l,{value:e.specification,"onUpdate:value":t[5]||(t[5]=o=>e.specification=o),disabled:"true"},null,8,["value"])]),_:1})]),_:1}),a(r,{span:12},{default:s(()=>[a(i,{label:"生产厂家",name:"factoryName",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:s(()=>[a(l,{value:e.factoryName,"onUpdate:value":t[6]||(t[6]=o=>e.factoryName=o),disabled:"true"},null,8,["value"])]),_:1})]),_:1}),a(r,{span:12},{default:s(()=>[a(i,{label:"供应商",name:"supplierName",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:s(()=>[a(l,{value:e.supplierName,"onUpdate:value":t[7]||(t[7]=o=>e.supplierName=o),disabled:"true"},null,8,["value"])]),_:1})]),_:1}),a(r,{span:12},{default:s(()=>[a(i,{label:"生产日期",name:"productionDate",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:s(()=>[a(l,{value:e.productionDate,"onUpdate:value":t[8]||(t[8]=o=>e.productionDate=o),disabled:"true"},null,8,["value"])]),_:1})]),_:1}),a(r,{span:12},{default:s(()=>[a(i,{label:"报废时间",name:"scrapDate",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"报废时间不能为空"}]},{default:s(()=>[a(x,{value:e.scrapDate,"onUpdate:value":t[9]||(t[9]=o=>e.scrapDate=o),valueFormat:"YYYY-MM-DD",style:{width:"100%"},disabled:v.value},null,8,["value","disabled"])]),_:1})]),_:1}),a(r,{span:24},{default:s(()=>[a(i,{label:"报废说明",name:"remark",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"报废说明不能为空"}]},{default:s(()=>[a(b,{value:e.remark,"onUpdate:value":t[10]||(t[10]=o=>e.remark=o),row:"3",autosize:{minRows:13,maxRows:13},disabled:v.value,maxlength:"1024"},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),a(C,{title:"附件上传",bordered:!1},{default:s(()=>[a(W,{width:800,height:550,maxCount:20,maxSize:100*1024*1024,application:"po",module:"safetytoolsscrap",vmode:e.status==0?"box":"view",bizId:e.bizFileId},null,8,["vmode","bizId"])]),_:1})])])]),_:1},8,["spinning"])])]),_:1})}}});export{Pe as default};
//# sourceMappingURL=create-7d7cf8b9.js.map
