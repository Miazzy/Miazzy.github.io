var J=Object.defineProperty;var T=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var S=(a,t,o)=>t in a?J(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o,A=(a,t)=>{for(var o in t||(t={}))Q.call(t,o)&&S(a,o,t[o]);if(T)for(var o of T(t))X.call(t,o)&&S(a,o,t[o]);return a};var x=(a,t,o)=>new Promise((p,b)=>{var c=l=>{try{h(o.next(l))}catch(m){b(m)}},C=l=>{try{h(o.throw(l))}catch(m){b(m)}},h=l=>l.done?p(l.value):Promise.resolve(l.value).then(c,C);h((o=o.apply(a,t)).next())});import{B as P}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as w}from"./useTable-109483b3.js";import{b1 as Y}from"./antd-15ac76ed.js";import{a5 as R,I as ee,_ as te}from"./index.js";import{P as ae}from"./index-20519caf.js";import{C as D}from"./CommonTree-c4ed7838.js";import{g as oe}from"./index-33af41d1.js";import{n as f,d as ne,r as re,k as F,o as se,al as K,Z as ie,a9 as le,aa as u,$ as _,f as i,u as g}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";const de=a=>R.get({url:"/system/auth/info/getRolePage",params:a},{isOnlyResult:!0}),ue=a=>R.get({url:"/system/auth/info/getFunctionPage",params:a},{isOnlyResult:!0}),ce=a=>R.get({url:"/system/auth/info/getDataPage",params:a},{isOnlyResult:!0}),me=()=>{const a={pageNo:1,pageSize:200,orgKindId:"pos"};return R.get({url:"/system/org-type/page",params:a},{isOnlyResult:!0})},ge=[{title:"编码",dataIndex:"code",align:"center",minWidth:100,sorter:!0,resizable:!0},{title:"名称",dataIndex:"name",headAlign:"center",align:"left",minWidth:200,sorter:!0,resizable:!0}],pe=[{title:"序号",dataIndex:" ",align:"center",width:50,maxWidth:50,customRender:({index:a})=>a+1},{title:"功能名称",dataIndex:"name",headAlign:"center",align:"left",minWidth:200,resizable:!0,customRender:({text:a,record:t})=>{const o={class:["function-expand-icon"]};return t.icon?f("div",o,[f(ee,{icon:t.icon}),f("span",a)]):f("div",o,a)}},{title:"权限",dataIndex:"permissionName",headAlign:"center",align:"left",minWidth:320,resizable:!0,customRender:({text:a})=>{const t=a?a.split(","):[];if(t){const o={class:["permission-name-tag"]};return f("div",null,[t.map(p=>f(Y,o,()=>p))])}return""}}],fe=[{title:"数据范围",dataIndex:"dataScope",headAlign:"center",align:"left",minWidth:100,sorter:!0,resizable:!0,customRender:({record:a})=>a.dataScopeText},{title:"组织/电站权限",dataIndex:"name",headAlign:"center",align:"left",minWidth:100,sorter:!0,resizable:!0}],be={baseColProps:{span:8},labelWidth:120,autoAdvancedLine:1,schemas:[{field:"code",label:"编码",component:"Input"},{field:"name",label:"名称",component:"Input"}]},he={baseColProps:{span:8},labelWidth:120,autoAdvancedLine:1,schemas:[{field:"fullName",label:"功能名称",component:"Input"}]},ve={baseColProps:{span:8},labelWidth:120,autoAdvancedLine:1,schemas:[{field:"dataScope",label:"数据范围",component:"DictSelectBox",componentProps:{type:"system_data_scope"}}]},_e={class:"tab-model"},ye={class:"tab-table-div tab-table-left"},Fe={class:"tab-tree-layout"},Re={class:"tab-tree-layout"},Ce={class:"tab-table-div tab-table-right"},Ie=ne({__name:"index",setup(a){const t=re({type:"org",role:{},function:{},data:{}}),o=F([]),p=F([]),b=F("1"),c=F("1"),C=e=>e==="role"?k():e==="function"?V():e==="data"?M():{},h=e=>e==="role"?W().getFieldsValue():e==="function"?N().getFieldsValue():e==="data"?U().getFieldsValue():{},l=e=>{const n=h(e);let r=A({},n);const s=C(e);return r.pageNo=s==null?void 0:s.current,r.pageSize=s==null?void 0:s.pageSize,r.orgId=t.orgId,r.posId=t.posId,r.type=t.type,r.sortField=t[e].sortField,r.sortOrder=t[e].sortOrder,r},m=e=>x(this,null,function*(){const n=l(e);return e==="role"?yield de(n):e==="function"?yield ue(n):e==="data"?yield ce(n):{list:[],total:0}}),I=(e,n)=>{var s;const r=(s=e.order)==null?void 0:s.replace("end","");t[n].sortOrder=r,t[n].sortField=r?e.field:void 0},[z,{reload:O,getForm:W,getPaginationRef:k}]=w({api:()=>m("role"),rowKey:"id",columns:ge,useSearchForm:!0,formConfig:be,showTableSetting:!1,bordered:!0,sortFn:e=>I(e,"role")}),[B,{reload:L,getForm:N,getPaginationRef:V}]=w({api:()=>m("function"),rowKey:"id",columns:pe,useSearchForm:!0,formConfig:he,isTreeTable:!0,showIndexColumn:!1,pagination:!1,showTableSetting:!1,bordered:!0,sortFn:e=>I(e,"function")}),[H,{reload:E,getForm:U,getPaginationRef:M}]=w({api:()=>m("data"),rowKey:"id",columns:fe,useSearchForm:!0,formConfig:ve,showTableSetting:!1,bordered:!0,sortFn:e=>I(e,"data")}),y=()=>{c.value==="1"&&O(),c.value==="2"&&L(),c.value==="3"&&E()},Z=e=>{t.type="org",t.orgId=null,e&&(t.orgId=e.fullId),y()},$=e=>{t.type=e==="1"?"org":"pos",y()},j=()=>{y()},q=e=>{t.type="pos",t.posId=null,e&&(t.posId=e.id),y()},G=()=>x(this,null,function*(){o.value=yield oe({orgKindIds:"ogn,dpt,pos,psm",showPosition:!0}),p.value=(yield me()).list});return se(()=>{G()}),(e,n)=>{const r=K("a-tab-pane"),s=K("a-tabs");return ie(),le(g(ae),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:u(()=>[_("div",_e,[_("div",ye,[i(s,{activeKey:b.value,"onUpdate:activeKey":n[0]||(n[0]=d=>b.value=d),onChange:$},{default:u(()=>[i(r,{key:"1",tab:"组织"},{default:u(()=>[_("div",Fe,[i(D,{title:"组织树",value:o.value,toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"},onSelect:Z,class:"tab-tree"},null,8,["value"])])]),_:1}),i(r,{key:"2",tab:"标准岗","force-render":""},{default:u(()=>[_("div",Re,[i(D,{title:"标准岗树",value:p.value,toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"},onSelect:q,class:"tab-tree"},null,8,["value"])])]),_:1})]),_:1},8,["activeKey"])]),_("div",Ce,[i(s,{activeKey:c.value,"onUpdate:activeKey":n[4]||(n[4]=d=>c.value=d),onChange:j},{default:u(()=>[i(r,{key:"1",tab:"角色"},{default:u(()=>[i(g(P),{onRegister:g(z),onResizeColumn:n[1]||(n[1]=(d,v)=>v.width=d)},null,8,["onRegister"])]),_:1}),i(r,{key:"2",tab:"功能"},{default:u(()=>[i(g(P),{onRegister:g(B),onResizeColumn:n[2]||(n[2]=(d,v)=>v.width=d),expandIconAsCell:!1,expandIconColumnIndex:1},null,8,["onRegister"])]),_:1}),i(r,{key:"3",tab:"数据"},{default:u(()=>[i(g(P),{onRegister:g(H),onResizeColumn:n[3]||(n[3]=(d,v)=>v.width=d)},null,8,["onRegister"])]),_:1})]),_:1},8,["activeKey"])])])]),_:1})}}});const Ye=te(Ie,[["__scopeId","data-v-27bc402e"]]);export{Ye as default};
//# sourceMappingURL=index-3c0d5c63.js.map
