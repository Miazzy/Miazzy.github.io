var d=(n,t,r)=>new Promise((c,u)=>{var x=s=>{try{p(r.next(s))}catch(i){u(i)}},b=s=>{try{p(r.throw(s))}catch(i){u(i)}},p=s=>s.done?c(s.value):Promise.resolve(s.value).then(x,b);p((r=r.apply(n,t)).next())});import{a0 as F,a5 as w,b as A,au as E,a7 as B,av as h,at as f,ax as M,az as j,aA as K,_ as V}from"./index.js";import{P as H}from"./index-20519caf.js";import{B as L}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as W}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{s as q,a as U}from"./stationTree-56a32762.js";import{e as X}from"./download-03e71dd5.js";import"./index-316f6ffb.js";import{u as Z}from"./useRender-21ce56fb.js";import{d as $,k as _,o as G,al as J,Z as Q,a9 as Y,aa as m,f as g,$ as ee,u as l,E as I,ad as v}from"./vue-71d1abb3.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./CommonTree-c4ed7838.js";import"./index-3801a970.js";function te(n){return w.get({url:"/po/technical-supervision/page",params:n})}function ae(n){return w.download({url:"/po/technical-supervision/export-excel",params:n},{isReturnNativeResponse:!0})}const ne={0:"#dc0000",1:"#338ed1",2:"#30ca5a",3:"#929292",4:"#929292",5:"#929292",6:"#fda941"},re=[{title:"单据编号",dataIndex:"billCode",width:180,sorter:!0,resizable:!0},{title:"所属公司",dataIndex:"stationOrganName",align:"left",headAlign:"center",width:160,sorter:!0,resizable:!0,ifShow:F().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",align:"left",headAlign:"center",width:160,sorter:!0,resizable:!0},{title:"期数",dataIndex:"periodId",width:160,sorter:!0,resizable:!0,align:"left",headAlign:"center",customRender:({record:n})=>n.periodName.join(",")},{title:"业务类型",dataIndex:"businessKindText",width:100,sorter:!0,resizable:!0},{title:"预试单位",dataIndex:"preExaminationCompany",align:"left",headAlign:"center",width:160,sorter:!0,resizable:!0},{title:"本次试验时间",dataIndex:"startDate",width:160,sorter:!0,resizable:!0},{title:"本次完成时间",dataIndex:"endDate",width:160,sorter:!0,resizable:!0},{title:"试验结果",dataIndex:"examinationResultText",width:100,sorter:!0,resizable:!0},{title:"转缺陷数",dataIndex:"faultNum",align:"right",headAlign:"center",width:100,sorter:!0,resizable:!0},{title:"审批状态",dataIndex:"statusText",width:100,sorter:!0,resizable:!0,customRender:({text:n,record:t})=>Z.renderTag(n,ne[t.status])},{title:"创建人",dataIndex:"personMemberName",width:100,sorter:!0,resizable:!0},{title:"创建时间",dataIndex:"fillinDate",sorter:!0,resizable:!0}],oe=[{label:"单据编号",field:"billCode",component:"Input",colProps:{span:8}},{label:"试验结果",field:"examinationResult",component:"DictSelectBox",componentProps:{type:"examination_result"},colProps:{span:8}},{label:"业务类型",field:"businessKind",component:"DictSelectBox",componentProps:{type:"supervision_business_kind"},colProps:{span:8}},{label:"状态",field:"status",component:"DictSelectBox",componentProps:{type:"bpm_process_instance_result"},colProps:{span:8}}],se={class:"right-table-layout"},ie=$({__name:"index",setup(n){const t=_({status:"",businessKind:"",examinationResult:"",billCode:"",pageNo:1,pageSize:10,sortField:"fillinDate",sortOrder:"desc"});let r=_("");const{t:c}=A(),{createConfirm:u,createMessage:x}=E();function b(e){U(e,t,null,i)}const[p,{getForm:s,reload:i,getPaginationRef:y,getSelectRows:S}]=W({title:"试验检测",api:()=>d(this,null,function*(){const e=y();return t.value.pageNo=e.current,t.value.pageSize=e.pageSize,(yield te(t.value)).result}),columns:re,rowKey:"id",bordered:!0,formConfig:{labelWidth:120,schemas:oe,showAdvancedButton:!0,autoAdvancedLine:1},useSearchForm:!0,showTableSetting:!0,rowSelection:{type:"radio",fixed:!0,onSelect:C},sortFn:e=>{e.order?(t.value.sortField=e.field.replace("Text",""),t.value.sortOrder=e.order.replace("end","")):(t.value.sortField="fillinDate",t.value.sortOrder="desc")},handleSearchInfoFn(e){for(const a in e)t.value[a]=e[a]}});function C(e,a){a?r.value=e.id:r.value=""}function T({keys:e,rows:a}){if(a&&a.length>0){const o=a[0];r.value=o.id}else r.value=""}function z(){if(!t.value.stationId){f.getInstance().info("请选中电站添加");return}M("/po/supervision/create?id=","添加试验检测",{stationId:t.value.stationId,stationName:t.value.stationName,stationOrganId:t.value.stationOrganId,stationOrganName:t.value.stationOrganName})}const P=(e,a,o)=>{R(e)};function R(e){j(e.id)}const O=()=>d(this,null,function*(){let e=S();if(e.length!=1){f.getInstance().success("请选择一行数据");return}let a=e[0];u({title:"提示",iconType:"warning",content:"确定要删除选中的记录？",onOk(){return d(this,null,function*(){if(a.status!=0){f.getInstance().success("非草稿状态不能删除");return}yield K(a.processInstanceId),f.getInstance().success("删除成功"),i()})}})});function N(){return d(this,null,function*(){u({title:c("common.exportTitle"),iconType:"warning",content:c("common.exportMessage"),onOk(){return d(this,null,function*(){let a=s().getFieldsValue();Object.assign(a,t.value),yield ae(a).then(o=>{X(o==null?void 0:o.data,"试验检测.xls")}),x.success(c("common.exportSuccessText"))})}})})}return G(()=>{B.getInstance().listen("super-vision",()=>{i()})}),(e,a)=>{const o=J("a-button");return Q(),Y(l(H),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:m(()=>[g(q,{onSelectTree:b}),ee("div",se,[g(l(L),{onRegister:l(p),onResizeColumn:a[0]||(a[0]=(k,D)=>D.width=k),onRowDbClick:P,class:"fix-basic-table",onSelectionChange:T},{toolbar:m(()=>[g(o,{type:"primary",preIcon:l(h).ADD,onClick:z},{default:m(()=>[I(v("添加"))]),_:1},8,["preIcon"]),g(o,{class:"red-btn",disabled:l(r)=="",preIcon:l(h).DELETE,onClick:O},{default:m(()=>[I(v("删除"))]),_:1},8,["disabled","preIcon"]),g(o,{class:"yellow-btn",preIcon:l(h).EXPORT,onClick:N},{default:m(()=>[I(v("导出"))]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])])]),_:1})}}});const Be=V(ie,[["__scopeId","data-v-c4e9ed2c"]]);export{Be as default};
//# sourceMappingURL=index-aabc0da5.js.map
