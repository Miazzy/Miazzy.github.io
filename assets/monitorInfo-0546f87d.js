var fe=Object.defineProperty;var z=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var K=(l,i,n)=>i in l?fe(l,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[i]=n,h=(l,i)=>{for(var n in i||(i={}))Me.call(i,n)&&K(l,n,i[n]);if(z)for(var n of z(i))ye.call(i,n)&&K(l,n,i[n]);return l};var b=(l,i,n)=>new Promise((a,m)=>{var G=s=>{try{M(n.next(s))}catch(u){m(u)}},t=s=>{try{M(n.throw(s))}catch(u){m(u)}},M=s=>s.done?a(s.value):Promise.resolve(s.value).then(G,t);M((n=n.apply(l,i)).next())});import ge from"./basicInfo-2218b647.js";import he from"./trackReplay-6f8d4ca3.js";import{H as be,g as we,a as ke,b as Ae}from"./historyVideo-b6cdcc7b.js";import Be from"./Mcs8Video-6cd64aff.js";import{K as Le,au as Pe,aj as Ie,_ as Ge}from"./index.js";import{K as T,bc as j}from"./antd-15ac76ed.js";import{d as Ce,k as p,r as Z,o as Oe,al as w,Z as k,_ as P,$ as _,f as d,aa as f,E as W,a9 as Te,ac as I,n as Y,u as U,aG as Se,aH as De}from"./vue-71d1abb3.js";import"./TimeSlider-8063450f.js";import"./BasicTable-0434a334.js";import"./useForm-dea3ed18.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-f4fc48e6.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./uniqBy-92d3bc7f.js";import"./index-085d06c7.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useTable-109483b3.js";const S=l=>(Se("data-v-ab57ef19"),l=l(),De(),l),Re={class:"satellite-map"},xe=S(()=>_("div",{id:"map-monitor-container",class:"map-container"},null,-1)),He={class:"map-mode-toggle-box"},Ve=S(()=>_("i",{class:"iconfont btn-icon icon-pingmianditu"},null,-1)),Ee=S(()=>_("i",{class:"iconfont btn-icon icon-weixingditu"},null,-1)),Ne={class:"device-data-panel"},ze={class:"card-box"},Ke={key:0,class:"video-box"},je={key:1,class:"video-box"},Ze=["src"],We={key:2,class:"video-box"},Ye=["src"],Ue=Ce({__name:"monitorInfo",setup(l){const i=Le(),n=Pe(),a=p(),m=p(),{params:G}=Ie(),t=p(h({},G)),M=p("1"),s=Z({locDate:T().format("YYYY-MM-DD"),startLocDate:"",endLocDate:""}),u=Z({replay:!0,pause:!0,goOn:!0,end:!0}),D=p(6e4),g={BMAP_NORMAL_MAP,BMAP_EARTH_MAP},y=p(t.value.mapMode),A=p(!1),B=p(!1),L=p(!1),R=p(),x=p(),$=()=>{a.value=new BMapGL.Map("map-monitor-container"),a.value.enableScrollWheelZoom(!0),Q(),a.value.centerAndZoom(new BMapGL.Point(t.value.longitude,t.value.latitude),14);let e=new BMapGL.ZoomControl;a.value.addControl(e)},Q=()=>{if(y.value==="BMAP_EARTH_MAP"){a.value.setMapType(g.BMAP_EARTH_MAP);return}if(y.value==="BMAP_NORMAL_MAP"){a.value.setMapType(g.BMAP_NORMAL_MAP);return}i.getDarkMode==="dark"?(y.value="BMAP_EARTH_MAP",a.value.setMapType(g.BMAP_EARTH_MAP)):(y.value="BMAP_NORMAL_MAP",a.value.setMapType(g.BMAP_NORMAL_MAP))},q=(e,o)=>{let r={position:e,offset:new BMapGL.Size(10,-40)},c=new BMapGL.Label(o,r);return c.setStyle({width:"auto !important",color:"white",fontSize:"12px",backgroundColor:"rgba(0,0,0)",border:0,padding:"10px",borderRadius:"4px"}),c},F=(e,o)=>{let r=new BMapGL.Marker(e);a.value.addOverlay(r);let c=q(e,o.stationShortName);r.onmouseover=()=>{a.value.addOverlay(c)},r.onmouseout=()=>{a.value.removeOverlay(c)}},J=(e,o)=>{const r=new BMapGL.Point(e,o);let c=new BMapGL.Icon("/images/marker_start.png",new BMapGL.Size(30,50),{anchor:new BMapGL.Size(15,50)}),v=new BMapGL.Marker(r,{icon:c});a.value.addOverlay(v)},X=(e,o)=>{const r=new BMapGL.Point(e,o);let c=new BMapGL.Icon("/images/marker_end.png",new BMapGL.Size(30,50),{anchor:new BMapGL.Size(15,50)}),v=new BMapGL.Marker(r,{icon:c});a.value.addOverlay(v)},H=()=>b(this,null,function*(){a.value.clearOverlays();const e=yield ne();if(!e||e.length==0){n.error("未查询到轨迹数据"),u.replay=!0;return}u.replay=!1,J(e[0].longitude,e[0].latitude),X(e[e.length-1].longitude,e[e.length-1].latitude);let o=[];e.forEach(v=>{const C=new BMapGL.Point(v.longitude,v.latitude);o.push(C)});const r=new BMapGL.Polyline(o,V("blue"));a.value.addOverlay(r);const c=new BMapGL.Polyline(o,V("green"));m.value=new BMapGLLib.TrackAnimation(a.value,c,{overallView:!0,tilt:30,duration:D.value,delay:0})}),V=e=>({enableEditing:!1,enableClicking:!0,icons:[],strokeStyle:"dashed",strokeColor:e,strokeWeight:8,strokeOpacity:.8,strokeTexture:{url:`https://mapopen-pub-jsapigl.bj.bcebos.com/svgmodel/Icon_road_${e}_arrow.png`,width:16,height:64}}),ee=e=>b(this,null,function*(){A.value=!1,B.value=!1,L.value=!1,e==="1"?E():e==="2"&&H()}),ae=()=>{A.value=!1},te=()=>{a.value.centerAndZoom(new BMapGL.Point(t.value.longitude,t.value.latitude),14)},oe=()=>{A.value=!0},E=()=>{a.value.clearOverlays();let e=new BMapGL.Point(t.value.longitude,t.value.latitude);F(e,t.value)},ne=()=>b(this,null,function*(){return t.value.type==="ewc"?yield we(h({eleWorkCardId:t.value.eleWorkCardId},s)):t.value.type==="dr"?yield ke(h({drivingRecorderId:t.value.drivingRecorderId},s)):t.value.type==="ii"?yield Ae(h({inspectionInstrumentId:t.value.inspectionInstrumentId},s)):[]}),se=()=>b(this,null,function*(){if(!s.locDate){n.error("请选择日期");return}H()}),le=e=>{let o=D.value;e>0&&(o=o/e),m.value.setDuration(o),m.value.start(),u.pause=!1,u.end=!1},ie=()=>{m.value.pause(),u.goOn=!1},re=()=>{m.value.continue()},ce=()=>{m.value.cancel(),u.pause=!0,u.goOn=!0},ue=e=>{s.locDate=e},de=e=>{s.startLocDate=T(e[0]).format("HH:mm"),s.endLocDate=T(e[1]).format("HH:mm")},pe=e=>{a.value.setMapType(g[e.target.value])},ve=e=>{e.fileType==="video"?(B.value=!0,R.value="/zfy-api/files"+e.filePath):e.fileType==="image"&&(L.value=!0,x.value="/zfy-api/files"+e.filePath)},me=()=>{B.value=!1},_e=()=>{L.value=!1};return Oe(()=>{$(),E()}),(e,o)=>{const r=w("a-radio-button"),c=w("a-radio-group"),v=w("a-tab-pane"),C=w("a-tabs"),N=w("a-button");return k(),P("div",Re,[xe,_("div",He,[d(c,{value:y.value,"onUpdate:value":o[0]||(o[0]=O=>y.value=O),onChange:pe},{default:f(()=>[d(r,{value:"BMAP_NORMAL_MAP"},{default:f(()=>[Ve,W("平面 ")]),_:1}),d(r,{value:"BMAP_EARTH_MAP"},{default:f(()=>[Ee,W("卫星 ")]),_:1})]),_:1},8,["value"])]),_("div",Ne,[d(C,{activeKey:M.value,"onUpdate:activeKey":o[1]||(o[1]=O=>M.value=O),onChange:ee},{default:f(()=>[d(v,{key:"1",tab:"基本信息"},{default:f(()=>[d(ge,{infoData:t.value,onLocation:te,onViewVideo:oe},null,8,["infoData"])]),_:1}),d(v,{key:"2",tab:"轨迹回放"},{default:f(()=>[d(he,{infoData:t.value,disabledBtn:u,onSearch:se,onReplay:le,onPause:ie,onGoOn:re,onEnd:ce,onChangeDate:ue,onChangeTime:de},null,8,["infoData","disabledBtn"])]),_:1}),t.value.type==="ii"?(k(),Te(v,{key:"3",tab:"历史视频"},{default:f(()=>[d(be,{inspectionInstrumentId:t.value.inspectionInstrumentId,onRowClick:ve},null,8,["inspectionInstrumentId"])]),_:1})):I("",!0)]),_:1},8,["activeKey"])]),_("div",ze,[A.value?(k(),P("div",Ke,[d(Be,{devId:t.value.deviceCode,onClose:ae},null,8,["devId"])])):I("",!0),B.value?(k(),P("div",je,[d(N,{class:"close-btn",icon:Y(U(j)),ghost:"",onClick:me},null,8,["icon"]),_("video",{id:"history-video-self",class:"video-self",controls:"",src:R.value,autoplay:"",muted:"",crossOrigin:"anonymous"},null,8,Ze)])):I("",!0),L.value?(k(),P("div",We,[d(N,{class:"close-btn",icon:Y(U(j)),ghost:"",onClick:_e},null,8,["icon"]),_("img",{src:x.value,loading:"lazy",class:"device-img video-self"},null,8,Ye)])):I("",!0)])])}}});const wa=Ge(Ue,[["__scopeId","data-v-ab57ef19"]]);export{wa as default};
//# sourceMappingURL=monitorInfo-0546f87d.js.map
