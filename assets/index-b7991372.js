var b=(e,r,s)=>new Promise((f,t)=>{var n=i=>{try{m(s.next(i))}catch(d){t(d)}},g=i=>{try{m(s.throw(i))}catch(d){t(d)}},m=i=>i.done?f(i.value):Promise.resolve(i.value).then(n,g);m((s=s.apply(e,r)).next())});import{B as I}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as C}from"./useTable-109483b3.js";import{K as Y}from"./antd-15ac76ed.js";import{a0 as M,a5 as h,b as S,au as O,aj as z,av as D}from"./index.js";import{e as T}from"./download-03e71dd5.js";import{P}from"./index-20519caf.js";import{d as v,r as R,o as k,al as F,Z as _,a9 as E,aa as y,f as w,u as p,E as N,ad as V}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";const B=e=>h.post({url:"/bi/safety/export-check",params:e,responseType:"blob"},{isReturnNativeResponse:!0}),q=e=>h.get({url:"/bi/safety/check",params:e},{isOnlyResult:!0}),j=e=>h.get({url:"/bi/common/org/info",params:e},{isOnlyResult:!0}),A=e=>h.post({url:"/baseset/common/list-station",params:e}),H={labelWidth:120,actionColOptions:{span:24},autoAdvancedLine:1,showAdvancedButton:!0,baseColProps:{span:7},autoSubmitOnEnter:!0,noHideBtnFlag:!0,schemas:[{field:"dateCycle",label:"时间维度",component:"Select",required:!0,defaultValue:"year",componentProps:{options:[{value:"year",label:"年份"},{value:"month",label:"月份"},{value:"day",label:"自然日"}]}},{field:"yearValue",label:"年份",component:"YearPicker",defaultValue:Y(new Date).format("YYYY"),componentProps:{format:"YYYY",valueFormat:"YYYY",style:{width:"100%"}},show:({values:e})=>e.dateCycle=="year",dynamicRules:({values:e})=>e.dateCycle=="year"?[{required:!0,message:"年份必填"}]:[]},{field:"[startMonth, endMonth]",label:"月份",component:"RangePicker",componentProps:{picker:"month",format:"YYYY-MM",valueFormat:"YYYY-MM",style:{width:"100%"},placeholder:["开始月份","结束月份"]},show:({values:e})=>e.dateCycle=="month",dynamicRules:({values:e})=>e.dateCycle=="month"?[{required:!0,message:"月份必填"}]:[]},{field:"[startDate, endDate]",label:"时间段",component:"RangePicker",componentProps:{format:"YYYY-MM-DD",style:{width:"100%"},valueFormat:"YYYY-MM-DD",placeholder:["开始时间","结束时间"]},show:({values:e})=>e.dateCycle=="day",dynamicRules:({values:e})=>e.dateCycle=="day"?[{required:!0,message:"时间段必填"}]:[]},{field:"orgId",label:"所属公司",component:"ApiSelect",componentProps:{options:[],api:j,placeholder:"请选择所属公司"},show:M().isMultiOrganization},{field:"stationId",label:"电站名称",component:"ApiSelect",componentProps:{options:[],api:()=>b(void 0,null,function*(){const e=yield A({}),r=[];return e.result.forEach(s=>{r.push({value:s.powerStationId,label:s.powerStationName})}),r}),placeholder:"请输入电站名称"}}]},x=[{title:"所属公司",dataIndex:"stationOrganName",width:150,customCell:e=>({rowSpan:e.rowOrgSpan}),resizable:!0,ifShow:M().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",width:150,resizable:!0},{title:"安全检查次数",dataIndex:"total",width:120,resizable:!0},{title:"专项检查次数",dataIndex:"zTotal",width:120,resizable:!0},{title:"定期检查次数",dataIndex:"dTotal",width:120,resizable:!0},{title:"车辆检查次数",dataIndex:"cTotal",width:120,resizable:!0},{title:"检查项数",dataIndex:"checkNum",width:120,resizable:!0},{title:"发现隐患(项)",dataIndex:"findTotal",width:120,resizable:!0},{title:"已处理隐患",dataIndex:"handleTotal",width:120,resizable:!0},{title:"发现隐患占比",dataIndex:"rate",width:120,resizable:!0},{title:"隐患处理率(%)",dataIndex:"comRate",width:120,resizable:!0}],fe=v({__name:"index",setup(e){const{t:r}=S(),{createConfirm:s,createMessage:f}=O();let{params:t}=z();t.dateCycle&&(t.startDate.length==7&&(t.startMonth=t.startDate),t.endDate.length==7&&(t.endMonth=t.endDate));const n=R({});function g(){s({title:r("common.message.confirmTitle"),iconType:"warning",content:r("common.message.exportMessage"),onOk(){return b(this,null,function*(){Object.assign(n,d().getFieldsValue()),Object.assign(n,t),n.filename="安全检查.xls",n.excelList=x,yield B(n).then(o=>{T(o==null?void 0:o.data,n.filename)}),n.filename=null,n.excelList=null,f.success(r("common.exportSuccessText"))})}})}const m=a=>(a.startMonth&&(a.startMonth=Y(a.startMonth).format("YYYY-MM")),a.endMonth&&(a.endMonth=Y(a.endMonth).format("YYYY-MM")),q(a)),[i,{getForm:d}]=C({title:"安全检查统计",api:m,columns:x,formConfig:H,useSearchForm:!0,bordered:!0,pagination:!1,showIndexColumn:!0,showTableSetting:!0,tableSetting:{redo:!1,size:!1,setting:!0,fullScreen:!1},afterFetch:function(a){const o={};for(let l=0;l<a.length;l++){const c=a[l];if(o[c.stationOrganId]){o[c.stationOrganId]++;continue}o[c.stationOrganId]=1}for(let l=0;l<a.length;l++){const c=a[l];for(const u in o)c.stationOrganId===u&&(c.rowOrgSpan=o[u],o[u]=0)}return a}});return k(()=>{t.dateCycle&&d().setFieldsValue({dateCycle:t.dateCycle,startMonth:t.startMonth,endMonth:t.endMonth,orgId:t.orgId,stationId:t.stationId})}),(a,o)=>{const l=F("a-button");return _(),E(p(P),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:y(()=>[w(p(I),{onRegister:p(i),onResizeColumn:o[0]||(o[0]=(c,u)=>u.width=c)},{toolbar:y(()=>[w(l,{class:"yellow-btn",preIcon:p(D).EXPORT,onClick:g},{default:y(()=>[N(V(p(r)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])]),_:1})}}});export{fe as default};
//# sourceMappingURL=index-b7991372.js.map
