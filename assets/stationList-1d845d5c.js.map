{"version":3,"file":"stationList-1d845d5c.js","sources":["../../src/views/po/inspection/inspectionplan/stationList.vue"],"sourcesContent":["<template>\n  <BasicTable  @register=\"table\" >\n    <template #toolbar>\n      <a-button @click=\"addRow\" v-if=\"activeKey=='stationChild'\" \n      type=\"primary\" \n      :style=\"{ 'margin-right': '10px' }\" :preIcon=\"IconEnum.ADD\"\n        >添加</a-button\n      >\n      <a-button\n        @click=\"deleteRow\"\n        v-if=\"activeKey=='stationChild'\" \n        :style=\"{ 'margin-right': '10px' }\"\n        :preIcon=\"IconEnum.DELETE\"\n        >删除</a-button\n      >\n    </template>\n    <template #acount> <div class=\"customer_require\">次数</div> </template>\n    <template #inspectionPeriod> <div class=\"customer_require\">巡检频率</div> </template>\n    <template #startDate> <div class=\"customer_require\">起算日期</div> </template>\n    <template #bodyCell=\"{ column, record }\">\n        <template v-if=\"column.dataIndex === 'acount'\">\n          <a-input-number\n            v-model:value=\"record[column.dataIndex]\"\n            style=\"width: 100%\"\n            :min=\"1\"\n            :max=\"50\"\n            :disabled=\"now>record['startDate']\"\n          />\n        </template>\n        <template v-if=\"column.dataIndex === 'startDate'\">\n          <a-date-picker\n            v-model:value=\"record[column.dataIndex]\"\n            format=\"YYYY-MM-DD\"\n            valueFormat=\"YYYY-MM-DD\"\n            style=\"width: 100%\"\n            :disabled=\"now>record['startDate']\"\n            :disabled-date=\"(curr)=>disabledSelectStartDate(curr,record['endDate'])\"\n          />\n        </template>\n        <template v-if=\"column.dataIndex === 'endDate'\">\n          <a-date-picker\n            v-model:value=\"record[column.dataIndex]\"\n            format=\"YYYY-MM-DD\"\n            valueFormat=\"YYYY-MM-DD\"\n            style=\"width: 100%\"\n            :disabled=\"now>record['endDate']\"\n            :disabled-date=\"(curr)=>disabledSelectEndDate(curr,record['startDate'])\"\n          />\n        </template>\n        <template v-if=\"column.dataIndex === 'inspectionPeriod'\">\n          <a-select\n              v-model:value=\"record[column.dataIndex]\"\n              :options=\"checkPeriodList\"\n              style=\"width: 100%\"\n              :disabled=\"now>record['startDate']\"\n            />\n\n        </template>\n      </template>\n  </BasicTable>\n    <Dialog\n      v-model:visible=\"open\"\n      :maskClosable=\"false\"\n      title=\"选择电站标\"\n      @ok=\"handleOk\"\n      :width=\"1000\"\n    >\n      <BasicTable\n        class=\"table-in-dialog\"\n        @register=\"modalTable\"\n        :searchInfo=\"searchForm\"\n      />\n      \n    </Dialog>\n</template>\n\n<script lang=\"ts\" setup>\n  import Dialog from '@/components/Framework/Modal/Dialog.vue';\n  import { ref,onMounted } from 'vue';\n  import { BasicTable, useTable } from '@/components/Table';\n  import { getStation,   getPlanStationData } from './create';\n  import { IconEnum } from '@/enums/appEnum';\n  import { SysMessage } from '/@/hooks/web/useMessage';\n  import { getDictDataMap } from '/@/api/bpm/system/dict/data';\n  import dayjs,{Dayjs} from 'dayjs';\n  import isSameOrAfter from 'dayjs/plugin/isSameOrAfter';\n  import isSameOrBefore  from 'dayjs/plugin/isSameOrBefore';\n  import { buildShortUUID } from '@/utils/uuid';\n  import { useUserStore } from '/@/store/modules/user';\n  \n  const inspectionPlanId = ref('');\n  const activeKey = ref('');\n  const initReload = ref(true);\n  const checkPeriodList = ref([]);\n  const  now=dayjs().endOf('day').format('YYYY-MM-DD');\n  const addRow = () => {\n    open.value = true;\n  };\n\n\n\n  const disabledSelectStartDate=(current: Dayjs,endDate)=>{\n    let fcur = current.format('YYYY-MM-DD');\n  debugger;\n    if(fcur<now){\n      return true;\n    }\n    let fend='';\n    if(endDate){\n      fend =dayjs(endDate).format('YYYY-MM-DD');\n      return fcur>fend; \n    }  else {\n      return false;\n    }\n    \n  }\n  const disabledSelectEndDate=(current: Dayjs,startDate)=>{\n    let fcur = current.format('YYYY-MM-DD');\n\n    let fstart='',mindate='';\n    if(startDate){\n      fstart =dayjs(startDate).format('YYYY-MM-DD') || '';\n      mindate = fstart<now?now:fstart;\n    } \n    return mindate>fcur;    \n  }\n\n  const deleteRow = () => {\n    let rows = getSelectRows();\n    if(rows.length==0){\n      SysMessage.getInstance().info(\"请选择数据\");\n      return;\n    }\n    for(let i=0;i<rows.length;i++){\n      let tmp=rows[i];\n      if(now >= tmp.startDate && tmp.id.length==32){\n        SysMessage.getInstance().info(\"已生效的数据不能删除\");\n        return ;\n      }\n    }\n    deleteTableDataRecord(getSelectRowKeys());\n  };\n\n  const reloadGrid = (param) => {\n    inspectionPlanId.value = param.inspectionPlanId;\n    activeKey.value = param.activeKey;\n    if(param.forceReload){\n      reload();\n    }\n    if (initReload.value) {\n      reload();\n      initReload.value = false;\n    }\n  };\n\n\nconst searchForm = [\n    {\n      label: '关键字',\n      field: 'name',\n      component: 'Input',\n      colProps: { span: 8 },\n    },\n  ];\n  const [\n    table,\n    {\n      setTableData,\n      getSelectRowKeys,\n      getSelectRows,\n      reload,\n      getDataSource,\n      deleteTableDataRecord,\n    },\n  ] = useTable({\n    title: '',\n    api: async () => {\n      let dataObj = await getPlanStationData({ inspectionPlanId: inspectionPlanId.value });\n      \n      return dataObj.result;\n    },\n    columns: [\n      { title: '所属公司', dataIndex: 'stationOrganName',align: 'left',headAlign:'center',\n       width: 160 ,ifShow:useUserStore().isMultiOrganization},\n      { title: '电站', dataIndex: 'stationName',align: 'left',headAlign:'center', width: 160 },\n      { slots: { title: 'inspectionPeriod' }, dataIndex: 'inspectionPeriod', width: 80 },\n      { slots: { title: 'acount' },align: 'right',headAlign:'center', dataIndex: 'acount', width: 80 },\n      { slots: { title: 'startDate' }, dataIndex: 'startDate', width: 100 },\n      { title: '截止日期', dataIndex: 'endDate', width: 100 },\n      { title: '创建时间', dataIndex: 'createDate', width: 100 },\n      { title: '修改时间', dataIndex: 'updateDate', width: 100 },\n    ],\n    bordered: true,\n    useSearchForm: false,\n    showTableSetting: false,\n    target: '#more-tab-content',\n    targetTabKey: 'stationChild',\n    targetTabValue: activeKey,\n    rowKey:'id',\n    pagination: false,\n    rowSelection: {\n      type: 'checkbox',\n    },\n  });\n  const open = ref(false);\n\n  const handleOk = () => {\n    let rows = modalSelectRow();\n    if (rows.length == 0) {\n      SysMessage.getInstance().info('请选择指标');\n      return false;\n    }\n    open.value = false;\n    let existData = getDataSource();\n    rows.forEach((e) => {\n      existData.push({           \n          stationOrganId:e.stationOrganId,\n          stationOrganName:e.stationOrganName,\n          stationName:e.stationName,\n          stationId:e.stationId,\n          acount:1,\n          id:buildShortUUID(),\n          inspectionPeriod:'1',\n          inspectionPeriodText:'每天',\n        });\n    });\n\n    setTableData(existData);\n\n    clearSelectKey();\n  };\n\n  \n  const queryParam: any = ref({  pageNo: 1, pageSize: 10 });\n\n  const [\n    modalTable,\n    {\n      getSelectRows: modalSelectRow,\n      clearSelectedRowKeys: clearSelectKey,\n      getPaginationRef: getPageInfo,\n    },\n  ] = useTable({\n    title: '',\n    api: async () => {\n      const paginationRef = getPageInfo() as any;\n      queryParam.value.pageNo = paginationRef.current;\n      queryParam.value.pageSize = paginationRef.pageSize;\n      let dataObj = await getStation(queryParam.value);\n      let rs={\n        list:[] as any\n      };\n      for(let i=0;i<dataObj.result.length;i++){\n        let item = dataObj.result[i];\n        rs.list.push({\n          stationOrganId:item.organId,\n          stationOrganName:item.organName,\n          stationName:item.powerStationName,\n          stationId:item.powerStationId\n        });\n      }\n      return rs;\n    },\n    columns: [\n      { title: '所属公司', dataIndex: 'stationOrganName', width: 160 },\n      { title: '电站', dataIndex: 'stationName', width: 160 },\n    ],\n    pagination: true,\n    formConfig: {\n      labelWidth: 120,\n      schemas: [\n        { label: '所属公司', field: 'organName', component: 'Input', colProps: { span: 10 } },\n        { label: '电站', field: 'powerStationName', component: 'Input', colProps: { span: 10 } },\n      ],\n    },\n    useSearchForm: true,\n    showTableSetting: false,\n    rowSelection: {\n      type: 'checkbox',\n    },\n    handleSearchInfoFn(info) {\n      queryParam.value.organName = info.organName;\n      queryParam.value.powerStationName = info.powerStationName;\n    },\n    maxHeight: 343,\n  });\n\n  onMounted(async()=>{\n    const response = await getDictDataMap({ dictTypeList: 'check_period' });\n    checkPeriodList.value = response.result.check_period.filter(e=>e.value == '1');\n    dayjs.extend(isSameOrAfter);\n    dayjs.extend(isSameOrBefore);\n  })\n\n  defineExpose({ reloadGrid, getDataSource });\n</script>\n<style lang=\"less\" scoped>\n  .customer_require::before {\n    content: '*';\n    display: inline-block;\n    margin-right: 4px;\n    color: #ff4d4f;\n    font-family: SimSun, sans-serif;\n    font-size: 14px;\n    line-height: 1;\n  }\n  </style>"],"names":["inspectionPlanId","ref","activeKey","initReload","checkPeriodList","now","dayjs","addRow","open","disabledSelectStartDate","current","endDate","fcur","fend","disabledSelectEndDate","startDate","fstart","mindate","deleteRow","rows","getSelectRows","SysMessage","i","tmp","deleteTableDataRecord","getSelectRowKeys","reloadGrid","param","reload","searchForm","table","setTableData","getDataSource","useTable","__async","getPlanStationData","useUserStore","handleOk","modalSelectRow","existData","e","buildShortUUID","clearSelectKey","queryParam","modalTable","getPageInfo","paginationRef","dataObj","getStation","rs","item","info","onMounted","response","getDictDataMap","isSameOrAfter","isSameOrBefore","__expose"],"mappings":"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"}