var f=(x,y,u)=>new Promise((T,i)=>{var p=t=>{try{d(u.next(t))}catch(b){i(b)}},g=t=>{try{d(u.throw(t))}catch(b){i(b)}},d=t=>t.done?T(t.value):Promise.resolve(t.value).then(p,g);d((u=u.apply(x,y)).next())});import{d as ae,ax as ne,aD as oe,r as B,k as v,o as se,al as c,Z as w,_ as ie,f as n,aa as s,$ as _,u as C,a9 as z,E as le,ac as M,J as E}from"./vue-71d1abb3.js";import{U as re}from"./UploadBox-636ecf02.js";import{au as ce,aB as me,av as ue,aC as pe,a7 as de,bP as fe,_ as ve}from"./index.js";import{B as _e}from"./BillTitle-d17ab3e4.js";import{W as ge}from"./WfApproveBox-a3448232.js";import{B as be}from"./BasicTable-0434a334.js";import{T as he}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as ye}from"./useTable-109483b3.js";import{a2 as A,P as Ie}from"./antd-15ac76ed.js";import{c as Ce,a as Te}from"./index-37d352b6.js";import"./Dialog-0a006d82.js";import"./index.esm-c216ed00.js";import"./index-fda2d66c.js";import"./OrganDialog-dd1023ce.js";import"./index-c0893416.js";import"./index-33af41d1.js";import"./tree-fc0e156a.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";const ke={class:"load"},we={class:"process-box"},xe={class:"content"},De={class:"left-panel"},Se={class:"clearfix"},Re={class:"clearfix"},Be={class:"right-panel"},ze=ae({name:"OALeaveCreate",__name:"create",setup(x){ne();const{query:y}=oe(),u={span:2},T={span:12},i=B({});i.title="请假申请",i.infoItems=[];const p=v([]),g=v(null),d=v(),t=B({id:"",type:"",startTime:void 0,endTime:void 0,reason:"",status:0,spinning:!1,bizFileId:""}),b={type:[{required:!0,message:"请选择请假类型",trigger:"change"}],startTime:[{required:!0,message:"请选择开始时间",trigger:"change"}],endTime:[{required:!0,message:"请选择结束时间",trigger:"change"}],reason:[{required:!0,message:"请输入请假事由",trigger:"blur"}]},H=()=>{D(0)},Y=()=>{d.value.validate().then(()=>{const e=E(t);if(!Z(e.endTime,e.startTime)){j("请确认开始时间和结束时间。");return}D(1)}).catch(e=>{console.log("onSubmit=》error",e)})},D=e=>f(this,null,function*(){t.spinning=!0;try{const a=E(t);a.status=e,console.log("formData",a);const o=yield Ce(a);G(e==1?"提交成功。":"保存成功"),e==1&&setTimeout(()=>{pe(),de.getInstance().sendMsg("oaleave-page",{})},1e3)}catch(a){console.log("error",a)}finally{t.spinning=!1}}),F=()=>f(this,null,function*(){Te(t.id).then(e=>{t.type=e.type+"",t.startTime=e.startTime,t.endTime=e.endTime,t.reason=e.reason,t.status=e.status,t.status>0&&(i.infoItems.push({key:"billCode",label:"单据编号",value:e.billCode,position:"left"}),i.infoItems.push({key:"fillinDate",label:"制单日期",value:e.fillinDate,position:"center"}),i.infoItems.push({key:"createPerson",label:"创建人",value:e.deptName+"."+e.personMemberName,position:"right"}))})}),N=()=>f(this,null,function*(){fe().then(e=>{t.bizFileId=e})}),{createMessage:I}=ce(),m=v(""),U=v([]),S=v(),V=()=>{const e=P(),a={key:`${Date.now()}`};e.push(a)},q=[{title:"输入框校验",dataIndex:"name6",editRow:!0,align:"left",editComponent:"UploadBox",editComponentProps:{width:800,height:550,maxCount:20,maxSize:100*1024*1024,application:"po",module:"inventory",bizId:()=>t.bizFileId,callback:(e,a)=>{S.value}},width:150}],[L,{getDataSource:P}]=ye({columns:q,showIndexColumn:!1,showTableSetting:!0,tableSetting:{fullScreen:!0},actionColumn:{width:160,title:"操作",dataIndex:"action"},dataSource:U});function O({column:e,value:a,record:o}){e.dataIndex==="id"&&(o.editValueRefs.name4.value=`${a}`),console.log(e,a,o)}function $(e){var a;try{Reflect.has(m,"value")&&(m.value=e.key,S.value=e,(a=e.onEdit)==null||a.call(e,!0))}catch(o){}}function K(e){return f(this,null,function*(){var o,l;if(I.loading({content:"正在保存...",duration:0,key:"saving"}),yield(o=e.onValid)==null?void 0:o.call(e))try{const h=Ie(e.editValueRefs);console.log(h),(yield(l=e.onEdit)==null?void 0:l.call(e,!1,!0))&&(m.value=""),I.success({content:"数据已保存",key:"saving"})}catch(h){I.error({content:"保存失败",key:"saving"})}else I.error({content:"请填写正确的数据",key:"saving"})})}function W(e){var a;try{Reflect.has(m,"value")&&(m.value="",(a=e.onEdit)==null||a.call(e,!1,!1))}catch(o){}}function J(e){return e.editable?[{label:"保存",onClick:K.bind(null,e)},{label:"取消",popConfirm:{title:"是否取消编辑",confirm:W.bind(null,e)}}]:[{label:"编辑",disabled:m.value?m.value!==e.key:!1,onClick:$.bind(null,e)}]}se(()=>f(this,null,function*(){p.value.push({label:"病假",value:"1"}),p.value.push({label:"事假",value:"2"}),p.value.push({label:"婚假",value:"3"}),y.processInstanceId&&(g.value=y.processInstanceId,me(g.value).then(e=>{t.id=e.businessKey,F()})),N()}));const Z=(e,a)=>{let o=new Date(Date.parse(e)),l=new Date(Date.parse(a));return o>l},j=e=>{A.warning(e)},G=e=>{A.success(e)};return(e,a)=>{const o=c("a-select"),l=c("a-form-item"),h=c("a-date-picker"),R=c("a-textarea"),Q=c("a-form"),k=c("a-card"),X=c("a-button"),ee=c("a-spin");return w(),ie("div",ke,[n(ee,{spinning:t.spinning,tip:"Loading..."},{default:s(()=>[_("div",we,[n(_e,{options:i},null,8,["options"]),_("div",xe,[_("div",De,[n(k,{title:"基本信息"},{default:s(()=>[n(Q,{"label-col":u,"wrapper-col":T,ref_key:"formRef",ref:d,model:t,rules:b},{default:s(()=>[n(l,{label:"请假类型",name:"type"},{default:s(()=>[n(o,{value:t.type,"onUpdate:value":a[0]||(a[0]=r=>t.type=r),allowClear:"",options:p.value,placeholder:"请选择请假类型",disabled:t.status!=0},null,8,["value","options","disabled"])]),_:1}),n(l,{label:"开始时间",name:"startTime"},{default:s(()=>[n(h,{value:t.startTime,"onUpdate:value":a[1]||(a[1]=r=>t.startTime=r),"show-time":{format:"HH:mm:mm"},valueFormat:"YYYY-MM-DD HH:mm:mm",placeholder:"请选择",disabled:t.status!=0},null,8,["value","disabled"])]),_:1}),n(l,{label:"结束时间",name:"endTime"},{default:s(()=>[n(h,{value:t.endTime,"onUpdate:value":a[2]||(a[2]=r=>t.endTime=r),"show-time":{format:"HH:mm:mm"},valueFormat:"YYYY-MM-DD HH:mm:mm",placeholder:"请选择",disabled:t.status!=0},null,8,["value","disabled"])]),_:1}),n(l,{label:"请假事由",name:"reason"},{default:s(()=>[n(R,{value:t.reason,"onUpdate:value":a[3]||(a[3]=r=>t.reason=r),disabled:t.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},8,["model"])]),_:1}),n(k,{title:"附件信息"},{default:s(()=>[_("div",Se,[n(re,{width:800,height:550,maxCount:20,maxSize:100*1024*1024,application:"po",module:"inventory",vmode:t.status==0?"box":"view",bizId:t.bizFileId},null,8,["vmode","bizId"])])]),_:1}),n(k,{title:"表格附件信息"},{default:s(()=>[_("div",Re,[n(C(be),{onRegister:C(L),onEditChange:O},{toolbar:s(()=>[t.status===0?(w(),z(X,{key:0,type:"primary",preIcon:C(ue).ADD,onClick:V},{default:s(()=>[le(" 添加 ")]),_:1},8,["preIcon"])):M("",!0)]),bodyCell:s(({column:r,record:te})=>[r.key==="action"?(w(),z(C(he),{key:0,actions:J(te)},null,8,["actions"])):M("",!0)]),_:1},8,["onRegister"])])]),_:1})]),_("div",Be,[n(ge,{onSave:H,onSubmit:Y,processStatus:t.status,processInstanceId:g.value},null,8,["processStatus","processInstanceId"])])])])]),_:1},8,["spinning"])])}}});const ct=ve(ze,[["__scopeId","data-v-33603d67"]]);export{ct as default};
//# sourceMappingURL=create-c9a540aa.js.map
