{"version":3,"file":"index-a9bfccf6.js","sources":["../../src/views/bpm/manage/form/editor/index.vue"],"sourcesContent":["<template>\n  <ContentWrap>\n    <!-- 表单设计器 -->\n    <FcDesigner ref=\"designer\" height=\"780px\">\n      <template #handle>\n        <el-button round size=\"small\" type=\"primary\" @click=\"handleSave\">\n          <Icon class=\"mr-5px\" icon=\"ep:plus\" />\n          保存\n        </el-button>\n      </template>\n    </FcDesigner>\n  </ContentWrap>\n\n  <!-- 表单保存的弹窗 -->\n  <Dialog v-model=\"dialogVisible\" title=\"保存表单\" width=\"600\">\n    <el-form ref=\"formRef\" :model=\"formData\" :rules=\"formRules\" label-width=\"80px\">\n      <el-form-item label=\"表单名\" prop=\"name\">\n        <el-input v-model=\"formData.name\" placeholder=\"请输入表单名\" />\n      </el-form-item>\n      <el-form-item label=\"状态\" prop=\"status\">\n        <el-radio-group v-model=\"formData.status\">\n          <el-radio\n            v-for=\"dict in getIntDictOptions(DICT_TYPE.COMMON_STATUS)\"\n            :key=\"dict.value\"\n            :label=\"dict.value\"\n          >\n            {{ dict.label }}\n          </el-radio>\n        </el-radio-group>\n      </el-form-item>\n      <el-form-item label=\"备注\" prop=\"remark\">\n        <el-input v-model=\"formData.remark\" placeholder=\"请输入备注\" type=\"textarea\" />\n      </el-form-item>\n    </el-form>\n    <template #footer>\n      <el-button :disabled=\"formLoading\" type=\"primary\" @click=\"submitForm\">确 定</el-button>\n      <el-button @click=\"dialogVisible = false\">取 消</el-button>\n    </template>\n  </Dialog>\n</template>\n<script lang=\"ts\" setup>\n  import { DICT_TYPE, getIntDictOptions } from '@/utils/dict';\n  import { CommonStatusEnum } from '@/utils/constants';\n  import * as FormApi from '@/api/bpm/form';\n  // import FcDesigner from '@form-create/designer';\n  import { encodeConf, encodeFields, setConfAndFields } from '@/utils/formCreate';\n  // import { useTagsViewStore } from '@/store/modules/tagsView';\n  import { ref, reactive, unref, onMounted } from 'vue';\n  import { useI18n } from 'vue-i18n';\n  import { useRouter, useRoute } from 'vue-router';\n  import { useMessage } from '/@/hooks/web/useMessage';\n\n  defineOptions({ name: 'BpmFormEditor' });\n\n  const { t } = useI18n(); // 国际化\n  const message = useMessage(); // 消息\n  const { push, currentRoute } = useRouter(); // 路由\n  const { query } = useRoute(); // 路由信息\n  // const { delView } = useTagsViewStore(); // 视图操作\n\n  const designer = ref(); // 表单设计器\n  const dialogVisible = ref(false); // 弹窗是否展示\n  const formLoading = ref(false); // 表单的加载中：提交的按钮禁用\n  const formData = ref({\n    name: '',\n    status: CommonStatusEnum.ENABLE,\n    remark: '',\n  });\n  const formRules = reactive({\n    name: [{ required: true, message: '表单名不能为空', trigger: 'blur' }],\n    status: [{ required: true, message: '开启状态不能为空', trigger: 'blur' }],\n  });\n  const formRef = ref(); // 表单 Ref\n\n  /** 处理保存按钮 */\n  const handleSave = () => {\n    dialogVisible.value = true;\n  };\n\n  /** 提交表单 */\n  const submitForm = async () => {\n    // 校验表单\n    if (!formRef.value) return;\n    const valid = await formRef.value.validate();\n    if (!valid) return;\n    // 提交请求\n    formLoading.value = true;\n    try {\n      const data = formData.value as FormApi.FormVO;\n      data.conf = encodeConf(designer); // 表单配置\n      data.fields = encodeFields(designer); // 表单字段\n      if (!data.id) {\n        await FormApi.createForm(data);\n        message.success(t('common.createSuccess'));\n      } else {\n        await FormApi.updateForm(data);\n        message.success(t('common.updateSuccess'));\n      }\n      dialogVisible.value = false;\n      close();\n    } finally {\n      formLoading.value = false;\n    }\n  };\n  /** 关闭按钮 */\n  const close = () => {\n    // delView(unref(currentRoute));\n    push('/bpm/manager/form');\n  };\n\n  /** 初始化 **/\n  onMounted(async () => {\n    // 场景一：新增表单\n    const id = query.id as unknown as number;\n    if (!id) {\n      return;\n    }\n    // 场景二：修改表单\n    const data = await FormApi.getForm(id);\n    formData.value = data;\n    setConfAndFields(designer, data.conf, data.fields);\n  });\n</script>\n"],"names":["t","useI18n","message","useMessage","push","currentRoute","useRouter","query","useRoute","designer","ref","dialogVisible","formLoading","formData","CommonStatusEnum","formRules","reactive","formRef","handleSave","submitForm","__async","data","encodeConf","encodeFields","FormApi.updateForm","FormApi.createForm","close","onMounted","id","FormApi.getForm","setConfAndFields"],"mappings":"gpBAsDQ,KAAA,CAAE,EAAAA,GAAMC,IACRC,EAAUC,IACV,CAAE,KAAAC,EAAM,aAAAC,CAAa,EAAIC,EAAU,EACnC,CAAE,MAAAC,GAAUC,IAGZC,EAAWC,IACXC,EAAgBD,EAAI,EAAK,EACzBE,EAAcF,EAAI,EAAK,EACvBG,EAAWH,EAAI,CACnB,KAAM,GACN,OAAQI,EAAiB,OACzB,OAAQ,EAAA,CACT,EACKC,EAAYC,EAAS,CACzB,KAAM,CAAC,CAAE,SAAU,GAAM,QAAS,UAAW,QAAS,OAAQ,EAC9D,OAAQ,CAAC,CAAE,SAAU,GAAM,QAAS,WAAY,QAAS,OAAQ,CAAA,CAClE,EACKC,EAAUP,IAGVQ,EAAa,IAAM,CACvBP,EAAc,MAAQ,EAAA,EAIlBQ,EAAa,IAAYC,EAAA,sBAI7B,GAFI,GAACH,EAAQ,OAET,EADU,MAAMA,EAAQ,MAAM,SAAS,IAG3C,CAAAL,EAAY,MAAQ,GAChB,GAAA,CACF,MAAMS,EAAOR,EAAS,MACjBQ,EAAA,KAAOC,EAAWb,CAAQ,EAC1BY,EAAA,OAASE,EAAad,CAAQ,EAC9BY,EAAK,IAIF,MAAAG,EAAmBH,CAAI,EACrBnB,EAAA,QAAQF,EAAE,sBAAsB,CAAC,IAJnC,MAAAyB,EAAmBJ,CAAI,EACrBnB,EAAA,QAAQF,EAAE,sBAAsB,CAAC,GAK3CW,EAAc,MAAQ,GAChBe,GAAA,QACN,CACAd,EAAY,MAAQ,EACtB,EAAA,GAGIc,EAAQ,IAAM,CAElBtB,EAAK,mBAAmB,CAAA,EAI1B,OAAAuB,EAAU,IAAYP,EAAA,sBAEpB,MAAMQ,EAAKrB,EAAM,GACjB,GAAI,CAACqB,EACH,OAGF,MAAMP,EAAO,MAAMQ,EAAgBD,CAAE,EACrCf,EAAS,MAAQQ,EACjBS,EAAiBrB,EAAUY,EAAK,KAAMA,EAAK,MAAM,CAAA,EAClD"}