{"version":3,"file":"Schedule-729c0814.js","sources":["../../src/views/oa/schedule/Schedule.vue"],"sourcesContent":["<template>\n  <Dialog\n    v-model:visible=\"open\"\n    :title=\"modelTitle\"\n    :maskClosable=\"false\"\n    @ok=\"handleSaveMeeting\"\n    @cancel=\"cancel\"\n    :width=\"1000\"\n  >\n    <div style=\"display: flex; margin-left: 865px\" v-if=\"isEditOrDel\">\n      <a-button @click=\"handleEditMeeting\" :preIcon=\"IconEnum.EDIT\" />\n      <a-button @click=\"handleDeleteMeeting\" :preIcon=\"IconEnum.DELETE\" />\n    </div>\n\n    <template #footer>\n      <a-button @click=\"cancel\">关闭</a-button>\n      <a-button\n        @click=\"handleSaveMeeting\"\n        style=\"margin-left: 5px; background-color: rgb(36 147 252); color: #fff\"\n        v-if=\"!isDisabled\"\n        >确认</a-button\n      >\n    </template>\n\n    <a-form ref=\"modalFormRef\" :model=\"formState\" name=\"userForm\">\n      <a-row :gutter=\"24\" style=\"margin-top: 16px\">\n        <a-col v-show=\"true\" :span=\"23\">\n          <a-form-item\n            label=\"会议主题\"\n            name=\"content\"\n            :labelCol=\"{ span: 3 }\"\n            :rules=\"[{ required: true }]\"\n          >\n            <a-textarea\n              v-model:value=\"formState.content\"\n              style=\"width: 100%\"\n              showCount\n              :disabled=\"isDisabled\"\n              :auto-size=\"{ minRows: 3, maxRows: 5 }\"\n              maxlength=\"200\"\n            />\n          </a-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"24\">\n        <a-col v-show=\"true\" :span=\"12\">\n          <a-form-item\n            label=\"开始时间\"\n            name=\"startTime\"\n            :labelCol=\"{ span: 6 }\"\n            :rules=\"[{ required: true, message: '请填写开始时间' }]\"\n          >\n            <a-date-picker\n              v-model:value=\"formState.startTime\"\n              value-format=\"YYYY-MM-DD HH:mm:ss\"\n              format=\"YYYY-MM-DD HH:mm\"\n              show-time\n              :disabled=\"isDisabled\"\n              @change=\"startDateChange\"\n              style=\"width: 100%\"\n            />\n          </a-form-item>\n        </a-col>\n        <a-col v-show=\"true\" :span=\"11\">\n          <a-form-item\n            label=\"结束时间\"\n            name=\"endTime\"\n            :labelCol=\"{ span: 6 }\"\n            :rules=\"[{ required: true, message: '请填写结束时间' }]\"\n          >\n            <a-date-picker\n              v-model:value=\"formState.endTime\"\n              value-format=\"YYYY-MM-DD HH:mm:ss\"\n              format=\"YYYY-MM-DD HH:mm\"\n              show-time\n              :disabled=\"isDisabled\"\n              style=\"width: 100%\"\n            />\n          </a-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"24\">\n        <a-col v-show=\"true\" :span=\"12\">\n          <a-form-item\n            name=\"reminderRules\"\n            label=\"提醒规则\"\n            :labelCol=\"{ span: 6 }\"\n            :rules=\"[{ required: true, message: '请选择提醒规则' }]\"\n          >\n            <DictSelectBox\n              :type=\"`reminderRules`\"\n              v-model:value=\"formState.reminderRules\"\n              :disabled=\"isDisabled\"\n              style=\"width: 100%\"\n            />\n          </a-form-item>\n        </a-col>\n        <a-col v-show=\"true\" :span=\"11\">\n          <a-form-item\n            name=\"organizer\"\n            label=\"会议组织人：\"\n            :labelCol=\"{ span: 6 }\"\n            :rules=\"[{ required: false }]\"\n          >\n            <a-input\n              v-model:value=\"formState.organizer\"\n              style=\"width: 100%\"\n              disabled\n              maxlength=\"20\"\n            />\n          </a-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"24\">\n        <a-col v-show=\"true\" :span=\"24\">\n          <a-form-item\n            name=\"handleFor\"\n            label=\"与会人\"\n            :labelCol=\"{ span: 3 }\"\n            :rules=\"[{ required: false, message: '请输入与会人' }]\"\n          >\n            <!-- <a-input-group compact>\n              <a-button\n                type=\"primary\"\n                @click=\"handleOpenOgDialog\"\n                class=\"input-button\"\n                style=\"color: #4141b6\"\n                :disabled=\"isDisabled\"\n                >选择</a-button\n              >\n              <a-button\n                type=\"primary\"\n                @click=\"clearHandler\"\n                class=\"input-button\"\n                style=\"color: #4141b6\"\n                :disabled=\"isDisabled\"\n                >清空</a-button\n              >\n              <a-input v-model:value=\"formState.handleFor\" class=\"input-input\" disabled />\n            </a-input-group> -->\n            <div :style=\"{ float: 'left', width: '15%' }\">\n              <a-button type=\"link\" @click=\"handleOpenOgDialog\" :disabled=\"isDisabled\"\n                >选择</a-button\n              >\n              <a-button type=\"link\" @click=\"clearHandler\" :disabled=\"isDisabled\">清空</a-button>\n            </div>\n            <a-input v-model:value=\"formState.handleFor\" class=\"input-input\" disabled />\n            <OrganDialog\n              :title=\"`组织人员`\"\n              v-model:visible=\"organVisible\"\n              v-model:value=\"formState.handleForList\"\n              @update:visible=\"organVisible = $event\"\n              :tdata=\"treeData\"\n              :tfields=\"{ key: 'nodeId', title: 'nodeName' }\"\n              :width=\"800\"\n              :height=\"600\"\n              @cancel=\"handleOrganCancel\"\n              @confirm=\"handleOrganConfirm\"\n            />\n          </a-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"24\">\n        <a-col v-show=\"true\" :span=\"24\">\n          <a-form-item\n            name=\"reminderMethod\"\n            label=\"提醒方式\"\n            :labelCol=\"{ span: 3 }\"\n            :rules=\"[{ required: true, message: '请选择提醒方式' }]\"\n          >\n            <a-checkbox-group\n              v-model:value=\"formState.reminderMethod\"\n              style=\"width: 100%\"\n              :disabled=\"isDisabled\"\n            >\n              <a-row>\n                <a-col :span=\"6\">\n                  <a-checkbox value=\"system\">系统内(pc端)</a-checkbox>\n                </a-col>\n                <a-col :span=\"6\">\n                  <a-checkbox value=\"message\">短信</a-checkbox>\n                </a-col>\n                <a-col :span=\"6\">\n                  <a-checkbox value=\"e-mail\">邮件</a-checkbox>\n                </a-col>\n              </a-row>\n            </a-checkbox-group>\n          </a-form-item>\n        </a-col>\n      </a-row>\n    </a-form>\n  </Dialog>\n\n  <Dialog\n    v-model:visible=\"schedule\"\n    :title=\"modelTitle\"\n    :maskClosable=\"false\"\n    @ok=\"handleSaveSchedule\"\n    @cancel=\"cancel\"\n    :width=\"1000\"\n  >\n    <div style=\"display: flex; margin-left: 865px\" v-if=\"isEditOrDel\">\n      <a-button @click=\"handleEditSchedule\" :preIcon=\"IconEnum.EDIT\" />\n      <a-button @click=\"handleDeleteSchedule\" :preIcon=\"IconEnum.DELETE\" />\n    </div>\n\n    <template #footer>\n      <a-button @click=\"cancel\">关闭</a-button>\n      <a-button\n        @click=\"handleSaveSchedule\"\n        style=\"margin-left: 5px; background-color: rgb(36 147 252); color: #fff\"\n        v-if=\"!isDisabled\"\n        >确认</a-button\n      >\n    </template>\n    <a-form ref=\"modalScheduleFormRef\" :model=\"formState\" name=\"userForm\">\n      <a-row :gutter=\"24\" style=\"margin-top: 16px\">\n        <a-col v-show=\"true\" :span=\"23\">\n          <a-form-item\n            label=\"日程内容\"\n            name=\"content\"\n            :labelCol=\"{ span: 3 }\"\n            :rules=\"[{ required: true }]\"\n          >\n            <a-textarea\n              v-model:value=\"formState.content\"\n              style=\"width: 100%\"\n              showCount\n              :disabled=\"isDisabled\"\n              :auto-size=\"{ minRows: 3, maxRows: 5 }\"\n              maxlength=\"200\"\n            />\n          </a-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"24\">\n        <a-col v-show=\"true\" :span=\"12\">\n          <a-form-item\n            label=\"开始日期\"\n            name=\"startDate\"\n            :labelCol=\"{ span: 6 }\"\n            :rules=\"[{ required: true, message: '请填写开始日期' }]\"\n          >\n            <a-date-picker\n              v-model:value=\"formState.startDate\"\n              value-format=\"YYYY-MM-DD\"\n              format=\"YYYY-MM-DD\"\n              :disabled=\"isDisabled\"\n              style=\"width: 100%\"\n              picker=\"date\"\n              @change=\"timeChange\"\n            />\n          </a-form-item>\n        </a-col>\n        <a-col v-show=\"true\" :span=\"11\">\n          <a-form-item\n            label=\"结束日期\"\n            name=\"endDate\"\n            :labelCol=\"{ span: 6 }\"\n            :rules=\"[{ required: true, message: '请填写结束日期' }]\"\n          >\n            <a-date-picker\n              v-model:value=\"formState.endDate\"\n              value-format=\"YYYY-MM-DD\"\n              format=\"YYYY-MM-DD\"\n              :disabled=\"isDisabled\"\n              style=\"width: 100%\"\n              picker=\"date\"\n            />\n          </a-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"24\">\n        <a-col v-show=\"true\" :span=\"12\">\n          <a-form-item\n            name=\"reminderTime\"\n            label=\"提醒时间\"\n            :labelCol=\"{ span: 6 }\"\n            :rules=\"[{ required: true }]\"\n          >\n            <a-time-picker\n              v-model:value=\"formState.reminderTime\"\n              value-format=\"HH:mm\"\n              format=\"HH:mm\"\n              :disabled=\"isDisabled\"\n              style=\"width: 100%\"\n              maxlength=\"20\"\n              @change=\"timeChange\"\n            />\n          </a-form-item>\n        </a-col>\n        <a-col v-show=\"true\" :span=\"11\">\n          <a-form-item\n            name=\"repeatingRules\"\n            label=\"重复规则\"\n            :labelCol=\"{ span: 6 }\"\n            :rules=\"[{ required: true, message: '请选择重复规则' }]\"\n          >\n            <a-select\n              v-model:value=\"formState.repeatingRules\"\n              :options=\"indexSelectOptions\"\n              allowClear\n              :disabled=\"isDisabled || !formState.reminderTime\"\n            />\n            <!-- <DictSelectBox\n              :type=\"`repeatingRules`\"\n              v-model:value=\"formState.repeatingRules\"\n              :disabled=\"isDisabled\"\n              style=\"width: 100%\"\n            /> -->\n          </a-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"24\">\n        <a-col v-show=\"true\" :span=\"12\">\n          <a-form-item\n            name=\"organizer\"\n            label=\"日程组织人\"\n            :labelCol=\"{ span: 6 }\"\n            :rules=\"[{ required: false }]\"\n          >\n            <a-input\n              v-model:value=\"formState.organizer\"\n              style=\"width: 100%\"\n              disabled\n              maxlength=\"20\"\n            />\n          </a-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"24\">\n        <a-col v-show=\"true\" :span=\"24\">\n          <a-form-item\n            name=\"handleFor\"\n            label=\"协作人\"\n            :labelCol=\"{ span: 3 }\"\n            :rules=\"[{ required: false, message: '请输入协作人' }]\"\n          >\n            <!-- <a-input-group compact>\n              <a-button\n                type=\"primary\"\n                @click=\"handleOpenOgDialog\"\n                class=\"input-button\"\n                style=\"color: #4141b6\"\n                :disabled=\"isDisabled\"\n                >选择</a-button\n              >\n              <a-button\n                type=\"primary\"\n                @click=\"clearHandler\"\n                class=\"input-button\"\n                style=\"color: #4141b6\"\n                :disabled=\"isDisabled\"\n                >清空</a-button\n              >\n              <a-input v-model:value=\"formState.handleFor\" class=\"input-input\" disabled />\n            </a-input-group> -->\n            <div :style=\"{ float: 'left', width: '15%' }\">\n              <a-button type=\"link\" @click=\"handleOpenOgDialog\" :disabled=\"isDisabled\"\n                >选择</a-button\n              >\n              <a-button type=\"link\" @click=\"clearHandler\" :disabled=\"isDisabled\">清空</a-button>\n            </div>\n            <a-input v-model:value=\"formState.handleFor\" class=\"input-input\" disabled />\n            <OrganDialog\n              :title=\"`组织人员`\"\n              v-model:visible=\"organVisible\"\n              v-model:value=\"formState.handleForList\"\n              @update:visible=\"organVisible = $event\"\n              :tdata=\"treeData\"\n              :tfields=\"{ key: 'nodeId', title: 'nodeName' }\"\n              :width=\"800\"\n              :height=\"600\"\n              @cancel=\"handleOrganCancel\"\n              @confirm=\"handleOrganConfirm\"\n            />\n          </a-form-item>\n        </a-col>\n      </a-row>\n      <a-row :gutter=\"24\">\n        <a-col v-show=\"true\" :span=\"24\">\n          <a-form-item\n            name=\"reminderMethod\"\n            label=\"提醒方式\"\n            :labelCol=\"{ span: 3 }\"\n            :rules=\"[{ required: true, message: '请选择提醒方式' }]\"\n          >\n            <a-checkbox-group\n              v-model:value=\"formState.reminderMethod\"\n              style=\"width: 100%\"\n              :disabled=\"isDisabled\"\n            >\n              <a-row>\n                <a-col :span=\"6\">\n                  <a-checkbox value=\"system\">系统内(pc端)</a-checkbox>\n                </a-col>\n                <a-col :span=\"6\">\n                  <a-checkbox value=\"message\">短信</a-checkbox>\n                </a-col>\n                <a-col :span=\"6\">\n                  <a-checkbox value=\"e-mail\">邮件</a-checkbox>\n                </a-col>\n              </a-row>\n            </a-checkbox-group>\n          </a-form-item>\n        </a-col>\n      </a-row>\n    </a-form>\n  </Dialog>\n</template>\n\n<script lang=\"ts\" setup>\n  import { ref, reactive, toRaw, onMounted } from 'vue';\n  import { message, FormInstance } from 'ant-design-vue';\n  import DictSelectBox from '@/components/Framework/Combox/DictSelectBox.vue';\n  import { defHttp } from '/@/utils/http/axios';\n  import { TreeItem } from '/@/components/Tree';\n  import OrganDialog from '@/components/Framework/Modal/OrganDialog.vue';\n  import { useUserStore } from '/@/store/modules/user';\n  import { MsgManager } from '/@/message/MsgManager';\n  import { assign } from 'lodash-es';\n  import { IconEnum } from '@/enums/appEnum';\n  import Dialog from '@/components/Framework/Modal/Dialog.vue';\n  import { useMessage } from '@/hooks/web/useMessage';\n\n  const indexSelectOptions = ref([]) as any;\n  const { createConfirm } = useMessage();\n  const userStore = useUserStore();\n  const getUserInfo = toRaw(userStore.getUserInfo);\n  const open = ref<boolean>(false);\n  const schedule = ref<boolean>(false);\n\n  const modelTitle = ref('');\n  const modalFormRef = ref<FormInstance>();\n  const modalScheduleFormRef = ref<FormInstance>();\n  const formState = reactive({});\n  let isDisabled = false;\n  let isEditOrDel = false;\n\n  const organVisible = ref(false);\n  const treeData = ref<TreeItem[]>([]);\n  const handleOrganCancel = () => {\n    organVisible.value = false; // 关闭弹框\n  };\n\n  function handleOpenOgDialog() {\n    organVisible.value = true;\n  }\n\n  function timeChange() {\n    initReminderTime();\n  }\n\n  function initReminderTime() {\n    const date = new Date(formState.startDate);\n    const time = formState.reminderTime;\n    let days = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];\n    let number = Math.ceil(date.getDate() / 7);\n    let numbers = ['第一个', '第二个', '第三个', '第四个', '第五个'];\n    indexSelectOptions.value = [];\n    if (date && time) {\n      indexSelectOptions.value.push({ value: 'not', label: '不重复' });\n      indexSelectOptions.value.push({ value: 'day', label: '每日(' + time + ')' });\n      indexSelectOptions.value.push({ value: 'workday', label: '工作日(周一至周五 ' + time + ')' });\n      indexSelectOptions.value.push({\n        value: 'weekday',\n        label: '每周(' + days[date.getDay()] + ' ' + time + ')',\n      });\n      // indexSelectOptions.value.push({\n      //   value: '2weeks',\n      //   label: '每两周(每隔一周的' + days[date.getDay()] + ' ' + time + ')',\n      // });\n      // indexSelectOptions.value.push({\n      //   value: 'monthly',\n      //   label: '每月(' + numbers[number - 1] + days[date.getDay()] + ' ' + time + ')',\n      // });\n      indexSelectOptions.value.push({\n        value: 'monthly2',\n        label: '每月(' + date.getDate() + '日 ' + time + ')',\n      });\n\n      // indexSelectOptions.value.push({\n      //   value: 'annually',\n      //   label: '每年(' + (date.getMonth() + 1) + '月' + date.getDate() + '日 ' + time + ')',\n      // });\n    }\n  }\n\n  const clearHandler = () => {\n    formState.handleFor = ''; // 清除审批人选择\n    handleForList.value = [];\n  };\n\n  const handleForList = ref<any>([]);\n  const handleOrganConfirm = (nodeList) => {\n    handleForList.value.length = 0;\n\n    if (nodeList.length > 0) {\n      let nodeNames = [];\n      nodeList.forEach((data) => {\n        const node = {\n          orgUnitId: data.value,\n          orgUnitName: data.label,\n        };\n        handleForList.value.push(node);\n        nodeNames.push(data.nodeName || data.title || data.label);\n      });\n      formState.handleFor = nodeNames.join(',');\n    }\n    organVisible.value = false; // 关闭弹框\n  };\n\n  const getTreeData = (params) =>\n    defHttp.post(\n      {\n        url: '/system/org/list-tree',\n        params,\n      },\n      {},\n    );\n\n  // 查询左侧电站树数据\n  async function queryDeptTreeList() {\n    const typeList = await getTreeData({\n      orgKindIds: 'ogn,dpt,pos,psm',\n      showPosition: true,\n      status: 1,\n    });\n    console.error('query tree data over:', new Date().getTime());\n    treeData.value = dig(typeList.result);\n  }\n\n  function dig(data) {\n    const list: TreeItem[] = [];\n    for (let i = 0; i < data.length; i++) {\n      const item = data[i];\n      const treeNode: TreeItem[][number] = {\n        code: item.code,\n        fullId: item.code,\n        name: item.name,\n        nodeId: item.id,\n        nodeName: item.name,\n        orgId: item.orgId,\n        parentId: item.parentId,\n        disabled: item.orgKindId === 'psm' ? false : true,\n      };\n\n      if (item.children && item.children.length > 0) {\n        treeNode.children = dig(item.children);\n      }\n\n      list.push(treeNode);\n    }\n    return list;\n  }\n  function cancel() {\n    debugger;\n    open.value = false;\n    schedule.value = false;\n  }\n\n  onMounted(() => {});\n\n  function handleClickMenu(key) {\n    isDisabled = false;\n    handleForList.value = [];\n    if (key === 'meeting') {\n      addMeeting();\n    } else if (key === 'schedule') {\n      addSchedule();\n    }\n    queryDeptTreeList();\n    console.error('query tree data start:', new Date().getTime());\n  }\n\n  function addMeeting() {\n    const now = new Date();\n    now.setHours(now.getHours() + 1);\n\n    formState.content = null;\n    formState.startTime = formatCurrentTime(new Date());\n    formState.endTime = formatCurrentTime(now);\n    formState.reminderRules = null;\n    formState.organizer = getUserInfo.orgs[0].personMemberName;\n    formState.handleFor = null;\n    formState.reminderMethod = null;\n    formState.handleForList = [];\n\n    open.value = true;\n    modelTitle.value = '会议提醒';\n  }\n\n  function addSchedule() {\n    formState.content = null;\n    formState.startDate = formatCurrentDate(new Date());\n    formState.endDate = null;\n    formState.reminderTime = null;\n    formState.repeatingRules = null;\n    formState.organizer = getUserInfo.orgs[0].personMemberName;\n    formState.handleFor = null;\n    formState.reminderMethod = null;\n    formState.handleForList = [];\n\n    schedule.value = true;\n    modelTitle.value = '日程提醒';\n  }\n\n  function startDateChange() {\n    const now = new Date(formState.startTime);\n    now.setHours(now.getHours() + 1);\n    formState.endTime = formatCurrentTime(now);\n  }\n\n  function formatCurrentTime(date) {\n    // 获取当前时间并打印\n    const yy = date.getFullYear();\n    const mm = date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1;\n    const dd = date.getDate() < 10 ? '0' + date.getDate() : date.getDate();\n    const hh = date.getHours() < 10 ? '0' + date.getHours() : date.getHours();\n    const mf = date.getMinutes() < 10 ? '0' + date.getMinutes() : date.getMinutes();\n    const ss = date.getSeconds() < 10 ? '0' + date.getSeconds() : date.getSeconds();\n    const gettime = yy + '-' + mm + '-' + dd + ' ' + hh + ':' + mf + ':' + ss;\n    return gettime;\n  }\n  function formatCurrentDate(date) {\n    // 获取当前时间并打印\n    const yy = date.getFullYear();\n    const mm = date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1;\n    const dd = date.getDate() < 10 ? '0' + date.getDate() : date.getDate();\n\n    const gettime = yy + '-' + mm + '-' + dd;\n    return gettime;\n  }\n\n  function handleSaveMeeting() {\n    modalFormRef.value.validateFields().then(() => {\n      formState.handleForList = handleForList.value;\n      formState.reminderMethod = formState.reminderMethod.join(',');\n      saveIndex(formState)\n        .then(() => {\n          MsgManager.getInstance().sendMsg('setMeeting', {});\n          message.success('保存成功。');\n          open.value = false;\n        })\n        .catch(() => {});\n    });\n  }\n\n  function handleSaveSchedule() {\n    modalScheduleFormRef.value.validateFields().then(() => {\n      formState.handleForList = handleForList.value;\n      formState.reminderMethod = formState.reminderMethod.join(',');\n      saveSchedule(formState)\n        .then(() => {\n          MsgManager.getInstance().sendMsg('setMeeting', {});\n          message.success('保存成功。');\n          schedule.value = false;\n        })\n        .catch(() => {});\n    });\n  }\n\n  const saveIndex = (params) =>\n    defHttp.post(\n      {\n        url: '/oa/calendar-meeting/create',\n        params,\n      },\n      {},\n    );\n\n  const saveSchedule = (params) =>\n    defHttp.post(\n      {\n        url: '/oa/calendar-schedule/create',\n        params,\n      },\n      {},\n    );\n\n  const deleteMeeting = (params) =>\n    defHttp.delete(\n      {\n        url: '/oa/calendar-meeting/delete',\n        params,\n      },\n      {},\n    );\n\n  const deleteSchedule = (params) =>\n    defHttp.delete(\n      {\n        url: '/oa/calendar-schedule/delete',\n        params,\n      },\n      {},\n    );\n\n  function handleView(params) {\n    isDisabled = true;\n    if (params.type === 'meeting') {\n      viewMeeting(params.id);\n    } else if (params.type === 'schedule') {\n      viewSchedule(params.id);\n    }\n  }\n\n  function handleEditMeeting() {\n    isDisabled = false;\n    open.value = false;\n    viewMeeting(formState.id);\n  }\n\n  function handleDeleteMeeting() {\n    deleteConfirm(function () {\n      deleteMeeting('?id=' + formState.id).then(() => {\n        message.success('删除成功。');\n        MsgManager.getInstance().sendMsg('setMeeting', {});\n        open.value = false;\n      });\n    });\n  }\n\n  function handleEditSchedule() {\n    isDisabled = false;\n    schedule.value = false;\n    viewSchedule(formState.id);\n  }\n\n  function handleDeleteSchedule() {\n    deleteConfirm(function () {\n      deleteSchedule('?id=' + formState.id).then(() => {\n        message.success('删除成功。');\n        MsgManager.getInstance().sendMsg('setMeeting', {});\n        schedule.value = false;\n      });\n    });\n  }\n\n  function deleteConfirm(callback: Function) {\n    createConfirm({\n      title: '温馨提示',\n      iconType: 'warning',\n      content: '是否确认删除此数据？',\n      async onOk() {\n        await callback();\n      },\n    });\n  }\n\n  const getMeeting = (params) =>\n    defHttp.get(\n      {\n        url: '/oa/calendar-meeting/get',\n        params,\n      },\n      {},\n    );\n\n  function viewMeeting(id) {\n    getMeeting({ id: id })\n      .then((data) => {\n        assign(formState, data.result);\n        formState.reminderMethod = formState.reminderMethod.split(',');\n        open.value = true;\n        modelTitle.value = '会议提醒';\n        let personId = getUserInfo.orgs[0].personId;\n\n        let nowTime = new Date().getTime();\n        let startTime = new Date(formState.startTime).getTime();\n\n        if (formState.creator == personId && nowTime < startTime) {\n          isEditOrDel = true;\n          queryDeptTreeList();\n        } else {\n          isEditOrDel = false;\n        }\n      })\n      .catch(() => {});\n  }\n\n  const getSchedule = (params) =>\n    defHttp.get(\n      {\n        url: '/oa/calendar-schedule/get',\n        params,\n      },\n      {},\n    );\n  function viewSchedule(id) {\n    getSchedule({ id: id })\n      .then((data) => {\n        assign(formState, data.result);\n        formState.reminderMethod = formState.reminderMethod.split(',');\n        schedule.value = true;\n        modelTitle.value = '日程提醒';\n\n        let personId = getUserInfo.orgs[0].personId;\n        if (formState.creator == personId) {\n          isEditOrDel = true;\n          queryDeptTreeList();\n        } else {\n          isEditOrDel = false;\n        }\n        initReminderTime();\n      })\n      .catch(() => {});\n  }\n\n  defineExpose({ handleClickMenu, handleView });\n</script>\n\n<style lang=\"less\" scoped>\n  .card-content {\n    height: 360px;\n    padding-top: 1px;\n    // .calendar-cell {\n    //   font-size: 12px;\n    //   text-align-last: left;\n    //   .detail {\n    //     display: flex;\n    //     justify-content: space-between;\n    //     align-items: center;\n    //   }\n    // }\n    :deep(.ant-picker-calendar .ant-picker-panel) {\n      .ant-picker-body {\n        padding: 0;\n      }\n    }\n\n    :deep(.ant-picker-calendar-mini .ant-picker-content) {\n      height: 292px;\n\n      th {\n        padding: 8px 0;\n      }\n    }\n\n    :deep(\n        .ant-picker-cell-in-view.ant-picker-cell-selected .ant-picker-cell-inner,\n        .ant-picker-cell-in-view.ant-picker-cell-range-start .ant-picker-cell-inner,\n        .ant-picker-cell-in-view.ant-picker-cell-range-end .ant-picker-cell-inner\n      ) {\n      background-color: #1890ff;\n    }\n\n    :deep(.ant-picker-cell-in-view.ant-picker-cell-today .ant-picker-cell-inner::before) {\n      border-color: #1890ff;\n    }\n  }\n\n  .input-button {\n    width: 6%;\n    border-color: #c5c5c5;\n    background-color: #fefeff;\n    color: #d6d6d8;\n  }\n\n  .input-input {\n    width: 80%;\n    color: rgb(15 15 15);\n  }\n</style>\n"],"names":["indexSelectOptions","ref","createConfirm","useMessage","userStore","useUserStore","getUserInfo","toRaw","open","schedule","modelTitle","modalFormRef","modalScheduleFormRef","formState","reactive","isDisabled","isEditOrDel","organVisible","treeData","handleOrganCancel","handleOpenOgDialog","timeChange","initReminderTime","date","time","days","clearHandler","handleForList","handleOrganConfirm","nodeList","nodeNames","data","node","getTreeData","params","defHttp","queryDeptTreeList","__async","typeList","dig","list","i","item","treeNode","cancel","onMounted","handleClickMenu","key","addMeeting","addSchedule","now","formatCurrentTime","formatCurrentDate","startDateChange","yy","mm","dd","hh","mf","ss","handleSaveMeeting","saveIndex","MsgManager","message","handleSaveSchedule","saveSchedule","deleteMeeting","deleteSchedule","handleView","viewMeeting","viewSchedule","handleEditMeeting","handleDeleteMeeting","deleteConfirm","handleEditSchedule","handleDeleteSchedule","callback","getMeeting","id","assign","personId","nowTime","startTime","getSchedule","__expose"],"mappings":"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"}