var R=(c,k,b)=>new Promise((S,N)=>{var U=v=>{try{n(b.next(v))}catch(w){N(w)}},q=v=>{try{n(b.throw(v))}catch(w){N(w)}},n=v=>v.done?S(v.value):Promise.resolve(v.value).then(U,q);n((b=b.apply(c,k)).next())});import{d as L,aD as $,k as C,r as G,o as Z,al as f,Z as _,a9 as g,aa as a,$ as I,f as e,E as j,ad as A,u as h,ac as y,aG as J,aH as K}from"./vue-71d1abb3.js";import{b as Q,ax as X,at as x,a7 as ee,aC as ae,a5 as te,_ as le}from"./index.js";import{B as ne}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as de}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{P as oe}from"./index-20519caf.js";import{_ as se}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{b as ue,h as ie,i as re}from"./index-04498ccb.js";import{S as pe}from"./SearchBox-22bb02d6.js";import{a as me}from"./assign-37f1c13d.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";const fe=c=>(J("data-v-0894d196"),c=c(),K(),c),ve={class:"load"},be={class:"process-box"},_e={class:"header-box"},ge=fe(()=>I("div",{class:"header-left"},"物资",-1)),Ie={class:"header-right"},ce={class:"content"},Ce="/baseset/areaset/get-list",ye=L({name:"EquipmentCreate",__name:"split",setup(c){const{t:k}=Q(),{query:b}=$(),S=C(!1),N=C(),U=C([]),q=C([{title:"编码",dataIndex:"code",key:"code",fixed:"left",minWidth:50},{title:"公司名称",dataIndex:"name",key:"name",fixed:"left",minWidth:50}]),n=G({spinning:!1,processInstanceId:"",id:"",stationOrganId:"",stationOrganName:"",stationId:"",stationName:"",periodId:"",periodName:"",status:"",code:"",name:"",materialId:"",materialCode:"",materialName:"",materialWholeName:"",materialCategoryCode:"",modelCode:"",factoryId:"",factoryName:"",supplierId:"",supplierName:"",productionNumber:"",productionDate:"",usedDate:"",warrantyDate:"",areaId:"",areaName:"",subarrayId:"",subarrayName:"",qty:"",unitId:"",unitName:"",remark:"",deviceCode:""}),v=()=>{X("/baseset/monitor/device","设备设置",{deviceEsn:n.deviceCode})},w=(u,l)=>te.get({url:u,params:l},{isOnlyResult:!0}),Y=(u,l,i)=>{w(u,l).then(d=>{i.value.splice(0,i.value.length),d.forEach(o=>{i.value.push({id:o.id,code:o.code,name:o.name})});const s=i.value;i.value=[],setTimeout(()=>{i.value=s},100)})},E=[{title:"编号",dataIndex:"code",width:120},{title:"设备名称",dataIndex:"name",width:160,resizable:!0},{title:"型号",dataIndex:"modelCode",width:160,resizable:!0},{title:"数量",dataIndex:"qty",width:60},{title:"区域子阵",dataIndex:"subarrayName",width:160,resizable:!0},{title:"出厂编号",dataIndex:"productionNumber",width:160,resizable:!0},{title:"出厂日期",dataIndex:"productionDate",width:100,resizable:!0},{title:"投运日期",dataIndex:"usedDate",width:100,resizable:!0}];C([]);const[W,{getDataSource:T}]=de({api:re,columns:E,useSearchForm:!1,bordered:!0,pagination:!1,beforeFetch(u){return u.id=b.id,u},showTableSetting:!1,tableSetting:{fullScreen:!0},showIndexColumn:!0,scroll:{y:720},maxHeight:720});function V(u,l){l.width=u}const H=()=>{N.value.validate().then(()=>{const u=T();for(let l=0;l<u.length;l++){let i=u[l];if(!i.name)return x.getInstance().warning("请输入编号 "+i.code+" 的设备名称。"),!1;if(!i.modelCode)return x.getInstance().warning("请输入编号 "+i.code+" 的型号。"),!1;if(!i.subarrayName)return x.getInstance().warning("请输入编号 "+i.code+" 的区域子阵。"),!1;if(!i.productionDate)return x.getInstance().warning("请输入编号 "+i.code+" 的出厂日期。"),!1;if(!i.usedDate)return x.getInstance().warning("请输入编号 "+i.code+" 的投运日期。"),!1}O()}).catch(u=>{console.log("onSubmit=》error",u)})},O=()=>R(this,null,function*(){n.spinning=!0;try{const u={};u.id=n.id;const l=C([]);T().map((d={},s)=>{l.value.push({code:d.code,name:d.name,modelCode:d.modelCode,areaId:d.areaId,areaName:d.areaName,productionNumber:d.productionNumber,productionDate:d.productionDate,usedDate:d.usedDate})}),u.createReqVOs=l.value,yield ie(u),x.getInstance().success("保存成功。"),setTimeout(()=>{ee.getInstance().sendMsg("equipment-page",{}),ae()},1e3)}catch(u){console.log("error",u)}finally{n.spinning=!1}});return Z(()=>R(this,null,function*(){b.id&&ue(b.id).then(u=>{me(n,u);const l={stationId:n.stationId,stationPeriodId:n.periodId};Y(Ce,l,U)})})),(u,l)=>{const i=f("a-button"),d=f("a-input"),s=f("a-form-item"),o=f("a-col"),m=f("a-row"),P=f("a-textarea"),M=f("a-card"),z=f("a-date-picker"),B=f("a-form"),F=f("a-spin");return _(),g(h(oe),{detail:!0,dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"fix-detail-page",style:{position:"relative"}},{default:a(()=>[I("div",ve,[e(F,{spinning:n.spinning,tip:"Loading..."},{default:a(()=>[I("div",be,[I("div",_e,[ge,I("div",Ie,[e(i,{type:"primary",onClick:H,loading:S.value},{default:a(()=>[j(A(h(k)("common.saveText")),1)]),_:1},8,["loading"])])]),I("div",ce,[e(B,{ref_key:"formRef",ref:N,model:n,labelAlign:"right",autocomplete:"off"},{default:a(()=>[e(M,{title:"基本信息",bordered:!1},{default:a(()=>[e(m,{gutter:24},{default:a(()=>[e(o,{span:12},{default:a(()=>[e(s,{name:"stationName",label:"电站名称",labelCol:{span:6}},{default:a(()=>[e(d,{disabled:"",value:n.stationName,"onUpdate:value":l[0]||(l[0]=t=>n.stationName=t)},null,8,["value"])]),_:1})]),_:1}),e(o,{span:12},{default:a(()=>[e(s,{name:"periodName",label:"期数",labelCol:{span:6}},{default:a(()=>[e(d,{disabled:"",value:n.periodName,"onUpdate:value":l[1]||(l[1]=t=>n.periodName=t)},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(m,{gutter:24},{default:a(()=>[e(o,{span:12},{default:a(()=>[e(s,{name:"status",label:"设备状态",labelCol:{span:6}},{default:a(()=>[e(se,{type:"enable_or_disable",value:n.status,"onUpdate:value":l[2]||(l[2]=t=>n.status=t),style:{width:"100%"},disabled:""},null,8,["value"])]),_:1})]),_:1}),e(o,{span:12},{default:a(()=>[e(s,{name:"code",label:"设备编码",labelCol:{span:6}},{default:a(()=>[e(d,{value:n.code,"onUpdate:value":l[3]||(l[3]=t=>n.code=t),disabled:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(m,{gutter:24},{default:a(()=>[e(o,{span:12},{default:a(()=>[e(s,{name:"materialName",label:"物料名称",labelCol:{span:6},rules:[{required:!0,message:"请选择物料"}]},{default:a(()=>[e(d,{value:n.materialName,"onUpdate:value":l[4]||(l[4]=t=>n.materialName=t),disabled:""},null,8,["value"])]),_:1})]),_:1}),e(o,{span:12},{default:a(()=>[e(s,{name:"materialWholeName",label:"物料全称",labelCol:{span:6}},{default:a(()=>[e(d,{value:n.materialWholeName,"onUpdate:value":l[5]||(l[5]=t=>n.materialWholeName=t),disabled:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(m,{gutter:24},{default:a(()=>[e(o,{span:12},{default:a(()=>[e(s,{name:"materialCode",label:"物料编码",labelCol:{span:6}},{default:a(()=>[e(d,{value:n.materialCode,"onUpdate:value":l[6]||(l[6]=t=>n.materialCode=t),disabled:""},null,8,["value"])]),_:1})]),_:1}),e(o,{span:12},{default:a(()=>[e(s,{name:"modelCode",label:"型号",labelCol:{span:6},rules:[{required:!0,message:"请输入型号"}]},{default:a(()=>[e(d,{value:n.modelCode,"onUpdate:value":l[7]||(l[7]=t=>n.modelCode=t),disabled:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(m,{gutter:24},{default:a(()=>[e(o,{span:12},{default:a(()=>[e(s,{label:"生产厂家",name:"factoryName",labelCol:{span:6},rules:[{required:!0,message:"请选择生产厂家"}]},{default:a(()=>[e(d,{value:n.factoryName,"onUpdate:value":l[8]||(l[8]=t=>n.factoryName=t),disabled:""},null,8,["value"])]),_:1})]),_:1}),e(o,{span:12},{default:a(()=>[e(s,{label:"供应商",name:"supplierName",labelCol:{span:6},wrapperCol:7,rules:[{required:!0,message:"请选择供应商"}]},{default:a(()=>[e(d,{value:n.supplierName,"onUpdate:value":l[9]||(l[9]=t=>n.supplierName=t),disabled:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(m,{gutter:24},{default:a(()=>[e(o,{span:12},{default:a(()=>[e(s,{name:"productionNumber",label:"出厂编号",labelCol:{span:6}},{default:a(()=>[e(d,{value:n.productionNumber,"onUpdate:value":l[10]||(l[10]=t=>n.productionNumber=t),disabled:"",placeholder:"请输入出厂编号"},null,8,["value"])]),_:1})]),_:1}),e(o,{span:12},{default:a(()=>[e(s,{label:"出厂日期",name:"productionDate",labelAlign:"right",labelCol:{span:6},rules:[{required:!0,message:"请选择出厂日期"}]},{default:a(()=>[e(d,{value:n.productionDate,"onUpdate:value":l[11]||(l[11]=t=>n.productionDate=t),disabled:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(m,{gutter:24},{default:a(()=>[e(o,{span:12},{default:a(()=>[e(s,{label:"投运日期",name:"usedDate",labelAlign:"right",labelCol:{span:6},rules:[{required:!0,message:"请选择投运日期"}]},{default:a(()=>[e(d,{value:n.usedDate,"onUpdate:value":l[12]||(l[12]=t=>n.usedDate=t),disabled:""},null,8,["value"])]),_:1})]),_:1}),e(o,{span:12},{default:a(()=>[e(s,{label:"质保截止日期",name:"warrantyDate",labelAlign:"right",labelCol:{span:6},rules:[{required:!0,message:"请选择质保截止日期"}]},{default:a(()=>[e(d,{value:n.warrantyDate,"onUpdate:value":l[13]||(l[13]=t=>n.warrantyDate=t),disabled:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(m,{gutter:24},{default:a(()=>[e(o,{span:12},{default:a(()=>[e(s,{name:"subarrayName",label:"区域子阵",labelCol:{span:6}},{default:a(()=>[e(d,{value:n.subarrayName,"onUpdate:value":l[14]||(l[14]=t=>n.subarrayName=t),disabled:""},null,8,["value"])]),_:1})]),_:1}),e(o,{span:12},{default:a(()=>[e(s,{name:"name",label:"设备名称",labelCol:{span:6}},{default:a(()=>[e(d,{value:n.name,"onUpdate:value":l[15]||(l[15]=t=>n.name=t),disabled:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(m,{gutter:24},{default:a(()=>[e(o,{span:12},{default:a(()=>[e(s,{name:"qty",label:"数量",labelCol:{span:6}},{default:a(()=>[e(d,{value:n.qty,"onUpdate:value":l[16]||(l[16]=t=>n.qty=t),disabled:""},null,8,["value"])]),_:1})]),_:1}),e(o,{span:12},{default:a(()=>[e(s,{label:"计量单位",name:"unitId",labelCol:{span:6},wrapperCol:15},{default:a(()=>[e(d,{value:n.unitId,"onUpdate:value":l[17]||(l[17]=t=>n.unitId=t),disabled:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(m,{gutter:24},{default:a(()=>[e(o,{span:12},{default:a(()=>[e(s,{name:"deviceCode",label:"关联设备",labelCol:{span:6}},{default:a(()=>[I("a",{onClick:v},A(n.deviceCode),1)]),_:1})]),_:1})]),_:1}),e(m,{gutter:24},{default:a(()=>[e(o,{span:24,class:"textarea-item"},{default:a(()=>[e(s,{label:"备注",name:"remark",labelAlign:"right",labelCol:{span:3}},{default:a(()=>[e(P,{rows:5,value:n.remark,"onUpdate:value":l[18]||(l[18]=t=>n.remark=t),disabled:""},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),e(M,{title:"拆分列表",bordered:!1,class:"split-content",style:{height:"600px","min-height":"600px"}},{default:a(()=>[e(h(ne),{onRegister:h(W),onResizeColumn:V},{bodyCell:a(({column:t,record:r})=>[t.dataIndex==="name"?(_(),g(d,{key:0,value:r[t.dataIndex],"onUpdate:value":p=>r[t.dataIndex]=p,maxlenth:50},null,8,["value","onUpdate:value"])):y("",!0),t.dataIndex==="modelCode"?(_(),g(d,{key:1,value:r[t.dataIndex],"onUpdate:value":p=>r[t.dataIndex]=p,maxlenth:128},null,8,["value","onUpdate:value"])):y("",!0),t.dataIndex==="subarrayName"?(_(),g(pe,{key:2,value:r[t.dataIndex],"onUpdate:value":p=>r[t.dataIndex]=p,columns:q.value,data:U.value,vfield:"name",pagination:!0,twidth:"100%",onChange:(p,D)=>{r.areaId=D.record.key,r.areaName=D.record.name,r.subarrayId=D.record.key,r.subarrayName=D.record.name}},null,8,["value","onUpdate:value","columns","data","onChange"])):y("",!0),t.dataIndex==="productionNumber"?(_(),g(d,{key:3,value:r[t.dataIndex],"onUpdate:value":p=>r[t.dataIndex]=p,maxlenth:64},null,8,["value","onUpdate:value"])):y("",!0),t.dataIndex==="productionDate"?(_(),g(z,{key:4,value:r[t.dataIndex],"onUpdate:value":p=>r[t.dataIndex]=p,style:{"min-width":"100%"},"value-format":"YYYY-MM-DD"},null,8,["value","onUpdate:value"])):y("",!0),t.dataIndex==="usedDate"?(_(),g(z,{key:5,value:r[t.dataIndex],"onUpdate:value":p=>r[t.dataIndex]=p,style:{"min-width":"100%"},"value-format":"YYYY-MM-DD"},null,8,["value","onUpdate:value"])):y("",!0)]),_:1},8,["onRegister"])]),_:1})]),_:1},8,["model"])])])]),_:1},8,["spinning"])])]),_:1})}}});const je=le(ye,[["__scopeId","data-v-0894d196"]]);export{je as default};
//# sourceMappingURL=split-c6b64587.js.map
