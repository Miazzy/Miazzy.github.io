var y=(g,k,u)=>new Promise((f,v)=>{var S=c=>{try{_(u.next(c))}catch(D){v(D)}},l=c=>{try{_(u.throw(c))}catch(D){v(D)}},_=c=>c.done?f(c.value):Promise.resolve(c.value).then(S,l);_((u=u.apply(g,k)).next())});import{D as X}from"./Dialog-0a006d82.js";import{B as U}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as E}from"./useTable-109483b3.js";import{K as x}from"./antd-15ac76ed.js";import{a0 as ee,aw as te,bV as ae,bW as ne,av as F,at as M,aD as oe,_ as ie}from"./index.js";import{d as se,e as le}from"./create-58f7bc33.js";import{d as de,k as h,o as re,al as N,Z as m,_ as ce,f as O,aa as p,a9 as b,u as r,E as K,ac as I,F as pe,aG as ue,aH as me,$ as P}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";const R=g=>(ue("data-v-d6dc68b4"),g=g(),me(),g),ge=R(()=>P("div",{class:"customer_require"},"次数",-1)),fe=R(()=>P("div",{class:"customer_require"},"巡检频率",-1)),he=R(()=>P("div",{class:"customer_require"},"起算日期",-1)),be=de({__name:"stationList",setup(g,{expose:k}){const u=h(""),f=h(""),v=h(!0),S=h([]),l=x().endOf("day").format("YYYY-MM-DD"),_=()=>{Y.value=!0},c=(e,t)=>{let a=e.format("YYYY-MM-DD");debugger;if(a<l)return!0;let i="";return t?(i=x(t).format("YYYY-MM-DD"),a>i):!1},D=(e,t)=>{let a=e.format("YYYY-MM-DD"),i="",d="";return t&&(i=x(t).format("YYYY-MM-DD")||"",d=i<l?l:i),d>a},B=()=>{let e=z();if(e.length==0){M.getInstance().info("请选择数据");return}for(let t=0;t<e.length;t++){let a=e[t];if(l>=a.startDate&&a.id.length==32){M.getInstance().info("已生效的数据不能删除");return}}G(q())},L=e=>{u.value=e.inspectionPlanId,f.value=e.activeKey,e.forceReload&&T(),v.value&&(T(),v.value=!1)},V=[{label:"关键字",field:"name",component:"Input",colProps:{span:8}}],[A,{setTableData:j,getSelectRowKeys:q,getSelectRows:z,reload:T,getDataSource:C,deleteTableDataRecord:G}]=E({title:"",api:()=>y(this,null,function*(){return(yield se({inspectionPlanId:u.value})).result}),columns:[{title:"所属公司",dataIndex:"stationOrganName",align:"left",headAlign:"center",width:160,ifShow:ee().isMultiOrganization},{title:"电站",dataIndex:"stationName",align:"left",headAlign:"center",width:160},{slots:{title:"inspectionPeriod"},dataIndex:"inspectionPeriod",width:80},{slots:{title:"acount"},align:"right",headAlign:"center",dataIndex:"acount",width:80},{slots:{title:"startDate"},dataIndex:"startDate",width:100},{title:"截止日期",dataIndex:"endDate",width:100},{title:"创建时间",dataIndex:"createDate",width:100},{title:"修改时间",dataIndex:"updateDate",width:100}],bordered:!0,useSearchForm:!1,showTableSetting:!1,target:"#more-tab-content",targetTabKey:"stationChild",targetTabValue:f,rowKey:"id",pagination:!1,rowSelection:{type:"checkbox"}}),Y=h(!1),H=()=>{let e=Z();if(e.length==0)return M.getInstance().info("请选择指标"),!1;Y.value=!1;let t=C();e.forEach(a=>{t.push({stationOrganId:a.stationOrganId,stationOrganName:a.stationOrganName,stationName:a.stationName,stationId:a.stationId,acount:1,id:oe(),inspectionPeriod:"1",inspectionPeriodText:"每天"})}),j(t),$()},w=h({pageNo:1,pageSize:10}),[W,{getSelectRows:Z,clearSelectedRowKeys:$,getPaginationRef:J}]=E({title:"",api:()=>y(this,null,function*(){const e=J();w.value.pageNo=e.current,w.value.pageSize=e.pageSize;let t=yield le(w.value),a={list:[]};for(let i=0;i<t.result.length;i++){let d=t.result[i];a.list.push({stationOrganId:d.organId,stationOrganName:d.organName,stationName:d.powerStationName,stationId:d.powerStationId})}return a}),columns:[{title:"所属公司",dataIndex:"stationOrganName",width:160},{title:"电站",dataIndex:"stationName",width:160}],pagination:!0,formConfig:{labelWidth:120,schemas:[{label:"所属公司",field:"organName",component:"Input",colProps:{span:10}},{label:"电站",field:"powerStationName",component:"Input",colProps:{span:10}}]},useSearchForm:!0,showTableSetting:!1,rowSelection:{type:"checkbox"},handleSearchInfoFn(e){w.value.organName=e.organName,w.value.powerStationName=e.powerStationName},maxHeight:343});return re(()=>y(this,null,function*(){const e=yield te({dictTypeList:"check_period"});S.value=e.result.check_period.filter(t=>t.value=="1"),x.extend(ae),x.extend(ne)})),k({reloadGrid:L,getDataSource:C}),(e,t)=>{const a=N("a-button"),i=N("a-input-number"),d=N("a-date-picker"),Q=N("a-select");return m(),ce(pe,null,[O(r(U),{onRegister:r(A)},{toolbar:p(()=>[f.value=="stationChild"?(m(),b(a,{key:0,onClick:_,type:"primary",style:{"margin-right":"10px"},preIcon:r(F).ADD},{default:p(()=>[K("添加")]),_:1},8,["preIcon"])):I("",!0),f.value=="stationChild"?(m(),b(a,{key:1,onClick:B,style:{"margin-right":"10px"},preIcon:r(F).DELETE},{default:p(()=>[K("删除")]),_:1},8,["preIcon"])):I("",!0)]),acount:p(()=>[ge]),inspectionPeriod:p(()=>[fe]),startDate:p(()=>[he]),bodyCell:p(({column:n,record:o})=>[n.dataIndex==="acount"?(m(),b(i,{key:0,value:o[n.dataIndex],"onUpdate:value":s=>o[n.dataIndex]=s,style:{width:"100%"},min:1,max:50,disabled:r(l)>o.startDate},null,8,["value","onUpdate:value","disabled"])):I("",!0),n.dataIndex==="startDate"?(m(),b(d,{key:1,value:o[n.dataIndex],"onUpdate:value":s=>o[n.dataIndex]=s,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",style:{width:"100%"},disabled:r(l)>o.startDate,"disabled-date":s=>c(s,o.endDate)},null,8,["value","onUpdate:value","disabled","disabled-date"])):I("",!0),n.dataIndex==="endDate"?(m(),b(d,{key:2,value:o[n.dataIndex],"onUpdate:value":s=>o[n.dataIndex]=s,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",style:{width:"100%"},disabled:r(l)>o.endDate,"disabled-date":s=>D(s,o.startDate)},null,8,["value","onUpdate:value","disabled","disabled-date"])):I("",!0),n.dataIndex==="inspectionPeriod"?(m(),b(Q,{key:3,value:o[n.dataIndex],"onUpdate:value":s=>o[n.dataIndex]=s,options:S.value,style:{width:"100%"},disabled:r(l)>o.startDate},null,8,["value","onUpdate:value","options","disabled"])):I("",!0)]),_:1},8,["onRegister"]),O(X,{visible:Y.value,"onUpdate:visible":t[0]||(t[0]=n=>Y.value=n),maskClosable:!1,title:"选择电站标",onOk:H,width:1e3},{default:p(()=>[O(r(U),{class:"table-in-dialog",onRegister:r(W),searchInfo:V},null,8,["onRegister"])]),_:1},8,["visible"])],64)}}});const Ae=ie(be,[["__scopeId","data-v-d6dc68b4"]]);export{Ae as default};
//# sourceMappingURL=stationList-1d845d5c.js.map
