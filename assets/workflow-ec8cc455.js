var y=(u,I,l)=>new Promise((p,f)=>{var S=d=>{try{s(l.next(d))}catch(v){f(v)}},T=d=>{try{s(l.throw(d))}catch(v){f(v)}},s=d=>d.done?p(d.value):Promise.resolve(d.value).then(S,T);s((l=l.apply(u,I)).next())});import{ay as X,b as ee,au as te,ax as C,_ as oe}from"./index.js";import{B as ae}from"./BasicTable-0434a334.js";import{T as ie}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as ne}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{g as le,d as se,a as re,b as me,c as de}from"./index-890098c9.js";import{P as pe}from"./index-20519caf.js";import{D as H}from"./Dialog-0a006d82.js";import{_ as ce}from"./formDialog.vue_vue_type_script_setup_true_lang-c9268216.js";import{_ as ue}from"./importDialog.vue_vue_type_script_setup_true_lang-8ebbfadd.js";import{_ as fe}from"./bpmn-embedded-90db6ebb.js";import ve from"./SysCommonTree-90bc100f.js";import{d as be,r as ye,k as r,al as x,Z as i,a9 as c,aa as n,f as m,$ as ge,u as g,E as h,ad as w,_ as D,F as R,ac as L,a7 as he}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./tree-fc0e156a.js";import"./index-a66ceb78.js";import"./index.esm-c216ed00.js";import"./CommonTree-c4ed7838.js";import"./index-3801a970.js";import"./index-66d20ba6.js";import"./assign-37f1c13d.js";const _e=[{field:"key",label:"流程标识",component:"Input",componentProps:{placeholder:"请输入流程标识"},colProps:{span:8}},{field:"name",label:"流程名称",component:"Input",componentProps:{placeholder:"请输入流程名称"},colProps:{span:8}}],ke=[{title:"流程标识",dataIndex:"key",width:200},{title:"流程名称",dataIndex:"name",width:200},{title:"流程分类",dataIndex:"categoryName",width:80},{title:"表单信息",dataIndex:"formCustomCreatePath",width:300},{title:"创建时间",dataIndex:"createTime",width:150,customRender:({record:u})=>X(u.createTime,"YYYY-MM-DD")},{title:"最新部署的流程定义",dataIndex:"",children:[{title:"流程版本",dataIndex:"version",width:100},{title:"激活状态",dataIndex:"suspensionState",width:100},{title:"部署时间",dataIndex:"deploymentTime",width:150,customRender:({record:u})=>u.processDefinition?X(u.processDefinition.deploymentTime,"YYYY-MM-DD"):""}]}],Ce={class:"right-table-layout"},xe={key:2},we=be({__name:"workflow",setup(u){const{t:I}=ee(),l=te(),p=ye({}),f=r("");function S(e){p.value=null;let t="";e&&(t=e.id,e.parentId=="root"&&(t=""),p.value={typeId:e.id,fullName:e.fullName,id:e.id,name:e.name,kind:e.kind,existChildNode:e.children.length>0}),f.value=t,s()}const[T,{reload:s}]=ne({title:"流程模型",api:le,columns:ke,formConfig:{labelWidth:120,schemas:_e},useSearchForm:!0,showTableSetting:!0,bordered:!0,actionColumn:{width:430,title:I("common.operate"),dataIndex:"action",fixed:"right"},beforeFetch(e){return e.category=f.value,e}}),d=e=>e.processDefinition.suspensionState===1,v=r(!1),_=r(""),V=r({prefix:"flowable"}),P=r(!1),F=r({rule:[],option:{}}),$=r(!1),Y=r(),W=()=>{if(p.value==null||p.value.existChildNode){l.warning("请选择流程分类的末级节点。");return}$.value=!0,Y.value.open()},N=r(!1),B=r(),E=(e,t)=>{if(e=="create"&&(p.value==null||p.value.existChildNode)){l.warning("请选择流程分类的末级节点。");return}N.value=!0,B.value.open(e,t)},Z=e=>y(this,null,function*(){try{yield l.delConfirm("请确认是否删除此流程数据项？"),se(e).then(()=>{s()})}catch(t){console.error(t)}}),j=e=>y(this,null,function*(){const t=e.processDefinition.suspensionState;try{const b=e.id,k="请确认是否"+(t===1?"激活":"挂起")+'流程名字为"'+e.name+'"的数据项?';yield l.confirm(k),yield s()}catch(b){e.processDefinition.suspensionState=t===1?2:1}}),q=e=>y(this,null,function*(){try{const t=yield l.confirm("请确认是否部署该流程？");re(e.id).then(()=>{s()})}catch(t){console.error(t)}}),z=e=>{C(`/bpm/manage/wfeditor?modelId=${e.id}`,"设计流程")},G=e=>{C(`/bpm/manage/wftaskAssignRule?modelId=${e.id}`,"分配规则")},J=e=>{C(`/bpm/manage/wftaskDefinition?key=${e.key}&modelId=${e.id}`,"流程定义")},U=e=>y(this,null,function*(){e.formType==10?P.value=!0:C(e.formCustomCreatePath)}),K=e=>y(this,null,function*(){v.value=!0,me(e.id).then(t=>{_.value=t.bpmnXml})}),O=e=>y(this,null,function*(){return(yield de(e.id))?(l.error("此分类下存在流程模型，不能删除。"),!1):!0});return(e,t)=>{const b=x("a-button"),A=x("a-switch"),k=x("a-tag"),Q=x("form-create");return i(),c(g(pe),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:n(()=>[m(ve,{treeClass:"left-tree-layout",title:"流程分类",treeType:"bpm_model_category",toolbar:!0,search:!0,onSelect:S,beforeDelete:O}),ge("div",Ce,[m(g(ae),{onRegister:g(T),class:"fix-basic-table"},{toolbar:n(()=>[m(b,{type:"primary",onClick:t[0]||(t[0]=a=>E("create"))},{default:n(()=>[h(" 新建流程 ")]),_:1}),m(b,{type:"primary",onClick:W},{default:n(()=>[h(" 导入流程 ")]),_:1})]),bodyCell:n(({column:a,record:o})=>[a.key==="action"?(i(),c(g(ie),{key:0,actions:[{label:"修改流程",onClick:E.bind(null,"update",o.id)},{label:"设计流程",onClick:z.bind(null,o)},{label:"分配规则",onClick:G.bind(null,o)},{label:"发布流程",onClick:q.bind(null,o)},{label:"流程定义",onClick:J.bind(null,o)},{label:"删除",onClick:Z.bind(null,o.id)}]},null,8,["actions"])):a.dataIndex==="name"?(i(),c(b,{key:1,type:"link",onClick:M=>K(o)},{default:n(()=>[h(w(o.name),1)]),_:2},1032,["onClick"])):a.dataIndex==="formCustomCreatePath"?(i(),D(R,{key:2},[o.formType===10?(i(),c(b,{key:0,type:"link",onClick:M=>U(o)},{default:n(()=>[h(w(o.formName),1)]),_:2},1032,["onClick"])):o.formType===20?(i(),c(b,{key:1,type:"link",onClick:M=>U(o)},{default:n(()=>[h(w(o.formCustomCreatePath),1)]),_:2},1032,["onClick"])):(i(),D("label",xe,"暂无表单"))],64)):a.dataIndex==="suspensionState"?(i(),D(R,{key:3},[o.processDefinition?(i(),c(A,{key:0,checked:d(o),onChange:M=>j(o)},null,8,["checked","onChange"])):L("",!0)],64)):a.dataIndex==="version"?(i(),D(R,{key:4},[o.processDefinition?(i(),c(k,{key:0,color:"processing"},{default:n(()=>[h("v"+w(o.processDefinition.version),1)]),_:2},1024)):(i(),c(k,{key:1,color:"warning"},{default:n(()=>[h("未部署")]),_:1}))],64)):L("",!0)]),_:1},8,["onRegister"])]),m(ce,{ref_key:"formDialogRef",ref:B,onSuccess:g(s),category:f.value,visible:N.value,"onUpdate:visible":t[1]||(t[1]=a=>N.value=a)},null,8,["onSuccess","category","visible"]),m(ue,{ref_key:"importDialogRef",ref:Y,onSuccess:g(s),category:f.value,visible:$.value,"onUpdate:visible":t[2]||(t[2]=a=>$.value=a)},null,8,["onSuccess","category","visible"]),m(H,{title:"表单详情",visible:P.value,"onUpdate:visible":t[3]||(t[3]=a=>P.value=a),width:800,height:800,overflowY:"scroll",showBtm:!1},{default:n(()=>[m(Q,{rule:F.value.rule,option:F.value.option},null,8,["rule","option"])]),_:1},8,["visible"]),m(H,{title:"流程图",visible:v.value,"onUpdate:visible":t[5]||(t[5]=a=>v.value=a),width:800,height:800,overflowY:"scroll",overflowX:"scroll",showBtm:!1},{default:n(()=>[m(g(fe),he({key:"designer",modelValue:_.value,"onUpdate:modelValue":t[4]||(t[4]=a=>_.value=a),value:_.value},V.value,{prefix:V.value.prefix}),null,16,["modelValue","value","prefix"])]),_:1},8,["visible"])]),_:1})}}});const rt=oe(we,[["__scopeId","data-v-70260dd8"]]);export{rt as default};
//# sourceMappingURL=workflow-ec8cc455.js.map
