var w=(s,N,i)=>new Promise((h,l)=>{var E=c=>{try{u(i.next(c))}catch(y){l(y)}},F=c=>{try{u(i.throw(c))}catch(y){l(y)}},u=c=>c.done?h(c.value):Promise.resolve(c.value).then(E,F);u((i=i.apply(s,N)).next())});import{d as be,k as r,r as $,o as ye,al as b,Z as z,a9 as H,aa as a,f as e,$ as j,u as d,E as x,ac as R,_ as O,F as he,v as f,A as v}from"./vue-71d1abb3.js";import{a5 as C,au as Ie,av as k,_ as we}from"./index.js";import{B as Ce}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as xe}from"./useTable-109483b3.js";import{a2 as S}from"./antd-15ac76ed.js";import{P as ke}from"./index-20519caf.js";import{_ as M}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{C as Se}from"./CommonTree-c4ed7838.js";import"./index-74ac3212.js";import{D as Fe}from"./Dialog-0a006d82.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";function Te(){return[{title:"编码",dataIndex:"code",sorter:!0,resizable:!0,width:150},{title:"名称",dataIndex:"name",resizable:!0,width:150},{title:"状态",dataIndex:"statusText",resizable:!0,width:60,align:"left"},{title:"排序号",dataIndex:"sort",sorter:!0,resizable:!0,editRow:!0,width:100,align:"center",editComponent:"InputNumber",editComponentProps:{min:1,max:9999999,precision:2,formatter:s=>`${s}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:s=>s.replace(/\$\s?|(,*)/g,"")},editRule:De},{title:"Url",dataIndex:"url",resizable:!0,width:250,align:"left"},{title:"组件路径",dataIndex:"component",sorter:!0,resizable:!0,editRow:!0,width:250,align:"left"},{title:"备注",dataIndex:"remark",resizable:!0,width:150,align:"left"},{title:"系统",dataIndex:"systemKindText",resizable:!0,width:60,align:"left"},{title:"打开方式",dataIndex:"openWindowModelText",resizable:!0,width:80,align:"left"},{title:"全名称",dataIndex:"fullName",resizable:!0,align:"left"}]}const De=s=>w(void 0,null,function*(){return s?"":"不能为空"}),Ue=s=>C.post({url:"/system/function/list-tree",params:s},{}),ze=s=>C.post({url:"/system/function/page",params:s},{}),Ee=s=>C.post({url:"/system/function/create",params:s},{}),Re=s=>C.get({url:"/system/function/createPermission",params:s},{}),Y=s=>C.get({url:"/system/function/updateStatus",params:s},{}),Ne=s=>C.delete({url:"/system/function/delete?id="+s},{}),Be=s=>C.post({url:"/system/function/saveSort",params:s},{}),Oe=s=>C.get({url:"/system/function/getSort",params:s},{}),Ke=[{field:"code",component:"Input",label:"功能编码",required:!1},{field:"name",component:"Input",label:"功能名称",required:!1}],Ae={class:"right-table-layout"},Me={key:0,style:{color:"red"}},Pe={key:1,style:{color:"#30ca5a"}},Ve={class:"dialog-loading"},Le={key:0,class:"dialog-mask"},qe=be({__name:"index",setup(s){const{createConfirm:N}=Ie();r([]),r("calc(100vh - 223px)");const i=r({}),h=r(!1);r(!1);const l=r({}),E=r(""),F=r();let u=r(""),c=$({isManageFunction:0});const y=r(!1),P=r(!1),B=r(!1),m=$({}),V=r([]);r("");let Z=Te(),L=r;r("save"),r("");const G=()=>w(this,null,function*(){te();let o=Q().getFieldsValue();m.parentId=i.value.id,m.parentFullId=i.value.fullId,m.code=o.code,m.name=o.name;const t=ee();return m.pageNo=t.current,m.pageSize=t.pageSize,L=(yield ze(m)).result,L}),[J,{reload:T,getForm:Q,getDataSource:X,getPaginationRef:ee,clearSelectedRowKeys:te}]=xe({title:"功能列表",api:G,columns:Z,showTableSetting:!0,pagination:{pageSize:20},bordered:!0,rowKey:"id",rowSelection:{type:"radio",fixed:!0,onSelect:le},formConfig:{labelWidth:120,actionColOptions:{span:24},autoAdvancedLine:1,baseColProps:{span:7},schemas:Ke,autoSubmitOnEnter:!0,noHideBtnFlag:!0},useSearchForm:!0,handleSearchInfoFn(o){return o},sortFn:o=>{o.order?(m.sortField=o.field,m.sortOrder=o.order.replace("end","")):(m.sortField="",m.sortOrder="")}});function ae({keys:o,rows:t}){if(t&&t.length>0){const p=t[0];u.value=p.id,c=p}else u.value="",c=null}function le(o,t){t?(u.value=o.id,c=o):(u.value="",c=null)}function ne(){return w(this,null,function*(){var o;if(B.value=!1,i.value.id!=null){let t=i.value.id,p=yield Oe({tableName:"sys_function",step:1,parentId:t});l.value={},l.value.sort=p.result,i.value.id!="1"&&(l.value.systemKind=i.value.systemKind),E.value="添加功能",h.value=!0,(o=F.value)==null||o.resetFields()}else{S.error("请先选择父节点");return}})}function D(){return w(this,null,function*(){const o=yield Ue({});V.value=o.result})}function oe(){return w(this,arguments,function*(o=[]){i.value=o,P.value=o.id==="1",T()})}function se(){console.log(l),F.value.validateFields().then(()=>{y.value=!0;let o={id:i.value.id,fullId:i.value.fullId,fullName:i.value.fullName,fullSort:i.value.fullSort};l.value.parent=o,Ee(l.value).then(()=>{var t;S.success("保存成功"),D(),T(),y.value=!1,h.value=!1,(t=F.value)==null||t.resetFields()}).catch(()=>{y.value=!1})})}function ue(){h.value=!1}function re(){Object.assign(l.value,c),E.value="修改功能",B.value=!0,h.value=!0}function ie(){u.value!=""&&N({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return w(this,null,function*(){Ne(u.value).then(()=>{S.success("已删除。"),D(),T()})})}})}function de(){let o={id:u.value,status:1};Y(o).then(()=>{S.success("已启用。"),D(),T()})}function ce(){N({title:"禁用",iconType:"danger",content:"确认禁用此数据？",onOk(){return w(this,null,function*(){let t={id:u.value,status:0};Y(t).then(()=>{S.success("已禁用。"),D(),T()})})}})}function pe(){let o=X().map(t=>({id:t.id,sort:t.sort,parentId:t.parentId,fullId:t.fullId}));Be(o).then(t=>{S.success("已保存"),D(),T()})}function me(){Re({id:u.value}).then(o=>{o.result>0&&S.success("权限已生成。")})}return ye(()=>{D()}),(o,t)=>{const p=b("a-button"),q=b("a-input-number"),fe=b("a-spin"),K=b("a-input"),g=b("a-form-item"),_=b("a-col"),I=b("a-row"),A=b("a-textarea"),ve=b("a-switch"),ge=b("a-form");return z(),H(d(ke),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:a(()=>[e(Se,{title:"功能树",onSelect:oe,value:V.value,class:"left-tree-layout",canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),j("div",Ae,[e(d(Ce),{onRegister:d(J),class:"fix-basic-table",searchInfo:m,onSelectionChange:ae,onResizeColumn:t[2]||(t[2]=(n,U)=>U.width=n)},{toolbar:a(()=>[e(p,{type:"primary",preIcon:d(k).ADD,onClick:ne},{default:a(()=>[x("添加")]),_:1},8,["preIcon"]),e(p,{type:"primary",preIcon:d(k).EDIT,disabled:d(u)=="",onClick:re},{default:a(()=>[x("修改")]),_:1},8,["preIcon","disabled"]),e(p,{class:"red-btn",preIcon:d(k).DELETE,disabled:d(u)=="",onClick:ie},{default:a(()=>[x("删除")]),_:1},8,["preIcon","disabled"]),e(p,{class:"green-btn",preIcon:d(k).ENABLE,disabled:d(u)=="",onClick:t[0]||(t[0]=n=>de(1))},{default:a(()=>[x("启用")]),_:1},8,["preIcon","disabled"]),e(p,{class:"grey-btn",preIcon:d(k).DISABLE,disabled:d(u)=="",onClick:t[1]||(t[1]=n=>ce(0))},{default:a(()=>[x("禁用")]),_:1},8,["preIcon","disabled"]),e(p,{type:"primary",preIcon:d(k).ADD,onClick:pe},{default:a(()=>[x("保存排序号")]),_:1},8,["preIcon"]),e(p,{type:"primary",preIcon:d(k).AUTH,disabled:d(u)=="",onClick:me},{default:a(()=>[x("生成权限")]),_:1},8,["preIcon","disabled"])]),bodyCell:a(({text:n,column:U,record:W})=>[U.key==="sort"?(z(),H(q,{key:0,value:W[U.dataIndex],"onUpdate:value":_e=>W[U.dataIndex]=_e,min:1,defaultValue:"1",style:{margin:"-5px 0"}},null,8,["value","onUpdate:value"])):R("",!0),U.key==="statusText"?(z(),O(he,{key:1},[n=="无效"?(z(),O("span",Me,"无效")):R("",!0),n=="有效"?(z(),O("span",Pe,"有效")):R("",!0)],64)):R("",!0)]),_:1},8,["onRegister","searchInfo"])]),f(j("div",Ve,[e(fe)],512),[[v,y.value]]),e(Fe,{visible:h.value,"onUpdate:visible":t[14]||(t[14]=n=>h.value=n),smode:"normal",title:E.value,width:800,height:650,onConfirm:se,onCancel:ue,overflowY:"auto"},{default:a(()=>[e(ge,{ref_key:"functionFormRef",ref:F,model:l.value,name:"functionForm"},{default:a(()=>[e(I,{gutter:24},{default:a(()=>[f(e(_,{span:12},{default:a(()=>[e(g,{label:"编码",name:"code",labelCol:{span:6},rules:[{required:!0,message:"请输入编码"}]},{default:a(()=>[e(K,{value:l.value.code,"onUpdate:value":t[3]||(t[3]=n=>l.value.code=n),maxlength:"64"},null,8,["value"])]),_:1})]),_:1},512),[[v,!0]]),f(e(_,{span:12},{default:a(()=>[e(g,{label:"名称",name:"name",labelCol:{span:6},rules:[{required:!0,message:"请输入名称"}]},{default:a(()=>[e(K,{value:l.value.name,"onUpdate:value":t[4]||(t[4]=n=>l.value.name=n),maxlength:"128"},null,8,["value"])]),_:1})]),_:1},512),[[v,!0]])]),_:1}),e(I,{gutter:24},{default:a(()=>[f(e(_,{span:12},{default:a(()=>[e(g,{label:"系统类别",name:"systemKind",labelCol:{span:6},rules:[{required:!0,message:"请选择系统类别"}]},{default:a(()=>[e(M,{disabled:B.value||!P.value,value:l.value.systemKind,"onUpdate:value":t[5]||(t[5]=n=>l.value.systemKind=n),type:"sys_system_kind"},null,8,["disabled","value"])]),_:1})]),_:1},512),[[v,!0]]),f(e(_,{span:12},{default:a(()=>[e(g,{label:"类型",name:"nodeKind",labelCol:{span:6},rules:[{required:!0,message:"请选择类型"}]},{default:a(()=>[e(M,{disabled:B.value,value:l.value.nodeKind,"onUpdate:value":t[6]||(t[6]=n=>l.value.nodeKind=n),type:"sys_function_kind"},null,8,["disabled","value"])]),_:1})]),_:1},512),[[v,!0]])]),_:1}),e(I,{gutter:24},{default:a(()=>[f(e(_,{span:12},{default:a(()=>[e(g,{label:"图标",name:"icon",labelCol:{span:6}},{default:a(()=>[e(K,{value:l.value.icon,"onUpdate:value":t[7]||(t[7]=n=>l.value.icon=n),maxlength:"32"},null,8,["value"])]),_:1})]),_:1},512),[[v,!0]]),f(e(_,{span:12},{default:a(()=>[e(g,{label:"打开方式",name:"openWindowModel",labelCol:{span:6}},{default:a(()=>[e(M,{value:l.value.openWindowModel,"onUpdate:value":t[8]||(t[8]=n=>l.value.openWindowModel=n),type:"function_open_model"},null,8,["value"])]),_:1})]),_:1},512),[[v,!0]])]),_:1}),e(I,{gutter:24},{default:a(()=>[f(e(_,{span:24},{default:a(()=>[e(g,{label:"排序号",name:"sort",labelCol:{span:3}},{default:a(()=>[e(q,{min:1,value:l.value.sort,"onUpdate:value":t[9]||(t[9]=n=>l.value.sort=n)},null,8,["value"])]),_:1})]),_:1},512),[[v,!0]])]),_:1}),e(I,{gutter:24},{default:a(()=>[f(e(_,{span:24},{default:a(()=>[e(g,{label:"Url",name:"url",labelCol:{span:3}},{default:a(()=>[e(A,{rows:3,value:l.value.url,"onUpdate:value":t[10]||(t[10]=n=>l.value.url=n),maxlength:128,"show-count":""},null,8,["value"])]),_:1})]),_:1},512),[[v,!0]])]),_:1}),e(I,{gutter:24},{default:a(()=>[f(e(_,{span:24},{default:a(()=>[e(g,{label:"组件路径",name:"component",labelCol:{span:3}},{default:a(()=>[e(A,{rows:2,value:l.value.component,"onUpdate:value":t[11]||(t[11]=n=>l.value.component=n),maxlength:128,"show-count":""},null,8,["value"])]),_:1})]),_:1},512),[[v,!0]])]),_:1}),e(I,{gutter:24},{default:a(()=>[f(e(_,{span:24},{default:a(()=>[e(g,{label:"备注",name:"remark",labelCol:{span:3}},{default:a(()=>[e(A,{rows:3,value:l.value.remark,"onUpdate:value":t[12]||(t[12]=n=>l.value.remark=n),maxlength:256,"show-count":""},null,8,["value"])]),_:1})]),_:1},512),[[v,!0]])]),_:1}),e(I,{gutter:24},{default:a(()=>[f(e(_,{span:24},{default:a(()=>[e(g,{label:"管理功能",name:"isManageFunction",labelCol:{span:3}},{default:a(()=>[e(ve,{checkedValue:1,unCheckedValue:0,"checked-children":"是","un-checked-children":"否",checked:l.value.isManageFunction,"onUpdate:checked":t[13]||(t[13]=n=>l.value.isManageFunction=n)},null,8,["checked"])]),_:1})]),_:1},512),[[v,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),y.value?(z(),O("div",Le)):R("",!0)]),_:1})}}});const bt=we(qe,[["__scopeId","data-v-0462f7fb"]]);export{bt as default};
//# sourceMappingURL=index-9f324b62.js.map
