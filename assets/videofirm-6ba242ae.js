var o=(a,r,i)=>new Promise((f,b)=>{var l=n=>{try{m(i.next(n))}catch(v){b(v)}},w=n=>{try{m(i.throw(n))}catch(v){b(v)}},m=n=>n.done?f(n.value):Promise.resolve(n.value).then(l,w);m((i=i.apply(a,r)).next())});import{B as $}from"./BasicTable-0434a334.js";import{T as G}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as J}from"./useTable-109483b3.js";import{a2 as y}from"./antd-15ac76ed.js";import{a5 as h,b as Q,au as X,av as S,_ as Y}from"./index.js";import{P as ee}from"./index-20519caf.js";import{r as I,d as te,k as u,e as ne,o as ae,al as ie,Z as C,a9 as T,aa as g,f as R,u as p,E as D,ac as F,_ as le}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";const oe=a=>h.post({url:"/baseset/common/list-orgStationTree",params:a},{}),re=a=>h.get({url:"/baseset/videoFirm/page",params:a},{}),se=a=>h.post({url:"/baseset/videoFirm/create",params:a},{}),ue=a=>h.put({url:"/baseset/videoFirm/update",params:a},{}),de=a=>a.id?ue(a):se(a),ce=a=>h.delete({url:"/baseset/videoFirm/delete",params:a},{});I({spinning:!1});I({id:"",createTime:""});const pe={key:0,class:"dialog-mask"},fe=te({__name:"videofirm",setup(a){const r=u(),i=u(""),f=u(!1);Q();const{createConfirm:b}=X();I({});const l=I({folderId:"test"}),w=u([]),m=u(!1),n=u([]),v=[{title:"厂商名称",dataIndex:"name",width:80,editRow:!0,resizable:!0,sorter:!0,headAlign:"center",align:"left",editRule:(e,t)=>o(this,null,function*(){if(!e)return"不能为空"}),editComponent:"Input"},{title:"厂商类型",dataIndex:"firmType",width:100,editRow:!0,resizable:!0,sorter:!0,editComponent:"DictSelectBox",editComponentProps:{type:"videoFirmType"},editRule:(e,t)=>o(this,null,function*(){if(!e)return"不能为空"})},{title:"用户名",dataIndex:"userCode",width:80,editRow:!0,resizable:!0,sorter:!0,headAlign:"center",align:"left",editRule:(e,t)=>o(this,null,function*(){if(!e)return"不能为空"}),editComponent:"Input"},{title:"密码",dataIndex:"password",width:80,editRow:!0,resizable:!0,sorter:!0,headAlign:"center",align:"left",editRule:(e,t)=>o(this,null,function*(){if(!e)return"不能为空"}),editComponent:"Input"},{title:"appKey",dataIndex:"appKey",width:80,editRow:!0,resizable:!0,sorter:!0,headAlign:"center",align:"left",editRule:(e,t)=>o(this,null,function*(){if(!e)return"不能为空"}),editComponent:"Input"},{title:"秘钥",dataIndex:"secret",width:80,editRow:!0,resizable:!0,sorter:!0,headAlign:"center",align:"left",editRule:(e,t)=>o(this,null,function*(){if(!e)return"不能为空"}),editComponent:"Input"}];u();const z=ne(()=>n.value.length>0),k=u([]),E=()=>o(this,null,function*(){i.value="",r.value=null;let e=yield re(l);return k.value=e.result,k.value}),A={baseColProps:{span:8},labelWidth:120,showAdvancedButton:!1,schemas:[{label:"厂商名称",field:"name",component:"Input"}]},[B,{reload:_,getPaginationRef:K,getDataSource:L}]=J({title:"视频厂商",api:()=>o(this,null,function*(){const e=K();return l.pageNo=e.current,l.pageSize=e.pageSize,yield E()}),columns:v,useSearchForm:!0,showIndexColumn:!1,formConfig:A,showTableSetting:!0,resizeHeightOffset:33,pagination:!0,canResize:!0,bordered:!0,rowKey:"id",actionColumn:{width:80,title:"操作",dataIndex:"action"},rowSelection:{type:"checkbox",selectedRowKeys:n,onSelect:N,onSelectAll:O},handleSearchInfoFn(e){return l.name=e.name,e},sortFn:e=>{e.order?(l.sortField=e.field,l.sortOrder=e.order.replace("end","")):(l.sortField=null,l.sortOrder=null)}});function N(e,t){t?n.value=[...n.value,e.id]:n.value=n.value.filter(s=>s!==e.id)}function O(e,t,s){const c=s.map(d=>d.id);e?n.value=[...n.value,...c]:n.value=n.value.filter(d=>!c.includes(d))}function P(){return o(this,null,function*(){const e=yield oe({});w.value=e.result})}function H(){if(r.value!=null)return y.error("请先完成编辑。"),!1;const e=L(),t={editable:!0,isNew:!0,key:`${Date.now()}`};e.length==l.pageSize&&e.splice(-1),e.unshift(t),i.value=x(t),r.value=t}function V(){return n.value.length==0?(y.error("请选择数据"),!1):!0}function W(e){return e.editable?[{label:"保存",onClick:q.bind(null,e)},{label:"取消",popConfirm:{title:"是否取消修改",confirm:U.bind(null,e)}}]:[{label:"修改",icon:"clarity:bullet-list-line",disabled:M(e),onClick:j.bind(null,e)}]}function j(e){var t;i.value=x(e),r.value=e,(t=e.onEdit)==null||t.call(e,!0)}const x=e=>Reflect.has(e,"id")?Reflect.get(e,"id"):"",M=e=>i.value?i.value!==x(e):!1;function q(e){return o(this,null,function*(){var s;f.value=!0,(yield(s=e.onValid)==null?void 0:s.call(e))&&de(e).then(()=>{i.value="",r.value=null,y.success("已修改"),_(),f.value=!1})})}function U(e){var t;i.value="",r.value=null,f.value=!1,(t=e.onEdit)==null||t.call(e,!1,!1),_()}function Z(){V()&&b({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return o(this,null,function*(){ce("?ids="+n.value).then(()=>{y.success("已删除"),i.value="",r.value=null,n.value=[],_()})})}})}return ae(()=>{P()}),(e,t)=>{const s=ie("a-button");return C(),T(p(ee),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:g(()=>[R(p($),{onRegister:p(B),searchInfo:l,onResizeColumn:t[0]||(t[0]=(c,d)=>d.width=c),class:"fix-basic-table"},{toolbar:g(()=>[R(s,{type:"primary",preIcon:p(S).ADD,onClick:H},{default:g(()=>[D("添加")]),_:1},8,["preIcon"]),R(s,{class:"red-btn",disabled:!z.value,preIcon:p(S).DELETE,onClick:Z},{default:g(()=>[D("删除")]),_:1},8,["disabled","preIcon"])]),bodyCell:g(({column:c,record:d})=>[c.key==="action"?(C(),T(p(G),{key:0,actions:W(d)},null,8,["actions"])):F("",!0)]),_:1},8,["onRegister","searchInfo"]),m.value?(C(),le("div",pe)):F("",!0)]),_:1})}}});const Pe=Y(fe,[["__scopeId","data-v-a60fe82b"]]);export{Pe as default};
//# sourceMappingURL=videofirm-6ba242ae.js.map
