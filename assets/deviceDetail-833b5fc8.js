import{d as pe,k as v,r as O,w as R,o as ve,al as u,Z as r,a9 as C,aa as n,f as t,E as I,u as me,ac as D,_ as S,F as fe,ad as _e,$ as j,v as w,A as F,aG as be,aH as ge}from"./vue-71d1abb3.js";import{_ as q}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{D as z}from"./Dialog-0a006d82.js";import{a5 as d,bz as $,bv as P,_ as ye}from"./index.js";import{P as he,a2 as N}from"./antd-15ac76ed.js";const Ve=e=>d.post({url:"/baseset/devicetype/tree",params:e},{}),Oe=e=>d.post({url:"/baseset/comm-device/export-excel",params:e,responseType:"blob"},{isReturnNativeResponse:!0}),Re=e=>d.get({url:"/baseset/comm-device/page",params:e},{}),qe=e=>d.get({url:"/baseset/comm-device/getNodeByEsn",params:e},{}),ze=e=>d.post({url:"/baseset/areaset/list",params:e},{}),Le=e=>d.post({url:"/baseset/comm-device/create",params:e},{}),We=e=>d.put({url:"/baseset/comm-device/update",params:e},{}),He=e=>d.delete({url:"/baseset/comm-device/delete",params:e},{}),Ge=e=>d.post({url:"/baseset/devicemodel/list",params:e},{}),ke=e=>d.post({url:"/baseset/comm-device/detail/list",params:e},{}),xe=e=>d.post({url:"/baseset/comm-device/detail/create",params:e},{}),L=e=>d.put({url:"/baseset/comm-device/detail/update",params:e},{}),Me=e=>d.delete({url:"/baseset/comm-device/detail/delete?id="+e},{});function Ce(){return[{title:"状态",dataIndex:"connStatus",align:"center",width:120},{key:"1",title:"名称",dataIndex:"pvStringName",align:"center",width:120},{key:"2",title:"PV容量(kW）",dataIndex:"stringPvTotal",width:120,align:"center"},{key:"3",title:"组件类型",dataIndex:"pvModuleType",align:"center",width:120},{key:"4",title:"组件型号",dataIndex:"pvModuleModel",align:"center",width:120},{key:"5",title:"组件功率(Wp)",dataIndex:"pvModuleCapacity",align:"center",width:120},{key:"6",title:"组件数/串",dataIndex:"moduleNum",align:"center",width:120},{key:"7",title:"组串数/端口",dataIndex:"connPvstringNum",align:"center",width:120},{key:"8",title:"操作",dataIndex:"operation",align:"center"}]}const W=e=>(be("data-v-b61dbb56"),e=e(),ge(),e),Ie={key:2},De={key:3,class:"editable-row-operations"},Se={key:0},we=W(()=>j("a",null,"取消",-1)),Fe={key:1},Ne=["onClick"],Te=W(()=>j("a",null,"删除",-1)),Ue=pe({__name:"deviceDetail",props:{visible:Boolean,title:String,width:{type:Number,default:1200},height:{type:Number,default:750},record:{type:Object}},emits:["update:visible","cancelDetail"],setup(e,{expose:H,emit:G}){const m=e,E=v(""),A=v(),f=v(!1);v([{label:"单晶",value:"danjin"},{label:"多晶",value:"duojin"}]);const K=Ce(),g=v([]);v(!0);const Z=v(""),b=v(!1);function J(){G("cancelDetail"),P(!0)}const s=O({strInfomStart:"",strInfomEnd:"",pvModuleType:"",pvModuleModel:"",moduleNum:"",pvModuleCapacity:"",parentDeviceId:""});function Q(l){l.connStatus=l.connStatusFlag?1:0,L(l).then(()=>{y()})}function y(){ke({id:E.value}).then(l=>{l.result.forEach(a=>{a.connStatusFlag=a.connStatus==1}),g.value=l.result})}const _=O({});function X(l){_[l]=he(g.value.filter(a=>l===a.id)[0])}function Y(l,a){var T,h;let p=l[a];N.loading({content:"正在保存...",duration:0,key:"saving"});try{L(p).then(()=>{y()}),((T=p.onEdit)==null?void 0:T.call(p,!1,!0))&&(Z.value="",(h=p.onEdit)==null||h.call(p,!1,!1)),N.success({content:"数据已保存",key:"saving"})}catch(k){N.error({content:"保存失败",key:"saving"})}Object.assign(g.value.filter(k=>a===k.id)[0],l[a]),delete l[a]}function ee(l){delete _[l]}function te(l){Me(l).then(()=>{N.success("已删除。"),y()})}function ae(){f.value=!0,$()}function le(){A.value.validateFields().then(()=>{s.parentDeviceId=E,f.value=!1,xe(s).then(()=>{N.success("创建成功"),y(),f.value=!1,P()}).catch(()=>{f.value=!1})})}function ne(){f.value=!1}function oe(){b.value=!0,$()}function se(){b.value=!1,P(!0)}return H({closeModal:se,openModal:oe}),R(()=>m.visible,l=>{b.value=l,l?$():P()}),R(()=>m.record,l=>{E.value=l==null?void 0:l.id,y()}),ve(()=>{b.value=m.visible}),(l,a)=>{const p=u("a-button"),T=u("a-switch"),h=u("a-input"),k=u("a-typography-link"),V=u("a-popconfirm"),ie=u("a-table"),ue=u("a-divider"),U=u("a-input-number"),de=u("a-space"),x=u("a-form-item"),M=u("a-col"),B=u("a-row"),ce=u("a-form");return r(),C(z,{visible:b.value,"onUpdate:visible":a[7]||(a[7]=o=>b.value=o),title:"组串详情",smode:"simple",width:m.width,height:m.height,onClose:J},{footer:n(()=>[t(p,{key:"submit",type:"primary",onClick:ae},{default:n(()=>[I("添加")]),_:1})]),default:n(()=>[t(ie,{columns:me(K),"data-source":g.value,pagination:!1,size:"small",bordered:"",scroll:{x:500,y:"calc(100vh - 250px)"}},{bodyCell:n(({column:o,text:re,record:i})=>[o.dataIndex==="connStatus"?(r(),C(T,{key:0,checked:i.connStatusFlag,"onUpdate:checked":c=>i.connStatusFlag=c,onChange:c=>Q(i)},null,8,["checked","onUpdate:checked","onChange"])):D("",!0),o.dataIndex==="pvModuleType"?(r(),C(q,{key:1,style:{width:"90%"},value:i.pvModuleType,"onUpdate:value":c=>i.pvModuleType=c,type:"pvModuleType"},null,8,["value","onUpdate:value"])):D("",!0),["pvModuleModel","pvModuleCapacity","moduleNum","connPvstringNum"].includes(o.dataIndex)?(r(),S("div",Ie,[_[i.id]?(r(),C(h,{key:0,value:_[i.id][o.dataIndex],"onUpdate:value":c=>_[i.id][o.dataIndex]=c,style:{margin:"-5px 0"}},null,8,["value","onUpdate:value"])):(r(),S(fe,{key:1},[I(_e(re),1)],64))])):D("",!0),o.dataIndex==="operation"?(r(),S("div",De,[_[i.id]?(r(),S("span",Se,[t(k,{onClick:c=>Y(_,i.id)},{default:n(()=>[I("保存")]),_:2},1032,["onClick"]),t(V,{title:"确定关闭?",onConfirm:c=>ee(i.id)},{default:n(()=>[we]),_:2},1032,["onConfirm"])])):(r(),S("span",Fe,[j("a",{onClick:c=>X(i.id)},"修改",8,Ne),g.value.length?(r(),C(V,{key:0,title:"确定删除?",onConfirm:c=>te(i.id)},{default:n(()=>[Te]),_:2},1032,["onConfirm"])):D("",!0)]))])):D("",!0)]),_:1},8,["columns","data-source","scroll"]),t(z,{visible:f.value,"onUpdate:visible":a[6]||(a[6]=o=>f.value=o),smode:"normal",title:"添加-组串",width:800,height:400,onConfirm:le,onCancel:ne},{default:n(()=>[t(ce,{ref_key:"strForFormRef",ref:A,model:s,name:"strForForm"},{default:n(()=>[t(ue,{orientation:"left","orientation-margin":"10px"},{default:n(()=>[I("组串配置")]),_:1}),t(B,{gutter:24},{default:n(()=>[w(t(M,{span:22},{default:n(()=>[t(x,{label:"组串端口",name:"strInfomStart",labelAlign:"left",labelCol:{span:4,offset:1},rules:[{required:!0,message:"请输入组串范围"}]},{default:n(()=>[t(de,null,{default:n(()=>[t(U,{value:s.strInfomStart,"onUpdate:value":a[0]||(a[0]=o=>s.strInfomStart=o),min:1,max:m.record.maxPvstringNums},null,8,["value","max"]),I("- "),t(U,{value:s.strInfomEnd,"onUpdate:value":a[1]||(a[1]=o=>s.strInfomEnd=o),min:1,max:m.record.maxPvstringNums},null,8,["value","max"])]),_:1})]),_:1})]),_:1},512),[[F,!0]])]),_:1}),t(B,{gutter:24},{default:n(()=>[w(t(M,{span:11},{default:n(()=>[t(x,{label:"组件类型",name:"pvModuleType",labelAlign:"left",labelCol:{span:8,offset:2}},{default:n(()=>[t(q,{style:{width:"100%"},value:s.pvModuleType,"onUpdate:value":a[2]||(a[2]=o=>s.pvModuleType=o),type:"pvModuleType"},null,8,["value"])]),_:1})]),_:1},512),[[F,!0]]),w(t(M,{span:11},{default:n(()=>[t(x,{label:"组件型号",name:"pvModuleModel",labelAlign:"left",labelCol:{span:8,offset:2}},{default:n(()=>[t(h,{value:s.pvModuleModel,"onUpdate:value":a[3]||(a[3]=o=>s.pvModuleModel=o)},null,8,["value"])]),_:1})]),_:1},512),[[F,!0]])]),_:1}),t(B,{gutter:24},{default:n(()=>[w(t(M,{span:11},{default:n(()=>[t(x,{label:"组件数(块/串)",name:"moduleNum",labelAlign:"left",labelCol:{span:8,offset:2},rules:[{required:!0,message:"请输入数字"}]},{default:n(()=>[t(U,{value:s.moduleNum,"onUpdate:value":a[4]||(a[4]=o=>s.moduleNum=o)},null,8,["value"])]),_:1})]),_:1},512),[[F,!0]]),w(t(M,{span:11},{default:n(()=>[t(x,{label:"组件功率(W)",name:"pvModuleCapacity",labelAlign:"left",labelCol:{span:8,offset:2},rules:[{required:!0,message:"请输入数字"}]},{default:n(()=>[t(U,{value:s.pvModuleCapacity,"onUpdate:value":a[5]||(a[5]=o=>s.pvModuleCapacity=o)},null,8,["value"])]),_:1})]),_:1},512),[[F,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])]),_:1},8,["visible","width","height"])}}});const Pe=ye(Ue,[["__scopeId","data-v-b61dbb56"]]),Ke=Object.freeze(Object.defineProperty({__proto__:null,default:Pe},Symbol.toStringTag,{value:"Module"}));export{He as a,ze as b,Ge as c,Pe as d,Oe as e,qe as f,Ve as g,Re as h,Le as i,Ke as j,We as u};
//# sourceMappingURL=deviceDetail-833b5fc8.js.map
