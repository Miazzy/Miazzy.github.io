import{d as re,k as p,e as ue,r as he,w as F,u as pe,o as fe,al as C,Z as u,a9 as v,aa as x,$ as f,a6 as z,f as m,af as ye,B as ve,a5 as ke,ac as k,_ as V,ad as H,E as U,aG as ge,aH as xe}from"./vue-71d1abb3.js";import{D as me}from"./Dialog-0a006d82.js";import{I as _,_ as _e}from"./index.js";import{P as D,a2 as P,a0 as Z}from"./antd-15ac76ed.js";const we=h=>(ge("data-v-314ce2a3"),h=h(),xe(),h),Ie={class:"category-tree"},be={class:"category-search-box",style:{position:"relative"}},Ce=we(()=>f("span",{class:"search-title",style:{}},"搜索",-1)),Ee={class:"search-icon",style:{left:"300px"}},Ne={class:"search-icon",style:{left:"340px"}},ze={class:"employee-table"},De={class:"employee-content"},Me={class:"component-wrap"},Se={key:0},Be={key:1,class:"sort-cell"},$e={key:0,class:"editable-cell-input-wrapper"},Ve={key:2},Ke=re({__name:"IndexSelectDialog",props:{visible:Boolean,title:String,width:{type:Number,default:700},height:{type:Number,default:500},value:{type:Array,default:[]},tdata:{type:Array},tfields:{type:Object,default:{key:"id",title:"title",dept:"dept",postion:"postion"}},ticons:{type:Object,default:{parent:"ant-design:down-outlined",middle:"mingcute:department-line",leaf:"gridicons:multiple-users"}},message:{type:Object,default:{none:"当前没有被选数据，无法删除！",double:"该节点已经被选中！",delete:"请您确认是否删除所有勾选节点？"}},extraFooterBtn:{type:String,default:""},max:{type:Number,default:99},scolumns:{type:Array,default:[{title:"名称",dataIndex:"title",key:"title",fixed:!0,width:80},{title:"公司",dataIndex:"company",key:"company",fixed:!1,width:200},{title:"部门",dataIndex:"dept",key:"dept",fixed:!1,width:150},{title:"岗位",dataIndex:"postion",key:"postion",fixed:!1,width:150}]},rightColumns:{type:Array,default:[]},isEdit:{type:Boolean,default:!0}},emits:["update:visible","update:value","cancel","confirm","close","extra"],setup(h,{emit:E}){const l=h,M=p(!1),K=p([]),w=p(""),S=p(null),B=p({}),N=p([]),d=p([]),T=p(),$=p([]),O=p([]);p();const J=()=>{E("cancel")},Q=()=>{var t;if(l.max&&((t=d.value)==null?void 0:t.length)>l.max){P.warning(`最多选择${l.max}个！`);return}let e=!0;if(d.value.forEach(a=>{if(a.dataGranularity&&!a.dateType){e=!1;return}}),!e)return P.warning("请选择时间维度！");E("confirm",d.value)},W=()=>{E("cancel")},X=()=>{E("extra")},Y=e=>{M.value=e,E("update:visible",!1)},R=e=>!!T.value.get(e),ee=()=>{d.value&&d.value.length>0?Z.confirm({title:l.message.delete,wrapClassName:"dialog-modal-confirm",zIndex:10010,onOk(){d.value=[],B.value.checked=[],N.value=[]}}):Z.warning({wrapClassName:"dialog-modal-warning",zIndex:10010,title:l.message.none})},te=(e,t)=>{d.value=d.value.filter((a,o)=>o!==t)},A=e=>{const t={};for(const a in e)t[e[a]]=a;return t},j=(e,t,a="top",o)=>{const s=A(t);if(e.map(n=>{const r={};for(const i in n)i in s&&(s[i]=="title"||s[i]=="dept"||s[i]=="postion"?(r[s[i]]=n[i],r[i]=n[i]):s[i]=="id"?(r[i]=parseInt(Math.random()*100)+"@"+n[i],r[i]=n[i]):s[i]=="key"&&(r[s[i]]=parseInt(Math.random()*100)+"@"+n[i],r[i]=n[i])),r[i]=n[i],o&&(r.parent_node=o);T.value.set(n[l.tfields.key],n),$.value.push(r),n.children&&n.children.length>0&&j(n.children,t,"none",n)}),a=="top"){const n=$.value.filter((r,i,c)=>c.findIndex(y=>y[l.tfields.key]===r[l.tfields.key]&&y[l.tfields.title]===r[l.tfields.title])===i);$.value=n}},G=(e,t)=>{const a=A(t);return e.map(o=>{const s={};for(const n in o)n in a?a[n]=="title"||a[n]=="dept"||a[n]=="postion"?(s[a[n]]=o[n],s[n]=o[n]):(a[n]=="id"||a[n]=="key")&&(s[a[n]]=parseInt(Math.random()*100)+"@"+o[n],s[n]=o[n]):s[n]=o[n];return o.children&&o.children.length>0&&(s.children=G(o.children,t)),s})},ae=(e,t)=>{const a=new Map;return e.forEach(o=>{const s=o[t.key];a.set(s,o)}),a},L=()=>{const e=w.value?w.value.trim():"",t=$.value.filter(a=>!a.disabled&&a[l.tfields.title].includes(e));O.value=t,e.length===0&&(S.value=null)},le=(e,t)=>({onclick:o=>{const s=o.currentTarget;s.parentElement.querySelectorAll(".ant-table-row").forEach(r=>{r.classList.remove("selected")}),s.classList.add("selected"),S.value=e}}),ne=e=>{e.key==="Enter"&&e.preventDefault()},se=(e,t)=>{N.value=t.checkedNodes},oe=()=>{var e;if((e=S.value)!=null&&e.key){let t=q(K.value,S.value[l.tfields.key]),a=D(t);a.key=parseInt(Math.random()*100)+"@"+a.key,d.value.push(a)}else{let t=D(N.value);t.forEach(a=>{a.key=parseInt(Math.random()*100)+"@"+a.key}),d.value.push(...t)}N.value=[],B.value.checked=[]},ie=ue(()=>l.isEdit?l.rightColumns.length?l.rightColumns:[{title:"序号",dataIndex:"index",key:"index",width:60},{title:"名称",dataIndex:l.tfields.title,key:l.tfields.title},{title:"排序",dataIndex:"sort",key:"sort",width:80},{title:"操作",dataIndex:"action",key:"action",width:80}]:l.rightColumns.filter(e=>e.dataIndex!=="action"&&e.dataIndex!=="sort"));p([]);function q(e,t){let a;return e.forEach(o=>{var s;if(t===o[l.tfields.key]&&(a=o),(s=o.children)!=null&&s.length){let n=q(o.children,t);n&&(a=n)}}),a}const I=he({}),ce=(e,t)=>{I[e.key]={index:t+1}},de=(e,t)=>{let a=[...d.value];a.splice(I[e.key].index-1,0,a.splice(t,1)[0]),d.value=a,delete I[e.key]};return F(()=>l.value,e=>{d.value=D(e),d.value.forEach(t=>{t.key=parseInt(Math.random()*100)+"@"+t[l.tfields.key]})}),F(()=>l.visible,e=>{M.value=e,e?(d.value=D(l.value),d.value.forEach(t=>{t.key=parseInt(Math.random()*100)+"@"+t[l.tfields.key]})):(w.value="",N.value=[])},{deep:!0}),F(()=>l.tdata,e=>{const t=l==null?void 0:l.tfields,a=pe(l.tdata);K.value=G(a,t),T.value=ae(a,t),j(a,t,"top",null)}),fe(()=>{M.value=l.visible,d.value=D(l.value),d.value.forEach(e=>{e.key=parseInt(Math.random()*100)+"@"+e[l.tfields.key]})}),(e,t)=>{const a=C("a-input-search"),o=C("a-tree"),s=C("a-table"),n=C("a-input-number"),r=C("a-select"),i=C("a-button");return u(),v(me,{title:h.title,visible:M.value,"onUpdate:visible":Y,width:l.width,height:l.height,onClose:W},{default:x(()=>[f("div",{class:"dialog-content",style:z(`height: calc(${l.height}px - 90px)`)},[f("div",Ie,[f("div",{class:"category-content",style:z(`height: calc(${l.height}px - 130px)`)},[f("div",be,[Ce,m(a,{value:w.value,"onUpdate:value":t[0]||(t[0]=c=>w.value=c),class:"search-input",placeholder:"请输入搜索内容","enter-button":"",onChange:L,onSearch:L,onKeydown:ye(ve(ne,["prevent"]),["enter"])},null,8,["value","onKeydown"]),f("span",Ee,[m(_,{icon:"mdi:arrow-up",size:"22",class:"rotate-left",onClick:oe})]),f("span",Ne,[m(_,{icon:"material-symbols:delete-outline",size:"22",onClick:ee})])]),f("div",{class:"tree-value",style:z(`height: calc(${l.height}px - 200px);`)},[w.value.length<=0?(u(),v(o,{key:0,"tree-data":K.value,"show-icon":"","default-expand-all":!1,checkable:"",checkStrictly:"",selectable:!1,checkedKeys:B.value,"onUpdate:checkedKeys":t[1]||(t[1]=c=>B.value=c),onCheck:se},{switcherIcon:x(({switcherCls:c})=>[m(_,{icon:l.ticons.parent,size:"14",class:ke(c)},null,8,["icon","class"])]),icon:x(({key:c,isLeaf:g})=>[g&&!R(c)?(u(),v(_,{key:0,icon:l.ticons.leaf,size:"14"},null,8,["icon"])):k("",!0),!g&&!R(c)?(u(),v(_,{key:1,icon:l.ticons.middle,size:"14"},null,8,["icon"])):k("",!0)]),_:1},8,["tree-data","checkedKeys"])):k("",!0),w.value.length>0?(u(),v(s,{key:1,size:"small",columns:h.scolumns,"data-source":O.value,pagination:!1,scroll:{x:(l.width-30)/2,y:l.height-240},style:{"overflow-x":"hidden"},customRow:le},null,8,["columns","data-source","scroll"])):k("",!0)],4)],4)]),f("div",ze,[f("div",De,[f("div",{position:"center",class:"layout-content",style:z(`height: calc(${l.height}px - 120px);`)},[f("div",Me,[m(s,{size:"small",columns:ie.value,"data-source":d.value,pagination:!1,scroll:{y:l.height-190},style:z(`height: calc(${l.height}px - 130px);overflow-x: hidden;`)},{bodyCell:x(({record:c,index:g,column:y})=>[y.dataIndex==="index"?(u(),V("span",Se,H(g+1),1)):h.isEdit&&y.dataIndex==="sort"?(u(),V("div",Be,[I[c.key]?(u(),V("div",$e,[m(n,{value:I[c.key].index,"onUpdate:value":b=>I[c.key].index=b,min:1,max:d.value.length,controls:!1,size:"small"},null,8,["value","onUpdate:value","max"]),m(_,{icon:"ant-design:check-outlined",size:"12",style:{"margin-left":"4px"},onClick:b=>de(c,g)},null,8,["onClick"])])):(u(),v(_,{key:1,icon:"ant-design:drag-outlined",size:"12",onClick:b=>ce(c,g)},null,8,["onClick"]))])):h.isEdit&&y.dataIndex==="action"?(u(),V("a",Ve,[m(_,{icon:"ant-design:delete-filled",size:"12",color:"#ED6F6F",onClick:b=>te(c,g)},null,8,["onClick"])])):k("",!0),y.type==="select"&&c.dataGranularity?(u(),v(r,{key:3,size:"small",style:{width:"100%"},value:c[y.dataIndex],"onUpdate:value":b=>c[y.dataIndex]=b,"allow-clear":"",options:y.selectOptions[c.dataGranularity]},null,8,["value","onUpdate:value","options"])):k("",!0)]),_:1},8,["columns","data-source","scroll","style"])])],4)])])],4)]),footer:x(()=>[h.extraFooterBtn?(u(),v(i,{key:0,class:"btn-margin",type:"primary",onClick:X},{default:x(()=>[U(H(h.extraFooterBtn),1)]),_:1})):k("",!0),h.isEdit?(u(),v(i,{key:1,class:"btn-margin",onClick:J},{default:x(()=>[U("取消")]),_:1})):k("",!0),h.isEdit?(u(),v(i,{key:2,class:"btn-margin",type:"primary",onClick:Q},{default:x(()=>[U("确定")]),_:1})):k("",!0)]),_:1},8,["title","visible","width","height"])}}});const Re=_e(Ke,[["__scopeId","data-v-314ce2a3"]]);export{Re as default};
//# sourceMappingURL=IndexSelectDialog-0532c0db.js.map
