var U=(s,y,n)=>new Promise((l,i)=>{var f=u=>{try{p(n.next(u))}catch(I){i(I)}},x=u=>{try{p(n.throw(u))}catch(I){i(I)}},p=u=>u.done?l(u.value):Promise.resolve(u.value).then(f,x);p((n=n.apply(s,y)).next())});import{d as ne,r as N,k as F,al as h,Z as T,a9 as se,aa as a,f as e,$ as ue,u as d,E as S,ad as M,_ as B,F as ie,ac as L,v as b,A as g}from"./vue-71d1abb3.js";import{B as de}from"./BasicTable-0434a334.js";import{m as me}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as fe}from"./useTable-109483b3.js";import{a2 as m}from"./antd-15ac76ed.js";import{a5 as R,au as pe,b as ce,av as z,_ as ve}from"./index.js";import{P as _e}from"./index-20519caf.js";import j from"./SysCommonTree-90bc100f.js";import{D as A}from"./Dialog-0a006d82.js";import{a as be}from"./assign-37f1c13d.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./CommonTree-c4ed7838.js";import"./index-3801a970.js";import"./index-66d20ba6.js";const ge=s=>R.post({url:"/system/form-design/create",params:s},{}),Ie=s=>R.post({url:"/system/form-design/update",params:s},{}),P=s=>s.value.id?Ie(s.value):ge(s.value),he=(s,y)=>R.put({url:"/system/form-design/updateStatus?id="+s+"&status="+y},{}),ye=s=>R.get({url:"/system/form-design/page",params:s},{isOnlyResult:!0}),xe={labelWidth:120,actionColOptions:{span:24},autoAdvancedLine:1,showAdvancedButton:!0,baseColProps:{span:7},schemas:[{label:"编码:",field:"code",component:"Input"},{label:"名称:",field:"name",component:"Input"}]},Ce=[{title:"ID",dataIndex:"id",defaultHidden:!0},{title:"编码",dataIndex:"code",width:150,resizable:!0},{title:"名称",dataIndex:"name",width:200,resizable:!0},{title:"加载URL",dataIndex:"loadUrl",width:150,resizable:!0},{title:"备注",dataIndex:"remark",width:150,resizable:!0},{title:"状态",dataIndex:"status",width:150,resizable:!0},{title:"创建人",dataIndex:"createName",width:100,sorter:!0,align:"center",resizable:!0},{title:"创建时间",width:150,sorter:!0,dataIndex:"createTime",align:"center",resizable:!0},{title:"修改人",width:100,sorter:!0,dataIndex:"updateName",align:"center",resizable:!0},{title:"修改时间",width:150,sorter:!0,dataIndex:"updateTime",align:"center",resizable:!0}],we={class:"right-table-layout"},De={key:0,style:{color:"#19be6b"}},Fe={key:1,style:{color:"red"}},Se=ne({__name:"formDesign",setup(s){pe();const{t:y}=ce(),n=N({}),l=F({}),i=N({}),f=F(!1),x=N({}),p=F(!1),u=F(),I=F([]);function H(t){n.typeFullId=null,t&&(n.typeFullId=t.fullId,n.folderId=t.id,n.folderName=t.name,i.folderId=t.id,i.nodeType=t.parentId,i.existChildNode=t.children.length>0),t.parentId=="root"&&(n.folderId=""),C()}function V(t){return I.value.total>0&&m.warn("该节点存在子数据,不能删除。"),I.value.total==0}function K(){return U(this,null,function*(){if(!i.folderId){m.error("请选择树节点类型。");return}if(i.nodeType=="root"){m.error("根节点不能添加业务数据。");return}l.value={},l.value.folderId=i.folderId,l.value.status="1",f.value=!0})}function k(){const t=le();return t.length==0?(m.error("请选择一行数据。"),!1):t[0]}function W(){const t=k();t.id&&(l.value=t,l.value.status=String(t.status),f.value=!0)}function $(){u.value.validateFields().then(()=>{P(l).then(()=>{f.value=!1,m.success("操作成功。"),C()})})}function Z(){f.value=!1}function G(){O(1)}function J(){O(0)}function O(t){const r=k();r.id&&(r.status==t?(m.success(r.status==0?"该数据已禁用无须操作。":"该数据已启用无须操作。"),C()):he(r.id,t).then(()=>{m.success(t==0?"已禁用。":"已启用。"),C(),re()}))}function Q(){k().id&&(p.value=!0)}function X(){const t=k();if(x.nodeType=="root"){m.error("根节点不能添加业务数据。");return}l.value=t,l.value.folderId=x.folderId,P(l.value).then(()=>{p.value=!1,m.success("操作成功。"),C()})}function Y(t){n.typeFullId=null,t&&(x.folderId=t.id,x.nodeType=t.parentId),C()}const ee=()=>U(this,null,function*(){let t=yield ye(n);return I.value=t,t}),[te,{reload:C,getPaginationRef:ae,getSelectRows:le,clearSelectedRowKeys:re}]=fe({title:"表单设计",api:()=>U(this,null,function*(){const t=ae();return n.pageNo=t.current,n.pageSize=t.pageSize,yield ee()}),columns:Ce,useSearchForm:!0,formConfig:xe,showTableSetting:!1,bordered:!0,rowKey:"id",pagination:{defaultPageSize:1,pageSize:50},rowSelection:{type:"radio"},handleSearchInfoFn(t){return be(n,t),t},sortFn:t=>{t.order?(n.sortField=t.field,n.sortOrder=t.order.replace("end","")):(n.sortField=null,n.sortOrder=null)}});return(t,r)=>{const D=h("a-button"),w=h("a-input"),c=h("a-form-item"),v=h("a-col"),_=h("a-row"),oe=h("a-textarea"),q=h("a-form");return T(),se(d(_e),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:a(()=>[e(j,{treeClass:"left-tree-layout",toolbar:!0,search:!0,title:"表单设计",treeType:"sys_form_design",onSelect:H,beforeDelete:V}),ue("div",we,[e(d(de),{onRegister:d(te),class:"fix-basic-table",searchInfo:n,resizeHeightOffset:0},{toolbar:a(()=>[e(D,{type:"primary",preIcon:d(z).ADD,onClick:K},{default:a(()=>[S(M(d(y)("common.action.create")),1)]),_:1},8,["preIcon"]),e(D,{type:"primary",preIcon:d(z).EDIT,onClick:W},{default:a(()=>[S(M(d(y)("common.action.edit")),1)]),_:1},8,["preIcon"]),e(D,{class:"green-btn",preIcon:d(z).ENABLE,onClick:G},{default:a(()=>[S("启用")]),_:1},8,["preIcon"]),e(D,{class:"grey-btn",preIcon:d(z).DISABLE,onClick:J},{default:a(()=>[S("禁用")]),_:1},8,["preIcon"]),e(D,{type:"primary",onClick:Q},{default:a(()=>[S("移动")]),_:1})]),bodyCell:a(({column:o,text:E})=>[o.dataIndex==="status"?(T(),B(ie,{key:0},[E==1?(T(),B("span",De,"启用")):L("",!0),E==0?(T(),B("span",Fe,"禁用")):L("",!0)],64)):L("",!0)]),_:1},8,["onRegister","searchInfo"])]),e(A,{visible:f.value,"onUpdate:visible":r[8]||(r[8]=o=>f.value=o),title:"添加表单设计",maskClosable:!1,onOk:$,height:650,width:600,smode:"normal",onCancel:Z},{default:a(()=>[e(q,{ref_key:"fromRef",ref:u,model:l.value,name:"userForm",bordered:!1},{default:a(()=>[e(_,{gutter:24},{default:a(()=>[b(e(v,{span:23},{default:a(()=>[e(c,{label:"编码",name:"code",labelCol:{span:6},rules:[{required:!0,max:30}]},{default:a(()=>[e(w,{value:l.value.code,"onUpdate:value":r[0]||(r[0]=o=>l.value.code=o),maxlength:64},null,8,["value"])]),_:1})]),_:1},512),[[g,!0]])]),_:1}),e(_,null,{default:a(()=>[b(e(v,{span:23},{default:a(()=>[e(c,{label:"名称",name:"name",labelCol:{span:6},rules:[{required:!0,max:30}]},{default:a(()=>[e(w,{value:l.value.name,"onUpdate:value":r[1]||(r[1]=o=>l.value.name=o),maxlength:64},null,8,["value"])]),_:1})]),_:1},512),[[g,!0]])]),_:1}),e(_,null,{default:a(()=>[b(e(v,{span:23},{default:a(()=>[e(c,{label:"json",name:"jsonData",labelCol:{span:6},rules:[{required:!0}]},{default:a(()=>[e(oe,{value:l.value.jsonData,"onUpdate:value":r[2]||(r[2]=o=>l.value.jsonData=o)},null,8,["value"])]),_:1})]),_:1},512),[[g,!0]])]),_:1}),e(_,null,{default:a(()=>[b(e(v,{span:23},{default:a(()=>[e(c,{label:"URL",name:"loadUrl",labelCol:{span:6},rules:[{required:!0,max:1e3}]},{default:a(()=>[e(w,{value:l.value.loadUrl,"onUpdate:value":r[3]||(r[3]=o=>l.value.loadUrl=o),maxlength:64},null,8,["value"])]),_:1})]),_:1},512),[[g,!0]])]),_:1}),e(_,null,{default:a(()=>[b(e(v,{span:23},{default:a(()=>[e(c,{label:"明细URL",name:"detailUrl",labelCol:{span:6},rules:[{required:!1,max:1e3}]},{default:a(()=>[e(w,{value:l.value.detailUrl,"onUpdate:value":r[4]||(r[4]=o=>l.value.detailUrl=o),maxlength:250},null,8,["value"])]),_:1})]),_:1},512),[[g,!0]])]),_:1}),e(_,null,{default:a(()=>[b(e(v,{span:23},{default:a(()=>[e(c,{label:"明细字段",name:"detailField",labelCol:{span:6},rules:[{required:!1,max:1e3}]},{default:a(()=>[e(w,{value:l.value.detailField,"onUpdate:value":r[5]||(r[5]=o=>l.value.detailField=o),maxlength:250},null,8,["value"])]),_:1})]),_:1},512),[[g,!0]])]),_:1}),e(_,null,{default:a(()=>[b(e(v,{span:23},{default:a(()=>[e(c,{label:"备注",name:"remark",labelCol:{span:6},rules:[{required:!1,max:1e3}]},{default:a(()=>[e(w,{value:l.value.remark,"onUpdate:value":r[6]||(r[6]=o=>l.value.remark=o),maxlength:64},null,8,["value"])]),_:1})]),_:1},512),[[g,!0]])]),_:1}),e(_,null,{default:a(()=>[b(e(v,{span:23},{default:a(()=>[e(c,{name:"status",label:"状态",labelCol:{span:6},rules:[{required:!0,message:"请选择状态"}]},{default:a(()=>[e(me,{value:l.value.status,"onUpdate:value":r[7]||(r[7]=o=>l.value.status=o),type:"enable_or_disable"},null,8,["value"])]),_:1})]),_:1},512),[[g,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"]),e(A,{visible:p.value,"onUpdate:visible":r[9]||(r[9]=o=>p.value=o),title:"移动表单设计",maskClosable:!1,onOk:X,toolbar:!1,search:!1,height:650,width:600,smode:"normal"},{default:a(()=>[e(q,{ref:"moveFromRef",model:l.value,name:"userForm"},{default:a(()=>[e(j,{title:"移动表单设计",treeClass:"w-6/6",treeType:"sys_form_design",onSelect:Y})]),_:1},8,["model"])]),_:1},8,["visible"])]),_:1})}}});const rt=ve(Se,[["__scopeId","data-v-a966bde3"]]);export{rt as default};
//# sourceMappingURL=formDesign-3d852602.js.map
