var g=(L,p,S)=>new Promise((l,v)=>{var R=o=>{try{w(S.next(o))}catch(a){v(a)}},k=o=>{try{w(S.throw(o))}catch(a){v(a)}},w=o=>o.done?l(o.value):Promise.resolve(o.value).then(R,k);w((S=S.apply(L,p)).next())});import{b as xe,au as Te,a7 as Ne,av as f,ax as F,az as Fe,aA as Ke,_ as ze}from"./index.js";import{_ as Oe}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{d as Pe,ax as Ee,k as c,r as Z,o as Me,al as h,Z as Ye,a9 as Le,aa as i,f as r,$ as Y,E as m,u as n,ad as y}from"./vue-71d1abb3.js";import{P as We}from"./index-20519caf.js";import{C as Be}from"./CommonTree-c4ed7838.js";import{e as K}from"./download-03e71dd5.js";import{B as z}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as O}from"./useTable-109483b3.js";import{a2 as I}from"./antd-15ac76ed.js";import{e as Ve,a as Ae,b as He,c as Ue,g as $e,d as P,f as je,h as qe,i as Ze,j as Ge}from"./index-caeea670.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-3801a970.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useRender-21ce56fb.js";const Je={class:"right-table-layout tab-model"},Qe={class:"tab-button-div"},Xe={id:"report-tab-content",class:"tab-table-div tab-table-content"},et=Pe({__name:"index",setup(L){const{t:p}=xe(),{createConfirm:S}=Te();Ee();const l=c("day"),v=c(""),R=c(""),k=c(""),w=c(""),o=Z({dayPageSize:20,dayPageNo:1,daySortField:"",daySortOrder:"",weekPageSize:20,weekPageNo:1,weekSortField:"",weekSortOrder:"",monthPageSize:20,monthPageNo:1,monthSortField:"",monthSortOrder:"",yearPageSize:20,yearPageNo:1,yearSortField:"",yearSortOrder:""}),a=Z({dataId:"",stationId:"",periodId:"",rangeData:null,status:"",reportType:"",periodName:"",stationName:"",searchId:"",nodeKindId:"",nodeId:"",pageSize:20,pageNo:1}),W=c([]),B=c([]),V=c([]),A=c([]),H=c([]),G=c([]),J=c([]);c([]),c([]),c([]),c([]);const Q=t=>g(this,null,function*(){const e=ee();return a.pageNo=e.current,a.pageSize=e.pageSize,a.sortField=o.daySortField,a.sortOrder=o.daySortOrder,(yield je(a)).result}),[X,{reload:U,getPaginationRef:ee,getSelectRows:te,getSelectRowKeys:tt,clearSelectedRowKeys:at}]=O({api:Q,target:"#report-tab-content",targetTabKey:"day",targetTabValue:l,rowKey:"id",columns:B,useSearchForm:!1,showTableSetting:!1,bordered:!0,pagination:{pageSize:20,pageSizeOptions:["20","50","100","200"]},resizeHeightOffset:0,rowSelection:{type:"radio"},sortFn:t=>{t.order?(o.daySortField=t.field,o.daySortOrder=t.order.replace("end","")):(o.daySortField=null,o.daySortOrder=null)}});function ae({keys:t,rows:e}){if(e&&e.length>0){const d=e[0];v.value=d.id}else v.value=""}const oe=t=>g(this,null,function*(){const e=re();t.pageNo=e.current,t.pageSize=e.pageSize,t.sortField=o.weekSortField,t.sortOrder=o.weekSortOrder;let d=yield qe(t);return console.info("周报:",d),d.result}),[ne,{reload:$,getPaginationRef:re,getSelectRows:le,getSelectRowKeys:ot}]=O({api:oe,target:"#report-tab-content",targetTabKey:"week",targetTabValue:l,rowKey:"id",columns:V,useSearchForm:!1,showTableSetting:!1,bordered:!0,pagination:{pageSize:20,pageSizeOptions:["20","50","100","200"]},resizeHeightOffset:0,rowSelection:{type:"radio"},sortFn:t=>{t.order?(o.weekSortField=t.field,o.weekSortOrder=t.order.replace("end","")):(o.weekSortField=null,o.weekSortOrder=null)}});function ie({keys:t,rows:e}){if(e&&e.length>0){const d=e[0];R.value=d.id}else R.value=""}const se=t=>g(this,null,function*(){const e=ce();a.pageNo=e.current,a.pageSize=e.pageSize,a.sortField=o.monthSortField,a.sortOrder=o.monthSortOrder;let d=yield Ze(a);return console.info("月报:",d),d.result}),[de,{reload:j,getPaginationRef:ce,getSelectRows:pe,getSelectRowKeys:nt}]=O({api:se,target:"#report-tab-content",targetTabKey:"month",targetTabValue:l,rowKey:"id",columns:A,useSearchForm:!1,showTableSetting:!1,bordered:!0,pagination:{pageSize:20,pageSizeOptions:["20","50","100","200"]},resizeHeightOffset:0,rowSelection:{type:"radio"},sortFn:t=>{t.order?(o.monthSortField=t.field,o.monthSortOrder=t.order.replace("end","")):(o.monthSortField=null,o.monthSortOrder=null)}});function ue({keys:t,rows:e}){if(e&&e.length>0){const d=e[0];k.value=d.id}else k.value=""}const me=t=>g(this,null,function*(){const e=fe();return t.pageNo=e.current,t.pageSize=e.pageSize,t.sortField=o.monthSortField,t.sortOrder=o.monthSortOrder,(yield Ge(t)).result}),[ge,{reload:q,getPaginationRef:fe,getSelectRows:ye,getSelectRowKeys:rt}]=O({api:me,target:"#report-tab-content",targetTabKey:"year",targetTabValue:l,rowKey:"id",columns:H,useSearchForm:!1,showTableSetting:!1,bordered:!0,pagination:{pageSize:20,pageSizeOptions:["20","50","100","200"]},resizeHeightOffset:0,rowSelection:{type:"radio"},sortFn:t=>{t.order?(o.yearSortField=t.field,o.yearSortOrder=t.order.replace("end","")):(o.yearSortField=null,o.yearSortOrder=null)}});function Se({keys:t,rows:e}){if(e&&e.length>0){const d=e[0];w.value=d.id}else w.value=""}function we(){E()}function _(){if(a.periodId==""||a.periodId==null){I.error("请先选择电站分期。");return}let t={stationId:a.stationId,stationName:a.stationName,periodId:a.periodId,periodName:a.periodName,organId:a.organId,organName:a.organName};l.value=="day"?F("/po/elec/produce/dayReportCreate","添加日报",t):l.value=="week"?F("/po/elec/produce/weekReportCreate","添加周报",t):l.value=="month"?F("/po/elec/produce/monthReportCreate","添加月报",t):l.value=="year"&&F("/po/elec/produce/yearReportCreate","添加年报",t)}function C(){S({title:"提示",iconType:"warning",content:"确定要导出所有记录？",onOk(){return g(this,null,function*(){l.value=="day"?yield Ve(a).then(e=>{K(e==null?void 0:e.data,"生产日报.xls")}):l.value=="week"?yield Ae(a).then(e=>{K(e==null?void 0:e.data,"生产周报.xls")}):l.value=="month"?yield He(a).then(e=>{K(e==null?void 0:e.data,"生产月报.xls")}):l.value=="year"&&(yield Ue(a).then(e=>{K(e==null?void 0:e.data,"生产年报.xls")})),I.success("导出成功。")})}})}function be(t=[]){t!=null?(a.stationId=t.powerStationId,a.stationName=t.powerStationName,a.periodId=t.powerStationPeriodId,a.periodName=t.powerStationPeriodName,a.organId=t.organId,a.organName=t.organName,a.nodeKindId=t.nodeKindId,a.searchId=t.id):(a.stationId=null,a.stationName=null,a.periodId=null,a.periodName=null,a.organId=null,a.organName=null,a.nodeKindId=null,a.searchId=null),M()}function he(){return g(this,null,function*(){const t=yield $e({});W.value=t.result})}const E=()=>g(this,null,function*(){l.value=="day"?U():l.value=="week"?$():l.value=="month"?j():l.value=="year"&&q()});function M(){o.dayPageNo=1,o.weekPageNo=1,o.monthPageNo=1,o.yearPageNo=1,l.value==="day"?U():l.value==="week"?$():l.value==="month"?j():l.value==="year"&&q()}function ve(){a.rangeData=null,a.status=null,a.billCode=null,M()}function D(t){Fe(t.id)}function Re(){let t=[];return l.value=="day"?t=te():l.value=="week"?t=le():l.value=="month"?t=pe():l.value=="year"&&(t=ye()),t.length==0?(I.info("请选择数据。"),!1):t[0]}function x(){return g(this,null,function*(){let t=Re();t&&S({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return g(this,null,function*(){if(t.status!=0){I.error("非草稿状态不能删除。");return}yield Ke(t.processInstanceId),I.success("已删除。"),E()})}})})}const ke=t=>g(this,null,function*(){t.key&&(l.value=t.key),E()}),Ie=()=>g(this,null,function*(){B.value=P("day"),V.value=P("week"),A.value=P("month"),H.value=P("year")});return Me(()=>g(this,null,function*(){yield Ie(),yield he(),Ne.getInstance().listen("day-report",ke)})),(t,e)=>{const d=h("a-input"),T=h("a-form-item"),_e=h("a-range-picker"),u=h("a-button"),Ce=h("a-form"),N=h("a-tab-pane"),De=h("a-tabs");return Ye(),Le(n(We),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:i(()=>[r(Be,{title:"电站组织",onSelect:be,value:W.value,class:"left-tree-layout",canEdit:!1,canAdd:!1,canDelete:!1,onRefresh:t.refreshTree,isShowOperationBtns:!1,expandedKeys:J.value,selectedKeys:G.value,fieldNames:{key:"id",title:"name"}},null,8,["value","onRefresh","expandedKeys","selectedKeys"]),Y("div",Je,[Y("div",Qe,[r(Ce,{model:a,name:"searchInfo",layout:"inline",autocomplete:"off"},{default:i(()=>[r(T,{label:"单据编号",name:"billCode",style:{width:"22%","margin-left":"60px"},colon:!1},{default:i(()=>[r(d,{style:{width:"100%"},value:a.billCode,"onUpdate:value":e[0]||(e[0]=s=>a.billCode=s)},null,8,["value"])]),_:1}),r(T,{label:"日期",name:"rangeData",style:{width:"22%","margin-left":"60px"},colon:!1},{default:i(()=>[r(_e,{style:{width:"100%"},value:a.rangeData,"onUpdate:value":e[1]||(e[1]=s=>a.rangeData=s),"value-format":"YYYY-MM-DD"},null,8,["value"])]),_:1}),r(T,{label:"审核状态",name:"status",style:{width:"22%","margin-left":"60px"},colon:!1},{default:i(()=>[r(Oe,{style:{width:"100%"},value:a.status,"onUpdate:value":e[2]||(e[2]=s=>a.status=s),type:"bpm_process_instance_result"},null,8,["value"])]),_:1}),r(T,{class:"tab-button"},{default:i(()=>[r(u,{style:{margin:"0 10px 0 8px"},onClick:ve},{default:i(()=>[m("重置")]),_:1}),r(u,{type:"primary",class:"tab-button",onClick:M},{default:i(()=>[m("查询")]),_:1})]),_:1})]),_:1},8,["model"])]),Y("div",Xe,[r(De,{activeKey:l.value,"onUpdate:activeKey":e[11]||(e[11]=s=>l.value=s),onChange:e[12]||(e[12]=s=>we(l.value))},{default:i(()=>[r(N,{key:"day",tab:"日报"},{default:i(()=>[r(n(z),{onRegister:n(X),class:"w-4/4 xl:w-12/12",searchInfo:a,onSelectionChange:ae,onResizeColumn:e[3]||(e[3]=(s,b)=>b.width=s),onRowDbClick:e[4]||(e[4]=s=>D(s))},{toolbar:i(()=>[r(u,{type:"primary",preIcon:n(f).ADD,onClick:_},{default:i(()=>[m(y(n(p)("common.action.create")),1)]),_:1},8,["preIcon"]),r(u,{type:"primary",preIcon:n(f).EDIT,disabled:v.value=="",onClick:x},{default:i(()=>[m(y(n(p)("common.delText")),1)]),_:1},8,["preIcon","disabled"]),r(u,{class:"red-btn",preIcon:n(f).DELETE,onClick:C},{default:i(()=>[m(y(n(p)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister","searchInfo"])]),_:1}),r(N,{key:"week",tab:"周报"},{default:i(()=>[r(n(z),{onRegister:n(ne),class:"w-4/4 xl:w-12/12",searchInfo:a,onSelectionChange:ie,onResizeColumn:e[5]||(e[5]=(s,b)=>b.width=s),onRowDbClick:e[6]||(e[6]=s=>D(s))},{toolbar:i(()=>[r(u,{type:"primary",preIcon:n(f).ADD,onClick:_},{default:i(()=>[m(y(n(p)("common.action.create")),1)]),_:1},8,["preIcon"]),r(u,{type:"primary",preIcon:n(f).EDIT,disabled:R.value=="",onClick:x},{default:i(()=>[m(y(n(p)("common.delText")),1)]),_:1},8,["preIcon","disabled"]),r(u,{class:"red-btn",preIcon:n(f).DELETE,onClick:C},{default:i(()=>[m(y(n(p)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister","searchInfo"])]),_:1}),r(N,{key:"month",tab:"月报"},{default:i(()=>[r(n(z),{onRegister:n(de),class:"w-4/4 xl:w-12/12",searchInfo:a,onSelectionChange:ue,onResizeColumn:e[7]||(e[7]=(s,b)=>b.width=s),onRowDbClick:e[8]||(e[8]=s=>D(s))},{toolbar:i(()=>[r(u,{type:"primary",preIcon:n(f).ADD,onClick:_},{default:i(()=>[m(y(n(p)("common.action.create")),1)]),_:1},8,["preIcon"]),r(u,{type:"primary",preIcon:n(f).EDIT,disabled:k.value=="",onClick:x},{default:i(()=>[m(y(n(p)("common.delText")),1)]),_:1},8,["preIcon","disabled"]),r(u,{class:"red-btn",preIcon:n(f).DELETE,onClick:C},{default:i(()=>[m(y(n(p)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister","searchInfo"])]),_:1}),r(N,{key:"year",tab:"年报"},{default:i(()=>[r(n(z),{onRegister:n(ge),class:"w-4/4 xl:w-12/12",searchInfo:a,onSelectionChange:Se,onResizeColumn:e[9]||(e[9]=(s,b)=>b.width=s),onRowDbClick:e[10]||(e[10]=s=>D(s))},{toolbar:i(()=>[r(u,{type:"primary",preIcon:n(f).ADD,onClick:_},{default:i(()=>[m(y(n(p)("common.action.create")),1)]),_:1},8,["preIcon"]),r(u,{type:"primary",preIcon:n(f).EDIT,disabled:w.value=="",onClick:x},{default:i(()=>[m(y(n(p)("common.delText")),1)]),_:1},8,["preIcon","disabled"]),r(u,{class:"red-btn",preIcon:n(f).DELETE,onClick:C},{default:i(()=>[m(y(n(p)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister","searchInfo"])]),_:1})]),_:1},8,["activeKey"])])])]),_:1})}}});const Pt=ze(et,[["__scopeId","data-v-1c1cad39"]]);export{Pt as default};
//# sourceMappingURL=index-c8aae4cd.js.map
