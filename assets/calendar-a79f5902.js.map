{"version":3,"file":"calendar-a79f5902.js","sources":["../../src/views/oa/attend/calendar.vue"],"sourcesContent":["<template>\n  <PageWrapper\n    :detail=\"true\"\n    dense\n    contentFullHeight\n    fixedHeight\n    contentClass=\"fix-detail-page\"\n    style=\"position: relative\"\n  >\n    <div class=\"load\">\n      <a-spin :spinning=\"formState.spinning\" tip=\"Loading...\">\n        <div class=\"process-box\">\n          <div class=\"header-box\">\n            <div class=\"header-left\">月排班日历</div>\n          </div>\n          <div class=\"content\">\n            <a-form ref=\"formRef\" :model=\"formState\" labelAlign=\"right\" autocomplete=\"off\">\n              <a-card title=\"基本信息\" :bordered=\"false\">\n                <a-row :gutter=\"32\">\n                  <a-col v-show=\"true\" :span=\"12\">\n                    <a-form-item\n                      name=\"stationName\"\n                      label=\"电站\"\n                      :labelCol=\"{ class: 'detail-label' }\"\n                    >\n                      <a-input disabled v-model:value=\"formState.stationName\" />\n                    </a-form-item>\n                  </a-col>\n                  <a-col v-show=\"true\" :span=\"12\">\n                    <a-form-item\n                      label=\"月份\"\n                      name=\"month\"\n                      :labelCol=\"{ class: 'detail-label' }\"\n                      :rules=\"[{ required: true, message: '请选择月份' }]\"\n                    >\n                      <a-date-picker\n                        disabled\n                        v-model:value=\"formState.month\"\n                        picker=\"month\"\n                        format=\"YYYY-MM\"\n                        value-format=\"YYYY-MM\"\n                        :style=\"`width: 100%`\"\n                        :maxlength=\"7\"\n                      />\n                    </a-form-item>\n                  </a-col>\n                </a-row>\n\n                <a-row :gutter=\"32\">\n                  <a-col v-show=\"true\" :span=\"12\">\n                    <a-form-item\n                      name=\"period\"\n                      label=\"排班周期\"\n                      :labelCol=\"{ class: 'detail-label' }\"\n                    >\n                      <a-input disabled v-model:value=\"formState.period\" />\n                    </a-form-item>\n                  </a-col>\n                </a-row>\n\n                <a-row :gutter=\"32\">\n                  <a-col v-show=\"true\" :span=\"24\">\n                    <a-form-item name=\"remark\" label=\"备注\" :labelCol=\"{ class: 'detail-label' }\">\n                      <a-textarea\n                        disabled\n                        v-model:value=\"formState.remark\"\n                        row=\"4\"\n                        :maxlength=\"1000\"\n                        show-count\n                      />\n                    </a-form-item>\n                  </a-col>\n                </a-row>\n              </a-card>\n            </a-form>\n\n            <a-card title=\"排班明细\" :bordered=\"false\">\n              <a-calendar v-model:value=\"value\" @panel-change=\"onPanelChange\">\n                <template #headerRender=\"{ value: current, onChange }\">\n                  <div class=\"ant-picker-calendar-header\">\n                    <a-row type=\"flex\" justify=\"end\">\n                      <a-col>\n                        <a-select\n                          :dropdown-match-select-width=\"false\"\n                          class=\"ant-picker-calendar-year-select\"\n                          :value=\"String(current.year())\"\n                          @change=\"\n                            (newYear) => {\n                              onChange(current.year(+newYear));\n                            }\n                          \"\n                        >\n                          <a-select-option\n                            v-for=\"item in getYears(current)\"\n                            :key=\"String(item.value)\"\n                            class=\"year-item\"\n                          >\n                            {{ item.label }}\n                          </a-select-option>\n                        </a-select>\n                      </a-col>\n                      <a-col>\n                        <a-select\n                          :dropdown-match-select-width=\"false\"\n                          class=\"ant-picker-calendar-month-select\"\n                          :value=\"String(current.month())\"\n                          @change=\"\n                            (selectedMonth) => {\n                              onChange(current.month(parseInt(String(selectedMonth), 10)));\n                            }\n                          \"\n                        >\n                          <a-select-option\n                            v-for=\"(val, index) in getMonths()\"\n                            :key=\"String(index)\"\n                            class=\"month-item\"\n                          >\n                            {{ val }}\n                          </a-select-option>\n                        </a-select>\n                      </a-col>\n                    </a-row>\n                  </div>\n                </template>\n                <template #dateCellRender=\"{ current }\">\n                  <ul class=\"events\">\n                    <li\n                      v-for=\"item in detailDataSource\"\n                      :key=\"item.id\"\n                      :class=\"\n                        current.format('YYYY-MM') !== value?.format('YYYY-MM')\n                          ? 'custom-calendar-grey'\n                          : ''\n                      \"\n                    >\n                      <div\n                        v-if=\"item.day === current.format('YYYY-MM-DD')\"\n                        class=\"custom-calendar-header\"\n                        :type=\"item.dayType\"\n                        >{{ item.dayTypeText }}</div\n                      >\n                      <div\n                        v-if=\"item.day === current.format('YYYY-MM-DD')\"\n                        class=\"custom-calendar-content\"\n                      >\n                        <div> <span>白班：</span>{{ item.dayPersonName }} </div>\n                        <div> <span>夜班：</span>{{ item.nightPersonName }} </div>\n                      </div>\n                    </li>\n                  </ul>\n                </template>\n              </a-calendar>\n            </a-card>\n          </div>\n        </div>\n      </a-spin>\n    </div>\n  </PageWrapper>\n</template>\n\n<script lang=\"ts\" setup>\n  import { reactive, ref, onMounted, UnwrapRef } from 'vue';\n  import dayjs, { Dayjs } from 'dayjs';\n  import type { SelectProps } from 'ant-design-vue';\n  import { assign } from 'lodash-es';\n  import * as CommonApi from '/@/api/baseset/common';\n  import * as AttendApi from '/@/api/oa/att';\n  import { urlToPath } from '/@/utils/route';\n\n  const formRef = ref();\n  const formState: UnwrapRef<any> = reactive({ spinning: false, status: 1 });\n  const stationPersonOptions = ref<SelectProps['options']>([]) as any;\n  const detailDataSource = ref<any[]>();\n  const value = ref<Dayjs>();\n\n  const weekdaysShort = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];\n  dayjs.locale(\n    {\n      ...dayjs.Ls['zh-cn'],\n      weekdaysMin: weekdaysShort,\n    },\n    undefined,\n    true,\n  );\n\n  const onPanelChange = async (value: Dayjs) => {\n    const month = value.format('YYYY-MM');\n    const data = await AttendApi.getPage({ stationId: formState.stationId, period: month });\n    let id = '';\n    if (data.list && data.list.length > 0) {\n      id = data.list[0].id;\n    }\n    initDetailData(id);\n  };\n\n  const getMonths = () => {\n    const months = Array<string>();\n    for (let i = 1; i <= 12; i++) {\n      months.push(`${i}月`);\n    }\n    return months;\n  };\n\n  const getYears = (value: Dayjs) => {\n    const year = value.year();\n    const years = Array<any>();\n    for (let i = year - 10; i < year + 10; i += 1) {\n      years.push({ value: i, label: `${i}年` });\n    }\n    return years;\n  };\n\n  function initStationPersonOptions() {\n    CommonApi.getStationPerson(formState.stationId).then((data) => {\n      stationPersonOptions.value = [];\n      if (data && data.length > 0) {\n        data.forEach((item) => {\n          stationPersonOptions.value.push({ value: item.name, lable: item.userId });\n        });\n      }\n    });\n  }\n\n  const initDetailData = async (id: string) => {\n    if (!id) {\n      detailDataSource.value = [];\n      return;\n    }\n    const detailObj = await AttendApi.getDetailList(id);\n    detailDataSource.value = detailObj.result;\n  };\n\n  const initFormState = async () => {\n    const { params } = urlToPath();\n    assign(formState, params);\n    formState.spinning = false;\n    value.value = dayjs(formState.month);\n  };\n\n  function initSelectOptions() {\n    initStationPersonOptions();\n  }\n\n  onMounted(async () => {\n    await initFormState();\n    await initSelectOptions();\n    await initDetailData(formState.id);\n  });\n</script>\n<style lang=\"less\" scoped>\n  @import '/@/design/biz/bizForm.less';\n</style>\n<style lang=\"less\" scoped>\n  .events {\n    margin: 0;\n    padding: 0;\n    list-style: none;\n  }\n\n  .events .ant-badge-status {\n    width: 100%;\n    overflow: hidden;\n    font-size: 12px;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  .notes-month {\n    font-size: 28px;\n    text-align: center;\n  }\n\n  .notes-month section {\n    font-size: 28px;\n  }\n\n  .custom-calendar-header {\n    background-color: #00b5ad;\n    color: #fff;\n    text-align: center;\n  }\n\n  .custom-calendar-header[type='legal_holidays'] {\n    background-color: #e45050;\n  }\n\n  .custom-calendar-content span {\n    font-weight: 700;\n  }\n\n  .custom-calendar-content > div {\n    margin-top: 8px;\n  }\n\n  .custom-calendar-grey {\n    opacity: 0.5;\n  }\n</style>\n<style lang=\"less\">\n  .theme1 {\n    .custom-calendar-content > div {\n      color: #fff;\n    }\n  }\n\n  .theme3 {\n    .custom-calendar-content > div {\n      color: #666;\n    }\n  }\n</style>\n"],"names":["formRef","ref","formState","reactive","stationPersonOptions","detailDataSource","value","weekdaysShort","dayjs","__spreadProps","__spreadValues","onPanelChange","__async","month","data","AttendApi.getPage","id","initDetailData","getMonths","months","i","getYears","year","years","initStationPersonOptions","CommonApi.getStationPerson","item","detailObj","AttendApi.getDetailList","initFormState","params","urlToPath","assign","initSelectOptions","onMounted"],"mappings":"s7CAyKE,MAAMA,EAAUC,IACVC,EAA4BC,GAAS,CAAE,SAAU,GAAO,OAAQ,EAAG,EACnEC,EAAuBH,EAA4B,CAAA,CAAE,EACrDI,EAAmBJ,IACnBK,EAAQL,IAERM,EAAgB,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,IAAI,EACzDC,EAAA,OACJC,EAAAC,EAAA,GACKF,EAAM,GAAG,OAAO,GADrB,CAEE,YAAaD,CACf,GACA,OACA,EAAA,EAGI,MAAAI,EAAuBL,GAAiBM,EAAA,sBACtC,MAAAC,EAAQP,EAAM,OAAO,SAAS,EAC9BQ,EAAO,MAAMC,GAAkB,CAAE,UAAWb,EAAU,UAAW,OAAQW,CAAA,CAAO,EACtF,IAAIG,EAAK,GACLF,EAAK,MAAQA,EAAK,KAAK,OAAS,IAC7BE,EAAAF,EAAK,KAAK,CAAC,EAAE,IAEpBG,EAAeD,CAAE,CAAA,GAGbE,EAAY,IAAM,CACtB,MAAMC,EAAS,QACf,QAASC,EAAI,EAAGA,GAAK,GAAIA,IAChBD,EAAA,KAAK,GAAGC,CAAC,GAAG,EAEd,OAAAD,CAAA,EAGHE,EAAYf,GAAiB,CAC3B,MAAAgB,EAAOhB,EAAM,OACbiB,EAAQ,QACd,QAAS,EAAID,EAAO,GAAI,EAAIA,EAAO,GAAI,GAAK,EACpCC,EAAA,KAAK,CAAE,MAAO,EAAG,MAAO,GAAG,CAAC,IAAK,EAElC,OAAAA,CAAA,EAGT,SAASC,GAA2B,CAClCC,GAA2BvB,EAAU,SAAS,EAAE,KAAMY,GAAS,CAC7DV,EAAqB,MAAQ,GACzBU,GAAQA,EAAK,OAAS,GACnBA,EAAA,QAASY,GAAS,CACAtB,EAAA,MAAM,KAAK,CAAE,MAAOsB,EAAK,KAAM,MAAOA,EAAK,MAAA,CAAQ,CAAA,CACzE,CACH,CACD,CACH,CAEM,MAAAT,EAAwBD,GAAeJ,EAAA,sBAC3C,GAAI,CAACI,EAAI,CACPX,EAAiB,MAAQ,GACzB,MACF,CACA,MAAMsB,EAAY,MAAMC,GAAwBZ,CAAE,EAClDX,EAAiB,MAAQsB,EAAU,MAAA,GAG/BE,EAAgB,IAAYjB,EAAA,sBAC1B,KAAA,CAAE,OAAAkB,GAAWC,KACnBC,GAAO9B,EAAW4B,CAAM,EACxB5B,EAAU,SAAW,GACfI,EAAA,MAAQE,EAAMN,EAAU,KAAK,CAAA,GAGrC,SAAS+B,GAAoB,CACFT,GAC3B,CAEA,OAAAU,GAAU,IAAYtB,EAAA,sBACpB,MAAMiB,EAAc,EACpB,MAAMI,EAAkB,EAClB,MAAAhB,EAAef,EAAU,EAAE,CAAA,EAClC"}