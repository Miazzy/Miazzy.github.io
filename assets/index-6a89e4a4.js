var m=(t,s,l)=>new Promise((b,r)=>{var g=u=>{try{c(l.next(u))}catch(n){r(n)}},w=u=>{try{c(l.throw(u))}catch(n){r(n)}},c=u=>u.done?b(u.value):Promise.resolve(u.value).then(g,w);c((l=l.apply(t,s)).next())});import{B as C}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as Y}from"./useTable-109483b3.js";import{K as P}from"./antd-15ac76ed.js";import{a0 as z,a5 as I,b as T,au as v,aO as F,av as R}from"./index.js";import{d as _,r as D,ax as E,u as p,o as V,al as N,Z as j,a9 as M,aa as h,f as x,E as k,ad as B}from"./vue-71d1abb3.js";import{e as q}from"./download-03e71dd5.js";import{P as A}from"./index-20519caf.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";const H=t=>I.post({url:"/bi/elec/export-planned",params:t,responseType:"blob"},{isReturnNativeResponse:!0}),L=t=>I.get({url:"/bi/elec/planned",params:t},{isOnlyResult:!0}),W=t=>I.get({url:"/bi/common/org/info",params:t},{isOnlyResult:!0}),K=t=>I.post({url:"/baseset/common/list-station",params:t}),U={labelWidth:120,actionColOptions:{span:24},autoAdvancedLine:1,showAdvancedButton:!0,baseColProps:{span:7},autoSubmitOnEnter:!0,noHideBtnFlag:!0,schemas:[{field:"yearValue",label:"年份",required:!0,component:"YearPicker",defaultValue:P(new Date).format("YYYY"),componentProps:{format:"YYYY",valueFormat:"YYYY",style:{width:"100%"}}},{field:"orgId",label:"所属公司",component:"ApiSelect",componentProps:{options:[],api:W,placeholder:"请选择所属公司"},show:z().isMultiOrganization},{field:"stationId",label:"电站名称",component:"ApiSelect",componentProps:{options:[],api:()=>m(void 0,null,function*(){const t=yield K({}),s=[];return t.result.forEach(l=>{s.push({value:l.powerStationId,label:l.powerStationName})}),s}),placeholder:"请输入电站名称"}},{field:"periodName",label:"期数",component:"Input",componentProps:{placeholder:"请输入期数名称"}}]},S=[{title:"所属公司",dataIndex:"stationOrganName",width:150,customCell:t=>({rowSpan:t.rowOrgSpan}),resizable:!0,ifShow:z().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",width:150,customCell:t=>({rowSpan:t.rowStationSpan}),resizable:!0},{title:"分期",dataIndex:"periodName",width:150,customCell:t=>({rowSpan:t.rowPeriodSpan}),resizable:!0},{title:"并网容量(MW)",dataIndex:"connectCapacity",width:150,resizable:!0,customCell:t=>({rowSpan:t.rowPeriodSpan})},{title:"线损率(%)",dataIndex:"lineLossRate",width:150,resizable:!0,customCell:t=>({rowSpan:t.rowPeriodSpan})},{title:"类型",dataIndex:"type",width:150,resizable:!0},{title:"当前完成情况",dataIndex:"thisTotal",width:150,resizable:!0},{title:"当年完成情况",dataIndex:"fullTotal",width:150,resizable:!0},{title:"1月",dataIndex:"jan",width:150,resizable:!0},{title:"2月",dataIndex:"feb",width:150,resizable:!0},{title:"3月",dataIndex:"mar",width:150,resizable:!0},{title:"4月",dataIndex:"apr",width:150,resizable:!0},{title:"5月",dataIndex:"may",width:150,resizable:!0},{title:"6月",dataIndex:"jun",width:150,resizable:!0},{title:"7月",dataIndex:"jul",width:150,resizable:!0},{title:"8月",dataIndex:"aug",width:150,resizable:!0},{title:"9月",dataIndex:"sept",width:150,resizable:!0},{title:"10月",dataIndex:"oct",width:150,resizable:!0},{title:"11月",dataIndex:"nov",width:150,resizable:!0},{title:"12月",dataIndex:"dev",width:150,resizable:!0}],he=_({__name:"index",setup(t){const{t:s}=T(),{createConfirm:l,createMessage:b}=v(),r=D({});function g(){l({title:s("common.message.confirmTitle"),iconType:"warning",content:s("common.message.exportMessage"),onOk(){return m(this,null,function*(){Object.assign(r,f().getFieldsValue()),r.filename="计划电量统计.xls",r.excelList=S,yield H(r).then(e=>{q(e==null?void 0:e.data,r.filename)}),r.filename=null,r.excelList=null,b.success(s("common.exportSuccessText"))})}})}const w=E(),{currentRoute:c}=w,n=p(c).query,y=()=>m(this,null,function*(){let o=f().getFieldsValue();return yield L(o)});V(()=>m(this,null,function*(){if(n){const o=f().getFieldsValue();n.startDate&&(o.yearValue=F(n.startDate,"YYYY")),n.stationId!=null&&(o.stationId=n.stationId),n.orgId!=null&&(o.orgId=n.orgId),f().setFieldsValue(o)}}));const[O,{getForm:f}]=Y({title:"计划电量统计",api:y,columns:S,formConfig:U,useSearchForm:!0,bordered:!0,pagination:!1,showIndexColumn:!0,showTableSetting:!0,tableSetting:{redo:!1,size:!1,setting:!0,fullScreen:!1},afterFetch:function(o){const e={};for(let d=0;d<o.length;d++){const a=o[d];e[a.stationOrganId]&&e[a.stationOrganId]++,e[a.stationId]&&e[a.stationId]++,e[a.periodId]&&e[a.periodId]++,e[a.stationOrganId]||(e[a.stationOrganId]=1),e[a.stationId]||(e[a.stationId]=1),e[a.periodId]||(e[a.periodId]=1)}for(let d=0;d<o.length;d++){const a=o[d];for(const i in e)a.stationOrganId===i&&(a.rowOrgSpan=e[i],e[i]=0),a.stationId===i&&(a.rowStationSpan=e[i],e[i]=0),a.periodId===i&&(a.rowPeriodSpan=e[i],e[i]=0)}return o}});return(o,e)=>{const d=N("a-button");return j(),M(p(A),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:h(()=>[x(p(C),{onRegister:p(O),onResizeColumn:e[0]||(e[0]=(a,i)=>i.width=a)},{toolbar:h(()=>[x(d,{class:"yellow-btn",preIcon:p(R).EXPORT,onClick:g},{default:h(()=>[k(B(p(s)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])]),_:1})}}});export{he as default};
//# sourceMappingURL=index-6a89e4a4.js.map
