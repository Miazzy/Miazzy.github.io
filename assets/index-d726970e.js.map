{"version":3,"file":"index-d726970e.js","sources":["../../src/views/oa/askreport/index.vue"],"sourcesContent":["<template>\n  <PageWrapper dense contentFullHeight fixedHeight contentClass=\"flex\" style=\"position: relative\">\n    <div class=\"fix-basic-table\">\n      <div class=\"tab-button-div\">\n        <a-form\n          :model=\"searchInfo\"\n          name=\"searchInfo\"\n          layout=\"inline\"\n          autocomplete=\"off\"\n          class=\"search-form\"\n        >\n          <a-form-item\n            name=\"name\"\n            label=\"主题\"\n            :labelCol=\"{ span: 12 }\"\n            :rules=\"[{ required: false, message: '请输入主题' }]\"\n            style=\"width: 26.5%\"\n            :colon=\"false\"\n          >\n            <a-input v-model:value=\"searchInfo.name\" placeholder=\"请输入主题\" style=\"width: 100%\" />\n          </a-form-item>\n          <a-form-item\n            name=\"startDate\"\n            label=\"呈报时间\"\n            :labelCol=\"{ span: 6 }\"\n            :rules=\"[{ required: false, message: '请选择呈报时间' }]\"\n            style=\"width: 26.5%\"\n            :colon=\"false\"\n          >\n            <a-range-picker\n              v-model:value=\"searchTimeInfo.searchTime\"\n              format=\"YYYY-MM-DD HH:mm\"\n              value-format=\"YYYY-MM-DD HH:mm:00\"\n              style=\"width: 100%\"\n              show-time\n            />\n          </a-form-item>\n          <a-form-item\n            name=\"status\"\n            label=\"审批状态\"\n            :labelCol=\"{ span: 12 }\"\n            :rules=\"[{ required: false, message: '请选择审批状态' }]\"\n            style=\"width: 26.5%\"\n            :colon=\"false\"\n          >\n            <DictSelectBox\n              :type=\"`bpm_process_instance_result`\"\n              @change=\"`()=> searchInfo.status = value`\"\n              v-model:value=\"searchInfo.status\"\n              :width=\"'100%'\"\n            />\n          </a-form-item>\n\n          <a-form-item class=\"search-btns\">\n            <a-button style=\"margin: 0 8px\" @click=\"resetFrom\">重置</a-button>\n            <a-button type=\"primary\" class=\"tab-button\" @click=\"searchList\">查询</a-button>\n          </a-form-item>\n        </a-form>\n      </div>\n      <div class=\"tab-table-div\">\n        <BasicTable\n          @register=\"registerTable\"\n          @resize-column=\"(w, col) => (col.width = w)\"\n          @row-db-click=\"(record) => handleView(record)\"\n        >\n          <template #toolbar>\n            <a-button type=\"primary\" :preIcon=\"IconEnum.ADD\" @click=\"handleCreate\">添加</a-button>\n            <!-- <a-button type=\"primary\" @click=\"handleUpdateIndex\">修改</a-button> -->\n            <a-button class=\"red-btn\" :preIcon=\"IconEnum.DELETE\" @click=\"handleDelete\"\n              >删除</a-button\n            >\n            <!-- <a-button type=\"primary\" :preIcon=\"IconEnum.EXPORT\" @click=\"handleExportIndex\"\n                >导出</a-button\n              > -->\n          </template>\n\n          <template #bodyCell=\"{ column, text, record }\">\n            <template v-if=\"column.key === 'action'\">\n              <TableAction\n                :actions=\"[\n                  {\n                    icon: IconEnum.LOG,\n                    label: '进度',\n                    onClick: handleView.bind(null, record),\n                  },\n                  {\n                    icon: IconEnum.DELETE,\n                    danger: true,\n                    label: '取消',\n                    ifShow: () => {\n                      return record.status == 0;\n                    },\n                    onClick: handleCancel.bind(null, record),\n                  },\n                ]\"\n              />\n            </template>\n          </template>\n        </BasicTable>\n      </div>\n    </div>\n    <!-- 数据表格 -->\n  </PageWrapper>\n\n  <!-- <settlemenElecModal @reload=\"handleReload\" @register=\"registerDrawer\" /> -->\n</template>\n<script lang=\"ts\" setup>\n  import type { FormProps } from '/@/components/Form/src/types/form';\n  import { onMounted, reactive, ref } from 'vue';\n  import { BasicTable, useTable, TableAction, SorterResult } from '/@/components/Table';\n  import { PageWrapper } from '/@/components/Page';\n  import { message, SelectProps } from 'ant-design-vue';\n  import { jsonToSheetXlsx } from '/@/components/Excel';\n  import DictSelectBox from '@/components/Framework/Combox/DictSelectBox.vue';\n  import {\n    getaskReportList,\n    formState,\n    getIndex,\n    deleteaskReport,\n    getaskReportListColumns,\n    exportExcel,\n  } from './askReport';\n  import { assign } from 'lodash-es';\n  import { useRouter } from 'vue-router';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { ElMessageBox } from 'element-plus';\n  import { MsgManager } from '/@/message/MsgManager';\n  import * as ProcessInstanceApi from '@/api/bpm/processInstance';\n  import { IconEnum } from '@/enums/appEnum';\n  import { addTabPage } from '@/utils/route';\n  import { useMessage } from '@/hooks/web/useMessage';\n  import * as CommonUtil from '/@/utils/common';\n\n  const { createConfirm } = useMessage();\n  const { t } = useI18n();\n  const searchInfo = reactive<any>({\n    name: null,\n    startDate: null,\n    endDate: null,\n    status: null,\n  }); // 查询信息\n\n  const searchTimeInfo = reactive<any>({\n    searchTime: null,\n  }); // 查询信息\n\n  const checkedKeys = ref<Array<string | number>>([]); // 复选框的选择的数据\n  const areaColumn = getaskReportListColumns();\n  const router = useRouter();\n  let partyDatasArr = ref<SelectProps['options']>([\n    { label: '草稿', value: '0' },\n    { label: '处理中', value: '1' },\n    { label: '通过', value: '2' },\n    { label: '不通过', value: '3' },\n    { label: '已取消', value: '4' },\n    { label: '已终止', value: '5' },\n    { label: '退回', value: '6' },\n  ]);\n  const indexList = ref<Array<any>>([]);\n  const getaskReportListByParam = async () => {\n    let areaList = await getaskReportList(searchInfo);\n    indexList.value = areaList.result;\n    return areaList.result;\n  };\n  const searchForm: FormProps = {\n    baseColProps: { lg: 6, md: 8 },\n    labelWidth: 90,\n    schemas: [],\n  };\n\n  // 注册Drawer\n  // const [registerDrawer, { openDrawer: opensettlemenElecModal }] = useDrawer();\n\n  const [registerTable, { reload, getPaginationRef }] = useTable({\n    title: '请示报告列表',\n    api: async () => {\n      const paginationRef = getPaginationRef() as any;\n      searchInfo.pageNo = paginationRef.current;\n      searchInfo.pageSize = paginationRef.pageSize;\n      let dataObj = await getaskReportListByParam();\n      return dataObj;\n    },\n    columns: areaColumn,\n    useSearchForm: false,\n    formConfig: searchForm,\n    showTableSetting: true,\n    bordered: true,\n    // eslint-disable-next-line no-dupe-keys\n    rowKey: 'id',\n    // actionColumn: {\n    //   width: 160,\n    //   title: '操作',\n    //   dataIndex: 'action',\n    // },\n    rowSelection: {\n      type: 'radio',\n      onChange: onSelect,\n    },\n    sortFn: (sortInfo: SorterResult) => {\n      if (sortInfo.order) {\n        searchInfo.sortField = sortInfo.field;\n        searchInfo.sortOrder = sortInfo.order.replace('end', '');\n      } else {\n        searchInfo.sortField = null;\n        searchInfo.sortOrder = null;\n      }\n    },\n  });\n  function onSelect(record, selected) {\n    if (selected.length > 0) {\n      checkedKeys.value = [record[0]];\n    } else {\n      checkedKeys.value = [];\n    }\n  }\n  function onSelectAll(selected, selectedRows, changeRows) {\n    const changeIds = changeRows.map((item) => item.id);\n    if (selected) {\n      checkedKeys.value = [...checkedKeys.value, ...changeIds];\n    } else {\n      checkedKeys.value = checkedKeys.value.filter((id) => {\n        return !changeIds.includes(id);\n      });\n    }\n  }\n\n  // 添加区域\n  function handleCreate() {\n    addTabPage(`/oa/askreport/detail`, '添加请示报告', { id: '' });\n  }\n  function handleView(record: any) {\n    let str = '';\n    if (record.status == 0) {\n      str = '修改';\n    } else if (record.status == 1) {\n      str = '审批';\n    } else {\n      str = '查看';\n    }\n    CommonUtil.toFlowPage(record.id);\n    // addTabPage(`/oa/askreport/detail?id=${record.id}`, str + '请示报告详情');\n  }\n\n  const handleCancel = async (record: any) => {\n    const res = await getIndex({ id: record.id });\n    const { value } = await ElMessageBox.prompt('请输入取消原因', '取消流程', {\n      confirmButtonText: t('common.okText'),\n      cancelButtonText: t('common.cancelText'),\n      inputPattern: /^[\\s\\S]*.*\\S[\\s\\S]*$/,\n      inputErrorMessage: '取消原因不能为空',\n    });\n    // 发起取消\n    await ProcessInstanceApi.cancelProcessInstance(res.result.processInstanceId, value);\n    message.success('已取消');\n    reload();\n  };\n  // 删除区域\n  async function handleDelete() {\n    if (!checkSelectData()) {\n      return;\n    }\n\n    const res = await getIndex({ id: checkedKeys.value[0] });\n\n    createConfirm({\n      title: '提示',\n      iconType: 'warning',\n      content: '确定要删除选中记录？',\n      async onOk() {\n        if (res.result.status != 0) {\n          message.error('非草稿状态不能删除。');\n          return;\n        }\n        await ProcessInstanceApi.deleteProcessInstance(res.result.processInstanceId);\n        message.success('已删除。');\n        checkedKeys.value = [];\n        reload();\n      },\n    });\n  }\n\n  function resetFrom() {\n    searchInfo.name = null;\n    searchInfo.startDate = null;\n    searchInfo.endDate = null;\n    searchInfo.status = null;\n    searchTimeInfo.searchTime = null;\n    reload();\n  }\n\n  // 查询\n  function searchList() {\n    if (searchTimeInfo.searchTime != null) {\n      searchInfo.startDate = searchTimeInfo.searchTime[0];\n      searchInfo.endDate = searchTimeInfo.searchTime[1];\n    }\n    reload();\n  }\n\n  function checkSelectData() {\n    if (checkedKeys.value.length == 0 || checkedKeys.value.length > 1 || !checkedKeys.value['0']) {\n      message.error('请选择一行数据');\n      return false;\n    }\n    return true;\n  }\n\n  // 导出\n  async function handleExportIndex() {\n    const header = ref({ index: '序号' });\n    const indexColumns = getaskReportListColumns();\n    const data = ref<Array<any>>([]);\n    const keys = ref<Array<any>>([]);\n    indexColumns.forEach((column) => {\n      if (!(column.dataIndex === 'id')) {\n        header.value[column.dataIndex] = column.title;\n        keys.value.push(column.dataIndex);\n      }\n    });\n\n    let areaList = await exportExcel(searchInfo);\n    indexList.value = areaList.result;\n\n    indexList.value.forEach(function (item, index) {\n      let statusDisplayName = '';\n      switch (item.status) {\n        case 0:\n          statusDisplayName = '草稿';\n          break;\n        case 1:\n          statusDisplayName = '处理中';\n          break;\n        case 2:\n          statusDisplayName = '通过';\n          break;\n        case 3:\n          statusDisplayName = '不通过';\n          break;\n        case 4:\n          statusDisplayName = '已取消';\n          break;\n        case 5:\n          statusDisplayName = '已终止';\n          break;\n        case 6:\n          statusDisplayName = '退回/驳回';\n          break;\n      }\n      let exportItem = ref({ index: index + 1 });\n      keys.value.forEach((key) => {\n        exportItem.value[key] = key === 'status' ? statusDisplayName : item[key];\n      });\n      data.value.push(exportItem.value);\n    });\n    jsonToSheetXlsx({\n      data: data.value,\n      header: header.value,\n      filename: '请示报告.xlsx',\n    });\n  }\n\n  // 启动执行代码\n  onMounted(() => {\n    MsgManager.getInstance().listen('askreport', function () {\n      setTimeout(() => {\n        reload();\n      }, 500);\n    });\n  });\n</script>\n<style lang=\"less\" scoped>\n  .dialog-loading {\n    position: absolute;\n    z-index: 1000 !important;\n    top: 45%;\n    left: 45%;\n  }\n\n  .tab-model {\n    margin-top: 10px;\n    margin-right: 10px;\n    margin-left: 10px;\n  }\n\n  .tab-button-div {\n    padding-top: 12px;\n    padding-bottom: 12px;\n\n    :deep(.ant-form-item-label) {\n      width: 120px;\n      max-width: 120px;\n      text-align-last: right;\n    }\n  }\n\n  .tab-table-div {\n    margin-top: 10px;\n\n    :deep(.ant-table-placeholder) {\n      height: 591px;\n    }\n  }\n\n  .tab-button {\n    margin-right: 5px;\n\n    &:last-child {\n      margin-right: 0;\n    }\n  }\n\n  .dialog-mask {\n    position: absolute;\n    z-index: 1001 !important;\n    top: -1px;\n    width: 100%;\n    height: 100%;\n    opacity: 0.3;\n  }\n\n  .search-form {\n    position: relative;\n\n    .search-btns {\n      position: absolute;\n      right: 0;\n      bottom: 0;\n    }\n  }\n\n  .fix-basic-table {\n    width: 100%;\n    padding: 10px;\n\n    :deep(&.vben-basic-table .ant-table-wrapper) {\n      padding: 10px 16px 12px;\n    }\n\n    :deep(.table-settings .anticon-setting) {\n      margin-right: 0;\n    }\n  }\n</style>\n"],"names":["createConfirm","useMessage","t","useI18n","searchInfo","reactive","searchTimeInfo","checkedKeys","ref","areaColumn","getaskReportListColumns","useRouter","indexList","getaskReportListByParam","__async","areaList","getaskReportList","searchForm","registerTable","reload","getPaginationRef","useTable","paginationRef","onSelect","sortInfo","record","selected","handleCreate","addTabPage","handleView","CommonUtil.toFlowPage","handleCancel","res","getIndex","value","ElMessageBox","ProcessInstanceApi.cancelProcessInstance","message","handleDelete","checkSelectData","ProcessInstanceApi.deleteProcessInstance","resetFrom","searchList","onMounted","MsgManager"],"mappings":"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"}