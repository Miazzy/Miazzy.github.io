{"version":3,"file":"index-2367ee65.js","sources":["../../src/views/bpm/manage/task/todo/todo.data.ts","../../src/views/bpm/manage/task/todo/index.vue"],"sourcesContent":["import { useRender } from '@/components/Table';\n\nexport const searchFormSchema: FormSchema[] = [\n  {\n    label: '单据编号',\n    field: 'businessCode',\n    component: 'Input',\n    colProps: { span: 8 },\n  },\n  // {\n  //   label: '任务名称',\n  //   field: 'name',\n  //   component: 'Input',\n  //   colProps: { span: 8 },\n  // },\n  // {\n  //   label: '创建时间',\n  //   field: 'createTime',\n  //   component: 'RangePicker',\n  //   componentProps: {\n  //     showTime: true,\n  //     format: 'YYYY-MM-DD HH:mm:ss',\n  //     valueFormat: 'x',\n  //   },\n  //   colProps: { span: 8 },\n  // },\n  {\n    label: '创建时间',\n    field: '[startDate, endDate]',\n    component: 'RangePicker',\n    componentProps: {\n      format: 'YYYY-MM-DD',\n      valueFormat: 'YYYY-MM-DD',\n      placeholder: ['开始日期', '结束日期'],\n    },\n    colProps: { span: 8 },\n  },\n];\n\nexport const columns: BasicColumn[] = [\n  {\n    title: '单据编号',\n    dataIndex: 'businessCode',\n    width: 150,\n  },\n  {\n    title: '标题',\n    dataIndex: 'description',\n    width: 200,\n  },\n  {\n    title: '流程名称',\n    dataIndex: 'processInstance.name',\n    width: 200,\n    customRender: ({ record }) => {\n      return record.processInstance.name;\n    },\n  },\n  {\n    title: '申请部门',\n    dataIndex: 'deptName',\n    width: 100,\n    customRender: ({ record }) => {\n      return record.processInstance.deptName;\n    },\n  },\n  {\n    title: '申请人',\n    dataIndex: 'startUserNickname',\n    width: 100,\n    customRender: ({ record }) => {\n      return record.processInstance.startUserNickname;\n    },\n  },\n  {\n    title: '申请时间',\n    dataIndex: 'createTime',\n    width: 200,\n    customRender: ({ text }) => {\n      return useRender.renderDate(text);\n    },\n  },\n  // {\n  //   title: '状态',\n  //   dataIndex: 'suspensionState',\n  //   width: 100,\n  //   customRender: ({ text }) => {\n  //     if (text === 1) {\n  //       return '激活';\n  //     } else if (text === 2) {\n  //       return '挂起';\n  //     }\n  //     return '';\n  //   },\n  // },\n];\n","<script lang=\"ts\" setup>\n  import { columns, searchFormSchema } from './todo.data';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { IconEnum } from '@/enums/appEnum';\n  import { BasicTable, useTable, TableAction } from '@/components/Table';\n\n  import * as TaskApi from '@/api/bpm/task';\n  import { addTabPage } from '@/utils/route';\n  import { MsgManager } from '/@/message/MsgManager';\n  import { onMounted } from 'vue';\n\n  defineOptions({ name: 'BpmToDoTask' });\n\n  const { t } = useI18n();\n\n  const [registerTable, { reload }] = useTable({\n    title: '待办任务',\n    api: TaskApi.getTodoTaskPage,\n    columns,\n    formConfig: { labelWidth: 120, schemas: searchFormSchema },\n    useSearchForm: true,\n    showTableSetting: true,\n    bordered: true,\n    actionColumn: {\n      width: 140,\n      title: t('common.operate'),\n      dataIndex: 'action',\n      fixed: 'right',\n    },\n  });\n\n  /** 处理审批按钮 */\n  const handleAudit = (row) => {\n    addTabPage(\n      `${row.bpmProcessDefinitionRespVO.formCustomViewPath}?processInstanceId=${row.processInstance.id}`,\n    );\n  };\n\n  onMounted(() => {\n    MsgManager.getInstance().listen('workflow-task-done', () => {\n      setTimeout(() => {\n        reload(); // 此处需延时一段时间再查询数据，否则数据后端还未处理，可能是原数据\n      }, 500);\n    });\n  });\n</script>\n<template>\n  <div>\n    <BasicTable @register=\"registerTable\">\n      <template #bodyCell=\"{ column, record }\">\n        <template v-if=\"column.key === 'action'\">\n          <TableAction\n            :actions=\"[\n              {\n                icon: IconEnum.VIEW,\n                label: '审批进度',\n                onClick: handleAudit.bind(null, record),\n              },\n            ]\"\n          />\n        </template>\n      </template>\n    </BasicTable>\n  </div>\n</template>\n"],"names":["searchFormSchema","columns","record","text","useRender","t","useI18n","registerTable","reload","useTable","TaskApi.getTodoTaskPage","handleAudit","row","addTabPage","onMounted","MsgManager"],"mappings":"y7BAEO,MAAMA,EAAiC,CAC5C,CACE,MAAO,OACP,MAAO,eACP,UAAW,QACX,SAAU,CAAE,KAAM,CAAE,CACtB,EAkBA,CACE,MAAO,OACP,MAAO,uBACP,UAAW,cACX,eAAgB,CACd,OAAQ,aACR,YAAa,aACb,YAAa,CAAC,OAAQ,MAAM,CAC9B,EACA,SAAU,CAAE,KAAM,CAAE,CACtB,CACF,EAEaC,EAAyB,CACpC,CACE,MAAO,OACP,UAAW,eACX,MAAO,GACT,EACA,CACE,MAAO,KACP,UAAW,cACX,MAAO,GACT,EACA,CACE,MAAO,OACP,UAAW,uBACX,MAAO,IACP,aAAc,CAAC,CAAE,OAAAC,KACRA,EAAO,gBAAgB,IAElC,EACA,CACE,MAAO,OACP,UAAW,WACX,MAAO,IACP,aAAc,CAAC,CAAE,OAAAA,KACRA,EAAO,gBAAgB,QAElC,EACA,CACE,MAAO,MACP,UAAW,oBACX,MAAO,IACP,aAAc,CAAC,CAAE,OAAAA,KACRA,EAAO,gBAAgB,iBAElC,EACA,CACE,MAAO,OACP,UAAW,aACX,MAAO,IACP,aAAc,CAAC,CAAE,KAAAC,KACRC,EAAU,WAAWD,CAAI,CAEpC,CAcF,kDClFQ,KAAA,CAAE,EAAAE,GAAMC,IAER,CAACC,EAAe,CAAE,OAAAC,CAAQ,CAAA,EAAIC,EAAS,CAC3C,MAAO,OACP,IAAKC,EACL,QAAAT,EACA,WAAY,CAAE,WAAY,IAAK,QAASD,CAAiB,EACzD,cAAe,GACf,iBAAkB,GAClB,SAAU,GACV,aAAc,CACZ,MAAO,IACP,MAAOK,EAAE,gBAAgB,EACzB,UAAW,SACX,MAAO,OACT,CAAA,CACD,EAGKM,EAAeC,GAAQ,CAC3BC,EACE,GAAGD,EAAI,2BAA2B,kBAAkB,sBAAsBA,EAAI,gBAAgB,EAAE,EAAA,CAClG,EAGF,OAAAE,EAAU,IAAM,CACdC,EAAW,YAAY,EAAE,OAAO,qBAAsB,IAAM,CAC1D,WAAW,IAAM,CACRP,KACN,GAAG,CAAA,CACP,CAAA,CACF"}