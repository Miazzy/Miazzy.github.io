var m=(R,v,C)=>new Promise((M,y)=>{var e=l=>{try{f(C.next(l))}catch(h){y(h)}},k=l=>{try{f(C.throw(l))}catch(h){y(h)}},f=l=>l.done?M(l.value):Promise.resolve(l.value).then(e,k);f((C=C.apply(R,v)).next())});import{B as re}from"./BasicTable-0434a334.js";import{T as ie}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as ue}from"./useTable-109483b3.js";import{bB as de,bC as ce,a2 as x}from"./antd-15ac76ed.js";import{au as pe,b as me,a7 as fe,av as T,ax as be,az as ve,bQ as Ce,bR as ge,aA as we,a0 as Ie,_ as ye}from"./index.js";import{P as he}from"./index-20519caf.js";import{C as _e}from"./CommonTree-c4ed7838.js";import"./index-74ac3212.js";import{_ as F}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{g as U,a as xe,f as r,b as q,e as Te,c as ke,d as Pe}from"./powerCutPlan-04857240.js";import{d as Oe,k as i,r as V,ax as Se,o as Ke,al as S,Z as I,a9 as K,aa as o,f as s,$ as E,ac as L,E as w,_ as j,F as A,u as d,J as Ee}from"./vue-71d1abb3.js";import{j as Ne}from"./Export2Excel-389a8fc9.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";import"./useRender-21ce56fb.js";const Be={class:"right-table-layout"},De={class:"tab-button-div"},Fe={class:"tab-table-div"},Le=Oe({__name:"powerCutPlan",setup(R){const v=i(!1),{createConfirm:C,createMessage:M}=pe(),{t:y}=me();V({searchTime:""});const e=V({billCode:null,powerCutType:null,powerCutKind:null,status:null}),k=i([]);i({});const f=i({}),l=i([]);i([]);const h=U();Se(),i([{label:"草稿",value:"0"},{label:"处理中",value:"1"},{label:"通过",value:"2"},{label:"不通过",value:"3"},{label:"已取消",value:"4"},{label:"已终止",value:"5"},{label:"退回",value:"6"}]);const N=i([]),H=()=>m(this,null,function*(){let a=yield Pe(e);return N.value=a.result,a.result}),$={baseColProps:{lg:6,md:8},labelWidth:90,schemas:[]};function W(){J(),v.value=!v.value}const[X,{reload:g,getPaginationRef:G,getForm:Re,redoHeight:J}]=ue({title:"检修停电列表",api:()=>m(this,null,function*(){const a=G();return e.pageNo=a.current,e.pageSize=a.pageSize,yield H()}),columns:h,useSearchForm:!1,formConfig:$,showTableSetting:!0,bordered:!0,rowKey:"id",rowSelection:{type:"radio",onChange:Q},handleSearchInfoFn(a){return e.status=a.status,e.billCode=a.billCode,e.powerCutType=a.powerCutType,e.powerCutKind=a.powerCutKind,a},sortFn:a=>{a.order?(e.sortField=a.field,e.sortOrder=a.order.replace("end","")):(e.sortField=null,e.sortOrder=null)}});let B=i("");function Q(a,n){n.length>0?(l.value=[a[0]],B.value=a[0]):(l.value=[],B.value="")}function Z(){return m(this,null,function*(){const a=yield xe({});k.value=a.result,g()})}function Y(){if(r.id="",r.issuedCompany="",r.powerCutType="",r.powerCutKind="",r.startTime="",r.endTime="",r.content="",r.name="",e.stationId==null){x.error("请先选择电站。");return}e.nodeKindId=="station"&&se(),be("/po/powerCutPlan/create","添加检修停电",Ee(r))}function z(a){a.status==0||a.status==1,ve(a.id)}const ee=a=>m(this,null,function*(){const n=yield q({id:a.id}),{value:_}=yield Ce.prompt("请输入取消原因","取消流程",{confirmButtonText:y("common.okText"),cancelButtonText:y("common.cancelText"),inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"取消原因不能为空"});yield ge(n.result.processInstanceId,_),x.success("已取消"),g()});function ae(){return m(this,null,function*(){if(console.log(l.value),l.value.length!=1)return x.info("请选择一条数据."),!1;const a=yield q({id:l.value[0]});C({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return m(this,null,function*(){if(a.result.status!=0){x.error("非草稿状态不能删除。");return}yield we(a.result.processInstanceId),x.success("已删除。"),l.value=[],g()})}})})}function te(){e.status=null,e.billCode=null,e.powerCutType=null,e.powerCutKind=null,g()}function ne(){g()}function se(){f.value.stationId}function le(a={}){e.stationId=null,e.stationName=null,e.stationOrganId=null,e.stationOrganName=null,e.nodeKindId=null,f.value.nodeKindId=null,e.searchId=null,a!=null&&(e.stationOrganId=a.organId,e.stationOrganName=a.organName,a.nodeKindId=="station"&&(e.stationId=a.powerStationId,e.stationName=a.name,f.value.stationId=a.powerStationId,r.stationId=e.stationId,r.stationName=e.stationName,r.stationOrganId=e.stationOrganId,r.stationOrganName=e.stationOrganName),e.nodeKindId=a.nodeKindId,f.value.nodeKindId=a.nodeKindId,e.searchId=a.id),g()}function oe(){return m(this,null,function*(){C({title:"导出",iconType:"warning",content:"确定要导出所有记录？",onOk(){return m(this,null,function*(){const n=i({index:"序号"}),_=U(),c=i([]),p=i([]);_.forEach(t=>{t.dataIndex!=="id"&&(t.dataIndex==="stationOrganName"&&Ie().isMultiOrganization||t.dataIndex!=="stationOrganName")&&(n.value[t.dataIndex]=t.title,p.value.push(t.dataIndex))});let D=yield Te(e);N.value=D.result,N.value.forEach(function(t,P){let u="";switch(t.status){case 0:u="草稿";break;case 1:u="处理中";break;case 2:u="通过";break;case 3:u="不通过";break;case 4:u="已取消";break;case 5:u="已终止";break;case 6:u="退回/驳回";break}let O=i({index:P+1});p.value.forEach(b=>{b==="status"?O.value[b]=b==="status"?u:t[b]:b==="stopTime"?O.value[b]=ke(t.startTime,t.endTime):O.value[b]=t[b]}),c.value.push(O.value)}),Ne({data:c.value,header:n.value,filename:"检修停电.xlsx"})})}})})}return Ke(()=>{Z(),fe.getInstance().listen("powerCutPlan",function(){setTimeout(()=>{g()},500)})}),(a,n)=>{const _=S("a-input"),c=S("a-form-item"),p=S("a-button"),D=S("a-form");return I(),K(d(he),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:o(()=>[s(_e,{title:"电站组织",onSelect:le,value:k.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),E("div",Be,[E("div",De,[s(D,{model:e,name:"searchInfo",layout:"inline",autocomplete:"off",class:"search-form"},{default:o(()=>[s(c,{name:"billCode",label:"单据编号",labelCol:{span:12},rules:[{required:!1,message:"请输入单据编号"}],style:{width:"26.5%"},colon:!1},{default:o(()=>[s(_,{value:e.billCode,"onUpdate:value":n[0]||(n[0]=t=>e.billCode=t),placeholder:"请输入单据编号",style:{width:"100%"}},null,8,["value"])]),_:1}),s(c,{name:"powerCutType",label:"检修类型",labelCol:{span:12},rules:[{required:!1,message:"请选择检修类型"}],style:{width:"26.5%"},colon:!1},{default:o(()=>[s(F,{type:"PowerCutType",value:e.powerCutType,"onUpdate:value":n[1]||(n[1]=t=>e.powerCutType=t),width:"100%"},null,8,["value"])]),_:1}),s(c,{name:"powerCutKind",label:"停电类型",labelCol:{span:12},rules:[{required:!1,message:"请选择停电类型"}],style:{width:"26.5%"},colon:!1},{default:o(()=>[s(F,{type:"PowerCutKind",value:e.powerCutKind,"onUpdate:value":n[2]||(n[2]=t=>e.powerCutKind=t),width:"100%"},null,8,["value"])]),_:1}),v.value?(I(),K(c,{key:0,style:{width:"100%",height:"10px"}})):L("",!0),v.value?(I(),K(c,{key:1,name:"status",label:"审批状态",labelCol:{span:20},rules:[{required:!1,message:"请选择审批状态"}],style:{width:"26.5%"},colon:!1},{default:o(()=>[s(F,{type:"bpm_process_instance_result",onChange:n[3]||(n[3]=t=>"()=> searchInfo.status = value"),value:e.status,"onUpdate:value":n[4]||(n[4]=t=>e.status=t),width:"100%"},null,8,["value"])]),_:1})):L("",!0),s(c,{class:"search-btns"},{default:o(()=>[s(p,{style:{margin:"0 8px"},onClick:te},{default:o(()=>[w("重置")]),_:1}),s(p,{type:"primary",class:"tab-button",onClick:ne},{default:o(()=>[w("查询")]),_:1}),E("a",{style:{"margin-left":"12px","font-size":"14px"},onClick:W},[v.value?(I(),j(A,{key:0},[w(" 收起 "),s(d(de))],64)):(I(),j(A,{key:1},[w(" 展开 "),s(d(ce))],64))])]),_:1})]),_:1},8,["model"])]),E("div",Fe,[s(d(re),{onRegister:d(X),class:"fix-basic-table",onResizeColumn:n[5]||(n[5]=(t,P)=>P.width=t),onRowDbClick:n[6]||(n[6]=t=>z(t))},{toolbar:o(()=>[s(p,{type:"primary",preIcon:d(T).ADD,onClick:Y},{default:o(()=>[w("添加")]),_:1},8,["preIcon"]),s(p,{class:"red-btn",disabled:d(B)=="",preIcon:d(T).DELETE,onClick:ae},{default:o(()=>[w("删除")]),_:1},8,["disabled","preIcon"]),s(p,{class:"yellow-btn",preIcon:d(T).EXPORT,onClick:oe},{default:o(()=>[w("导出")]),_:1},8,["preIcon"])]),bodyCell:o(({column:t,text:P,record:u})=>[t.key==="action"?(I(),K(d(ie),{key:0,actions:[{icon:d(T).LOG,label:"进度",onClick:z.bind(null,u)},{icon:d(T).DELETE,danger:!0,label:"取消",ifShow:()=>u.status==0,onClick:ee.bind(null,u)}]},null,8,["actions"])):L("",!0)]),_:1},8,["onRegister"])])])]),_:1})}}});const ba=ye(Le,[["__scopeId","data-v-ff198ff2"]]);export{ba as default};
//# sourceMappingURL=powerCutPlan-c1455a0f.js.map
