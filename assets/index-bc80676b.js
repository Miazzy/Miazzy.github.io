var b=(e,s,a)=>new Promise((t,r)=>{var i=o=>{try{n(a.next(o))}catch(l){r(l)}},p=o=>{try{n(a.throw(o))}catch(l){r(l)}},n=o=>o.done?t(o.value):Promise.resolve(o.value).then(i,p);n((a=a.apply(e,s)).next())});import{f as u,a as d}from"./index.esm-c216ed00.js";import{T as h}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import{b as C,au as x,bD as P,a7 as v,av as _,ax as w,bQ as S,bR as R,_ as k}from"./index.js";import"./antd-15ac76ed.js";import"./index-316f6ffb.js";import"./index-085d06c7.js";import{u as f}from"./useRender-21ce56fb.js";import{B as M}from"./BasicTable-0434a334.js";import{u as B}from"./useTable-109483b3.js";import{d as E,o as D,Z as T,_ as V,f as Y,aa as F,a9 as O,u as c,ac as $}from"./vue-71d1abb3.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./useWindowSizeFn-13b1b8a2.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";const y=[{dictType:"bpm_process_instance_result",value:"1",label:"处理中",colorType:"primary",cssClass:""},{dictType:"bpm_process_instance_result",value:"2",label:"通过",colorType:"success",cssClass:""},{dictType:"bpm_process_instance_result",value:"3",label:"不通过",colorType:"danger",cssClass:""},{dictType:"bpm_process_instance_result",value:"4",label:"已取消",colorType:"info",cssClass:""},{dictType:"bpm_process_instance_result",value:"5",label:"已终止",colorType:"info",cssClass:""},{dictType:"bpm_process_instance_result",value:"6",label:"退回/驳回",colorType:"info",cssClass:""}],j=[{dictType:"bpm_model_category",value:"1",label:"默认",colorType:"primary",cssClass:""},{dictType:"bpm_model_category",value:"2",label:"OA",colorType:"success",cssClass:""}],I=[{dictType:"bpm_process_instance_status",value:"1",label:"进行中",colorType:"primary",cssClass:""},{dictType:"bpm_process_instance_status",value:"2",label:"已完成",colorType:"success",cssClass:""}],A=[{label:"单据编号",field:"businessCode",component:"Input",colProps:{span:8}},{label:"流程名称",field:"name",component:"Input",colProps:{span:8}},{label:"状态",field:"status",component:"Select",componentProps:{options:I},colProps:{span:8}},{label:"结果",field:"result",component:"Select",componentProps:{options:y},colProps:{span:8}},{label:"提交时间",field:"createTime",component:"RangePicker",componentProps:{showTime:!0,format:"YYYY-MM-DD HH:mm:ss",valueFormat:"x"},colProps:{span:8}}],H=[{title:"单据编号",dataIndex:"businessCode",width:150},{title:"标题",dataIndex:"description",width:200},{title:"流程名称",dataIndex:"name",width:200},{title:"当前审批任务",dataIndex:"tasks",width:100,customRender:({record:e})=>{const s=e.tasks;return s!=null&&s.length>0?s[0].name:""}},{title:"状态",dataIndex:"status",width:100,customRender:({text:e})=>g("bpmProcessInstanceStatus",e).label},{title:"结果",dataIndex:"result",width:100,customRender:({text:e})=>g("bpmProcessInstanceResult",e).label},{title:"申请时间",dataIndex:"createTime",width:200,customRender:({text:e})=>f.renderDate(e)},{title:"结束时间",dataIndex:"endTime",width:200,customRender:({text:e})=>f.renderDate(e)}];function g(e,s){const a={};return e=="bpmModelCategory"?u(j,function(t){t.value===s.toString()&&d(a,t)}):e=="bpmProcessInstanceStatus"?u(I,function(t){t.value===s.toString()&&d(a,t)}):e=="bpmProcessInstanceResult"&&u(y,function(t){t.value===s.toString()&&d(a,t)}),a}const N=E({name:"BpmProcessInstance",__name:"index",setup(e){const{t:s}=C(),{createMessage:a}=x(),[t,{reload:r}]=B({title:"我的流程",api:P,columns:H,formConfig:{labelWidth:120,schemas:A},useSearchForm:!0,showTableSetting:!0,bordered:!0,actionColumn:{width:140,title:s("common.operate"),dataIndex:"action",fixed:"right"}}),i=n=>{w(`${n.bpmProcessDefinitionRespVO.formCustomViewPath}?processInstanceId=${n.id}`)},p=n=>b(this,null,function*(){const{value:o}=yield S.prompt("请输入取消原因","取消流程",{confirmButtonText:s("common.ok"),cancelButtonText:s("common.cancel"),inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"取消原因不能为空"});yield R(n.id,o),a.success("取消成功"),yield r()});return D(()=>{v.getInstance().listen("workflow-task-done",()=>{setTimeout(()=>{r()},500)})}),(n,o)=>(T(),V("div",null,[Y(c(M),{onRegister:c(t)},{bodyCell:F(({column:l,record:m})=>[l.key==="action"?(T(),O(c(h),{key:0,actions:[{icon:c(_).VIEW,label:"详情",onClick:i.bind(null,m)},{icon:c(_).DELETE,danger:!0,label:"取消",ifShow:()=>m.result===1,popConfirm:{title:c(s)("common.message.delMessage"),placement:"left",confirm:p.bind(null,m)}}]},null,8,["actions"])):$("",!0)]),_:1},8,["onRegister"])]))}});const be=k(N,[["__scopeId","data-v-3aa6f2d2"]]);export{be as default};
//# sourceMappingURL=index-bc80676b.js.map
