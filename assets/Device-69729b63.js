var g=(k,U,y)=>new Promise((d,B)=>{var p=n=>{try{x(y.next(n))}catch(C){B(C)}},b=n=>{try{x(y.throw(n))}catch(C){B(C)}},x=n=>n.done?d(n.value):Promise.resolve(n.value).then(p,b);x((y=y.apply(k,U)).next())});import de from"./VideoMonitor-ba634181.js";import ue from"./RealStatus-fcc3a7f5.js";import ve from"./RealStatusModal-c2ef8fb1.js";import{am as W,ar as _,I as T,a7 as P,a5 as X,_ as me}from"./index.js";import{c as pe,E as N,g as $,d as w}from"./flvtools-b93f1fee.js";import{a as O}from"./assign-37f1c13d.js";import{d as fe,k as i,r as R,o as ye,b as be,al as ge,Z as v,_ as h,$ as l,F as j,ae as Y,a5 as _e,ad as S,a9 as G,ac as L,f as m,aa as M,E as z,aG as he,aH as ke}from"./vue-71d1abb3.js";import"./DeviceStatusInfo3-c6f9bba6.js";import"./index-0c1c0ee9.js";import"./MonitorVideoItem-196e081b.js";import"./antd-15ac76ed.js";import"./TrackReplay-432cfa35.js";import"./TimeSlider-bdb1df9d.js";import"./HistoryVideo-32491456.js";import"./BasicTable-0434a334.js";import"./useForm-dea3ed18.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-f4fc48e6.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./uniqBy-92d3bc7f.js";import"./index-085d06c7.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useTable-109483b3.js";const Ie=k=>(he("data-v-0af83a5c"),k=k(),ke(),k),we={class:"left-bg-box"},xe={class:"tab-box"},Ce=["onClick"],Ve={class:"tab-content-box"},Te={key:1,class:"right-content",style:{opacity:"1","background-color":"#04284c"}},Se={class:"right-bg-box"},Le={id:"gridView",class:"video-list-layout"},Be=["id"],De={class:"monitor-video-item",style:{width:"100%",height:"100%","background-color":"black"}},Ee=["id","onClick","onDblclick"],Pe={class:"title-box"},Ne={id:"fullView",class:"monitor-video-item hidden"},$e={class:"video-box"},Me=Ie(()=>l("div",{id:"fullVideo",style:{width:"100%",height:"76vh","min-height":"650px","background-color":"black"}},null,-1)),ze={class:"title-box"},Ue={style:{position:"absolute",right:"20px",bottom:"97px"}},Ae={style:{display:"flex","flex-direction":"column","align-items":"center"}},He={style:{height:"20px"}},qe={style:{display:"flex","flex-direction":"column","align-items":"center"}},Fe={style:{display:"flex","flex-direction":"column","align-items":"center","margin-top":"20px"}},Ke={style:{"flex-direction":"column","margin-top":"10px","text-align":"center"}},Oe=fe({__name:"Device",setup(k,{expose:U}){const y=i(W()),d=i("1"),B=i([{tabIndex:"1",tabLabel:"视频监控"},{tabIndex:"2",tabLabel:"电子工牌"},{tabIndex:"3",tabLabel:"巡检终端"},{tabIndex:"4",tabLabel:"行车记录仪"}]),p=i(!1),b=i({}),x=({type:e,record:t})=>{b.value=t,b.value.bizType=e,p.value=!0},n=i(null),C=({type:e,record:t})=>{b.value=t,b.value.bizType=e,n.value=setTimeout(()=>{p.value=!0},3e3)},ee=()=>{p.value=!1},te=()=>{P.getInstance().listen("smart-device-modal-info",x),P.getInstance().listen("smart-device-point-mark",C),P.getInstance().listen("smart-device-modal",e=>{p.value=e})};let c=0;const D=i([]),A=R({}),r=R({}),Z=i(!1),V=i(null),f=i([]),H=R({}),J=i(!0),q=()=>g(this,null,function*(){yield _(10);for(let e=0;e<o.value.length;e++){const t=i(),s=o.value[e];if(pe(s.url)&&e<9){const a=[s.id,s.url,s.accessToken,!0,N.HTTP];t.value=$(...a),f.value.push(t.value)}else f.value.push(null)}}),le=(e,t)=>{O(A,e),c=t},ae=(e,t)=>g(this,null,function*(){w(f.value[t]),yield _(10);const s=[e.id,e.url,e.accessToken,!0,N.HTTP];f.value[t]=$(...s)});function oe(e){return g(this,null,function*(){if(e!=null)if(e.nodeKindId!="videoUrl")H.nodeKindId=e.nodeKindId,H.searchId=e.id;else{yield _(10);const t=A.id;if(t!=null&&t!=""&&e.url!=null&&e.url!=""){o.value[c].cameraName=e.name,o.value[c].stationName=e.powerStationName,o.value[c].url=e.url,o.value[c].accessToken=e.accessToken,o.value[c].deviceSerial=e.deviceSerial,o.value[c].channelNo=e.channelNo,o.value[c].id=e.id+new Date,w(f.value[c]),yield _(10);const s=[t,e.url,e.accessToken,!0,N.HTTP];f.value[c]=$(...s),O(A,o.value[c])}}(e==null||e!=null&&e.nodeKindId!="videoUrl")&&(D.value=yield se(),o.value=D.value.slice(0,9),E(),_(100),yield q(),document.querySelectorAll(".grid-item").forEach(t=>{F(t)}))})}const se=()=>g(this,null,function*(){return yield Q(H)});function ie(e){O(r,e);var t=document.getElementById("fullView");t.classList.remove("hidden");var s=document.getElementById("gridView");if(s.classList.add("hidden"),s.classList.remove("video-list-layout"),Z.value=!0,w(V.value),document.querySelectorAll(".arrowButton").forEach(function(a){a.classList.remove("ant-btn")}),r.url!=null&&r.url!=""){const a=["fullVideo",e.url,e.accessToken,!0,N.HTTP];V.value=$(...a)}}function ne(){var e=document.getElementById("fullView");e.classList.add("hidden");var t=document.getElementById("gridView");t.classList.remove("hidden"),t.classList.add("video-list-layout"),w(V.value),Z.value=!1}function I(e,t){e.direction=t,ce(e)}const ce=e=>X.get({url:"/baseset/videoInfo/videoControl",params:e},{}),o=i(),Q=e=>X.get({url:"/baseset/videoInfo/list",params:e},{isOnlyResult:!0}),re=e=>g(this,null,function*(){d.value=e.tabIndex,p.value=!1,P.getInstance().sendMsg("smart-device-clear-overlays",null),e.tabIndex==1&&(E(),_(100),yield q(),document.querySelectorAll(".grid-item").forEach(t=>{F(t)}))}),F=e=>{e.addEventListener("click",()=>{document.querySelectorAll(".grid-item.selected").forEach(t=>t.classList.remove("selected")),e.classList.add("selected")})},E=()=>{try{const e=f.value;for(let t=0;t<e.length;t++)w(e[t]),e[t]=null;w(V.value),V.value=null,f.value=[]}catch(e){console.error("destory all player error: ",e)}};return U({handleUpdate:()=>{y.value=W()},destory:()=>{E(),J.value=!1}}),ye(()=>g(this,null,function*(){te(),D.value=yield Q({}),o.value=D.value.slice(0,9),E(),_(100),yield q(),document.querySelectorAll(".grid-item").forEach(e=>{F(e)})})),be(()=>{n.value&&clearTimeout(n.value)}),(e,t)=>{const s=ge("a-button");return v(),h(j,null,[J.value?(v(),h("div",{class:"left-content",key:y.value},[l("div",we,[l("div",xe,[(v(!0),h(j,null,Y(B.value,(a,u)=>(v(),h("div",{class:_e(["tab-item",{active:d.value===a.tabIndex}]),key:u,onClick:K=>re(a)},S(a.tabLabel),11,Ce))),128))]),l("div",Ve,[d.value==="1"?(v(),G(de,{key:0,onSelect:oe})):L("",!0),d.value==="2"||d.value==="3"||d.value==="4"?(v(),G(ue,{key:1,tabIndex:d.value},null,8,["tabIndex"])):L("",!0)])])])):L("",!0),d.value==="1"?(v(),h("div",Te,[l("div",Se,[l("div",Le,[(v(!0),h(j,null,Y(o.value,(a,u)=>(v(),h("div",{class:"monitor-video-item-layout grid-item",key:u,id:"videoDiv"+u},[l("div",De,[l("div",{id:o.value[u].id,class:"video-box",width:"100%",height:"100%",onClick:K=>le(a,u),onDblclick:K=>ae(o.value[u],u)}," 视频 ",40,Ee),l("div",Pe,[l("span",null,S(o.value[u].stationName)+" - "+S(o.value[u].cameraName),1),m(T,{icon:"fluent-mdl2:scale-volume",style:{"font-size":"0.14rem"},onClick:K=>ie(a)},null,8,["onClick"])])])],8,Be))),128))]),l("div",Ne,[l("div",$e,[Me,l("div",ze,[l("span",null,S(r.stationName)+" - "+S(r.cameraName),1),m(T,{class:"full",icon:"uil:compress-arrows",size:"20",onClick:t[0]||(t[0]=a=>ne())})]),m(T,{class:"background-image",icon:"tabler:direction-arrows",size:"80"}),l("div",Ue,[l("div",Ae,[m(s,{class:"arrowButton",onClick:t[1]||(t[1]=a=>I(r,0))},{default:M(()=>[z("上")]),_:1})]),l("div",He,[m(s,{class:"arrowButton",onClick:t[2]||(t[2]=a=>I(r,2))},{default:M(()=>[z("左")]),_:1}),m(s,{class:"arrowButton",onClick:t[3]||(t[3]=a=>I(r,3))},{default:M(()=>[z("右")]),_:1})]),l("div",qe,[m(s,{class:"arrowButton",onClick:t[4]||(t[4]=a=>I(r,1))},{default:M(()=>[z("下")]),_:1})]),l("div",Fe,[m(T,{class:"controlButton",icon:"material-symbols:add",size:"30",style:{display:"inline-block"},onClick:t[5]||(t[5]=a=>I(r,8))})]),l("div",Ke,[m(T,{class:"controlButton",icon:"ant-design:line-outlined",size:"30",style:{display:"inline-block"},onClick:t[6]||(t[6]=a=>I(r,9))})])])])])])])):L("",!0),p.value?(v(),G(ve,{key:2,closeModal:ee,infoData:b.value},null,8,["infoData"])):L("",!0)],64)}}});const Tt=me(Oe,[["__scopeId","data-v-0af83a5c"]]);export{Tt as default};
//# sourceMappingURL=Device-69729b63.js.map
