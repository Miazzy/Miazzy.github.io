{"version":3,"file":"boosterStationOverview-d2e85e5a.js","sources":["../../src/views/monitor/boosterStation/boosterStationOverview/boosterStationOverview.vue"],"sourcesContent":["<!--\n * @Description: 升压站总览\n * @Date: 2023-10-08 16:59:48\n * @LastEditTime: 2023-11-09 09:46:09\n * @FilePath: \\ygwl-framework\\src\\views\\monitor\\boosterStation\\boosterStationOverview\\boosterStationOverview.vue\n-->\n<template>\n  <div class=\"booster-station-overview\">\n    <div class=\"area-box box-style\">\n      <div class=\"area-hearder-box\">\n        <div class=\"station-selector-box\">\n          <Icon class=\"icon-left\" icon=\"mdi:house-city\" color=\"#1890FF\" :size=\"15\" />\n          <Select\n            style=\"width: 200px\"\n            v-model:value=\"curStationId\"\n            show-search\n            :options=\"stationList\"\n            :filter-option=\"filterOption\"\n            :fieldNames=\"{ value: 'id', label: 'name' }\"\n            @change=\"handleChange\"\n          />\n        </div>\n        <div class=\"refresh-box\">\n          <Checkbox v-model:checked=\"isAutoRefresh\" @change=\"handleAutoRefresh\">自动刷新</Checkbox>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"device-box box-style\" v-if=\"deviceTypes.length > 0\">\n      <Tabs class=\"tab-style\" v-model:activeKey=\"activeDeviceTab\" @change=\"changeTab\" size=\"large\">\n        <TabPane v-for=\"(item, index) in deviceTypes\" :key=\"item.deviceType\">\n          <template #tab>\n            <div class=\"tab-bar-item\">\n              {{ item.typeName }}\n              <span v-if=\"item.alarmNum > 0\" class=\"tab-tag\">{{ item.alarmNum }}</span>\n            </div>\n          </template>\n          <div class=\"device-tab-content\">\n            <div class=\"device-list-box\">\n              <DeviceItem\n                class=\"device-item-layout\"\n                v-for=\"(item, index) in deviceData\"\n                :key=\"index\"\n                :options=\"showOptions\"\n                :data=\"item\"\n                :deviceType=\"item.deviceType\"\n                @click=\"clickDevice(item)\"\n              />\n            </div>\n          </div>\n        </TabPane>\n      </Tabs>\n    </div>\n    <div v-else class=\"data-info-box box-style\" style=\"position: relative\">\n      <a-empty\n        style=\"position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%)\"\n        :image=\"Empty.PRESENTED_IMAGE_SIMPLE\"\n      />\n    </div>\n\n    <template v-if=\"deviceTypes.length > 0\">\n      <div class=\"data-info-box box-style\" v-if=\"deviceTypes.length > 0 && deviceData?.length > 0\">\n        <Tabs class=\"tab-style\" v-model:activeKey=\"activeDataTab\" size=\"large\">\n          <TabPane key=\"1\">\n            <template #tab>\n              <div class=\"tab-bar-item\">\n                实时信息\n                <!-- <span class=\"tab-tag\">5</span> -->\n              </div>\n            </template>\n            <RealTimeInfo :ycData=\"ycData\" :yxData=\"yxData\" :yxTime=\"yxTime\" />\n          </TabPane>\n          <TabPane key=\"2\">\n            <template #tab>\n              <div class=\"tab-bar-item\"> 设备告警 </div>\n            </template>\n            <DeviceWarning ref=\"warningRef\" :esn=\"selectedDevice.esn\" />\n          </TabPane>\n          <TabPane key=\"3\">\n            <template #tab>\n              <div class=\"tab-bar-item\"> 数据明细 </div>\n            </template>\n            <DataDetail\n              ref=\"dataDetailRef\"\n              :tableColumns=\"detailColumns\"\n              :indexType=\"ycData\"\n              :esn=\"selectedDevice.esn\"\n              :echartWidth=\"1900\"\n            />\n          </TabPane>\n          <TabPane key=\"4\">\n            <template #tab>\n              <div class=\"tab-bar-item\"> 数据对比 </div>\n            </template>\n            <DataComparison\n              ref=\"comparisonRef\"\n              :tableColumns=\"detailColumns\"\n              :indexType=\"ycData\"\n              :esn=\"selectedDevice.esn\"\n              :echartWidth=\"1900\"\n            />\n          </TabPane>\n        </Tabs>\n      </div>\n\n      <div v-else class=\"data-info-box box-style\" style=\"position: relative\">\n        <a-empty\n          style=\"position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%)\"\n          :image=\"Empty.PRESENTED_IMAGE_SIMPLE\"\n        />\n      </div>\n    </template>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\n  import { ref, onMounted, unref, reactive } from 'vue';\n  import { Checkbox, Tabs, Select, TabPane, Empty } from 'ant-design-vue';\n  import Icon from '@/components/Icon/Icon.vue';\n  import DeviceItem from '../../component/deviceItem.vue';\n  import RealTimeInfo from '../../component/realTimeInfo.vue';\n  import DeviceWarning from '../../component/deviceWarning.vue';\n  import DataDetail from '../../component/dataDetail.vue';\n  import DataComparison from '../../component/dataComparison.vue';\n  import DeviceInfo from '../../component/deviceInfo.vue';\n  import { TaskExecutor } from '/@/executor/taskExecutor';\n  import {\n    getStations,\n    getBoosterDevice,\n    getRealTimeYc,\n    getRealTimeYx,\n    getDeviceTypes,\n    getAlarmNumByType,\n  } from '../../monitorApi.ts';\n  // 选择的电站\n  const curStationId = ref();\n  const stationList = ref([]);\n  const alarmNum = ref();\n\n  const warningRef = ref();\n  const dataDetailRef = ref();\n  const comparisonRef = ref();\n  // 数据tab\n  const activeDataTab = ref('1');\n\n  const handleChange = async (value: string, option) => {\n    curStationId.value = value;\n    activeDeviceTab.value = null;\n    await getDeviceType();\n    selectedDevice.value = null;\n    getDeviceData();\n  };\n  const filterOption = (input: string, option: any) => {\n    return option.name.indexOf(input) >= 0;\n  };\n  // 获取电站列表数据\n  const getPowerStationList = async () => {\n    let res = await getStations();\n    if (res?.length) {\n      stationList.value = res;\n      if (!curStationId.value) {\n        curStationId.value = stationList.value[0].id;\n        await getDeviceType();\n        getDeviceData();\n      }\n    }\n  };\n\n  // 设备类型数据\n  const deviceTypes = ref([]);\n  const activeDeviceTab = ref(null);\n  // 查询设备类型\n  const getDeviceType = async () => {\n    let res = await getDeviceTypes({\n      stationId: curStationId.value,\n      deviceCategory: 'BoostDev',\n    });\n    let result = await getAlarmNumByType({\n      stationId: curStationId.value,\n      deviceCategory: 'BoostDev',\n    });\n    if (res != null) {\n      deviceTypes.value = res;\n      if (!activeDeviceTab.value) {\n        activeDeviceTab.value = deviceTypes.value[0].deviceType;\n      }\n      if (result != null) {\n        deviceTypes.value.forEach((element) => {\n          element.alarmNum = result[element.deviceType];\n        });\n      }\n    }\n  };\n\n  // 获取设备数据\n  const selectedDevice = ref(null);\n  const deviceData = ref([]);\n  // 查询设备\n  const getDeviceData = async () => {\n    if (!activeDeviceTab.value) return;\n    let res = await getBoosterDevice({\n      stationId: curStationId.value,\n      deviceType: activeDeviceTab.value,\n    });\n    try {\n      if (res != null) {\n        deviceData.value = res.dataList;\n        alarmNum.value = res.alarmNum;\n        if (!isAutoRefresh.value) {\n          selectedDevice.value = res.dataList[0];\n        }\n        if (!selectedDevice.value) {\n          selectedDevice.value = res.dataList[0];\n        }\n        loadDetailInfo(selectedDevice.value);\n      }\n    } catch (error) {\n      //\n    }\n  };\n  const clickDeviceFlag = ref(false);\n  const clickDevice = async (deviceItem) => {\n    clickDeviceFlag.value = true;\n    await loadDetailInfo(deviceItem);\n  };\n  const loadDetailInfo = async (deviceItem) => {\n    selectedDevice.value = deviceItem;\n\n    if (clickDeviceFlag.value) {\n      activeDataTab.value = '1';\n      clickDeviceFlag.value = false;\n      if (dataDetailRef.value) {\n        dataDetailRef.value.clearTarget();\n      }\n      if (comparisonRef.value) {\n        comparisonRef.value.clearTarget();\n      }\n    }\n\n    await getYcData(selectedDevice.value);\n    await getYxData(selectedDevice.value);\n\n    if (isAutoRefresh.value) {\n      switch (activeDataTab.value) {\n        case '2':\n          if (warningRef.value) {\n            warningRef.value.reloadData(undefined, false);\n          }\n          break;\n        case '3':\n          if (dataDetailRef.value) {\n            dataDetailRef.value.loadChartData();\n          }\n          break;\n        case '4':\n          if (comparisonRef.value) {\n            comparisonRef.value.loadBaseInfo();\n          }\n        default:\n          break;\n      }\n    }\n  };\n  // 获取实时遥测数据\n  const ycData = ref([]);\n  const getYcData = async (deviceItem) => {\n    let res = await getRealTimeYc({\n      stationId: curStationId.value,\n      esn: deviceItem.esn,\n      dataType: 1,\n    });\n    ycData.value = res;\n  };\n\n  // 获取实时遥信数据\n  const yxData = ref([]);\n  const yxTime = ref('');\n  const getYxData = async (deviceItem) => {\n    let res = await getRealTimeYx({\n      stationId: curStationId.value,\n      esn: deviceItem.esn,\n      dataType: 1,\n    });\n    yxData.value = res.dataList;\n    yxTime.value = res.showTimeStr;\n  };\n\n  // 自动刷新\n  const isAutoRefresh = ref(true);\n  const taskRefreshID = 'BOOSTER_REFRESH';\n\n  // 刷新页面数据\n  const refreshData = async () => {\n    try {\n      await getDeviceData();\n    } catch (error) {\n      //\n    }\n  };\n\n  // 控制自动刷新函数\n  const handleAutoRefresh = (event) => {\n    try {\n      if (event?.target?.checked) {\n        // 如果勾选自动刷新，则将刷新函数加入线程，否则移除线程\n        TaskExecutor.getInstance().pushListTask(taskRefreshID, refreshData, 5000);\n      } else {\n        TaskExecutor.getInstance().removeListTask(taskRefreshID);\n      }\n    } catch (error) {\n      //\n    }\n  };\n\n  // 设备tab\n\n  const changeTab = async () => {\n    getDeviceData();\n    activeDataTab.value = '1';\n  };\n  // 测控\n  const showOptions = reactive({\n    right: [],\n    hasStatus: false,\n  });\n\n  onMounted(() => {\n    getPowerStationList();\n    // 启动刷新线程\n    TaskExecutor.getInstance().start();\n    if (isAutoRefresh.value) {\n      TaskExecutor.getInstance().pushListTask(taskRefreshID, refreshData, 5000);\n    }\n  });\n</script>\n\n<style lang=\"less\">\n  @import '../../style/themes.less';\n</style>\n\n<style lang=\"less\" scoped>\n  .booster-station-overview {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    padding: 10px;\n\n    .box-style {\n      border-radius: 2px;\n    }\n\n    .area-box {\n      margin-bottom: 10px;\n    }\n\n    .area-hearder-box {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      height: 54px;\n      padding: 0 16px;\n      border-bottom: none;\n\n      .station-selector-box {\n        display: flex;\n        align-items: center;\n\n        :deep(.ant-select) {\n          font-size: 16px;\n        }\n\n        :deep(.ant-select:not(.ant-select-customize-input) .ant-select-selector) {\n          border: none;\n        }\n\n        :deep(\n            .ant-select-focused:not(.ant-select-disabled).ant-select:not(.ant-select-customize-input)\n              .ant-select-selector\n          ) {\n          box-shadow: none;\n        }\n      }\n\n      .refresh-box {\n        width: 90px;\n      }\n    }\n\n    .select-box {\n      display: flex;\n      align-items: center;\n      margin-right: 20px;\n\n      &:last-child {\n        margin-right: 0;\n      }\n\n      .select-label-box {\n        margin-right: 14px;\n        font-size: 14px;\n      }\n    }\n\n    .status-checkbox-group-box {\n      .status-label-text {\n        margin-right: 6px;\n      }\n\n      .red-text {\n        color: #ff4d4f;\n      }\n    }\n\n    .device-box {\n      margin-bottom: 10px;\n\n      .device-tab-content {\n        .device-list-box {\n          margin-right: -21px;\n          padding: 11px 15px 0;\n          overflow: hidden;\n\n          .device-item-layout {\n            margin: 0 20px 16px 0;\n            float: left;\n            cursor: pointer;\n          }\n\n          :deep(.device-item) {\n            width: 188px;\n            min-height: 165px;\n          }\n        }\n      }\n    }\n\n    .tab-style {\n      :deep(.ant-tabs-large > .ant-tabs-nav .ant-tabs-tab) {\n        padding: 16px 4px;\n        line-height: 22px;\n      }\n\n      :deep(.ant-tabs-nav) {\n        padding-left: 15px;\n      }\n\n      .tab-bar-item {\n        position: relative;\n\n        .tab-tag {\n          position: absolute;\n          top: -10px;\n          right: -20px;\n          width: 20px;\n          height: 20px;\n          border-radius: 10px;\n          background-color: #ff4d4f;\n          color: #fffefe;\n          font-size: 12px;\n          line-height: 20px;\n          text-align: center;\n        }\n      }\n    }\n\n    :deep(.tab-style.ant-tabs-top > .ant-tabs-nav) {\n      margin-bottom: 0;\n    }\n\n    .device-table-box {\n      .status-icon {\n        display: inline-block;\n        width: 12px;\n        height: 12px;\n        border-radius: 50%;\n\n        &.green {\n          background-color: #52c41a;\n        }\n\n        &.red {\n          background-color: #ff4d4f;\n        }\n\n        &.grey {\n          color: #4e4e4e60;\n        }\n\n        &.white {\n          color: #f5f4f4;\n        }\n      }\n    }\n\n    .data-info-box {\n      flex: 1 1 auto;\n    }\n  }\n</style>\n"],"names":["taskRefreshID","curStationId","ref","stationList","alarmNum","warningRef","dataDetailRef","comparisonRef","activeDataTab","handleChange","value","option","__async","activeDeviceTab","getDeviceType","selectedDevice","getDeviceData","filterOption","input","getPowerStationList","res","getStations","deviceTypes","getDeviceTypes","result","getAlarmNumByType","element","deviceData","getBoosterDevice","isAutoRefresh","loadDetailInfo","error","clickDeviceFlag","clickDevice","deviceItem","getYcData","getYxData","ycData","getRealTimeYc","yxData","yxTime","getRealTimeYx","refreshData","handleAutoRefresh","event","_a","TaskExecutor","changeTab","showOptions","reactive","onMounted"],"mappings":"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"}