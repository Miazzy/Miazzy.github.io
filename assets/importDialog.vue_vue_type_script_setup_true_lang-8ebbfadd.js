var v=(b,g,t)=>new Promise((c,r)=>{var y=e=>{try{o(t.next(e))}catch(p){r(p)}},i=e=>{try{o(t.throw(e))}catch(p){r(p)}},o=e=>e.done?c(e.value):Promise.resolve(e.value).then(y,i);o((t=t.apply(b,g)).next())});import{au as L,a0 as N,I as q}from"./index.js";import{D as M}from"./Dialog-0a006d82.js";import{d as T,k as u,r as z,w as A,o as H,al as _,Z as Y,a9 as Z,aa as d,$ as m,f as s,E as $}from"./vue-71d1abb3.js";const j={style:{"padding-top":"20px"}},G=m("div",{class:"el-upload__text"},[$(" 将文件拖到此处，或 "),m("em",null,"点击上传")],-1),J=m("div",{class:"el-upload__tip",style:{color:"red"}}," 提示：仅允许导入“bpm”或“xml”格式文件！ ",-1),K="/admin-api/bpm/model/import",ee=T({name:"ImportDialog",__name:"importDialog",props:{visible:Boolean,category:String},emits:["update:visible","success"],setup(b,{expose:g,emit:t}){const c=b,r=L(),y=N(),i=u(!1),o=u(!1),e=u({key:"",name:"",description:"",category:""}),p=z({key:[{required:!0,message:"流程标识不能为空",trigger:"blur"}],name:[{required:!0,message:"流程名称不能为空",trigger:"blur"}]}),f=u(),x=u(),w=u(),V=u([]);g({open:()=>v(this,null,function*(){C()})});const U=()=>v(this,null,function*(){if(!(!f.value||!(yield f.value.validate()))){if(V.value.length==0){r.error("请上传文件");return}w.value={Authorization:"Bearer "+y.getToken},o.value=!0,e.value.category=c.category,x.value.submit()}}),F=l=>v(this,null,function*(){if(l.code!==0){r.error(l.msg),o.value=!1;return}r.success("导入流程成功！请点击【设计流程】按钮，进行编辑保存后，才可以进行【发布流程】"),t("success")}),B=()=>{r.error("导入流程失败，请您重新上传！"),o.value=!1},C=()=>{var l,a;o.value=!1,(l=x.value)==null||l.clearFiles(),e.value={key:"",name:"",description:""},(a=f.value)==null||a.resetFields()},D=()=>{r.error("最多只能上传一个文件！")},R=l=>{i.value=l,t("update:visible",!1)},S=()=>{i.value=!1,t("update:visible",!1)};return A(()=>c.visible,l=>{i.value=l}),H(()=>{i.value=c.visible}),(l,a)=>{const k=_("el-input"),h=_("el-form-item"),E=_("el-form"),I=_("el-upload");return Y(),Z(M,{visible:i.value,"onUpdate:visible":R,title:"导入流程",width:600,height:500,overflowY:"scroll",onConfirm:U,onCancel:S},{default:d(()=>[m("div",j,[s(I,{ref_key:"uploadRef",ref:x,"file-list":V.value,"onUpdate:fileList":a[3]||(a[3]=n=>V.value=n),action:K,"auto-upload":!1,data:e.value,disabled:o.value,headers:w.value,limit:1,"on-error":B,"on-exceed":D,"on-success":F,accept:".bpmn, .xml",drag:"",name:"bpmnFile"},{tip:d(()=>[J,m("div",null,[s(E,{ref_key:"formRef",ref:f,model:e.value,rules:p,"label-width":"120px"},{default:d(()=>[s(h,{label:"流程标识",prop:"key"},{default:d(()=>[s(k,{modelValue:e.value.key,"onUpdate:modelValue":a[0]||(a[0]=n=>e.value.key=n),placeholder:"请输入流标标识",style:{width:"250px"}},null,8,["modelValue"])]),_:1}),s(h,{label:"流程名称",prop:"name"},{default:d(()=>[s(k,{modelValue:e.value.name,"onUpdate:modelValue":a[1]||(a[1]=n=>e.value.name=n),clearable:"",placeholder:"请输入流程名称"},null,8,["modelValue"])]),_:1}),s(h,{label:"流程描述",prop:"description"},{default:d(()=>[s(k,{modelValue:e.value.description,"onUpdate:modelValue":a[2]||(a[2]=n=>e.value.description=n),clearable:"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),default:d(()=>[s(q,{class:"el-icon--upload",icon:"ep:upload-filled"}),G]),_:1},8,["file-list","data","disabled","headers"])])]),_:1},8,["visible"])}}});export{ee as _};
//# sourceMappingURL=importDialog.vue_vue_type_script_setup_true_lang-8ebbfadd.js.map
