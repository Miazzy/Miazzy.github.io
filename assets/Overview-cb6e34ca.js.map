{"version":3,"file":"Overview-cb6e34ca.js","sources":["../../src/views/da/cockpit/overview/data.ts","../../src/views/da/cockpit/overview/Overview.vue"],"sourcesContent":["import { defHttp } from '/@/utils/http/axios';\n\nenum Api {\n  // 首页电站数据\n  // getHomePageStationsUrl = '/da/home-page/stations',\n  getHomePageStationsUrl = '/da/group-operation/overview/station/info',\n}\n\nexport const getHomePageStations = (params) =>\n  defHttp.post({ url: Api.getHomePageStationsUrl, params }, {});\n","<template>\n  <div class=\"layout rem-layout\">\n    <div class=\"dashboard\" :class=\"{ 'header-off': tabStatus === 'off' }\">\n      <div id=\"map-container\" class=\"map-container\"></div>\n      <div class=\"mask-left\"></div>\n      <div class=\"mask-top\"></div>\n      <div class=\"mask-right\"></div>\n      <div class=\"mask-bottom\"></div>\n      <CockpitHeader\n        v-if=\"tabStatus === 'on'\"\n        class=\"header-layout\"\n        :title=\"title\"\n        @date-change=\"handleDateChange\"\n      />\n      <CockpitSetting v-if=\"tabStatus === 'off'\" @date-change=\"handleDateChange\" />\n      <LeftContent ref=\"leftContentRef\" :searchInfoByTime=\"searchInfoByTime\" :tabStatus=\"tabStatus\" />\n      <TopInfoContent :searchInfoByTime=\"searchInfoByTime\" />\n      <BottomInfoContent :searchInfoByTime=\"searchInfoByTime\" />\n      <RightContent ref=\"rightContentRef\" :searchInfoByTime=\"searchInfoByTime\" :tabStatus=\"tabStatus\" />\n    </div>\n  </div>\n</template>\n<script lang=\"ts\" setup>\n  import '../../rem.ts';\n  import { ref, onMounted, onUnmounted, getCurrentInstance, watch, nextTick } from 'vue';\n  import CockpitHeader from '/@/components/Framework/Chart/CockpitHeader.vue';\n  import CockpitSetting from '/@/components/Framework/Chart/CockpitSetting.vue';\n  import LeftContent from '/@/views/da/cockpit/overview/LeftContent.vue';\n  import TopInfoContent from '/@/views/da/cockpit/overview/TopInfoContent.vue';\n  import BottomInfoContent from '/@/views/da/cockpit/overview/BottomInfoContent.vue';\n  import RightContent from '/@/views/da/cockpit/overview/RightContent.vue';\n  import stationIcon from '/images/station.svg';\n  import { getHomePageStations } from './data';\n  import { handleInstanceUpdated } from '/@/utils/route';\n  import { useRouter } from 'vue-router';\n\n  const router = useRouter();\n  const title = ref('总览驾驶舱');\n  const searchInfoByTime = ref({}); // 时间参数\n  const refreshFlag = ref(true);\n  const stationData = ref();\n  const mapObject = ref(null); // 地图\n  const tabStatus = ref('');\n  const instance = getCurrentInstance();\n  const leftContentRef = ref();\n  const rightContentRef = ref();\n\n  // 获取日期范围函数\n  const handleDateChange = ([startDate, endDate]) => {\n    searchInfoByTime.value = { startMonth: startDate, endMonth: endDate };\n  };\n\n  // 初始化地图函数\n  const initMap = () => {\n    try {\n      mapObject.value = new BMapGL.Map('map-container'); // 创建Map实例\n      mapObject.value.enableScrollWheelZoom(true); //开启鼠标滚轮缩放\n      mapObject.value.setMapType(BMAP_EARTH_MAP); // 设置地图类型为地球模式\n      mapObject.value.centerAndZoom(new BMapGL.Point(118.8, 37.5), 8); // 初始化地图,设置中心点坐标和地图级别\n    } catch (error) {\n      console.error('init map error:', error);\n    }\n  };\n\n  // 销毁地图函数\n  const destoryMap = () => {\n    try {\n      const dom = document.getElementById('map-container');\n      if (mapObject.value) {\n        mapObject.value?.destroy(); // 销毁地图\n        mapObject.value = null; // 销毁地图，防止内存泄露\n      }\n      if (dom) {\n        dom.innerHTML = '';\n      }\n    } catch (error) {\n      console.error('destory map error:', error);\n    }\n  };\n\n  const getPageStations = async () => {\n    stationData.value = await getHomePageStations({});\n  };\n\n  // 获取mark 并将mark 标记在地图上\n  const getDoMarkData = async () => {\n    try {\n      clearOverlays();\n      if (stationData.value.result?.length) {\n        let markData = stationData.value.result;\n        markData.forEach((item) => {\n          let pt = new BMapGL.Point(item.longitude, item.latitude);\n          createMark(pt, item);\n        });\n      }\n    } catch {\n      //\n    }\n  };\n\n  // 创建mark\n  const createMark = (pt, markItem) => {\n    let myIcon = new BMapGL.Icon(stationIcon, new BMapGL.Size(30, 30), {\n      anchor: new BMapGL.Size(15, 30),\n    });\n\n    // 创建标注对象并添加到地图\n    let marker = new BMapGL.Marker(pt, { icon: myIcon });\n    mapObject.value.addOverlay(marker); // 创建标记\n\n    // 添加title 标题信息\n    let label = createLabel(pt, markItem.name);\n    mapObject.value.addOverlay(label);\n  };\n\n  // 创建label\n  const createLabel = (pt, content) => {\n    let opts = {\n      position: pt, // 指定文本标注所在的地理位置\n      offset: new BMapGL.Size(10, -40), //设置文本偏移量\n    };\n    let label = new BMapGL.Label(content, opts); // 创建文本标注对象\n    label.setStyle({\n      //样式\n      width: 'auto !important',\n      color: 'white',\n      fontSize: '12px',\n      backgroundColor: 'rgba(0,0,0)',\n      border: 0,\n      padding: '6px',\n      borderRadius: '3px',\n    });\n    return label; // 返回label\n  };\n\n  // 清空地图Overlays\n  const clearOverlays = () => {\n    mapObject.value.clearOverlays();\n  };\n\n  // 判断当前页面是否在 iframe 中显示\n  const checkInIframe = () => {\n    try {\n      return window.self !== window.top;\n    } catch (e) {\n      return true;\n    }\n  };\n\n  const checkIsCurrentPage = () => {\n    const path = router.currentRoute.value?.path;\n    return path === '/frame/cockpit/overview' || path === '/cockpitoverview';\n  };\n\n  // 检测地图是否为空函数\n  const checkIsMapEmpty = () => {\n    return !document.querySelector('#map-container').innerHTML;\n  };\n\n  // 更新页面\n  const handlePageUpdate = () => {\n    const path = router.currentRoute.value?.path;\n    if (path === '/frame/cockpit/overview') {\n      handleInstanceUpdated(instance, destoryMap);\n    } else if (path === '/cockpitoverview') {\n      leftContentRef.value?.handleUpdate();\n      rightContentRef.value?.handleUpdate();\n    }\n  };\n\n  // 监听路由变化\n  watch(\n    () => router.currentRoute.value,\n    () => {\n      if (checkIsCurrentPage()) {\n        setTimeout(() => {\n          if (checkIsMapEmpty()) {\n            destoryMap();\n            initMap();\n            getDoMarkData();\n          }\n        }, 500);\n      }\n    },\n  );\n\n  onMounted(async () => {\n    tabStatus.value = checkInIframe() ? 'off' : 'on';\n    await getPageStations();\n    initMap();\n    getDoMarkData();\n    window.addEventListener('resize', handlePageUpdate);\n  });\n\n  onUnmounted(() => {\n    destoryMap();\n  });\n</script>\n\n<style lang=\"less\" scoped>\n  .layout {\n    position: relative;\n    width: 100%;\n    height: 100%;\n\n    .map-container {\n      width: 100%;\n      height: 100%;\n    }\n\n    .dashboard {\n      position: absolute;\n      z-index: 10;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n\n      :deep(.ant-select-selection-search-input) {\n        color: rgb(255 255 255 / 85%);\n      }\n\n      :deep(.ant-select-selection-item) {\n        color: rgb(255 255 255 / 85%);\n      }\n\n      :deep(\n          .ant-select-single .ant-select-selector .ant-select-selection-item,\n          .ant-select-single .ant-select-selector .ant-select-selection-placeholder\n        ) {\n        line-height: 0.24rem;\n      }\n\n      :deep(.ant-select) {\n        font-size: 0.14rem;\n      }\n\n      // .content {\n      //   position: relative;\n      //   display: flex;\n      //   justify-content: space-between;\n      //   flex: 1;\n      //   flex-shrink: 0;\n      //   margin-top: 0.2rem;\n\n      //   :deep(.ant-select-selection-search-input) {\n      //     color: rgb(255 255 255 / 85%);\n      //   }\n\n      //   :deep(.ant-select-selection-item) {\n      //     color: rgb(255 255 255 / 85%);\n      //   }\n\n      //   :deep(\n      //       .ant-select-single .ant-select-selector .ant-select-selection-item,\n      //       .ant-select-single .ant-select-selector .ant-select-selection-placeholder\n      //     ) {\n      //     line-height: 0.24rem;\n      //   }\n\n      //   :deep(.ant-select) {\n      //     font-size: 0.14rem;\n      //   }\n      // }\n      .header-layout {\n        position: fixed;\n        z-index: 99;\n        top: 0;\n        left: 0;\n        width: 100%;\n      }\n\n      .mask-left {\n        position: absolute;\n        z-index: 98;\n        top: 0;\n        left: 0;\n        width: 28vw;\n        height: 100vh;\n        background: url('../../images/left.png') no-repeat center/100% 100%;\n      }\n\n      .mask-top {\n        position: absolute;\n        z-index: 98;\n        top: 0;\n        left: 0;\n        width: 100vw;\n        height: calc(0.9rem + 13vh);\n        background: url('../../images/top.png') no-repeat center/100% 100%;\n      }\n\n      .mask-right {\n        position: absolute;\n        z-index: 98;\n        top: 0;\n        right: 0;\n        width: 28vw;\n        height: 100vh;\n        background: url('../../images/right.png') no-repeat center/100% 100%;\n      }\n\n      .mask-bottom {\n        position: absolute;\n        z-index: 98;\n        bottom: 0;\n        left: 0;\n        width: 100vw;\n        height: calc(0.16rem + 8vw);\n        background: url('../../images/bottom.png') no-repeat center/100% 100%;\n      }\n    }\n\n    .header-off {\n      .mask-top {\n        height: calc(0.2rem + 13vh);\n      }\n\n      :deep(.left-content) {\n        top: 0.2rem;\n        height: calc(100vh - 0.2rem);\n      }\n\n      :deep(.right-content) {\n        top: 0.2rem;\n        height: calc(100vh - 0.2rem);\n      }\n\n      :deep(.top-info-content) {\n        top: 0.2rem;\n      }\n    }\n  }\n</style>\n"],"names":["getHomePageStations","params","defHttp","router","useRouter","title","ref","searchInfoByTime","stationData","mapObject","tabStatus","instance","getCurrentInstance","leftContentRef","rightContentRef","handleDateChange","startDate","endDate","initMap","error","destoryMap","dom","_a","getPageStations","__async","getDoMarkData","clearOverlays","item","pt","createMark","e","markItem","myIcon","stationIcon","marker","label","createLabel","content","opts","checkInIframe","checkIsCurrentPage","path","checkIsMapEmpty","handlePageUpdate","handleInstanceUpdated","_b","_c","watch","onMounted","onUnmounted"],"mappings":"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"}