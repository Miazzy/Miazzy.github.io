var y=(x,b,g)=>new Promise((N,D)=>{var n=f=>{try{d(g.next(f))}catch(C){D(C)}},I=f=>{try{d(g.throw(f))}catch(C){D(C)}},d=f=>f.done?N(f.value):Promise.resolve(f.value).then(n,I);d((g=g.apply(x,b)).next())});import{d as se,aD as re,k as h,r as A,o as ie,al as _,Z as T,a9 as q,aa as t,$ as k,f as e,_ as de,E as U,ad as B,u as v,ac as R,v as p,A as c,ag as ue,J as me,aG as pe,aH as ce}from"./vue-71d1abb3.js";import{b as fe,av as F,aC as _e,a7 as j,at as S,_ as ve}from"./index.js";import{D as ge}from"./Dialog-0a006d82.js";import{B as be}from"./BasicTable-0434a334.js";import{T as ye}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as he}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{_ as P}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{S as xe}from"./SearchBox-22bb02d6.js";import{C as Ce}from"./CommonTree-c4ed7838.js";import{h as De}from"./menu.data-50891193.js";import{a as Ie,b as ke,f as we,h as Te,i as Se,j as Ne}from"./schedule.data-4e5a19b6.js";import{P as Me}from"./index-20519caf.js";import{a as V}from"./assign-37f1c13d.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./UploadBox-636ecf02.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./index-3801a970.js";import"./useRender-21ce56fb.js";import"./useContentViewHeight-7f845167.js";const qe=x=>(pe("data-v-3ec2cc93"),x=x(),ce(),x),Ue={class:"load"},Be={class:"process-box"},Re={class:"header-box"},Le=qe(()=>k("div",{class:"header-left"},"工作安排设置",-1)),Ye={key:0,class:"header-right"},Ee={class:"content"},He=se({__name:"create",setup(x){const{t:b}=fe(),{query:g}=re(),N=h(!1),D=h(),n=A({spinning:!1,status:1}),I=h(),d=h(!!g.isReadonly),f=h(),C=h([]),w=A({open:h(!1)}),[K,{getDataSource:M}]=he({dataSource:I,columns:Ie,bordered:!0,useSearchForm:!1,canResize:!0,pagination:!1,showTableSetting:!1,tableSetting:{fullScreen:!0},actionColumn:{width:100,title:b("common.operate"),dataIndex:"action",fixed:"right",ifShow:()=>!d.value}});function O(){var l;(l=f.value)==null||l.cancelCheck(),w.open=!0}const $=l=>y(this,null,function*(){var u;const a=M(),m=a.findIndex(r=>r.key===l.key);a.splice(m,1),(u=l.onEdit)==null||u.call(l,!1,!1)});function z(l){return[{label:b("common.delText"),icon:F.DELETE,danger:!0,popConfirm:{title:"是否确认删除",confirm:$.bind(null,l)}}]}const L=()=>{_e(),j.getInstance().sendMsg("work-schedule",{})},G=()=>{D.value.validate().then(()=>{const l=me(n);if(J(l.startDate,l.endDate)){S.getInstance().error("开始日期必须小于或等于结束日期");return}const a=M();if(a.length===0){S.getInstance().error("请选择接收范围");return}l.receiveRangeList=a,W(l)}).catch(l=>{console.log("onSubmit=》error",l)})},J=(l,a)=>{const m=new Date(Date.parse(l)),u=new Date(Date.parse(a));return m>u},W=l=>y(this,null,function*(){n.spinning=!0;try{yield we(l).then(a=>{n.id=a.result,S.getInstance().success(b("common.saveSuccessText")),j.getInstance().sendMsg("home-page-work-schedule",{})}),setTimeout(function(){L()},200)}finally{n.spinning=!1}}),Z=()=>y(this,null,function*(){if(V(n,g),g.id){const l=yield Te(g.id);V(n,l)}}),Q=l=>{l!=="data_fill"&&(n.menuId="",n.menuName="",n.workMenuId="")},X=(l,a)=>{n.menuId=a==null?void 0:a.record.menuId,n.workMenuId=a==null?void 0:a.record.key},ee=()=>{const l=f.value.getCheckedKeys();if(l.length===0)return;const a={};let m=[];for(let r=0;r<l.length;r++){const o=l[r];if(o.nodeKindId!=="pos")continue;let i=a[o.powerStationId];if(i){i.id.push(o.id),i.name.push(o.name);continue}a[o.powerStationId]={id:[o.id],name:[o.name]},m.push({stationOrganId:o.organId,stationOrganName:o.organName,stationId:o.powerStationId,stationName:o.powerStationName})}const u=M();for(let r=0;r<m.length;r++){const o=m[r];for(let i=0;i<u.length;i++)if(o.stationId===u[i].stationId){S.getInstance().error(`电站【${u[i].stationName}】已存在`);return}for(let i in a)i===o.stationId&&(o.postId=a[i].id.join(","),o.postName=a[i].name.join(","))}I.value=u.concat(m),w.open=!1},ae=()=>y(this,null,function*(){I.value=yield Se(n.id)});function te(){return y(this,null,function*(){const l=yield Ne({});C.value=l})}return ie(()=>y(this,null,function*(){yield Z(),ae(),te()})),(l,a)=>{const m=_("a-button"),u=_("a-input"),r=_("a-form-item"),o=_("a-col"),i=_("a-row"),Y=_("a-date-picker"),ne=_("a-time-picker"),E=_("a-card"),H=_("a-form"),le=_("a-spin");return T(),q(v(Me),{detail:!0,dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"fix-detail-page",style:{position:"relative"}},{default:t(()=>[k("div",Ue,[e(le,{spinning:n.spinning,tip:"Loading..."},{default:t(()=>[k("div",Be,[k("div",Re,[Le,d.value?R("",!0):(T(),de("div",Ye,[e(m,{style:{"margin-right":"10px"},onClick:L},{default:t(()=>[U(B(v(b)("common.cancelText")),1)]),_:1}),e(m,{type:"primary",onClick:G,loading:N.value},{default:t(()=>[U(B(v(b)("common.saveText")),1)]),_:1},8,["loading"])]))]),k("div",Ee,[e(H,{ref_key:"formRef",ref:D,model:n,labelAlign:"right",autocomplete:"off"},{default:t(()=>[e(E,{title:"基本信息",bordered:!1},{default:t(()=>[e(i,{gutter:32},{default:t(()=>[p(e(o,{span:24},{default:t(()=>[e(r,{name:"content",label:"内容",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请输入内容"}]},{default:t(()=>[e(u,{value:n.content,"onUpdate:value":a[0]||(a[0]=s=>n.content=s),maxlength:100,disabled:d.value},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),e(i,{gutter:32},{default:t(()=>[p(e(o,{span:12},{default:t(()=>[e(r,{name:"type",label:"类型",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请选择类型"}]},{default:t(()=>[e(P,{value:n.type,"onUpdate:value":a[1]||(a[1]=s=>n.type=s),type:"work_schedule_type",disabled:d.value,onChange:Q},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]]),n.type==="data_fill"?p((T(),q(o,{key:0,span:12},{default:t(()=>[e(r,{name:"menuName",label:"工作菜单",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请选择工作菜单"}]},{default:t(()=>[e(xe,{value:n.menuName,"onUpdate:value":a[2]||(a[2]=s=>n.menuName=s),api:v(De),columns:v(ke),vfield:"menuName",searchKey:"menuName",pagination:!0,disabled:d.value,onChange:X},null,8,["value","api","columns","disabled"])]),_:1})]),_:1},512)),[[c,!0]]):R("",!0)]),_:1}),e(i,{gutter:32},{default:t(()=>[p(e(o,{span:12},{default:t(()=>[e(r,{name:"startDate",label:"开始日期",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请输入开始日期"}]},{default:t(()=>[e(Y,{value:n.startDate,"onUpdate:value":a[3]||(a[3]=s=>n.startDate=s),style:{width:"100%"},"value-format":"YYYY-MM-DD",disabled:d.value},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]]),p(e(o,{span:12},{default:t(()=>[e(r,{name:"endDate",label:"结束日期",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请输入结束日期"}]},{default:t(()=>[e(Y,{value:n.endDate,"onUpdate:value":a[4]||(a[4]=s=>n.endDate=s),style:{width:"100%"},"value-format":"YYYY-MM-DD",disabled:d.value},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),e(i,{gutter:32},{default:t(()=>[p(e(o,{span:12},{default:t(()=>[e(r,{name:"reminderTime",label:"建议时间",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请输入建议时间"}]},{default:t(()=>[e(ne,{value:n.reminderTime,"onUpdate:value":a[5]||(a[5]=s=>n.reminderTime=s),style:{width:"100%"},format:"HH:mm","value-format":"HH:mm",disabled:d.value},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]]),p(e(o,{span:12},{default:t(()=>[e(r,{name:"repeatRule",label:"重复类型",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请选择重复类型"}]},{default:t(()=>[e(P,{value:n.repeatRule,"onUpdate:value":a[6]||(a[6]=s=>n.repeatRule=s),type:"repeatingRules",disabled:d.value},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),e(i,{gutter:32},{default:t(()=>[p(e(o,{span:12},{default:t(()=>[e(r,{name:"creatorName",label:"创建人",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:t(()=>[e(u,{value:n.creatorName,"onUpdate:value":a[7]||(a[7]=s=>n.creatorName=s),disabled:""},null,8,["value"])]),_:1})]),_:1},512),[[c,!0]]),p(e(o,{span:12},{default:t(()=>[e(r,{name:"createTime",label:"创建时间",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:t(()=>[e(u,{value:n.createTime,"onUpdate:value":a[8]||(a[8]=s=>n.createTime=s),disabled:""},null,8,["value"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),e(i,{gutter:32},{default:t(()=>[p(e(o,{span:12},{default:t(()=>[e(r,{name:"updaterName",label:"修改人",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:t(()=>[e(u,{value:n.updaterName,"onUpdate:value":a[9]||(a[9]=s=>n.updaterName=s),disabled:""},null,8,["value"])]),_:1})]),_:1},512),[[c,!0]]),p(e(o,{span:12},{default:t(()=>[e(r,{name:"updateTime",label:"修改时间",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:t(()=>[e(u,{value:n.updateTime,"onUpdate:value":a[10]||(a[10]=s=>n.updateTime=s),disabled:""},null,8,["value"])]),_:1})]),_:1},512),[[c,!0]])]),_:1})]),_:1})]),_:1},8,["model"]),e(E,{bordered:!1},{default:t(()=>[e(v(be),{title:"接收范围",onRegister:v(K)},ue({_:2},[d.value?void 0:{name:"toolbar",fn:t(()=>[e(m,{type:"primary",preIcon:v(F).ADD,onClick:O},{default:t(()=>[U(B(v(b)("common.action.create")),1)]),_:1},8,["preIcon"])]),key:"0"},d.value?void 0:{name:"bodyCell",fn:t(({column:s,record:oe})=>[s.key==="action"?(T(),q(v(ye),{key:0,actions:z(oe)},null,8,["actions"])):R("",!0)]),key:"1"}]),1032,["onRegister"])]),_:1})])])]),_:1},8,["spinning"])]),e(ge,{visible:w.open,"onUpdate:visible":a[11]||(a[11]=s=>w.open=s),title:"选择接收范围",onOk:ee},{default:t(()=>[e(H,{ref:"modalFormRef",model:n,name:"nameForm",autocomplete:"off"},{default:t(()=>[e(i,null,{default:t(()=>[p(e(o,{span:24},{default:t(()=>[e(Ce,{class:"fix-tree-layout",ref_key:"modalTreeRef",ref:f,value:C.value,toolbar:!1,checkable:"",fieldNames:{key:"id",title:"name"}},null,8,["value"])]),_:1},512),[[c,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])]),_:1})}}});const va=ve(He,[["__scopeId","data-v-3ec2cc93"]]);export{va as default};
//# sourceMappingURL=create-cc56b66c.js.map
