{"version":3,"file":"index-625e75dd.js","sources":["../../src/views/po/integrated/vehicle/index.vue"],"sourcesContent":["<template>\n  <PageWrapper dense contentFullHeight fixedHeight contentClass=\"flex\" style=\"position: relative\">\n    <CommonTree\n      title=\"电站组织\"\n      @select=\"handleSelect\"\n      :value=\"treeData\"\n      class=\"left-tree-layout\"\n      :toolbar=\"true\"\n      :canEdit=\"false\"\n      :canAdd=\"false\"\n      :canDelete=\"false\"\n      :isShowOperationBtns=\"false\"\n      :fieldNames=\"{ key: 'id', title: 'name' }\"\n    />\n    <div class=\"right-table-layout\">\n      <BasicTable\n        @register=\"registerTable\"\n        class=\"fix-basic-table\"\n        :searchInfo=\"searchInfo\"\n        @resize-column=\"(w, col) => (col.width = w)\"\n        @row-db-click=\"(record) => handleView(record)\"\n        @selection-change=\"handleSelectionChange\"\n      >\n        <template #toolbar>\n          <a-button type=\"primary\" :preIcon=\"IconEnum.ADD\" @click=\"handleAdd\">{{\n            t('common.action.create')\n          }}</a-button>\n          <a-button\n            :disabled=\"disabledBtn\"\n            type=\"primary\"\n            :preIcon=\"IconEnum.EDIT\"\n            @click=\"handleEdit\"\n            >{{ t('common.action.edit') }}</a-button\n          >\n          <a-button\n            :disabled=\"disabledBtn\"\n            class=\"red-btn\"\n            :preIcon=\"IconEnum.DELETE\"\n            @click=\"handleDelete\"\n            >{{ t('common.delText') }}</a-button\n          >\n          <a-button class=\"yellow-btn\" :preIcon=\"IconEnum.EXPORT\" @click=\"handleExport\">{{\n            t('common.action.export')\n          }}</a-button>\n        </template>\n      </BasicTable>\n    </div>\n  </PageWrapper>\n</template>\n<script lang=\"ts\" setup>\n  import { onMounted, reactive, ref } from 'vue';\n  import { useMessage } from '@/hooks/web/useMessage';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { IconEnum } from '@/enums/appEnum';\n  import { BasicTable, useTable, SorterResult } from '/@/components/Table';\n  import { TreeItem } from '/@/components/Tree';\n  import { PageWrapper } from '/@/components/Page';\n  import CommonTree from '@/components/Framework/Tree/CommonTree.vue';\n  import { exportExcelFile } from '@/utils/file/download';\n  import {\n    getTreeList,\n    getPage,\n    exportExcel,\n    getColumns,\n    searchForm,\n    deleteData,\n  } from './vehicle.data';\n  import { assign } from 'lodash-es';\n  import { addTabPage } from '@/utils/route';\n  import { MsgManager } from '@/message/MsgManager';\n\n  const { t } = useI18n();\n  const message = useMessage();\n  const treeData = ref<TreeItem[]>([]);\n  const searchInfo = reactive<any>({});\n  const checkedNode = reactive<any>({});\n  const disabledBtn = ref<boolean>(true);\n  const getPageByParam = async () => {\n    const paginationRef = getPaginationRef() as any;\n    const searchPageInfo = reactive<any>({});\n    assign(searchPageInfo, searchInfo);\n    searchPageInfo.pageNo = paginationRef.current;\n    searchPageInfo.pageSize = paginationRef.pageSize;\n    if (!searchPageInfo.sortField) {\n      searchPageInfo.sortField = 'createTime';\n      searchPageInfo.sortOrder = 'desc';\n    }\n    let pageList = await getPage(searchPageInfo);\n    return pageList.result;\n  };\n\n  const tableTitle = ref<string>('车辆信息');\n  const [registerTable, { reload, clearSelectedRowKeys, getPaginationRef, getSelectRows }] =\n    useTable({\n      title: tableTitle,\n      api: getPageByParam,\n      columns: getColumns() as any,\n      useSearchForm: true,\n      formConfig: searchForm,\n      bordered: true,\n      rowKey: 'id',\n      rowSelection: {\n        type: 'radio',\n      },\n      sortFn: (sortInfo: SorterResult) => {\n        const sortOrder = sortInfo.order?.replace('end', '');\n        searchInfo.sortOrder = sortOrder;\n        searchInfo.sortField = sortOrder ? sortInfo.field : undefined;\n      },\n      handleSearchInfoFn(info) {\n        assign(searchInfo, info);\n        return info;\n      },\n      showTableSetting: true,\n      tableSetting: { fullScreen: true },\n      showIndexColumn: true,\n    });\n\n  // 查询左侧树数据\n  async function queryTreeList() {\n    const typeList = await getTreeList({});\n    treeData.value = typeList.result as unknown[] as TreeItem[];\n  }\n\n  // 左侧树选中事件\n  function handleSelect(node) {\n    searchInfo.stationId = null;\n    searchInfo.stationOrganId = null;\n    checkedNode.stationId = '';\n    checkedNode.stationName = '';\n    checkedNode.stationOrganId = '';\n    checkedNode.stationOrganName = '';\n    if (node) {\n      if (node.nodeKindId === 'org') {\n        searchInfo.stationOrganId = node.id;\n      }\n      if (node.nodeKindId === 'station') {\n        searchInfo.stationId = node.powerStationId;\n        checkedNode.stationId = node.powerStationId;\n        checkedNode.stationName = node.powerStationName;\n        checkedNode.stationOrganId = node.organId;\n        checkedNode.stationOrganName = node.organName;\n      }\n    }\n    reload();\n  }\n\n  function handleAdd() {\n    if (!checkedNode.stationId) {\n      message.error('请选择电站组织');\n      return;\n    }\n    addTabPage('/po/integrated/vehicle/create', getTabPageName({}), { ...checkedNode });\n  }\n\n  function handleEdit() {\n    const id = checkSelectData();\n    if (!id) {\n      return;\n    }\n    addTabPage(`/po/integrated/vehicle/create?id=${id}`, getTabPageName({ id: id }));\n  }\n\n  function handleView(record: any) {\n    addTabPage(\n      `/po/integrated/vehicle/create?id=${record.id}&isReadonly=true`,\n      getTabPageName(record, true),\n    );\n  }\n\n  const getTabPageName = (record: any, isView?: boolean) => {\n    const name = tableTitle.value;\n    if (isView) {\n      return `查看${name}`;\n    }\n    if (!record?.id) {\n      return `${t('common.action.create')}${name}`;\n    }\n    return `${t('common.action.edit')}${name}`;\n  };\n\n  const handleDelete = async () => {\n    const id = checkSelectData();\n    if (!id) {\n      return;\n    }\n    await message.delConfirm();\n    await deleteData(`?id=${id}`);\n    message.success(t('common.delSuccess'));\n    clearSelectedRowKeys();\n    reload();\n  };\n\n  function checkSelectData() {\n    const rows = getSelectRows();\n    if (rows.length == 0) {\n      message.error('请选择一行数据');\n      return false;\n    }\n    return rows[0].id;\n  }\n\n  function handleExport() {\n    message.createConfirm({\n      title: t('common.message.confirmTitle'),\n      iconType: 'warning',\n      content: t('common.message.exportMessage'),\n      async onOk() {\n        searchInfo.filename = `${tableTitle.value}.xls`;\n        await exportExcel(searchInfo).then((res) => {\n          exportExcelFile(res?.data, searchInfo.filename);\n        });\n        searchInfo.filename = null;\n        message.success(t('common.exportSuccessText'));\n      },\n    });\n  }\n\n  function handleSelectionChange({ rows }) {\n    disabledBtn.value = rows.length === 0;\n  }\n\n  // 启动执行代码\n  onMounted(() => {\n    queryTreeList();\n\n    MsgManager.getInstance().listen('integrated-vehicle', reload);\n  });\n</script>\n<style lang=\"less\" scoped>\n  @import '/@/design/biz/bizList.less';\n</style>\n"],"names":["useI18n","message","useMessage","treeData","ref","searchInfo","reactive","checkedNode","disabledBtn","getPageByParam","__async","paginationRef","getPaginationRef","searchPageInfo","assign","getPage","tableTitle","registerTable","reload","clearSelectedRowKeys","getSelectRows","useTable","getColumns","searchForm","sortInfo","sortOrder","_a","info","queryTreeList","typeList","getTreeList","handleSelect","node","handleAdd","addTabPage","getTabPageName","__spreadValues","handleEdit","id","checkSelectData","handleView","record","isView","name","handleDelete","deleteData","rows","handleExport","exportExcel","res","exportExcelFile","handleSelectionChange","onMounted","MsgManager"],"mappings":"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"}