{"version":3,"file":"MiddleContent-dda61147.js","sources":["../../src/views/da/cockpit/security/MiddleContent.vue"],"sourcesContent":["<template>\n  <div class=\"middle-content\" :key=\"instanceKey\">\n    <div class=\"left-section section-box\">\n      <div class=\"section-bg\">\n        <SubtitleBar :subtitle=\"`安全检查`\">\n          <a-select\n            v-model:value=\"formState.safetyCheck\"\n            :options=\"dimensionTypeData\"\n            @change=\"handleSafetyCheckChange\"\n            style=\"width: 1.2rem\"\n            v-show=\"dimensionTypeData.length > 1\"\n          />\n        </SubtitleBar>\n        <IndicatorGroup\n          :data=\"securityData\"\n          :style=\"tabStatus === 'on' ? 'margin-top: -0.15rem' : 'margin-top: -0.2rem'\"\n          class=\"indicator-group-layout\"\n          :class=\"tabStatus === 'on' ? '' : 'fix-indicator-group-padding'\"\n          @click-item=\"clickSafetyCheckAll\"\n        />\n        <div style=\"width: 100%; height: 2rem\">\n          <div style=\"margin-left: 0.16rem; transform: scale(0.85); transform-origin: 0 0\">\n            <EchartLineBarChart\n              :data=\"barchartData\"\n              :colors=\"barchartData.colors\"\n              :width=\"`36.14vw`\"\n              :height=\"tabStatus === 'on' ? `35.5vh` : `40vh`\"\n              :category=\"barchartData.categories\"\n              ybgcolor=\"#01B7D730\"\n              :name=\"barChartSeriesName\"\n              @clickItem=\"clickSafetyCheck\"\n              :dataZoomDefaultValueRange=\"barchartData.dataZoomDefaultValueRange\"\n              :dataZoomDisabled=\"false\"\n              :dataZoomMaxValueSpan=\"barchartData.categories.length\"\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"middle-section section-box\">\n      <div class=\"section-bg\">\n        <SubtitleBar :subtitle=\"`安全培训`\">\n          <a-select\n            v-model:value=\"formState.training\"\n            :options=\"dimensionTypeData\"\n            @change=\"handleTrainingChange\"\n            style=\"width: 1.2rem\"\n            v-show=\"dimensionTypeData.length > 1\"\n          />\n        </SubtitleBar>\n        <IndicatorGroup\n          :data=\"trainingData\"\n          :style=\"tabStatus === 'on' ? 'margin-top: -0.15rem' : 'margin-top: -0.2rem'\"\n          class=\"indicator-group-layout\"\n          :class=\"tabStatus === 'on' ? '' : 'fix-indicator-group-padding'\"\n          @click-item=\"clickTrainingStatisticsAll\"\n        />\n        <div style=\"width: 100%; height: 2rem\">\n          <div style=\"margin-left: 0.16rem; transform: scale(0.85); transform-origin: 0 0\">\n            <EchartLineBarChart\n              :data=\"trainingChartData\"\n              :colors=\"trainingChartData.colors\"\n              :width=\"`36.14vw`\"\n              :height=\"tabStatus === 'on' ? `35.5vh` : `40vh`\"\n              :category=\"trainingChartData.categories\"\n              ybgcolor=\"#01B7D730\"\n              :name=\"trainingChartSeriesName\"\n              @clickItem=\"clickTrainingStatistics\"\n              :dataZoomDefaultValueRange=\"trainingChartData.dataZoomDefaultValueRange\"\n              :dataZoomDisabled=\"false\"\n              :dataZoomMaxValueSpan=\"trainingChartData.categories.length\"\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"right-section section-box\">\n      <div class=\"section-bg\">\n        <SubtitleBar :subtitle=\"`安全隐患`\">\n          <a-select\n            v-model:value=\"formState.hiddenDanger\"\n            :options=\"dimensionTypeData\"\n            @change=\"handleHiddenDangerChange\"\n            style=\"width: 1.2rem\"\n            v-show=\"dimensionTypeData.length > 1\"\n          />\n        </SubtitleBar>\n        <IndicatorGroup\n          class=\"indicator-group-layout\"\n          :data=\"hiddenData\"\n          :style=\"tabStatus === 'on' ? 'margin-top: -0.15rem' : 'margin-top: -0.2rem'\"\n          :class=\"tabStatus === 'on' ? '' : 'fix-indicator-group-padding'\"\n          @click-item=\"clickHiddenAll\"\n        />\n        <div style=\"width: 100%; height: 2rem\">\n          <div style=\"margin-left: 0.16rem; transform: scale(0.85); transform-origin: 0 0\">\n            <EchartPillarChart\n              :data=\"pchartData\"\n              :colors=\"pchartData.colors\"\n              :width=\"`36.14vw`\"\n              :height=\"tabStatus === 'on' ? `35.5vh` : `40vh`\"\n              :name=\"pchartTopSeriesName\"\n              @clickItem=\"clickHidden\"\n              :dataZoomDefaultValueRange=\"pchartData.dataZoomDefaultValueRange\"\n              :dataZoomDisabled=\"false\"\n              :dataZoomMaxValueSpan=\"pchartData.categories.length\"\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\n  import { ref, onMounted, defineProps, watch, reactive, UnwrapRef } from 'vue';\n  import SubtitleBar from '/@/components/Framework/Chart/SubtitleBar.vue';\n  import IndicatorGroup from '/@/components/Framework/Chart/IndicatorGroup.vue';\n  import EchartLineBarChart from '/@/components/Framework/Chart/EchartLineBarChart.vue';\n  import EchartPillarChart from '/@/components/Framework/Chart/EchartPillarChart.vue';\n  import { handleRouteChange } from '../../utils';\n  import * as SecurityApi from '@/api/da/cockpit/security';\n  import { assign } from 'lodash-es';\n  import * as CommonApi from '@/api/da/common';\n  import { buildUUID } from '@/utils/uuid';\n\n  //搜索参数\n  const searchInfo: UnwrapRef<any> = reactive({});\n  const props = defineProps({\n    searchInfoByTime: { type: Object, default: {} },\n    tabStatus: { type: String, default: '' },\n  });\n  const instanceKey = ref(buildUUID());\n  const formState = reactive({\n    safetyCheck: 'station',\n    training: 'station',\n    hiddenDanger: 'station',\n  });\n  const dimensionTypeData: any = ref([\n    // { label: '电站维度', value: 'station' },\n    // { label: '公司维度', value: 'company' },\n    // { label: '运维维度', value: 'operation' },\n  ]);\n\n  onMounted(async () => {\n    const sts = await CommonApi.getDictDataMap({ dictType: 'cockpit_three_dimension' });\n    sts.result.forEach((e) => {\n      dimensionTypeData.value.push({ value: e.value, label: e.label });\n    });\n  });\n  // ==================================安全检查 begin ======================================\n  const securityData = ref([\n    {\n      value: 93,\n      label: '检查次数(次)',\n    },\n    {\n      value: 33,\n      label: '发现隐患(项)',\n    },\n  ]);\n  const barchartData = ref({\n    barData: [[], []],\n    categories: [],\n    colors: [\n      ['#488FF6', '#60D1F3'],\n      ['#E59837', '#FAE895'],\n      ['#E59837', '#68E4B8'],\n      ['#e59837', '#fae895'],\n      ['#078C5D', '#68E4B8'],\n    ],\n    dataZoomDefaultValueRange: [0, 5],\n  });\n  const barChartSeriesName = [['检查次数', '发现隐患']];\n  const doSafetyCheck = async (value) => {\n    const safetyCheckStat = await SecurityApi.safetyCheckStat({\n      dimension: value,\n      startMonth: searchInfo.startMonth,\n      endMonth: searchInfo.endMonth,\n    });\n    if (safetyCheckStat) {\n      securityData.value[0].value = safetyCheckStat.checkCount;\n      securityData.value[1].value = safetyCheckStat.hiddenCount;\n\n      barchartData.value.barData = safetyCheckStat.barData || [];\n      barchartData.value.categories = safetyCheckStat.categories || [];\n    }\n  };\n  const handleSafetyCheckChange = (value) => {\n    doSafetyCheck(value);\n  };\n  // ==================================安全检查 end ======================================\n\n  // ==================================安全培训 begin ======================================\n  const trainingData = ref([\n    {\n      value: 93,\n      label: '培训次数(次)',\n    },\n    {\n      value: 32,\n      label: '参与人数(人)',\n    },\n  ]);\n  const trainingChartData = ref({\n    barData: [[], []],\n    categories: [],\n    colors: [\n      ['#488FF6', '#60D1F3'],\n      ['#078C5D', '#68E4B8'],\n      ['#E59837', '#FAE895'],\n      ['#e59837', '#fae895'],\n      ['#078C5D', '#68E4B8'],\n    ],\n    dataZoomDefaultValueRange: [0, 5],\n  });\n  const trainingChartSeriesName = [['培训次数', '参与人数']];\n  const doTrainingStat = async (value) => {\n    const trainingStat = await SecurityApi.trainingStat({\n      dimension: value,\n      startMonth: searchInfo.startMonth,\n      endMonth: searchInfo.endMonth,\n    });\n    if (trainingStat) {\n      trainingData.value[0].value = trainingStat.trainingCount;\n      trainingData.value[1].value = trainingStat.personCount;\n\n      trainingChartData.value.barData = trainingStat.barData || [];\n      trainingChartData.value.categories = trainingStat.categories || [];\n    }\n  };\n  const handleTrainingChange = (value) => {\n    doTrainingStat(value);\n  };\n  // ==================================安全培训 end ========================================\n\n  // ==================================安全隐患 begin ======================================\n  const hiddenData = ref([\n    {\n      value: 72,\n      label: '待处理(个)',\n    },\n    {\n      value: 15.32,\n      label: '处理率(%)',\n    },\n  ]);\n\n  const pchartData = ref({\n    barData: [[]],\n    lineData: [[]],\n    categories: [],\n    units: ['个'],\n    colors: [\n      ['#488FF6', '#60D1F3'],\n      ['#e59837', '#fae895'],\n      ['#078C5D', '#68E4B8'],\n    ],\n    dataZoomDefaultValueRange: [0, 5],\n  });\n  const pchartTopSeriesName = ['待处理', '处理率'];\n  const doHiddenStat = async (value) => {\n    const hiddenStat = await SecurityApi.hiddenStat({\n      dimension: value,\n      startMonth: searchInfo.startMonth,\n      endMonth: searchInfo.endMonth,\n    });\n    if (hiddenStat) {\n      hiddenData.value[0].value = hiddenStat.waitCount;\n      hiddenData.value[1].value = hiddenStat.dealRate;\n\n      pchartData.value.barData = hiddenStat.barData || [];\n      pchartData.value.categories = hiddenStat.categories || [];\n      if (hiddenStat.lineData?.length) {\n        pchartData.value.lineData[0] = hiddenStat.lineData;\n      } else {\n        pchartData.value.lineData = [];\n      }\n    }\n  };\n  const handleHiddenDangerChange = (value) => {\n    doHiddenStat(value);\n  };\n  // ==================================安全隐患 end ========================================\n\n  // ==================================跳转 start ======================================\n  //安全检查\n  const clickSafetyCheck = (params) => {\n    handleRouteChange('/bi/safety/check', {\n      orgId: formState.safetyCheck === 'company' ? params.data.id : '',\n      stationId: formState.safetyCheck === 'station' ? params.data.id : '',\n      dateCycle: 'month',\n    });\n  };\n  //安全检查无电站/公司\n  const clickSafetyCheckAll = () => {\n    handleRouteChange('/bi/safety/check', {\n      dateCycle: 'month',\n    });\n  };\n  //安全培训\n  const clickTrainingStatistics = (params) => {\n    handleRouteChange('/bi/integrated/trainingStatistics', {\n      // ognId: formState.training === 'company' ? params.data.id : '',\n      // stationId: formState.training === 'station' ? params.data.id : '',\n      // dateCycle: 'month',\n      selectType: formState.training,\n      id: params.data.id,\n      name: params.data.fullName,\n    });\n  };\n  //安全培训无电站/公司\n  const clickTrainingStatisticsAll = () => {\n    handleRouteChange('/bi/integrated/trainingStatistics', {\n      dateCycle: 'month',\n    });\n  };\n  //安全隐患\n  const clickHidden = (params) => {\n    handleRouteChange('/bi/hidden/index', {\n      stationOrganId: formState.hiddenDanger === 'company' ? params.data.id : '',\n      stationId: formState.hiddenDanger === 'station' ? params.data.id : '',\n      dateType: 'month',\n    });\n  };\n  //安全隐患无电站/公司\n  const clickHiddenAll = () => {\n    handleRouteChange('/bi/hidden/index', {\n      dateType: 'month',\n    });\n  };\n\n  watch(\n    () => props.searchInfoByTime,\n    (value) => {\n      assign(searchInfo, value);\n      doSafetyCheck(formState.safetyCheck);\n      doTrainingStat(formState.training);\n      doHiddenStat(formState.hiddenDanger);\n    },\n  );\n\n  // 更新组件函数\n  const handleUpdate = () => {\n    instanceKey.value = buildUUID();\n  };\n\n  defineExpose({\n    handleUpdate,\n  });\n</script>\n\n<style lang=\"less\" scoped>\n  .middle-content {\n    display: flex;\n    flex: 44.34%;\n    justify-content: space-between;\n    height: 44.34%;\n    padding-top: 0.93vh;\n\n    .section-box {\n      flex: 33.3333%;\n      width: 33.3333%;\n      height: 100%;\n    }\n\n    .section-bg {\n      width: 100%;\n      height: 100%;\n      background: url('../../../../assets/images/da/section_bg_4.png') no-repeat center/100% 100%;\n    }\n\n    .left-section {\n      padding-right: 0.56vw;\n    }\n\n    .middle-section {\n      padding: 0 0.28vw;\n    }\n\n    .right-section {\n      padding-left: 0.56vw;\n    }\n\n    :deep(.ant-select:not(.ant-select-customize-input) .ant-select-selector) {\n      height: 0.26rem !important;\n      border: 0.01rem solid #07a6ff70;\n      border-radius: 0;\n      background-color: transparent;\n    }\n\n    :deep(.ant-select-single .ant-select-selector .ant-select-selection-placeholder) {\n      height: 0.26rem;\n      line-height: 0.26rem;\n    }\n\n    :deep(.ant-select-arrow) {\n      color: rgb(255 255 255 / 50%);\n    }\n\n    .indicator-group-layout {\n      padding: 0.08rem 1.88rem 0;\n\n      &.fix-indicator-group-padding {\n        padding-top: 1.8vh;\n      }\n    }\n  }\n</style>\n"],"names":["searchInfo","reactive","instanceKey","ref","buildUUID","formState","dimensionTypeData","onMounted","__async","CommonApi.getDictDataMap","e","securityData","barchartData","barChartSeriesName","doSafetyCheck","value","safetyCheckStat","SecurityApi.safetyCheckStat","handleSafetyCheckChange","trainingData","trainingChartData","trainingChartSeriesName","doTrainingStat","trainingStat","SecurityApi.trainingStat","handleTrainingChange","hiddenData","pchartData","pchartTopSeriesName","doHiddenStat","hiddenStat","SecurityApi.hiddenStat","handleHiddenDangerChange","clickSafetyCheck","params","handleRouteChange","clickSafetyCheckAll","clickTrainingStatistics","clickTrainingStatisticsAll","clickHidden","clickHiddenAll","watch","props","assign","__expose"],"mappings":"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"}