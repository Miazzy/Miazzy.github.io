var c=(y,s,a)=>new Promise((u,o)=>{var g=r=>{try{i(a.next(r))}catch(d){o(d)}},_=r=>{try{i(a.throw(r))}catch(d){o(d)}},i=r=>r.done?u(r.value):Promise.resolve(r.value).then(g,_);i((a=a.apply(y,s)).next())});import{C as L}from"./CommonTree-c4ed7838.js";import{P as V}from"./index-20519caf.js";import{B as A}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as j}from"./useTable-109483b3.js";import{a2 as I}from"./antd-15ac76ed.js";import{b as H,au as K,a7 as W,av as S,ax as X,az as Z,aA as $,_ as q}from"./index.js";import{e as G}from"./download-03e71dd5.js";import{g as J,a as Q,e as U,c as Y,s as ee,b as te}from"./data-6f7533e0.js";import{a as T}from"./assign-37f1c13d.js";import{d as ae,r as x,k as C,o as oe,al as ne,Z as ie,a9 as re,aa as m,f as p,$ as se,u as n,E as b,ad as w}from"./vue-71d1abb3.js";import"./index-3801a970.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useRender-21ce56fb.js";const le={class:"right-table-layout"},ce=ae({__name:"index",setup(y){const{t:s}=H(),a=x({}),u=C([]),o=x({}),{createConfirm:g,createMessage:_}=K();let i=C("");oe(()=>{r(),W.getInstance().listen("training-record",f)});function r(){return c(this,null,function*(){u.value=yield J({}),f()})}function d(e){a.stationOrganId=null,a.stationId=null,e&&(a.stationOrganId=e.organId,a.stationId=e.powerStationId,o.stationOrganId=e.organId,o.stationOrganName=e.organName,o.stationId=e.powerStationId,o.stationName=e.powerStationName,o.nodeKindId=e.nodeKindId),f()}const O=()=>c(this,null,function*(){const e=F(),t=x({});return T(t,a),t.pageNo=e.current,t.pageSize=e.pageSize,t.order||(t.field="fillinDate",t.order="desc"),yield te(t)}),[v,{reload:f,getSelectRows:N,getPaginationRef:F}]=j({title:"培训记录列表",api:O,columns:Y,formConfig:ee,useSearchForm:!0,showTableSetting:!0,bordered:!0,pagination:{pageSize:20},showIndexColumn:!0,tableSetting:{fullScreen:!0},handleSearchInfoFn(e){return T(a,e),e},sortFn:e=>{e.order?(a.sortField=e.field,a.sortOrder=e.order.replace("end","")):(a.sortField="",a.sortOrder="")},rowSelection:{type:"radio",fixed:!0,onSelect:D},fetchSetting:{listField:"list",pageField:"pageNo",sizeField:"pageSize",totalField:"total"}});function k({keys:e,rows:t}){if(t&&t.length>0){const l=t[0];i.value=l.id}else i.value=""}function D(e,t){t?i.value=e.id:i.value=""}function R(){if(!o.stationId){I.error("请先选择电站。");return}X("/po/integrated/training/create","添加培训记录",{stationOrganId:o.stationOrganId,stationOrganName:o.stationOrganName,stationId:o.stationId,stationName:o.stationName,id:""})}function E(e){Z(e.id)}function P(){const e=N();return e.length==0?(I.error("请选择一行数据"),!1):e[0]}function z(){return c(this,null,function*(){const e=P();if(!e.id)return;const t=yield Q({id:e.id});g({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return c(this,null,function*(){if(t.result.status!=0){I.error("非草稿状态不能删除。");return}yield $(t.result.processInstanceId),I.success("已删除。"),f()})}})})}function B(){g({title:s("common.exportTitle"),iconType:"warning",content:s("common.message.exportMessage"),onOk(){return c(this,null,function*(){yield U(a).then(t=>{G(t==null?void 0:t.data,"培训信息.xls")}),_.success(s("common.exportSuccessText"))})}})}return(e,t)=>{const l=ne("a-button");return ie(),re(n(V),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:m(()=>[p(L,{title:"电站组织",onSelect:d,value:u.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),se("div",le,[p(n(A),{onRegister:n(v),class:"fix-basic-table",searchInfo:a,onResizeColumn:t[0]||(t[0]=(h,M)=>M.width=h),onRowDbClick:t[1]||(t[1]=h=>E(h)),onSelectionChange:k},{toolbar:m(()=>[p(l,{type:"primary",preIcon:n(S).ADD,onClick:R},{default:m(()=>[b(w(n(s)("common.action.create")),1)]),_:1},8,["preIcon"]),p(l,{class:"red-btn",disabled:n(i)=="",preIcon:n(S).DELETE,onClick:z},{default:m(()=>[b(w(n(s)("common.delText")),1)]),_:1},8,["disabled","preIcon"]),p(l,{class:"yellow-btn",preIcon:n(S).EXPORT,onClick:B},{default:m(()=>[b(w(n(s)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister","searchInfo"])])]),_:1})}}});const Ae=q(ce,[["__scopeId","data-v-684f59d9"]]);export{Ae as default};
//# sourceMappingURL=index-e9715492.js.map
