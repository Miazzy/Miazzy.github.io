var s=(k,O,y)=>new Promise((N,C)=>{var b=v=>{try{h(y.next(v))}catch(S){C(S)}},K=v=>{try{h(y.throw(v))}catch(S){C(S)}},h=v=>v.done?N(v.value):Promise.resolve(v.value).then(b,K);h((y=y.apply(k,O)).next())});import{C as Ye}from"./CommonTree-c4ed7838.js";import{B as Ke}from"./BasicTable-0434a334.js";import{T as $e}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as ze}from"./useTable-109483b3.js";import{a2 as W}from"./antd-15ac76ed.js";import{au as Me,ad as B,av as U,aw as Ve,ax as A,_ as Pe}from"./index.js";import{d as qe,k as o,ax as je,o as Ge,q as He,al as T,x as Je,Z as m,_ as f,f as i,aa as p,$ as n,F as q,ae as Xe,ad as Y,E as g,u as w,v as Ze,a9 as Qe,ac as x,J as j,aG as et,aH as tt}from"./vue-71d1abb3.js";import{e as at}from"./download-03e71dd5.js";import{_ as ie}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import lt from"./deviceDialog-59d49a92.js";import{D as ot}from"./Dialog-0a006d82.js";import{o as nt,q as st,r as it,s as rt,u as ct,e as dt,f as ut,v as pt,w as vt,x as mt,y as ft,z as ht}from"./monitorApi-44e70004.js";import"./index-3801a970.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./deviceWarning-620b5d81.js";import"./dataDetail-62a9c747.js";import"./EchartLineChart.vue_vue_type_style_index_0_lang-c85cdf3b.js";import"./install-58e0bd81.js";import"./helper-474c7a04.js";import"./api-32c7505d.js";import"./index-74ac3212.js";import"./Export2Excel-389a8fc9.js";import"./dataComparison-458260e7.js";const I=k=>(et("data-v-fda03c57"),k=k(),tt(),k),_t={class:"fault-warning"},yt={class:"right-box"},bt={class:"card-group-box"},gt={class:"label-text"},wt={class:"number-text"},xt={class:"search-box"},kt={class:"left-box"},Dt={class:"select-box"},Tt=I(()=>n("div",{class:"select-label-box"},"级别",-1)),It={class:"select-box"},Ct=I(()=>n("div",{class:"select-label-box"},"类型",-1)),St={class:"select-box"},Rt=I(()=>n("div",{class:"select-label-box"},"发生时间",-1)),At={class:"select-box"},Ot=I(()=>n("div",{class:"select-label-box",style:{width:"100px !important"}},"设备编码",-1)),Nt={class:"right-box"},Et={class:"right-row-box"},Lt={class:"data-table-box"},Ft=I(()=>n("div",{class:"table-title-line"},null,-1)),Wt={class:"table-title-left-box"},Bt=I(()=>n("div",{class:"table-title-text"},"告警列表",-1)),Ut={class:"refresh-box"},Yt={class:"operation-btn-box"},Kt={key:0,style:{color:"#dc0000"}},$t={key:1,style:{color:"#30ca5a"}},zt=["onClick"],Mt={key:0},Vt={key:1},G="FAULT_WARNING",Pt=qe({__name:"faultWarning",setup(k){const{createConfirm:O}=Me(),y=o(!1);je();const N=o(""),C=o([]),b=o([]),K=o([]),h=o([]),v=o(""),S=o([]),H=o([{label:"逆变器(台)",value:"inverter",ratio:-1.6},{label:"汇流箱(台)",value:"combinerDc",ratio:1.6},{label:"组串(条)",value:"pvString",ratio:.5},{label:"箱变(台)",value:"transformer",ratio:0},{label:"升压站(台)",value:"boostDev",ratio:0},{label:"储能(台)",value:"energyStorage",ratio:0},{label:"其他(台)",value:"other",ratio:0}]),$=o();function re(){return s(this,null,function*(){let e=yield nt();C.value=e})}function ce(){return s(this,arguments,function*(e={}){N.value=null,e.id!=null&&e.nodeKindId=="station"&&(N.value=e.powerStationId)})}function z(){return s(this,null,function*(){try{let e=yield st({stationIds:E.value});e&&Object.keys(e).length&&H.value.forEach(t=>{t.number=e[t.value]})}catch(e){console.log(e)}})}const E=o([]),J=e=>s(this,null,function*(){let t=[];e.forEach(a=>{a.nodeKindId=="station"&&t.push(a.id)}),E.value=t,X(),z()});function de(){return s(this,null,function*(){var a;const e=yield Ve({dictTypeList:"alarm_type"});let t=[{label:"电量告警",value:"electricity"},{label:"通讯告警",value:"interrupt"}];((a=e.result.alarm_type)==null?void 0:a.length)>0&&e.result.alarm_type.forEach(c=>{t.push({label:c.label,value:c.value})}),S.value=t})}const ue=e=>{console.log(`selected ${e}`)};function pe(){return s(this,null,function*(){let e=yield it(),t=[];(e==null?void 0:e.length)>0&&e.forEach(a=>{t.push({label:a.desc,value:a.value})}),K.value=t})}const ve=e=>{console.log(`selected ${e}`)},me=e=>s(this,null,function*(){}),_=o(),fe=e=>{console.log("选择发生时间范围",e)},he=e=>s(this,null,function*(){let t=[];if(e!=null)t.push(e.id);else if(u.value.length>0)t=u.value;else{W.warning("请先选择记录。");return}rt({ids:t}).then(()=>{le()})}),_e=[{title:"电站名称",dataIndex:"stationName",width:150},{title:"设备名称",dataIndex:"deviceName",width:100},{title:"设备编码",dataIndex:"esn",width:150},{title:"告警名称",dataIndex:"alarmName",width:100},{title:"级别",dataIndex:"levelText",width:100},{title:"分类",dataIndex:"typeText",width:100},{title:"发生时间",dataIndex:"firstAlarmTime",sorter:!0,width:150},{title:"告警时长",dataIndex:"showAlarmDuration",sorter:!0,width:120},{title:"恢复时间",dataIndex:"recoveryTime",sorter:!0,width:150},{title:"确认状态",dataIndex:"isConfirm",width:100},{title:"确认人",dataIndex:"confirmPersonName",width:100},{title:"确认时间",dataIndex:"confirmTime",sorter:!0,width:150}],ye=o([]);function be(){return s(this,null,function*(){O({title:"提示",iconType:"warning",content:"确定要导出所有记录？",onOk(){return s(this,null,function*(){let t=E.value.toString(),a=b.value.join(","),c=h.value.join(","),d={stationIdsStr:t,levelsStr:a,typesStr:c};_.value!=null&&(d.startTime=_.value[0],d.endTime=_.value[1]),yield ct(d).then(r=>{at(r==null?void 0:r.data,"设备告警.xls")})})}})})}const X=()=>s(this,null,function*(){le()}),ge=()=>s(this,null,function*(){h.value=[],b.value=[],_.value=null}),M=o(!1),Z=o(""),Q=o({}),we=e=>s(this,null,function*(){M.value=!0,Z.value=e.esn,Q.value=e,xe(e),ke(e)}),ee=o([]),xe=e=>s(this,null,function*(){let t=yield dt({stationId:e.stationId,areaId:e.areaId,esn:e.esn,dataType:3});ee.value=t}),te=o([]),ae=o(""),ke=e=>s(this,null,function*(){let t=yield ut({stationId:e.stationId,areaId:e.areaId,esn:e.esn,dataType:1});te.value=t.dataList,ae.value=t.showTimeStr}),R=o({}),De=()=>s(this,null,function*(){const e=Ce();let t={stationIds:E.value,alarmLevels:b.value,alarmTypes:h.value,pageNo:e.current,pageSize:e.pageSize,deviceEsn:v.value,sortField:R.value.sortField,sortOrder:R.value.sortOrder};_.value!=null&&(t.startTime=_.value[0],t.endTime=_.value[1]);let a=yield ht(t);return ye.value=a.list,u.value=[],a}),u=o([]),[Te,{reload:le,reloadData:Ie,getPaginationRef:Ce,getDataSource:Se,getSelectRows:Re}]=ze({api:De,columns:_e,bordered:!0,actionColumn:{width:200,title:"操作",dataIndex:"action",slots:{customRender:"action"}},rowKey:"id",rowSelection:{type:"checkbox",fixed:!0,selectedRowKeys:u,onSelect:Ae,onSelectAll:Oe},pagination:{pageSize:200,pageSizeOptions:["20","50","100","200"]},showTableSetting:!0,tableSetting:{fullScreen:!1,redo:!1,size:!1},sortFn:e=>{e.order&&(e.field==="showAlarmDuration"?R.value.sortField="alarmDuration":R.value.sortField=e.field,R.value.sortOrder=e.order.replace("end",""))}});function Ae(e,t){t?u.value=[...u.value,e.id]:u.value=u.value.filter(a=>a!==e.id)}function Oe(e,t,a){const c=a.map(d=>d.id);e?u.value=[...u.value,...c]:u.value=u.value.filter(d=>!c.includes(d))}const Ne=()=>s(this,null,function*(){if(u.value.length!=1){W.error("请选择一条数据。");return}O({title:"提示",iconType:"warning",content:"确定要生成工单？",onOk(){return s(this,null,function*(){let t=u.value[0],a=Se(),c={};a.forEach(r=>{if(r.id==t){c=r;return}});let d=yield pt(c);if(d.fault==null){W.error("请先设置物资和设备的关联关系。");return}else{let r=d.fault.findDate;d.fault.findDate=r.substring(0,16);let L=yield vt(d),P={workOrderId:L,id:c.id};yield mt(P),A("/po/workorder/create?id="+L,"工单详情")}})}})}),Ee=e=>{var t={billCode:e.billCode};A("/po/drone/droneinspection/create","查看无人机巡检",j(t))},Le=()=>{if(u.value.length!=1){W.error("请选择一条数据。");return}const t=Re()[0];ft({esnTemp:t.esn}).then(a=>{let c=a;if(c!=null&&c!=""){var d={billCode:t.billCode};A("/po/drone/droneinspection/create","查看无人机巡检",j(d))}else{var r={powerStationId:t.stationId,powerStationName:t.stationName,equipmentName:t.deviceName,alarmTime:t.firstAlarmTime,alarmContent:t.alarmName,esn:t.esnTemp,status:0};A("/po/drone/droneinspection/create","添加无人机巡检",j(r))}})},oe=o(""),ne=e=>{oe.value=e.operationRemark,y.value=!0},Fe=e=>s(this,null,function*(){A("/po/workorder/create?id="+e.workOrderId,"工单详情")}),We=e=>{let t=[];if(e.workOrderId!=null?t=[{label:"运维建议",icon:"clarity:note-edit-line",onClick:ne.bind(null,e)},{label:"工单详情",icon:"ant-design:calendar-outlined",onClick:Fe.bind(null,e)}]:t=[{label:"运维建议",icon:"clarity:note-edit-line",onClick:ne.bind(null,e)}],e.billCode!=null){let a={label:"无人机巡检",icon:"clarity:note-edit-line",onClick:Ee.bind(null,e)};t.push(a)}return t},V=o(!0),se=()=>s(this,null,function*(){console.info("refreshData:",Math.random());try{Ie(void 0,!1),z()}catch(e){}}),Be=e=>{var t;try{(t=e==null?void 0:e.target)!=null&&t.checked?B.getInstance().pushListTask(G,se,2e4):B.getInstance().removeListTask(G)}catch(a){}};return Ge(()=>s(this,null,function*(){z(),yield re(),pe(),de(),yield He(),$.value.checkAll(),J($.value.getCheckedKeys()),B.getInstance().start(),V.value&&B.getInstance().pushListTask(G,se,2e4)})),(e,t)=>{const a=T("a-col"),c=T("a-range-picker"),d=T("a-input"),r=T("a-button"),L=T("a-checkbox"),P=T("a-row"),Ue=Je("permission");return m(),f("div",_t,[i(P,{class:"fault-warning-row",type:"flex",wrap:!1},{default:p(()=>[i(a,{flex:"298px"},{default:p(()=>[i(Ye,{canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,class:"fit-common-tree",title:"电站组织",value:C.value,fieldNames:{key:"id",title:"name"},onSelect:ce,checkable:"",onCheck:J,ref_key:"stationTreeRef",ref:$},null,8,["value"])]),_:1}),i(a,{flex:"auto"},{default:p(()=>[n("div",yt,[n("div",bt,[(m(!0),f(q,null,Xe(H.value,(l,D)=>(m(),f("div",{class:"card-item",key:D,onClick:t[0]||(t[0]=F=>me(e.tiem))},[n("div",gt,Y(l.label),1),n("div",wt,Y(l.number),1)]))),128))]),n("div",xt,[n("div",kt,[n("div",Dt,[Tt,i(ie,{value:b.value,"onUpdate:value":t[1]||(t[1]=l=>b.value=l),multiple:"multiple",type:"alarm_level",width:200,placeholder:"选择级别",onChange:ve},null,8,["value"])]),n("div",It,[Ct,i(ie,{value:h.value,"onUpdate:value":t[2]||(t[2]=l=>h.value=l),multiple:"multiple","max-tag-count":1,type:"alarm_type",width:200,placeholder:"选择类型",onChange:ue},null,8,["value"])]),n("div",St,[Rt,i(c,{width:120,value:_.value,"onUpdate:value":t[3]||(t[3]=l=>_.value=l),valueFormat:"YYYY-MM-DD",onChange:fe},null,8,["value"])]),n("div",At,[Ot,i(d,{value:v.value,"onUpdate:value":t[4]||(t[4]=l=>v.value=l)},null,8,["value"])])]),n("div",Nt,[i(r,{onClick:ge},{default:p(()=>[g(" 重置 ")]),_:1}),i(r,{type:"primary",onClick:X},{default:p(()=>[g(" 查询 ")]),_:1})])]),n("div",Et,[n("div",Lt,[Ft,i(w(Ke),{onRegister:w(Te),clickToRowSelect:!0},{tableTitle:p(()=>[n("div",Wt,[Bt,n("div",Ut,[i(L,{checked:V.value,"onUpdate:checked":t[5]||(t[5]=l=>V.value=l),onChange:Be},{default:p(()=>[g("自动刷新")]),_:1},8,["checked"])])])]),toolbar:p(()=>[n("div",Yt,[Ze((m(),Qe(r,{type:"primary",preIcon:w(U).ADD,class:"operation-btn",onClick:t[6]||(t[6]=l=>he())},{default:p(()=>[g(" 批量确认 ")]),_:1},8,["preIcon"])),[[Ue,"monitor:faultWarning:confirm"]]),i(r,{type:"primary",class:"operation-btn",preIcon:w(U).ADD,onClick:Ne},{default:p(()=>[g(" 转工单 ")]),_:1},8,["preIcon"]),i(r,{type:"primary",class:"operation-btn",preIcon:w(U).ADD,onClick:Le},{default:p(()=>[g(" 无人机巡检 ")]),_:1},8,["preIcon"]),i(r,{class:"operation-btn yellow-btn",preIcon:w(U).EXPORT,onClick:be},{default:p(()=>[g(" 导出 ")]),_:1},8,["preIcon"])])]),bodyCell:p(({column:l,text:D,record:F})=>[l.key==="isConfirm"?(m(),f(q,{key:0},[D==0||D==null?(m(),f("a",Kt,"未确认")):x("",!0),D==1?(m(),f("a",$t,"已确认")):x("",!0)],64)):x("",!0),l.key==="deviceName"?(m(),f("a",{key:1,onClick:qt=>we(F)},Y(D),9,zt)):x("",!0),l.key==="typeText"?(m(),f(q,{key:2},[F.type=="interrupt"?(m(),f("span",Mt,"通讯告警")):x("",!0),F.type=="electricity"?(m(),f("span",Vt,"电量告警")):x("",!0)],64)):x("",!0)]),action:p(({record:l})=>[i(w($e),{actions:We(l)},null,8,["actions"])]),_:1},8,["onRegister"])])])])]),_:1})]),_:1}),i(lt,{title:Z.value,visible:M.value,ycData:ee.value,yxData:te.value,yxTime:ae.value,data:Q.value,"onUpdate:visible":t[7]||(t[7]=l=>M.value=l)},null,8,["title","visible","ycData","yxData","yxTime","data"]),i(ot,{visible:y.value,"onUpdate:visible":t[8]||(t[8]=l=>y.value=l),title:"运维建议",height:"400px",width:"600px",showBtm:!1},{default:p(()=>[n("span",null,Y(oe.value)+"11",1)]),_:1},8,["visible"])])}}});const Ra=Pe(Pt,[["__scopeId","data-v-fda03c57"]]);export{Ra as default};
//# sourceMappingURL=faultWarning-fa67a7ab.js.map
