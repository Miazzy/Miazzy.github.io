var l=(O,w,o)=>new Promise((t,f)=>{var g=n=>{try{b(o.next(n))}catch(h){f(h)}},I=n=>{try{b(o.throw(n))}catch(h){f(h)}},b=n=>n.done?t(n.value):Promise.resolve(n.value).then(g,I);b((o=o.apply(O,w)).next())});import{B}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as V}from"./useTable-109483b3.js";import{a2 as d}from"./antd-15ac76ed.js";import{au as A,b as z,a7 as j,av as T,ax as W,_ as q}from"./index.js";import{P as G}from"./index-20519caf.js";import{C as J}from"./CommonTree-c4ed7838.js";import{b as X,c as Z,d as $,e as Q,f as U,p as ee,h as D}from"./index-f6696a2c.js";import{d as te,r as ae,k as r,ax as oe,o as ne,al as se,Z as c,_ as m,f as u,aa as p,$ as re,u as s,E as k,ad as ie,F as le,ac as v,J as de}from"./vue-71d1abb3.js";import{e as ce}from"./download-03e71dd5.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";const me={class:"right-table-layout"},ue={key:0,style:{color:"red"}},pe={key:1,style:{color:"#e9dd05"}},fe={key:2,style:{color:"#0fff40"}},ge={key:3,style:{color:"red"}},Ie=te({__name:"index",setup(O){const{createConfirm:w}=A(),{t:o}=z(),t=ae({}),f=r([]);r({});const g=r({}),I=r([]);r([]);const b=X();oe();const n=r([]),h=()=>l(this,null,function*(){let e=yield Z(t);return n.value=e.result,e.result});let x=r("");const Y={showAdvancedButton:!0,baseColProps:{span:8},labelWidth:120,autoAdvancedLine:1,schemas:[{field:"billCode",component:"Input",label:"单据编号"},{label:"巡检开始时间",field:"startTime",component:"DatePicker",componentProps:{showTime:!0,format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss",style:"width: 100%"}},{label:"巡检结束时间",field:"endTime",component:"DatePicker",componentProps:{showTime:!0,format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss",style:"width: 100%"}},{label:"状态",field:"statusList",component:"CheckboxGroup",componentProps:{options:[{label:"未执行",value:0},{label:"执行中",value:1},{label:"已执行",value:2},{label:"执行失败",value:3}]}}]},[N,{reload:_,getPaginationRef:M,getSelectRows:S}]=V({title:"无人机巡检列表",api:()=>l(this,null,function*(){const e=M();return t.pageNo=e.current,t.pageSize=e.pageSize,yield h()}),columns:b,useSearchForm:!0,formConfig:Y,showTableSetting:!0,bordered:!0,rowKey:"id",rowSelection:{type:"radio",onChange:P},handleSearchInfoFn(e){return t.billCode=e.billCode,t.endTime=e.endTime,t.startTime=e.startTime,t.statusList=e.statusList,e},sortFn:e=>{e.order?(t.sortField=e.field,t.sortOrder=e.order.replace("end","")):(t.sortField=null,t.sortOrder=null)}});function P(e,a){a.length>0?(I.value=[e[0]],x.value=e[0]):(I.value=[],x.value="")}function F(){w({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return l(this,null,function*(){if(S()[0].status!=0){d.warning("请选择未执行数据！");return}$(I.value).then(()=>{d.success("已删除。"),_()})})}})}function L(){w({title:o("common.message.confirmTitle"),iconType:"warning",content:o("common.message.exportMessage"),onOk(){return l(this,null,function*(){t.filename="无人机巡检.xls",yield Q(t).then(a=>{ce(a==null?void 0:a.data,t.filename)}),t.filename=null,d.success(o("common.exportSuccessText"))})}})}function E(){return l(this,null,function*(){const e=yield U({});f.value=e.result,_()})}function R(){const e=S();if(e.length!=1){d.warning("请选择一条需要操作的数据。");return}var a=e[0];if(a.status!=0){d.error("只有“未执行”状态可以操作“执行”。");return}ee({id:a.id}).then(C=>{d.success("下发成功，请稍后查看结果。"),_()})}function H(e){var a={id:e.id};W("/po/drone/droneinspection/create","查看无人机巡检",de(a))}function K(e={}){t.stationId=null,t.stationName=null,t.stationOrganId=null,t.stationOrganName=null,t.nodeKindId=null,g.value.nodeKindId=null,t.searchId=null,e!=null&&(t.stationOrganId=e.organId,t.stationOrganName=e.organName,e.nodeKindId=="station"&&(t.stationId=e.powerStationId,t.stationName=e.name,g.value.stationId=e.powerStationId,D.stationId=t.stationId,D.stationName=t.stationName,D.stationOrganId=t.stationOrganId,D.stationOrganName=t.stationOrganName),t.nodeKindId=e.nodeKindId,g.value.nodeKindId=e.nodeKindId,t.searchId=e.id),_()}return ne(()=>{E(),j.getInstance().listen("droneinspection",function(){setTimeout(()=>{_()},500)})}),(e,a)=>{const C=se("a-button");return c(),m("div",null,[u(s(G),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:p(()=>[u(J,{title:"电站组织",onSelect:K,value:f.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),re("div",me,[u(s(B),{class:"fix-basic-table",onRegister:s(N),searchInfo:t,onResizeColumn:a[0]||(a[0]=(y,i)=>i.width=y),onRowDbClick:a[1]||(a[1]=y=>H(y))},{toolbar:p(()=>[u(C,{disabled:s(x)=="",type:"primary",preIcon:s(T).ADD,onClick:R},{default:p(()=>[k("执行")]),_:1},8,["disabled","preIcon"]),u(C,{class:"red-btn",disabled:s(x)=="",preIcon:s(T).DELETE,onClick:F},{default:p(()=>[k("删除")]),_:1},8,["disabled","preIcon"]),u(C,{class:"yellow-btn",preIcon:s(T).EXPORT,onClick:L},{default:p(()=>[k(ie(s(o)("common.action.export")),1)]),_:1},8,["preIcon"])]),bodyCell:p(({column:y,text:i})=>[y.dataIndex==="status"?(c(),m(le,{key:0},[i==0?(c(),m("span",ue,"未执行")):v("",!0),i==1?(c(),m("span",pe,"执行中")):v("",!0),i==2?(c(),m("span",fe,"已执行")):v("",!0),i==3?(c(),m("span",ge,"执行失败")):v("",!0)],64)):v("",!0)]),_:1},8,["onRegister","searchInfo"])])]),_:1})])}}});const We=q(Ie,[["__scopeId","data-v-92c63774"]]);export{We as default};
//# sourceMappingURL=index-f4a8625a.js.map
