var y=(w,a,c)=>new Promise((h,n)=>{var _=s=>{try{l(c.next(s))}catch(f){n(f)}},k=s=>{try{l(c.throw(s))}catch(f){n(f)}},l=s=>s.done?h(s.value):Promise.resolve(s.value).then(_,k);l((c=c.apply(w,a)).next())});import{b as K,au as E,a7 as W,av as b,ax as S,_ as X}from"./index.js";import{B as Z}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as j}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{P as q}from"./index-20519caf.js";import{e as G}from"./download-03e71dd5.js";import{c as J,a as Q,u as U,e as Y,g as ee,s as te,b as oe}from"./drone.data-57a403d5.js";import{a as F}from"./assign-37f1c13d.js";import{d as ne,r as P,k as R,o as ae,al as re,x as se,Z as i,a9 as D,aa as p,f as v,u as r,E as x,ad as C,v as ie,_ as m,F as B,ac as u}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";const ce={key:0,style:{color:"#19be6b"}},le={key:1,style:{color:"red"}},de={key:0,style:{color:"#337ab7"}},pe={key:1,style:{color:"#d9534f"}},me={key:2,style:{color:"#ec971f"}},ue=ne({__name:"index",setup(w){const{t:a}=K(),c=E(),{createConfirm:h}=E(),n=P({}),_=R(!0),k=()=>y(this,null,function*(){const e=$(),t=P({});return F(t,n),t.pageNo=e.current,t.pageSize=e.pageSize,t.sortField||(t.sortField="createTime",t.sortOrder="desc"),(yield oe(t)).result}),l=R("无人机档案"),[s,{reload:f,clearSelectedRowKeys:fe,getPaginationRef:$,getSelectRows:M}]=j({title:l,api:k,columns:ee(),useSearchForm:!0,formConfig:te,bordered:!0,rowKey:"id",rowSelection:{type:"radio"},sortFn:e=>{var o;const t=(o=e.order)==null?void 0:o.replace("end","");n.sortOrder=t,n.sortField=t?e.field:void 0},handleSearchInfoFn(e){return F(n,e),e},showTableSetting:!0,tableSetting:{fullScreen:!0},showIndexColumn:!0});function O(){S("/po/drone/dronearchive/create",I({}))}function N(){const e=T();e&&J("?id="+e).then(()=>{S(`/po/drone/dronearchive/create?id=${e}`,I({id:e}))})}function V(){const e=T();e&&Q("?id="+e).then(()=>{h({title:"提示",iconType:"warning",content:"确实要报废选中数据吗？",onOk(){return y(this,null,function*(){const o="?id="+e+"&status=0";U(o).then(()=>{c.success("已报废"),f()})})}})})}function z(e){S(`/po/drone/dronearchive/create?id=${e.id}&isReadonly=true`,I(e,!0))}const I=(e,t)=>{const o=l.value;return t?`查看${o}`:e!=null&&e.id?`${a("common.action.edit")}${o}`:`${a("common.action.create")}${o}`};function T(){const e=M();return e.length==0?(c.error("请选择一行数据"),!1):e[0].id}function A(){h({title:a("common.message.confirmTitle"),iconType:"warning",content:a("common.message.exportMessage"),onOk(){return y(this,null,function*(){n.filename=`${l.value}.xls`,yield Y(n).then(t=>{G(t==null?void 0:t.data,n.filename)}),n.filename=null,c.success(a("common.exportSuccessText"))})}})}function H({rows:e}){_.value=e.length===0}return ae(()=>{W.getInstance().listen("drone_archive",f)}),(e,t)=>{const o=re("a-button"),L=se("auth");return i(),D(r(q),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:p(()=>[v(r(Z),{onRegister:r(s),searchInfo:n,onResizeColumn:t[0]||(t[0]=(g,d)=>d.width=g),onRowDbClick:t[1]||(t[1]=g=>z(g)),onSelectionChange:H},{toolbar:p(()=>[v(o,{type:"primary",preIcon:r(b).ADD,onClick:O},{default:p(()=>[x(C(r(a)("common.action.create")),1)]),_:1},8,["preIcon"]),ie((i(),D(o,{disabled:_.value,type:"primary",preIcon:r(b).EDIT,onClick:N},{default:p(()=>[x(C(r(a)("common.action.edit")),1)]),_:1},8,["disabled","preIcon"])),[[L,"po:drone:dronearchive:update"]]),v(o,{class:"grey-btn",disabled:_.value,preIcon:r(b).DISABLE,onClick:V},{default:p(()=>[x("报废")]),_:1},8,["disabled","preIcon"]),v(o,{class:"yellow-btn",preIcon:r(b).EXPORT,onClick:A},{default:p(()=>[x(C(r(a)("common.action.export")),1)]),_:1},8,["preIcon"])]),bodyCell:p(({column:g,text:d})=>[g.dataIndex==="status"?(i(),m(B,{key:0},[d==1?(i(),m("span",ce,"正常")):u("",!0),d==0?(i(),m("span",le,"报废")):u("",!0)],64)):u("",!0),g.dataIndex==="insuranceStatus"?(i(),m(B,{key:1},[d=="在保"?(i(),m("span",de,"在保")):u("",!0),d=="过保"?(i(),m("span",pe,"过保")):u("",!0),d=="临保"?(i(),m("span",me,"临保")):u("",!0)],64)):u("",!0)]),_:1},8,["onRegister","searchInfo"])]),_:1})}}});const Le=X(ue,[["__scopeId","data-v-529d83ff"]]);export{Le as default};
//# sourceMappingURL=index-736b6851.js.map
