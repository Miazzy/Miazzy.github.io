var ee=Object.defineProperty;var F=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var N=(t,r,n)=>r in t?ee(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,q=(t,r)=>{for(var n in r||(r={}))te.call(r,n)&&N(t,n,r[n]);if(F)for(var n of F(r))ie.call(r,n)&&N(t,n,r[n]);return t};var g=(t,r,n)=>new Promise((c,v)=>{var a=u=>{try{b(n.next(u))}catch(m){v(m)}},i=u=>{try{b(n.throw(u))}catch(m){v(m)}},b=u=>u.done?c(u.value):Promise.resolve(u.value).then(a,i);b((n=n.apply(t,r)).next())});import{a5 as f,b as ne,au as ae,av as C,_ as re}from"./index.js";import{B as O}from"./BasicTable-0434a334.js";import{T as P}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as D}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{P as oe}from"./index-20519caf.js";import{C as k}from"./CommonTree-c4ed7838.js";import"./index-316f6ffb.js";import{u as K}from"./useRender-21ce56fb.js";import{k as x,d as se,r as B,o as le,al as de,Z as S,a9 as _,aa as h,f as I,u as d,ac as A,$ as ue,E as ce,ad as me}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";const pe=t=>f.post({url:"/baseset/devicetype/tree",params:t},{isOnlyResult:!0}),ge=t=>f.get({url:"/baseset/device-equipment/getStationMaterialCategoryTree",params:t},{isOnlyResult:!0}),fe=t=>f.post({url:"/baseset/device-equipment/create",params:t},{}),ve=t=>f.delete({url:`/baseset/device-equipment/delete?id=${t}`},{}),be=t=>f.get({url:"/baseset/device-equipment/getDevicePage",params:t},{isOnlyResult:!0}),Ie=t=>f.get({url:"/baseset/device-equipment/getEquipmentPage",params:t},{isOnlyResult:!0}),he=[{title:"区域名称",dataIndex:"areaName",headAlign:"center",align:"left",sorter:!0,resizable:!0,width:100},{title:"设备编码",dataIndex:"deviceCode",sorter:!0,resizable:!0,width:150},{title:"设备名称",dataIndex:"deviceName",headAlign:"center",align:"left",sorter:!0,resizable:!0,width:180},{title:"关联物料",dataIndex:"materialCode",sorter:!0,resizable:!0,width:120,customRender:({text:t,record:r})=>{const n="/po/equipment/create";return K.renderIframeLink(n,"查看物资",{id:r.equipmentId,isReadOnly:!0},t)}}],we=[{title:"物料编码",dataIndex:"materialCode",sorter:!0,resizable:!0,width:120},{title:"物料名称",dataIndex:"materialName",headAlign:"center",align:"left",sorter:!0,resizable:!0,width:180},{title:"设备编码",dataIndex:"equipmentCode",sorter:!0,resizable:!0,width:140},{title:"设备名称",dataIndex:"equipmentName",headAlign:"center",align:"left",sorter:!0,resizable:!0,width:140},{title:"区域子阵",dataIndex:"subarrayName",headAlign:"center",align:"left",sorter:!0,resizable:!0,width:140},{title:"数量",dataIndex:"qty",headAlign:"center",align:"right",sorter:!0,resizable:!0,width:120},{title:"关联设备",dataIndex:"deviceCode",sorter:!0,resizable:!0,width:150,customRender:({text:t,record:r})=>{const n="/baseset/monitor/device",c=`${r.stationId}-${r.deviceType}`;return K.renderIframeLink(n,void 0,{deviceEsn:t,treeId:c},t)}}],L=x([{value:"0",label:"未关联"},{value:"1",label:"已关联"}]),ye={baseColProps:{span:15},labelWidth:60,autoAdvancedLine:1,actionColOptions:{span:9},schemas:[{field:"areaName",label:"区域名称",component:"Input"},{field:"deviceName",label:"设备名称",component:"Input"},{field:"status",label:"状态",component:"Select",componentProps:{options:L.value}}],submitButtonOptions:{loading:!1}},qe={baseColProps:{span:9},labelWidth:60,showAdvancedButton:!1,actionColOptions:{span:6},schemas:[{field:"materialName",label:"物料名称",component:"Input"},{field:"status",label:"状态",component:"Select",componentProps:{options:L.value}}],submitButtonOptions:{loading:!1}},Ce={class:"btn-container"},Se=se({__name:"index",setup(t){const{t:r}=ne(),n=ae(),c=x([]),v=x([]),a=B({device:{},equipment:{}}),i=B({device:"device",equipment:"equipment"}),b=e=>e===i.device?$().getFieldsValue():e===i.equipment?j().getFieldsValue():{},u=e=>e===i.device?M():e===i.equipment?Z():{},m=(e,o)=>{const p=b(o),s=q(q({},p),a[o]);if(e){const l=u(o);s.pageNo=l.current,s.pageSize=l.pageSize}return s},R=(e,o)=>{var s;const p=(s=e.order)==null?void 0:s.replace("end","");a[o].sortOrder=p,a[o].sortField=p?e.field:void 0},[V,{reload:w,getForm:$,getPaginationRef:M,getSelectRows:H,clearSelectedRowKeys:T}]=D({title:"设备列表",api:()=>g(this,null,function*(){const e=m(!0,i.device);return yield be(e)}),columns:he,useSearchForm:!0,formConfig:ye,bordered:!0,rowSelection:{type:"radio"},sortFn:e=>R(e,i.device),showTableSetting:!0,tableSetting:{fullScreen:!0},showIndexColumn:!0,actionColumn:{width:100,title:r("common.operate"),dataIndex:"action",fixed:"right"}}),[W,{reload:y,getForm:j,getPaginationRef:Z,getSelectRows:G,clearSelectedRowKeys:E}]=D({title:"物资列表",api:()=>g(this,null,function*(){const e=m(!0,i.equipment);return yield Ie(e)}),columns:we,useSearchForm:!0,formConfig:qe,bordered:!0,rowSelection:{type:"radio"},sortFn:e=>R(e,i.equipment),showTableSetting:!0,tableSetting:{fullScreen:!0},showIndexColumn:!0,actionColumn:{width:100,title:r("common.operate"),dataIndex:"action",fixed:"right"}}),J=()=>g(this,null,function*(){const e=H();if(e.length==0){n.error("请选择一行设备列表数据");return}if(e[0].id){n.error("该数据已关联");return}const o=G();if(o.length==0){n.error("请选择一行物资列表数据");return}yield fe({deviceId:e[0].deviceId,equipmentId:o[0].equipmentId}),n.success(r("关联成功")),T(),w(),E(),y()}),z=e=>g(this,null,function*(){yield ve(e.id),n.success(r("取消成功")),T(),w(),E(),y()});function Q(){return g(this,null,function*(){const e=yield pe({});c.value=e;const o=yield ge({});v.value=o})}function U(e){a[i.device].stationId=null,a[i.device].deviceCategory=null,a[i.device].deviceType=null,e&&(e.nodeKindId==="org"?(a[i.device].stationId=X(e.children),a.stationOrganId=e.id):e.nodeKindId==="station"?a[i.device].stationId=e.powerStationId:(a[i.device].stationId=e.powerStationId,a[i.device].deviceCategory=e.deviceCategory,a[i.device].deviceType=e.deviceType)),w()}function X(e){return e?e.map(o=>o.powerStationId).join(","):""}function Y(e){a[i.equipment].organId=null,a[i.equipment].stationId=null,a[i.equipment].path=null,e&&(e.nodeKindId==="org"&&(a[i.equipment].organId=e.id),e.nodeKindId==="station"&&(a[i.equipment].organId=e.organId,a[i.equipment].stationId=e.powerStationId),e.nodeKindId==="materialCategory"&&(a[i.equipment].organId=e.organId,a[i.equipment].stationId=e.powerStationId,a[i.equipment].path=e.path)),y()}return le(()=>{Q()}),(e,o)=>{const p=de("a-button");return S(),_(d(oe),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:h(()=>[I(k,{title:"设备电站组织",onSelect:U,value:c.value,class:"w-1/6",toolbar:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),I(d(O),{onRegister:d(V),class:"w-2/6",onResizeColumn:o[0]||(o[0]=(s,l)=>l.width=s)},{bodyCell:h(({column:s,record:l})=>[s.key==="action"?(S(),_(d(P),{key:0,actions:[{icon:d(C).DELETE,danger:!0,label:"取消",ifShow:()=>!!l.id,popConfirm:{title:"是否确认取消",confirm:z.bind(null,l)}}]},null,8,["actions"])):A("",!0)]),_:1},8,["onRegister"]),ue("div",Ce,[I(p,{type:"primary",preIcon:d(C).ADD,onClick:J},{default:h(()=>[ce(me("关联"))]),_:1},8,["preIcon"])]),I(k,{title:"物资电站组织",onSelect:Y,value:v.value,class:"w-1/6",toolbar:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),I(d(O),{onRegister:d(W),class:"w-2/6",onResizeColumn:o[1]||(o[1]=(s,l)=>l.width=s)},{bodyCell:h(({column:s,record:l})=>[s.key==="action"?(S(),_(d(P),{key:0,actions:[{icon:d(C).DELETE,danger:!0,label:"取消",ifShow:()=>!!l.id,popConfirm:{title:"是否确认取消",confirm:z.bind(null,l)}}]},null,8,["actions"])):A("",!0)]),_:1},8,["onRegister"])]),_:1})}}});const Ye=re(Se,[["__scopeId","data-v-4c3222eb"]]);export{Ye as default};
//# sourceMappingURL=index-5a412499.js.map
