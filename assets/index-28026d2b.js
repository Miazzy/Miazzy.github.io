var _=(X,B,D)=>new Promise((i,g)=>{var K=f=>{try{k(D.next(f))}catch(F){g(F)}},n=f=>{try{k(D.throw(f))}catch(F){g(F)}},k=f=>f.done?i(f.value):Promise.resolve(f.value).then(K,n);k((D=D.apply(X,B)).next())});import{d as Be,k as u,r as J,o as Pe,al as p,Z as x,a9 as Q,aa as l,f as a,$ as N,u as s,E as y,ac as E,_ as P,F as Ve,v as h,A as C}from"./vue-71d1abb3.js";import{au as $e,av as O,_ as He}from"./index.js";import{B as je}from"./BasicTable-0434a334.js";import{T as qe}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as Me}from"./useTable-109483b3.js";import{a2 as U}from"./antd-15ac76ed.js";import{P as We}from"./index-20519caf.js";import{_ as Ye}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{C as Ze}from"./CommonTree-c4ed7838.js";import"./index-74ac3212.js";import{D as ue}from"./Dialog-0a006d82.js";import{g as Ge,a as Je,b as Qe,c as Xe,d as ea,e as aa,f as la,i as ta,h as oa,u as re,s as na,j as sa,k as ua,l as ra,m as ia,n as da}from"./index-b4b13d0a.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";const ca={class:"right-table-layout"},pa={key:0,style:{color:"red"}},ma={key:1,style:{color:"#30ca5a"}},va={class:"dialog-loading"},fa={class:"tab-button-div"},ga={class:"tab-table-div"},_a={class:"dialog-table-wrapper"},ba={class:"dialog-table-wrapper"},ya={class:"dialog-table-wrapper"},ha={key:0,class:"dialog-mask"},Ca=Be({__name:"index",setup(X){const{createConfirm:B}=$e();u([]);const D=u("calc(100vh - 223px)"),i=u({}),g=u(!1),K=u(!1),n=u({}),k=u(""),f=u(""),F=u();let d=u(""),R=J({});const z=u(!1),c=J({}),ee=u([]),V=u(!1);u("");let ie=Ge();const $=u(!1),b=u("role"),m=J({});let de=Je(),H=u([]),ce=Qe(),j=u([]),pe=Xe(),q=u([]),ae=u([]),le=u([]),M=u([]);const me=()=>_(this,null,function*(){be(),W();let t=fe().getFieldsValue();c.parentId=i.value.id,c.parentFullId=i.value.fullId,c.code=t.code,c.name=t.name;const e=_e();c.pageNo=e.current,c.pageSize=e.pageSize;let r=yield da(c);return ae.value=r.result,ae}),[ve,{reload:T,getForm:fe,getDataSource:ge,getPaginationRef:_e,clearSelectedRowKeys:be}]=Me({title:"权限列表",api:me,columns:ie,showTableSetting:!0,pagination:{pageSize:20},bordered:!0,rowKey:"id",rowSelection:{type:"radio",fixed:!0,onSelect:he},formConfig:{labelWidth:120,actionColOptions:{span:24},autoAdvancedLine:1,baseColProps:{span:7},schemas:ia,noHideBtnFlag:!0,autoSubmitOnEnter:!0},useSearchForm:!0,handleSearchInfoFn(t){return t},sortFn:t=>{t.order?(c.sortField=t.field,c.sortOrder=t.order.replace("end","")):(c.sortField="",c.sortOrder="")}});function ye({keys:t,rows:e}){if(e&&e.length>0){const r=e[0];d.value=r.id,R=r}else d.value="",R=null}function he(t,e){e?(d.value=t.id,R=t):(d.value="",R=null)}function Ce(){g.value=!1}function ke(){return _(this,null,function*(){if(V.value=!1,i.value.id==null){U.error("请先选择父节点");return}if(i.value.nodeKind!="fun")$.value=!0;else{$.value=!1,M.value=yield ea({sourceKind:"fun"});let r=[];M.value.forEach(A=>{r.push({label:A.name,value:A.id})}),le.value=r}let t=i.value.id,e=yield aa({tableName:"sys_permission",step:1,parentId:t});n.value={},n.value.sort=e.result,k.value="添加权限",g.value=!0})}function Ie(t){let e={};M.value.forEach(r=>{if(r.id==t){e=r;return}}),n.value.code=i.value.code+":"+e.code,n.value.name=i.value.name+e.name}function W(){return _(this,null,function*(){const t=yield la({showAdminFun:!0});ee.value=t.result})}function we(){return _(this,arguments,function*(t=[]){i.value=t,T()})}function Se(){console.log(n),F.value.validateFields().then(()=>{z.value=!0;let t={id:i.value.id,fullId:i.value.fullId,fullName:i.value.fullName,fullSort:i.value.fullSort};n.value.parent=t,ta(n.value).then(()=>{U.success("保存成功"),W(),T(),z.value=!1,g.value=!1}).catch(()=>{z.value=!1})})}function xe(){Object.assign(n.value,R),k.value="修改功能",g.value=!0,V.value=!0}function Ne(){d.value!=""&&B({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return _(this,null,function*(){oa(d.value).then(()=>{U.success("已删除。"),T()})})}})}function De(){let t={id:d.value,status:1};re(t).then(()=>{U.success("已启用。"),T()})}function Fe(){B({title:"禁用",iconType:"danger",content:"确认禁用此数据？",onOk(){return _(this,null,function*(){let e={id:d.value,status:0};re(e).then(()=>{U.success("已禁用。"),T()})})}})}function Te(){let t=ge().map(e=>({id:e.id,sort:e.sort,parentId:e.parentId,fullId:e.fullId}));na(t).then(e=>{U.success("已保存"),T()})}function Le(t){return[{label:"授权情况",icon:"clarity:bullet-list-line",onClick:e=>{Ee(t,e)}}]}function Ee(t,e){ne(),K.value=!0,f.value=t.name,d.value=t.id,b.value="role",te(b.value),e==null||e.stopPropagation()}function te(t){return _(this,null,function*(){c.infoType=t,oe()})}function oe(){return _(this,null,function*(){let t={roleName:m.roleName,orgName:m.orgName,personName:m.personName};if(t.permissionId=d.value,b.value==="role"){let e=yield sa(t);H.value=e.result}else if(b.value==="roleOrg"){let e=yield ua(t);j.value=e.result}else if(b.value==="person"){let e=yield ra(t);q.value=e.result}})}u({defaultPageSize:20,showTotal:t=>`共${t}条数据`,showSizeChanger:!0,pageSizeOptions:["20","50","100","200"],total:0});function ne(){Object.keys(m).forEach(t=>{m[t]=null})}function Oe(){oe()}return Pe(()=>{W()}),(t,e)=>{const r=p("a-button"),A=p("a-input-number"),Ue=p("a-spin"),v=p("a-form-item"),I=p("a-col"),w=p("a-row"),L=p("a-input"),Ke=p("a-select"),Re=p("a-textarea"),se=p("a-form"),Y=p("a-table"),Z=p("a-tab-pane"),ze=p("a-tabs");return x(),Q(s(We),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:l(()=>[a(Ze,{title:"权限树",onSelect:we,value:ee.value,class:"left-tree-layout",canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),N("div",ca,[a(s(je),{onRegister:s(ve),class:"fix-basic-table",searchInfo:c,onSelectionChange:ye,scroll:{y:D.value},onResizeColumn:e[2]||(e[2]=(o,S)=>S.width=o)},{toolbar:l(()=>[a(r,{type:"primary",preIcon:s(O).ADD,onClick:ke},{default:l(()=>[y("添加")]),_:1},8,["preIcon"]),a(r,{type:"primary",preIcon:s(O).EDIT,disabled:s(d)=="",onClick:xe},{default:l(()=>[y("修改")]),_:1},8,["preIcon","disabled"]),a(r,{class:"red-btn",preIcon:s(O).DELETE,disabled:s(d)=="",onClick:Ne},{default:l(()=>[y("删除")]),_:1},8,["preIcon","disabled"]),a(r,{class:"green-btn",preIcon:s(O).ENABLE,disabled:s(d)=="",onClick:e[0]||(e[0]=o=>De(1))},{default:l(()=>[y("启用")]),_:1},8,["preIcon","disabled"]),a(r,{class:"grey-btn",preIcon:s(O).DISABLE,disabled:s(d)=="",onClick:e[1]||(e[1]=o=>Fe(0))},{default:l(()=>[y("禁用")]),_:1},8,["preIcon","disabled"]),a(r,{type:"primary",preIcon:s(O).ADD,onClick:Te},{default:l(()=>[y("保存排序号")]),_:1},8,["preIcon"])]),bodyCell:l(({text:o,column:S,record:G})=>[S.key==="sort"?(x(),Q(A,{key:0,value:G[S.dataIndex],"onUpdate:value":Ae=>G[S.dataIndex]=Ae,min:1,defaultValue:"1",style:{margin:"-5px 0"}},null,8,["value","onUpdate:value"])):E("",!0),S.key==="statusText"?(x(),P(Ve,{key:1},[o=="无效"?(x(),P("span",pa,"无效")):E("",!0),o=="有效"?(x(),P("span",ma,"有效")):E("",!0)],64)):E("",!0),S.key==="operation"?(x(),Q(s(qe),{key:2,actions:Le(G)},null,8,["actions"])):E("",!0)]),_:1},8,["onRegister","searchInfo","scroll"])]),h(N("div",va,[a(Ue)],512),[[C,z.value]]),a(ue,{visible:g.value,"onUpdate:visible":e[10]||(e[10]=o=>g.value=o),smode:"normal",title:k.value,width:800,height:650,onConfirm:Se,onCancel:Ce,overflowY:"auto"},{default:l(()=>[a(se,{ref_key:"permissionFormRef",ref:F,model:n.value,name:"permissionForm"},{default:l(()=>[a(w,{gutter:24},{default:l(()=>[h(a(I,{span:24},{default:l(()=>[a(v,{label:"节点类型",name:"nodeKind",labelCol:{span:4}},{default:l(()=>[a(Ye,{disabled:V.value,value:n.value.nodeKind,"onUpdate:value":e[3]||(e[3]=o=>n.value.nodeKind=o),type:"permission_node_kind"},null,8,["disabled","value"])]),_:1})]),_:1},512),[[C,!0]])]),_:1}),a(w,{gutter:24},{default:l(()=>[h(a(I,{span:24},{default:l(()=>[a(v,{label:"资源",name:"resourceId",labelCol:{span:4}},{default:l(()=>[a(L,{disabled:"",value:n.value.resourceId,"onUpdate:value":e[4]||(e[4]=o=>n.value.resourceId=o)},null,8,["value"])]),_:1})]),_:1},512),[[C,!0]])]),_:1}),a(w,{gutter:24},{default:l(()=>[h(a(I,{span:24},{default:l(()=>[a(v,{label:"操作",name:"operationId",labelCol:{span:4}},{default:l(()=>[a(Ke,{value:n.value.operationId,"onUpdate:value":e[5]||(e[5]=o=>n.value.operationId=o),style:{width:"100%"},placeholder:"请选择操作类型",options:s(le),disabled:$.value,onChange:Ie},null,8,["value","options","disabled"])]),_:1})]),_:1},512),[[C,!0]])]),_:1}),a(w,{gutter:24},{default:l(()=>[h(a(I,{span:24},{default:l(()=>[a(v,{label:"编码",name:"code",labelCol:{span:4},rules:[{required:!0,message:"请输入编码"}]},{default:l(()=>[a(L,{value:n.value.code,"onUpdate:value":e[6]||(e[6]=o=>n.value.code=o),maxlength:"64"},null,8,["value"])]),_:1})]),_:1},512),[[C,!0]])]),_:1}),a(w,{gutter:24},{default:l(()=>[h(a(I,{span:24},{default:l(()=>[a(v,{label:"名称",name:"name",labelCol:{span:4},rules:[{required:!0,message:"请输入名称"}]},{default:l(()=>[a(L,{value:n.value.name,"onUpdate:value":e[7]||(e[7]=o=>n.value.name=o),maxlength:"128"},null,8,["value"])]),_:1})]),_:1},512),[[C,!0]])]),_:1}),a(w,{gutter:24},{default:l(()=>[h(a(I,{span:24},{default:l(()=>[a(v,{label:"排序号",name:"sort",labelCol:{span:4}},{default:l(()=>[a(A,{min:1,value:n.value.sort,"onUpdate:value":e[8]||(e[8]=o=>n.value.sort=o)},null,8,["value"])]),_:1})]),_:1},512),[[C,!0]])]),_:1}),a(w,{gutter:24},{default:l(()=>[h(a(I,{span:24},{default:l(()=>[a(v,{label:"备注",name:"remark",labelCol:{span:4}},{default:l(()=>[a(Re,{rows:5,value:n.value.remark,"onUpdate:value":e[9]||(e[9]=o=>n.value.remark=o),maxlength:128,"show-count":""},null,8,["value"])]),_:1})]),_:1},512),[[C,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),a(ue,{visible:K.value,"onUpdate:visible":e[16]||(e[16]=o=>K.value=o),smode:"simple",title:f.value,width:1200},{default:l(()=>[N("div",fa,[a(se,{model:m,name:"horizontal_login",layout:"inline",autocomplete:"off"},{default:l(()=>[a(v,{label:"角色名称",name:"roleName"},{default:l(()=>[a(L,{value:m.roleName,"onUpdate:value":e[11]||(e[11]=o=>m.roleName=o)},null,8,["value"])]),_:1}),a(v,{label:"组织名称",name:"orgName"},{default:l(()=>[a(L,{value:m.orgName,"onUpdate:value":e[12]||(e[12]=o=>m.orgName=o)},null,8,["value"])]),_:1}),a(v,{label:"人员名称",name:"personName"},{default:l(()=>[a(L,{value:m.personName,"onUpdate:value":e[13]||(e[13]=o=>m.personName=o)},null,8,["value"])]),_:1}),a(v,{style:{position:"absolute",right:"-25px"}},{default:l(()=>[a(r,{class:"tab-button",onClick:ne},{default:l(()=>[y("重置")]),_:1}),a(r,{type:"primary",style:{"margin-right":"10px"},onClick:Oe},{default:l(()=>[y("查询")]),_:1})]),_:1})]),_:1},8,["model"])]),N("div",ga,[a(ze,{activeKey:b.value,"onUpdate:activeKey":e[14]||(e[14]=o=>b.value=o),onChange:e[15]||(e[15]=o=>te(b.value))},{default:l(()=>[a(Z,{key:"role",tab:"角色列表"},{default:l(()=>[N("div",_a,[a(Y,{columns:s(de),"data-source":s(H),size:"small",bordered:"",scroll:{y:s(H).length==0?"calc(365px)":"calc(270px)"}},null,8,["columns","data-source","scroll"])])]),_:1}),a(Z,{key:"roleOrg",tab:"角色授权"},{default:l(()=>[N("div",ba,[a(Y,{columns:s(ce),"data-source":s(j),size:"small",bordered:"",scroll:{y:s(j).length==0?"calc(365px)":"calc(270px)"}},null,8,["columns","data-source","scroll"])])]),_:1}),a(Z,{key:"person",tab:"组织人员"},{default:l(()=>[N("div",ya,[a(Y,{columns:s(pe),"data-source":s(q),size:"small",bordered:"",scroll:{y:s(q).length==0?"calc(365px)":"calc(270px)"}},null,8,["columns","data-source","scroll"])])]),_:1})]),_:1},8,["activeKey"])])]),_:1},8,["visible","title"]),z.value?(x(),P("div",ha)):E("",!0)]),_:1})}}});const Ja=He(Ca,[["__scopeId","data-v-00a987ca"]]);export{Ja as default};
//# sourceMappingURL=index-28026d2b.js.map
