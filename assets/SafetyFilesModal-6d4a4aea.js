var Z=Object.defineProperty;var q=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var P=(p,e,i)=>e in p?Z(p,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[e]=i,R=(p,e)=>{for(var i in e||(e={}))H.call(e,i)&&P(p,i,e[i]);if(q)for(var i of q(e))J.call(e,i)&&P(p,i,e[i]);return p};var I=(p,e,i)=>new Promise((x,C)=>{var S=v=>{try{b(i.next(v))}catch(w){C(w)}},g=v=>{try{b(i.throw(v))}catch(w){C(w)}},b=v=>v.done?x(v.value):Promise.resolve(v.value).then(S,g);b((i=i.apply(p,e)).next())});import{d as X,r as Y,k as h,ax as ee,u as te,o as ae,al as _,Z as z,_ as le,f as t,aa as l,$ as N,a9 as se,ac as D,v as f,A as c}from"./vue-71d1abb3.js";import{b as $,s as oe}from"./safetyFiles-3e6b7883.js";import{W as ie}from"./WfApproveBox-a3448232.js";import{a0 as ne,ak as re,aB as de,bP as ue,a7 as pe,aC as me}from"./index.js";import{B as fe}from"./BillTitle-d17ab3e4.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import{a2 as ce}from"./antd-15ac76ed.js";import"./index-316f6ffb.js";import"./index-085d06c7.js";import{u as be}from"./useTable-109483b3.js";import{_ as B}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{_ as ve}from"./UploadTable.vue_vue_type_script_setup_true_lang-5478923e.js";import{a as F}from"./assign-37f1c13d.js";import"./useRender-21ce56fb.js";import"./index.esm-c216ed00.js";import"./index-fda2d66c.js";import"./BasicTable-0434a334.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./useWindowSizeFn-13b1b8a2.js";import"./OrganDialog-dd1023ce.js";import"./Dialog-0a006d82.js";import"./index-c0893416.js";import"./index-33af41d1.js";import"./tree-fc0e156a.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";const _e={class:"load"},ge={class:"process-box"},ye={class:"header-box"},Ie={class:"content"},Ce={style:{margin:"5px 16px 20px 10px"}},lt=X({__name:"SafetyFilesModal",setup(p){const e=Y({spinning:!1}),x=ne().getUserInfo,C=h([]),S=h(),g=h(!0),b=Y({});b.subject="安全信息",b.infoItems=[];const v=ee(),{currentRoute:w}=v;te(w);const m=re.getInstance().getQuery(),k=h();function T(o){e.spinning=!0;try{o=o||0,k.value.validateFields().then(()=>{e.status=o,oe(e).then(a=>{e.id=a,$({id:a}).then(r=>{F(e,r.result)}),ce.success(o==1?"提交成功。":"保存成功"),pe.getInstance().sendMsg("safetyFiles",{}),o==1&&(g.value=!0,me())})})}catch(a){console.log("error",a)}finally{e.spinning=!1}}function G(){T(1)}function K(){T(0)}ae(()=>I(this,null,function*(){m.id=yield V(),yield $({id:m.id}).then(o=>{m.id?(F(e,o.result),e.status==0&&e.personMemberId.substring(0,32)!=x.userId&&(e.status=10)):(F(e,m),e.spinning=!1,e.status=0,e.billCode=o.result.billCode,e.personMemberName=o.result.personMemberName,e.fillinDate=o.result.fillinDate,e.deptName=o.result.deptName),e.status==1&&(g.value=!0)}),m.id||(g.value=!1),yield j(),e.bizFileId==null||e.bizFileId==null||e.bizFileId==""?L():U()}));const A=o=>{const a=["报告","整改清单"],r=["report","list"],n={fileKindId:"",filetype:"",bizId:o,maxCount:20,maxSize:20971520,required:!1,readonly:!0},d=[];for(let u=0;u<2;u++){let y=R({},n);y.fileKindId=r[u],y.filetype=a[u],y.readonly=g.value,d.push(y)}C.value=d},V=()=>I(this,null,function*(){let o=m.id;if(!o&&m.processInstanceId){const r=(yield de(m.processInstanceId)).businessKey;m.id=r,o=r}return o}),j=()=>I(this,null,function*(){g.value=e.status!=0,b.title="安全信息",e.processInstanceId=m.processInstanceId;let{billCode:o,fillinDate:a,personMemberName:r,deptName:n}=e;F(b,{billCode:o,fillinDate:a,personMemberName:r,deptName:n})});F(e,{processInstanceId:"",id:"",billCode:"",fillinDate:"",organId:"",organName:"",deptId:"",deptName:"",positionId:"",positionName:"",personMemberId:"",personMemberName:"",fullId:"",status:0,subject:"",finishedDate:"",fileType:"",particularYear:"",completionDate:"",isRectificationCompleted:"",serviceCompany:"",isPowerGridFiling:"",handledByName:"",rectificationPlan:"",bizFileId:""});const L=()=>I(this,null,function*(){ue().then(o=>{e.bizFileId=o,U()})}),W=h([]),U=()=>I(this,null,function*(){A(e.bizFileId)});return be({columns:[{title:"附件类型",dataIndex:"fileType",align:"left",width:150},{title:"附件",dataIndex:"bizFileId",align:"left",width:600}],pagination:!1,showIndexColumn:!1,showTableSetting:!1,tableSetting:{fullScreen:!0},dataSource:W}),(o,a)=>{const r=_("a-input"),n=_("a-form-item"),d=_("a-col"),u=_("a-row"),y=_("a-date-picker"),E=_("a-textarea"),M=_("a-card"),O=_("a-form"),Q=_("a-spin");return z(),le("div",_e,[t(Q,{spinning:e.spinning,tip:"Loading..."},{default:l(()=>[N("div",ge,[N("div",ye,[t(fe,{options:b},null,8,["options"]),e.status!=10?(z(),se(ie,{key:0,onSave:K,onSubmit:G,processInstanceId:e.processInstanceId,processStatus:e.status},null,8,["processInstanceId","processStatus"])):D("",!0)]),N("div",Ie,[t(O,{ref_key:"formRef",ref:k,model:e,labelAlign:"right",autocomplete:"off"},{default:l(()=>[t(M,{title:"基本信息",bordered:!1},{default:l(()=>[t(u,{gutter:24},{default:l(()=>[f(t(d,{span:12},{default:l(()=>[t(n,{name:"stationName",label:"电站名称",labelCol:{span:6},rules:[{required:!0,message:"请输入电站名称"}]},{default:l(()=>[t(r,{disabled:"",value:e.stationName,"onUpdate:value":a[0]||(a[0]=s=>e.stationName=s),placeholder:"请输入电站名称"},null,8,["value"]),D("",!0)]),_:1})]),_:1},512),[[c,!0]]),f(t(d,{span:12},{default:l(()=>[t(n,{name:"periodName",label:"期数",labelCol:{span:6},rules:[{required:!0,message:"请输入期数"}]},{default:l(()=>[t(r,{disabled:"",value:e.periodName,"onUpdate:value":a[2]||(a[2]=s=>e.periodName=s),placeholder:"请输入期数"},null,8,["value"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),t(u,{gutter:24},{default:l(()=>[f(t(d,{span:12},{default:l(()=>[t(n,{name:"fileType",label:"类型",labelCol:{span:6},rules:[{required:!0,message:"请选择类型"}]},{default:l(()=>[t(B,{type:"poSafetyFileType",onChange:a[3]||(a[3]=s=>"()=> detailFormState.fileType = value"),value:e.fileType,"onUpdate:value":a[4]||(a[4]=s=>e.fileType=s),style:{width:"100%"},disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]]),f(t(d,{span:12},{default:l(()=>[t(n,{name:"particularYear",label:"年度",labelCol:{span:6},rules:[{required:!0,message:"请选择年度"}]},{default:l(()=>[t(y,{value:e.particularYear,"onUpdate:value":a[5]||(a[5]=s=>e.particularYear=s),"value-format":"YYYY",style:{"min-width":"100%"},picker:"year",disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),t(u,{gutter:24},{default:l(()=>[f(t(d,{span:12},{default:l(()=>[t(n,{name:"completionDate",label:"完成时间",labelCol:{span:6},rules:[{required:!0,message:"请选择完成时间"}]},{default:l(()=>[t(y,{value:e.completionDate,"onUpdate:value":a[6]||(a[6]=s=>e.completionDate=s),"value-format":"YYYY-MM",picker:"month",style:{width:"100%"},disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]]),f(t(d,{span:12},{default:l(()=>[t(n,{name:"isRectificationCompleted",label:"整改是否完成",labelCol:{span:6},rules:[{required:!0,message:"请输入整改是否完成"}]},{default:l(()=>[t(B,{type:"yes_or_no",onChange:a[7]||(a[7]=s=>"()=> detailFormState.isRectificationCompleted = value"),value:e.isRectificationCompleted,"onUpdate:value":a[8]||(a[8]=s=>e.isRectificationCompleted=s),style:{width:"100%"},disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),t(u,{gutter:24},{default:l(()=>[f(t(d,{span:12},{default:l(()=>[t(n,{name:"serviceCompany",label:"服务单位",labelCol:{span:6},rules:[{required:!0,message:"请输入服务单位"}]},{default:l(()=>[t(r,{value:e.serviceCompany,"onUpdate:value":a[9]||(a[9]=s=>e.serviceCompany=s),placeholder:"请输入服务单位",disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]]),f(t(d,{span:12},{default:l(()=>[t(n,{name:"isPowerGridFiling",label:"电网备案",labelCol:{span:6},rules:[{required:!0,message:"请选择电网备案"}]},{default:l(()=>[t(B,{type:"yes_or_no",onChange:a[10]||(a[10]=s=>"()=> detailFormState.isPowerGridFiling = value"),value:e.isPowerGridFiling,"onUpdate:value":a[11]||(a[11]=s=>e.isPowerGridFiling=s),style:{width:"100%"},disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),t(u,{gutter:24},{default:l(()=>[f(t(d,{span:12},{default:l(()=>[t(n,{name:"handledByName",label:"经办人",labelCol:{span:6},rules:[{required:!1,message:"请输入经办人"}]},{default:l(()=>[t(r,{value:e.handledByName,"onUpdate:value":a[12]||(a[12]=s=>e.handledByName=s),disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),t(u,{gutter:24},{default:l(()=>[f(t(d,{span:24},{default:l(()=>[t(n,{name:"rectificationPlan",label:"遗留整改计划",labelCol:{span:3},rules:[{required:!0,message:"请输入遗留整改计划"}]},{default:l(()=>[t(E,{value:e.rectificationPlan,"onUpdate:value":a[13]||(a[13]=s=>e.rectificationPlan=s),row:"8","show-count":"",style:{height:"200px"},disabled:e.status!=0,maxlength:1e3},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1})]),_:1}),t(M,{title:"上传附件",bordered:!1},{default:l(()=>[N("div",Ce,[t(ve,{ref_key:"uploadTable",ref:S,rows:C.value,colwidths:["15%","70%","15%"],application:"po",module:"safetyFiles",mode:e.status==0?"normal":"view"},null,8,["rows","mode"])])]),_:1})]),_:1},8,["model"])])])]),_:1},8,["spinning"])])}}});export{lt as default};
//# sourceMappingURL=SafetyFilesModal-6d4a4aea.js.map
