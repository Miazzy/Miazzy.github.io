var Fe=Object.defineProperty;var X=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,Ke=Object.prototype.propertyIsEnumerable;var ee=(p,r,l)=>r in p?Fe(p,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):p[r]=l,O=(p,r)=>{for(var l in r||(r={}))Re.call(r,l)&&ee(p,l,r[l]);if(X)for(var l of X(r))Ke.call(r,l)&&ee(p,l,r[l]);return p};var w=(p,r,l)=>new Promise((m,P)=>{var h=i=>{try{C(l.next(i))}catch(c){P(c)}},y=i=>{try{C(l.throw(i))}catch(c){P(c)}},C=i=>i.done?m(i.value):Promise.resolve(i.value).then(h,y);C((l=l.apply(p,r)).next())});import{d as Ue,k as b,r as A,o as Ee,al as g,Z as x,_ as B,f as a,aa as n,$ as Ae,u,E as T,ad as D,F as te,ac as F,a9 as ae,v as R,A as K}from"./vue-71d1abb3.js";import{b as Be,au as Pe,av as v,_ as Ne}from"./index.js";import{D as qe}from"./Dialog-0a006d82.js";import{B as Ve}from"./BasicTable-0434a334.js";import{T as He,m as oe}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as Le}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{P as $e}from"./index-20519caf.js";import{u as ze}from"./index-fda2d66c.js";import{C as Oe}from"./CommonTree-c4ed7838.js";import{c as Me,s as We,R as Ye,g as Ze,a as je,b as Ge,d as Je,e as Qe,f as Xe,u as et,h as tt}from"./RoleDrawer-fa5d51ba.js";import{x as ne}from"./index-66d20ba6.js";import{a as le}from"./assign-37f1c13d.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";import"./index-b4b13d0a.js";import"./index-33af41d1.js";import"./data-1198e351.js";import"./index-5d738211.js";const at={class:"right-table-layout"},ot={key:0,style:{color:"#19be6b"}},nt={key:1,style:{color:"red"}},lt={key:0,class:"dialog-mask"},st=Ue({__name:"index",setup(p){const{t:r}=Be(),l=Pe(),m=b(!1),P=b(),h=b(!0),y=A({menu:"功能授权",org:"组织授权",pos:"标准岗授权",dataPermission:"数据授权"}),C=b([]),i=A({}),c=A({title:"",open:!1}),N=b(!1),se=b([]),o=A({status:"1",sort:1}),L=b(),M=b([]),U=b(!1),$=A({}),re=e=>{const d=me().getFieldsValue();if(d.parentId=i.parentId,e){const E=ce();d.pageNo=E.current,d.pageSize=E.pageSize}let _=O(O({},d),$);return _.parentId&&!_.sortField&&(_.sortOrder="asc",_.sortField="sort"),_},ie=()=>w(this,null,function*(){const e=re(!0),t=yield Ze(e);return M.value=t.list,t}),[de,{getSelectRows:ue,clearSelectedRowKeys:W,reload:q,getPaginationRef:ce,getForm:me}]=Le({title:"角色列表",api:ie,columns:Me,useSearchForm:!0,formConfig:We,showTableSetting:!0,bordered:!0,rowKey:"id",rowSelection:{type:"radio"},sortFn:e=>{var d;const t=(d=e.order)==null?void 0:d.replace("end","");$.sortOrder=t,$.sortField=t?e.field:void 0},actionColumn:{width:400,title:r("common.operate"),dataIndex:"action",fixed:"right"}}),[pe,{openDrawer:fe}]=ze();function Y(){return w(this,null,function*(){const e=yield je({});C.value=e})}function Z(e){return`${e.id?r("common.action.edit"):r("common.action.create")}角色`}function be(){const e=L.value;e&&e.validateFields().then(()=>{N.value=!0,o.code=ne.trim(o.code),o.name=ne.trim(o.name),Ge(o).then(()=>{l.success(r("common.saveSuccessText")),j(),Q(),c.open=!1,N.value=!1}).catch(()=>{N.value=!1})})}function ve(){return w(this,null,function*(){m.value=!1,U.value=!1,c.open=!1,yield j()})}function j(){var e;(e=L.value)==null||e.resetFields()}function _e(e){i.id=null,i.nodeKind=null,i.parentId=null,e&&(i.id=e.id,i.nodeKind=e.nodeKind,i.parentId=e.id),W(),q()}const ge=()=>w(this,null,function*(){if(G(),!i.id){l.error("请选择角色树节点");return}if(i.nodeKind==="role"){l.error("角色节点类别，不能再有下级数据");return}U.value=!i.nodeKind;const e=yield Je(i.id);o.parentId=i.id||"root",o.nodeKind="folder",o.status="1",o.sort=e,c.title=Z(o),c.open=!0}),G=()=>{m.value=!1,U.value=!1;for(let e in o)o[e]=""};function he(){return w(this,null,function*(){G();const e=z();if(!e)return;const t=yield Qe(e.id);le(o,t),o.status=String(o.status),c.title=Z(o),c.open=!0})}function ye(e){m.value=!0,U.value=!0,le(o,e),o.status=String(o.status),c.title="查看角色",c.open=!0}function z(){const e=ue();return e.length==0||se.value.length>1?(l.error("请选择一行数据"),!1):e[0]}function we(){return w(this,null,function*(){const e=z();e&&(yield l.delConfirm(),yield Xe(e.id),l.success(r("common.delSuccessText")),W(),Q())})}function xe(){J(1,"已启用")}function Ce(){J(0,"已禁用")}function J(e,t){const d=z();d&&et(d.id,e).then(()=>{l.success(t),q()})}function ke(){const e=[];M.value.forEach(t=>{if(!t.sort)throw l.error("排序不能为空"),Error("排序不能为空");e.push({id:t.id,sort:t.sort})}),tt(e).then(()=>{l.success("保存排序成功"),q()})}const V=(e,t)=>{fe(!0,{record:{roleId:e.id,type:t,title:`[${e.name}]${y[t]}`},isUpdate:!0})},Q=()=>{Y(),q()};function Se({rows:e}){h.value=e.length===0}return Ee(()=>{Y()}),(e,t)=>{const d=g("a-button"),_=g("a-input-number"),E=g("a-input"),k=g("a-form-item"),S=g("a-col"),I=g("a-row"),Ie=g("a-textarea"),Te=g("a-form");return x(),B(te,null,[a(u($e),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:n(()=>[a(Oe,{ref_key:"treeRef",ref:P,title:"角色树",onSelect:_e,value:C.value,class:"left-tree-layout",toolbar:!0,canAdd:!1,canEdit:!1,canDelete:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),Ae("div",at,[a(u(Ve),{onRegister:u(de),onResizeColumn:t[0]||(t[0]=(s,H)=>H.width=s),onRowDbClick:t[1]||(t[1]=s=>ye(s)),class:"fix-basic-table",onSelectionChange:Se},{toolbar:n(()=>[a(d,{type:"primary",preIcon:u(v).ADD,onClick:ge},{default:n(()=>[T(D(u(r)("common.action.create")),1)]),_:1},8,["preIcon"]),a(d,{disabled:h.value,type:"primary",preIcon:u(v).EDIT,onClick:he},{default:n(()=>[T(D(u(r)("common.action.edit")),1)]),_:1},8,["disabled","preIcon"]),a(d,{disabled:h.value,class:"red-btn",preIcon:u(v).DELETE,onClick:we},{default:n(()=>[T(D(u(r)("common.delText")),1)]),_:1},8,["disabled","preIcon"]),a(d,{disabled:h.value,class:"green-btn",preIcon:u(v).ENABLE,onClick:xe},{default:n(()=>[T(D("启用"))]),_:1},8,["disabled","preIcon"]),a(d,{disabled:h.value,class:"grey-btn",preIcon:u(v).DISABLE,onClick:Ce},{default:n(()=>[T(D("禁用"))]),_:1},8,["disabled","preIcon"]),a(d,{type:"primary",onClick:ke},{default:n(()=>[T(D("保存排序"))]),_:1})]),bodyCell:n(({column:s,text:H,record:f})=>[s.dataIndex==="status"?(x(),B(te,{key:0},[H==1?(x(),B("span",ot,"启用")):F("",!0),H==0?(x(),B("span",nt,"禁用")):F("",!0)],64)):F("",!0),s.dataIndex==="sort"?(x(),ae(_,{key:1,value:f[s.dataIndex],"onUpdate:value":De=>f[s.dataIndex]=De,class:"input-center",min:1,max:1e4,step:1,precision:0,status:"error"},null,8,["value","onUpdate:value"])):F("",!0),s.dataIndex==="action"?(x(),ae(u(He),{key:2,actions:[{icon:u(v).AUTH,label:y.menu,ifShow:()=>f.nodeKind==="role",onClick:V.bind(null,f,"menu")},{icon:u(v).AUTH,label:y.org,ifShow:()=>f.nodeKind==="role",onClick:V.bind(null,f,"org")},{icon:u(v).AUTH,label:y.pos,ifShow:()=>f.nodeKind==="role",onClick:V.bind(null,f,"pos")},{icon:u(v).AUTH,label:y.dataPermission,ifShow:()=>f.nodeKind==="role",onClick:V.bind(null,f,"dataPermission")}]},null,8,["actions"])):F("",!0)]),_:1},8,["onRegister"])])]),_:1}),a(qe,{visible:c.open,"onUpdate:visible":t[8]||(t[8]=s=>c.open=s),title:c.title,"show-btm":!m.value,onOk:be,onCancel:ve,width:480,height:520,smode:"normal",overflowY:"auto"},{default:n(()=>[a(Te,{ref_key:"modalFormRef",ref:L,model:o,name:"roleForm",autocomplete:"off"},{default:n(()=>[a(I,null,{default:n(()=>[R(a(S,{span:24},{default:n(()=>[a(k,{label:"编码",name:"code",labelCol:{class:"detail-label"},rules:[{required:!0,message:"请输入编码"}]},{default:n(()=>[a(E,{value:o.code,"onUpdate:value":t[2]||(t[2]=s=>o.code=s),maxlength:30,disabled:m.value},null,8,["value","disabled"])]),_:1})]),_:1},512),[[K,!0]])]),_:1}),a(I,null,{default:n(()=>[R(a(S,{span:24},{default:n(()=>[a(k,{label:"名称",name:"name",labelCol:{class:"detail-label"},rules:[{required:!0,message:"请输入名称"}]},{default:n(()=>[a(E,{value:o.name,"onUpdate:value":t[3]||(t[3]=s=>o.name=s),maxlength:50,disabled:m.value},null,8,["value","disabled"])]),_:1})]),_:1},512),[[K,!0]])]),_:1}),a(I,null,{default:n(()=>[R(a(S,{span:24},{default:n(()=>[a(k,{label:"状态",name:"status",labelCol:{class:"detail-label"},rules:[{required:!0,message:"请选择状态"}]},{default:n(()=>[a(oe,{value:o.status,"onUpdate:value":t[4]||(t[4]=s=>o.status=s),type:"enable_or_disable",disabled:m.value},null,8,["value","disabled"])]),_:1})]),_:1},512),[[K,!0]])]),_:1}),a(I,null,{default:n(()=>[R(a(S,{span:24},{default:n(()=>[a(k,{label:"节点类别",name:"nodeKind",labelCol:{class:"detail-label"},rules:[{required:!0,message:"请选择节点类别"}]},{default:n(()=>[a(oe,{value:o.nodeKind,"onUpdate:value":t[5]||(t[5]=s=>o.nodeKind=s),type:"role_node_kind",disabled:U.value},null,8,["value","disabled"])]),_:1})]),_:1},512),[[K,!0]])]),_:1}),a(I,null,{default:n(()=>[R(a(S,{span:24},{default:n(()=>[a(k,{label:"排序",name:"sort",labelCol:{class:"detail-label"},rules:[{required:!0,message:"请输入排序"}]},{default:n(()=>[a(_,{value:o.sort,"onUpdate:value":t[6]||(t[6]=s=>o.sort=s),min:1,max:1e4,step:1,precision:0,disabled:m.value},null,8,["value","disabled"])]),_:1})]),_:1},512),[[K,!0]])]),_:1}),a(I,null,{default:n(()=>[R(a(S,{span:24},{default:n(()=>[a(k,{label:"描述",name:"description",labelCol:{class:"detail-label"},rules:[{required:!1}]},{default:n(()=>[a(Ie,{value:o.description,"onUpdate:value":t[7]||(t[7]=s=>o.description=s),maxlength:256,"auto-size":{minRows:2,maxRows:5},disabled:m.value},null,8,["value","disabled"])]),_:1})]),_:1},512),[[K,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","show-btm"]),a(Ye,{onRegister:u(pe)},null,8,["onRegister"]),N.value?(x(),B("div",lt)):F("",!0)],64)}}});const $t=Ne(st,[["__scopeId","data-v-e6edd6d7"]]);export{$t as default};
//# sourceMappingURL=index-2d522596.js.map
