{"version":3,"file":"index-3540054f.js","sources":["../../src/views/bi/safetytools/index.ts","../../src/views/bi/safetytools/index.vue"],"sourcesContent":["import { BasicColumn, FormSchema } from '@/components/Table';\nimport { defHttp } from '@/utils/http/axios';\nimport { useUserStore } from '/@/store/modules/user';\n\nenum Api {\n  getPage = '/bi/safetytools/list',\n  getStation = '/baseset/common/list-station',\n  getOrgInfoUrl = '/bi/common/org/info',\n  exportExcelUrl = '/bi/safetytools/export-excel',\n}\n\nconst getOrgInfoData = (params) =>\n  defHttp.get({ url: Api.getOrgInfoUrl, params }, { isOnlyResult: true });\n\nconst getStation = (params) => {\n  return defHttp.post({ url: Api.getStation, params });\n};\nexport const exportExcel = (params) =>\n  defHttp.post(\n    {\n      url: Api.exportExcelUrl,\n      params,\n      responseType: 'blob',\n    },\n    { isReturnNativeResponse: true },\n  );\n\n// 查询列表\nexport function getPage(params) {\n  return defHttp.post({ url: Api.getPage, params });\n}\n\nexport const columns: BasicColumn[] = [\n  {\n    title: '所属公司',\n    dataIndex: 'stationOrganName',\n    width: 160,resizable: true,\n    align: 'left',headAlign:'center',\n    customCell: (record, index, column) => {\n      return {\n        rowSpan: record.rowSpan,\n      };\n    },ifShow:useUserStore().isMultiOrganization\n  },\n  { title: '电站名称', dataIndex: 'stationName',align: 'left',headAlign:'center', width: 160,resizable: true },\n  { title: '安全工器具数量', dataIndex: 'total',align: 'right',headAlign:'center', width: 160,resizable: true },\n  { title: '检验合格数', dataIndex: 'checkQualified',align: 'right',headAlign:'center',width: 160,resizable: true },\n  { title: '检验不合格数', dataIndex: 'checkUnqualified',align: 'right',headAlign:'center', width: 160,resizable: true },\n  { title: '超期未检数', dataIndex: 'overNotCheck',align: 'right',headAlign:'center', width: 160,resizable: true },\n  { title: '报废数', dataIndex: 'scrapNum',align: 'right',headAlign:'center', width: 160,resizable: true },\n  { title: '报废中', dataIndex: 'scrapNumIng',align: 'right',headAlign:'center', width: 160,resizable: true },\n  { title: '30天内待检数', dataIndex: 'thirtyCheck',align: 'right',headAlign:'center', width: 160,resizable: true },\n  { title: '安全工器具合格率(%)', dataIndex: 'checkRate',align: 'right',headAlign:'center', width: 160,resizable: true },\n];\n\nexport const searchFormSchema: FormSchema[] = [\n  {\n    label: '所属公司',\n    field: 'stationOrganId',\n    component: 'ApiSelect',\n    componentProps: {\n      options: [],\n      api: getOrgInfoData,\n    },\n    colProps: { span: 8 },\n    ifShow:useUserStore().isMultiOrganization\n  },\n  {\n    label: '选择电站',\n    field: 'stationId',\n    component: 'ApiSelect',\n    componentProps: {\n      options: [],\n      api: async () => {\n        const sts = await getStation({});\n        const map: any = [];\n        sts.result.forEach((e) => {\n          map.push({ value: e.powerStationId, label: e.powerStationName });\n        });\n\n        return map;\n      },\n    },\n    colProps: { span: 8 },\n  },\n];\n","<template>\n  <PageWrapper dense contentFullHeight fixedHeight contentClass=\"flex\" style=\"position: relative\">\n    <BasicTable @register=\"registerTable\" \n    @resize-column=\"(w, col) => (col.width = w)\"\n    class=\"w-4/4 xl:w-12/12\">\n      <template #toolbar>\n        <a-button class=\"yellow-btn\" :preIcon=\"IconEnum.EXPORT\" @click=\"handleExport\">{{\n          t('common.action.export')\n        }}</a-button>\n      </template>\n    </BasicTable>\n  </PageWrapper>\n</template>\n\n<script lang=\"ts\" setup>\n  import { BasicTable, useTable } from '@/components/Table';\n\n  import { onMounted } from 'vue';\n\n  import { columns, searchFormSchema, getPage, exportExcel } from './index';\n  import { useMessage } from '/@/hooks/web/useMessage';\n  import { IconEnum } from '@/enums/appEnum';\n  import { exportExcelFile } from '/@/utils/file/download';\n  import { useI18n } from '/@/hooks/web/useI18n';\n  import { urlToPath } from '/@/utils/route';\n\n  let {params} = urlToPath() as any;\n\n  const { t } = useI18n();\n  const { createConfirm, createMessage } = useMessage();\n\n  const [registerTable,{getForm}] = useTable({\n    title: '工器具统计',\n    api: async (e) => {\n      if(params.startDate?.length == 7){\n        params.startDate=params.startDate+\"-01\"\n      }\n      if(params.endDate?.length == 7){\n        params.endDate=params.endDate+\"-01\"\n      }\n      let dataObj = await getPage(e);\n      return dataObj.result;\n    },\n    columns,\n    rowKey: 'id',\n    bordered: true,\n    formConfig: { labelWidth: 120, schemas: searchFormSchema },\n    useSearchForm: true,\n    showTableSetting: true,\n    pagination: false,\n  });\n  function handleExport() {\n    createConfirm({\n      title: t('common.message.confirmTitle'),\n      iconType: 'warning',\n      content: t('common.message.exportMessage'),\n      async onOk() {\n        let filedsValue = getForm().getFieldsValue();\n        filedsValue.filename = '工器具统计报表.xls';\n        filedsValue.excelList = columns;\n        await exportExcel(filedsValue).then((res) => {\n          exportExcelFile(res?.data, filedsValue.filename);\n        });\n        filedsValue.filename = null;\n        filedsValue.excelList = null;\n        createMessage.success(t('common.exportSuccessText'));\n      },\n    });\n  }\n  onMounted(()=>{\n    getForm().setFieldsValue({ ...params });\n})\n</script>\n"],"names":["getOrgInfoData","params","defHttp","getStation","exportExcel","getPage","columns","record","index","column","useUserStore","searchFormSchema","__async","sts","map","e","urlToPath","useI18n","createConfirm","createMessage","useMessage","registerTable","getForm","useTable","_a","_b","handleExport","filedsValue","res","exportExcelFile","onMounted","__spreadValues"],"mappings":"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"}