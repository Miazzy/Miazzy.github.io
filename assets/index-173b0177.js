var v=(K,p,y)=>new Promise((Y,w)=>{var e=r=>{try{C(y.next(r))}catch(m){w(m)}},g=r=>{try{C(y.throw(r))}catch(m){w(m)}},C=r=>r.done?Y(r.value):Promise.resolve(r.value).then(e,g);C((y=y.apply(K,p)).next())});import{B as re}from"./BasicTable-0434a334.js";import{T as ue}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as de}from"./useTable-109483b3.js";import{bB as ce,bC as me,a2 as k}from"./antd-15ac76ed.js";import{au as pe,b as fe,a7 as ve,av as E,ax as ge,az as be,bQ as ye,bR as he,aA as Ie,_ as Te}from"./index.js";import{P as Ce}from"./index-20519caf.js";import{C as _e}from"./CommonTree-c4ed7838.js";import"./index-74ac3212.js";import{_ as L}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{g as xe,f as o,a as U,e as we,b as $,c as ke}from"./emergencyDrill-efa8fbef.js";import{d as Ee,k as i,r as z,ax as De,o as Oe,al as D,Z as b,_ as P,f as n,aa as s,$ as N,a9 as O,ac as M,E as T,F as V,u,J as Me}from"./vue-71d1abb3.js";import{j as Se}from"./Export2Excel-389a8fc9.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";import"./useRender-21ce56fb.js";const Ne={class:"right-table-layout"},Re={class:"tab-button-div"},Be={class:"tab-table-div"},Fe=Ee({__name:"index",setup(K){const p=i(!1),{createConfirm:y,createMessage:Y}=pe(),{t:w}=fe(),e=z({name:null,drillType:null,drillMode:null,startTime:null,endTime:null,status:null,billCode:null}),g=z({searchTime:""}),C=i([]);i({});const r=i({}),m=i([]);i([]);const j=$();De(),i([{label:"草稿",value:"0"},{label:"处理中",value:"1"},{label:"通过",value:"2"},{label:"不通过",value:"3"},{label:"已取消",value:"4"},{label:"已终止",value:"5"},{label:"退回",value:"6"}]);const R=i([]),A=()=>v(this,null,function*(){let a=yield ke(e);return R.value=a.result,a.result}),H={baseColProps:{lg:6,md:8},labelWidth:90,schemas:[]};function W(){J(),p.value=!p.value}const[X,{reload:h,getPaginationRef:G,getForm:Le,redoHeight:J}]=de({title:"应急预案演练列表",api:()=>v(this,null,function*(){const a=G();return e.pageNo=a.current,e.pageSize=a.pageSize,yield A()}),columns:j,useSearchForm:!1,formConfig:H,showTableSetting:!0,bordered:!0,rowKey:"id",rowSelection:{type:"radio",onChange:Q},handleSearchInfoFn(a){return e.status=a.status,e.fileType=a.fileType,e.particularYear=a.particularYear,e.isRectificationCompleted=a.isRectificationCompleted,e.serviceCompany=a.serviceCompany,a},sortFn:a=>{a.order?(e.sortField=a.field,e.sortOrder=a.order.replace("end","")):(e.sortField=null,e.sortOrder=null)}});let B=i("");function Q(a,t){t.length>0?(m.value=[a[0]],B.value=a[0]):(m.value=[],B.value="")}function Z(){return v(this,null,function*(){const a=yield xe({});C.value=a.result,h()})}function ee(){if(o.id="",o.name="",o.drillType="",o.drillMode="",o.commanderId="",o.commanderName="",o.startTime="",o.endTime="",o.totalCount="",o.content="",e.stationId==null){k.error("请先选择电站。");return}e.nodeKindId=="station"&&se(),ge("/po/safety/emergencydrill/create","添加应急预案演练",Me(o))}function q(a){a.status==0||a.status==1,be(a.id)}const ae=a=>v(this,null,function*(){const t=yield U({id:a.id}),{value:_}=yield ye.prompt("请输入取消原因","取消流程",{confirmButtonText:w("common.okText"),cancelButtonText:w("common.cancelText"),inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"取消原因不能为空"});yield he(t.result.processInstanceId,_),k.success("已取消"),h()});function te(){return v(this,null,function*(){if(console.log(m.value),m.value.length!=1)return k.info("请选择一条数据."),!1;const a=yield U({id:m.value[0]});y({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return v(this,null,function*(){if(a.result.status!=0){k.error("非草稿状态不能删除。");return}yield Ie(a.result.processInstanceId),k.success("已删除。"),m.value=[],h()})}})})}function le(){e.name=null,e.drillType=null,e.drillMode=null,e.startTime=null,e.endTime=null,e.status=null,g.searchTime=null,e.billCode=null,h()}function ne(){g.searchTime!=null&&(e.startTime=g.searchTime[0],e.endTime=g.searchTime[1]),h()}function se(){r.value.stationId}function oe(a={}){e.stationId=null,e.stationName=null,e.stationOrganId=null,e.stationOrganName=null,e.nodeKindId=null,r.value.nodeKindId=null,e.searchId=null,a!=null&&(e.stationOrganId=a.organId,e.stationOrganName=a.organName,a.nodeKindId=="station"&&(e.stationId=a.powerStationId,e.stationName=a.name,r.value.stationId=a.powerStationId,o.stationId=e.stationId,o.stationName=e.stationName,o.stationOrganId=e.stationOrganId,o.stationOrganName=e.stationOrganName),e.nodeKindId=a.nodeKindId,r.value.nodeKindId=a.nodeKindId,e.searchId=a.id),h()}function ie(){return v(this,null,function*(){y({title:"导出",iconType:"warning",content:"确定要导出所有记录？",onOk(){return v(this,null,function*(){const t=i({index:"序号"}),_=$(),d=i([]),S=i([]);_.forEach(f=>{f.dataIndex!=="id"&&(t.value[f.dataIndex]=f.title,S.value.push(f.dataIndex))});let I=yield we(e);R.value=I.result,R.value.forEach(function(f,l){let c="";switch(f.status){case 0:c="草稿";break;case 1:c="处理中";break;case 2:c="通过";break;case 3:c="不通过";break;case 4:c="已取消";break;case 5:c="已终止";break;case 6:c="退回/驳回";break}let x=i({index:l+1});S.value.forEach(F=>{x.value[F]=F==="status"?c:f[F]}),d.value.push(x.value)}),Se({data:d.value,header:t.value,filename:"应急预案演练.xlsx"})})}})})}return Oe(()=>{Z(),ve.getInstance().listen("emergencydrill",function(){setTimeout(()=>{h()},500)})}),(a,t)=>{const _=D("a-input"),d=D("a-form-item"),S=D("a-range-picker"),I=D("a-button"),f=D("a-form");return b(),P("div",null,[n(u(Ce),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:s(()=>[n(_e,{title:"电站组织",onSelect:oe,value:C.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),N("div",Ne,[N("div",Re,[n(f,{model:e,name:"searchInfo",layout:"inline",autocomplete:"off",class:"search-form ant-advanced-search-form"},{default:s(()=>[n(d,{name:"billCode",label:"单据编号",labelCol:{span:6},rules:[{required:!1,message:"请输入单据编号"}],style:{width:"26.5%"},colon:!1},{default:s(()=>[n(_,{value:e.billCode,"onUpdate:value":t[0]||(t[0]=l=>e.billCode=l),placeholder:"请输入单据编号",style:{width:"100%"}},null,8,["value"])]),_:1}),n(d,{name:"name",label:"主题",labelCol:{span:6},rules:[{required:!1,message:"请输入主题"}],style:{width:"26.5%"},colon:!1},{default:s(()=>[n(_,{value:e.name,"onUpdate:value":t[1]||(t[1]=l=>e.name=l),placeholder:"请输入主题",style:{width:"100%"}},null,8,["value"])]),_:1}),n(d,{name:"drillMode",label:"演练方式",labelCol:{span:12},rules:[{required:!1,message:"请选择演练方式"}],style:{width:"26.5%"},colon:!1},{default:s(()=>[n(L,{type:"EmergencyDrillMode",onChange:t[2]||(t[2]=l=>"()=> searchInfo.drillMode = value"),value:e.drillMode,"onUpdate:value":t[3]||(t[3]=l=>e.drillMode=l),width:"100%"},null,8,["value"])]),_:1}),p.value?(b(),O(d,{key:0,style:{width:"100%",height:"10px"}})):M("",!0),p.value?(b(),O(d,{key:1,name:"drillType",label:"演练类型",labelCol:{span:12},rules:[{required:!1,message:"请选择演练类型"}],style:{width:"26.5%"},colon:!1},{default:s(()=>[n(L,{type:"EmergencyDrillType",onChange:t[4]||(t[4]=l=>"()=> searchInfo.drillType = value"),value:e.drillType,"onUpdate:value":t[5]||(t[5]=l=>e.drillType=l),width:"100%"},null,8,["value"])]),_:1})):M("",!0),p.value?(b(),O(d,{key:2,name:"startTime",label:"演练时间",labelCol:{span:6},rules:[{required:!1,message:"请选择演练时间"}],style:{width:"26.5%"},colon:!1},{default:s(()=>[n(S,{value:g.searchTime,"onUpdate:value":t[6]||(t[6]=l=>g.searchTime=l),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD 00:00:00",style:{width:"100%"}},null,8,["value"])]),_:1})):M("",!0),p.value?(b(),O(d,{key:3,name:"status",label:"审批状态",labelCol:{span:20},rules:[{required:!1,message:"请选择审批状态"}],style:{width:"26.5%"},colon:!1},{default:s(()=>[n(L,{type:"bpm_process_instance_result",onChange:t[7]||(t[7]=l=>"()=> searchInfo.status = value"),value:e.status,"onUpdate:value":t[8]||(t[8]=l=>e.status=l),width:"100%"},null,8,["value"])]),_:1})):M("",!0),n(d,{class:"search-btns"},{default:s(()=>[n(I,{style:{margin:"0 8px"},onClick:le},{default:s(()=>[T("重置")]),_:1}),n(I,{type:"primary",class:"tab-button",onClick:ne},{default:s(()=>[T("查询")]),_:1}),N("a",{style:{"margin-left":"12px","font-size":"14px"},onClick:W},[p.value?(b(),P(V,{key:0},[T(" 收起 "),n(u(ce))],64)):(b(),P(V,{key:1},[T(" 展开 "),n(u(me))],64))])]),_:1})]),_:1},8,["model"])]),N("div",Be,[n(u(re),{onRegister:u(X),class:"fix-basic-table",onResizeColumn:t[9]||(t[9]=(l,c)=>c.width=l),onRowDbClick:t[10]||(t[10]=l=>q(l))},{toolbar:s(()=>[n(I,{type:"primary",preIcon:u(E).ADD,onClick:ee},{default:s(()=>[T("添加")]),_:1},8,["preIcon"]),n(I,{class:"red-btn",disabled:u(B)=="",preIcon:u(E).DELETE,onClick:te},{default:s(()=>[T("删除")]),_:1},8,["disabled","preIcon"]),n(I,{class:"yellow-btn",preIcon:u(E).EXPORT,onClick:ie},{default:s(()=>[T("导出")]),_:1},8,["preIcon"])]),bodyCell:s(({column:l,text:c,record:x})=>[l.key==="action"?(b(),O(u(ue),{key:0,actions:[{icon:u(E).LOG,label:"进度",onClick:q.bind(null,x)},{icon:u(E).DELETE,danger:!0,label:"取消",ifShow:()=>x.status==0,onClick:ae.bind(null,x)}]},null,8,["actions"])):M("",!0)]),_:1},8,["onRegister"])])])]),_:1})])}}});const fa=Te(Fe,[["__scopeId","data-v-024a105d"]]);export{fa as default};
//# sourceMappingURL=index-173b0177.js.map
