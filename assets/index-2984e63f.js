var n=(k,r,a)=>new Promise((g,x)=>{var d=l=>{try{f(a.next(l))}catch(p){x(p)}},i=l=>{try{f(a.throw(l))}catch(p){x(p)}},f=l=>l.done?g(l.value):Promise.resolve(l.value).then(d,i);f((a=a.apply(k,r)).next())});import{au as A,b as V,a7 as N,av as y,ax as H,az as W,aA as $,_ as K}from"./index.js";import{B as U}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as X}from"./useTable-109483b3.js";import{a2 as b}from"./antd-15ac76ed.js";import{d as Z,ax as j,r as F,k as q,o as G,al as J,Z as I,a9 as Q,aa as c,f as m,u as o,E as _,ad as E,_ as S,F as Y,ac as C}from"./vue-71d1abb3.js";import{P as ee}from"./index-20519caf.js";import{u as te,e as ae,c as oe,s as se,g as ne}from"./monthly-62dfedc7.js";import{e as re}from"./download-03e71dd5.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./useRender-21ce56fb.js";const ie={key:0,style:{color:"#30ca5a"}},le={key:1,style:{color:"#929292"}},ce=Z({__name:"index",setup(k){j();let r=F({}),a=q("");const{createConfirm:g,createMessage:x}=A(),{t:d}=V(),i=F({}),f=()=>n(this,null,function*(){const t=R();let e=v().getFieldsValue();return e.pageNo=t.current,e.pageSize=t.pageSize,e.sortField=i.sortField,e.sortOrder=i.sortOrder,yield ne(e)}),[l,{reload:p,getForm:v,getSelectRows:T,getPaginationRef:R}]=X({title:"月度评价",api:f,rowKey:"id",columns:oe,useSearchForm:!0,showTableSetting:!0,bordered:!0,pagination:{pageSize:20,pageSizeOptions:["20","50","100","200"]},handleSearchInfoFn(t){return t},formConfig:{labelWidth:120,actionColOptions:{span:24},autoAdvancedLine:1,baseColProps:{span:7},schemas:se,autoSubmitOnEnter:!0,noHideBtnFlag:!0},rowSelection:{type:"radio",fixed:!0,onSelect:O},sortFn:t=>{t.order?(i.sortField=t.field,i.sortOrder=t.order.replace("end","")):(i.sortField="",i.sortOrder="")}});function O(t,e){e?(a.value=t.id,r=t):(a.value="",r=null)}function D({keys:t,rows:e}){if(e&&e.length>0){const s=e[0];a.value=s.id,r=s}else a.value="",r=null}const B=()=>n(this,null,function*(){H("/po/integrated/assessmentevaluation/monthly/create","添加月度评价")}),w=t=>n(this,null,function*(){if(r.status==2||r.status==3||r.status==5){let e;g({title:"禁用",iconType:"danger",content:"确认禁用此数据？",onOk(){return n(this,null,function*(){let s={id:a.value,businessStatus:t};te(s).then(()=>{b.success("已禁用。"),p()})})}})}else{b.error("请先完成流程审批。");return}});function L(){return n(this,null,function*(){g({title:"提示",iconType:"warning",content:d("common.message.exportMessage"),onOk(){return n(this,null,function*(){yield ae(v().getFieldsValue()).then(e=>{re(e==null?void 0:e.data,"月度评价.xls")}),x.success(d("common.exportSuccessText"))})}})})}function P(t){W(t.id)}function M(){const t=T();return t.length==0?(b.error("请选择一行数据"),!1):t[0]}function z(){return n(this,null,function*(){g({title:"提示",iconType:"warning",content:d("common.message.delMessage"),onOk(){return n(this,null,function*(){const e=M();if(e.id){if(e.status!=0){b.error("非草稿状态不能删除。");return}yield $(e.processInstanceId),b.success("已删除。"),p()}})}})})}return G(()=>n(this,null,function*(){N.getInstance().listen("monthly-evaluation",p)})),(t,e)=>{const s=J("a-button");return I(),Q(o(ee),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:c(()=>[m(o(U),{class:"fix-basic-table",onRegister:o(l),searchInfo:i,onSelectionChange:D,onResizeColumn:e[2]||(e[2]=(u,h)=>h.width=u),onRowDbClick:e[3]||(e[3]=u=>P(u))},{toolbar:c(()=>[m(s,{type:"primary",preIcon:o(y).ADD,onClick:B},{default:c(()=>[_(E(o(d)("common.action.create")),1)]),_:1},8,["preIcon"]),m(s,{class:"red-btn",disabled:o(a)=="",preIcon:o(y).DELETE,onClick:z},{default:c(()=>[_(E(o(d)("common.delText")),1)]),_:1},8,["disabled","preIcon"]),m(s,{class:"green-btn",preIcon:o(y).ENABLE,disabled:o(a)=="",onClick:e[0]||(e[0]=u=>w(1))},{default:c(()=>[_("启用")]),_:1},8,["preIcon","disabled"]),m(s,{class:"grey-btn",preIcon:o(y).DISABLE,disabled:o(a)=="",onClick:e[1]||(e[1]=u=>w(0))},{default:c(()=>[_("禁用")]),_:1},8,["preIcon","disabled"]),m(s,{class:"yellow-btn",preIcon:o(y).EXPORT,onClick:L},{default:c(()=>[_("导出")]),_:1},8,["preIcon"])]),bodyCell:c(({column:u,text:h,record:de})=>[u.dataIndex==="businessStatusText"?(I(),S(Y,{key:0},[h=="有效"?(I(),S("span",ie,"有效")):C("",!0),h=="无效"?(I(),S("span",le,"无效")):C("",!0)],64)):C("",!0)]),_:1},8,["onRegister","searchInfo"])]),_:1})}}});const Ae=K(ce,[["__scopeId","data-v-261c194e"]]);export{Ae as default};
//# sourceMappingURL=index-2984e63f.js.map
