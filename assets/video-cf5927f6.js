var I=(v,r,h)=>new Promise((n,m)=>{var w=i=>{try{k(h.next(i))}catch(p){m(p)}},s=i=>{try{k(h.throw(i))}catch(p){m(p)}},k=i=>i.done?n(i.value):Promise.resolve(i.value).then(w,s);k((h=h.apply(v,r)).next())});import{P as se}from"./index-20519caf.js";import{C as oe}from"./CommonTree-c4ed7838.js";import{a5 as H,I as b,ar as q,_ as ie}from"./index.js";import{g as V,E as N,d as B,p as ne}from"./flvtools-b93f1fee.js";import{a as D}from"./assign-37f1c13d.js";import{d as de,k as _,r as E,o as ce,t as re,al as $,Z as S,a9 as U,aa as y,f as c,$ as o,ac as G,a5 as R,_ as z,F as ue,ae as ve,ad as C,E as P,u as me,aG as fe,aH as ge}from"./vue-71d1abb3.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./antd-15ac76ed.js";import"./index-3801a970.js";const pe=v=>H.post({url:"/baseset/videoInfo/listVideoTree",params:v},{}),_e=v=>H.get({url:"/baseset/videoInfo/list",params:v},{isOnlyResult:!0}),ye=v=>H.get({url:"/baseset/videoInfo/videoControl",params:v},{}),j=v=>(fe("data-v-5f30fd79"),v=v(),ge(),v),he={class:"right-table-layout"},ke={class:"fix-basic-table"},Ie={class:"tab-button-div"},be=j(()=>o("span",{style:{"padding-left":"10px"}}," 视频 ",-1)),we={class:"video-conference"},Te=["id"],Ce=["id","onClick","onDblclick"],Ve={class:"video-name"},Ne={class:"station-name"},Be={id:"fullView",class:"main-grid-1 hidden"},Se={class:"video-box"},xe=j(()=>o("div",{id:"fullVideo",style:{width:"100%",height:"92vh","background-color":"black"}},null,-1)),Ee={class:"video-name"},Pe={class:"station-name-full"},Le={style:{position:"absolute",right:"20px",bottom:"97px"}},De={style:{display:"flex","flex-direction":"column","align-items":"center"}},$e={style:{height:"20px"}},ze={style:{display:"flex","flex-direction":"column","align-items":"center"}},He={class:"icon-plus",style:{display:"flex","flex-direction":"column","align-items":"center","margin-top":"20px"}},Oe={class:"icon-sub",style:{"flex-direction":"column","margin-top":"10px","text-align":"center"}},Ae={key:0,class:"dialog-mask"},Fe=de({__name:"video",setup(v){let r=0;const h=_([]),n=E({}),m=E({design:"2"}),w=_([]),s=_(),k=_(!1),i=E({}),p=E({}),L=_(null),f=_([]),M=_({}),W=_(!1),x=_(null),Z=()=>I(this,null,function*(){var e,t;if(m.design==3)for(let l=4;l<9;l++){const a=document.getElementById("videoDiv"+l);if((e=a==null?void 0:a.classList)==null||e.remove("hidden"),f.value[l])ne(f.value[l]),yield q(10),a==null||a.click();else{const u=s.value[l],d=[u.id,u.url,u.accessToken,!0,N.HTTP];x.value=V(...d),f.value[l]=x.value}}else for(let l=4;l<9;l++){const a=document.getElementById("videoDiv"+l);(t=a==null?void 0:a.classList)==null||t.add("hidden"),B(f.value[l])}});function J(e){var a,u;D(i,e);var t=document.getElementById("fullView"),l=document.getElementById("gridView");(a=t==null?void 0:t.classList)==null||a.remove("hidden"),(u=l==null?void 0:l.classList)==null||u.add("hidden"),k.value=!0,setTimeout(function(){document.querySelectorAll(".arrowButton").forEach(function(d){d.classList.remove("ant-btn")}),L.value=V("fullVideo",e.url,e.accessToken,!0,N.HTTP)},300)}function Q(e,t){D(p,e),r=t}function X(e,t){B(f.value[t]);const l=V(e.id,e.url,e.accessToken,!0,N.HTTP);f.value[t]=l}function Y(){var l,a;var e=document.getElementById("fullView");(l=e==null?void 0:e.classList)==null||l.add("hidden");var t=document.getElementById("gridView");(a=t==null?void 0:t.classList)==null||a.remove("hidden"),B(L.value),k.value=!1}const T=(e,t)=>{e.direction=t,ye(e)},ee=()=>{Z()},O=()=>I(this,null,function*(){if(yield q(100),s.value&&s.value.length>0){f.value=[];for(let e=0;e<s.value.length;e++){const t=m.design==="3"&&e>=9,l=m.design==="2"&&e>=4;if(!t&&!l){const a=s.value[e],u=[a.id,a.url,a.accessToken,!0,N.HTTP];x.value=V(...u),f.value.push(x.value)}else f.value.push(null)}}}),te=(...t)=>I(this,[...t],function*(e={}){return(yield pe(e)).result.list});function le(){return I(this,arguments,function*(e={}){n.stationId=null,n.stationName=null,n.stationOrganId=null,n.stationOrganName=null,n.nodeKindId=null,n.searchId=null,e!=null&&(n.stationOrganId=e.organId,n.stationOrganName=e.organName,e.nodeKindId!="videoUrl"?(e.nodeKindId=="station"&&(n.stationId=e.powerStationId,n.stationName=e.name),n.nodeKindId=e.nodeKindId,n.searchId=e.id):setTimeout(function(){p.id!=null&&p.id!=""&&e.url!=null&&e.url!=""&&(s.value[r].cameraName=e.name,s.value[r].stationName=e.powerStationName,s.value[r].url=e.url,s.value[r].accessToken=e.accessToken,s.value[r].deviceSerial=e.deviceSerial,s.value[r].channelNo=e.channelNo,s.value[r].id=e.id+new Date,B(f.value[r]),f.value[r]=V(p.id,e.url,e.accessToken,!0,N.HTTP),D(p,s.value[r]))},100)),(e==null||e!=null&&e.nodeKindId!="videoUrl")&&(w.value=yield A(),s.value=w.value.slice(0,9),yield O()),setTimeout(function(){var t;if(document.querySelectorAll(".grid-item").forEach(l=>{F(l)}),m.design==="2")for(let l=4;l<9;l++){const a=document.getElementById("videoDiv"+l);(t=a==null?void 0:a.classList)==null||t.add("hidden")}},100)})}const A=()=>I(this,null,function*(){let e=yield _e(n);return M.value={},e}),ae=()=>{try{const e=[L.value,...f.value];for(let t=0;t<e.length;t++)B(e[t])}catch(e){console.error("destory all player error: ",e)}},F=e=>{e.addEventListener("click",()=>{document.querySelectorAll(".grid-item.selected").forEach(t=>t.classList.remove("selected")),e.classList.add("selected")})};return ce(()=>I(this,null,function*(){h.value=yield te(),w.value=yield A(),s.value=w.value.slice(0,9),yield O(),document.querySelectorAll(".grid-item").forEach(e=>{F(e)}),setTimeout(function(){var e;if(m.design==="2")for(let t=4;t<9;t++){const l=document.getElementById("videoDiv"+t);(e=l==null?void 0:l.classList)==null||e.add("hidden")}},100)})),re(()=>{ae()}),(e,t)=>{const l=$("a-radio-button"),a=$("a-radio-group"),u=$("a-button");return S(),U(me(se),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:y(()=>[c(oe,{title:"电站组织",onSelect:le,value:h.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),o("div",he,[o("div",ke,[o("div",Ie,[be,k.value?G("",!0):(S(),U(a,{key:0,value:m.design,"onUpdate:value":t[0]||(t[0]=d=>m.design=d),"button-style":"solid",onChange:t[1]||(t[1]=d=>ee()),style:{position:"absolute",top:"15px",right:"10px",width:"120px"}},{default:y(()=>[c(l,{value:"2"},{default:y(()=>[c(b,{icon:"ph:squares-four-light",size:"15"})]),_:1}),c(l,{value:"3"},{default:y(()=>[c(b,{icon:"icon-park-outline:grid-nine",size:"15"})]),_:1})]),_:1},8,["value"]))]),o("div",we,[o("div",{id:"gridView",class:R({"main-grid-9":m.design==3,"main-grid-4":m.design==2}),style:{height:"85vh"}},[(S(!0),z(ue,null,ve(s.value,(d,g)=>(S(),z("div",{key:g,id:"videoDiv"+g,class:R(["video-box grid-item",{enlarged:d.enlarged}])},[o("div",{id:s.value[g].id,style:{width:"100%",height:"100%","background-color":"black"},onClick:K=>Q(s.value[g],g),onDblclick:K=>X(s.value[g],g)},null,40,Ce),o("span",Ve,C(s.value[g].cameraName),1),o("span",Ne,C(s.value[g].stationName)+" - "+C(s.value[g].cameraName),1),c(b,{class:"full",icon:"ion:expand",size:"20",onClick:K=>J(s.value[g])},null,8,["onClick"])],10,Te))),128))],2),o("div",Be,[o("div",Se,[xe,o("span",Ee,C(i.cameraName),1),o("span",Pe,C(i.stationName)+" - "+C(i.cameraName),1),c(b,{class:"full",icon:"uil:compress-arrows",size:"20",onClick:t[2]||(t[2]=d=>Y())}),c(b,{class:"background-image",icon:"tabler:direction-arrows",size:"80"}),o("div",Le,[o("div",De,[c(u,{class:"arrowButton",onClick:t[3]||(t[3]=d=>T(i,0))},{default:y(()=>[P("上")]),_:1})]),o("div",$e,[c(u,{class:"arrowButton",onClick:t[4]||(t[4]=d=>T(i,2))},{default:y(()=>[P("左")]),_:1}),c(u,{class:"arrowButton",onClick:t[5]||(t[5]=d=>T(i,3))},{default:y(()=>[P("右")]),_:1})]),o("div",ze,[c(u,{class:"arrowButton",onClick:t[6]||(t[6]=d=>T(i,1))},{default:y(()=>[P("下")]),_:1})]),o("div",He,[c(b,{class:"controlButton",icon:"material-symbols:add",size:"30",style:{display:"inline-block"},onClick:t[7]||(t[7]=d=>T(i,8))})]),o("div",Oe,[c(b,{class:"controlButton",icon:"ant-design:line-outlined",size:"30",style:{display:"inline-block"},onClick:t[8]||(t[8]=d=>T(i,9))})])])])])])])]),W.value?(S(),z("div",Ae)):G("",!0)]),_:1})}}});const Xe=ie(Fe,[["__scopeId","data-v-5f30fd79"]]);export{Xe as default};
//# sourceMappingURL=video-cf5927f6.js.map
