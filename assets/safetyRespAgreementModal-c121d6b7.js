var X=Object.defineProperty;var P=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var F=(r,e,o)=>e in r?X(r,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[e]=o,U=(r,e)=>{for(var o in e||(e={}))ee.call(e,o)&&F(r,o,e[o]);if(P)for(var o of P(e))te.call(e,o)&&F(r,o,e[o]);return r};var g=(r,e,o)=>new Promise((Y,y)=>{var x=l=>{try{d(o.next(l))}catch(D){y(D)}},C=l=>{try{d(o.throw(l))}catch(D){y(D)}},d=l=>l.done?Y(l.value):Promise.resolve(l.value).then(x,C);d((o=o.apply(r,e)).next())});import{d as ae,r as R,k as v,ax as se,u as ne,o as oe,al as c,Z as T,_ as le,f as a,aa as n,$ as M,a9 as ie,ac as q,v as I,A as h}from"./vue-71d1abb3.js";import{b as A,d as re,s as de}from"./safetyRespAgreement-5ce80b14.js";import{W as ue}from"./WfApproveBox-a3448232.js";import{a0 as pe,ak as me,aB as ce,bP as fe,a7 as _e,aC as be}from"./index.js";import{B as ge}from"./BillTitle-d17ab3e4.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import{a2 as ve}from"./antd-15ac76ed.js";import"./index-316f6ffb.js";import"./index-085d06c7.js";import{u as Ie}from"./useTable-109483b3.js";import{_ as he}from"./UploadTable.vue_vue_type_script_setup_true_lang-5478923e.js";import{a as w}from"./assign-37f1c13d.js";import"./useRender-21ce56fb.js";import"./index.esm-c216ed00.js";import"./index-fda2d66c.js";import"./BasicTable-0434a334.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./useWindowSizeFn-13b1b8a2.js";import"./OrganDialog-dd1023ce.js";import"./Dialog-0a006d82.js";import"./index-c0893416.js";import"./index-33af41d1.js";import"./tree-fc0e156a.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";const ye={class:"load"},De={class:"process-box"},we={class:"header-box"},Ce={class:"content"},Me={style:{margin:"5px 16px 20px 10px"}},it=ae({__name:"safetyRespAgreementModal",setup(r){const e=R({spinning:!1}),Y=pe().getUserInfo,y=v([]),x=v(),C=v([]),d=v(!0),l=R({});l.subject="安全责任书",l.infoItems=[];const D=se(),{currentRoute:K}=D;ne(K);const u=me.getInstance().getQuery(),S=v();function k(s){e.spinning=!0;try{s=s||0,S.value.validateFields().then(()=>{e.status=s,de(e).then(t=>{e.id=t,A({id:t}).then(p=>{w(e,p.result)}),ve.success(s==1?"提交成功。":"保存成功"),_e.getInstance().sendMsg("safetyRespAgreement",{}),s==1&&(d.value=!0,be())})})}catch(t){console.log("error",t)}finally{e.spinning=!1}}function O(){k(1)}function $(){k(0)}function V(){re("?stationId="+e.stationId).then(s=>{s.result&&s.result.length>0&&s.result.forEach(t=>{y.value.push({value:t.name,lable:t.userId})})})}function j(s,t){e.signPersonName=t.value,e.signPersonId=t.lable}const z=()=>g(this,null,function*(){E(e.bizFileId)}),E=s=>{const t=["签字扫描件"],p=["scannedCopies"],m={fileKindId:"",filetype:"",bizId:s,maxCount:20,maxSize:20971520,required:!1,readonly:!0},f=[];for(let b=0;b<1;b++){let _=U({},m);_.fileKindId=p[b],_.filetype=t[b],_.readonly=d.value,f.push(_)}C.value=f};w(e,{processInstanceId:"",id:"",billCode:"",fillinDate:"",organId:"",organName:"",deptId:"",deptName:"",positionId:"",positionName:"",personMemberId:"",personMemberName:"",fullId:"",status:0,bizFileId:"",subject:"",finishedDate:"",signPersonId:"",signPersonName:"",signDate:"",startDate:"",endDate:"",content:"",bizStatus:1}),oe(()=>g(this,null,function*(){u.id=yield L(),e.bizStatus=1,yield A({id:u.id}).then(s=>{u.id?(w(e,s.result),e.status==0&&e.personMemberId.substring(0,32)!=Y.userId&&(e.status=10)):(w(e,u),e.spinning=!1,e.status=0,e.billCode=s.result.billCode,e.personMemberName=s.result.personMemberName,e.fillinDate=s.result.fillinDate,e.deptName=s.result.deptName),e.status==1&&(d.value=!0)}),u.id||(d.value=!1),yield W(),V(),e.bizFileId==null||e.bizFileId==null||e.bizFileId==""?Q():z()}));const L=()=>g(this,null,function*(){let s=u.id;if(!s&&u.processInstanceId){const p=(yield ce(u.processInstanceId)).businessKey;u.id=p,s=p}return s}),W=()=>g(this,null,function*(){d.value=e.status!=0,l.title="安全责任书",e.processInstanceId=u.processInstanceId;let{billCode:s,fillinDate:t,personMemberName:p,deptName:m}=e;w(l,{billCode:s,fillinDate:t,personMemberName:p,deptName:m})}),Q=()=>g(this,null,function*(){fe().then(s=>{e.bizFileId=s,z()})}),Z=v([]);return Ie({columns:[{title:"附件类型",dataIndex:"fileType",align:"left",width:150},{title:"附件",dataIndex:"bizFileId",align:"left",width:600}],pagination:!1,showIndexColumn:!1,showTableSetting:!1,tableSetting:{fullScreen:!0},dataSource:Z}),(s,t)=>{const p=c("a-input"),m=c("a-form-item"),f=c("a-col"),b=c("a-select"),_=c("a-row"),N=c("a-date-picker"),G=c("a-textarea"),B=c("a-card"),H=c("a-form"),J=c("a-spin");return T(),le("div",ye,[a(J,{spinning:e.spinning,tip:"Loading..."},{default:n(()=>[M("div",De,[M("div",we,[a(ge,{options:l},null,8,["options"]),e.status!=10?(T(),ie(ue,{key:0,onSave:$,onSubmit:O,processInstanceId:e.processInstanceId,processStatus:e.status},null,8,["processInstanceId","processStatus"])):q("",!0)]),M("div",Ce,[a(H,{ref_key:"formRef",ref:S,model:e,labelAlign:"right",autocomplete:"off"},{default:n(()=>[a(B,{title:"基本信息",bordered:!1},{default:n(()=>[a(_,{gutter:24},{default:n(()=>[I(a(f,{span:12},{default:n(()=>[a(m,{name:"stationName",label:"电站名称",labelCol:{span:6},rules:[{required:!0,message:"请输入电站名称"}]},{default:n(()=>[a(p,{disabled:"",value:e.stationName,"onUpdate:value":t[0]||(t[0]=i=>e.stationName=i),placeholder:"请输入电站名称"},null,8,["value"]),q("",!0)]),_:1})]),_:1},512),[[h,!0]]),I(a(f,{span:12},{default:n(()=>[a(m,{name:"signPersonName",label:"签订人",labelCol:{span:6},rules:[{required:!0,message:"请选择签订人"}]},{default:n(()=>[a(b,{value:e.signPersonName,"onUpdate:value":t[2]||(t[2]=i=>e.signPersonName=i),"show-search":"","allow-clear":"",style:{width:"100%"},placeholder:"请选择签订人",options:y.value,onChange:j,disabled:e.status!=0},null,8,["value","options","disabled"])]),_:1})]),_:1},512),[[h,!0]])]),_:1}),a(_,{gutter:24},{default:n(()=>[I(a(f,{span:12},{default:n(()=>[a(m,{name:"signDate",label:"签订日期",labelCol:{span:6},rules:[{required:!0,message:"请选择签订日期"}]},{default:n(()=>[a(N,{value:e.signDate,"onUpdate:value":t[3]||(t[3]=i=>e.signDate=i),"value-format":"YYYY-MM-DD",format:"YYYY-MM-DD",style:{"min-width":"100%"},disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[h,!0]]),I(a(f,{span:12},{default:n(()=>[a(m,{name:"startDate",label:"责任期起",labelCol:{span:6},rules:[{required:!0,message:"请选择责任期起"}]},{default:n(()=>[a(N,{value:e.startDate,"onUpdate:value":t[4]||(t[4]=i=>e.startDate=i),"value-format":"YYYY-MM-DD",format:"YYYY-MM-DD",style:{"min-width":"100%"},disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[h,!0]])]),_:1}),a(_,{gutter:24},{default:n(()=>[I(a(f,{span:12},{default:n(()=>[a(m,{name:"endDate",label:"责任期止",labelCol:{span:6},rules:[{required:!0,message:"请选择责任期止"}]},{default:n(()=>[a(N,{value:e.endDate,"onUpdate:value":t[5]||(t[5]=i=>e.endDate=i),"value-format":"YYYY-MM-DD",format:"YYYY-MM-DD",style:{"min-width":"100%"},disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[h,!0]])]),_:1}),a(_,{gutter:24},{default:n(()=>[I(a(f,{span:24},{default:n(()=>[a(m,{name:"content",label:"安全目标",labelCol:{span:3},rules:[{required:!0,message:"请输入安全目标"}]},{default:n(()=>[a(G,{value:e.content,"onUpdate:value":t[6]||(t[6]=i=>e.content=i),row:"8","show-count":"",style:{height:"200px"},disabled:d.value,maxlength:1e3},null,8,["value","disabled"])]),_:1})]),_:1},512),[[h,!0]])]),_:1})]),_:1}),a(B,{title:"上传附件",bordered:!1},{default:n(()=>[M("div",Me,[a(he,{ref_key:"uploadTable",ref:x,rows:C.value,colwidths:["15%","70%","15%"],application:"po",module:"safetyRespAgreement",mode:e.status==0?"normal":"view"},null,8,["rows","mode"])])]),_:1})]),_:1},8,["model"])])])]),_:1},8,["spinning"])])}}});export{it as default};
//# sourceMappingURL=safetyRespAgreementModal-c121d6b7.js.map
