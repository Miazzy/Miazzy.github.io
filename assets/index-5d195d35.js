var L=(i,B,d)=>new Promise((S,m)=>{var C=u=>{try{l(d.next(u))}catch(y){m(y)}},R=u=>{try{l(d.throw(u))}catch(y){m(y)}},l=u=>u.done?S(u.value):Promise.resolve(u.value).then(C,R);l((d=d.apply(i,B)).next())});import{a5 as w,K as ae,I as oe,aa as ne,ab as le,_ as ie}from"./index.js";import{g as ce}from"./monitorApi-44e70004.js";import de from"./infoDialog-f9501edb.js";import{d as re,k as p,r as Z,e as ue,o as _e,al as A,Z as x,_ as M,$ as e,f as g,aa as f,E as V,a6 as D,ad as c,F as z,ae as U,a5 as b,aG as ve,aH as pe}from"./vue-71d1abb3.js";import"./antd-15ac76ed.js";import"./Dialog-0a006d82.js";const he=i=>w.get({url:"/monitor/driving-recorder-real-status/getRealStatusCount",params:i},{isOnlyResult:!0}),ge=i=>w.get({url:"/monitor/driving-recorder-real-status/list",params:i},{isOnlyResult:!0}),fe=i=>w.get({url:"/monitor/ele-work-card-real-status/getRealStatusCount",params:i},{isOnlyResult:!0}),me=i=>w.get({url:"/monitor/ele-work-card-real-status/list",params:i},{isOnlyResult:!0}),ye=i=>w.get({url:"/monitor/inspection-instrument-real-status/getRealStatusCount",params:i},{isOnlyResult:!0}),xe=i=>w.get({url:"/monitor/inspection-instrument-real-status/list",params:i},{isOnlyResult:!0}),Me={ewc:{online:"/images/work_card_online.svg",leave:"/images/work_card_leave.svg",offline:"/images/work_card_offline.svg"},dr:{online:"/images/dashcam_online.svg",leave:"/images/dashcam_leave.svg",offline:"/images/dashcam_offline.svg"},ii:{online:"/images/itinerant_detector_online.svg",leave:"/images/itinerant_detector_leave.svg",offline:"/images/itinerant_detector_offline.svg"}},r=i=>(ve("data-v-3adb4809"),i=i(),pe(),i),be={class:"satellite-map"},we=r(()=>e("div",{id:"map-container",class:"map-container"},null,-1)),Se={class:"map-mode-toggle-box"},ke=r(()=>e("i",{class:"iconfont btn-icon icon-pingmianditu"},null,-1)),Le=r(()=>e("i",{class:"iconfont btn-icon icon-weixingditu"},null,-1)),Ae={class:"device-data-panel"},Be={class:"search-box"},Ce={class:"collapse-box"},Re={class:"collapse-header"},Pe={class:"device-type-box"},Ie=r(()=>e("div",{class:"device-icon icon1"},null,-1)),Ne={class:"device-text"},Ge=r(()=>e("span",{style:{"margin-right":"7px"}},"电子工牌",-1)),Te={class:"device-status-box"},Oe={class:"device-status-data online"},Ee=r(()=>e("span",{style:{"margin-right":"7px"}},"在线",-1)),$e={class:"device-status-data offline"},De=r(()=>e("span",{style:{"margin-right":"7px"}},"离线",-1)),ze={class:"collapse-content"},Ue={class:"device-list"},Fe=["onClick"],He=["title"],Ke={class:"collapse-header"},Ze={class:"device-type-box"},Ve=r(()=>e("div",{class:"device-icon icon2"},null,-1)),je={class:"device-text"},We=r(()=>e("span",{style:{"margin-right":"7px"}},"行车记录仪",-1)),qe={class:"device-status-box"},Je={class:"device-status-data online"},Qe=r(()=>e("span",{style:{"margin-right":"7px"}},"在线",-1)),Xe={class:"device-status-data offline"},Ye=r(()=>e("span",{style:{"margin-right":"7px"}},"离线",-1)),et={class:"collapse-content"},tt={class:"device-list"},st=["onClick"],at=["title"],ot={class:"collapse-header"},nt={class:"device-type-box"},lt=r(()=>e("div",{class:"device-icon icon3"},null,-1)),it={class:"device-text"},ct=r(()=>e("span",{style:{"margin-right":"7px"}},"巡检仪",-1)),dt={class:"device-status-box"},rt={class:"device-status-data online"},ut=r(()=>e("span",{style:{"margin-right":"7px"}},"在线",-1)),_t={class:"device-status-data offline"},vt=r(()=>e("span",{style:{"margin-right":"7px"}},"离线",-1)),pt={class:"collapse-content"},ht={class:"device-list"},gt=["onClick"],ft=["title"],mt=re({__name:"index",setup(i){const B=ae(),d=p(),S=p(!1),m=p([]),C=p([]),R=p(""),l=Z({ewc:{total:0,online:0,offline:0,selectedIndex:-1},dr:{total:0,online:0,leave:0,offline:0,selectedIndex:-1},ii:{total:0,online:0,leave:0,offline:0,selectedIndex:-1}}),u=p([]),y=p([]),N=p([]),j=Z({ewc:"电子工牌信息",dr:"行车记录仪及车辆信息",ii:"巡检仪信息"}),P=p(""),I=p({fileUrl:""}),W={BMAP_NORMAL_MAP,BMAP_EARTH_MAP},k=p(""),q=()=>{d.value=new BMapGL.Map("map-container"),d.value.enableScrollWheelZoom(!0),B.getDarkMode==="dark"?(k.value="BMAP_EARTH_MAP",d.value.setMapType(BMAP_EARTH_MAP)):(k.value="BMAP_NORMAL_MAP",d.value.setMapType(BMAP_NORMAL_MAP)),d.value.centerAndZoom(new BMapGL.Point(112,34),5);let s=new BMapGL.ZoomControl;d.value.addControl(s)},J=(s,o)=>{let t={position:s,offset:new BMapGL.Size(10,-40)},n=new BMapGL.Label(o,t);return n.setStyle({width:"auto !important",color:"white",fontSize:"12px",backgroundColor:"rgba(0,0,0)",border:0,padding:"10px",borderRadius:"4px"}),n},Q=(s,o)=>L(this,null,function*(){let t="";o==="ewc"?t=s.userId:o==="dr"&&(t=s.bizFileId);const n=yield ne({bizId:t});if(!n||n.length===0)return"";let h;if(o==="dr"){for(let _=0;_<n.length;_++)if(n[_].fileKindId==="picture"){h=n[_].url;break}}else h=n[0].url;return le(h)}),F=(s,o,t)=>{let n=new BMapGL.Icon(Me[t][o.status],new BMapGL.Size(30,44),{anchor:new BMapGL.Size(15,44)}),h=new BMapGL.Marker(s,{icon:n});d.value.addOverlay(h),h.onclick=()=>L(this,null,function*(){S.value=!0;const $=yield Q(o,t);P.value=t,I.value=o,I.value.fileUrl=$,I.value.mapMode=k.value});const _=J(s,o.stationShortName);h.onmouseover=()=>{d.value.addOverlay(_)},h.onmouseout=()=>{d.value.removeOverlay(_)}},G=(s,o)=>L(this,null,function*(){s!=null&&s.length&&s.forEach(t=>{if(t.status==="online"){const n=new BMapGL.Point(t.longitude,t.latitude);F(n,t,o)}})}),X=()=>L(this,null,function*(){const s=yield ce({});s!=null&&s.length&&(C.value=s)}),Y=s=>{m.value=s},T=ue(()=>B.getDarkMode==="dark"?"border-radius: 2px; background: rgba(7,59,109,0.5); border: 1px solid rgba(255,255,255,0.1); margin-bottom: 10px;":"border-radius: 2px; background: #E3F2FF; border: 1px solid #EBEBEB; margin-bottom: 10px;"),ee=()=>({stationId:m.value.join(",")}),H=()=>{const s=ee();fe(s).then(t=>{l.ewc=t}),he(s).then(t=>{l.dr=t}),ye(s).then(t=>{l.ii=t}),u.value=[],y.value=[],N.value=[],d.value.clearOverlays();let o=new BMapGL.Geocoder;me(s).then(t=>{O(o,t),u.value=t,G(t,"ewc")}),ge(s).then(t=>{O(o,t),y.value=t,G(t,"dr")}),xe(s).then(t=>{O(o,t),N.value=t,G(t,"ii")})},O=(s,o)=>{o.forEach(t=>{s.getLocation(new BMapGL.Point(t.longitude,t.latitude),function(n){n&&(t.address=n.address)})})},E=(s,o,t)=>{l[t].selectedIndex=o;const n=new BMapGL.Point(s.longitude,s.latitude);d.value.centerAndZoom(n,14),F(n,s,t)},te=()=>{H()},se=s=>{d.value.setMapType(W[s.target.value])};return _e(()=>{q(),X(),H()}),(s,o)=>{const t=A("a-radio-button"),n=A("a-radio-group"),h=A("a-select"),_=A("a-collapse-panel"),$=A("a-collapse");return x(),M("div",be,[we,e("div",Se,[g(n,{value:k.value,"onUpdate:value":o[0]||(o[0]=a=>k.value=a),onChange:se},{default:f(()=>[g(t,{value:"BMAP_NORMAL_MAP"},{default:f(()=>[ke,V("平面 ")]),_:1}),g(t,{value:"BMAP_EARTH_MAP"},{default:f(()=>[Le,V("卫星 ")]),_:1})]),_:1},8,["value"])]),e("div",Ae,[e("div",Be,[g(h,{style:{width:"100%"},value:m.value,"onUpdate:value":o[1]||(o[1]=a=>m.value=a),mode:"multiple","show-search":"",options:C.value,fieldNames:{value:"id",label:"name"},onChange:Y,maxTagCount:2,maxTagTextLength:10,placeholder:"请选择电站"},null,8,["value","options"]),g(oe,{class:"search-icon",onClick:te,icon:"ant-design:search-outlined"})]),e("div",Ce,[g($,{activeKey:R.value,"onUpdate:activeKey":o[2]||(o[2]=a=>R.value=a),expandIconPosition:"right",accordion:""},{default:f(()=>[g(_,{key:"1",forceRender:"",style:D(T.value)},{header:f(()=>[e("div",Re,[e("div",Pe,[Ie,e("div",Ne,[Ge,e("span",null,c(l.ewc.total),1)])]),e("div",Te,[e("div",Oe,[Ee,e("span",null,c(l.ewc.online),1)]),e("div",$e,[De,e("span",null,c(l.ewc.offline),1)])])])]),default:f(()=>[e("div",ze,[e("div",Ue,[(x(!0),M(z,null,U(u.value,(a,v)=>(x(),M("div",{key:v,onClick:K=>E(a,v,"ewc"),class:b(["device-item",l.ewc.selectedIndex===v?"selected":null])},[e("div",{class:"device-name",title:`${a.stationShortName}-${a.userName}`},c(a.stationShortName)+"-"+c(a.userName),9,He),e("div",{class:b(`device-status-data ${a.status}`)},c(a.statusText),3)],10,Fe))),128))])])]),_:1},8,["style"]),g(_,{key:"2",forceRender:"",style:D(T.value)},{header:f(()=>[e("div",Ke,[e("div",Ze,[Ve,e("div",je,[We,e("span",null,c(l.dr.total),1)])]),e("div",qe,[e("div",Je,[Qe,e("span",null,c(l.dr.online),1)]),e("div",Xe,[Ye,e("span",null,c(l.dr.offline),1)])])])]),default:f(()=>[e("div",et,[e("div",tt,[(x(!0),M(z,null,U(y.value,(a,v)=>(x(),M("div",{key:v,onClick:K=>E(a,v,"dr"),class:b(["device-item",l.dr.selectedIndex===v?"selected":null])},[e("div",{class:"device-name",title:`${a.stationShortName}-${a.plateNumber}`},c(a.stationShortName)+"-"+c(a.plateNumber),9,at),e("div",{class:b(`device-status-data ${a.status}`)},c(a.statusText),3)],10,st))),128))])])]),_:1},8,["style"]),g(_,{key:"3",forceRender:"",style:D(T.value)},{header:f(()=>[e("div",ot,[e("div",nt,[lt,e("div",it,[ct,e("span",null,c(l.ii.total),1)])]),e("div",dt,[e("div",rt,[ut,e("span",null,c(l.ii.online),1)]),e("div",_t,[vt,e("span",null,c(l.ii.offline),1)])])])]),default:f(()=>[e("div",pt,[e("div",ht,[(x(!0),M(z,null,U(N.value,(a,v)=>(x(),M("div",{key:v,onClick:K=>E(a,v,"ii"),class:b(["device-item",l.ii.selectedIndex===v?"selected":null])},[e("div",{class:"device-name",title:`${a.stationShortName}-${a.deviceName}`},c(a.stationShortName)+"-"+c(a.deviceName),9,ft),e("div",{class:b(`device-status-data ${a.status}`)},c(a.statusText),3)],10,gt))),128))])])]),_:1},8,["style"])]),_:1},8,["activeKey"])])]),g(de,{title:j[P.value],type:P.value,infoData:I.value,height:P.value==="ii"?290:500,visible:S.value,"onUpdate:visible":o[3]||(o[3]=a=>S.value=a)},null,8,["title","type","infoData","height","visible"])])}}});const Lt=ie(mt,[["__scopeId","data-v-3adb4809"]]);export{Lt as default};
//# sourceMappingURL=index-5d195d35.js.map
