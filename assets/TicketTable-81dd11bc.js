var _=(f,D,t)=>new Promise((k,u)=>{var w=o=>{try{m(t.next(o))}catch(g){u(g)}},v=o=>{try{m(t.throw(o))}catch(g){u(g)}},m=o=>o.done?k(o.value):Promise.resolve(o.value).then(w,v);m((t=t.apply(f,D)).next())});import{b as ee,ax as te,at as ae,_ as oe}from"./index.js";import{D as ne}from"./Dialog-0a006d82.js";import{B as M}from"./BasicTable-0434a334.js";import{T as re}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as P}from"./useTable-109483b3.js";import{bC as B}from"./antd-15ac76ed.js";import{t as se,i as ie,j as ce,k as le}from"./workorder.data-e18a6fd9.js";import{d as ue,k as b,r as de,o as me,w as pe,al as I,Z as c,_ as O,f as d,aa as a,a9 as T,F as N,ae as K,E as C,ad as x,u as l,ac as R}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useRender-21ce56fb.js";const fe=ue({__name:"TicketTable",props:{formState:{type:Object,required:!0,default:function(){return{fault:{}}}},disabledProcessInput:Boolean,activeKey:String},setup(f,{expose:D}){const t=f,{t:k}=ee(),u=b(!1),w=b(),v=b(),m=de({}),o=b({operationticket:"操作票",firstworkticket:"电气第一种工作票",secondworkticket:"电气第二种工作票"}),g=b(0),S=b(t.activeKey||""),[j,{getDataSource:$,insertTableDataRecord:F,deleteTableDataRecord:z}]=P({dataSource:v,columns:se,pagination:!1,striped:!1,useSearchForm:!1,showTableSetting:!1,bordered:!0,showIndexColumn:!0,canResize:!1,target:"#more-tab-content",targetTabKey:"2",targetTabValue:S,actionColumn:{width:80,title:k("common.operate"),dataIndex:"action",ifShow:!t.disabledProcessInput}}),V=()=>_(this,null,function*(){const e=yield ie({orderId:t.formState.id});v.value=e.result}),A=()=>_(this,null,function*(){const e=m.type;if(t.formState.isInvoicing==0||!e)return[];const n=q(),p={stationId:t.formState.stationId,pageNo:n.current,pageSize:n.pageSize,sortField:"fillinDate",sortOrder:"desc"};return(yield le(e,p)).result}),[E,{setColumns:L,getPaginationRef:q,getSelectRows:H,clearSelectedRowKeys:U,reload:Z}]=P({api:A,pagination:!0,striped:!1,useSearchForm:!1,showTableSetting:!1,bordered:!0,showIndexColumn:!0,canResize:!0,rowSelection:{type:"checkbox"}}),G=e=>{const n=`${k("common.action.create")}${o.value[e.key]}`;te(`/po/ticket/${e.key}/create?stationId=${t.formState.stationId}&stationName=${t.formState.stationName}&stationOrganId=${t.formState.stationOrganId}&stationOrganName=${t.formState.stationOrganName}`,n)},J=e=>_(this,null,function*(){u.value=!0,g.value=e.item.sort+1,w.value=`关联${o.value[e.key]}`;const n=yield ce(e.key);L(n),m.type=e.key,Z()});function Q(e){z(e.key)}function W(){const e=H();if(e.length==0){ae.getInstance().warning("请选择关联数据");return}X(e),U(),u.value=!1}function X(e){const n=[],p=$(),y=g.value;e.forEach((r,h)=>{for(let i=0;i<p.length;i++)if(p[i].workTicketId===r.id)return;const s={workTicketId:r.id,workTicketBillCode:r.billCode,workTicketCode:r.ticketNumber,checkResult:r.result,checkResultText:r.resultText,workTicketStatus:r.status,workTicketStatusText:r.statusText,workTicketSort:y,isNew:!0,key:`${h}_${Date.now()}`};n.push(s)}),F(n)}return me(()=>_(this,null,function*(){V()})),D({getTicketDataSource:$}),pe(()=>t.activeKey,e=>{S.value=e||""}),(e,n)=>{const p=I("a-menu-item"),y=I("a-menu"),r=I("a-button"),h=I("a-dropdown");return c(),O(N,null,[d(l(M),{onRegister:l(j)},{toolbar:a(()=>[!f.disabledProcessInput&&S.value==="2"?(c(),T(h,{key:0},{overlay:a(()=>[d(y,{onClick:G},{default:a(()=>[(c(!0),O(N,null,K(o.value,(s,i)=>(c(),T(p,{key:i},{default:a(()=>[C(x(s),1)]),_:2},1024))),128))]),_:1})]),default:a(()=>[d(r,{type:"primary"},{default:a(()=>[C(x(l(k)("common.action.create"))+" ",1),d(l(B))]),_:1})]),_:1})):R("",!0),!f.disabledProcessInput&&S.value==="2"?(c(),T(h,{key:1},{overlay:a(()=>[d(y,{onClick:J},{default:a(()=>[(c(!0),O(N,null,K(o.value,(s,i,Y)=>(c(),T(p,{key:i,sort:Y},{default:a(()=>[C(x(s),1)]),_:2},1032,["sort"]))),128))]),_:1})]),default:a(()=>[d(r,{type:"primary"},{default:a(()=>[C(x("关联")+" "),d(l(B))]),_:1})]),_:1})):R("",!0)]),bodyCell:a(({column:s,record:i})=>[s.dataIndex==="action"?(c(),T(l(re),{key:0,actions:[{tooltip:l(k)("common.delText"),color:"error",icon:"ant-design:delete-outlined",ifShow:!f.disabledProcessInput,onClick:Q.bind(null,i)}]},null,8,["actions"])):R("",!0)]),_:1},8,["onRegister"]),d(ne,{visible:u.value,"onUpdate:visible":n[0]||(n[0]=s=>u.value=s),title:w.value,onOk:W,height:520,"force-render":""},{default:a(()=>[u.value?(c(),T(l(M),{key:0,class:"table-in-dialog",onRegister:l(E),searchInfo:m,maxHeight:340},null,8,["onRegister","searchInfo"])):R("",!0)]),_:1},8,["visible","title"])],64)}}});const Ve=oe(fe,[["__scopeId","data-v-c70fac89"]]);export{Ve as default};
//# sourceMappingURL=TicketTable-81dd11bc.js.map
