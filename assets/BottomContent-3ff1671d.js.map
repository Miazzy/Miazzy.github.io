{"version":3,"file":"BottomContent-3ff1671d.js","sources":["../../src/views/da/cockpit/operation/BottomContent.vue"],"sourcesContent":["<template>\n  <div class=\"bottom-content\" :key=\"instanceKey\">\n    <div class=\"left-section section-box\">\n      <div class=\"section-bg\">\n        <SubtitleBar :subtitle=\"`两票统计`\">\n          <a-select\n            v-model:value=\"formState.ticket\"\n            :options=\"dimensionTypeData\"\n            @change=\"handleDimensionTypeChange\"\n            style=\"width: 1.2rem\"\n            v-show=\"dimensionTypeData.length > 1\"\n          />\n        </SubtitleBar>\n        <IndicatorGroup\n          :data=\"ticketData\"\n          :style=\"tabStatus === 'on' ? 'margin-top: -0.15rem' : 'margin-top: -0.2rem'\"\n          class=\"indicator-group-layout\"\n          :class=\"tabStatus === 'on' ? '' : 'fix-indicator-group-padding'\"\n          @click-item=\"toBiReport('ticket')\"\n        />\n        <div style=\"width: 100%; height: 2rem\">\n          <div style=\"margin-left: 0.16rem; transform: scale(0.85); transform-origin: 0 0\">\n            <EchartLineBarChart\n              :data=\"ticketChartData\"\n              :colors=\"ticketChartData.colors\"\n              :width=\"`36.14vw`\"\n              :height=\"tabStatus === 'on' ? `34.8vh` : `39vh`\"\n              :category=\"ticketChartData.categories\"\n              ybgcolor=\"#01B7D730\"\n              :name=\"ticketChartSeriesName\"\n              @click-item=\"ticketCharToBiReport\"\n              :dataZoomDisabled=\"false\"\n              :dataZoomMaxValueSpan=\"ticketChartData.categories.length\"\n              :dataZoomDefaultValueRange=\"ticketChartData.dataZoomDefaultValueRange\"\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"middle-section section-box\">\n      <div class=\"section-bg\">\n        <SubtitleBar :subtitle=\"`缺陷统计`\">\n          <a-select\n            v-model:value=\"formState.defect\"\n            :options=\"dimensionTypeData\"\n            @change=\"handleDefectChange\"\n            style=\"width: 1.2rem\"\n            v-show=\"dimensionTypeData.length > 1\"\n          />\n        </SubtitleBar>\n        <IndicatorGroup\n          :data=\"defectData\"\n          :style=\"tabStatus === 'on' ? 'margin-top: -0.15rem' : 'margin-top: -0.2rem'\"\n          class=\"indicator-group-layout2\"\n          :class=\"tabStatus === 'on' ? '' : 'fix-indicator-group-padding'\"\n          @click-item=\"toBiReport('defect')\"\n        />\n        <div style=\"width: 100%; height: 2rem\">\n          <div style=\"margin-left: 0.16rem; transform: scale(0.85); transform-origin: 0 0\">\n            <EchartPillarChart\n              :data=\"defectChartData\"\n              :colors=\"defectChartData.colors\"\n              :width=\"`36.14vw`\"\n              :height=\"tabStatus === 'on' ? `34.8vh` : `39vh`\"\n              :name=\"defectChartSeriesName\"\n              @click-item=\"defectCharToBiReport\"\n              :dataZoomDefaultValueRange=\"defectChartData.dataZoomDefaultValueRange\"\n              :dataZoomDisabled=\"false\"\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"right-section section-box\">\n      <div class=\"section-bg\">\n        <SubtitleBar :subtitle=\"`隐患统计`\">\n          <a-select\n            v-model:value=\"formState.hidden\"\n            :options=\"dimensionTypeData\"\n            @change=\"handleHiddenChange\"\n            style=\"width: 1.2rem\"\n            v-show=\"dimensionTypeData.length > 1\"\n          />\n        </SubtitleBar>\n        <IndicatorGroup\n          :data=\"hiddenData\"\n          :style=\"tabStatus === 'on' ? 'margin-top: -0.15rem' : 'margin-top: -0.2rem'\"\n          class=\"indicator-group-layout2\"\n          :class=\"tabStatus === 'on' ? '' : 'fix-indicator-group-padding'\"\n          @click-item=\"toBiReport('hidden')\"\n        />\n        <div style=\"width: 100%; height: 2rem\">\n          <div style=\"margin-left: 0.16rem; transform: scale(0.85); transform-origin: 0 0\">\n            <EchartPillarChart\n              :data=\"hiddenChartData\"\n              :category=\"hiddenChartData.categories\"\n              :colors=\"hiddenChartData.colors\"\n              :width=\"`36.14vw`\"\n              :height=\"tabStatus === 'on' ? `34.8vh` : `39vh`\"\n              :name=\"hiddenChartSeriesName\"\n              @click-item=\"hiddenCharToBiReport\"\n              :dataZoomDefaultValueRange=\"hiddenChartData.dataZoomDefaultValueRange\"\n              :dataZoomDisabled=\"false\"\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\n  import { ref, onMounted, defineProps, watch, reactive, UnwrapRef } from 'vue';\n  import SubtitleBar from '/@/components/Framework/Chart/SubtitleBar.vue';\n  import IndicatorGroup from '/@/components/Framework/Chart/IndicatorGroup.vue';\n  import EchartLineBarChart from '/@/components/Framework/Chart/EchartLineBarChart.vue';\n  import EchartPillarChart from '/@/components/Framework/Chart/EchartPillarChart.vue';\n  import { handleRouteChange } from '../../utils';\n  import * as OperationApi from '@/api/da/cockpit/operation';\n  import { assign } from 'lodash-es';\n  import * as CommonApi from '@/api/da/common';\n  import { buildUUID } from '@/utils/uuid';\n\n  //搜索参数\n  const searchInfo: UnwrapRef<any> = reactive({});\n  const props = defineProps({\n    searchInfoByTime: { type: Object, default: {} },\n    tabStatus: { type: String, default: '' },\n  });\n  const instanceKey = ref(buildUUID());\n  const formState = reactive({\n    ticket: 'station',\n    defect: 'station',\n    hidden: 'station',\n  });\n\n  const dimensionTypeData: any = ref([\n    // { label: '电站维度', value: 'station' },\n    // { label: '公司维度', value: 'company' },\n    // { label: '运维维度', value: 'operation' },\n  ]);\n\n  watch(\n    () => props.searchInfoByTime,\n    (value) => {\n      assign(searchInfo, value);\n      doTwoTicketStat(formState.ticket);\n      doDefectStat(formState.defect);\n      doHiddenStat(formState.hidden);\n    },\n  );\n\n  onMounted(async () => {\n    const sts = await CommonApi.getDictDataMap({ dictType: 'cockpit_three_dimension' });\n    sts.result.forEach((e) => {\n      dimensionTypeData.value.push({ value: e.value, label: e.label });\n    });\n  });\n\n  // ==================================两票统计 begin ======================================\n\n  const ticketData = ref({});\n  const ticketChartData = ref({\n    barData: [[], [], []],\n    categories: [],\n    colors: [\n      ['#488FF6', '#60D1F3'],\n      ['#078C5D', '#68E4B8'],\n      ['#E59837', '#FAE895'],\n      ['#e59837', '#fae895'],\n      ['#078C5D', '#68E4B8'],\n    ],\n    dataZoomDefaultValueRange: [0, 4],\n  });\n  const ticketChartSeriesName = [['操作票（张）', '电气一票（张）', '电气二票（张）']];\n  const doTwoTicketStat = async (value) => {\n    const twoTicketStat = await OperationApi.twoTicketStat({\n      dimension: value,\n      startMonth: searchInfo.startMonth,\n      endMonth: searchInfo.endMonth,\n    });\n    if (twoTicketStat) {\n      ticketData.value = [\n        { label: '电气一票(张)', value: twoTicketStat.firstCount },\n        { label: '电气二票(张)', value: twoTicketStat.secondCount },\n        { label: '操作票(张)', value: twoTicketStat.operateCount },\n      ];\n      ticketChartData.value.barData = twoTicketStat.barData || [];\n      ticketChartData.value.categories = twoTicketStat.categories || [];\n    }\n  };\n  const handleDimensionTypeChange = (value) => {\n    doTwoTicketStat(value);\n  };\n\n  // ==================================缺陷统计 begin ======================================\n  const defectData = ref({});\n  const defectChartData = ref({\n    barData: [[]],\n    lineData: [[]],\n    categories: [],\n    units: ['(项)', '(%)'],\n    colors: [\n      ['#078C5D', '#68E4B8'],\n      ['#E59837', '#FAE895'],\n      ['#078C5D', '#68E4B8'],\n    ],\n    dataZoomDefaultValueRange: [0, 7],\n  });\n  const defectChartSeriesName = ['缺陷未处理', '处理率'];\n  const doDefectStat = async (value) => {\n    const defectStat = await OperationApi.defectStat({\n      dimension: value,\n      startMonth: searchInfo.startMonth,\n      endMonth: searchInfo.endMonth,\n    });\n    if (defectStat) {\n      defectData.value = [\n        { label: '待处理(项)', value: defectStat.unHandleCount },\n        { label: '处理率(%)', value: defectStat.handleRate },\n      ];\n      defectChartData.value.barData = defectStat.barData || [];\n      defectChartData.value.categories = defectStat.categories || [];\n      if (defectStat.lineData?.length) {\n        defectChartData.value.lineData[0] = defectStat.lineData;\n      } else {\n        defectChartData.value.lineData = [];\n      }\n    }\n  };\n  const handleDefectChange = (value) => {\n    doDefectStat(value);\n  };\n\n  // ==================================隐患统计 begin ======================================\n  const hiddenData = ref({});\n  const hiddenChartData = ref({\n    barData: [[]],\n    categories: [],\n    lineData: [[]],\n    units: ['(项)', '(%)'],\n    colors: [\n      ['#488FF6', '#60D1F3'],\n      ['#E59837', '#FAE895'],\n      ['#078C5D', '#68E4B8'],\n    ],\n    dataZoomDefaultValueRange: [0, 7],\n  });\n  const hiddenChartSeriesName = ['待处理', '处理率'];\n  const doHiddenStat = async (value) => {\n    const hiddenStat = await OperationApi.hiddenStat({\n      dimension: value,\n      startMonth: searchInfo.startMonth,\n      endMonth: searchInfo.endMonth,\n    });\n    if (hiddenStat) {\n      hiddenData.value = [\n        { label: '待处理(项)', value: hiddenStat.waitCount },\n        { label: '处理率(%)', value: hiddenStat.dealRate },\n      ];\n      hiddenChartData.value.barData = hiddenStat.barData || [];\n      hiddenChartData.value.categories = hiddenStat.categories || [];\n      if (hiddenStat.lineData?.length) {\n        hiddenChartData.value.lineData[0] = hiddenStat.lineData;\n      } else {\n        hiddenChartData.value.lineData = [];\n      }\n    }\n  };\n  const handleHiddenChange = (value) => {\n    doHiddenStat(value);\n  };\n\n  // ==================================数据穿透 ======================================\n  //指标数据\n  const toBiReport = (type: string) => {\n    if (type == 'ticket') {\n      handleRouteChange('/bi/maintenance/ticket', {});\n    } else if (type === 'defect') {\n      handleRouteChange('/bi/fault/index', {});\n    } else if (type === 'hidden') {\n      handleRouteChange('/bi/hidden/index', {});\n    }\n  };\n\n  //两票Echart\n  const ticketCharToBiReport = (params) => {\n    handleRouteChange('/bi/maintenance/ticket', {\n      // TODO bi报表参数\n      stationOrganId: formState.ticket === 'company' ? params.data.id : '',\n      stationIds: formState.ticket === 'station' ? params.data.id : '',\n      dateType: 'month',\n    });\n  };\n\n  //缺陷eChart\n  const defectCharToBiReport = (params) => {\n    handleRouteChange('/bi/fault/index', {\n      // TODO bi报表参数\n      stationOrganId: formState.defect === 'company' ? params.data.id : '',\n      stationId: formState.defect === 'station' ? params.data.id : '',\n      dateType: 'month',\n    });\n  };\n\n  //隐患Echart\n  const hiddenCharToBiReport = (params) => {\n    handleRouteChange('/bi/hidden/index', {\n      // TODO bi报表参数\n      stationOrganId: formState.hidden === 'company' ? params.data.id : '',\n      stationId: formState.hidden === 'station' ? params.data.id : '',\n      dateType: 'month',\n    });\n  };\n\n  // 更新组件函数\n  const handleUpdate = () => {\n    instanceKey.value = buildUUID();\n  };\n\n  defineExpose({\n    handleUpdate,\n  });\n</script>\n\n<style lang=\"less\" scoped>\n  .bottom-content {\n    display: flex;\n    flex: 44.34%;\n    justify-content: space-between;\n    height: 44.34%;\n    padding-top: 0.93vh;\n\n    .section-box {\n      flex: 33.3333%;\n      width: 33.3333%;\n      height: 100%;\n    }\n\n    .section-bg {\n      width: 100%;\n      height: 100%;\n      background: url('../../../../assets/images/da/section_bg_4.png') no-repeat center/100% 100%;\n    }\n\n    .left-section {\n      padding-right: 0.56vw;\n    }\n\n    .middle-section {\n      padding: 0 0.28vw;\n    }\n\n    .right-section {\n      padding-left: 0.56vw;\n    }\n\n    :deep(.ant-select:not(.ant-select-customize-input) .ant-select-selector) {\n      height: 0.26rem !important;\n      border: 0.01rem solid #07a6ff70;\n      border-radius: 0;\n      background-color: transparent;\n    }\n\n    :deep(.ant-select-single .ant-select-selector .ant-select-selection-placeholder) {\n      height: 0.26rem;\n      line-height: 0.26rem;\n    }\n\n    :deep(.ant-select-arrow) {\n      color: rgb(255 255 255 / 50%);\n    }\n\n    .indicator-group-layout {\n      padding: 0.08rem 1.2rem 0;\n\n      &.fix-indicator-group-padding {\n        padding-top: 1.8vh;\n      }\n    }\n\n    .indicator-group-layout2 {\n      padding: 0.08rem 1.88rem 0;\n\n      &.fix-indicator-group-padding {\n        padding-top: 1.8vh;\n      }\n    }\n  }\n</style>\n"],"names":["searchInfo","reactive","instanceKey","ref","buildUUID","formState","dimensionTypeData","watch","props","value","assign","doTwoTicketStat","doDefectStat","doHiddenStat","onMounted","__async","CommonApi.getDictDataMap","e","ticketData","ticketChartData","ticketChartSeriesName","twoTicketStat","OperationApi.twoTicketStat","handleDimensionTypeChange","defectData","defectChartData","defectChartSeriesName","defectStat","OperationApi.defectStat","handleDefectChange","hiddenData","hiddenChartData","hiddenChartSeriesName","hiddenStat","OperationApi.hiddenStat","handleHiddenChange","toBiReport","type","handleRouteChange","ticketCharToBiReport","params","defectCharToBiReport","hiddenCharToBiReport","__expose"],"mappings":"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"}