var v=(L,b,I)=>new Promise((M,k)=>{var e=i=>{try{x(I.next(i))}catch(m){k(m)}},f=i=>{try{x(I.throw(i))}catch(m){k(m)}},x=i=>i.done?M(i.value):Promise.resolve(i.value).then(e,f);x((I=I.apply(L,b)).next())});import{B as re}from"./BasicTable-0434a334.js";import{T as ie}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as ue}from"./useTable-109483b3.js";import{bB as de,bC as ce,a2 as T}from"./antd-15ac76ed.js";import{au as pe,b as me,a7 as fe,av as S,ax as ve,az as be,bQ as ge,bR as ye,aA as Ie,a0 as he,_ as _e}from"./index.js";import{P as we}from"./index-20519caf.js";import{C as xe}from"./CommonTree-c4ed7838.js";import"./index-74ac3212.js";import{_ as Ce}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{g as Y,a as ke,f as s,b as q,e as Ne,c as Te}from"./contract-905202c8.js";import{d as Se,r as z,k as u,ax as De,o as Oe,al as D,Z as y,_ as K,f as l,aa as o,$ as E,a9 as O,ac as B,E as w,F as V,u as d,J as Be}from"./vue-71d1abb3.js";import{j as Ee}from"./Export2Excel-389a8fc9.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";import"./useRender-21ce56fb.js";const Pe={class:"right-table-layout"},Ae={class:"tab-button-div"},Fe={class:"tab-table-div"},Ke=Se({__name:"index",setup(L){const b=z({searchTime:""}),{createConfirm:I,createMessage:M}=pe(),{t:k}=me(),e=z({contractName:null,partyA:null,partyB:null,status:null}),f=u(!1),x=u([]);u({});const i=u({}),m=u([]);u([]);const j=Y();De(),u([{label:"草稿",value:"0"},{label:"处理中",value:"1"},{label:"通过",value:"2"},{label:"不通过",value:"3"},{label:"已取消",value:"4"},{label:"已终止",value:"5"},{label:"退回",value:"6"}]);const P=u([]),$=()=>v(this,null,function*(){let a=yield Te(e);return P.value=a.result,a.result}),H={baseColProps:{lg:6,md:8},labelWidth:90,schemas:[]};function W(){J(),f.value=!f.value}const[X,{reload:h,getPaginationRef:G,getForm:Le,redoHeight:J}]=ue({title:"合同信息列表",api:()=>v(this,null,function*(){const a=G();return e.pageNo=a.current,e.pageSize=a.pageSize,yield $()}),columns:j,useSearchForm:!1,formConfig:H,showTableSetting:!0,bordered:!0,rowKey:"id",rowSelection:{type:"radio",onChange:Q},handleSearchInfoFn(a){return e.status=a.status,e.contractName=a.contractName,e.partyA=a.partyA,e.partyB=a.partyB,a},sortFn:a=>{a.order?(e.sortField=a.field,e.sortOrder=a.order.replace("end","")):(e.sortField=null,e.sortOrder=null)}});let A=u("");function Q(a,t){t.length>0?(m.value=[a[0]],A.value=a[0]):(m.value=[],A.value="")}function Z(){return v(this,null,function*(){const a=yield ke({});x.value=a.result,h()})}function ee(){if(s.id="",s.contractDate="",s.contractType="",s.contractName="",s.partyA="",s.partyB="",s.startDate="",s.endDate="",s.remark="",e.periodId==null){T.error("请先选择电站分期。");return}e.nodeKindId=="station"&&U(),e.nodeKindId=="period"&&U(),ve("/po/integrated/contract/create","添加合同信息",Be(s))}function R(a){a.status==0||a.status==1,be(a.id)}const ae=a=>v(this,null,function*(){const t=yield q({id:a.id}),{value:g}=yield ge.prompt("请输入取消原因","取消流程",{confirmButtonText:k("common.okText"),cancelButtonText:k("common.cancelText"),inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"取消原因不能为空"});yield ye(t.result.processInstanceId,g),T.success("已取消"),h()});function te(){return v(this,null,function*(){if(console.log(m.value),m.value.length!=1)return T.info("请选择一条数据."),!1;const a=yield q({id:m.value[0]});I({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return v(this,null,function*(){if(a.result.status!=0){T.error("非草稿状态不能删除。");return}yield Ie(a.result.processInstanceId),T.success("已删除。"),m.value=[],h()})}})})}function le(){e.billCode=null,e.contractName=null,e.partyA=null,e.partyB=null,e.status=null,e.startDate=null,e.endDate=null,b.searchTime=null,h()}function ne(){b.searchTime!=null&&(e.startDate=b.searchTime[0],e.endDate=b.searchTime[1]),h()}function U(){i.value.stationId}function se(a={}){e.stationId=null,e.stationName=null,e.periodName=null,e.periodId=null,e.stationOrganId=null,e.stationOrganName=null,e.nodeKindId=null,i.value.nodeKindId=null,e.searchId=null,a!=null&&(e.stationOrganId=a.organId,e.stationOrganName=a.organName,a.nodeKindId=="station"&&(e.stationId=a.powerStationId,e.stationName=a.name,i.value.stationId=a.powerStationId),a.nodeKindId=="period"&&(e.stationId=a.powerStationId,e.stationName=a.powerStationName,e.periodName=a.powerStationPeriodName,e.periodId=a.powerStationPeriodId,i.value.stationId=a.powerStationId,s.stationId=e.stationId,s.stationName=e.stationName,s.periodName=e.periodName,s.periodId=e.periodId,s.stationOrganId=e.stationOrganId,s.stationOrganName=e.stationOrganName),e.nodeKindId=a.nodeKindId,i.value.nodeKindId=a.nodeKindId,e.searchId=a.id),h()}function oe(){return v(this,null,function*(){I({title:"导出",iconType:"warning",content:"确定要导出所有记录？",onOk(){return v(this,null,function*(){const t=u({index:"序号"}),g=Y(),c=u([]),N=u([]);g.forEach(r=>{r.dataIndex!=="id"&&(r.dataIndex==="stationOrganName"&&he().isMultiOrganization||r.dataIndex!=="stationOrganName")&&(t.value[r.dataIndex]=r.title,N.value.push(r.dataIndex))});let _=yield Ne(e);P.value=_.result,P.value.forEach(function(r,n){let p="";switch(r.status){case 0:p="草稿";break;case 1:p="处理中";break;case 2:p="通过";break;case 3:p="不通过";break;case 4:p="已取消";break;case 5:p="已终止";break;case 6:p="退回/驳回";break}let C=u({index:n+1});N.value.forEach(F=>{C.value[F]=F==="status"?p:r[F]}),c.value.push(C.value)}),Ee({data:c.value,header:t.value,filename:"合同信息.xlsx"})})}})})}return Oe(()=>{Z(),fe.getInstance().listen("integrated-contract",function(){setTimeout(()=>{h()},500)})}),(a,t)=>{const g=D("a-input"),c=D("a-form-item"),N=D("a-range-picker"),_=D("a-button"),r=D("a-form");return y(),K("div",null,[l(d(we),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:o(()=>[l(xe,{title:"电站组织",onSelect:se,value:x.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),E("div",Pe,[E("div",Ae,[l(r,{model:e,name:"searchInfo",layout:"inline",autocomplete:"off",class:"search-form"},{default:o(()=>[l(c,{name:"billCode",label:"单据编号",labelCol:{span:6},rules:[{required:!1,message:"请输入单据编号"}],style:{width:"26.5%"},colon:!1},{default:o(()=>[l(g,{value:e.billCode,"onUpdate:value":t[0]||(t[0]=n=>e.billCode=n),placeholder:"请输入单据编号",style:{width:"100%"}},null,8,["value"])]),_:1}),l(c,{name:"contractName",label:"合同名称",labelCol:{span:6},rules:[{required:!1,message:"请输入合同名称"}],style:{width:"26.5%"},colon:!1},{default:o(()=>[l(g,{value:e.contractName,"onUpdate:value":t[1]||(t[1]=n=>e.contractName=n),placeholder:"请输入合同名称",style:{width:"100%"}},null,8,["value"])]),_:1}),l(c,{name:"partyA",label:"甲方",labelCol:{span:6},rules:[{required:!1,message:"请输入甲方"}],style:{width:"26.5%"},colon:!1},{default:o(()=>[l(g,{value:e.partyA,"onUpdate:value":t[2]||(t[2]=n=>e.partyA=n),placeholder:"请输入甲方",style:{width:"100%"}},null,8,["value"])]),_:1}),f.value?(y(),O(c,{key:0,style:{width:"100%",height:"10px"}})):B("",!0),f.value?(y(),O(c,{key:1,name:"partyB",label:"乙方",labelCol:{span:6},rules:[{required:!1,message:"请输入乙方"}],style:{width:"26.5%"},colon:!1},{default:o(()=>[l(g,{value:e.partyB,"onUpdate:value":t[3]||(t[3]=n=>e.partyB=n),placeholder:"请输入乙方",style:{width:"100%"}},null,8,["value"])]),_:1})):B("",!0),f.value?(y(),O(c,{key:2,name:"status",label:"审批状态",labelCol:{span:20},rules:[{required:!1,message:"请选择审批状态"}],style:{width:"26.5%"},colon:!1},{default:o(()=>[l(Ce,{type:"bpm_process_instance_result",onChange:t[4]||(t[4]=n=>"()=> searchInfo.status = value"),value:e.status,"onUpdate:value":t[5]||(t[5]=n=>e.status=n),width:"100%"},null,8,["value"])]),_:1})):B("",!0),f.value?(y(),O(c,{key:3,name:"startDate",label:"合同日期",labelCol:{span:6},rules:[{required:!1,message:"请选择合同日期"}],style:{width:"26.5%"},colon:!1},{default:o(()=>[l(N,{value:b.searchTime,"onUpdate:value":t[6]||(t[6]=n=>b.searchTime=n),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD 00:00:00",style:{width:"100%"}},null,8,["value"])]),_:1})):B("",!0),l(c,{class:"search-btns"},{default:o(()=>[l(_,{style:{margin:"0 8px"},onClick:le},{default:o(()=>[w("重置")]),_:1}),l(_,{type:"primary",class:"tab-button",onClick:ne},{default:o(()=>[w("查询")]),_:1}),E("a",{style:{"margin-left":"12px","font-size":"14px"},onClick:W},[f.value?(y(),K(V,{key:0},[w(" 收起 "),l(d(de))],64)):(y(),K(V,{key:1},[w(" 展开 "),l(d(ce))],64))])]),_:1})]),_:1},8,["model"])]),E("div",Fe,[l(d(re),{onRegister:d(X),class:"fix-basic-table",onResizeColumn:t[7]||(t[7]=(n,p)=>p.width=n),onRowDbClick:t[8]||(t[8]=n=>R(n))},{toolbar:o(()=>[l(_,{type:"primary",preIcon:d(S).ADD,onClick:ee},{default:o(()=>[w("添加")]),_:1},8,["preIcon"]),l(_,{class:"red-btn",disabled:d(A)=="",preIcon:d(S).DELETE,onClick:te},{default:o(()=>[w("删除")]),_:1},8,["disabled","preIcon"]),l(_,{class:"yellow-btn",preIcon:d(S).EXPORT,onClick:oe},{default:o(()=>[w("导出")]),_:1},8,["preIcon"])]),bodyCell:o(({column:n,text:p,record:C})=>[n.key==="action"?(y(),O(d(ie),{key:0,actions:[{icon:d(S).LOG,label:"进度",onClick:R.bind(null,C)},{icon:d(S).DELETE,danger:!0,label:"取消",ifShow:()=>C.status==0,onClick:ae.bind(null,C)}]},null,8,["actions"])):B("",!0)]),_:1},8,["onRegister"])])])]),_:1})])}}});const va=_e(Ke,[["__scopeId","data-v-07e87c69"]]);export{va as default};
//# sourceMappingURL=index-784b92eb.js.map
