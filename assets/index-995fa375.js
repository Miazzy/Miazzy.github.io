var g=(A,f,w)=>new Promise((J,N)=>{var v=b=>{try{T(w.next(b))}catch(i){N(i)}},e=b=>{try{T(w.throw(b))}catch(i){N(i)}},T=b=>b.done?J(b.value):Promise.resolve(b.value).then(v,e);T((w=w.apply(A,f)).next())});import{B as de}from"./BasicTable-0434a334.js";import{T as ce}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as me}from"./useTable-109483b3.js";import{bB as pe,bC as fe,a2 as C}from"./antd-15ac76ed.js";import{au as be,b as ge,a7 as ve,av as S,ax as he,az as ye,bQ as _e,bR as Ie,aA as xe,a0 as we,_ as Ce}from"./index.js";import{P as Te}from"./index-20519caf.js";import{C as ke}from"./CommonTree-c4ed7838.js";import"./index-74ac3212.js";import{_ as F}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{g as Y,a as Se,f as d,b as q,u as De,e as Oe,c as Ne}from"./safetyRespAgreement-5ce80b14.js";import{d as Pe,k as u,r as K,ax as Be,o as Ee,al as B,x as Re,Z as c,_ as D,f as n,aa as l,$ as R,a9 as O,ac as I,E as x,F as M,u as r,v as ze,J as Le}from"./vue-71d1abb3.js";import{j as Fe}from"./Export2Excel-389a8fc9.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";import"./useRender-21ce56fb.js";const Me={class:"right-table-layout"},Ae={class:"tab-button-div"},Je={class:"tab-table-div"},Ue={key:0,style:{color:"#dc0000"}},Ye={key:1,style:{color:"#19be6b"}},qe=Pe({__name:"index",setup(A){const f=u(!1),{createConfirm:w,createMessage:J}=be(),{t:N}=ge(),v=K({searchTime:""}),e=K({billCode:null,isBeOnTheJob:null,startDate:null,endDate:null,status:null,bizStatus:null,signPersonName:null}),T=u([]);u({});const b=u({}),i=u([]);u([]);const V=Y();Be(),u([{label:"草稿",value:"0"},{label:"处理中",value:"1"},{label:"通过",value:"2"},{label:"不通过",value:"3"},{label:"已取消",value:"4"},{label:"已终止",value:"5"},{label:"退回",value:"6"}]);const z=u([]),j=()=>g(this,null,function*(){let a=yield Ne(e);return z.value=a.result,a.result}),$={baseColProps:{lg:6,md:8},labelWidth:90,schemas:[]};function H(){G(),f.value=!f.value}const[W,{reload:h,getPaginationRef:X,getForm:Ke,redoHeight:G}]=me({title:"安全责任书列表",api:()=>g(this,null,function*(){const a=X();return e.pageNo=a.current,e.pageSize=a.pageSize,yield j()}),columns:V,useSearchForm:!1,formConfig:$,showTableSetting:!0,bordered:!0,rowKey:"id",rowSelection:{type:"radio",onChange:Q},handleSearchInfoFn(a){return e.status=a.status,e.isBeOnTheJob=a.isBeOnTheJob,e.bizStatus=a.bizStatus,e.signPersonName=a.signPersonName,a},sortFn:a=>{a.order?(e.sortField=a.field,e.sortOrder=a.order.replace("end","")):(e.sortField=null,e.sortOrder=null)}});let E=u("");function Q(a,s){s.length>0?(i.value=[a[0]],E.value=a[0]):(i.value=[],E.value="")}function Z(){return g(this,null,function*(){const a=yield Se({});T.value=a.result,h()})}function ee(){if(d.id="",d.signPersonId="",d.signPersonName="",d.signDate="",d.startDate="",d.endDate="",d.content="",e.stationId==null){C.error("请先选择电站。");return}e.nodeKindId=="station"&&le(),he("/po/safetyRespAgreement/create","添加安全责任书",Le(d))}function U(a){a.status==0||a.status==1,ye(a.id)}const ae=a=>g(this,null,function*(){const s=yield q({id:a.id}),{value:k}=yield _e.prompt("请输入取消原因","取消流程",{confirmButtonText:N("common.okText"),cancelButtonText:N("common.cancelText"),inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"取消原因不能为空"});yield Ie(s.result.processInstanceId,k),C.success("已取消"),h()});function te(){return g(this,null,function*(){if(console.log(i.value),i.value.length!=1)return C.info("请选择一条数据."),!1;const a=yield q({id:i.value[0]});w({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return g(this,null,function*(){if(a.result.status!=0){C.error("非草稿状态不能删除。");return}yield xe(a.result.processInstanceId),C.success("已删除。"),i.value=[],h()})}})})}function se(){e.billCode=null,e.isBeOnTheJob=null,e.startDate=null,e.endDate=null,e.status=null,e.bizStatus=null,e.signPersonName=null,v.searchTime=null,h()}function ne(){v.searchTime!=null&&(e.startDate=v.searchTime[0],e.endDate=v.searchTime[1]),h()}function le(){b.value.stationId}function oe(a={}){e.stationId=null,e.stationName=null,e.stationOrganId=null,e.stationOrganName=null,e.searchId=null,e.nodeKindId=null,a!=null&&(e.stationOrganId=a.organId,e.stationOrganName=a.organName,a.nodeKindId=="station"&&(e.stationId=a.powerStationId,e.stationName=a.name,d.stationId=e.stationId,d.stationName=e.stationName,d.stationOrganId=e.stationOrganId,d.stationOrganName=e.stationOrganName),e.nodeKindId=a.nodeKindId,e.searchId=a.id),h()}function ie(){return i.value.length==0||i.value.length>1||!i.value[0]?(C.error("请选择一行数据"),!1):!0}function re(){if(!ie())return;const a="?id="+i.value[0]+"&bizStatus=0";De(a).then(()=>{C.success("已禁用"),h()})}function ue(){return g(this,null,function*(){w({title:"导出",iconType:"warning",content:"确定要导出所有记录？",onOk(){return g(this,null,function*(){const s=u({index:"序号"}),k=Y(),m=u([]),P=u([]);k.forEach(o=>{o.dataIndex!=="id"&&(o.dataIndex==="stationOrganName"&&we().isMultiOrganization||o.dataIndex!=="stationOrganName")&&(s.value[o.dataIndex]=o.title,P.value.push(o.dataIndex))});let y=yield Oe(e);z.value=y.result;debugger;z.value.forEach(function(o,L){let t="";switch(o.status){case 0:t="草稿";break;case 1:t="处理中";break;case 2:t="通过";break;case 3:t="不通过";break;case 4:t="已取消";break;case 5:t="已终止";break;case 6:t="退回/驳回";break}let _=u({index:L+1});P.value.forEach(p=>{p==="status"?_.value[p]=p==="status"?t:o[p]:_.value[p]=o[p]}),m.value.push(_.value)}),Fe({data:m.value,header:s.value,filename:"安全责任书.xlsx"})})}})})}return Ee(()=>{Z(),ve.getInstance().listen("safetyRespAgreement",function(){setTimeout(()=>{h()},500)})}),(a,s)=>{const k=B("a-input"),m=B("a-form-item"),P=B("a-range-picker"),y=B("a-button"),o=B("a-form"),L=Re("auth");return c(),D("div",null,[n(r(Te),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:l(()=>[n(ke,{title:"电站组织",onSelect:oe,value:T.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),R("div",Me,[R("div",Ae,[n(o,{model:e,name:"searchInfo",layout:"inline",autocomplete:"off",class:"search-form"},{default:l(()=>[n(m,{name:"billCode",label:"单据编号",labelCol:{span:6},rules:[{required:!1,message:"请输入单据编号"}],style:{width:"26.5%"},colon:!1},{default:l(()=>[n(k,{value:e.billCode,"onUpdate:value":s[0]||(s[0]=t=>e.billCode=t),placeholder:"请输入单据编号",style:{width:"100%"}},null,8,["value"])]),_:1}),n(m,{name:"signPersonName",label:"签订人",labelCol:{span:12},rules:[{required:!1,message:"请输入签订人"}],style:{width:"26.5%"},colon:!1},{default:l(()=>[n(k,{value:e.signPersonName,"onUpdate:value":s[1]||(s[1]=t=>e.signPersonName=t),placeholder:"请输入签订人",style:{width:"100%"}},null,8,["value"])]),_:1}),n(m,{name:"isBeOnTheJob",label:"是否在职",labelCol:{span:12},rules:[{required:!1,message:"请选择是否在职"}],style:{width:"26.5%"},colon:!1},{default:l(()=>[n(F,{type:"yes_or_no",value:e.isBeOnTheJob,"onUpdate:value":s[2]||(s[2]=t=>e.isBeOnTheJob=t),width:"100%"},null,8,["value"])]),_:1}),f.value?(c(),O(m,{key:0,style:{width:"100%",height:"10px"}})):I("",!0),f.value?(c(),O(m,{key:1,name:"bizStatus",label:"业务状态",labelCol:{span:12},rules:[{required:!1,message:"请选择业务状态"}],style:{width:"26.5%"},colon:!1},{default:l(()=>[n(F,{type:"enable_or_disable",value:e.bizStatus,"onUpdate:value":s[3]||(s[3]=t=>e.bizStatus=t),width:"100%"},null,8,["value"])]),_:1})):I("",!0),f.value?(c(),O(m,{key:2,name:"searchTime",label:"责任期",labelCol:{span:6},rules:[{required:!1,message:"请选择责任期"}],style:{width:"26.5%"},colon:!1},{default:l(()=>[n(P,{value:v.searchTime,"onUpdate:value":s[4]||(s[4]=t=>v.searchTime=t),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD 00:00:00",style:{width:"100%"}},null,8,["value"])]),_:1})):I("",!0),f.value?(c(),O(m,{key:3,name:"status",label:"审批状态",labelCol:{span:20},rules:[{required:!1,message:"请选择审批状态"}],style:{width:"26.5%"},colon:!1},{default:l(()=>[n(F,{type:"bpm_process_instance_result",onChange:s[5]||(s[5]=t=>"()=> searchInfo.status = value"),value:e.status,"onUpdate:value":s[6]||(s[6]=t=>e.status=t),width:"100%"},null,8,["value"])]),_:1})):I("",!0),n(m,{class:"search-btns"},{default:l(()=>[n(y,{style:{margin:"0 8px"},onClick:se},{default:l(()=>[x("重置")]),_:1}),n(y,{type:"primary",class:"tab-button",onClick:ne},{default:l(()=>[x("查询")]),_:1}),R("a",{style:{"margin-left":"12px","font-size":"14px"},onClick:H},[f.value?(c(),D(M,{key:0},[x(" 收起 "),n(r(pe))],64)):(c(),D(M,{key:1},[x(" 展开 "),n(r(fe))],64))])]),_:1})]),_:1},8,["model"])]),R("div",Je,[n(r(de),{onRegister:r(W),class:"fix-basic-table",onResizeColumn:s[7]||(s[7]=(t,_)=>_.width=t),onRowDbClick:s[8]||(s[8]=t=>U(t))},{toolbar:l(()=>[n(y,{type:"primary",preIcon:r(S).ADD,onClick:ee},{default:l(()=>[x("添加")]),_:1},8,["preIcon"]),n(y,{class:"red-btn",disabled:r(E)=="",preIcon:r(S).DELETE,onClick:te},{default:l(()=>[x("删除")]),_:1},8,["disabled","preIcon"]),n(y,{class:"yellow-btn",preIcon:r(S).EXPORT,onClick:ue},{default:l(()=>[x("导出")]),_:1},8,["preIcon"]),ze((c(),O(y,{class:"grey-btn",preIcon:r(S).DISABLE,onClick:re,disabled:r(E)==""},{default:l(()=>[x("禁用")]),_:1},8,["preIcon","disabled"])),[[L,"po:safetyRespAgreement:disable"]])]),bodyCell:l(({column:t,text:_,record:p})=>[t.key==="action"?(c(),O(r(ce),{key:0,actions:[{icon:r(S).LOG,label:"进度",onClick:U.bind(null,p)},{icon:r(S).DELETE,danger:!0,label:"取消",ifShow:()=>p.status==0,onClick:ae.bind(null,p)}]},null,8,["actions"])):I("",!0),t.dataIndex==="bizStatusText"?(c(),D(M,{key:1},[_=="禁用"?(c(),D("span",Ue,"禁用")):I("",!0),_=="启用"?(c(),D("span",Ye,"启用")):I("",!0)],64)):I("",!0)]),_:1},8,["onRegister"])])])]),_:1})])}}});const xa=Ce(qe,[["__scopeId","data-v-9f6d12b6"]]);export{xa as default};
//# sourceMappingURL=index-995fa375.js.map
