{"version":3,"file":"create-a1705cd1.js","sources":["../../src/views/oa/info/officedoc/create.ts","../../src/utils/formUtils.ts","../../src/views/oa/info/officedoc/create.vue"],"sourcesContent":["import { defHttp } from '@/utils/http/axios';\n\nenum Api {\n  //查询\n  getData = '/oa/official-doc-release/get',\n  createData = '/oa/official-doc-release/create',\n  getOrgTree = '/system/org/list-tree',\n  getInfoKind = '/oa/infoKind/getInfoKindByCodePreAndOrgId',\n\n}\n\n// 查询\nexport function getData(params) {\n  return defHttp.get({ url: Api.getData, params });\n}\nexport function createData(params) {\n  return defHttp.post({ url: Api.createData, params });\n}\n\nexport function getOrgTree(params) {\n  return defHttp.post({ url: Api.getOrgTree, params });\n}\nexport function getInfoKind(params) {\n  return defHttp.get({ url: Api.getInfoKind, params });\n}\n","// 设置Reactive属性\nexport const setReactiveValues = (fstate, data: Object) => {\n  const formStateProperties = Object.keys(fstate);\n  for (const property of formStateProperties) {\n    if (Reflect.has(data, property)) {\n      fstate[property] = data[property];\n    }\n  }\n};\n\n// 滚动到相应form表单校验失败的位置\nexport const scrollToInValidField = (formInstance, fields, index = 0) => {\n  if (fields && fields.errorFields) {\n    try {\n      let field = null;\n      if (fields.errorFields.length > index) {\n        field = fields.errorFields[index];\n      } else if (fields.errorFields.length > 2) {\n        field = fields.errorFields[2];\n      } else if (fields.errorFields.length > 1) {\n        field = fields.errorFields[1];\n      } else if (fields.errorFields.length > 0) {\n        field = fields.errorFields[0];\n      }\n      if (Reflect.has(field, 'name')) {\n        const name = field['name'];\n        formInstance?.scrollToField(name[0]);\n      }\n    } catch (error) {\n      //\n    }\n  }\n};\n","<template>\n  <PageWrapper dense contentFullHeight fixedHeight  contentClass=\"flex\" style=\"position: relative\">\n    <div class=\"load\">\n      <a-spin :spinning=\"formState.spinning\" tip=\"Loading...\">\n        <div class=\"process-box\">\n          <div class=\"header-box\">\n            <BillTitle :options=\"billTitleOptions\" />\n            <WfApproveBox\n              @agree=\"flowOption.handleAgree\"\n              @save=\"flowOption.handleSave\"\n              @submit=\"flowOption.handleSubmit\"\n              :processInstanceId=\"processInstanceId\"\n              :processStatus=\"formState.status\"\n              :listenMessage=\"`office-doc`\"\n            />\n            <!-- <PrintButton style=\"margin-left: 10px\" v-if=\"formState.status === 2\" /> -->\n          </div>\n          <div class=\"content\" v-global-disabled=\"isReadOnly\">\n            <a-form\n              :model=\"formState\"\n              name=\"basic\"\n              ref=\"formRef\"\n              autocomplete=\"off\"\n              @finish=\"onFinish\"\n            >\n              <a-card title=\"基本信息\" :bordered=\"false\">\n                <a-row :gutter=\"24\">\n                  <a-col :span=\"12\" v-if=\"useUserStore().isMultiOrganization\">\n                    <a-form-item\n                      label=\"所在公司\"\n                      name=\"infoKindId\"\n                      :labelCol=\"{ style: { width: '124px'} }\" \n                      :rules=\"[{ required: false }]\"\n                    >\n                      <a-input v-model:value=\"formState.organName\" disabled=\"true\" />\n                    </a-form-item>\n                  </a-col>\n                  <a-col :span=\"12\">\n                    <a-form-item\n                      label=\"所在部门\"\n                      name=\"deptName\"\n                      :labelCol=\"{ style: { width: '124px'} }\" \n                      :rules=\"[{ required: false }]\"\n                    >\n                      <a-input v-model:value=\"formState.deptName\" disabled=\"true\" />\n                    </a-form-item>\n                  </a-col>\n                  <a-col :span=\"12\">\n                    <a-form-item\n                      label=\"发起人\"\n                      name=\"personMemberName\"\n                      :labelCol=\"{ style: { width: '124px'} }\" \n                      :rules=\"[{ required: false }]\"\n                    >\n                      <a-input v-model:value=\"formState.personMemberName\" disabled=\"true\" />\n                    </a-form-item>\n                  </a-col>\n\n                  <a-col :span=\"12\">\n                    <a-form-item\n                      label=\"信息类型\"\n                      name=\"infoKindId\"\n                      :labelCol=\"{ style: { width: '124px'} }\" \n                      :rules=\"[{ required: true, message: '信息类型不能为空' }]\"\n                    >\n                      <a-select\n                        v-model:value=\"formState.infoKindId\"\n                        allow-clear\n                        :options=\"infoKinds\"\n                        :disabled=\"disabledInput\"\n                        @change=\"changeInfoKind\"\n                      />\n                    </a-form-item>\n                  </a-col>\n                  <a-col :span=\"12\">\n                    <a-form-item\n                      label=\"发文分类\"\n                      name=\"dispatchKindId\"\n                      :labelCol=\"{ style: { width: '124px'} }\" \n                      :rules=\"[{ required: true, message: '发文分类不能为空' }]\"\n                    >\n                      <DictSelectBox\n                        v-model:value=\"formState.dispatchKindId\"\n                        :type=\"`dispatch_kind`\"\n                        :disabled=\"disabledInput\"\n                        :style=\"`width: 100%`\"\n                      />\n                    </a-form-item>\n                  </a-col>\n                  <a-col :span=\"12\">\n                    <a-form-item\n                      label=\"拟稿人\"\n                      name=\"drafterName\"\n                      :labelCol=\"{ style: { width: '124px'} }\" \n                      :rules=\"[{ required: true, message: '拟稿人不能为空' }]\"\n                    >\n                      <a-tree-select\n                        v-model:value=\"formState.drafterName\"\n                        show-search\n                        style=\"width: 100%\"\n                        :dropdown-style=\"{ maxHeight: '400px', overflow: 'auto' }\"\n                        tree-default-expand-all\n                        :tree-data=\"currentPersonTreeData\"\n                        tree-node-filter-prop=\"label\"\n                        @change=\"changeDrafter\"\n                        :disabled=\"disabledInput\"\n                      />\n                    </a-form-item>\n                  </a-col>\n                  <a-col :span=\"12\">\n                    <a-form-item\n                      label=\"主办单位\"\n                      name=\"organizerName\"\n                      :labelCol=\"{ style: { width: '124px'} }\" \n                      :rules=\"[{ required: true, message: '主办单位不能为空' }]\"\n                    >\n                      <a-input\n                        v-model:value=\"formState.organizerName\"\n                        :disabled=\"disabledInput\"\n                        maxlength=\"32\"\n                      />\n                    </a-form-item>\n                  </a-col>\n                  <a-col :span=\"12\">\n                    <a-form-item\n                      label=\"发文年份\"\n                      name=\"dispatchYear\"\n                      :labelCol=\"{ style: { width: '124px'} }\" \n                      :rules=\"[{ required: true, message: '发文年份不能为空' }]\"\n                    >\n                      <a-date-picker\n                        v-model:value=\"formState.dispatchYear\"\n                        style=\"width: 100%\"\n                        picker=\"year\"\n                        value-format=\"YYYY\"\n                        format=\"YYYY\"\n                        :disabled=\"disabledInput\"\n                      />\n                    </a-form-item>\n                  </a-col>\n                  <a-col :span=\"12\">\n                    <a-form-item\n                      label=\"发文编号\"\n                      name=\"dispatchSequence\"\n                      :labelCol=\"{ style: { width: '124px'} }\" \n                      :rules=\"[{ required: false, message: '发文编号不能为空' }]\"\n                    >\n                      <a-input-number\n                        v-model:value=\"formState.dispatchSequence\"\n                        :min=\"0\"\n                        :max=\"9999\"\n                        disabled=\"true\"\n                      />\n                    </a-form-item>\n                  </a-col>\n                  <a-col :span=\"12\">\n                    <a-form-item\n                      label=\"生效日期\"\n                      name=\"effectiveTime\"\n                      :labelCol=\"{ style: { width: '124px'} }\" \n                      :rules=\"[{ required: true, message: '生效日期不能为空' }]\"\n                    >\n                      <a-date-picker\n                        v-model:value=\"formState.effectiveTime\"\n                        valueFormat=\"YYYY-MM-DD\"\n                        format=\"YYYY-MM-DD\"\n                        style=\"width: 100%\"\n                        :disabled=\"disabledInput\"\n                      />\n                    </a-form-item>\n                  </a-col>\n                  <a-col :span=\"12\">\n                    <a-form-item\n                      label=\"校对人\"\n                      name=\"proofreaderName\"\n                      :labelCol=\"{ style: { width: '124px'} }\" \n                      :rules=\"[{ required: true, message: '校对人不能为空' }]\"\n                    >\n                      <a-tree-select\n                        v-model:value=\"formState.proofreaderName\"\n                        show-search\n                        style=\"width: 100%\"\n                        :dropdown-style=\"{ maxHeight: '400px', overflow: 'auto' }\"\n                        tree-default-expand-all\n                        :tree-data=\"currentPersonTreeData\"\n                        tree-node-filter-prop=\"label\"\n                        @change=\"changeProofreader\"\n                        :disabled=\"disabledInput\"\n                      />\n                    </a-form-item>\n                  </a-col>\n                  <a-col :span=\"12\">\n                    <a-form-item\n                      label=\"责任部门\"\n                      name=\"responsibleDeptName\"\n                      :labelCol=\"{ style: { width: '124px'} }\" \n                      :rules=\"[{ required: true, message: '责任部门不能为空' }]\"\n                    >\n                      <a-tree-select\n                        v-model:value=\"formState.responsibleDeptName\"\n                        show-search\n                        style=\"width: 100%\"\n                        :dropdown-style=\"{ maxHeight: '400px', overflow: 'auto' }\"\n                        tree-default-expand-all\n                        :tree-data=\"currentOrgTreeData\"\n                        tree-node-filter-prop=\"label\"\n                        @change=\"changeResponsibleDept\"\n                        :disabled=\"disabledInput\"\n                      />\n                    </a-form-item>\n                  </a-col>\n\n                  <a-col :span=\"24\">\n                    <a-form-item\n                      label=\"接收范围\"\n                      name=\"receiver\"\n                      :labelCol=\"{ style: { width: '124px'} }\" \n                      :rules=\"[{ required: true, message: '接收范围不能为空' }]\"\n                    >\n                      <div v-if=\"!disabledInput\" :style=\"{ float: 'left', width: '10%' }\">\n                        <a-button type=\"link\" @click=\"openReceiver\">选择</a-button>\n                        <a-button type=\"link\" @click=\"cleanReceiver\">清空</a-button>\n                      </div>\n                      <a-input\n                        v-model:value=\"formState.receiverName\"\n                        disabled=\"true\"\n                        :style=\"{ width: !disabledInput ? '90%' : '100%' }\"\n                      />\n                    </a-form-item>\n                  </a-col>\n\n                  <a-col :span=\"24\">\n                    <a-form-item\n                      label=\"审批人\"\n                      name=\"handler\"\n                      :labelCol=\"{ style: { width: '124px'} }\" \n                      :rules=\"[{ required: true, message: '审批人不能为空' }]\"\n                    >\n                      <div v-if=\"!disabledInput\" :style=\"{ float: 'left', width: '10%' }\">\n                        <a-button type=\"link\" @click=\"openHandler\">选择</a-button>\n                        <a-button type=\"link\" @click=\"cleanHandler\">清空</a-button>\n                      </div>\n                      <a-input\n                        v-model:value=\"formState.handlerName\"\n                        disabled=\"true\"\n                        :style=\"{ width: !disabledInput ? '90%' : '100%' }\"\n                      />\n                    </a-form-item>\n                  </a-col>\n                  <a-col :span=\"24\">\n                    <a-form-item\n                      label=\"发文主题\"\n                      name=\"subject\"\n                      :labelCol=\"{ style: { width: '124px'} }\" \n                      :rules=\"[{ required: true, message: '发文主题不能为空' }]\"\n                    >\n                      <a-input\n                        v-model:value=\"formState.subject\"\n                        :disabled=\"disabledInput\"\n                        maxlength=\"128\"\n                      />\n                    </a-form-item>\n                  </a-col>\n                  <a-col :span=\"24\">\n                    <a-form-item\n                      label=\"发文说明\"\n                      name=\"remarks\"\n                      :labelCol=\"{ style: { width: '124px'} }\" \n                      :rules=\"[{ required: false, message: '发文说明不能为空' }]\"\n                    >\n                      <a-textarea\n                        :rows=\"3\"\n                        v-model:value=\"formState.remarks\"\n                        placeholder=\"1000字以内\"\n                        :maxlength=\"1000\"\n                        :disabled=\"disabledInput\"\n                        show-count\n                      />\n                    </a-form-item>\n                  </a-col>\n                </a-row>\n              </a-card>\n              <a-card title=\"正文\" :bordered=\"false\">\n                <Tinymce\n                  class=\"tinymce-comp-content\"\n                  v-model=\"formState.content\"\n                  :width=\"`calc(100% - 3.5rem)`\"\n                  :height=\"300\"\n                  :maxChars=\"20000\"\n                  :disabled=\"disabledInput\"\n                />\n              </a-card>\n              <a-card title=\"附件上传\" :bordered=\"false\">\n                <UploadBox\n                  :width=\"800\"\n                  :height=\"550\"\n                  :maxCount=\"20\"\n                  :maxSize=\"100 * 1024 * 1024\"\n                  :application=\"`oa`\"\n                  :module=\"`officedoc`\"\n                  :vmode=\"!disabledInput ? `box` : `view`\"\n                  :bizId=\"formState.bizFileId\"\n                />\n              </a-card>\n            </a-form>\n          </div>\n          <OrganDialog\n            title=\"选择接收范围\"\n            v-model:visible=\"openDialog\"\n            :value=\"formState.receiver\"\n            :tdata=\"orgTreeData\"\n            :tfields=\"{ key: 'value', title: 'label' }\"\n            :width=\"800\"\n            :height=\"600\"\n            @cancel=\"receiverCancel\"\n            @confirm=\"receiverConfirm\"\n          />\n          <OrganDialog\n            title=\"选择审批人\"\n            v-model:visible=\"openHandlerDialog\"\n            :value=\"formState.handler\"\n            :tdata=\"personTreeData\"\n            :tfields=\"{ key: 'value', title: 'label' }\"\n            :width=\"800\"\n            :height=\"600\"\n            @cancel=\"handlerCancel\"\n            @confirm=\"handlerConfirm\"\n          />\n          <template v-for=\"item in formState.handlerBackList\">\n            {{ item.title + ',' + item.value }}\n          </template>\n        </div>\n      </a-spin>\n    </div>\n  </PageWrapper>\n</template>\n<script lang=\"ts\" setup>\n  //form\n  import { PageWrapper } from '/@/components/Page';\n  import { reactive, ref, onMounted, toRaw, computed, onActivated, nextTick } from 'vue';\n  // import PrintButton from '/@/components/Framework/Button/PrintButton.vue';\n  import { FormInstance } from 'ant-design-vue';\n  import { SysMessage } from '/@/hooks/web/useMessage';\n  import { MsgManager } from '/@/message/MsgManager';\n  import { createData, getData, getOrgTree, getInfoKind } from './create';\n  import OrganDialog from '@/components/Framework/Modal/OrganDialog.vue';\n  import DictSelectBox from '@/components/Framework/Combox/DictSelectBox.vue';\n  import BillTitle from '/@/components/Framework/BillTitle/BillTitle.vue';\n  import WfApproveBox from '/@/components/Framework/WorkFlow/WfApproveBox.vue';\n  import type { TreeSelectProps } from 'ant-design-vue';\n  import { closeCurrentTab } from '@/utils/route';\n  import { Tinymce } from '/@/components/Tinymce/index';\n  import UploadBox from '@/components/Framework/Combox/UploadBox.vue';\n  import { buildShortUUID } from '@/utils/uuid';\n  import * as ProcessInstanceApi from '@/api/bpm/processInstance';\n  import { scrollToInValidField } from '@/utils/formUtils';\n  import dayjs from 'dayjs';\n  import { urlToPath } from '/@/utils/route';\n  import { useUserStore } from '/@/store/modules/user';\n\n  const userStore = useUserStore();\n  const userInfo = toRaw(userStore.getUserInfo);\n  const openDialog = ref(false);\n  const openHandlerDialog = ref(false);\n\n  const isRequire = ref(true);\n  let { params } = urlToPath() as any;\n  const isReadOnly = ref(false);\n  const orgTreeData = ref<TreeSelectProps['treeData']>();\n  const currentOrgTreeData = ref<TreeSelectProps['treeData']>();\n  const personTreeData = ref<TreeSelectProps['treeData']>();\n  const currentPersonTreeData = ref<TreeSelectProps['treeData']>();\n  const processInstanceId: any = ref('');\n  const currentOrgId: any = ref('');\n  const infoKinds = reactive<any>([]);\n\n  const billTitleOptions = reactive<any>({\n    subject: '公文发布',\n  });\n  const formRef = ref<FormInstance>();\n\n  const disabledInput = computed(() => {\n    if (typeof formState.status === 'undefined') {\n      return false;\n    }\n    if (formState.status === 0 && formState.personMemberId === '') {\n      return false;\n    }\n    const status =\n      formState.status != 0 ||\n      (formState.status == 0 &&\n        formState.personMemberId != '' &&\n        formState.personMemberId.substring(0, 32) != userInfo.userId);\n    return status;\n  });\n  const formState: any = reactive({\n    id: params.id || '',\n    handler: [],\n    receiver: [],\n    spinning: false,\n    personMemberId: '',\n  });\n\n  const changeInfoKind = (id, item) => {\n    formState.infoKindId = id;\n    formState.infoKindName = item.label;\n  };\n\n  const onFinish = () => {\n    formState.spinning = true;\n    createData(formState)\n      .then((rsp) => {\n        if (rsp.result != '') {\n          formState.id = rsp.result;\n          SysMessage.getInstance().success(formState.status == 1 ? '提交成功' : '保存成功');\n          if (formState.status == 1) {\n            setTimeout(() => {\n              closeCurrentTab();\n              MsgManager.getInstance().sendMsg('office-doc', {});\n            }, 100);\n          }\n        } else {\n          isRequire.value = false;\n          formState.status = 0;\n          SysMessage.getInstance().error('保存失败.');\n        }\n        formState.spinning = false;\n      })\n      .catch((e) => {\n        isRequire.value = false;\n        formState.status = 0;\n        formState.spinning = false;\n        console.log(e);\n      });\n  };\n\n  const openReceiver = () => {\n    openDialog.value = true;\n  };\n  const cleanReceiver = () => {\n    formState.receiver = [];\n    formState.receiverName = '';\n  };\n\n  const openHandler = () => {\n    openHandlerDialog.value = true;\n  };\n  const cleanHandler = () => {\n    formState.handler = [];\n    formState.handlerName = '';\n  };\n\n  const receiverCancel = () => {\n    openDialog.value = false; // 关闭弹框\n  };\n\n  const receiverConfirm = (nodeList, allList) => {\n    openDialog.value = false;\n    if (nodeList && nodeList.length > 0) {\n      formState.receiver = [];\n      nodeList.forEach((e) => {\n        formState.receiver.push({\n          orgUnitId: e.value,\n          name: e.label,\n          value: e.value,\n          label: e.label,\n        });\n      });\n    } else {\n      formState.receiver = [];\n    }\n    formState.receiverName = formState.receiver.map((e) => e.name).join(',');\n  };\n\n  const handlerCancel = () => {\n    openHandlerDialog.value = false; // 关闭弹框\n  };\n\n  const handlerConfirm = (nodeList, allList) => {\n    openHandlerDialog.value = false;\n    if (nodeList && nodeList.length > 0) {\n      formState.handler = [];\n      nodeList.forEach((e) => {\n        formState.handler.push({\n          orgUnitId: e.value,\n          name: e.label,\n          value: e.value,\n          label: e.label,\n        });\n      });\n    } else {\n      formState.handler = [];\n    }\n    formState.handlerName = formState.handler.map((e) => e.name).join(',');\n  };\n\n  const flowOption = {\n    handleAgree: (flowData) => {\n      console.log('同意', flowData);\n    },\n\n    handleSave: (flowData) => {\n      console.log('保存', flowData);\n      isRequire.value = false;\n      formState.status = 0;\n      onFinish();\n    },\n\n    handleSubmit: (flowData) => {\n      console.log('提交', flowData);\n      isRequire.value = true;\n      formState.status = 1;\n      const formInstance = formRef.value;\n      if (!formInstance) {\n        return;\n      }\n      formInstance\n        .validateFields()\n        .then(() => {\n          onFinish();\n        })\n        .catch((fields) => {\n          formState.status = 0;\n          scrollToInValidField(formInstance, fields);\n        });\n    },\n  };\n\n  const changeDrafter = (value, item) => {\n    formState.drafterName = item[0];\n    formState.drafterId = value;\n  };\n\n  const changeProofreader = (value, item) => {\n    formState.proofreaderName = item[0];\n    formState.proofreaderId = value;\n  };\n  const changeResponsibleDept = (value, item) => {\n    formState.responsibleDeptName = item[0];\n    formState.responsibleDeptId = value;\n  };\n\n  const getOrgTreeData = async () => {\n    const typeSubList = await getOrgTree({\n      orgId: currentOrgId.value,\n      orgKindIds: 'ogn,dpt,pos,psm',\n      showPosition: true,\n      status: 1,\n    });\n    currentOrgTreeData.value = digDept(typeSubList.result);\n    currentPersonTreeData.value = dig(typeSubList.result, ['psm']);\n\n    const typeList = await getOrgTree({\n      orgId: '',\n      orgKindIds: 'ogn,dpt,pos,psm',\n      showPosition: true,\n      status: 1,\n    });\n\n    orgTreeData.value = dig(typeList.result, ['psm', 'dpt', 'ogn']);\n    personTreeData.value = dig(typeList.result, ['psm']);\n  };\n  function digDept(data) {\n    const list: TreeSelectProps['treeData'] = [];\n    for (let i = 0; i < data.length; i++) {\n      const item = data[i];\n      if (item.orgKindId === 'psm' || item.orgKindId === 'pos') {\n        continue;\n      }\n      const treeNode: TreeSelectProps['treeData'][number] = {\n        label: item.name,\n        value: item.id,\n        orgId: item.orgId,\n        parent_node: item.parent_node,\n        parentId: item.parentId,\n        disabled: false,\n      };\n\n      if (item.children && item.children.length > 0) {\n        treeNode.children = digDept(item.children);\n      }\n      list.push(treeNode);\n    }\n    return list;\n  }\n\n  function dig(data, selectType) {\n    const list: TreeSelectProps['treeData'] = [];\n    for (let i = 0; i < data.length; i++) {\n      const item = data[i];\n\n      const treeNode: TreeSelectProps['treeData'][number] = {\n        label: item.name,\n        value: item.id,\n        orgId: item.orgId,\n        parent_node: item.parent_node,\n        parentId: item.parentId,\n        disabled: selectType.indexOf(item.orgKindId) == -1,\n      };\n\n      if (item.children && item.children.length > 0) {\n        treeNode.children = dig(item.children, selectType);\n      }\n      list.push(treeNode);\n    }\n    return list;\n  }\n\n  // global\n  onMounted(async () => {\n    processInstanceId.value = params.processInstanceId;\n    if (!formState.id && params.processInstanceId) {\n      const processInstance = await ProcessInstanceApi.getProcessInstance(\n        params.processInstanceId as string,\n      );\n\n      formState.id = processInstance.businessKey;\n    }\n    await getData({ id: formState.id }).then((rsp) => {\n      let rs = rsp.result;\n      if (formState.id) {\n        for (let key in rs) {\n          formState[key] = rs[key];\n        }\n        formState.dispatchYear = formState.dispatchYear + '';\n        formState.status = Number(formState.status);\n        currentOrgId.value = rs.organId;\n        if (rs.receiver) {\n          formState.receiver = [];\n          rs.receiver.forEach((e) => {\n            formState.receiver.push({\n              value: e.orgUnitId,\n              label: e.orgUnitName,\n              orgUnitId: e.orgUnitId,\n              name: e.orgUnitName,\n            });\n          });\n          formState.receiverName = formState.receiver.map((e) => e.name).join(',');\n        }\n        if (rs.handler) {\n          formState.handler = [];\n          rs.handler.forEach((e) => {\n            formState.handler.push({\n              value: e.orgUnitId,\n              label: e.orgUnitName,\n              orgUnitId: e.orgUnitId,\n              name: e.orgUnitName,\n            });\n          });\n          formState.handlerName = formState.handler.map((e) => e.name).join(',');\n        }\n      } else {\n        formState.billCode = rs.billCode;\n        formState.personMemberName = rs.personMemberName;\n        formState.deptName = rs.deptName;\n        formState.fillinDate = rs.fillinDate;\n        formState.bizFileId = buildShortUUID();\n        formState.status = 0;\n        formState.dispatchYear = dayjs().format('YYYY');\n        const userCache = useUserStore() as any;\n        const orgs = userCache.userInfo.orgs;\n        let mainOrg = orgs.filter((e) => e.isMainOrg == 1)[0];\n        if (mainOrg == null) {\n          mainOrg = orgs[0];\n        }\n        formState.organName = mainOrg.orgName;\n        formState.organId = mainOrg.orgId;\n        formState.drafterId = mainOrg.id;\n        formState.drafterName = mainOrg.name;\n        formState.responsibleDeptName = mainOrg.deptName;\n        formState.responsibleDeptId = mainOrg.deptId;\n        currentOrgId.value = mainOrg.orgId;\n      }\n      if (formState.status == 0) {\n        getOrgTreeData();\n        const userCache = useUserStore() as any;\n        const orgs = userCache.userInfo.orgs;\n        let orgIds = orgs.map((e) => e.orgId);\n        getInfoKind({ type: 'infoKind', codePre: '01', orgId: orgIds.join(',') }).then((resp) => {\n          resp.result.forEach((e) => {\n            infoKinds.push({ value: e.id, label: e.name });\n          });\n        });\n      } else {\n        infoKinds.push({ value: formState.infoKindId, label: formState.infoKindName });\n      }\n      let { billCode, fillinDate, personMemberName, deptName } = rs;\n      Object.assign(billTitleOptions, { billCode, fillinDate, personMemberName, deptName });\n    });\n  });\n</script>\n<style lang=\"less\" scoped>\n  .customer_require::before {\n    content: '*';\n    display: inline-block;\n    margin-right: 4px;\n    color: #ff4d4f;\n    font-family: SimSun, sans-serif;\n    font-size: 14px;\n    line-height: 1;\n  }\n\n  .ant-btn {\n    padding: 4px 12px;\n  }\n\n  .vben-tinymce-container {\n    margin: 0.05rem 0 0.5rem 1.75rem;\n  }\n</style>\n"],"names":["getData","params","defHttp","createData","getOrgTree","getInfoKind","scrollToInValidField","formInstance","fields","index","field","name","error","userStore","useUserStore","userInfo","toRaw","openDialog","ref","openHandlerDialog","isRequire","urlToPath","isReadOnly","orgTreeData","currentOrgTreeData","personTreeData","currentPersonTreeData","processInstanceId","currentOrgId","infoKinds","reactive","billTitleOptions","formRef","disabledInput","computed","formState","changeInfoKind","id","item","onFinish","rsp","SysMessage","closeCurrentTab","MsgManager","e","openReceiver","cleanReceiver","openHandler","cleanHandler","receiverCancel","receiverConfirm","nodeList","allList","handlerCancel","handlerConfirm","flowOption","flowData","changeDrafter","value","changeProofreader","changeResponsibleDept","getOrgTreeData","__async","typeSubList","digDept","dig","typeList","data","list","i","treeNode","selectType","onMounted","processInstance","ProcessInstanceApi.getProcessInstance","rs","key","buildShortUUID","dayjs","orgs","mainOrg","orgIds","resp","billCode","fillinDate","personMemberName","deptName"],"mappings":"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"}