{"version":3,"file":"MiddleContent-5cdd3fe2.js","sources":["../../src/views/da/cockpit/operation/MiddleContent.vue"],"sourcesContent":["<template>\n  <div class=\"middle-content\" :key=\"instanceKey\">\n    <div class=\"left-section section-box\">\n      <div class=\"section-bg\">\n        <SubtitleBar :subtitle=\"`巡检统计`\">\n          <a-select\n            v-model:value=\"formState.inspection\"\n            :options=\"dimensionTypeData\"\n            @change=\"handleInspectionChange\"\n            style=\"width: 1.2rem\"\n            v-show=\"dimensionTypeData.length > 1\"\n          />\n        </SubtitleBar>\n        <IndicatorGroup\n          :data=\"securityData\"\n          :style=\"tabStatus === 'on' ? 'margin-top: -0.15rem' : 'margin-top: -0.2rem'\"\n          class=\"indicator-group-layout\"\n          :class=\"tabStatus === 'on' ? '' : 'fix-indicator-group-padding'\"\n          @click-item=\"toBiReport('inspection')\"\n        />\n        <div style=\"width: 100%; height: 2rem\">\n          <div style=\"margin-left: 0.16rem; transform: scale(0.85); transform-origin: 0 0\">\n            <EchartLineBarChart\n              :data=\"inspectionChartData\"\n              :colors=\"inspectionChartData.colors\"\n              :width=\"`36.14vw`\"\n              :height=\"tabStatus === 'on' ? `34.8vh` : `39vh`\"\n              :category=\"inspectionChartData.categories\"\n              ybgcolor=\"#01B7D730\"\n              :name=\"inspectionChartSeriesName\"\n              @click-item=\"inspectionCharToBiReport\"\n              :dataZoomDefaultValueRange=\"inspectionChartData.dataZoomDefaultValueRange\"\n              :dataZoomDisabled=\"false\"\n              :dataZoomMaxValueSpan=\"inspectionChartData.categories.length\"\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"middle-section section-box\">\n      <div class=\"section-bg\">\n        <SubtitleBar :subtitle=\"`工单统计`\">\n          <a-select\n            v-model:value=\"formState.workOrder\"\n            :options=\"dimensionTypeData\"\n            @change=\"handleWorkOrderChange\"\n            style=\"width: 1.2rem\"\n            v-show=\"dimensionTypeData.length > 1\"\n          />\n        </SubtitleBar>\n        <IndicatorGroup\n          :data=\"workData\"\n          :style=\"tabStatus === 'on' ? 'margin-top: -0.15rem' : 'margin-top: -0.2rem'\"\n          class=\"indicator-group-layout2\"\n          :class=\"tabStatus === 'on' ? '' : 'fix-indicator-group-padding'\"\n          @click-item=\"toBiReport('workOrder')\"\n        />\n        <div style=\"width: 100%; height: 2rem\">\n          <div style=\"margin-left: 0.16rem; transform: scale(0.85); transform-origin: 0 0\">\n            <EchartPillarChart\n              :data=\"workOrderChartData\"\n              :colors=\"workOrderChartData.colors\"\n              :width=\"`36.14vw`\"\n              :height=\"tabStatus === 'on' ? `34.8vh` : `39vh`\"\n              :name=\"workOrderChartSeriesName\"\n              @click-item=\"workOrderCharToBiReport\"\n              :dataZoomDefaultValueRange=\"workOrderChartData.dataZoomDefaultValueRange\"\n              :dataZoomDisabled=\"false\"\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"right-section section-box\">\n      <div class=\"section-bg\">\n        <SubtitleBar :subtitle=\"`细则统计`\">\n          <a-select\n            v-model:value=\"formState.netIncome\"\n            :options=\"dimensionTypeData\"\n            @change=\"handleNetIncomeChange\"\n            style=\"width: 1.2rem\"\n            v-show=\"dimensionTypeData.length > 1\"\n          />\n        </SubtitleBar>\n        <IndicatorGroup\n          :data=\"assessData\"\n          :style=\"tabStatus === 'on' ? 'margin-top: -0.15rem' : 'margin-top: -0.2rem'\"\n          class=\"indicator-group-layout3\"\n          :class=\"tabStatus === 'on' ? '' : 'fix-indicator-group-padding'\"\n          @click-item=\"toBiReport('assess')\"\n        />\n        <div style=\"width: 100%; height: 1.85rem\">\n          <div style=\"margin-left: 0.16rem; transform: scale(0.85); transform-origin: 0 0\">\n            <EchartLineBarChart\n              :data=\"assessChartData\"\n              :width=\"`36.14vw`\"\n              :height=\"tabStatus === 'on' ? `34.8vh` : `39vh`\"\n              :category=\"assessChartData.categories\"\n              :name=\"assessChartSeriesName\"\n              ybgcolor=\"#01B7D730\"\n              @click-item=\"netIncomeCharToBiReport\"\n              :dataZoomDefaultValueRange=\"assessChartData.dataZoomDefaultValueRange\"\n              :dataZoomDisabled=\"false\"\n            />\n            <!-- <EchartLineBarChart\n              :data=\"ticketChartData\"\n              :colors=\"ticketChartData.colors\"\n              :width=\"`36.14vw`\"\n              :height=\"tabStatus === 'on' ? `34.8vh` : `39vh`\"\n              :category=\"ticketChartData.categories\"\n              ybgcolor=\"#01B7D730\"\n              :name=\"ticketChartSeriesName\"\n              @click-item=\"ticketCharToBiReport\"\n              :dataZoomDisabled=\"false\"\n              :dataZoomMaxValueSpan=\"ticketChartData.categories.length\"\n              :dataZoomDefaultValueRange=\"ticketChartData.dataZoomDefaultValueRange\"\n            /> -->\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\n  import { ref, onMounted, defineProps, watch, reactive, UnwrapRef } from 'vue';\n  import SubtitleBar from '/@/components/Framework/Chart/SubtitleBar.vue';\n  import IndicatorGroup from '/@/components/Framework/Chart/IndicatorGroup.vue';\n  import EchartLineBarChart from '/@/components/Framework/Chart/EchartLineBarChart.vue';\n  import EchartPillarChart from '/@/components/Framework/Chart/EchartPillarChart.vue';\n  import { handleRouteChange } from '../../utils';\n  import * as OperationApi from '@/api/da/cockpit/operation';\n  import { assign } from 'lodash-es';\n  import * as CommonApi from '@/api/da/common';\n  import { buildUUID } from '@/utils/uuid';\n\n  //搜索参数\n  const searchInfo: UnwrapRef<any> = reactive({});\n  const props = defineProps({\n    searchInfoByTime: { type: Object, default: {} },\n    tabStatus: { type: String, default: '' },\n  });\n  const instanceKey = ref(buildUUID());\n  const formState = reactive({\n    inspection: 'station',\n    workOrder: 'station',\n    netIncome: 'station',\n  });\n\n  const dimensionTypeData: any = ref([\n    // { label: '电站维度', value: 'station' },\n    // { label: '公司维度', value: 'company' },\n    // { label: '运维维度', value: 'operation' },\n  ]);\n\n  watch(\n    () => props.searchInfoByTime,\n    (value) => {\n      assign(searchInfo, value);\n      doInspectionStat(formState.inspection);\n      doWorkOrderStat(formState.workOrder);\n      doAssessRuleStat(formState.netIncome);\n    },\n  );\n\n  onMounted(async () => {\n    const sts = await CommonApi.getDictDataMap({ dictType: 'cockpit_three_dimension' });\n    sts.result.forEach((e) => {\n      dimensionTypeData.value.push({ value: e.value, label: e.label });\n    });\n  });\n  // ==================================巡检统计 begin ======================================\n\n  const securityData = ref({});\n  const inspectionChartData = ref({\n    barData: [[], []],\n    categories: [],\n    lineData: [[]],\n    colors: [\n      ['#488FF6', '#60D1F3'],\n      ['#078C5D', '#68E4B8'],\n      ['#E59837', '#FAE895'],\n      ['#e59837', '#fae895'],\n      ['#078C5D', '#68E4B8'],\n    ],\n    dataZoomDefaultValueRange: [0, 7],\n  });\n  const inspectionChartSeriesName = [['未巡检', '异常'], ['巡检率']];\n  const doInspectionStat = async (value) => {\n    const inspectionStat = await OperationApi.inspectionStat({\n      dimension: value,\n      startMonth: searchInfo.startMonth,\n      endMonth: searchInfo.endMonth,\n    });\n    if (inspectionStat) {\n      securityData.value = [\n        { label: '未巡检(次)', value: inspectionStat.unInspectionCount },\n        { label: '异常(项)', value: inspectionStat.waitCount },\n        { label: '巡检率(%)', value: inspectionStat.inspectionRate },\n      ];\n      inspectionChartData.value.barData = inspectionStat.barData || [];\n      inspectionChartData.value.categories = inspectionStat.categories || [];\n      if (inspectionStat.lineData?.length) {\n        inspectionChartData.value.lineData[0] = inspectionStat.lineData;\n      } else {\n        inspectionChartData.value.lineData = [];\n      }\n    }\n  };\n  const handleInspectionChange = (value) => {\n    doInspectionStat(value);\n  };\n\n  // ==================================工单统计 begin ======================================\n  const workData = ref({});\n  const workOrderChartData = ref({\n    barData: [[]],\n    lineData: [[]],\n    categories: [],\n    units: ['(笔)', '(%)'],\n    colors: [\n      ['#078C5D', '#68E4B8'],\n      ['#E59837', '#FAE895'],\n      ['#078C5D', '#68E4B8'],\n    ],\n    dataZoomDefaultValueRange: [0, 7],\n  });\n  const workOrderChartSeriesName = ['未闭环', '闭环率'];\n  const doWorkOrderStat = async (value) => {\n    const workOrderStat = await OperationApi.workOrderStat({\n      dimension: value,\n      startMonth: searchInfo.startMonth,\n      endMonth: searchInfo.endMonth,\n    });\n    if (workOrderStat) {\n      workData.value = [\n        { label: '未闭环(笔)', value: workOrderStat.unHandleCount },\n        { label: '闭环率(%)', value: workOrderStat.handleRate },\n      ];\n      workOrderChartData.value.barData = workOrderStat.barData || [];\n      workOrderChartData.value.categories = workOrderStat.categories || [];\n      if (workOrderStat.lineData?.length) {\n        workOrderChartData.value.lineData[0] = workOrderStat.lineData;\n      } else {\n        workOrderChartData.value.lineData = [];\n      }\n    }\n  };\n  const handleWorkOrderChange = (value) => {\n    doWorkOrderStat(value);\n  };\n\n  // ==================================细则统计 begin ======================================\n  const assessData = ref({});\n  const assessChartData = ref({\n    barData: [[]],\n    units: ['(万元)', '(万元)', '(%)'],\n    categories: [],\n    colors: [\n      ['#488FF6', '#60D1F3'],\n      ['#E59837', '#FAE895'],\n      ['#078C5D', '#68E4B8'],\n    ],\n    dataZoomDefaultValueRange: [0, 7],\n  });\n  const assessChartSeriesName = [['考核分摊（万元）', '补偿返回（万元）', '净收入（万元）']];\n  const doAssessRuleStat = async (value) => {\n    const assessRuleStat = await OperationApi.assessRuleStat({\n      dimension: value,\n      startMonth: searchInfo.startMonth,\n      endMonth: searchInfo.endMonth,\n    });\n    if (assessRuleStat) {\n      assessData.value = [\n        { label: '考核分摊(万元)', value: assessRuleStat.outAmount },\n        { label: '补偿返还(万元)', value: assessRuleStat.inAmount },\n        { label: '净收入(万元)', value: assessRuleStat.netIncome },\n      ];\n      assessChartData.value.barData = assessRuleStat.barData || [];\n      assessChartData.value.categories = assessRuleStat.categories || [];\n    }\n  };\n  const handleNetIncomeChange = (value) => {\n    doAssessRuleStat(value);\n  };\n\n  // ==================================数据穿透 ======================================\n  //指标数据\n  const toBiReport = (type: string) => {\n    if (type === 'inspection') {\n      handleRouteChange('/bi/inspection/index', {});\n    } else if (type === 'workOrder') {\n      handleRouteChange('/bi/maintenance/workorder', {});\n    } else if (type === 'assess') {\n      handleRouteChange('/bi/maintenance/assess', {});\n    }\n  };\n\n  //巡检eChart\n  const inspectionCharToBiReport = (params) => {\n    handleRouteChange('/bi/inspection/index', {\n      // TODO bi报表参数\n      stationOrganId: formState.inspection === 'company' ? params.data.id : '',\n      stationId: formState.inspection === 'station' ? params.data.id : '',\n      dateType: 'month',\n    });\n  };\n\n  //工单Echart\n  const workOrderCharToBiReport = (params) => {\n    handleRouteChange('/bi/maintenance/workorder', {\n      // TODO bi报表参数\n      stationOrganId: formState.workOrder === 'company' ? params.data.id : '',\n      stationIds: formState.workOrder === 'station' ? params.data.id : '',\n      dateType: 'month',\n    });\n  };\n\n  //两个细则Echart\n  const netIncomeCharToBiReport = (params) => {\n    handleRouteChange('/bi/maintenance/assess', {\n      // TODO bi报表参数\n      stationOrganId: formState.netIncome === 'company' ? params.data.id : '',\n      stationIds: formState.netIncome === 'station' ? params.data.id : '',\n      dateType: 'month',\n    });\n  };\n\n  // 更新组件函数\n  const handleUpdate = () => {\n    instanceKey.value = buildUUID();\n  };\n\n  defineExpose({\n    handleUpdate,\n  });\n</script>\n\n<style lang=\"less\" scoped>\n  .middle-content {\n    display: flex;\n    flex: 44.34%;\n    justify-content: space-between;\n    height: 44.34%;\n    padding-top: 0.93vh;\n\n    .section-box {\n      flex: 33.3333%;\n      width: 33.3333%;\n      height: 100%;\n    }\n\n    .section-bg {\n      width: 100%;\n      height: 100%;\n      background: url('../../../../assets/images/da/section_bg_4.png') no-repeat center/100% 100%;\n    }\n\n    .left-section {\n      padding-right: 0.56vw;\n    }\n\n    .middle-section {\n      padding: 0 0.28vw;\n    }\n\n    .right-section {\n      padding-left: 0.56vw;\n    }\n\n    :deep(.ant-select:not(.ant-select-customize-input) .ant-select-selector) {\n      height: 0.26rem !important;\n      border: 0.01rem solid #07a6ff70;\n      border-radius: 0;\n      background-color: transparent;\n    }\n\n    :deep(.ant-select-single .ant-select-selector .ant-select-selection-placeholder) {\n      height: 0.26rem;\n      line-height: 0.26rem;\n    }\n\n    :deep(.ant-select-arrow) {\n      color: rgb(255 255 255 / 50%);\n    }\n\n    .indicator-group-layout {\n      padding: 0.08rem 1.2rem 0;\n\n      &.fix-indicator-group-padding {\n        padding-top: 1.8vh;\n      }\n    }\n\n    .indicator-group-layout2 {\n      padding: 0.08rem 1.88rem 0;\n\n      &.fix-indicator-group-padding {\n        padding-top: 1.8vh;\n      }\n    }\n\n    .indicator-group-layout3 {\n      padding: 0.08rem 1rem 0;\n\n      &.fix-indicator-group-padding {\n        padding-top: 1.8vh;\n      }\n    }\n  }\n</style>\n"],"names":["searchInfo","reactive","instanceKey","ref","buildUUID","formState","dimensionTypeData","watch","props","value","assign","doInspectionStat","doWorkOrderStat","doAssessRuleStat","onMounted","__async","CommonApi.getDictDataMap","e","securityData","inspectionChartData","inspectionChartSeriesName","inspectionStat","OperationApi.inspectionStat","handleInspectionChange","workData","workOrderChartData","workOrderChartSeriesName","workOrderStat","OperationApi.workOrderStat","handleWorkOrderChange","assessData","assessChartData","assessChartSeriesName","assessRuleStat","OperationApi.assessRuleStat","handleNetIncomeChange","toBiReport","type","handleRouteChange","inspectionCharToBiReport","params","workOrderCharToBiReport","netIncomeCharToBiReport","__expose"],"mappings":"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"}