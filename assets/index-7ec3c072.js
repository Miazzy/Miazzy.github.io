var w=(e,n,l)=>new Promise((s,a)=>{var h=i=>{try{c(l.next(i))}catch(t){a(t)}},x=i=>{try{c(l.throw(i))}catch(t){a(t)}},c=i=>i.done?s(i.value):Promise.resolve(i.value).then(h,x);c((l=l.apply(e,n)).next())});import{B as z}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as C}from"./useTable-109483b3.js";import{K as S}from"./antd-15ac76ed.js";import{a0 as g,a5 as p,b as E,au as R,av as O}from"./index.js";import{e as y}from"./download-03e71dd5.js";import{P as v}from"./index-20519caf.js";import{d as K,r as Y,al as _,Z as j,a9 as P,aa as f,f as I,u as m,E as T,ad as F}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";const N=e=>p.post({url:"/bi/elec/export-settlement",params:e,responseType:"blob"},{isReturnNativeResponse:!0}),k=e=>p.get({url:"/bi/elec/settlement",params:e},{isOnlyResult:!0}),B=e=>p.get({url:"/bi/common/org/info",params:e},{isOnlyResult:!0}),$=e=>p.post({url:"/baseset/common/list-station",params:e}),o=e=>{e+="";const n=e.split("."),l=n[0].charAt(0)==="-"?"-":"";let s=l?n[0].slice(1):n[0],a="";for(;s.length>3;)a=`,${s.slice(-3)}${a}`,s=s.slice(0,s.length-3);return s&&(a=s+a),`${l}${a}${n[1]?`.${n[1]}`:""}`},A={labelWidth:120,actionColOptions:{span:24},autoAdvancedLine:1,showAdvancedButton:!0,baseColProps:{span:7},autoSubmitOnEnter:!0,noHideBtnFlag:!0,schemas:[{field:"yearValue",label:"年份",component:"YearPicker",required:!0,defaultValue:S(new Date).format("YYYY"),componentProps:{format:"YYYY",valueFormat:"YYYY",style:{width:"100%"}}},{field:"orgId",label:"所属公司",component:"ApiSelect",componentProps:{options:[],api:B,placeholder:"请选择所属公司"},show:g().isMultiOrganization},{field:"stationId",label:"电站名称",component:"ApiSelect",componentProps:{options:[],onChange:e=>{console.log(e)},api:()=>w(void 0,null,function*(){const e=yield $({}),n=[];return e.result.forEach(l=>{n.push({value:l.powerStationId,label:l.powerStationName})}),n}),placeholder:"请选择电站"}}]},b=[{title:"所属公司",dataIndex:"stationOrganName",width:150,fixed:!0,customCell:e=>({rowSpan:e.rowOrgSpan}),resizable:!0,ifShow:g().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",width:150,fixed:!0,customCell:e=>({rowSpan:e.rowStationSpan}),resizable:!0},{title:"期数",dataIndex:"periodName",width:150,fixed:!0,resizable:!0},{title:"一月",dataIndex:"jan",children:[{title:"电量(Kwh)",dataIndex:"janElec",width:100,resizable:!0},{title:"电费(元)",dataIndex:"janCost",width:100,customRender:({text:e})=>o(e),resizable:!0}]},{title:"二月",dataIndex:"feb",children:[{title:"电量(Kwh)",dataIndex:"febElec",width:100,resizable:!0},{title:"电费(元)",dataIndex:"febCost",width:100,customRender:({text:e})=>o(e),resizable:!0}]},{title:"三月",dataIndex:"mar",children:[{title:"电量(Kwh)",dataIndex:"marElec",width:100,resizable:!0},{title:"电费(元)",dataIndex:"marCost",width:100,customRender:({text:e})=>o(e),resizable:!0}]},{title:"四月",dataIndex:"apr",children:[{title:"电量(Kwh)",dataIndex:"aprElec",width:100,resizable:!0},{title:"电费(元)",dataIndex:"aprCost",width:100,customRender:({text:e})=>o(e),resizable:!0}]},{title:"五月",dataIndex:"may",children:[{title:"电量(Kwh)",dataIndex:"mayElec",width:100,resizable:!0},{title:"电费(元)",dataIndex:"mayCost",width:100,customRender:({text:e})=>o(e),resizable:!0}]},{title:"六月",dataIndex:"jun",children:[{title:"电量(Kwh)",dataIndex:"junElec",width:100,resizable:!0},{title:"电费(元)",dataIndex:"junCost",width:100,customRender:({text:e})=>o(e),resizable:!0}]},{title:"七月",dataIndex:"jul",children:[{title:"电量(Kwh)",dataIndex:"julElec",width:100,resizable:!0},{title:"电费(元)",dataIndex:"julCost",width:100,customRender:({text:e})=>o(e),resizable:!0}]},{title:"八月",dataIndex:"aug",children:[{title:"电量(Kwh)",dataIndex:"augElec",width:100,resizable:!0},{title:"电费(元)",dataIndex:"augCost",width:100,customRender:({text:e})=>o(e),resizable:!0}]},{title:"九月",dataIndex:"sept",children:[{title:"电量(Kwh)",dataIndex:"septElec",width:100,resizable:!0},{title:"电费(元)",dataIndex:"septCost",width:100,customRender:({text:e})=>o(e),resizable:!0}]},{title:"十月",dataIndex:"oct",children:[{title:"电量(Kwh)",dataIndex:"octElec",width:100,resizable:!0},{title:"电费(元)",dataIndex:"octCost",width:100,customRender:({text:e})=>o(e),resizable:!0}]},{title:"十一月",dataIndex:"nov",children:[{title:"电量(Kwh)",dataIndex:"novElec",width:100,resizable:!0},{title:"电费(元)",dataIndex:"novCost",width:100,customRender:({text:e})=>o(e),resizable:!0}]},{title:"十二月",dataIndex:"dev",children:[{title:"电量(Kwh)",dataIndex:"devElec",width:100,resizable:!0},{title:"电费(元)",dataIndex:"devCost",width:100,customRender:({text:e})=>o(e),resizable:!0}]},{title:"合计",dataIndex:"total",children:[{title:"电量(Kwh)",dataIndex:"totalElec",width:100,resizable:!0},{title:"电费(元)",dataIndex:"totalCost",width:100,customRender:({text:e})=>o(e),resizable:!0}]}],me=K({__name:"index",setup(e){const{t:n}=E(),{createConfirm:l,createMessage:s}=R(),a=Y({});function h(){l({title:n("common.message.confirmTitle"),iconType:"warning",content:n("common.message.exportMessage"),onOk(){return w(this,null,function*(){Object.assign(a,c().getFieldsValue()),a.filename="结算电量统计.xls",a.excelList=b,yield N(a).then(t=>{y(t==null?void 0:t.data,a.filename)}),a.filename=null,a.excelList=null,s.success(n("common.exportSuccessText"))})}})}const[x,{getForm:c}]=C({title:"结算电量统计",api:k,columns:b,formConfig:A,useSearchForm:!0,bordered:!0,pagination:!1,showIndexColumn:!0,showTableSetting:!0,indexColumnProps:{fixed:!0},tableSetting:{redo:!1,size:!1,setting:!1,fullScreen:!1},afterFetch:function(i){const t={};for(let d=0;d<i.length;d++){const r=i[d];t[r.stationOrganId]&&t[r.stationOrganId]++,t[r.stationId]&&t[r.stationId]++,t[r.stationOrganId]||(t[r.stationOrganId]=1),t[r.stationId]||(t[r.stationId]=1)}for(let d=0;d<i.length;d++){const r=i[d];for(const u in t)r.stationOrganId===u&&(r.rowOrgSpan=t[u],t[u]=0),r.stationId===u&&(r.rowStationSpan=t[u],t[u]=0)}return i}});return(i,t)=>{const d=_("a-button");return j(),P(m(v),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:f(()=>[I(m(z),{onRegister:m(x),onResizeColumn:t[0]||(t[0]=(r,u)=>u.width=r)},{toolbar:f(()=>[I(d,{class:"yellow-btn",preIcon:m(O).EXPORT,onClick:h},{default:f(()=>[T(F(m(n)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])]),_:1})}}});export{me as default};
//# sourceMappingURL=index-7ec3c072.js.map
