{"version":3,"file":"processEditor-fa5cde7b.js","sources":["../../node_modules/.pnpm/diagram-js@12.3.0/node_modules/diagram-js/lib/util/Event.js","../../node_modules/.pnpm/diagram-js@12.3.0/node_modules/diagram-js/lib/util/Platform.js","../../node_modules/.pnpm/diagram-js@12.3.0/node_modules/diagram-js/lib/util/Mouse.js","../../src/components/Bpm/package/designer/plugins/content-pad/contentPadProvider.js","../../src/components/Bpm/package/designer/plugins/content-pad/index.js","../../src/components/Bpm/package/designer/plugins/palette/CustomPalette.js","../../src/components/Bpm/package/designer/plugins/palette/index.js","../../src/utils/propType.ts","../../src/components/Framework/ContentWrap/ContentWrap.vue","../../src/views/bpm/manage/workflow/processEditor.vue"],"sourcesContent":["/**\n * @typedef {import('../util/Types').Point} Point\n */\n\nfunction __stopPropagation(event) {\n  if (!event || typeof event.stopPropagation !== 'function') {\n    return;\n  }\n\n  event.stopPropagation();\n}\n\n/**\n * @param {import('../core/EventBus').Event} event\n *\n * @return {Event}\n */\nexport function getOriginal(event) {\n  return event.originalEvent || event.srcEvent;\n}\n\n/**\n * @param {Event|import('../core/EventBus').Event} event\n */\nexport function stopPropagation(event) {\n  __stopPropagation(event);\n  __stopPropagation(getOriginal(event));\n}\n\n/**\n * @param {Event} event\n *\n * @return {Point|null}\n */\nexport function toPoint(event) {\n\n  if (event.pointers && event.pointers.length) {\n    event = event.pointers[0];\n  }\n\n  if (event.touches && event.touches.length) {\n    event = event.touches[0];\n  }\n\n  return event ? {\n    x: event.clientX,\n    y: event.clientY\n  } : null;\n}","export function isMac() {\n  return (/mac/i).test(navigator.platform);\n}","import {\n  getOriginal as getOriginalEvent\n} from './Event';\n\nimport {\n  isMac\n} from './Platform';\n\nexport {\n  isMac\n} from './Platform';\n\n/**\n * @param {MouseEvent} event\n * @param {string} button\n *\n * @return {boolean}\n */\nexport function isButton(event, button) {\n  return (getOriginalEvent(event) || event).button === button;\n}\n\n/**\n * @param {MouseEvent} event\n *\n * @return {boolean}\n */\nexport function isPrimaryButton(event) {\n\n  // button === 0 -> left áka primary mouse button\n  return isButton(event, 0);\n}\n\n/**\n * @param {MouseEvent} event\n *\n * @return {boolean}\n */\nexport function isAuxiliaryButton(event) {\n\n  // button === 1 -> auxiliary áka wheel button\n  return isButton(event, 1);\n}\n\n/**\n * @param {MouseEvent} event\n *\n * @return {boolean}\n */\nexport function isSecondaryButton(event) {\n\n  // button === 2 -> right áka secondary button\n  return isButton(event, 2);\n}\n\n/**\n * @param {MouseEvent} event\n *\n * @return {boolean}\n */\nexport function hasPrimaryModifier(event) {\n  var originalEvent = getOriginalEvent(event) || event;\n\n  if (!isPrimaryButton(event)) {\n    return false;\n  }\n\n  // Use cmd as primary modifier key for mac OS\n  if (isMac()) {\n    return originalEvent.metaKey;\n  } else {\n    return originalEvent.ctrlKey;\n  }\n}\n\n/**\n * @param {MouseEvent} event\n *\n * @return {boolean}\n */\nexport function hasSecondaryModifier(event) {\n  var originalEvent = getOriginalEvent(event) || event;\n\n  return isPrimaryButton(event) && originalEvent.shiftKey;\n}\n","import { assign, forEach, isArray } from 'min-dash';\nimport { is } from 'bpmn-js/lib/util/ModelUtil';\nimport { isExpanded, isEventSubProcess } from 'bpmn-js/lib/util/DiUtil';\nimport { isAny } from 'bpmn-js/lib/features/modeling/util/ModelingUtil';\nimport { getChildLanes } from 'bpmn-js/lib/features/modeling/util/LaneUtil';\nimport { hasPrimaryModifier } from 'diagram-js/lib/util/Mouse';\n\nexport default function ContextPadProvider(\n  config,\n  injector,\n  eventBus,\n  contextPad,\n  modeling,\n  elementFactory,\n  connect,\n  create,\n  popupMenu,\n  canvas,\n  rules,\n  translate,\n) {\n  config = config || {};\n  contextPad.registerProvider(this);\n  this._contextPad = contextPad;\n  this._modeling = modeling;\n  this._elementFactory = elementFactory;\n  this._connect = connect;\n  this._create = create;\n  this._popupMenu = popupMenu;\n  this._canvas = canvas;\n  this._rules = rules;\n  this._translate = translate;\n\n  if (config.autoPlace !== false) {\n    this._autoPlace = injector.get('autoPlace', false);\n  }\n\n  eventBus.on('create.end', 250, function (event) {\n    const context = event.context;\n    const shape = context.shape;\n    if (!hasPrimaryModifier(event) || !contextPad.isOpen(shape)) {\n      return;\n    }\n    const entries = contextPad.getEntries(shape);\n    if (entries.replace) {\n      entries.replace.action.click(event, shape);\n    }\n  });\n}\n\nContextPadProvider.$inject = [\n  'config.contextPad',\n  'injector',\n  'eventBus',\n  'contextPad',\n  'modeling',\n  'elementFactory',\n  'connect',\n  'create',\n  'popupMenu',\n  'canvas',\n  'rules',\n  'translate',\n  'elementRegistry',\n];\n\nContextPadProvider.prototype.getContextPadEntries = function (element) {\n  const contextPad = this._contextPad,\n    modeling = this._modeling,\n    elementFactory = this._elementFactory,\n    connect = this._connect,\n    create = this._create,\n    popupMenu = this._popupMenu,\n    canvas = this._canvas,\n    rules = this._rules,\n    autoPlace = this._autoPlace,\n    translate = this._translate;\n\n  const actions = {};\n\n  if (element.type === 'label') {\n    return actions;\n  }\n\n  const businessObject = element.businessObject;\n\n  function startConnect(event, element) {\n    connect.start(event, element);\n  }\n\n  function removeElement() {\n    modeling.removeElements([element]);\n  }\n\n  function getReplaceMenuPosition(element) {\n    const Y_OFFSET = 5;\n\n    const diagramContainer = canvas.getContainer(),\n      pad = contextPad.getPad(element).html;\n\n    const diagramRect = diagramContainer.getBoundingClientRect(),\n      padRect = pad.getBoundingClientRect();\n\n    const top = padRect.top - diagramRect.top;\n    const left = padRect.left - diagramRect.left;\n\n    const pos = {\n      x: left,\n      y: top + padRect.height + Y_OFFSET,\n    };\n\n    return pos;\n  }\n\n  /**\n   * Create an append action\n   * @param {string} type\n   * @param {string} className\n   * @param {string} [title]\n   * @param {Object} [options]\n   * @return {Object} descriptor\n   */\n  function appendAction(type, className, title, options) {\n    if (typeof title !== 'string') {\n      options = title;\n      title = translate('Append {type}', { type: type.replace(/^bpmn:/, '') });\n    }\n\n    function appendStart(event, element) {\n      const shape = elementFactory.createShape(assign({ type: type }, options));\n      create.start(event, shape, {\n        source: element,\n      });\n    }\n\n    const append = autoPlace\n      ? function (event, element) {\n          const shape = elementFactory.createShape(assign({ type: type }, options));\n          autoPlace.append(element, shape);\n        }\n      : appendStart;\n\n    return {\n      group: 'model',\n      className: className,\n      title: title,\n      action: {\n        dragstart: appendStart,\n        click: append,\n      },\n    };\n  }\n\n  function splitLaneHandler(count) {\n    return function (event, element) {\n      modeling.splitLane(element, count);\n      contextPad.open(element, true);\n    };\n  }\n\n  if (isAny(businessObject, ['bpmn:Lane', 'bpmn:Participant']) && isExpanded(businessObject)) {\n    const childLanes = getChildLanes(element);\n\n    assign(actions, {\n      'lane-insert-above': {\n        group: 'lane-insert-above',\n        className: 'bpmn-icon-lane-insert-above',\n        title: translate('Add Lane above'),\n        action: {\n          click: function (event, element) {\n            modeling.addLane(element, 'top');\n          },\n        },\n      },\n    });\n\n    if (childLanes.length < 2) {\n      if (element.height >= 120) {\n        assign(actions, {\n          'lane-divide-two': {\n            group: 'lane-divide',\n            className: 'bpmn-icon-lane-divide-two',\n            title: translate('Divide into two Lanes'),\n            action: {\n              click: splitLaneHandler(2),\n            },\n          },\n        });\n      }\n\n      if (element.height >= 180) {\n        assign(actions, {\n          'lane-divide-three': {\n            group: 'lane-divide',\n            className: 'bpmn-icon-lane-divide-three',\n            title: translate('Divide into three Lanes'),\n            action: {\n              click: splitLaneHandler(3),\n            },\n          },\n        });\n      }\n    }\n\n    assign(actions, {\n      'lane-insert-below': {\n        group: 'lane-insert-below',\n        className: 'bpmn-icon-lane-insert-below',\n        title: translate('Add Lane below'),\n        action: {\n          click: function (event, element) {\n            modeling.addLane(element, 'bottom');\n          },\n        },\n      },\n    });\n  }\n\n  if (is(businessObject, 'bpmn:FlowNode')) {\n    if (is(businessObject, 'bpmn:EventBasedGateway')) {\n      assign(actions, {\n        'append.receive-task': appendAction(\n          'bpmn:ReceiveTask',\n          'bpmn-icon-receive-task',\n          translate('Append ReceiveTask'),\n        ),\n        'append.message-intermediate-event': appendAction(\n          'bpmn:IntermediateCatchEvent',\n          'bpmn-icon-intermediate-event-catch-message',\n          translate('Append MessageIntermediateCatchEvent'),\n          { eventDefinitionType: 'bpmn:MessageEventDefinition' },\n        ),\n        'append.timer-intermediate-event': appendAction(\n          'bpmn:IntermediateCatchEvent',\n          'bpmn-icon-intermediate-event-catch-timer',\n          translate('Append TimerIntermediateCatchEvent'),\n          { eventDefinitionType: 'bpmn:TimerEventDefinition' },\n        ),\n        'append.condition-intermediate-event': appendAction(\n          'bpmn:IntermediateCatchEvent',\n          'bpmn-icon-intermediate-event-catch-condition',\n          translate('Append ConditionIntermediateCatchEvent'),\n          { eventDefinitionType: 'bpmn:ConditionalEventDefinition' },\n        ),\n        'append.signal-intermediate-event': appendAction(\n          'bpmn:IntermediateCatchEvent',\n          'bpmn-icon-intermediate-event-catch-signal',\n          translate('Append SignalIntermediateCatchEvent'),\n          { eventDefinitionType: 'bpmn:SignalEventDefinition' },\n        ),\n      });\n    } else if (\n      isEventType(businessObject, 'bpmn:BoundaryEvent', 'bpmn:CompensateEventDefinition')\n    ) {\n      assign(actions, {\n        'append.compensation-activity': appendAction(\n          'bpmn:Task',\n          'bpmn-icon-task',\n          translate('Append compensation activity'),\n          {\n            isForCompensation: true,\n          },\n        ),\n      });\n    } else if (\n      !is(businessObject, 'bpmn:EndEvent') &&\n      !businessObject.isForCompensation &&\n      !isEventType(businessObject, 'bpmn:IntermediateThrowEvent', 'bpmn:LinkEventDefinition') &&\n      !isEventSubProcess(businessObject)\n    ) {\n      assign(actions, {\n        'append.end-event': appendAction(\n          'bpmn:EndEvent',\n          'bpmn-icon-end-event-none',\n          translate('Append EndEvent'),\n        ),\n        'append.gateway': appendAction(\n          'bpmn:ExclusiveGateway',\n          'bpmn-icon-gateway-none',\n          translate('Append Gateway'),\n        ),\n        'append.append-task': appendAction(\n          'bpmn:UserTask',\n          'bpmn-icon-user-task',\n          translate('Append Task'),\n        ),\n        'append.intermediate-event': appendAction(\n          'bpmn:IntermediateThrowEvent',\n          'bpmn-icon-intermediate-event-none',\n          translate('Append Intermediate/Boundary Event'),\n        ),\n      });\n    }\n  }\n\n  if (!popupMenu.isEmpty(element, 'bpmn-replace')) {\n    assign(actions, {\n      replace: {\n        group: 'edit',\n        className: 'bpmn-icon-screw-wrench',\n        title: '修改类型',\n        action: {\n          click: function (event, element) {\n            const position = assign(getReplaceMenuPosition(element), {\n              cursor: { x: event.x, y: event.y },\n            });\n\n            popupMenu.open(element, 'bpmn-replace', position);\n          },\n        },\n      },\n    });\n  }\n\n  if (\n    isAny(businessObject, [\n      'bpmn:FlowNode',\n      'bpmn:InteractionNode',\n      'bpmn:DataObjectReference',\n      'bpmn:DataStoreReference',\n    ])\n  ) {\n    assign(actions, {\n      'append.text-annotation': appendAction('bpmn:TextAnnotation', 'bpmn-icon-text-annotation'),\n\n      connect: {\n        group: 'connect',\n        className: 'bpmn-icon-connection-multi',\n        title: translate(\n          'Connect using ' +\n            (businessObject.isForCompensation ? '' : 'Sequence/MessageFlow or ') +\n            'Association',\n        ),\n        action: {\n          click: startConnect,\n          dragstart: startConnect,\n        },\n      },\n    });\n  }\n\n  if (isAny(businessObject, ['bpmn:DataObjectReference', 'bpmn:DataStoreReference'])) {\n    assign(actions, {\n      connect: {\n        group: 'connect',\n        className: 'bpmn-icon-connection-multi',\n        title: translate('Connect using DataInputAssociation'),\n        action: {\n          click: startConnect,\n          dragstart: startConnect,\n        },\n      },\n    });\n  }\n\n  if (is(businessObject, 'bpmn:Group')) {\n    assign(actions, {\n      'append.text-annotation': appendAction('bpmn:TextAnnotation', 'bpmn-icon-text-annotation'),\n    });\n  }\n  let deleteAllowed = rules.allowed('elements.delete', { elements: [element] });\n  if (isArray(deleteAllowed)) {\n    deleteAllowed = deleteAllowed[0] === element;\n  }\n\n  if (deleteAllowed) {\n    assign(actions, {\n      delete: {\n        group: 'edit',\n        className: 'bpmn-icon-trash',\n        title: translate('Remove'),\n        action: {\n          click: removeElement,\n        },\n      },\n    });\n  }\n\n  return actions;\n};\n\nfunction isEventType(eventBo, type, definition) {\n  const isType = eventBo.$instanceOf(type);\n  let isDefinition = false;\n  const definitions = eventBo.eventDefinitions || [];\n  forEach(definitions, function (def) {\n    if (def.$type === definition) {\n      isDefinition = true;\n    }\n  });\n  return isType && isDefinition;\n}\n","import CustomContextPadProvider from './contentPadProvider';\n\nexport default {\n  __init__: ['contextPadProvider'],\n  contextPadProvider: ['type', CustomContextPadProvider],\n};\n","import PaletteProvider from 'bpmn-js/lib/features/palette/PaletteProvider';\nimport { assign } from 'min-dash';\n\nexport default function CustomPalette(\n  palette,\n  create,\n  elementFactory,\n  spaceTool,\n  lassoTool,\n  handTool,\n  globalConnect,\n  translate,\n) {\n  PaletteProvider.call(\n    this,\n    palette,\n    create,\n    elementFactory,\n    spaceTool,\n    lassoTool,\n    handTool,\n    globalConnect,\n    translate,\n    2000,\n  );\n}\n\nconst F = function () {}; // 核心，利用空对象作为中介；\nF.prototype = PaletteProvider.prototype; // 核心，将父类的原型赋值给空对象F；\n\n// 利用中介函数重写原型链方法\nF.prototype.getPaletteEntries = function () {\n  const actions = {},\n    create = this._create,\n    elementFactory = this._elementFactory,\n    spaceTool = this._spaceTool,\n    lassoTool = this._lassoTool,\n    handTool = this._handTool,\n    globalConnect = this._globalConnect,\n    translate = this._translate;\n\n  function createAction(type, group, className, title, options) {\n    function createListener(event) {\n      const shape = elementFactory.createShape(assign({ type: type }, options));\n\n      if (options) {\n        shape.businessObject.di.isExpanded = options.isExpanded;\n      }\n\n      create.start(event, shape);\n    }\n\n    const shortType = type.replace(/^bpmn:/, '');\n\n    return {\n      group: group,\n      className: className,\n      title: title || translate('Create {type}', { type: shortType }),\n      action: {\n        dragstart: createListener,\n        click: createListener,\n      },\n    };\n  }\n\n  function createSubprocess(event) {\n    const subProcess = elementFactory.createShape({\n      type: 'bpmn:SubProcess',\n      x: 0,\n      y: 0,\n      isExpanded: true,\n    });\n\n    const startEvent = elementFactory.createShape({\n      type: 'bpmn:StartEvent',\n      x: 40,\n      y: 82,\n      parent: subProcess,\n    });\n\n    create.start(event, [subProcess, startEvent], {\n      hints: {\n        autoSelect: [startEvent],\n      },\n    });\n  }\n\n  function createParticipant(event) {\n    create.start(event, elementFactory.createParticipantShape());\n  }\n\n  assign(actions, {\n    'hand-tool': {\n      group: 'tools',\n      className: 'bpmn-icon-hand-tool',\n      title: '激活抓手工具',\n      // title: translate(\"Activate the hand tool\"),\n      action: {\n        click: function (event) {\n          handTool.activateHand(event);\n        },\n      },\n    },\n    'lasso-tool': {\n      group: 'tools',\n      className: 'bpmn-icon-lasso-tool',\n      title: translate('Activate the lasso tool'),\n      action: {\n        click: function (event) {\n          lassoTool.activateSelection(event);\n        },\n      },\n    },\n    'space-tool': {\n      group: 'tools',\n      className: 'bpmn-icon-space-tool',\n      title: translate('Activate the create/remove space tool'),\n      action: {\n        click: function (event) {\n          spaceTool.activateSelection(event);\n        },\n      },\n    },\n    'global-connect-tool': {\n      group: 'tools',\n      className: 'bpmn-icon-connection-multi',\n      title: translate('Activate the global connect tool'),\n      action: {\n        click: function (event) {\n          globalConnect.toggle(event);\n        },\n      },\n    },\n    'tool-separator': {\n      group: 'tools',\n      separator: true,\n    },\n    'create.start-event': createAction(\n      'bpmn:StartEvent',\n      'event',\n      'bpmn-icon-start-event-none',\n      translate('Create StartEvent'),\n    ),\n    'create.intermediate-event': createAction(\n      'bpmn:IntermediateThrowEvent',\n      'event',\n      'bpmn-icon-intermediate-event-none',\n      translate('Create Intermediate/Boundary Event'),\n    ),\n    'create.end-event': createAction(\n      'bpmn:EndEvent',\n      'event',\n      'bpmn-icon-end-event-none',\n      translate('Create EndEvent'),\n    ),\n    'create.exclusive-gateway': createAction(\n      'bpmn:ExclusiveGateway',\n      'gateway',\n      'bpmn-icon-gateway-none',\n      translate('Create Gateway'),\n    ),\n    'create.user-task': createAction(\n      'bpmn:UserTask',\n      'activity',\n      'bpmn-icon-user-task',\n      translate('Create User Task'),\n    ),\n    'create.data-object': createAction(\n      'bpmn:DataObjectReference',\n      'data-object',\n      'bpmn-icon-data-object',\n      translate('Create DataObjectReference'),\n    ),\n    'create.data-store': createAction(\n      'bpmn:DataStoreReference',\n      'data-store',\n      'bpmn-icon-data-store',\n      translate('Create DataStoreReference'),\n    ),\n    'create.subprocess-expanded': {\n      group: 'activity',\n      className: 'bpmn-icon-subprocess-expanded',\n      title: translate('Create expanded SubProcess'),\n      action: {\n        dragstart: createSubprocess,\n        click: createSubprocess,\n      },\n    },\n    'create.participant-expanded': {\n      group: 'collaboration',\n      className: 'bpmn-icon-participant',\n      title: translate('Create Pool/Participant'),\n      action: {\n        dragstart: createParticipant,\n        click: createParticipant,\n      },\n    },\n    'create.group': createAction(\n      'bpmn:Group',\n      'artifact',\n      'bpmn-icon-group',\n      translate('Create Group'),\n    ),\n  });\n\n  return actions;\n};\n\nCustomPalette.$inject = [\n  'palette',\n  'create',\n  'elementFactory',\n  'spaceTool',\n  'lassoTool',\n  'handTool',\n  'globalConnect',\n  'translate',\n];\n\nCustomPalette.prototype = new F(); // 核心，将 F的实例赋值给子类；\nCustomPalette.prototype.constructor = CustomPalette; // 修复子类CustomPalette的构造器指向，防止原型链的混乱；\n","import CustomPalette from './CustomPalette';\n\nexport default {\n  __init__: ['paletteProvider'],\n  paletteProvider: ['type', CustomPalette],\n};\n","import { createTypes, VueTypesInterface, VueTypeValidableDef } from 'vue-types';\nimport { CSSProperties } from 'vue';\n\nexport type PropTypes = VueTypesInterface & {\n  readonly style: VueTypeValidableDef<CSSProperties>;\n};\n\nexport const propTypes = createTypes({\n  func: undefined,\n  bool: undefined,\n  string: undefined,\n  number: undefined,\n  object: undefined,\n  integer: undefined,\n}) as PropTypes;\n","<template>\n  <ElCard :class=\"[prefixCls, 'mb-15px']\" shadow=\"never\">\n    <template v-if=\"title\" #header>\n      <div class=\"flex items-center\">\n        <span class=\"text-16px font-700\">{{ title }}</span>\n        <ElTooltip v-if=\"message\" effect=\"dark\" placement=\"right\">\n          <template #content>\n            <div class=\"max-w-200px\">{{ message }}</div>\n          </template>\n          <Icon :size=\"14\" class=\"ml-5px\" icon=\"ep:question-filled\" />\n        </ElTooltip>\n      </div>\n    </template>\n    <div>\n      <slot></slot>\n    </div>\n  </ElCard>\n</template>\n<script lang=\"ts\" setup>\n  import { propTypes } from '@/utils/propType';\n  import { useDesigns } from '@/hooks/web/useDesign';\n  import { ElCard } from 'element-plus';\n\n  defineOptions({ name: 'ContentWrap' });\n\n  const { getPrefixCls } = useDesigns();\n\n  const prefixCls = getPrefixCls('content-wrap');\n\n  defineProps({\n    title: propTypes.string.def(''),\n    message: propTypes.string.def(''),\n  });\n</script>\n","<template>\n  <div>\n    <ContentWrap>\n      <!-- 流程设计器，负责绘制流程等 -->\n      <MyProcessDesigner\n        key=\"designer\"\n        v-if=\"xmlString !== undefined\"\n        v-model=\"xmlString\"\n        :value=\"xmlString\"\n        v-bind=\"controlForm\"\n        keyboard\n        ref=\"processDesigner\"\n        @init-finished=\"initModeler\"\n        :additionalModel=\"controlForm.additionalModel\"\n        @save=\"save\"\n      />\n      <!-- 流程属性器，负责编辑每个流程节点的属性 -->\n      <MyProcessPenal\n        key=\"penal\"\n        :bpmnModeler=\"modeler\"\n        :prefix=\"controlForm.prefix\"\n        class=\"process-panel\"\n        :model=\"model\"\n      />\n    </ContentWrap>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\n  import { MyProcessDesigner, MyProcessPenal } from '@/components/Bpm/package';\n  import CustomContentPadProvider from '@/components/Bpm/package/designer/plugins/content-pad'; // 自定义元素选中时的弹出菜单（修改 默认任务 为 用户任务）\n  import CustomPaletteProvider from '@/components/Bpm/package/designer/plugins/palette'; // 自定义左侧菜单（修改 默认任务 为 用户任务）\n  import * as ModelApi from '@/api/bpm/model';\n  import { ref, onMounted } from 'vue';\n  import { useRouter, useRoute } from 'vue-router';\n  import { useMessage } from '/@/hooks/web/useMessage';\n  import ContentWrap from '@/components/Framework/ContentWrap/ContentWrap.vue';\n  import { addTabAndClose } from '@/utils/route';\n\n  defineOptions({ name: 'BpmModelEditor' });\n\n  const router = useRouter(); // 路由\n  const { query } = useRoute(); // 路由的查询\n  const message = useMessage(); // 国际化\n\n  const xmlString = ref(undefined); // BPMN XML\n  const modeler = ref(null); // BPMN Modeler\n  const controlForm = ref({\n    simulation: true,\n    labelEditing: false,\n    labelVisible: false,\n    prefix: 'flowable',\n    headerButtonSize: 'mini',\n    additionalModel: [CustomContentPadProvider, CustomPaletteProvider],\n  });\n  const model = ref<ModelApi.ModelVO>(); // 流程模型的信息\n\n  /** 初始化 modeler */\n  const initModeler = (item) => {\n    setTimeout(() => {\n      modeler.value = item;\n    }, 10);\n  };\n\n  /** 添加/修改模型 */\n  const save = async (bpmnXml) => {\n    const data = {\n      ...model.value,\n      bpmnXml: bpmnXml, // bpmnXml 只是初始化流程图，后续修改无法通过它获得\n    } as unknown as ModelApi.ModelVO;\n    // 提交\n    if (data.id) {\n      await ModelApi.updateModel(data);\n      message.success('修改成功');\n    } else {\n      await ModelApi.createModel(data);\n      message.success('新增成功');\n    }\n    // 跳转回去\n    close();\n  };\n\n  /** 关闭按钮 */\n  const close = () => {\n    addTabAndClose('/bpm/manage/workflow', '');\n  };\n\n  /** 初始化 */\n  onMounted(async () => {\n    const modelId = query.modelId as unknown as number;\n    if (!modelId) {\n      message.error('缺少模型 modelId 编号');\n      return;\n    }\n    // 查询模型\n    const data = await ModelApi.getModel(modelId);\n    xmlString.value = data.bpmnXml;\n    model.value = {\n      ...data,\n      bpmnXml: undefined, // 清空 bpmnXml 属性\n    };\n  });\n</script>\n<style lang=\"scss\">\n  .process-panel__container {\n    position: absolute;\n    top: 90px;\n    right: 60px;\n  }\n</style>\n"],"names":["getOriginal","event","isMac","isButton","button","getOriginalEvent","isPrimaryButton","hasPrimaryModifier","originalEvent","ContextPadProvider","config","injector","eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate","shape","entries","element","autoPlace","actions","businessObject","startConnect","removeElement","getReplaceMenuPosition","diagramContainer","pad","diagramRect","padRect","top","appendAction","type","className","title","options","appendStart","assign","splitLaneHandler","count","isAny","isExpanded","childLanes","getChildLanes","is","isEventType","isEventSubProcess","position","deleteAllowed","isArray","eventBo","definition","isType","isDefinition","definitions","forEach","def","CustomContentPadProvider","CustomContextPadProvider","CustomPalette","palette","spaceTool","lassoTool","handTool","globalConnect","PaletteProvider","F","createAction","group","createListener","shortType","createSubprocess","subProcess","startEvent","createParticipant","CustomPaletteProvider","propTypes","createTypes","getPrefixCls","useDesigns","prefixCls","useRouter","query","useRoute","message","useMessage","xmlString","ref","modeler","controlForm","model","initModeler","item","save","bpmnXml","__async","data","__spreadProps","__spreadValues","ModelApi.updateModel","ModelApi.createModel","close","addTabAndClose","onMounted","modelId","ModelApi.getModel"],"mappings":"gpCAiBO,SAASA,EAAYC,EAAO,CACjC,OAAOA,EAAM,eAAiBA,EAAM,QACtC,CCnBO,SAASC,IAAQ,CACtB,MAAQ,OAAQ,KAAK,UAAU,QAAQ,CACzC,CCgBO,SAASC,GAASF,EAAOG,EAAQ,CACtC,OAAQC,EAAiBJ,CAAK,GAAKA,GAAO,SAAWG,CACvD,CAOO,SAASE,GAAgBL,EAAO,CAGrC,OAAOE,GAASF,EAAO,CAAC,CAC1B,CA6BO,SAASM,GAAmBN,EAAO,CACxC,IAAIO,EAAgBH,EAAiBJ,CAAK,GAAKA,EAE/C,OAAKK,GAAgBL,CAAK,EAKtBC,GAAK,EACAM,EAAc,QAEdA,EAAc,QAPd,EASX,CClEe,SAASC,EACtBC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACA,CACAX,EAASA,GAAU,GACnBG,EAAW,iBAAiB,IAAI,EAChC,KAAK,YAAcA,EACnB,KAAK,UAAYC,EACjB,KAAK,gBAAkBC,EACvB,KAAK,SAAWC,EAChB,KAAK,QAAUC,EACf,KAAK,WAAaC,EAClB,KAAK,QAAUC,EACf,KAAK,OAASC,EACd,KAAK,WAAaC,EAEdX,EAAO,YAAc,KACvB,KAAK,WAAaC,EAAS,IAAI,YAAa,EAAK,GAGnDC,EAAS,GAAG,aAAc,IAAK,SAAUX,EAAO,CAE9C,MAAMqB,EADUrB,EAAM,QACA,MACtB,GAAI,CAACM,GAAmBN,CAAK,GAAK,CAACY,EAAW,OAAOS,CAAK,EACxD,OAEF,MAAMC,EAAUV,EAAW,WAAWS,CAAK,EACvCC,EAAQ,SACVA,EAAQ,QAAQ,OAAO,MAAMtB,EAAOqB,CAAK,CAE/C,CAAG,CACH,CAEAb,EAAmB,QAAU,CAC3B,oBACA,WACA,WACA,aACA,WACA,iBACA,UACA,SACA,YACA,SACA,QACA,YACA,iBACF,EAEAA,EAAmB,UAAU,qBAAuB,SAAUe,EAAS,CACrE,MAAMX,EAAa,KAAK,YACtBC,EAAW,KAAK,UAChBC,EAAiB,KAAK,gBACtBC,EAAU,KAAK,SACfC,EAAS,KAAK,QACdC,EAAY,KAAK,WACjBC,EAAS,KAAK,QACdC,EAAQ,KAAK,OACbK,EAAY,KAAK,WACjBJ,EAAY,KAAK,WAEbK,EAAU,CAAA,EAEhB,GAAIF,EAAQ,OAAS,QACnB,OAAOE,EAGT,MAAMC,EAAiBH,EAAQ,eAE/B,SAASI,EAAa3B,EAAOuB,EAAS,CACpCR,EAAQ,MAAMf,EAAOuB,CAAO,CAC7B,CAED,SAASK,GAAgB,CACvBf,EAAS,eAAe,CAACU,CAAO,CAAC,CAClC,CAED,SAASM,EAAuBN,EAAS,CAGvC,MAAMO,EAAmBZ,EAAO,aAAc,EAC5Ca,EAAMnB,EAAW,OAAOW,CAAO,EAAE,KAE7BS,EAAcF,EAAiB,sBAAuB,EAC1DG,EAAUF,EAAI,wBAEVG,EAAMD,EAAQ,IAAMD,EAAY,IAQtC,MALY,CACV,EAHWC,EAAQ,KAAOD,EAAY,KAItC,EAAGE,EAAMD,EAAQ,OAAS,CAChC,CAGG,CAUD,SAASE,EAAaC,EAAMC,EAAWC,EAAOC,EAAS,CACjD,OAAOD,GAAU,WACnBC,EAAUD,EACVA,EAAQlB,EAAU,gBAAiB,CAAE,KAAMgB,EAAK,QAAQ,SAAU,EAAE,CAAC,CAAE,GAGzE,SAASI,EAAYxC,EAAOuB,EAAS,CACnC,MAAMF,EAAQP,EAAe,YAAY2B,EAAO,CAAE,KAAML,CAAI,EAAIG,CAAO,CAAC,EACxEvB,EAAO,MAAMhB,EAAOqB,EAAO,CACzB,OAAQE,CAChB,CAAO,CACF,CASD,MAAO,CACL,MAAO,QACP,UAAWc,EACX,MAAOC,EACP,OAAQ,CACN,UAAWE,EACX,MAbWhB,EACX,SAAUxB,EAAOuB,EAAS,CACxB,MAAMF,EAAQP,EAAe,YAAY2B,EAAO,CAAE,KAAML,CAAI,EAAIG,CAAO,CAAC,EACxEf,EAAU,OAAOD,EAASF,CAAK,CAChC,EACDmB,CASD,CACP,CACG,CAED,SAASE,EAAiBC,EAAO,CAC/B,OAAO,SAAU3C,EAAOuB,EAAS,CAC/BV,EAAS,UAAUU,EAASoB,CAAK,EACjC/B,EAAW,KAAKW,EAAS,EAAI,CACnC,CACG,CAED,GAAIqB,EAAMlB,EAAgB,CAAC,YAAa,kBAAkB,CAAC,GAAKmB,GAAWnB,CAAc,EAAG,CAC1F,MAAMoB,EAAaC,GAAcxB,CAAO,EAExCkB,EAAOhB,EAAS,CACd,oBAAqB,CACnB,MAAO,oBACP,UAAW,8BACX,MAAOL,EAAU,gBAAgB,EACjC,OAAQ,CACN,MAAO,SAAUpB,EAAOuB,EAAS,CAC/BV,EAAS,QAAQU,EAAS,KAAK,CAChC,CACF,CACF,CACP,CAAK,EAEGuB,EAAW,OAAS,IAClBvB,EAAQ,QAAU,KACpBkB,EAAOhB,EAAS,CACd,kBAAmB,CACjB,MAAO,cACP,UAAW,4BACX,MAAOL,EAAU,uBAAuB,EACxC,OAAQ,CACN,MAAOsB,EAAiB,CAAC,CAC1B,CACF,CACX,CAAS,EAGCnB,EAAQ,QAAU,KACpBkB,EAAOhB,EAAS,CACd,oBAAqB,CACnB,MAAO,cACP,UAAW,8BACX,MAAOL,EAAU,yBAAyB,EAC1C,OAAQ,CACN,MAAOsB,EAAiB,CAAC,CAC1B,CACF,CACX,CAAS,GAILD,EAAOhB,EAAS,CACd,oBAAqB,CACnB,MAAO,oBACP,UAAW,8BACX,MAAOL,EAAU,gBAAgB,EACjC,OAAQ,CACN,MAAO,SAAUpB,EAAOuB,EAAS,CAC/BV,EAAS,QAAQU,EAAS,QAAQ,CACnC,CACF,CACF,CACP,CAAK,CACF,CAEGyB,EAAGtB,EAAgB,eAAe,IAChCsB,EAAGtB,EAAgB,wBAAwB,EAC7Ce,EAAOhB,EAAS,CACd,sBAAuBU,EACrB,mBACA,yBACAf,EAAU,oBAAoB,CAC/B,EACD,oCAAqCe,EACnC,8BACA,6CACAf,EAAU,sCAAsC,EAChD,CAAE,oBAAqB,6BAA+B,CACvD,EACD,kCAAmCe,EACjC,8BACA,2CACAf,EAAU,oCAAoC,EAC9C,CAAE,oBAAqB,2BAA6B,CACrD,EACD,sCAAuCe,EACrC,8BACA,+CACAf,EAAU,wCAAwC,EAClD,CAAE,oBAAqB,iCAAmC,CAC3D,EACD,mCAAoCe,EAClC,8BACA,4CACAf,EAAU,qCAAqC,EAC/C,CAAE,oBAAqB,4BAA8B,CACtD,CACT,CAAO,EAED6B,EAAYvB,EAAgB,qBAAsB,gCAAgC,EAElFe,EAAOhB,EAAS,CACd,+BAAgCU,EAC9B,YACA,iBACAf,EAAU,8BAA8B,EACxC,CACE,kBAAmB,EACpB,CACF,CACT,CAAO,EAED,CAAC4B,EAAGtB,EAAgB,eAAe,GACnC,CAACA,EAAe,mBAChB,CAACuB,EAAYvB,EAAgB,8BAA+B,0BAA0B,GACtF,CAACwB,GAAkBxB,CAAc,GAEjCe,EAAOhB,EAAS,CACd,mBAAoBU,EAClB,gBACA,2BACAf,EAAU,iBAAiB,CAC5B,EACD,iBAAkBe,EAChB,wBACA,yBACAf,EAAU,gBAAgB,CAC3B,EACD,qBAAsBe,EACpB,gBACA,sBACAf,EAAU,aAAa,CACxB,EACD,4BAA6Be,EAC3B,8BACA,oCACAf,EAAU,oCAAoC,CAC/C,CACT,CAAO,GAIAH,EAAU,QAAQM,EAAS,cAAc,GAC5CkB,EAAOhB,EAAS,CACd,QAAS,CACP,MAAO,OACP,UAAW,yBACX,MAAO,OACP,OAAQ,CACN,MAAO,SAAUzB,EAAOuB,EAAS,CAC/B,MAAM4B,EAAWV,EAAOZ,EAAuBN,CAAO,EAAG,CACvD,OAAQ,CAAE,EAAGvB,EAAM,EAAG,EAAGA,EAAM,CAAG,CAChD,CAAa,EAEDiB,EAAU,KAAKM,EAAS,eAAgB4B,CAAQ,CACjD,CACF,CACF,CACP,CAAK,EAIDP,EAAMlB,EAAgB,CACpB,gBACA,uBACA,2BACA,yBACN,CAAK,GAEDe,EAAOhB,EAAS,CACd,yBAA0BU,EAAa,sBAAuB,2BAA2B,EAEzF,QAAS,CACP,MAAO,UACP,UAAW,6BACX,MAAOf,EACL,kBACGM,EAAe,kBAAoB,GAAK,4BACzC,aACH,EACD,OAAQ,CACN,MAAOC,EACP,UAAWA,CACZ,CACF,CACP,CAAK,EAGCiB,EAAMlB,EAAgB,CAAC,2BAA4B,yBAAyB,CAAC,GAC/Ee,EAAOhB,EAAS,CACd,QAAS,CACP,MAAO,UACP,UAAW,6BACX,MAAOL,EAAU,oCAAoC,EACrD,OAAQ,CACN,MAAOO,EACP,UAAWA,CACZ,CACF,CACP,CAAK,EAGCqB,EAAGtB,EAAgB,YAAY,GACjCe,EAAOhB,EAAS,CACd,yBAA0BU,EAAa,sBAAuB,2BAA2B,CAC/F,CAAK,EAEH,IAAIiB,EAAgBjC,EAAM,QAAQ,kBAAmB,CAAE,SAAU,CAACI,CAAO,CAAC,CAAE,EAC5E,OAAI8B,GAAQD,CAAa,IACvBA,EAAgBA,EAAc,CAAC,IAAM7B,GAGnC6B,GACFX,EAAOhB,EAAS,CACd,OAAQ,CACN,MAAO,OACP,UAAW,kBACX,MAAOL,EAAU,QAAQ,EACzB,OAAQ,CACN,MAAOQ,CACR,CACF,CACP,CAAK,EAGIH,CACT,EAEA,SAASwB,EAAYK,EAASlB,EAAMmB,EAAY,CAC9C,MAAMC,EAASF,EAAQ,YAAYlB,CAAI,EACvC,IAAIqB,EAAe,GACnB,MAAMC,EAAcJ,EAAQ,kBAAoB,GAChD,OAAAK,GAAQD,EAAa,SAAUE,EAAK,CAC9BA,EAAI,QAAUL,IAChBE,EAAe,GAErB,CAAG,EACMD,GAAUC,CACnB,CCrYA,MAAeI,GAAA,CACb,SAAU,CAAC,oBAAoB,EAC/B,mBAAoB,CAAC,OAAQC,CAAwB,CACvD,ECFe,SAASC,EACtBC,EACAhD,EACAF,EACAmD,EACAC,EACAC,EACAC,EACAhD,EACA,CACAiD,EAAgB,KACd,KACAL,EACAhD,EACAF,EACAmD,EACAC,EACAC,EACAC,EACAhD,EACA,GACJ,CACA,CAEA,MAAMkD,EAAI,UAAY,CAAA,EACtBA,EAAE,UAAYD,EAAgB,UAG9BC,EAAE,UAAU,kBAAoB,UAAY,CAC1C,MAAM7C,EAAU,CAAE,EAChBT,EAAS,KAAK,QACdF,EAAiB,KAAK,gBACtBmD,EAAY,KAAK,WACjBC,EAAY,KAAK,WACjBC,EAAW,KAAK,UAChBC,EAAgB,KAAK,eACrBhD,EAAY,KAAK,WAEnB,SAASmD,EAAanC,EAAMoC,EAAOnC,EAAWC,EAAOC,EAAS,CAC5D,SAASkC,EAAezE,EAAO,CAC7B,MAAMqB,EAAQP,EAAe,YAAY2B,EAAO,CAAE,KAAML,CAAI,EAAIG,CAAO,CAAC,EAEpEA,IACFlB,EAAM,eAAe,GAAG,WAAakB,EAAQ,YAG/CvB,EAAO,MAAMhB,EAAOqB,CAAK,CAC1B,CAED,MAAMqD,EAAYtC,EAAK,QAAQ,SAAU,EAAE,EAE3C,MAAO,CACL,MAAOoC,EACP,UAAWnC,EACX,MAAOC,GAASlB,EAAU,gBAAiB,CAAE,KAAMsD,EAAW,EAC9D,OAAQ,CACN,UAAWD,EACX,MAAOA,CACR,CACP,CACG,CAED,SAASE,EAAiB3E,EAAO,CAC/B,MAAM4E,EAAa9D,EAAe,YAAY,CAC5C,KAAM,kBACN,EAAG,EACH,EAAG,EACH,WAAY,EAClB,CAAK,EAEK+D,EAAa/D,EAAe,YAAY,CAC5C,KAAM,kBACN,EAAG,GACH,EAAG,GACH,OAAQ8D,CACd,CAAK,EAED5D,EAAO,MAAMhB,EAAO,CAAC4E,EAAYC,CAAU,EAAG,CAC5C,MAAO,CACL,WAAY,CAACA,CAAU,CACxB,CACP,CAAK,CACF,CAED,SAASC,EAAkB9E,EAAO,CAChCgB,EAAO,MAAMhB,EAAOc,EAAe,uBAAwB,CAAA,CAC5D,CAED,OAAA2B,EAAOhB,EAAS,CACd,YAAa,CACX,MAAO,QACP,UAAW,sBACX,MAAO,SAEP,OAAQ,CACN,MAAO,SAAUzB,EAAO,CACtBmE,EAAS,aAAanE,CAAK,CAC5B,CACF,CACF,EACD,aAAc,CACZ,MAAO,QACP,UAAW,uBACX,MAAOoB,EAAU,yBAAyB,EAC1C,OAAQ,CACN,MAAO,SAAUpB,EAAO,CACtBkE,EAAU,kBAAkBlE,CAAK,CAClC,CACF,CACF,EACD,aAAc,CACZ,MAAO,QACP,UAAW,uBACX,MAAOoB,EAAU,uCAAuC,EACxD,OAAQ,CACN,MAAO,SAAUpB,EAAO,CACtBiE,EAAU,kBAAkBjE,CAAK,CAClC,CACF,CACF,EACD,sBAAuB,CACrB,MAAO,QACP,UAAW,6BACX,MAAOoB,EAAU,kCAAkC,EACnD,OAAQ,CACN,MAAO,SAAUpB,EAAO,CACtBoE,EAAc,OAAOpE,CAAK,CAC3B,CACF,CACF,EACD,iBAAkB,CAChB,MAAO,QACP,UAAW,EACZ,EACD,qBAAsBuE,EACpB,kBACA,QACA,6BACAnD,EAAU,mBAAmB,CAC9B,EACD,4BAA6BmD,EAC3B,8BACA,QACA,oCACAnD,EAAU,oCAAoC,CAC/C,EACD,mBAAoBmD,EAClB,gBACA,QACA,2BACAnD,EAAU,iBAAiB,CAC5B,EACD,2BAA4BmD,EAC1B,wBACA,UACA,yBACAnD,EAAU,gBAAgB,CAC3B,EACD,mBAAoBmD,EAClB,gBACA,WACA,sBACAnD,EAAU,kBAAkB,CAC7B,EACD,qBAAsBmD,EACpB,2BACA,cACA,wBACAnD,EAAU,4BAA4B,CACvC,EACD,oBAAqBmD,EACnB,0BACA,aACA,uBACAnD,EAAU,2BAA2B,CACtC,EACD,6BAA8B,CAC5B,MAAO,WACP,UAAW,gCACX,MAAOA,EAAU,4BAA4B,EAC7C,OAAQ,CACN,UAAWuD,EACX,MAAOA,CACR,CACF,EACD,8BAA+B,CAC7B,MAAO,gBACP,UAAW,wBACX,MAAOvD,EAAU,yBAAyB,EAC1C,OAAQ,CACN,UAAW0D,EACX,MAAOA,CACR,CACF,EACD,eAAgBP,EACd,aACA,WACA,kBACAnD,EAAU,cAAc,CACzB,CACL,CAAG,EAEMK,CACT,EAEAsC,EAAc,QAAU,CACtB,UACA,SACA,iBACA,YACA,YACA,WACA,gBACA,WACF,EAEAA,EAAc,UAAY,IAAIO,EAC9BP,EAAc,UAAU,YAAcA,EC1NtC,MAAegB,GAAA,CACb,SAAU,CAAC,iBAAiB,EAC5B,gBAAiB,CAAC,OAAQhB,CAAa,CACzC,ECEaiB,EAAYC,GAAY,CACnC,KAAM,OACN,KAAM,OACN,OAAQ,OACR,OAAQ,OACR,OAAQ,OACR,QAAS,MACX,CAAC,yMCWO,KAAA,CAAE,aAAAC,GAAiBC,KAEnBC,EAAYF,EAAa,cAAc,kiBCc9BG,GAAU,EACnB,KAAA,CAAE,MAAAC,GAAUC,KACZC,EAAUC,KAEVC,EAAYC,EAAI,MAAS,EACzBC,EAAUD,EAAI,IAAI,EAClBE,EAAcF,EAAI,CACtB,WAAY,GACZ,aAAc,GACd,aAAc,GACd,OAAQ,WACR,iBAAkB,OAClB,gBAAiB,CAAC9B,GAA0BkB,EAAqB,CAAA,CAClE,EACKe,EAAQH,IAGRI,EAAeC,GAAS,CAC5B,WAAW,IAAM,CACfJ,EAAQ,MAAQI,GACf,EAAE,CAAA,EAIDC,EAAcC,GAAYC,EAAA,sBAC9B,MAAMC,EAAOC,EAAAC,EAAA,GACRR,EAAM,OADE,CAEX,QAAAI,CAAA,GAGEE,EAAK,IACD,MAAAG,GAAqBH,CAAI,EAC/BZ,EAAQ,QAAQ,MAAM,IAEhB,MAAAgB,GAAqBJ,CAAI,EAC/BZ,EAAQ,QAAQ,MAAM,GAGlBiB,GAAA,GAIFA,EAAQ,IAAM,CAClBC,GAAe,uBAAwB,EAAE,CAAA,EAI3C,OAAAC,GAAU,IAAYR,EAAA,sBACpB,MAAMS,EAAUtB,EAAM,QACtB,GAAI,CAACsB,EAAS,CACZpB,EAAQ,MAAM,iBAAiB,EAC/B,MACF,CAEA,MAAMY,EAAO,MAAMS,GAAkBD,CAAO,EAC5ClB,EAAU,MAAQU,EAAK,QACvBN,EAAM,MAAQO,EAAAC,EAAA,GACTF,GADS,CAEZ,QAAS,MAAA,EACX,EACD","x_google_ignoreList":[0,1,2]}