{"version":3,"file":"DailyWorkOrder.vue_vue_type_script_setup_true_lang-d2791c4d.js","sources":["../../src/views/po/workorder/DailyWorkOrder.vue"],"sourcesContent":["<template>\n  <a-card title=\"基本信息\" :bordered=\"false\">\n    <a-row :gutter=\"32\">\n      <a-col v-show=\"true\" :span=\"12\">\n        <a-form-item name=\"stationName\" label=\"电站名称\" :labelCol=\"{ class: 'detail-label-8' }\">\n          <a-input v-model:value=\"childFormState.stationName\" disabled />\n        </a-form-item>\n      </a-col>\n      <a-col v-show=\"true\" :span=\"12\">\n        <a-form-item name=\"periodName\" label=\"期数\" :labelCol=\"{ class: 'detail-label-8' }\">\n          <a-input v-model:value=\"childFormState.periodName\" disabled />\n        </a-form-item>\n      </a-col>\n    </a-row>\n\n    <a-row :gutter=\"32\">\n      <a-col v-show=\"true\" :span=\"12\">\n        <a-form-item\n          :name=\"['daily', 'dailyType']\"\n          :label=\"`${childFormOption.labelType}类型`\"\n          :labelCol=\"{ class: 'detail-label-8' }\"\n          :rules=\"[{ required: true, message: `请选择${childFormOption.labelType}类型` }]\"\n        >\n          <DictSelectBox\n            v-model:value=\"childFormState.daily.dailyType\"\n            :type=\"`work_order_work_type`\"\n            :disabled=\"disabledInput\"\n          />\n        </a-form-item>\n      </a-col>\n      <a-col v-show=\"true\" :span=\"12\">\n        <a-form-item\n          :name=\"['daily', 'dailyRange']\"\n          :label=\"`${childFormOption.labelType}范围`\"\n          :labelCol=\"{ class: 'detail-label-8' }\"\n          :rules=\"[{ required: true, message: `请选择${childFormOption.labelType}范围` }]\"\n        >\n          <DictSelectBox\n            v-model:value=\"childFormState.daily.dailyRange\"\n            :type=\"`work_order_range`\"\n            :disabled=\"disabledInput\"\n            @change=\"handleDailyRangeChange\"\n          />\n        </a-form-item>\n      </a-col>\n    </a-row>\n\n    <a-row :gutter=\"32\">\n      <a-col v-show=\"true\" :span=\"12\">\n        <a-form-item\n          :name=\"['daily', 'workCompany']\"\n          :label=\"`${childFormOption.labelType}单位`\"\n          :labelCol=\"{ class: 'detail-label-8' }\"\n          :rules=\"[{ required: true, message: `请输入${childFormOption.labelType}单位` }]\"\n        >\n          <a-input\n            v-model:value=\"childFormState.daily.workCompany\"\n            :maxlength=\"100\"\n            :disabled=\"disabledInput\"\n          />\n        </a-form-item>\n      </a-col>\n    </a-row>\n\n    <a-row :gutter=\"32\">\n      <a-col v-show=\"true\" :span=\"24\">\n        <a-form-item\n          :name=\"['daily', 'programme']\"\n          :label=\"`${childFormOption.labelType}方案`\"\n          :labelCol=\"{ class: 'detail-label-8' }\"\n          :rules=\"[{ required: true, message: `请输入${childFormOption.labelType}方案` }]\"\n        >\n          <a-textarea\n            v-model:value=\"childFormState.daily.programme\"\n            show-count\n            :rows=\"4\"\n            :maxlength=\"1000\"\n            :disabled=\"disabledInput\"\n          />\n        </a-form-item>\n      </a-col>\n    </a-row>\n\n    <a-row :gutter=\"32\">\n      <a-col v-show=\"true\" :span=\"24\">\n        <a-form-item\n          name=\"subject\"\n          label=\"工单主题\"\n          :labelCol=\"{ class: 'detail-label-8' }\"\n          :rules=\"[{ required: true, message: '请输入工单主题' }]\"\n        >\n          <a-input\n            v-model:value=\"childFormState.subject\"\n            :maxlength=\"100\"\n            :disabled=\"disabledInput\"\n          />\n        </a-form-item>\n      </a-col>\n    </a-row>\n\n    <a-row :gutter=\"32\">\n      <a-col v-show=\"true\" :span=\"12\">\n        <a-form-item\n          name=\"planStartDate\"\n          label=\"计划开始时间\"\n          :labelCol=\"{ class: 'detail-label-8' }\"\n          :rules=\"[{ required: true, message: '请输入计划开始时间' }]\"\n        >\n          <a-date-picker\n            v-model:value=\"childFormState.planStartDate\"\n            show-time\n            format=\"YYYY-MM-DD HH:mm\"\n            value-format=\"YYYY-MM-DD HH:mm\"\n            :style=\"`width: 100%`\"\n            :disabled=\"disabledInput\"\n          />\n        </a-form-item>\n      </a-col>\n      <a-col v-show=\"true\" :span=\"12\">\n        <a-form-item\n          name=\"planEndDate\"\n          label=\"计划完成时间\"\n          :labelCol=\"{ class: 'detail-label-8' }\"\n          :rules=\"[{ required: true, message: '请输入计划完成时间' }]\"\n        >\n          <a-date-picker\n            v-model:value=\"childFormState.planEndDate\"\n            show-time\n            format=\"YYYY-MM-DD HH:mm\"\n            value-format=\"YYYY-MM-DD HH:mm\"\n            :style=\"`width: 100%`\"\n            :disabled=\"disabledInput\"\n          />\n        </a-form-item>\n      </a-col>\n    </a-row>\n\n    <a-row :gutter=\"32\">\n      <a-col v-show=\"true\" :span=\"12\">\n        <a-form-item\n          name=\"grade\"\n          label=\"工单级别\"\n          :labelCol=\"{ class: 'detail-label-8' }\"\n          :rules=\"[{ required: true, message: '请选择工单级别' }]\"\n        >\n          <DictSelectBox\n            v-model:value=\"childFormState.grade\"\n            :type=\"`work_order_grade`\"\n            :disabled=\"disabledInput\"\n          />\n        </a-form-item>\n      </a-col>\n      <a-col v-show=\"true\" :span=\"12\">\n        <a-form-item\n          name=\"planHandleByName\"\n          label=\"计划处理人\"\n          :labelCol=\"{ class: 'detail-label-8' }\"\n          :rules=\"[{ required: true, message: '请选择计划处理人' }]\"\n        >\n          <a-select\n            v-model:value=\"childFormState.planHandleByName\"\n            show-search\n            allow-clear\n            style=\"width: 100%\"\n            :options=\"stationPersonOptions\"\n            @change=\"handleChangePlanHandleByName\"\n            :disabled=\"disabledInput\"\n          />\n        </a-form-item>\n      </a-col>\n    </a-row>\n\n    <a-row :gutter=\"32\">\n      <a-col v-show=\"true\" :span=\"12\">\n        <a-form-item\n          name=\"planConfirmByName\"\n          label=\"计划确认人\"\n          :labelCol=\"{ class: 'detail-label-8' }\"\n          :rules=\"[{ required: true, message: '请选择计划确认人' }]\"\n        >\n          <a-select\n            v-model:value=\"childFormState.planConfirmByName\"\n            show-search\n            allow-clear\n            style=\"width: 100%\"\n            :options=\"stationPersonOptions\"\n            @change=\"handleChangePlanConfirmByName\"\n            :disabled=\"disabledInput\"\n          />\n        </a-form-item>\n      </a-col>\n      <a-col v-show=\"true\" :span=\"12\">\n        <a-form-item\n          name=\"isInvoicing\"\n          label=\"开具两票\"\n          :labelCol=\"{ class: 'detail-label-8' }\"\n          :rules=\"[{ required: true, message: '请选择开具两票' }]\"\n        >\n          <DictSelectBox\n            v-model:value=\"childFormState.isInvoicing\"\n            :type=\"`yes_or_no`\"\n            :disabled=\"disabledInput\"\n          />\n        </a-form-item>\n      </a-col>\n    </a-row>\n  </a-card>\n\n  <a-card title=\"处理过程\" :bordered=\"false\" v-if=\"showProcess\">\n    <div id=\"more-tab-content\" class=\"tab-table-div\">\n      <a-tabs v-model:activeKey=\"activeKey\">\n        <a-tab-pane class=\"tab-pane-form\" key=\"1\" tab=\"处理过程\">\n          <a-row :gutter=\"32\">\n            <a-col v-show=\"true\" :span=\"12\">\n              <a-form-item\n                :name=\"['daily', 'startDate']\"\n                label=\"开始时间\"\n                :labelCol=\"{ class: 'detail-label-8' }\"\n                :rules=\"[{ required: true, message: '请输入开始时间' }]\"\n              >\n                <a-date-picker\n                  v-model:value=\"childFormState.daily.startDate\"\n                  show-time\n                  format=\"YYYY-MM-DD HH:mm\"\n                  value-format=\"YYYY-MM-DD HH:mm\"\n                  :style=\"`width: 100%`\"\n                  :disabled=\"disabledProcessInput\"\n                />\n              </a-form-item>\n            </a-col>\n            <a-col v-show=\"true\" :span=\"12\">\n              <a-form-item\n                :name=\"['daily', 'endDate']\"\n                label=\"结束时间\"\n                :labelCol=\"{ class: 'detail-label-8' }\"\n                :rules=\"[{ required: true, message: '请输入结束时间' }]\"\n              >\n                <a-date-picker\n                  v-model:value=\"childFormState.daily.endDate\"\n                  show-time\n                  format=\"YYYY-MM-DD HH:mm\"\n                  value-format=\"YYYY-MM-DD HH:mm\"\n                  :style=\"`width: 100%`\"\n                  :disabled=\"disabledProcessInput\"\n                />\n              </a-form-item>\n            </a-col>\n          </a-row>\n\n          <a-row v-if=\"childFormState.daily.dailyRange === 'part'\" :gutter=\"32\">\n            <a-col v-show=\"true\" :span=\"24\">\n              <a-form-item\n                :name=\"['daily', 'areaName']\"\n                :label=\"`${childFormOption.labelType}区域`\"\n                :labelCol=\"{ class: 'detail-label-8' }\"\n                :rules=\"[{ required: true, message: `请选择${childFormOption.labelType}区域` }]\"\n              >\n                <a-select\n                  v-model:value=\"childFormState.daily.areaName\"\n                  show-search\n                  allow-clear\n                  mode=\"multiple\"\n                  style=\"width: 100%\"\n                  :options=\"areasetOptions\"\n                  @change=\"handleChangeAreaName\"\n                  :disabled=\"disabledProcessInput\"\n                />\n              </a-form-item>\n            </a-col>\n          </a-row>\n\n          <a-row :gutter=\"32\">\n            <a-col v-show=\"true\" :span=\"12\">\n              <a-form-item\n                :name=\"['daily', 'num']\"\n                :label=\"childFormOption.numLabel\"\n                :labelCol=\"{ class: 'detail-label-8' }\"\n                :rules=\"[{ required: true, message: `请输入${childFormOption.numLabel}` }]\"\n              >\n                <a-input-number\n                  v-model:value=\"childFormState.daily.num\"\n                  :min=\"1\"\n                  :max=\"99999999\"\n                  :precision=\"childFormOption.numPrecision\"\n                  :disabled=\"disabledProcessInput\"\n                />\n              </a-form-item>\n            </a-col>\n          </a-row>\n\n          <a-row :gutter=\"32\">\n            <a-col v-show=\"true\" :span=\"24\">\n              <a-form-item\n                :name=\"['daily', 'participants']\"\n                label=\"参加人员\"\n                :labelCol=\"{ class: 'detail-label-8' }\"\n                :rules=\"[{ required: true, message: '请输入参加人员' }]\"\n              >\n                <a-textarea\n                  v-model:value=\"childFormState.daily.participants\"\n                  show-count\n                  :rows=\"4\"\n                  :maxlength=\"1000\"\n                  :disabled=\"disabledProcessInput\"\n                />\n              </a-form-item>\n            </a-col>\n          </a-row>\n\n          <a-row :gutter=\"32\">\n            <a-col v-show=\"true\" :span=\"24\">\n              <a-form-item\n                :name=\"['daily', 'completeOverview']\"\n                label=\"完成情况\"\n                :labelCol=\"{ class: 'detail-label-8' }\"\n                :rules=\"[{ required: true, message: '请输入完成情况' }]\"\n              >\n                <a-textarea\n                  v-model:value=\"childFormState.daily.completeOverview\"\n                  show-count\n                  :rows=\"4\"\n                  :maxlength=\"1000\"\n                  :disabled=\"disabledProcessInput\"\n                />\n              </a-form-item>\n            </a-col>\n          </a-row>\n        </a-tab-pane>\n        <a-tab-pane\n          class=\"tab-pane-table\"\n          v-if=\"childFormState.isInvoicing === '1'\"\n          key=\"2\"\n          tab=\"开具两票\"\n          force-render\n        >\n          <TicketTable\n            ref=\"ticketTableRef\"\n            :formState=\"formState\"\n            :disabledProcessInput=\"disabledProcessInput\"\n            :activeKey=\"activeKey\"\n          />\n        </a-tab-pane>\n      </a-tabs>\n    </div>\n  </a-card>\n</template>\n<script lang=\"ts\" setup>\n  import { reactive, UnwrapRef, ref, onMounted } from 'vue';\n  import type { SelectProps } from 'ant-design-vue';\n  import DictSelectBox from '@/components/Framework/Combox/DictSelectBox.vue';\n  import TicketTable from './TicketTable.vue';\n  import { getAreasetList } from './workorder.data';\n\n  const props = defineProps({\n    formState: {\n      type: Object as UnwrapRef<any>,\n      required: true,\n      default: function () {\n        return { daily: {} };\n      },\n    },\n    disabledInput: Boolean,\n    showProcess: Boolean,\n    disabledProcessInput: Boolean,\n    stationPersonOptions: Object,\n  });\n  const childFormState = reactive(props.formState);\n  const labelMap = {\n    // 除草工单\n    cc: { labelType: '除草', num: { label: '除草面积(亩)', precision: 2 } },\n    // 组件清洗工单\n    zjqx: { labelType: '清洗', num: { label: '清洗数量(块)', precision: 0 } },\n    // 螺栓紧固工单\n    lsjg: { labelType: '紧固', num: { label: '紧固数量(套)', precision: 0 } },\n    // 防腐工单\n    ff: { labelType: '防腐', num: { label: '防腐面积(㎡)', precision: 2 } },\n  };\n  const workOrderType = childFormState.workOrderType;\n  const childFormOption = reactive({\n    labelType: labelMap[workOrderType].labelType,\n    numLabel: labelMap[workOrderType].num.label,\n    numPrecision: labelMap[workOrderType].num.precision,\n  });\n\n  const areasetOptions = ref<SelectProps['options']>([]) as any;\n  const activeKey = ref('1');\n  const ticketTableRef = ref();\n\n  function handleChangePlanHandleByName(value: string, option) {\n    childFormState.planHandleById = option.lable;\n  }\n\n  function handleChangePlanConfirmByName(value: string, option) {\n    childFormState.planConfirmById = option.lable;\n  }\n\n  function handleChangeAreaName(value: string, option) {\n    childFormState.daily.areaId = option.map((item) => item.lable);\n  }\n\n  function handleDailyRangeChange(value) {\n    // 全站时清空区域数据\n    if (value === 'whole') {\n      childFormState.daily.areaId = [];\n      childFormState.daily.areaName = [];\n    }\n  }\n\n  function initAreasetOptions() {\n    getAreasetList({\n      nodeKindId: 'period',\n      searchId: childFormState.periodId,\n    }).then((res) => {\n      if (res.result && res.result.length > 0) {\n        res.result.forEach((item) => {\n          areasetOptions.value.push({ value: item.name, lable: item.id });\n        });\n      }\n    });\n  }\n\n  onMounted(async () => {\n    initAreasetOptions();\n  });\n\n  // 主动暴露组件属性、方法\n  defineExpose({\n    childFormState,\n    getTicketList: function () {\n      if (childFormState.isInvoicing === '0') {\n        return [];\n      }\n      return ticketTableRef.value.getTicketDataSource();\n    },\n  });\n</script>\n"],"names":["childFormState","reactive","labelMap","workOrderType","childFormOption","areasetOptions","ref","activeKey","ticketTableRef","handleChangePlanHandleByName","value","option","handleChangePlanConfirmByName","handleChangeAreaName","item","handleDailyRangeChange","initAreasetOptions","getAreasetList","res","onMounted","__async","__expose"],"mappings":"8xBA8WQ,MAAAA,EAAiBC,IAAe,SAAS,EACzCC,EAAW,CAEf,GAAI,CAAE,UAAW,KAAM,IAAK,CAAE,MAAO,UAAW,UAAW,EAAI,EAE/D,KAAM,CAAE,UAAW,KAAM,IAAK,CAAE,MAAO,UAAW,UAAW,EAAI,EAEjE,KAAM,CAAE,UAAW,KAAM,IAAK,CAAE,MAAO,UAAW,UAAW,EAAI,EAEjE,GAAI,CAAE,UAAW,KAAM,IAAK,CAAE,MAAO,UAAW,UAAW,EAAI,CAAA,EAE3DC,EAAgBH,EAAe,cAC/BI,EAAkBH,EAAS,CAC/B,UAAWC,EAASC,CAAa,EAAE,UACnC,SAAUD,EAASC,CAAa,EAAE,IAAI,MACtC,aAAcD,EAASC,CAAa,EAAE,IAAI,SAAA,CAC3C,EAEKE,EAAiBC,EAA4B,CAAA,CAAE,EAC/CC,EAAYD,EAAI,GAAG,EACnBE,EAAiBF,IAEd,SAAAG,EAA6BC,EAAeC,EAAQ,CAC3DX,EAAe,eAAiBW,EAAO,KACzC,CAES,SAAAC,EAA8BF,EAAeC,EAAQ,CAC5DX,EAAe,gBAAkBW,EAAO,KAC1C,CAES,SAAAE,EAAqBH,EAAeC,EAAQ,CACnDX,EAAe,MAAM,OAASW,EAAO,IAAKG,GAASA,EAAK,KAAK,CAC/D,CAEA,SAASC,EAAuBL,EAAO,CAEjCA,IAAU,UACGV,EAAA,MAAM,OAAS,GACfA,EAAA,MAAM,SAAW,GAEpC,CAEA,SAASgB,GAAqB,CACbC,EAAA,CACb,WAAY,SACZ,SAAUjB,EAAe,QAAA,CAC1B,EAAE,KAAMkB,GAAQ,CACXA,EAAI,QAAUA,EAAI,OAAO,OAAS,GAChCA,EAAA,OAAO,QAASJ,GAAS,CACZT,EAAA,MAAM,KAAK,CAAE,MAAOS,EAAK,KAAM,MAAOA,EAAK,EAAA,CAAI,CAAA,CAC/D,CACH,CACD,CACH,CAEA,OAAAK,EAAU,IAAYC,EAAA,sBACDJ,GAAA,EACpB,EAGYK,EAAA,CACX,eAAArB,EACA,cAAe,UAAY,CACrB,OAAAA,EAAe,cAAgB,IAC1B,GAEFQ,EAAe,MAAM,qBAC9B,CAAA,CACD"}