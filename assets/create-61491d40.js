var K=(p,T,D)=>new Promise((o,y)=>{var M=I=>{try{C(D.next(I))}catch(w){y(w)}},F=I=>{try{C(D.throw(I))}catch(w){y(w)}},C=I=>I.done?o(I.value):Promise.resolve(I.value).then(M,F);C((D=D.apply(p,T)).next())});import{P as me}from"./index-20519caf.js";import{a5 as k,a0 as ve,aj as fe,aB as ce,aD as G,av as H,at as V,aC as be,a7 as Ie,_ as _e}from"./index.js";import{B as ge}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as xe}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{_ as N}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{B as he}from"./BillTitle-d17ab3e4.js";import{W as ye}from"./WfApproveBox-a3448232.js";import{U as W}from"./UploadBox-636ecf02.js";import{S as we}from"./SearchBox-22bb02d6.js";import{d as De,J as Ce,e as Se,k as x,r as $,o as Ue,al as v,Z as f,a9 as c,aa as n,$ as h,f as l,u as q,ag as qe,ac as b,E as Y,aG as Ne,aH as ke}from"./vue-71d1abb3.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./Dialog-0a006d82.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./index.esm-c216ed00.js";import"./index-fda2d66c.js";import"./index-c0893416.js";import"./index-33af41d1.js";import"./tree-fc0e156a.js";const Me="/po/equipment/page";function Fe(p){return k.post({url:"/baseset/common/list-stationPeriod",params:p})}function Re(p){return k.get({url:"/baseset/related-party/get-list?partyTypeCodes=settlementUnit",params:p})}function Ye(p){return k.get({url:"/po/technical-supervision/dtl/list?technicalSupervisionId="+p})}function Ee(p){return k.get({url:"/po/technical-supervision/get",params:p})}function Te(p){return k.post({url:"/po/technical-supervision/create",data:p})}const ze=[{title:"期数",dataIndex:"periodId",align:"left",headAlign:"center",width:160},{title:"物料类别",dataIndex:"materialName",resizable:!0,align:"left",headAlign:"center",width:160},{title:"设备名称",dataIndex:"equipmentId",resizable:!0,align:"left",headAlign:"center",width:160},{title:"设备编码",dataIndex:"equipmentCode",resizable:!0,align:"left",headAlign:"center",width:160},{title:"区域子阵",dataIndex:"areaName",resizable:!0,align:"left",headAlign:"center",width:160},{slots:{title:"faultContent"},align:"left",headAlign:"center",dataIndex:"faultContent",width:160},{slots:{title:"reason"},align:"left",headAlign:"center",dataIndex:"reason",width:160},{slots:{title:"rectificationMeasures"},align:"left",headAlign:"center",dataIndex:"rectificationMeasures",width:160},{slots:{title:"isSolve"},dataIndex:"isSolve",width:160},{title:"是否缺陷",dataIndex:"isFault",width:160},{title:"缺陷等级",dataIndex:"faultGrade",width:160},{title:"缺陷类型",dataIndex:"faultType",width:160},{title:"计划完成日期",dataIndex:"finishedRectificationDate",width:160},{title:"佐证报告",align:"left",headAlign:"center",dataIndex:"bizFileId",width:160}],E=p=>(Ne("data-v-70c5062a"),p=p(),ke(),p),Ae={class:"load"},Pe={class:"process-box"},Be={class:"header-box"},Ke={class:"content"},Oe=E(()=>h("div",{class:"customer_require"},"检查内容",-1)),Le=E(()=>h("div",{class:"customer_require"},"原因分析",-1)),je=E(()=>h("div",{class:"customer_require"},"整改措施",-1)),Ge=E(()=>h("div",{class:"customer_require"},"是否解决",-1)),He=De({__name:"create",setup(p){const T=ve(),D=Ce(T.getUserInfo),o=Se(()=>e.status!=0||e.status==0&&e.personMemberId!=""&&e.personMemberId.substring(0,32)!=D.userId),y=x(!0),M=x(""),F=x(),C=x([]),I=x([]),w=x([]),J=x([{title:"设备名称",dataIndex:"name"}]),Z=(i,t,d)=>{let r=t.record;d.equipmentId=r.key,d.equipmentName=r.name,d.equipmentCode=r.code,d.materialName=r.materialWholeName,d.areaName=r.areaName};let{params:g}=fe();const e=$({id:g.id||"",stationName:g.stationName||"",stationId:g.stationId||"",stationOrganName:g.stationOrganName||"",stationOrganId:g.stationOrganId||"",periodId:[],periodName:[],businessKind:"",preExaminationCompanyId:"",preExaminationCompany:"",personMemberId:"",startDate:"",billCode:"",fillinDate:"",spinning:!1,endDate:"",lastDate:"",nextDate:"",examinationResult:"",contractRequirement:"",remark:"",status:0,dtl:{},bizFileId:""}),z=()=>{e.dtl=ae(),e.spinning=!0,Te(e).then(i=>{i.result!=""?(e.id=i.result,V.getInstance().success(e.status==1?"提交成功":"保存成功"),e.status==1&&setTimeout(()=>{be(),Ie.getInstance().sendMsg("super-vision",{})},100)):(y.value=!1,e.status=0,V.getInstance().error("保存失败.")),e.spinning=!1}).catch(i=>{y.value=!1,e.status=0,e.spinning=!1,console.log(i)})},O=$({subject:"试验检测"}),S=x([]),A={handleAgree:i=>{console.log("同意",i)},handleSave:i=>{console.log("保存",i),y.value=!1,e.status=0,z()},handleSubmit:i=>{console.log("提交",i),y.value=!0,e.status=1;const t=F.value;t&&t.validateFields().then(()=>{z()}).catch(d=>{console.log(d),e.status=0})}},Q=(i,t)=>{e.periodId=t.filter(d=>d.value).map(d=>d.value),e.periodName=t.filter(d=>d.value).map(d=>d.label),w.value=t,S.value.length>0&&(S.value=S.value.filter(d=>e.periodId.includes(d.periodId))),te()},X=()=>K(this,null,function*(){let i=yield Ye(e.id);i.result.forEach(t=>{t.isFault=t.isFault+""}),S.value=i.result}),[ee,{getDataSource:ae,reload:te,getSelectRowKeys:le,clearSelectedRowKeys:ne,deleteTableDataRecord:se}]=xe({dataSource:S,rowKey:"id",pagination:!1,bordered:!0,columns:ze,useSearchForm:!1,showTableSetting:!1,rowSelection:{type:"checkbox"}}),ie=()=>{S.value.push({id:new Date().getTime(),periodId:"",materialName:"",equipmentId:"",equipmentNum:"",areaSet:"",faultContent:"",reason:"",rectificationMeasures:"",isSolve:"",isFault:"",faultGrade:"",faultType:"",finishedRectificationDate:"",bizFileId:G()})},de=()=>{se(le()),ne()},oe=()=>{Fe({powerStationId:e.stationId}).then(i=>{i.result.forEach(t=>{C.value.push({value:t.powerStationPeriodId,label:t.powerStationPeriodName})})}),Re({}).then(i=>{i.result.forEach(t=>{I.value.push({value:t.id,label:t.name})})})};return Ue(()=>K(this,null,function*(){if(M.value=g.processInstanceId,!e.id&&g.processInstanceId){const i=yield ce(g.processInstanceId);e.id=i.businessKey}Ee({id:e.id}).then(i=>{let t=i.result;if(e.id){for(let _ in t)e[_]=t[_];e.status=Number(e.status),e.periodId instanceof Array&&e.periodId.forEach((_,R)=>{w.value.push({value:_,label:e.periodName[R]})}),X()}else e.billCode=t.billCode,e.personMemberName=t.personMemberName,e.deptName=t.deptName,e.fillinDate=t.fillinDate,e.bizFileId=G();let{billCode:d,fillinDate:r,personMemberName:m,deptName:U}=t;Object.assign(O,{billCode:d,fillinDate:r,personMemberName:m,deptName:U})}).then(()=>{oe()})})),(i,t)=>{const d=v("a-input"),r=v("a-form-item"),m=v("a-col"),U=v("a-select"),_=v("a-date-picker"),R=v("a-textarea"),ue=v("a-row"),P=v("a-card"),L=v("a-button"),j=v("a-select-option"),re=v("a-form"),pe=v("a-spin");return f(),c(q(me),{dense:"",contentFullHeight:"",fixedHeight:"",style:{position:"relative"}},{default:n(()=>[h("div",Ae,[l(pe,{spinning:e.spinning,tip:"Loading..."},{default:n(()=>[h("div",Pe,[h("div",Be,[l(he,{options:O},null,8,["options"]),l(ye,{processInstanceId:M.value,onAgree:A.handleAgree,onSave:A.handleSave,onSubmit:A.handleSubmit,processStatus:e.status,listenMessage:"super-vision"},null,8,["processInstanceId","onAgree","onSave","onSubmit","processStatus"])]),h("div",Ke,[l(re,{model:e,name:"basic",ref_key:"formRef",ref:F,autocomplete:"off",onFinish:z},{default:n(()=>[l(P,{title:"基本信息",bordered:!1},{default:n(()=>[l(ue,{gutter:32},{default:n(()=>[l(m,{span:12},{default:n(()=>[l(r,{label:"电站名称",name:"stationName",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:n(()=>[l(d,{value:e.stationName,"onUpdate:value":t[0]||(t[0]=a=>e.stationName=a),disabled:""},null,8,["value"])]),_:1})]),_:1}),l(m,{span:12},{default:n(()=>[l(r,{label:"期数",name:"periodId",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"期数不能为空。"}]},{default:n(()=>[l(U,{value:e.periodId,"onUpdate:value":t[1]||(t[1]=a=>e.periodId=a),mode:"multiple","allow-clear":"",options:C.value,disabled:o.value,onChange:Q},null,8,["value","options","disabled"])]),_:1})]),_:1}),l(m,{span:12},{default:n(()=>[l(r,{label:"业务类型",name:"businessKind",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"业务类型不能为空。"}]},{default:n(()=>[l(N,{type:"supervision_business_kind",disabled:o.value,value:e.businessKind,"onUpdate:value":t[2]||(t[2]=a=>e.businessKind=a),style:{width:"100%"}},null,8,["disabled","value"])]),_:1})]),_:1}),l(m,{span:12},{default:n(()=>[l(r,{label:"预试单位",name:"preExaminationCompanyId",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"预试单位不能为空。"}]},{default:n(()=>[l(U,{value:e.preExaminationCompanyId,"onUpdate:value":t[3]||(t[3]=a=>e.preExaminationCompanyId=a),allowClear:"",options:I.value,disabled:o.value,onChange:t[4]||(t[4]=(a,s)=>{e.preExaminationCompanyId=a,e.preExaminationCompany=s.label})},null,8,["value","options","disabled"])]),_:1})]),_:1}),l(m,{span:12},{default:n(()=>[l(r,{label:"本次试验日期",name:"startDate",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"本次试验日期不能为空。"}]},{default:n(()=>[l(_,{value:e.startDate,"onUpdate:value":t[5]||(t[5]=a=>e.startDate=a),valueFormat:"YYYY-MM-DD",style:{width:"100%"},disabled:o.value},null,8,["value","disabled"])]),_:1})]),_:1}),l(m,{span:12},{default:n(()=>[l(r,{label:"本次完成日期",name:"endDate",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"本次完成日期不能为空。"}]},{default:n(()=>[l(_,{value:e.endDate,"onUpdate:value":t[6]||(t[6]=a=>e.endDate=a),valueFormat:"YYYY-MM-DD",style:{width:"100%"},disabled:o.value},null,8,["value","disabled"])]),_:1})]),_:1}),l(m,{span:12},{default:n(()=>[l(r,{label:"上次试验日期",name:"lastDate",labelCol:{style:{width:"124px"}},rules:[{required:!1,message:"上次试验日期"}]},{default:n(()=>[l(_,{value:e.lastDate,"onUpdate:value":t[7]||(t[7]=a=>e.lastDate=a),valueFormat:"YYYY-MM-DD",style:{width:"100%"},disabled:o.value},null,8,["value","disabled"])]),_:1})]),_:1}),l(m,{span:12},{default:n(()=>[l(r,{label:"下次试验日期",name:"nextDate",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"下次试验日期不能为空。"}]},{default:n(()=>[l(_,{value:e.nextDate,"onUpdate:value":t[8]||(t[8]=a=>e.nextDate=a),valueFormat:"YYYY-MM-DD",style:{width:"100%"},disabled:o.value},null,8,["value","disabled"])]),_:1})]),_:1}),l(m,{span:12},{default:n(()=>[l(r,{label:"试验结果",name:"examinationResult",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"试验结果不能为空。"}]},{default:n(()=>[l(N,{type:"examination_result",disabled:o.value,value:e.examinationResult,"onUpdate:value":t[9]||(t[9]=a=>e.examinationResult=a),style:{width:"100%"}},null,8,["disabled","value"])]),_:1})]),_:1}),l(m,{span:24},{default:n(()=>[l(r,{label:"运维合同要求",name:"contractRequirement",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:n(()=>[l(R,{value:e.contractRequirement,"onUpdate:value":t[10]||(t[10]=a=>e.contractRequirement=a),row:"3",maxlength:"512",disabled:o.value},null,8,["value","disabled"])]),_:1})]),_:1}),l(m,{span:24},{default:n(()=>[l(r,{label:"说明",name:"remark",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:n(()=>[l(R,{value:e.remark,"onUpdate:value":t[11]||(t[11]=a=>e.remark=a),row:"3",maxlength:"1024",disabled:o.value},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),l(P,{bordered:!1},{default:n(()=>[l(q(ge),{onRegister:q(ee),title:"问题明细",class:"dtl-table"},qe({faultContent:n(()=>[Oe]),reason:n(()=>[Le]),rectificationMeasures:n(()=>[je]),isSolve:n(()=>[Ge]),bodyCell:n(({column:a,record:s})=>[a.dataIndex==="periodId"?(f(),c(U,{key:0,value:s[a.dataIndex],"onUpdate:value":u=>s[a.dataIndex]=u,"allow-clear":"",options:w.value,disabled:o.value,onChange:(u,B)=>{s[a.dataIndex]=u,s.periodName=B.label},style:{width:"100%"}},null,8,["value","onUpdate:value","options","disabled","onChange"])):b("",!0),a.dataIndex==="equipmentId"?(f(),c(we,{key:1,value:s.equipmentName,"onUpdate:value":u=>s.equipmentName=u,columns:J.value,disabled:o.value,api:q(Me),apiParamFunc:()=>s.periodId?{periodId:s.periodId,status:1}:!1,pagination:!0,style:{width:"100%"},onChange:(u,B)=>{Z(u,B,s)}},null,8,["value","onUpdate:value","columns","disabled","api","apiParamFunc","onChange"])):b("",!0),a.dataIndex==="faultContent"?(f(),c(d,{key:2,disabled:o.value,value:s[a.dataIndex],"onUpdate:value":u=>s[a.dataIndex]=u,style:{width:"100%"},maxlength:"512"},null,8,["disabled","value","onUpdate:value"])):b("",!0),a.dataIndex==="reason"?(f(),c(d,{key:3,disabled:o.value,value:s[a.dataIndex],"onUpdate:value":u=>s[a.dataIndex]=u,style:{width:"100%"},maxlength:"512"},null,8,["disabled","value","onUpdate:value"])):b("",!0),a.dataIndex==="rectificationMeasures"?(f(),c(d,{key:4,disabled:o.value,value:s[a.dataIndex],"onUpdate:value":u=>s[a.dataIndex]=u,style:{width:"100%"},maxlength:"512"},null,8,["disabled","value","onUpdate:value"])):b("",!0),a.dataIndex==="isSolve"?(f(),c(U,{key:5,value:s[a.dataIndex],"onUpdate:value":u=>s[a.dataIndex]=u,style:{width:"100%"},"allow-clear":"",disabled:o.value},{default:n(()=>[l(j,{value:"0"},{default:n(()=>[Y("未解决")]),_:1}),l(j,{value:"1"},{default:n(()=>[Y("已解决")]),_:1})]),_:2},1032,["value","onUpdate:value","disabled"])):b("",!0),a.dataIndex==="isFault"?(f(),c(N,{key:6,type:"yes_or_no",disabled:o.value,value:s[a.dataIndex],"onUpdate:value":u=>s[a.dataIndex]=u,style:{width:"100%"}},null,8,["disabled","value","onUpdate:value"])):b("",!0),a.dataIndex==="faultGrade"?(f(),c(N,{key:7,type:"fault_grade",disabled:o.value,value:s[a.dataIndex],"onUpdate:value":u=>s[a.dataIndex]=u,style:{width:"100%"}},null,8,["disabled","value","onUpdate:value"])):b("",!0),a.dataIndex==="faultType"?(f(),c(N,{key:8,type:"fault_type",disabled:o.value,value:s[a.dataIndex],"onUpdate:value":u=>s[a.dataIndex]=u,style:{width:"100%"}},null,8,["disabled","value","onUpdate:value"])):b("",!0),a.dataIndex==="finishedRectificationDate"?(f(),c(_,{key:9,value:s[a.dataIndex],"onUpdate:value":u=>s[a.dataIndex]=u,valueFormat:"YYYY-MM-DD",style:{width:"100%"},disabled:o.value},null,8,["value","onUpdate:value","disabled"])):b("",!0),a.dataIndex==="bizFileId"?(f(),c(W,{key:10,width:800,height:550,maxCount:20,maxSize:100*1024*1024,application:"po",module:"supervisiondtl",vmode:e.status==0?"box":"view",bizId:s[a.dataIndex]},null,8,["vmode","bizId"])):b("",!0)]),_:2},[e.status==0&&!o.value?{name:"toolbar",fn:n(()=>[l(L,{onClick:ie,preIcon:q(H).ADD},{default:n(()=>[Y("添加")]),_:1},8,["preIcon"]),l(L,{onClick:de,preIcon:q(H).DELETE},{default:n(()=>[Y("删除")]),_:1},8,["preIcon"])]),key:"0"}:void 0]),1032,["onRegister"])]),_:1}),l(P,{title:"附件上传",bordered:!1},{default:n(()=>[l(W,{width:800,height:550,maxCount:20,maxSize:100*1024*1024,application:"po",module:"supervision",vmode:e.status==0?"box":"view",bizId:e.bizFileId},null,8,["vmode","bizId"])]),_:1})]),_:1},8,["model"])])])]),_:1},8,["spinning"])])]),_:1})}}});const Ca=_e(He,[["__scopeId","data-v-70c5062a"]]);export{Ca as default};
//# sourceMappingURL=create-61491d40.js.map
