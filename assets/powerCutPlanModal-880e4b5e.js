var C=(M,e,v)=>new Promise((y,d)=>{var f=n=>{try{g(v.next(n))}catch(b){d(b)}},h=n=>{try{g(v.throw(n))}catch(b){d(b)}},g=n=>n.done?y(n.value):Promise.resolve(n.value).then(f,h);g((v=v.apply(M,e)).next())});import{d as A,r as D,k as B,ax as V,u as j,o as L,al as u,Z as U,_ as W,f as t,aa as s,$ as w,a9 as E,ac as S,v as m,A as c}from"./vue-71d1abb3.js";import{b as x,s as O}from"./powerCutPlan-04857240.js";import{W as Q}from"./WfApproveBox-a3448232.js";import{a0 as Z,ak as G,bP as J,aB as X,a7 as ee,aC as te}from"./index.js";import{B as ae}from"./BillTitle-d17ab3e4.js";import{_ as k}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{U as se}from"./UploadBox-636ecf02.js";import{a as _}from"./assign-37f1c13d.js";import{a2 as oe}from"./antd-15ac76ed.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-f4fc48e6.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./Dialog-0a006d82.js";import"./OrganDialog-dd1023ce.js";import"./index-085d06c7.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useRender-21ce56fb.js";import"./index.esm-c216ed00.js";import"./index-fda2d66c.js";import"./BasicTable-0434a334.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./useTable-109483b3.js";import"./index-c0893416.js";import"./index-33af41d1.js";import"./tree-fc0e156a.js";const ne={class:"load"},le={class:"process-box"},ie={class:"header-box"},re={class:"content"},ue={class:"clearfix",style:{"padding-left":"15px"}},Ve=A({__name:"powerCutPlanModal",setup(M){const e=D({spinning:!1}),y=Z().getUserInfo,d=B(!0),f=D({});f.subject="检修停电",f.infoItems=[];const h=V(),{currentRoute:g}=h;j(g);const n=G.getInstance().getQuery(),b=B();function N(o){e.spinning=!0;try{o=o||0,b.value.validateFields().then(()=>{e.status=o,O(e).then(a=>{e.id=a,x({id:a}).then(i=>{_(e,i.result)}),oe.success(o==1?"提交成功。":"保存成功"),ee.getInstance().sendMsg("powerCutPlan",{}),o==1&&(d.value=!0,te())})})}catch(a){console.log("error",a)}finally{e.spinning=!1}}function z(){N(1)}function F(){N(0)}_(e,{processInstanceId:"",id:"",billCode:"",fillinDate:"",organId:"",organName:"",deptId:"",deptName:"",positionId:"",positionName:"",personMemberId:"",personMemberName:"",fullId:"",status:0,bizFileId:"",subject:"",finishedDate:"",issuedCompany:"",powerCutType:"",powerCutKind:"",startTime:"",endTime:"",content:"",name:""}),L(()=>C(this,null,function*(){n.id=yield H(),e.status=0,e.processInstanceId="",yield x({id:n.id}).then(o=>{n.id?(_(e,o.result),e.status==0&&e.personMemberId.substring(0,32)!=y.userId&&(e.status=10)):(_(e,n),e.spinning=!1,e.status=0,e.billCode=o.result.billCode,e.personMemberName=o.result.personMemberName,e.fillinDate=o.result.fillinDate,e.deptName=o.result.deptName),e.status==1&&(d.value=!0)}),n.id||(d.value=!1),yield K(),(e.bizFileId==null||e.bizFileId==null||e.bizFileId=="")&&q()}));const q=()=>C(this,null,function*(){J().then(o=>{e.bizFileId=o})}),H=()=>C(this,null,function*(){let o=n.id;if(!o&&n.processInstanceId){const i=(yield X(n.processInstanceId)).businessKey;n.id=i,o=i}return e.id&&(yield x({id:e.id}).then(a=>{_(e,a.result)})),o}),K=()=>C(this,null,function*(){d.value=e.status!=0,f.title="检修停电",e.processInstanceId=n.processInstanceId;let{billCode:o,fillinDate:a,personMemberName:i,deptName:r}=e;_(f,{billCode:o,fillinDate:a,personMemberName:i,deptName:r})});return(o,a)=>{const i=u("a-input"),r=u("a-form-item"),p=u("a-col"),I=u("a-row"),T=u("a-date-picker"),P=u("a-textarea"),Y=u("a-card"),R=u("a-form"),$=u("a-spin");return U(),W("div",ne,[t($,{spinning:e.spinning,tip:"Loading..."},{default:s(()=>[w("div",le,[w("div",ie,[t(ae,{options:f},null,8,["options"]),e.status!=10?(U(),E(Q,{key:0,onSave:F,onSubmit:z,processInstanceId:e.processInstanceId,processStatus:e.status},null,8,["processInstanceId","processStatus"])):S("",!0)]),w("div",re,[t(R,{ref_key:"formRef",ref:b,model:e,labelAlign:"right",autocomplete:"off"},{default:s(()=>[t(Y,{title:"基本信息",bordered:!1},{default:s(()=>[t(I,{gutter:24},{default:s(()=>[m(t(p,{span:12},{default:s(()=>[t(r,{name:"stationName",label:"电站名称",labelCol:{span:6},rules:[{required:!0,message:"请输入电站名称"}]},{default:s(()=>[t(i,{disabled:"",value:e.stationName,"onUpdate:value":a[0]||(a[0]=l=>e.stationName=l),placeholder:"请输入电站名称"},null,8,["value"]),S("",!0)]),_:1})]),_:1},512),[[c,!0]]),m(t(p,{span:12},{default:s(()=>[t(r,{name:"issuedCompany",label:"下发单位",labelCol:{span:6},rules:[{required:!0,message:"请输入下发单位"}]},{default:s(()=>[t(i,{value:e.issuedCompany,"onUpdate:value":a[2]||(a[2]=l=>e.issuedCompany=l),placeholder:"请输入下发单位",disabled:e.status!=0,maxLength:100},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),t(I,{gutter:24},{default:s(()=>[m(t(p,{span:12},{default:s(()=>[t(r,{name:"powerCutType",label:"检修类型",labelCol:{span:6},rules:[{required:!0,message:"请选择检修类型"}]},{default:s(()=>[t(k,{type:"PowerCutType",value:e.powerCutType,"onUpdate:value":a[3]||(a[3]=l=>e.powerCutType=l),style:{width:"100%"},disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]]),m(t(p,{span:12},{default:s(()=>[t(r,{name:"powerCutKind",label:"停电类型",labelCol:{span:6},rules:[{required:!0,message:"请选择停电类型"}]},{default:s(()=>[t(k,{type:"PowerCutKind",onChange:a[4]||(a[4]=l=>"()=> detailFormState.powerCutKind = value"),value:e.powerCutKind,"onUpdate:value":a[5]||(a[5]=l=>e.powerCutKind=l),style:{width:"100%"},disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),t(I,{gutter:24},{default:s(()=>[m(t(p,{span:12},{default:s(()=>[t(r,{name:"startTime",label:"停电时间",labelCol:{span:6},rules:[{required:!0,message:"请选择停电时间"}]},{default:s(()=>[t(T,{value:e.startTime,"onUpdate:value":a[6]||(a[6]=l=>e.startTime=l),"value-format":"YYYY-MM-DD HH:mm:00",format:"YYYY-MM-DD HH:mm",style:{"min-width":"100%"},"show-time":"",disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]]),m(t(p,{span:12},{default:s(()=>[t(r,{name:"endTime",label:"恢复时间",labelCol:{span:6},rules:[{required:!0,message:"请选择恢复时间"}]},{default:s(()=>[t(T,{value:e.endTime,"onUpdate:value":a[7]||(a[7]=l=>e.endTime=l),"value-format":"YYYY-MM-DD HH:mm:00",format:"YYYY-MM-DD HH:mm",style:{"min-width":"100%"},"show-time":"",disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),t(I,{gutter:24},{default:s(()=>[m(t(p,{span:24},{default:s(()=>[t(r,{name:"name",label:"检修停电主题",labelCol:{span:3},rules:[{required:!0,message:"请输入检修停电主题"}]},{default:s(()=>[t(i,{value:e.name,"onUpdate:value":a[8]||(a[8]=l=>e.name=l),placeholder:"请输入检修停电主题",disabled:e.status!=0,maxlength:100},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),t(I,{gutter:24},{default:s(()=>[m(t(p,{span:24},{default:s(()=>[t(r,{name:"content",label:"检修停电内容",labelCol:{span:3},rules:[{required:!1,message:"请输入检修停电内容"}]},{default:s(()=>[t(P,{value:e.content,"onUpdate:value":a[9]||(a[9]=l=>e.content=l),row:"8","show-count":"",style:{height:"200px"},disabled:d.value,maxlength:1e3},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1})]),_:1}),t(Y,{title:"附件信息",bordered:!1},{default:s(()=>[w("div",ue,[t(se,{width:800,height:550,maxCount:20,maxSize:100*1024*1024,application:"po",module:"powerCutPlan",vmode:e.status==0?"box":"view",bizId:e.bizFileId},null,8,["vmode","bizId"])])]),_:1})]),_:1},8,["model"])])])]),_:1},8,["spinning"])])}}});export{Ve as default};
//# sourceMappingURL=powerCutPlanModal-880e4b5e.js.map
