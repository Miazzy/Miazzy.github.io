var j=($,L,h)=>new Promise((O,U)=>{var C=g=>{try{b(h.next(g))}catch(k){U(k)}},M=g=>{try{b(h.throw(g))}catch(k){U(k)}},b=g=>g.done?O(g.value):Promise.resolve(g.value).then(C,M);b((h=h.apply($,L)).next())});import{d as Ue,k as y,J as Se,r as He,o as Re,al as _,Z as x,_ as K,f as e,aa as a,E as v,u as d,a9 as ue,ac as R,v as p,A as c,$ as re,F as qe}from"./vue-71d1abb3.js";import{_ as Ee}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{au as Ne,a0 as Le,av as q,a7 as E,a5 as w,_ as Oe}from"./index.js";import{O as de}from"./OrganDialog-dd1023ce.js";import{D as ie}from"./Dialog-0a006d82.js";import{a as me}from"./assign-37f1c13d.js";import{a2 as N}from"./antd-15ac76ed.js";const ze={key:0,style:{display:"flex","margin-left":"865px"}},Ve={style:{float:"left",width:"15%"}},Be={key:0,style:{display:"flex","margin-left":"865px"}},je={style:{float:"left",width:"15%"}},Ke=Ue({__name:"Schedule",setup($,{expose:L}){const h=y([]),{createConfirm:O}=Ne(),U=Le(),C=Se(U.getUserInfo),M=y(!1),b=y(!1),g=y(""),k=y(),A=y(),t=He({});let m=!1,I=!1;const D=y(!1),z=y([]),J=()=>{D.value=!1};function P(){D.value=!0}function Z(){G()}function G(){const l=new Date(t.startDate),n=t.reminderTime;let o=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];Math.ceil(l.getDate()/7),h.value=[],l&&n&&(h.value.push({value:"not",label:"不重复"}),h.value.push({value:"day",label:"每日("+n+")"}),h.value.push({value:"workday",label:"工作日(周一至周五 "+n+")"}),h.value.push({value:"weekday",label:"每周("+o[l.getDay()]+" "+n+")"}),h.value.push({value:"monthly2",label:"每月("+l.getDate()+"日 "+n+")"}))}const Q=()=>{t.handleFor="",T.value=[]},T=y([]),W=l=>{if(T.value.length=0,l.length>0){let n=[];l.forEach(o=>{const i={orgUnitId:o.value,orgUnitName:o.label};T.value.push(i),n.push(o.nodeName||o.title||o.label)}),t.handleFor=n.join(",")}D.value=!1},fe=l=>w.post({url:"/system/org/list-tree",params:l},{});function V(){return j(this,null,function*(){const l=yield fe({orgKindIds:"ogn,dpt,pos,psm",showPosition:!0,status:1});console.error("query tree data over:",new Date().getTime()),z.value=X(l.result)})}function X(l){const n=[];for(let o=0;o<l.length;o++){const i=l[o],u={code:i.code,fullId:i.code,name:i.name,nodeId:i.id,nodeName:i.name,orgId:i.orgId,parentId:i.parentId,disabled:i.orgKindId!=="psm"};i.children&&i.children.length>0&&(u.children=X(i.children)),n.push(u)}return n}function S(){debugger;M.value=!1,b.value=!1}Re(()=>{});function pe(l){m=!1,T.value=[],l==="meeting"?ce():l==="schedule"&&ge(),V(),console.error("query tree data start:",new Date().getTime())}function ce(){const l=new Date;l.setHours(l.getHours()+1),t.content=null,t.startTime=B(new Date),t.endTime=B(l),t.reminderRules=null,t.organizer=C.orgs[0].personMemberName,t.handleFor=null,t.reminderMethod=null,t.handleForList=[],M.value=!0,g.value="会议提醒"}function ge(){t.content=null,t.startDate=he(new Date),t.endDate=null,t.reminderTime=null,t.repeatingRules=null,t.organizer=C.orgs[0].personMemberName,t.handleFor=null,t.reminderMethod=null,t.handleForList=[],b.value=!0,g.value="日程提醒"}function ve(){const l=new Date(t.startTime);l.setHours(l.getHours()+1),t.endTime=B(l)}function B(l){const n=l.getFullYear(),o=l.getMonth()+1<10?"0"+(l.getMonth()+1):l.getMonth()+1,i=l.getDate()<10?"0"+l.getDate():l.getDate(),u=l.getHours()<10?"0"+l.getHours():l.getHours(),r=l.getMinutes()<10?"0"+l.getMinutes():l.getMinutes(),f=l.getSeconds()<10?"0"+l.getSeconds():l.getSeconds();return n+"-"+o+"-"+i+" "+u+":"+r+":"+f}function he(l){const n=l.getFullYear(),o=l.getMonth()+1<10?"0"+(l.getMonth()+1):l.getMonth()+1,i=l.getDate()<10?"0"+l.getDate():l.getDate();return n+"-"+o+"-"+i}function ee(){k.value.validateFields().then(()=>{t.handleForList=T.value,t.reminderMethod=t.reminderMethod.join(","),be(t).then(()=>{E.getInstance().sendMsg("setMeeting",{}),N.success("保存成功。"),M.value=!1}).catch(()=>{})})}function te(){A.value.validateFields().then(()=>{t.handleForList=T.value,t.reminderMethod=t.reminderMethod.join(","),_e(t).then(()=>{E.getInstance().sendMsg("setMeeting",{}),N.success("保存成功。"),b.value=!1}).catch(()=>{})})}const be=l=>w.post({url:"/oa/calendar-meeting/create",params:l},{}),_e=l=>w.post({url:"/oa/calendar-schedule/create",params:l},{}),Me=l=>w.delete({url:"/oa/calendar-meeting/delete",params:l},{}),De=l=>w.delete({url:"/oa/calendar-schedule/delete",params:l},{});function ye(l){m=!0,l.type==="meeting"?ae(l.id):l.type==="schedule"&&ne(l.id)}function we(){m=!1,M.value=!1,ae(t.id)}function Ce(){le(function(){Me("?id="+t.id).then(()=>{N.success("删除成功。"),E.getInstance().sendMsg("setMeeting",{}),M.value=!1})})}function ke(){m=!1,b.value=!1,ne(t.id)}function Ie(){le(function(){De("?id="+t.id).then(()=>{N.success("删除成功。"),E.getInstance().sendMsg("setMeeting",{}),b.value=!1})})}function le(l){O({title:"温馨提示",iconType:"warning",content:"是否确认删除此数据？",onOk(){return j(this,null,function*(){yield l()})}})}const Te=l=>w.get({url:"/oa/calendar-meeting/get",params:l},{});function ae(l){Te({id:l}).then(n=>{me(t,n.result),t.reminderMethod=t.reminderMethod.split(","),M.value=!0,g.value="会议提醒";let o=C.orgs[0].personId,i=new Date().getTime(),u=new Date(t.startTime).getTime();t.creator==o&&i<u?(I=!0,V()):I=!1}).catch(()=>{})}const Ye=l=>w.get({url:"/oa/calendar-schedule/get",params:l},{});function ne(l){Ye({id:l}).then(n=>{me(t,n.result),t.reminderMethod=t.reminderMethod.split(","),b.value=!0,g.value="日程提醒";let o=C.orgs[0].personId;t.creator==o?(I=!0,V()):I=!1,G()}).catch(()=>{})}return L({handleClickMenu:pe,handleView:ye}),(l,n)=>{const o=_("a-button"),i=_("a-textarea"),u=_("a-form-item"),r=_("a-col"),f=_("a-row"),F=_("a-date-picker"),H=_("a-input"),Y=_("a-checkbox"),se=_("a-checkbox-group"),oe=_("a-form"),Fe=_("a-time-picker"),xe=_("a-select");return x(),K(qe,null,[e(ie,{visible:M.value,"onUpdate:visible":n[10]||(n[10]=s=>M.value=s),title:g.value,maskClosable:!1,onOk:ee,onCancel:S,width:1e3},{footer:a(()=>[e(o,{onClick:S},{default:a(()=>[v("关闭")]),_:1}),d(m)?R("",!0):(x(),ue(o,{key:0,onClick:ee,style:{"margin-left":"5px","background-color":"rgb(36 147 252)",color:"#fff"}},{default:a(()=>[v("确认")]),_:1}))]),default:a(()=>[d(I)?(x(),K("div",ze,[e(o,{onClick:we,preIcon:d(q).EDIT},null,8,["preIcon"]),e(o,{onClick:Ce,preIcon:d(q).DELETE},null,8,["preIcon"])])):R("",!0),e(oe,{ref_key:"modalFormRef",ref:k,model:t,name:"userForm"},{default:a(()=>[e(f,{gutter:24,style:{"margin-top":"16px"}},{default:a(()=>[p(e(r,{span:23},{default:a(()=>[e(u,{label:"会议主题",name:"content",labelCol:{span:3},rules:[{required:!0}]},{default:a(()=>[e(i,{value:t.content,"onUpdate:value":n[0]||(n[0]=s=>t.content=s),style:{width:"100%"},showCount:"",disabled:d(m),"auto-size":{minRows:3,maxRows:5},maxlength:"200"},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),e(f,{gutter:24},{default:a(()=>[p(e(r,{span:12},{default:a(()=>[e(u,{label:"开始时间",name:"startTime",labelCol:{span:6},rules:[{required:!0,message:"请填写开始时间"}]},{default:a(()=>[e(F,{value:t.startTime,"onUpdate:value":n[1]||(n[1]=s=>t.startTime=s),"value-format":"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm","show-time":"",disabled:d(m),onChange:ve,style:{width:"100%"}},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]]),p(e(r,{span:11},{default:a(()=>[e(u,{label:"结束时间",name:"endTime",labelCol:{span:6},rules:[{required:!0,message:"请填写结束时间"}]},{default:a(()=>[e(F,{value:t.endTime,"onUpdate:value":n[2]||(n[2]=s=>t.endTime=s),"value-format":"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm","show-time":"",disabled:d(m),style:{width:"100%"}},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),e(f,{gutter:24},{default:a(()=>[p(e(r,{span:12},{default:a(()=>[e(u,{name:"reminderRules",label:"提醒规则",labelCol:{span:6},rules:[{required:!0,message:"请选择提醒规则"}]},{default:a(()=>[e(Ee,{type:"reminderRules",value:t.reminderRules,"onUpdate:value":n[3]||(n[3]=s=>t.reminderRules=s),disabled:d(m),style:{width:"100%"}},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]]),p(e(r,{span:11},{default:a(()=>[e(u,{name:"organizer",label:"会议组织人：",labelCol:{span:6},rules:[{required:!1}]},{default:a(()=>[e(H,{value:t.organizer,"onUpdate:value":n[4]||(n[4]=s=>t.organizer=s),style:{width:"100%"},disabled:"",maxlength:"20"},null,8,["value"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),e(f,{gutter:24},{default:a(()=>[p(e(r,{span:24},{default:a(()=>[e(u,{name:"handleFor",label:"与会人",labelCol:{span:3},rules:[{required:!1,message:"请输入与会人"}]},{default:a(()=>[re("div",Ve,[e(o,{type:"link",onClick:P,disabled:d(m)},{default:a(()=>[v("选择")]),_:1},8,["disabled"]),e(o,{type:"link",onClick:Q,disabled:d(m)},{default:a(()=>[v("清空")]),_:1},8,["disabled"])]),e(H,{value:t.handleFor,"onUpdate:value":n[5]||(n[5]=s=>t.handleFor=s),class:"input-input",disabled:""},null,8,["value"]),e(de,{title:"组织人员",visible:D.value,"onUpdate:visible":[n[6]||(n[6]=s=>D.value=s),n[8]||(n[8]=s=>D.value=s)],value:t.handleForList,"onUpdate:value":n[7]||(n[7]=s=>t.handleForList=s),tdata:z.value,tfields:{key:"nodeId",title:"nodeName"},width:800,height:600,onCancel:J,onConfirm:W},null,8,["visible","value","tdata"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),e(f,{gutter:24},{default:a(()=>[p(e(r,{span:24},{default:a(()=>[e(u,{name:"reminderMethod",label:"提醒方式",labelCol:{span:3},rules:[{required:!0,message:"请选择提醒方式"}]},{default:a(()=>[e(se,{value:t.reminderMethod,"onUpdate:value":n[9]||(n[9]=s=>t.reminderMethod=s),style:{width:"100%"},disabled:d(m)},{default:a(()=>[e(f,null,{default:a(()=>[e(r,{span:6},{default:a(()=>[e(Y,{value:"system"},{default:a(()=>[v("系统内(pc端)")]),_:1})]),_:1}),e(r,{span:6},{default:a(()=>[e(Y,{value:"message"},{default:a(()=>[v("短信")]),_:1})]),_:1}),e(r,{span:6},{default:a(()=>[e(Y,{value:"e-mail"},{default:a(()=>[v("邮件")]),_:1})]),_:1})]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),e(ie,{visible:b.value,"onUpdate:visible":n[22]||(n[22]=s=>b.value=s),title:g.value,maskClosable:!1,onOk:te,onCancel:S,width:1e3},{footer:a(()=>[e(o,{onClick:S},{default:a(()=>[v("关闭")]),_:1}),d(m)?R("",!0):(x(),ue(o,{key:0,onClick:te,style:{"margin-left":"5px","background-color":"rgb(36 147 252)",color:"#fff"}},{default:a(()=>[v("确认")]),_:1}))]),default:a(()=>[d(I)?(x(),K("div",Be,[e(o,{onClick:ke,preIcon:d(q).EDIT},null,8,["preIcon"]),e(o,{onClick:Ie,preIcon:d(q).DELETE},null,8,["preIcon"])])):R("",!0),e(oe,{ref_key:"modalScheduleFormRef",ref:A,model:t,name:"userForm"},{default:a(()=>[e(f,{gutter:24,style:{"margin-top":"16px"}},{default:a(()=>[p(e(r,{span:23},{default:a(()=>[e(u,{label:"日程内容",name:"content",labelCol:{span:3},rules:[{required:!0}]},{default:a(()=>[e(i,{value:t.content,"onUpdate:value":n[11]||(n[11]=s=>t.content=s),style:{width:"100%"},showCount:"",disabled:d(m),"auto-size":{minRows:3,maxRows:5},maxlength:"200"},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),e(f,{gutter:24},{default:a(()=>[p(e(r,{span:12},{default:a(()=>[e(u,{label:"开始日期",name:"startDate",labelCol:{span:6},rules:[{required:!0,message:"请填写开始日期"}]},{default:a(()=>[e(F,{value:t.startDate,"onUpdate:value":n[12]||(n[12]=s=>t.startDate=s),"value-format":"YYYY-MM-DD",format:"YYYY-MM-DD",disabled:d(m),style:{width:"100%"},picker:"date",onChange:Z},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]]),p(e(r,{span:11},{default:a(()=>[e(u,{label:"结束日期",name:"endDate",labelCol:{span:6},rules:[{required:!0,message:"请填写结束日期"}]},{default:a(()=>[e(F,{value:t.endDate,"onUpdate:value":n[13]||(n[13]=s=>t.endDate=s),"value-format":"YYYY-MM-DD",format:"YYYY-MM-DD",disabled:d(m),style:{width:"100%"},picker:"date"},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),e(f,{gutter:24},{default:a(()=>[p(e(r,{span:12},{default:a(()=>[e(u,{name:"reminderTime",label:"提醒时间",labelCol:{span:6},rules:[{required:!0}]},{default:a(()=>[e(Fe,{value:t.reminderTime,"onUpdate:value":n[14]||(n[14]=s=>t.reminderTime=s),"value-format":"HH:mm",format:"HH:mm",disabled:d(m),style:{width:"100%"},maxlength:"20",onChange:Z},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]]),p(e(r,{span:11},{default:a(()=>[e(u,{name:"repeatingRules",label:"重复规则",labelCol:{span:6},rules:[{required:!0,message:"请选择重复规则"}]},{default:a(()=>[e(xe,{value:t.repeatingRules,"onUpdate:value":n[15]||(n[15]=s=>t.repeatingRules=s),options:h.value,allowClear:"",disabled:d(m)||!t.reminderTime},null,8,["value","options","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),e(f,{gutter:24},{default:a(()=>[p(e(r,{span:12},{default:a(()=>[e(u,{name:"organizer",label:"日程组织人",labelCol:{span:6},rules:[{required:!1}]},{default:a(()=>[e(H,{value:t.organizer,"onUpdate:value":n[16]||(n[16]=s=>t.organizer=s),style:{width:"100%"},disabled:"",maxlength:"20"},null,8,["value"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),e(f,{gutter:24},{default:a(()=>[p(e(r,{span:24},{default:a(()=>[e(u,{name:"handleFor",label:"协作人",labelCol:{span:3},rules:[{required:!1,message:"请输入协作人"}]},{default:a(()=>[re("div",je,[e(o,{type:"link",onClick:P,disabled:d(m)},{default:a(()=>[v("选择")]),_:1},8,["disabled"]),e(o,{type:"link",onClick:Q,disabled:d(m)},{default:a(()=>[v("清空")]),_:1},8,["disabled"])]),e(H,{value:t.handleFor,"onUpdate:value":n[17]||(n[17]=s=>t.handleFor=s),class:"input-input",disabled:""},null,8,["value"]),e(de,{title:"组织人员",visible:D.value,"onUpdate:visible":[n[18]||(n[18]=s=>D.value=s),n[20]||(n[20]=s=>D.value=s)],value:t.handleForList,"onUpdate:value":n[19]||(n[19]=s=>t.handleForList=s),tdata:z.value,tfields:{key:"nodeId",title:"nodeName"},width:800,height:600,onCancel:J,onConfirm:W},null,8,["visible","value","tdata"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),e(f,{gutter:24},{default:a(()=>[p(e(r,{span:24},{default:a(()=>[e(u,{name:"reminderMethod",label:"提醒方式",labelCol:{span:3},rules:[{required:!0,message:"请选择提醒方式"}]},{default:a(()=>[e(se,{value:t.reminderMethod,"onUpdate:value":n[21]||(n[21]=s=>t.reminderMethod=s),style:{width:"100%"},disabled:d(m)},{default:a(()=>[e(f,null,{default:a(()=>[e(r,{span:6},{default:a(()=>[e(Y,{value:"system"},{default:a(()=>[v("系统内(pc端)")]),_:1})]),_:1}),e(r,{span:6},{default:a(()=>[e(Y,{value:"message"},{default:a(()=>[v("短信")]),_:1})]),_:1}),e(r,{span:6},{default:a(()=>[e(Y,{value:"e-mail"},{default:a(()=>[v("邮件")]),_:1})]),_:1})]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])],64)}}});const Xe=Oe(Ke,[["__scopeId","data-v-c3117d00"]]);export{Xe as default};
//# sourceMappingURL=Schedule-729c0814.js.map
