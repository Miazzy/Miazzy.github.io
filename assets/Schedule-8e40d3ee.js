var g=($,k,i)=>new Promise((w,b)=>{var m=s=>{try{v(i.next(s))}catch(_){b(_)}},T=s=>{try{v(i.throw(s))}catch(_){b(_)}},v=s=>s.done?w(s.value):Promise.resolve(s.value).then(m,T);v((i=i.apply($,k)).next())});import{d as U,k as f,o as W,al as D,Z as B,a9 as H,aa as c,f as u,E,$ as S,B as K,ad as P,_ as V,F as Z,ae as j,u as z}from"./vue-71d1abb3.js";import G from"./Schedule-729c0814.js";import{a7 as J,bE as F,a5 as Q,_ as X}from"./index.js";import{h as I}from"./moment-4717c495.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./Dialog-0a006d82.js";import"./antd-15ac76ed.js";import"./assign-37f1c13d.js";const ee={class:"card-content",style:{height:"360px","overflow-y":"auto"}},te={style:{"white-space":"pre-wrap"}},ae={class:"events"},ne=U({__name:"Schedule",setup($){let k=0;const i=f(),w=f(!1);function b({key:l}){w.value=!1,setTimeout(()=>{i.value.handleClickMenu(l)},300)}const m=f();f(!0);const T=l=>Q.get({url:"/oa/calendar-schedule/getAlldaySchedule",params:l},{}),v=f(!1),s=f([]),_=f();let Y=new Date,x=new Date;const N=l=>{let a=l.toDate();a<Y&&(Y=a),a>x&&(x=a);let n=a.getFullYear(),e=(a.getMonth()+1).toString().padStart(2,"0"),o=a.getDate().toString().padStart(2,"0"),h=`${n}-${e}-${o}`,y=s.value[h];const p=[],r=[];let d={};return y!=null&&(F(y,t=>{if(t.dataType=="schedule"){let M=new Date(t.today).getDay(),A=new Date(t.startTime).getDay();switch(d=t,t.notificationRules){case"not":t.today==I(new Date(t.startTime)).format("YYYY-MM-DD")&&r.push(t);break;case"day":r.push(t);break;case"workday":M>=1&&M<=5&&r.push(t);break;case"weekday":M==A&&r.push(t);break;case"monthly":let L=Math.ceil(new Date(t.today).getDate()/7),O=Math.ceil(new Date(t.startTime).getDate()/7);M==A&&L==O&&r.push(t);break;case"monthly2":new Date(t.startTime).getDate()==new Date(t.today).getDate()&&r.push(t);break}}else p.push(t)}),r.length>0&&(d.content="日程("+r.length+")",p.push(d))),p||[]};function C(){return g(this,null,function*(){let l=document.querySelector(".ant-picker-calendar .ant-picker-date-panel tr:first-child .ant-picker-cell:first-child"),a=document.querySelector(".ant-picker-calendar .ant-picker-date-panel tr:last-child .ant-picker-cell:last-child"),n="",e="";l==null||a==null?(n=Y.toISOString().split("T")[0],e=x.toISOString().split("T")[0]):(n=l.getAttribute("title"),e=a.getAttribute("title"));let o=yield T({startDate:n,endDate:e});s.value=o.result})}W(()=>g(this,null,function*(){C(),J.getInstance().listen("setMeeting",function(){return g(this,null,function*(){setTimeout(()=>g(this,null,function*(){yield C(),k+=1}),10)})})}));const R=(l,a)=>{setTimeout(()=>g(this,null,function*(){yield C(),k+=1}),10)},q=l=>{let a=s.value[I(l.toDate()).format("YYYY-MM-DD")],n="";a!=null&&F(a,e=>{if(e.dataType=="schedule"){let o=new Date(e.today).getDay(),h=new Date(e.startTime).getDay();switch(e.notificationRules){case"not":e.today==I(new Date(e.startTime)).format("YYYY-MM-DD")&&(n+=e.contentData);break;case"day":n+=e.contentData;break;case"workday":o>=1&&o<=5&&(n+=e.contentData);break;case"weekday":o==h&&(n+=e.contentData);break;case"monthly":let y=Math.ceil(new Date(e.today).getDate()/7),p=Math.ceil(new Date(e.startTime).getDate()/7);o==h&&y==p&&(n+=e.contentData);break;case"monthly2":new Date(e.startTime).getDate()==new Date(e.today).getDate()&&(n+=e.contentData);break}}else n+=e.contentData+`
`}),_.value=n,v.value=!0};return(l,a)=>{const n=D("a-menu-item"),e=D("a-menu"),o=D("a-dropdown"),h=D("a-badge"),y=D("a-popover"),p=D("a-calendar"),r=D("a-card");return B(),H(r,{title:"日程安排",bordered:!1,key:z(k)},{extra:c(()=>[u(o,{visible:w.value,"onUpdate:visible":a[1]||(a[1]=d=>w.value=d),trigger:["click"]},{overlay:c(()=>[u(e,{onClick:b},{default:c(()=>[u(n,{key:"meeting"},{default:c(()=>[E("会议提醒")]),_:1}),u(n,{key:"schedule"},{default:c(()=>[E("日程提醒")]),_:1})]),_:1})]),default:c(()=>[S("span",{onClick:a[0]||(a[0]=K(()=>{},["prevent"]))},"新增 >")]),_:1},8,["visible"]),u(G,{ref_key:"schedule",ref:i},null,512)]),default:c(()=>[S("div",ee,[u(p,{value:m.value,"onUpdate:value":a[2]||(a[2]=d=>m.value=d),onPanelChange:R,onSelect:q,fullscreen:!1},{dateCellRender:c(({current:d})=>[u(y,{title:"日程会议",trigger:"click"},{content:c(()=>[S("p",te,P(_.value),1)]),default:c(()=>[S("ul",ae,[(B(!0),V(Z,null,j(N(d),t=>(B(),V("li",{key:t.content},[u(h,{status:t.type,text:t.content},null,8,["status","text"])]))),128))])]),_:2},1024)]),_:1},8,["value"])])]),_:1})}}});const De=X(ne,[["__scopeId","data-v-e4f7e690"]]);export{De as default};
//# sourceMappingURL=Schedule-8e40d3ee.js.map
