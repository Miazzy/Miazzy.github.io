{"version":3,"file":"index-84f93da2.js","sources":["../../src/views/system/loginfo/operationlog/index.ts","../../src/views/system/loginfo/operationlog/index.vue"],"sourcesContent":["import { defHttp } from '/@/utils/http/axios';\nimport { BasicColumn, FormSchema } from '/@/components/Table';\n\nenum Api {\n  indexPage = '/system/operate-log/page',\n  exportExcel = '/system/operate-log/export',\n}\n\nexport const searchFormSchema: FormSchema[] = [\n  {\n    field: 'module',\n    component: 'Input',\n    label: '操作模块',\n    colProps: {\n      span: 7,\n    },\n    required: false,\n  },\n  {\n    field: 'userNickname',\n    component: 'Input',\n    label: '操作人员',\n    colProps: {\n      span: 7,\n    },\n    required: false,\n  },\n  {\n    field: 'type',\n    label: '操作类型',\n    component: 'DictSelectBox',\n    componentProps: {\n      type: 'system_operate_type',\n    },\n    colProps: {\n      span: 7,\n    },\n    required: false,\n  },\n  {\n    field: 'success',\n    label: '状态',\n    component: 'Select',\n    componentProps: {\n      options: [\n        { value: 1, label: '成功' },\n        { value: 0, label: '失败' },\n      ],\n    },\n    colProps: {\n      span: 7,\n    },\n    required: false,\n  },\n  {\n    field: 'startTime',\n    component: 'RangePicker',\n    label: '操作时间',\n    componentProps: {\n      showTime: true,\n      width: '100%',\n      // format: 'YYYY-MM-DD',\n      format: 'YYYY-MM-DD HH:mm:ss',\n      valueFormat: 'YYYY-MM-DD HH:mm:ss',\n    },\n    colProps: {\n      span: 7,\n    },\n    required: false,\n  },\n];\n\n// 列表表头\nexport const columns: BasicColumn[] = [\n  {\n    title: '日志编号',\n    dataIndex: 'id',\n    align: 'center',\n    resizable: true,\n    width: 100,\n  },\n  {\n    title: '操作模块',\n    dataIndex: 'module',\n    resizable: true,\n    align: 'left',\n    width: 200,\n  },\n  {\n    title: '操作名',\n    dataIndex: 'name',\n    resizable: true,\n    align: 'left',\n    width: 200,\n  },\n  {\n    title: '操作类型',\n    dataIndex: 'typeText',\n    resizable: true,\n    width: 120,\n  },\n  {\n    title: '操作人',\n    dataIndex: 'userNickname',\n    resizable: true,\n    width: 100,\n  },\n  {\n    title: '操作结果',\n    dataIndex: 'resultMsg',\n    align: 'left',\n    resizable: true,\n  },\n  {\n    title: '操作日期',\n    dataIndex: 'startTime',\n    resizable: true,\n    align: 'center',\n    width: 150,\n  },\n  {\n    title: '执行时间',\n    dataIndex: 'duration',\n    resizable: true,\n    align: 'right',\n    width: 120,\n  },\n  {\n    title: '操作',\n    dataIndex: 'action',\n    align: 'center',\n    width: 120,\n  },\n];\n\n// 列表数据\nexport const getDataPage = (params) =>\n  defHttp.post(\n    {\n      url: Api.indexPage,\n      params,\n    },\n    { isOnlyResult: true },\n  );\n\n// 导出\nexport function exportExcel(params) {\n  return defHttp.download({ url: Api.exportExcel, params }, '操作日志.xls');\n}\n","<template>\n  <PageWrapper dense contentFullHeight fixedHeight contentClass=\"flex\" style=\"position: relative\">\n    <!-- 数据表格 -->\n    <BasicTable\n      class=\"fix-basic-table\"\n      @register=\"registerTable\"\n      :searchInfo=\"searchInfo\"\n      @edit-end=\"handleEditEnd\"\n      @selection-change=\"handleSelectChange\"\n      @resize-column=\"(w, col) => (col.width = w)\"\n    >\n      <template #toolbar>\n        <!-- <a-button class=\"yellow-btn\" @click=\"exportData\" :preIcon=\"IconEnum.EXPORT\">\n          导出\n        </a-button> -->\n      </template>\n      <template #bodyCell=\"{ text, column, record }\">\n        <template v-if=\"column.dataIndex === 'duration'\"> {{ text }}(ms) </template>\n        <template v-if=\"column.dataIndex === 'action'\">\n          <a @click=\"handleDetail(record)\"> 详情</a>\n        </template></template\n      >\n    </BasicTable>\n\n    <!-- 详情弹窗 -->\n    <Dialog\n      :visible=\"detailVisible\"\n      smode=\"normal\"\n      :title=\"detailTitle\"\n      width=\"1000px\"\n      @close=\"cancelDetail\"\n    >\n      <a-form\n        id=\"index-form\"\n        ref=\"indexFormRef\"\n        :model=\"formState\"\n        name=\"indexForm\"\n        labelAlign=\"center\"\n        style=\"height: 500px; overflow: auto\"\n      >\n        <!-- <div style=\"width: 500px; overflow: auto\"> -->\n        <a-row>\n          <a-col :span=\"22\">\n            <a-form-item label=\"日志主键\" labelAlign=\"right\" :labelCol=\"{ span: 3 }\">\n              <span>{{ formState.id }}</span>\n            </a-form-item>\n          </a-col>\n          <a-col :span=\"22\">\n            <a-form-item label=\"链路追踪\" labelAlign=\"right\" :labelCol=\"{ span: 3 }\">\n              <span>{{ formState.traceId }}</span>\n            </a-form-item>\n          </a-col>\n          <a-col :span=\"22\">\n            <a-form-item label=\"用户信息\" labelAlign=\"right\" :labelCol=\"{ span: 3 }\">\n              <span\n                >{{ formState.id }}&nbsp;|&nbsp;{{ formState.userNickname }}&nbsp;|&nbsp;{{\n                  formState.userAgent\n                }}</span\n              >\n            </a-form-item>\n          </a-col>\n          <a-col :span=\"22\">\n            <a-form-item label=\"操作信息\" labelAlign=\"right\" :labelCol=\"{ span: 3 }\">\n              <span>{{ formState.module }}&nbsp;|&nbsp;{{ formState.name }}</span>\n            </a-form-item>\n          </a-col>\n          <a-col :span=\"22\">\n            <a-form-item label=\"请求信息\" labelAlign=\"right\" :labelCol=\"{ span: 3 }\">\n              <span>{{ formState.requestMethod }}&nbsp;|&nbsp;{{ formState.requestUrl }}</span>\n            </a-form-item>\n          </a-col>\n          <a-col :span=\"22\">\n            <a-form-item label=\"方法名\" labelAlign=\"right\" :labelCol=\"{ span: 3 }\">\n              <span>{{ formState.javaMethod }}</span>\n            </a-form-item>\n          </a-col>\n          <a-col :span=\"22\">\n            <a-form-item label=\"方法参数\" labelAlign=\"right\" :labelCol=\"{ span: 3 }\">\n              <span style=\"display: block; overflow: auto; word-wrap: break-word\">{{\n                formState.javaMethodArgs\n              }}</span>\n            </a-form-item>\n          </a-col>\n        </a-row>\n        <!-- </div> -->\n      </a-form>\n      <template #footer>\n        <a-button key=\"back\" @click=\"cancelDetail\">关闭</a-button>\n        <!-- <PrintButton :config=\"{ printable: 'index-form', header: detailTitle }\" /> -->\n      </template>\n    </Dialog>\n  </PageWrapper>\n</template>\n<script lang=\"ts\" setup>\n  import { onMounted, reactive, ref, nextTick } from 'vue';\n  import { BasicTable, useTable, TableAction } from '/@/components/Table';\n  import { PageWrapper } from '/@/components/Page';\n  import { IconEnum } from '@/enums/appEnum';\n  import { message } from 'ant-design-vue';\n  import DictSelectBox from '@/components/Framework/Combox/DictSelectBox.vue';\n  import PrintButton from '/@/components/Framework/Button/PrintButton.vue';\n  import { columns, getDataPage, searchFormSchema, exportExcel } from './index.ts';\n  import { assign } from 'lodash-es';\n  import { updateIndex } from '/@/views/baseset/operation/safecheck/safeCheckSet';\n  import { exportExcelFile } from '@/utils/file/download';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { useMessage } from '@/hooks/web/useMessage';\n  import Dialog from '@/components/Framework/Modal/Dialog.vue';\n  const { t } = useI18n();\n  const { createConfirm, createMessage } = useMessage();\n\n  const searchInfo = reactive<Recordable>({}); // 查询信息\n  const detailVisible = ref<boolean>(false);\n  const formState = reactive({\n    id: '',\n    module: '',\n  });\n  const sqlFormState = reactive({});\n  const detailTitle = ref('操作日志详情');\n  const isEdit = ref<boolean>(false);\n  const isShow = ref<boolean>(false);\n  const indexFormRef = ref<FormInstance>();\n  const sqlFormRef = ref<FormInstance>();\n  let selectedRow = reactive({});\n  let selectedRowId = ref('');\n\n  const getDataListParam = async () => {\n    let searchForm = getForm().getFieldsValue();\n    const paginationRef = getPaginationRef() as any;\n    searchForm.pageNo = paginationRef.current;\n    searchForm.pageSize = paginationRef.pageSize;\n    let dataObj = await getDataPage(searchForm);\n    return dataObj;\n  };\n\n  const [registerTable, { reload, getForm, getDataSource, getPaginationRef }] = useTable({\n    title: '操作日志',\n    api: getDataListParam,\n    rowKey: 'id',\n    columns,\n    useSearchForm: true,\n    showTableSetting: true,\n    bordered: true,\n    pagination: { pageSize: 20, pageSizeOptions: ['20', '50', '100', '200'] },\n    handleSearchInfoFn(info) {\n      return info;\n    },\n    formConfig: {\n      labelWidth: 120,\n      actionColOptions: { span: 24 },\n      autoAdvancedLine: 1,\n      baseColProps: { span: 7 },\n      schemas: searchFormSchema,\n      autoSubmitOnEnter: true,\n      noHideBtnFlag: true,\n    },\n    sortFn: (sortInfo: SorterResult) => {\n      if (sortInfo.order) {\n        searchInfo.sortField = sortInfo.field;\n        searchInfo.sortOrder = sortInfo.order.replace('end', '');\n      } else {\n        searchInfo.sortField = '';\n        searchInfo.sortOrder = '';\n      }\n    },\n  });\n\n  // 导出\n  async function exportData() {\n    createConfirm({\n      title: '提示',\n      iconType: 'warning',\n      content: t('common.message.exportMessage'),\n      async onOk() {\n        await exportExcel(getForm().getFieldsValue()).then((res) => {\n          exportExcelFile(res?.data, '操作日志.xls');\n        });\n        createMessage.success(t('common.exportSuccessText'));\n      },\n    });\n  }\n\n  function handleSelectChange({ keys, rows }) {\n    if (rows && rows.length > 0) {\n      const record = rows[0];\n      selectedRowId.value = record.id;\n      selectedRow = record;\n    } else {\n      selectedRowId.value = '';\n      selectedRow = null;\n    }\n  }\n\n  function onSelect(record, selected) {\n    if (selected) {\n      selectedRowId.value = record.id;\n      selectedRow = record;\n    } else {\n      selectedRowId.value = '';\n      selectedRow = null;\n    }\n  }\n  function handleEditEnd({ record, index, key, value }: Recordable) {\n    saveIndex(record)\n      .then(() => {\n        message.success('已保存');\n        reload();\n      })\n      .catch(() => {});\n  }\n\n  //---------------------------------操作按钮---------------------------------------\n  function handleDetail(record: any) {\n    detailVisible.value = true;\n    assign(formState, record);\n  }\n\n  // 关闭数据详情窗口\n  function cancelDetail() {\n    detailVisible.value = false;\n    debugger;\n  }\n\n  // 启动执行代码\n  onMounted(async () => {});\n</script>\n<style lang=\"less\" scoped>\n  .fix-basic-table {\n    :deep(&.vben-basic-table .ant-table-wrapper) {\n      padding: 10px 16px 12px;\n    }\n\n    :deep(.table-settings .anticon-setting) {\n      margin-right: 0;\n    }\n  }\n</style>\n"],"names":["searchFormSchema","columns","getDataPage","params","defHttp","useI18n","useMessage","searchInfo","reactive","detailVisible","ref","formState","detailTitle","indexFormRef","selectedRowId","getDataListParam","__async","searchForm","getForm","paginationRef","getPaginationRef","registerTable","reload","getDataSource","useTable","info","sortInfo","handleSelectChange","keys","rows","record","handleEditEnd","index","key","value","message","handleDetail","assign","cancelDetail","onMounted"],"mappings":"kvCAQO,MAAMA,EAAiC,CAC5C,CACE,MAAO,SACP,UAAW,QACX,MAAO,OACP,SAAU,CACR,KAAM,CACR,EACA,SAAU,EACZ,EACA,CACE,MAAO,eACP,UAAW,QACX,MAAO,OACP,SAAU,CACR,KAAM,CACR,EACA,SAAU,EACZ,EACA,CACE,MAAO,OACP,MAAO,OACP,UAAW,gBACX,eAAgB,CACd,KAAM,qBACR,EACA,SAAU,CACR,KAAM,CACR,EACA,SAAU,EACZ,EACA,CACE,MAAO,UACP,MAAO,KACP,UAAW,SACX,eAAgB,CACd,QAAS,CACP,CAAE,MAAO,EAAG,MAAO,IAAK,EACxB,CAAE,MAAO,EAAG,MAAO,IAAK,CAC1B,CACF,EACA,SAAU,CACR,KAAM,CACR,EACA,SAAU,EACZ,EACA,CACE,MAAO,YACP,UAAW,cACX,MAAO,OACP,eAAgB,CACd,SAAU,GACV,MAAO,OAEP,OAAQ,sBACR,YAAa,qBACf,EACA,SAAU,CACR,KAAM,CACR,EACA,SAAU,EACZ,CACF,EAGaC,GAAyB,CACpC,CACE,MAAO,OACP,UAAW,KACX,MAAO,SACP,UAAW,GACX,MAAO,GACT,EACA,CACE,MAAO,OACP,UAAW,SACX,UAAW,GACX,MAAO,OACP,MAAO,GACT,EACA,CACE,MAAO,MACP,UAAW,OACX,UAAW,GACX,MAAO,OACP,MAAO,GACT,EACA,CACE,MAAO,OACP,UAAW,WACX,UAAW,GACX,MAAO,GACT,EACA,CACE,MAAO,MACP,UAAW,eACX,UAAW,GACX,MAAO,GACT,EACA,CACE,MAAO,OACP,UAAW,YACX,MAAO,OACP,UAAW,EACb,EACA,CACE,MAAO,OACP,UAAW,YACX,UAAW,GACX,MAAO,SACP,MAAO,GACT,EACA,CACE,MAAO,OACP,UAAW,WACX,UAAW,GACX,MAAO,QACP,MAAO,GACT,EACA,CACE,MAAO,KACP,UAAW,SACX,MAAO,SACP,MAAO,GACT,CACF,EAGaC,GAAeC,GAC1BC,EAAQ,KACN,CACE,IAAK,2BACL,OAAAD,CACF,EACA,CAAE,aAAc,EAAK,CACvB,qHCnCcE,EAAQ,EACmBC,EAAW,EAE9C,MAAAC,EAAaC,EAAqB,CAAA,CAAE,EACpCC,EAAgBC,EAAa,EAAK,EAClCC,EAAYH,EAAS,CACzB,GAAI,GACJ,OAAQ,EAAA,CACT,EACoBA,EAAS,CAAA,CAAE,EAC1B,MAAAI,EAAcF,EAAI,QAAQ,EACjBA,EAAa,EAAK,EAClBA,EAAa,EAAK,EACjC,MAAMG,EAAeH,IACFA,EAAkB,EACnBF,EAAS,CAAA,CAAE,EACzB,IAAAM,EAAgBJ,EAAI,EAAE,EAE1B,MAAMK,EAAmB,IAAYC,EAAA,sBAC/B,IAAAC,EAAaC,IAAU,iBAC3B,MAAMC,EAAgBC,IACtB,OAAAH,EAAW,OAASE,EAAc,QAClCF,EAAW,SAAWE,EAAc,SACtB,MAAMjB,GAAYe,CAAU,CACnC,GAGH,CAACI,EAAe,CAAE,OAAAC,EAAQ,QAAAJ,EAAS,cAAAK,GAAe,iBAAAH,CAAA,CAAkB,EAAII,EAAS,CACrF,MAAO,OACP,IAAKT,EACL,OAAQ,KACR,QAAAd,GACA,cAAe,GACf,iBAAkB,GAClB,SAAU,GACV,WAAY,CAAE,SAAU,GAAI,gBAAiB,CAAC,KAAM,KAAM,MAAO,KAAK,CAAE,EACxE,mBAAmBwB,EAAM,CAChB,OAAAA,CACT,EACA,WAAY,CACV,WAAY,IACZ,iBAAkB,CAAE,KAAM,EAAG,EAC7B,iBAAkB,EAClB,aAAc,CAAE,KAAM,CAAE,EACxB,QAASzB,EACT,kBAAmB,GACnB,cAAe,EACjB,EACA,OAAS0B,GAA2B,CAC9BA,EAAS,OACXnB,EAAW,UAAYmB,EAAS,MAChCnB,EAAW,UAAYmB,EAAS,MAAM,QAAQ,MAAO,EAAE,IAEvDnB,EAAW,UAAY,GACvBA,EAAW,UAAY,GAE3B,CAAA,CACD,EAiBD,SAASoB,EAAmB,CAAE,KAAAC,EAAM,KAAAC,GAAQ,CACtC,GAAAA,GAAQA,EAAK,OAAS,EAAG,CACrB,MAAAC,EAASD,EAAK,CAAC,EACrBf,EAAc,MAAQgB,EAAO,EACf,MAEdhB,EAAc,MAAQ,EAG1B,CAWA,SAASiB,EAAc,CAAE,OAAAD,EAAQ,MAAAE,EAAO,IAAAC,EAAK,MAAAC,GAAqB,CACtD,UAAAJ,CAAM,EACb,KAAK,IAAM,CACVK,EAAQ,QAAQ,KAAK,EACdb,GAAA,CACR,EACA,MAAM,IAAM,CAAA,CAAE,CACnB,CAGA,SAASc,EAAaN,EAAa,CACjCrB,EAAc,MAAQ,GACtB4B,EAAO1B,EAAWmB,CAAM,CAC1B,CAGA,SAASQ,GAAe,CACtB7B,EAAc,MAAQ,GACtB,QACF,CAGA,OAAA8B,EAAU,IAAYvB,EAAA,sBAAA,EAAE"}