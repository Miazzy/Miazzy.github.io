{"version":3,"file":"create-7d7cf8b9.js","sources":["../../src/views/po/safetytools/safetytoolsscrap/create.ts","../../src/views/po/safetytools/safetytoolsscrap/create.vue"],"sourcesContent":["import { BasicColumn } from '@/components/Table';\nimport { defHttp } from '@/utils/http/axios';\n\nenum Api {\n  //查询报废内容\n  addSafetyToolsScrapData = '/po/safety-tools-scrap/create',\n  getSafetyToolsScrapData = '/po/safety-tools-scrap/get',\n  getSafetyToolsList = '/po/safety-tools/pageView',\n}\n\nexport const getSafetyToolsListApi = Api.getSafetyToolsList;\n\n//查询报废内容\nexport function getSafetyToolsScrapData(params) {\n  return defHttp.get({ url: Api.getSafetyToolsScrapData, params });\n}\n\n// 新增报废内容\nexport function addSafetyToolsScrapData(params) {\n  return defHttp.post({ url: Api.addSafetyToolsScrapData, params });\n}\n//查询安全工器具\nexport function getSafetyToolsList(params) {\n  return defHttp.get({ url: Api.getSafetyToolsList, params });\n}\n\nexport const toolsColumns: BasicColumn[] = [\n  { title: '工器具编号', dataIndex: 'code', width: 80 },\n  { title: '工器具名称', dataIndex: 'name', width: 80 },\n  { title: '规格型号', dataIndex: 'specification', width: 80 },\n];\n","<template>\n  <PageWrapper dense contentFullHeight fixedHeight  contentClass=\"flex\" style=\"position: relative\">\n<div class=\"load\">\n\t<a-spin :spinning=\"formState.spinning\" tip=\"Loading...\">\n    <div class=\"process-box\">\n      <div class=\"header-box\">\n        <BillTitle :options=\"billTitleOptions\" />\n        <WfApproveBox\n          :processInstanceId=\"processInstanceId\"\n          @agree=\"flowOption.handleAgree\"\n          @save=\"flowOption.handleSave\"\n          @submit=\"flowOption.handleSubmit\"\n          :processStatus=\"formState.status\"\n          :listenMessage=\"`safety-tools-scrap`\"\n        />\n        <!-- <PrintButton style=\"margin-left: 10px\" v-if=\"formState.status === 2\" /> -->\n      </div>\n      <div class=\"content\">\n        <a-form\n          :model=\"formState\"\n          name=\"basic\"\n          ref=\"formRef\"\n          autocomplete=\"off\"\n          @finish=\"onFinish\"\n        >\n          <a-card title=\"基本信息\" :bordered=\"false\">\n            <a-row :gutter=\"32\">\n              <a-col :span=\"12\">\n                <a-form-item\n                  label=\"电站名称\"\n                  name=\"stationName\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: false }]\"\n                >\n                  <a-input v-model:value=\"formState.stationName\" disabled />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"12\">\n                <a-form-item\n                  label=\"工器具名称\"\n                  name=\"safetyToolsId\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: true, message: '工器具名称不能为空。' }]\"\n                >\n                  <SearchBox\n                    v-model:value=\"formState.name\"\n                    :columns=\"toolsColumns\"\n                    :disabled=\"disabledInput\"\n                    :api=\"getSafetyToolsListApi\"\n                    :searchKey=\"`queryParam`\"\n                    :apiParamFunc=\"\n                      () => {\n                        return {\n                          stationId: formState.stationId,\n                        };\n                      }\n                    \"\n                    :pagination=\"true\"\n                    style=\"width: 100%\"\n                    @change=\"changeSafetyTools\"\n                  />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"12\">\n                <a-form-item\n                  label=\"物料编码\"\n                  name=\"materialCode\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: false }]\"\n                >\n                  <a-input v-model:value=\"formState.materialCode\" disabled=\"true\" />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"12\">\n                <a-form-item\n                  label=\"物料全称\"\n                  name=\"materialFullName\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: false }]\"\n                >\n                  <a-input v-model:value=\"formState.materialFullName\" disabled=\"true\" />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"12\">\n                <a-form-item\n                  label=\"工器具编码\"\n                  name=\"code\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: false }]\"\n                >\n                  <a-input v-model:value=\"formState.code\" disabled=\"true\" />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"12\">\n                <a-form-item\n                  label=\"规格型号\"\n                  name=\"specification\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: false }]\"\n                >\n                  <a-input v-model:value=\"formState.specification\" disabled=\"true\" />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"12\">\n                <a-form-item\n                  label=\"生产厂家\"\n                  name=\"factoryName\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: false }]\"\n                >\n                  <a-input v-model:value=\"formState.factoryName\" disabled=\"true\" />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"12\">\n                <a-form-item\n                  label=\"供应商\"\n                  name=\"supplierName\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: false }]\"\n                >\n                  <a-input v-model:value=\"formState.supplierName\" disabled=\"true\" />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"12\">\n                <a-form-item\n                  label=\"生产日期\"\n                  name=\"productionDate\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: false }]\"\n                >\n                  <a-input v-model:value=\"formState.productionDate\" disabled=\"true\" />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"12\">\n                <a-form-item\n                  label=\"报废时间\"\n                  name=\"scrapDate\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: true, message: '报废时间不能为空' }]\"\n                >\n                  <a-date-picker\n                    v-model:value=\"formState.scrapDate\"\n                    valueFormat=\"YYYY-MM-DD\"\n                    style=\"width: 100%\"\n                    :disabled=\"disabledInput\"\n                  />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"24\">\n                <a-form-item\n                  label=\"报废说明\"\n                  name=\"remark\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: true, message: '报废说明不能为空' }]\"\n                >\n                  <a-textarea\n                    v-model:value=\"formState.remark\"\n                    row=\"3\"\n                    :autosize=\"{ minRows: 13, maxRows: 13 }\"\n                    :disabled=\"disabledInput\"\n                    maxlength=\"1024\"\n                  />\n                </a-form-item>\n              </a-col>\n            </a-row>\n          </a-card>\n        </a-form>\n        <a-card title=\"附件上传\" :bordered=\"false\">\n          <UploadBox\n            :width=\"800\"\n            :height=\"550\"\n            :maxCount=\"20\"\n            :maxSize=\"100 * 1024 * 1024\"\n            :application=\"`po`\"\n            :module=\"`safetytoolsscrap`\"\n            :vmode=\"formState.status == 0 ? `box` : `view`\"\n            :bizId=\"formState.bizFileId\"\n          />\n        </a-card>\n      </div>\n    </div>\n  </a-spin>\n</div>\n</PageWrapper>\n</template>\n\n<script lang=\"ts\" setup>\n  //form\n  import { PageWrapper } from '/@/components/Page';\n  import { reactive, ref, onMounted,toRaw,computed } from 'vue';\n  import { urlToPath } from '/@/utils/route';\n  import { FormInstance } from 'ant-design-vue';\n  // import PrintButton from '/@/components/Framework/Button/PrintButton.vue';\n  import {\n    addSafetyToolsScrapData,\n    getSafetyToolsScrapData,\n    getSafetyToolsListApi,\n    toolsColumns,\n  } from './create';\n  import SearchBox from '@/components/Framework/Combox/SearchBox.vue';\n  import BillTitle from '/@/components/Framework/BillTitle/BillTitle.vue';\n  import WfApproveBox from '/@/components/Framework/WorkFlow/WfApproveBox.vue';\n  import * as ProcessInstanceApi from '@/api/bpm/processInstance';\n  import UploadBox from '@/components/Framework/Combox/UploadBox.vue';\n  import { buildShortUUID } from '@/utils/uuid';\n  import { closeCurrentTab } from '@/utils/route';\n  import { SysMessage } from '/@/hooks/web/useMessage';\n  import { MsgManager } from '/@/message/MsgManager';\n  import { useUserStore } from '/@/store/modules/user';\n\n  const userStore = useUserStore();\n  const userInfo = toRaw(userStore.getUserInfo);\n  const disabledInput=computed(()=>{\n    return formState.status!=0 || (formState.status==0 && \n    formState.personMemberId !='' && \n          formState.personMemberId.substring(0,32) != userInfo.userId);\n  })\n\n\n  const processInstanceId: any = ref('');\n  const formRef = ref<FormInstance>();\n    let {params:query} = urlToPath() as any;\n  const formState:any = reactive({\n    id: query.id || '',\n    status: 0,\n    stationOrganId: query.stationOrganId || '',\n    stationOrganName: query.stationOrganName || '',\n    stationId: query.stationId || '',\n    stationName: query.stationName || '',\n    safetyToolsId: '',\n    name: '',\n    scrapDate: '',\n    personMemberId: '',\n    remark: '',\n    billCode: '',\n    spinning:false,\n    fillinDate: '',\n    materialCode: '',\n    materialFullName: '',\n    code: '',\n    specification: '',\n    factoryName: '',\n    supplierName: '',\n    productionDate: '',\n    bizFileId: '',\n  });\n\n  const onFinish = () => {\n    formState.spinning=true;\n    addSafetyToolsScrapData(formState)\n      .then((rsp) => {\n        if (rsp.result != '') {\n          formState.id = rsp.result;\n          SysMessage.getInstance().success(formState.status == 1 ? '提交成功' : '保存成功');\n          if (formState.status == 1) {\n            setTimeout(() => {\n              MsgManager.getInstance().sendMsg('safety-tools-scrap', {});\n              closeCurrentTab();\n            }, 100);\n          }\n        } else {\n          formState.status = 0;\n         \n          SysMessage.getInstance().error('保存失败.');\n        }\n        formState.spinning=false;\n      })\n      .catch((e) => {\n        formState.status = 0;\n        formState.spinning=false;\n        console.log(e);\n      });\n  };\n  const billTitleOptions = reactive<any>({subject : '工器具报废'});  \n  \n  const flowOption = {\n    handleAgree: (flowData) => {\n      console.log('同意', flowData);\n    },\n    handleSave: (flowData) => {\n      console.log('保存', flowData);\n      formState.status = 0;\n      onFinish();\n    },\n    handleSubmit: (flowData) => {\n      console.log('提交', flowData);\n      formState.status = 1;\n      const value = formRef.value;\n      if (!value) {\n        return;\n      }\n      value\n        .validateFields()\n        .then(() => {\n          onFinish();\n        })\n        .catch((e) => {\n          console.log(e);\n          formState.status = 0;\n        });\n    },\n  };\n\n  const changeSafetyTools = (id, item) => {\n    let row = item.record;\n    formState.materialCode = row.materialCode;\n    formState.materialFullName = row.materialFullName;\n    formState.code = row.code;\n    formState.name = row.name;\n    formState.specification = row.specification;\n    formState.factoryName = row.factoryName;\n    formState.supplierName = row.supplierName;\n    formState.productionDate = row.productionDate;\n    formState.safetyToolsId = row.key;\n  };\n\n  // global\n  onMounted(async () => {\n    processInstanceId.value = query.processInstanceId;\n    if (!formState.id && query.processInstanceId) {\n      const processInstance = await ProcessInstanceApi.getProcessInstance(\n        query.processInstanceId as string,\n      );\n      formState.id = processInstance.businessKey;\n    }\n\n    const scrapData = await getSafetyToolsScrapData({ id: formState.id });\n    const rs = scrapData.result;\n    if (formState.id) {\n      for (let key in rs) {\n        formState[key] = rs[key];\n      }\n      formState.status = Number(formState.status);\n    } else {\n      formState.billCode = rs.billCode;\n      formState.personMemberName = rs.personMemberName;\n      formState.deptName=rs.deptName;\n      formState.fillinDate = rs.fillinDate;\n      formState.bizFileId = buildShortUUID();\n    }\n\n    let { billCode, fillinDate, personMemberName,deptName } = rs;\n      Object.assign(billTitleOptions, { billCode, fillinDate, personMemberName,deptName });\n \n  });\n</script>\n\n<style lang=\"less\" scoped></style>\n"],"names":["getSafetyToolsListApi","getSafetyToolsScrapData","params","defHttp","addSafetyToolsScrapData","toolsColumns","userStore","useUserStore","userInfo","toRaw","disabledInput","computed","formState","processInstanceId","ref","formRef","query","urlToPath","reactive","onFinish","rsp","SysMessage","MsgManager","closeCurrentTab","e","billTitleOptions","flowOption","flowData","value","changeSafetyTools","id","item","row","onMounted","__async","processInstance","ProcessInstanceApi.getProcessInstance","rs","key","buildShortUUID","billCode","fillinDate","personMemberName","deptName"],"mappings":"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"}