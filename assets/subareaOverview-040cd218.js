var m=(x,i,v)=>new Promise((_,N)=>{var O=n=>{try{p(v.next(n))}catch(b){N(b)}},E=n=>{try{p(v.throw(n))}catch(b){N(b)}},p=n=>n.done?_(n.value):Promise.resolve(n.value).then(O,E);p((v=v.apply(x,i)).next())});import{_ as X,ad as A,I as re}from"./index.js";import ne from"./areaItem-eaf00819.js";import ie from"./inverterList-7a8d096e.js";import ue from"./areaDialog-3723d7e9.js";import{g as ce,a as ve,b as de,c as pe,d as me}from"./monitorApi-44e70004.js";import{d as Y,Z as r,_ as c,$ as s,R as Z,a6 as _e,k as l,o as fe,al as ye,a9 as U,aa as h,f as y,u as C,ac as I,F as S,ae as L,ad as g,E as G,a5 as J}from"./vue-71d1abb3.js";import{aC as ge,aD as be,aA as he,aE as ke}from"./antd-15ac76ed.js";import"./deviceItem-f8cae721.js";import"./deviceDialog-59d49a92.js";import"./Dialog-0a006d82.js";import"./deviceWarning-620b5d81.js";import"./BasicTable-0434a334.js";import"./useForm-dea3ed18.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-f4fc48e6.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./uniqBy-92d3bc7f.js";import"./index-085d06c7.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useTable-109483b3.js";import"./dataDetail-62a9c747.js";import"./EchartLineChart.vue_vue_type_style_index_0_lang-c85cdf3b.js";import"./install-58e0bd81.js";import"./helper-474c7a04.js";import"./api-32c7505d.js";import"./index-74ac3212.js";import"./Export2Excel-389a8fc9.js";import"./dataComparison-458260e7.js";import"./areaChart-6d6d7460.js";import"./areaDataComparison-89cfbeca.js";const Ie={class:"marquee"},xe={class:"marquee"},Ne=Y({__name:"Marquee",props:{style:{type:String,default:""}},setup(x){const i=x;return(v,_)=>(r(),c("div",{class:"scrollingStyle",style:_e(i.style)},[s("span",Ie,[Z(v.$slots,"default",{},void 0,!0)]),s("span",xe,[Z(v.$slots,"backup",{},void 0,!0)])],4))}});const Te=X(Ne,[["__scopeId","data-v-a8c951ab"]]),Re={class:"subarea-overview"},De={class:"area-box box-style"},we={class:"area-hearder-box"},Ae={class:"station-selector-box"},Ce={key:0,class:"warning-box"},Se={class:"warning-list"},Le={key:0},Oe={key:0},Ee={class:"red-text"},Fe={class:"refresh-box"},Pe={class:"area-content-box"},$e={class:"area-list-box"},Be={class:"area-pagination-box"},Me=["onClick"],qe={class:"device-box box-style"},ze={class:"tab-bar-item"},Ue={class:"tab-badges"},Ve={key:0,class:"tab-red"},Ke={key:1,class:"tab-orange"},V="SUB_AREA_REFRESH",Q=16,He=Y({__name:"subareaOverview",setup(x){const i=l(),v=l(""),_=l([]),N=(a,t)=>{console.log(`selected ${a}`),console.log("selected",t),v.value=t.name,P(),d.value="",T.value=1,k()},O=(a,t)=>t.name.indexOf(a)>=0,E=()=>m(this,null,function*(){let a=yield ce();a!=null&&a.length&&(_.value=a,i.value||(i.value=_.value[0].id,v.value=_.value[0].name,k()))}),p=l([]),n=l("StringFormation"),b=()=>m(this,null,function*(){let a=yield pe({stationId:i.value,areaId:d.value,deviceCategory:"PvAreaDev"}),t=yield me({stationId:i.value,areaId:d.value,deviceCategory:"PvAreaDev"});a!=null&&(p.value=a,a.map(e=>e.deviceType).includes(n.value)||(n.value=a[0].deviceType),t!=null&&p.value.forEach(e=>{e.red=t[e.deviceType].red,e.orange=t[e.deviceType].orange}))}),F=l([]),f=l([]),T=l(1),R=l(1),d=l(""),K={stringFormationErrorNum:["组串","条"],trackingAxis:["跟踪轴","台"],communicateFailureNum:["通讯故障","台"],inverter:["逆变器","台"],combinder:["汇流箱","台"],dataCollector:["数采","台"],transFormer:["箱变","台"],transformerMeter:["箱变电表","台"]},H=l(),P=()=>m(this,null,function*(){var t;let a=yield ve({stationId:i.value});if((t=Object.keys(a))!=null&&t.length){let o=[],e=0;for(let u in a)a[u]>0&&(o.push({label:K[u][0],value:a[u],unit:K[u][1]}),e=e+a[u]);H.value=e,F.value=o}}),k=a=>m(this,null,function*(){let t={pageSize:Q,pageNo:T.value,stationId:i.value},o=yield de(t);f.value=[],R.value=1,w.value||(d.value=""),o.list.length>0&&(R.value=Math.ceil(o.total/Q),console.log("totalPage.value",R.value),f.value=o.list,console.log("areaList",f.value),d.value==""&&(d.value=f.value[0].areaId,B.value=f.value[0],M.value.loadIndexData()),b())}),ee=a=>{T.value=a,k()},ae=a=>{d.value=a.areaId,console.log("curAreaId",d.value),q(),b()},$=l(!1),W=l(""),B=l({}),M=l(),te=a=>{$.value=!0,W.value=v.value+"/"+a.areaName,B.value=a,M.value.loadIndexData()},D=l();function q(){return m(this,null,function*(){let a=p.value,t;a.forEach((e,u)=>{n.value==e.deviceType&&(t=u)});const o=D.value[t];o&&o.selectAll()})}const le=()=>m(this,null,function*(){q()}),w=l(!0),z=l({StringFormation:[{valueRef:"normalNum",label:"正常",value:"normal",number:0},{valueRef:"haltNum",label:"停机",value:"halt",number:0},{valueRef:"alarmNum",label:"告警",value:"alarm",number:0},{valueRef:"interruptNum",label:"通讯中断",value:"interrupt",number:0}],Concentrate:[{valueRef:"normalNum",label:"正常",value:"normal",number:0},{valueRef:"haltNum",label:"停机",value:"halt",number:0},{valueRef:"alarmNum",label:"告警",value:"alarm",number:0},{valueRef:"interruptNum",label:"通讯中断",value:"interrupt",number:0}],CombinerDc:[{valueRef:"normalNum",label:"正常",value:"normal",number:0},{valueRef:"haltNum",label:"停机",value:"halt",number:0},{valueRef:"alarmNum",label:"告警",value:"alarm",number:0},{valueRef:"interruptNum",label:"通讯中断",value:"interrupt",number:0}],other:[{valueRef:"normalNum",label:"正常",value:"normal",number:0},{valueRef:"alarmNum",label:"告警",value:"alarm",number:0},{valueRef:"interruptNum",label:"通讯中断",value:"interrupt",number:0}]}),j=()=>m(this,null,function*(){console.info("refreshData:",Math.random());try{yield k(),yield P();let a=p.value,t;a.forEach((o,e)=>{n.value==o.deviceType&&(t=e)}),D.value&&D.value[t].getDeviceData()}catch(a){}}),se=a=>{var t;try{(t=a==null?void 0:a.target)!=null&&t.checked?A.getInstance().pushListTask(V,j,5e3):A.getInstance().removeListTask(V)}catch(o){}};return fe(()=>m(this,null,function*(){yield E(),P(),yield k(),A.getInstance().start(),w.value&&A.getInstance().pushListTask(V,j,5e3)})),(a,t)=>{const o=ye("PageWrapper");return r(),U(o,{fixedHeight:"",contentClass:"flex",style:{overflow:"hidden"}},{default:h(()=>[s("div",Re,[s("div",De,[s("div",we,[s("div",Ae,[y(re,{class:"icon-left",icon:"mdi:house-city",color:"#1890FF",size:15}),y(C(ge),{style:{width:"200px"},value:i.value,"onUpdate:value":t[0]||(t[0]=e=>i.value=e),"show-search":"",options:_.value,"filter-option":O,fieldNames:{value:"id",label:"name"},onChange:N},null,8,["value","options"])]),F.value.length?(r(),c("div",Ce,[y(Te,{style:"width: 900px;"},{default:h(()=>[s("div",Se,[H.value>0?(r(),c("span",Le,"告警总览：")):I("",!0),(r(!0),c(S,null,L(F.value,(e,u)=>(r(),c("div",{class:"warning-item",key:u},[e.value>0?(r(),c("div",Oe,[s("span",null,g(e.label)+"：",1),s("span",Ee,g(e.value),1),s("span",null,g(e.unit),1)])):I("",!0)]))),128))])]),_:1})])):I("",!0),s("div",Fe,[y(C(be),{checked:w.value,"onUpdate:checked":t[1]||(t[1]=e=>w.value=e),onChange:se},{default:h(()=>[G("自动刷新")]),_:1},8,["checked"])])]),s("div",Pe,[s("div",$e,[(r(!0),c(S,null,L(f.value,(e,u)=>(r(),U(ne,{class:J(["area-item-layout",{active:d.value===e.areaId}]),key:u,areaData:e,onClick:oe=>ae(e),onDblclick:oe=>te(e)},null,8,["class","areaData","onClick","onDblclick"]))),128))]),s("div",Be,[(r(!0),c(S,null,L(R.value,e=>(r(),c("div",{class:J(["pagination-item",{"current-page":T.value===e}]),key:e,onClick:u=>ee(e)},g(e),11,Me))),128))])])]),s("div",qe,[y(C(he),{activeKey:n.value,"onUpdate:activeKey":t[2]||(t[2]=e=>n.value=e),size:"large",onChange:le},{default:h(()=>[(r(!0),c(S,null,L(p.value,e=>(r(),U(C(ke),{key:e.deviceType},{tab:h(()=>[s("div",ze,[G(g(e.typeName)+" ",1),s("span",Ue,[e.red?(r(),c("span",Ve,g(e.red),1)):I("",!0),e.orange?(r(),c("span",Ke,g(e.orange),1)):I("",!0)])])]),default:h(()=>[y(ie,{ref_for:!0,ref_key:"deviceListRef",ref:D,statusOptionsIn:z.value[e.deviceType]!=null?z.value[e.deviceType]:z.value.other,stationId:i.value,areaId:d.value,deviceType:e.deviceType,typeName:e.typeName,onSelectAll:q},null,8,["statusOptionsIn","stationId","areaId","deviceType","typeName"])]),_:2},1024))),128))]),_:1},8,["activeKey"])]),y(ue,{ref_key:"areaDialogRef",ref:M,title:W.value,visible:$.value,data:B.value,areaOptions:f.value,"onUpdate:visible":t[3]||(t[3]=e=>$.value=e)},null,8,["title","visible","data","areaOptions"])])]),_:1})}}});const La=X(He,[["__scopeId","data-v-c5f7d025"]]);export{La as default};
//# sourceMappingURL=subareaOverview-040cd218.js.map
