{"version":3,"file":"knowledgeDrawer-2c8c2893.js","sources":["../../src/views/po/integrated/knowledge/knowledgeDrawer.vue"],"sourcesContent":["<template>\n  <div class=\"load\">\n    <a-spin :spinning=\"detailFormState.spinning\" tip=\"Loading...\">\n      <div class=\"process-box\">\n        <div class=\"header-box\">\n          <div class=\"header-left\">知识库</div>\n          <div v-if=\"!query.readOnly\" class=\"header-right\">\n            <a-button @click=\"handleCancel\">取消</a-button>\n            <a-button class=\"!ml-4\" type=\"primary\" @click=\"save\" :loading=\"isLoading\">\n              保存\n            </a-button>\n          </div>\n        </div>\n        <div class=\"content\">\n          <a-form ref=\"formRef\" :model=\"detailFormState\" labelAlign=\"right\" autocomplete=\"off\">\n            <a-card title=\"基本信息\" :bordered=\"false\">\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"deptName\"\n                    label=\"部门\"\n                    :labelCol=\"{ span: 4 }\"\n                    :rules=\"[{ required: true, message: '请输入部门' }]\"\n                  >\n                    <a-input\n                      disabled\n                      v-model:value=\"detailFormState.deptName\"\n                      placeholder=\"请输入部门\"\n                    />\n                    <a-input disabled v-model:value=\"detailFormState.id\" v-if=\"false\" />\n                  </a-form-item>\n                </a-col>\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"knowledgeTypeName\"\n                    label=\" 知识库分类\"\n                    :labelCol=\"{ span: 4 }\"\n                    :rules=\"[{ required: true, message: '请输入 知识库分类' }]\"\n                  >\n                    <a-input\n                      disabled\n                      v-model:value=\"detailFormState.knowledgeTypeName\"\n                      placeholder=\"请输入知识库分类\"\n                    />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"creatorName\"\n                    label=\" 创建人\"\n                    :labelCol=\"{ span: 4 }\"\n                    :rules=\"[{ required: true, message: '请输入创建人' }]\"\n                  >\n                    <a-input\n                      disabled\n                      v-model:value=\"detailFormState.creatorName\"\n                      placeholder=\"请输入创建人\"\n                    />\n                  </a-form-item>\n                </a-col>\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"createTime\"\n                    label=\"创建时间\"\n                    :labelCol=\"{ span: 4 }\"\n                    :rules=\"[{ required: true, message: '请选择创建时间' }]\"\n                  >\n                    <a-date-picker\n                      v-model:value=\"detailFormState.createTime\"\n                      value-format=\"YYYY-MM-DD HH:mm:ss\"\n                      format=\"YYYY-MM-DD HH:mm:ss\"\n                      style=\"min-width: 100%\"\n                      show-time\n                      disabled\n                    />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"24\">\n                  <a-form-item\n                    name=\"subject\"\n                    label=\"主题\"\n                    :labelCol=\"{ span: 2 }\"\n                    :rules=\"[{ required: true, message: '请输入主题' }]\"\n                  >\n                    <a-input\n                      v-model:value=\"detailFormState.subject\"\n                      placeholder=\"请输入主题\"\n                      :maxlength=\"200\"\n                      :disabled=\"query.readOnly\"\n                    />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n            </a-card>\n            <a-card title=\"分享内容\" :bordered=\"false\">\n              <div style=\"margin: 10px 0 0 80px\">\n                <Tinymce\n                  v-model=\"detailFormState.content\"\n                  :width=\"`calc(100% - 17px)`\"\n                  :height=\"400\"\n                  :maxChars=\"5000\"\n                  :disabled=\"query.readOnly\"\n                />\n              </div>\n            </a-card>\n\n            <a-card title=\"附件信息\" :bordered=\"false\">\n              <div class=\"clearfix\" style=\"padding-left: 15px\">\n                <UploadBox\n                  :width=\"800\"\n                  :height=\"550\"\n                  :maxCount=\"20\"\n                  :maxSize=\"100 * 1024 * 1024\"\n                  :application=\"`po`\"\n                  :module=\"`knowledge`\"\n                  :vmode=\"!query.readOnly ? `box` : `view`\"\n                  :bizId=\"detailFormState.bizFileId\"\n                />\n              </div>\n            </a-card>\n          </a-form>\n        </div>\n      </div>\n    </a-spin>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\n  import { reactive, ref, onMounted, unref, Ref, toRaw } from 'vue';\n  import { saveData, getIndex } from './knowledge';\n  import { FormInstance, message } from 'ant-design-vue';\n  import { useRouter } from 'vue-router';\n  import { assign } from 'lodash-es';\n  import BillTitle from '/@/components/Framework/BillTitle/BillTitle.vue';\n\n  import { PageFooter } from '/@/components/Page';\n  import { Tinymce } from '/@/components/Tinymce/index';\n  import * as FileApi from '@/api/infra/file';\n  import UploadBox from '@/components/Framework/Combox/UploadBox.vue';\n  import { closeCurrentTab } from '@/utils/route';\n  import { MsgManager } from '/@/message/MsgManager';\n  import { Memory } from '@/router/index';\n\n  const detailFormState = reactive({ spinning: false });\n  const showPageFooter: Ref = ref(true);\n  const isLoading = ref(false);\n\n  const disabledInput = ref<boolean>(false);\n  const billTitleOption = reactive<any>({});\n  billTitleOption.subject = '知识库';\n  billTitleOption.infoItems = [];\n  const router = useRouter();\n  const { currentRoute } = router;\n  const route = unref(currentRoute);\n  const query = Memory.getInstance().getQuery(); // route.query;\n\n  // 取消按钮\n  function handleCancel() {\n    closeCurrentTab();\n  }\n\n  const formRef = ref<FormInstance>();\n\n  function save() {\n    detailFormState.spinning = true;\n    try {\n      formRef.value.validateFields().then(() => {\n        saveData(detailFormState).then((data) => {\n          detailFormState.id = data.result;\n          message.success('保存成功');\n          MsgManager.getInstance().sendMsg('integrated-knowledge', {});\n          closeCurrentTab();\n        });\n      });\n    } catch (error) {\n      console.log('error', error);\n    } finally {\n      detailFormState.spinning = false;\n    }\n  }\n\n  assign(detailFormState, {\n    id: '',\n    status: 1,\n    subject: '',\n    content: '',\n    bizFileId: '',\n  });\n\n  onMounted(async () => {\n    query.id = await getBizParamId();\n    if (query.id) {\n      await getIndex({ id: query.id }).then((data) => {\n        assign(detailFormState, data.result);\n      });\n    } else {\n      assign(detailFormState, query);\n      detailFormState.spinning = false;\n    }\n    detailFormState.spinning = false;\n\n    if (\n      detailFormState.bizFileId == null ||\n      detailFormState.bizFileId == undefined ||\n      detailFormState.bizFileId == ''\n    ) {\n      getBizFileId();\n    }\n  });\n\n  //==================================附件资料  begin ==================================\n\n  const getBizFileId = async () => {\n    FileApi.getBizId().then((res) => {\n      detailFormState.bizFileId = res;\n    });\n  };\n\n  //==================================附件资料  end ==================================\n\n  const getBizParamId = async () => {\n    let id = query.id;\n\n    if (detailFormState.id) {\n      await getIndex({ id: detailFormState.id }).then((data) => {\n        assign(detailFormState, data.result);\n      });\n    }\n    return id;\n  };\n</script>\n<style lang=\"less\" scoped>\n  .process-box {\n    width: calc(100% - 20px);\n    height: calc(100% - 20px);\n\n    .content {\n      .left-panel {\n        width: 77.5%;\n        height: calc(100vh - 200px);\n        margin: 5px 0;\n        padding: 10px 0 5px;\n        float: left;\n        overflow-y: auto;\n        border: 1px solid #f0f0f0;\n      }\n\n      .right-panel {\n        width: 22.25%;\n        height: calc(100vh - 200px);\n        margin: 5px 0;\n        padding: 10px 0 5px;\n        float: right;\n        border: 1px solid #f0f0f0;\n\n        .button-content {\n          margin: 16px 0 0 16px;\n\n          .ant-btn {\n            margin: 0 10px 0 0;\n          }\n        }\n      }\n    }\n  }\n\n  .bill-title-box {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    width: 100%;\n\n    .bill-title {\n      font-size: 16px;\n    }\n  }\n</style>\n"],"names":["detailFormState","reactive","ref","isLoading","billTitleOption","router","useRouter","currentRoute","unref","query","Memory","handleCancel","closeCurrentTab","formRef","save","saveData","data","message","MsgManager","error","assign","onMounted","__async","getBizParamId","getIndex","getBizFileId","FileApi.getBizId","res","id"],"mappings":"8/BAqJE,MAAMA,EAAkBC,EAAS,CAAE,SAAU,EAAO,CAAA,EACxBC,EAAI,EAAI,EAC9B,MAAAC,EAAYD,EAAI,EAAK,EAELA,EAAa,EAAK,EAClC,MAAAE,EAAkBH,EAAc,CAAA,CAAE,EACxCG,EAAgB,QAAU,MAC1BA,EAAgB,UAAY,GAC5B,MAAMC,EAASC,IACT,CAAE,aAAAC,CAAiB,EAAAF,EACXG,EAAMD,CAAY,EAChC,MAAME,EAAQC,EAAO,YAAY,EAAE,SAAS,EAG5C,SAASC,GAAe,CACNC,GAClB,CAEA,MAAMC,EAAUX,IAEhB,SAASY,GAAO,CACdd,EAAgB,SAAW,GACvB,GAAA,CACFa,EAAQ,MAAM,eAAiB,EAAA,KAAK,IAAM,CACxCE,EAASf,CAAe,EAAE,KAAMgB,GAAS,CACvChB,EAAgB,GAAKgB,EAAK,OAC1BC,EAAQ,QAAQ,MAAM,EACtBC,EAAW,YAAY,EAAE,QAAQ,uBAAwB,CAAE,CAAA,EAC3CN,GAAA,CACjB,CAAA,CACF,QACMO,EAAO,CACN,QAAA,IAAI,QAASA,CAAK,CAAA,QAC1B,CACAnB,EAAgB,SAAW,EAC7B,CACF,CAEAoB,EAAOpB,EAAiB,CACtB,GAAI,GACJ,OAAQ,EACR,QAAS,GACT,QAAS,GACT,UAAW,EAAA,CACZ,EAEDqB,EAAU,IAAYC,EAAA,sBACdb,EAAA,GAAK,MAAMc,IACbd,EAAM,GACF,MAAAe,EAAS,CAAE,GAAIf,EAAM,GAAI,EAAE,KAAMO,GAAS,CACvCI,EAAApB,EAAiBgB,EAAK,MAAM,CAAA,CACpC,GAEDI,EAAOpB,EAAiBS,CAAK,EAC7BT,EAAgB,SAAW,IAE7BA,EAAgB,SAAW,IAGzBA,EAAgB,WAAa,MAC7BA,EAAgB,WAAa,MAC7BA,EAAgB,WAAa,KAEhByB,GACf,EACD,EAID,MAAMA,EAAe,IAAYH,EAAA,sBAC/BI,EAAiB,EAAE,KAAMC,GAAQ,CAC/B3B,EAAgB,UAAY2B,CAAA,CAC7B,CAAA,GAKGJ,EAAgB,IAAYD,EAAA,sBAChC,IAAIM,EAAKnB,EAAM,GAEf,OAAIT,EAAgB,KACZ,MAAAwB,EAAS,CAAE,GAAIxB,EAAgB,GAAI,EAAE,KAAMgB,GAAS,CACjDI,EAAApB,EAAiBgB,EAAK,MAAM,CAAA,CACpC,GAEIY,CAAA"}