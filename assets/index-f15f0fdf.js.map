{"version":3,"file":"index-f15f0fdf.js","sources":["../../src/views/po/safetytools/safetytools/index.ts","../../src/views/po/safetytools/safetytools/index.vue"],"sourcesContent":["import { BasicColumn, FormSchema, useRender } from '@/components/Table';\nimport { defHttp } from '@/utils/http/axios';\nimport { useUserStore } from '/@/store/modules/user';\nenum Api {\n  getSafetyToolsPage = '/po/safety-tools/page',\n  deleteSafetyToolsData = '/po/safety-tools/delete',\n  exportSafetyToolsData = '/po/safety-tools/export-excel',\n}\n\n// 查询\nexport function getSafetyToolsPage(params) {\n  return defHttp.get({ url: Api.getSafetyToolsPage, params });\n}\n// 删除\nexport function deleteSafetyTools(id: string) {\n  return defHttp.delete({ url: Api.deleteSafetyToolsData + '?id=' + id });\n}\nexport function exportSafetyToolsData(params) {\n  return defHttp.download(\n    { url: Api.exportSafetyToolsData, params },\n    { isReturnNativeResponse: true },\n  );\n}\nconst statusColor = {\n  0: '#fb5252', //不合格\n  1: '#4ace6e', //合格\n  2: '#fda941', //超期未检验\n  3: '#929292', //报废\n  4: '#338ed1', //报废中\n};\nexport const columns: BasicColumn[] = [\n  { title: '所属公司', dataIndex: 'stationOrganName',align: 'left',headAlign:'center',\n   width: 120,sorter: true,resizable: true,ifShow:useUserStore().isMultiOrganization },\n  { title: '电站名称', dataIndex: 'stationName',align: 'left',headAlign:'center',\n   width: 120,sorter: true,resizable: true },\n  { title: '工器具名称', dataIndex: 'name',align: 'left',headAlign:'center',\n   width: 120,sorter: true,resizable: true },\n  { title: '工器具编码', dataIndex: 'code',align: 'left',headAlign:'center',\n   width: 180,sorter: true,resizable: true },\n  { title: '规格型号', dataIndex: 'specification',align: 'left',headAlign:'center',\n   width: 120,sorter: true,resizable: true },\n  { title: '购买日期', dataIndex: 'purchasingDate', width: 120,sorter: true,resizable: true },\n  { title: '检验周期(月)', dataIndex: 'cycle',align: 'right',headAlign:'center', width: 120,sorter: true,resizable: true },\n  { title: '计划下次检验日期', dataIndex: 'nextCheckDate', width: 120,sorter: true,resizable: true },\n  { title: '检验次数', dataIndex: 'checkTimes',align: 'right',headAlign:'center', width: 120,sorter: true,resizable: true },\n  {\n    title: '有效性',\n    dataIndex: 'toolsStatusText',\n    sorter: true,\n    resizable: true,\n    customRender: ({ text, record }) => {\n      return useRender.renderTag(text, statusColor[record.toolsStatus]);\n    },\n  },\n];\n\nexport const searchFormSchema: FormSchema[] = [\n  { label: '工器具名称', field: 'name', component: 'Input', colProps: { span: 7 } },\n  { label: '工器具编码', field: 'code', component: 'Input', colProps: { span: 7 } },\n  { label: '规格型号', field: 'specification', component: 'Input', colProps: { span: 7 } },\n  {\n    field: '[nextCheckDateStart, nextCheckDateEnd]',\n    label: '计划下次检验日期',\n    component: 'RangePicker',\n    colProps: { span: 7 },\n    componentProps: {\n      format: 'YYYY-MM-DD',\n      valueFormat: 'YYYY-MM-DD',\n      placeholder: ['开始日期', '结束日期'],\n    },\n  },\n  {\n    label: '有效性',\n    field: 'toolStatus',\n    colProps: { span: 7 },\n    component: 'DictSelectBox',\n    componentProps: {\n      type: 'safety_tools_status',\n    },\n  },\n];\n","<template>\n  <PageWrapper dense contentFullHeight fixedHeight  contentClass=\"flex\" style=\"position: relative\">\n    <stationTree @select-tree=\"selectTree\" />\n    <div class=\"right-table-layout\">\n    <BasicTable @register=\"table\" \n    class=\"fix-basic-table\"\n    @resize-column=\"(w, col) => (col.width = w)\"\n    @selection-change=\"handleSelectChange\"\n    @row-dbClick=\"dbClick\">\n      <template #toolbar>\n        <a-button type=\"primary\" :preIcon=\"IconEnum.ADD\" @click=\"handleCreate\">\n          {{ '添加' }}\n        </a-button>\n\n        <a-button type=\"primary\" :disabled=\"selectedRowId == ''\" :preIcon=\"IconEnum.EDIT\" @click=\"handleEdit\">\n          {{ '修改' }}\n        </a-button>\n\n        <a-button class=\"red-btn\" :disabled=\"selectedRowId == ''\" :preIcon=\"IconEnum.DELETE\" @click=\"handleDelete\">\n          {{ '删除' }}\n        </a-button>\n        <a-button  class=\"yellow-btn\" :preIcon=\"IconEnum.EXPORT\" @click=\"handleExport\">\n          {{ '导出' }}\n        </a-button>\n      </template>\n    </BasicTable>\n    </div>\n  </PageWrapper>\n</template>\n\n<script lang=\"ts\" setup>\n  import { PageWrapper } from '/@/components/Page';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { useMessage } from '@/hooks/web/useMessage';\n  import { IconEnum } from '@/enums/appEnum';\n  import { BasicTable, useTable,SorterResult } from '@/components/Table';\n  import { SysMessage } from '/@/hooks/web/useMessage';\n  import { MsgManager } from '/@/message/MsgManager';\n\n  import { ref, onMounted } from 'vue';\n  import stationTree from '@/views/po/stationtree/stationTree.vue';\n  import { setStationAndOrgan } from '@/views/po/stationtree/stationTree';\n  import {\n    columns,\n    searchFormSchema,\n    getSafetyToolsPage,\n    deleteSafetyTools,\n    exportSafetyToolsData,\n  } from './index';\n  import { exportExcelFile } from '@/utils/file/download';\n  import { addTabPage,urlToPath } from '@/utils/route';\n  \n\n  let {params:query} = urlToPath() as any;\n  const { createConfirm, createMessage } = useMessage();\n  const { t } = useI18n();\n  let selectedRowId = ref('');\n\n  const queryParam: any = ref({\n    name: '',\n    code: query.code,\n    specification: '',\n    nextCheckDate: '',\n    bizStatus: '',\n    toolStatus:query.toolStatus,\n    pageNo: 1,\n    pageSize: 10,\n    sortField: 'purchasingDate',\n    sortOrder: 'desc'\n  });\n\n  const [table, { reload,  getPaginationRef, getForm,getSelectRows }] = useTable({\n    title: '安全工器具台账',\n    api: async () => {\n      const paginationRef = getPaginationRef() as any;\n      queryParam.value.pageNo = paginationRef.current;\n      queryParam.value.pageSize = paginationRef.pageSize;\n      let dataObj = await getSafetyToolsPage(queryParam.value);\n      return dataObj.result;\n    },\n    columns,\n    rowKey: 'id',\n    formConfig: {\n      labelWidth: 120,\n      showAdvancedButton:true,\n      autoAdvancedLine:1,\n      schemas: searchFormSchema,\n    },\n    bordered: true,\n    useSearchForm: true,\n    showTableSetting: true,\n    rowSelection: {\n      type: 'radio',\n      fixed: true,\n      onSelect: onSelect\n    },\n    sortFn: (sortInfo: SorterResult) => {\n      if (sortInfo.order) {\n        queryParam.value.sortField = sortInfo.field.replace('Text', '');\n        queryParam.value.sortOrder = sortInfo.order.replace('end', '');\n      } else {\n        queryParam.value.sortField = 'purchasingDate';\n        queryParam.value.sortOrder = 'desc';\n      }\n    },\n    handleSearchInfoFn(info) {\n      for (const key in info) {\n        queryParam.value[key] = info[key];\n      }\n    },\n  });\n  function onSelect(record, selected) {\n    if (selected) {\n      selectedRowId.value = record.id;\n    } else {\n      selectedRowId.value = '';\n    }\n  }\n  function handleSelectChange({ keys, rows }) {\n    if (rows && rows.length > 0) {\n      const record = rows[0];\n      selectedRowId.value = record.id;\n    } else {\n      selectedRowId.value = '';\n    }\n  }\n  function selectTree(data) {\n    setStationAndOrgan(data, queryParam, { powerStationCode: '' }, reload);\n  }\n  const dbClick=(record, index, event)=>{\n    addTabPage(`/po/safetytools/safetytools/create?id=${record.id}&status=1`,'查看安全工器具');\n  }\n\n  function handleCreate() {\n    if (!queryParam.value.stationId) {\n      SysMessage.getInstance().info('请选中电站添加');\n      return;\n    }\n    // router.push({\n    //   path: `/po/safetytools/safetytools/create?id=`,\n    //   query: {\n    //     stationId: queryParam.value.stationId,\n    //     stationName: queryParam.value.stationName,\n    //     stationOrganId: queryParam.value.stationOrganId,\n    //     stationOrganName: queryParam.value.stationOrganName,\n    //     powerStationCode: queryParam.value.powerStationCode,\n    //   },\n    // });\n    addTabPage(`/po/safetytools/safetytools/create?id=`, '添加安全工器具', {\n      stationId: queryParam.value.stationId,\n      stationName: queryParam.value.stationName,\n      stationOrganId: queryParam.value.stationOrganId,\n      stationOrganName: queryParam.value.stationOrganName,\n      powerStationCode: queryParam.value.powerStationCode,\n    });\n  }\n\n  function handleEdit() {\n    let keys = getSelectRows();\n    if (keys.length !== 1) {\n      SysMessage.getInstance().info('请选择一条数据.');\n      return false;\n    }\n    // router.push(`/po/safetytools/safetytools/create?id=${keys[0]}`);\n    let row = keys[0]\n    addTabPage(`/po/safetytools/safetytools/create?id=${row.id}`,\n    (row.status==0?'修改安全工器具':'查看安全工器具')\n    );\n  }\n  async function handleDelete() {\n    let keys = getSelectRows();\n    if (keys.length !== 1) {\n      SysMessage.getInstance().info('请选择一条数据.');\n      return false;\n    }\n\n    let row = keys[0]\n\n    createConfirm({\n      title: '提示',\n      iconType: 'warning',\n      content: '确定要删除选中的记录？',\n      async onOk() {\n        if (row.bizStatus == 3) {\n          SysMessage.getInstance().info('已生成报废单，不能删除.');\n          return false;\n        }\n      \n\n        await deleteSafetyTools(row.id);\n        createMessage.success('删除成功');\n        reload();\n      },\n    });\n\n    \n  }\n  async function handleExport() {\n    createConfirm({\n      title: t('common.exportTitle'),\n      iconType: 'warning',\n      content: t('common.exportMessage'),\n      async onOk() {\n        let exportParams = getForm().getFieldsValue();\n        Object.assign(exportParams,queryParam.value);\n        await exportSafetyToolsData(exportParams).then((res) => {\n          exportExcelFile(res?.data, '安全工器具台账.xls');\n        });\n        createMessage.success(t('common.exportSuccessText'));\n      },\n    });\n  }\n  onMounted(() => {\n    getForm().setFieldsValue({...query});\n    MsgManager.getInstance().listen('safety-tools',  ()=>{\n      reload()\n    });\n  });\n</script>\n\n<style lang=\"less\" scoped>\n  .right-table-layout {\n    flex: 1;\n    width: calc(100% - 308px);\n  }\n\n  .fix-basic-table {\n    :deep(&.vben-basic-table .ant-table-wrapper) {\n      padding: 10px 16px 12px;\n    }\n\n    :deep(.table-settings) {\n      margin-right: 0;\n    }\n\n    :deep(.table-settings .anticon-setting) {\n      margin-right: 0;\n    }\n  }\n</style>"],"names":["getSafetyToolsPage","params","defHttp","deleteSafetyTools","id","exportSafetyToolsData","statusColor","columns","useUserStore","text","record","useRender","searchFormSchema","query","urlToPath","createConfirm","createMessage","useMessage","t","useI18n","selectedRowId","ref","queryParam","table","reload","getPaginationRef","getForm","getSelectRows","useTable","__async","paginationRef","onSelect","sortInfo","info","key","selected","handleSelectChange","keys","rows","selectTree","data","setStationAndOrgan","dbClick","index","event","addTabPage","handleCreate","SysMessage","handleEdit","row","handleDelete","handleExport","exportParams","res","exportExcelFile","onMounted","__spreadValues","MsgManager"],"mappings":"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"}