var b=(d,i,u)=>new Promise((p,f)=>{var _=e=>{try{o(u.next(e))}catch(h){f(h)}},w=e=>{try{o(u.throw(e))}catch(h){f(h)}},o=e=>e.done?p(e.value):Promise.resolve(e.value).then(_,w);o((u=u.apply(d,i)).next())});import{B as q}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as Q}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{a0 as S,a5 as v,b as W,au as Y,av as X,_ as Z}from"./index.js";import{P as $}from"./index-20519caf.js";import{e as G}from"./download-03e71dd5.js";import{d as J,k as x,r as A,ax as K,u as g,o as ee,al as I,Z as M,a9 as D,aa as s,$ as N,f as r,ac as te,E as C}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";const ae=[{title:"所属公司",dataIndex:"orgName",width:150,resizable:!0,headAlign:"center",align:"left",customCell:d=>({rowSpan:d.rowOrgSpan}),ifShow:S().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",headAlign:"center",align:"left",width:150,resizable:!0},{title:"在职人数",dataIndex:"job1",headAlign:"center",align:"right",width:150,resizable:!0},{title:"运维容量",dataIndex:"connectCapacity",headAlign:"center",align:"right",width:150,resizable:!0},{title:"人均运维容量(MW)",dataIndex:"avgConnectCapacity",width:150,resizable:!0,headAlign:"center",align:"right",customRender:({text:d,record:i})=>{if(i.job1!=0)return(i.connectCapacity/i.job1).toFixed(6)}},{title:"年龄结构",dataIndex:"",resizable:!0,children:[{title:"20-30",dataIndex:"age20",headAlign:"center",align:"right",width:100,resizable:!0},{title:"30-40",dataIndex:"age30",headAlign:"center",align:"right",width:100,resizable:!0},{title:"40-50",dataIndex:"age40",headAlign:"center",align:"right",width:100,resizable:!0},{title:"50+",dataIndex:"age50",headAlign:"center",align:"right",width:100,resizable:!0},{title:"平均年龄",dataIndex:"avgAge",width:100,resizable:!0,headAlign:"center",align:"right",customRender:({text:d,record:i})=>i.avgAge==null?"":i.avgAge.toFixed(2)}]},{title:"学历结构",dataIndex:"",resizable:!0,children:[{title:"中专及以下",dataIndex:"edu4",headAlign:"center",align:"right",width:100,resizable:!0},{title:"大专",dataIndex:"edu3",headAlign:"center",align:"right",width:100,resizable:!0},{title:"本科",dataIndex:"edu2",headAlign:"center",align:"right",width:100,resizable:!0},{title:"硕士及以上",dataIndex:"edu0",headAlign:"center",align:"right",width:100,resizable:!0}]},{title:"流动性",dataIndex:"",resizable:!0,children:[{title:"离职人数",dataIndex:"job0",headAlign:"center",align:"right",width:100,resizable:!0},{title:"离职率",dataIndex:"job",width:100,headAlign:"center",align:"right",resizable:!0}]}],ne=d=>v.download({url:"/bi/personnelQualifications/personnelStructureDetail/export-excel",params:d},{isReturnNativeResponse:!0}),le={class:"fix-basic-table"},ie={class:"tab-button-div"},oe={class:"tab-table-div"},se=J({__name:"index",setup(d){const{t:i}=W(),u=x([]),p=x([]),{createConfirm:f,createMessage:_}=Y();function w(){f({title:i("common.message.confirmTitle"),iconType:"warning",content:i("common.message.exportMessage"),onOk(){return b(this,null,function*(){const t=e;t.filename="人员结构统计.xls",yield ne(t).then(n=>{G(n==null?void 0:n.data,t.filename)}),t.filename=null,_.success(i("common.exportSuccessText"))})}})}x([{label:"年份",value:"year"},{label:"月份",value:"month"}]);const o=A({searchMonth:null,searchDate:null}),e=A({ognId:null,stationId:null,dateCycle:"year",yearValue:new Date().getFullYear()+"",startMonth:null,endMonth:null,startDate:null,endDate:null}),h=()=>b(this,null,function*(){let a=yield F(e);return e.stationId!=null&&(e.stationId=e.stationId.split("|"),e.stationName=e.stationName.split("|")),a}),F=a=>v.get({url:"/bi/personnelQualifications/personnelStructureDetail",params:a},{isOnlyResult:!0}),R=a=>v.get({url:"/bi/common/station/info",params:a},{}),O=a=>v.get({url:"/bi/common/org/info",params:a},{});function k(a,t){a.length==0&&(e.stationId=void 0,e.stationName=void 0)}function T(a,t){e.ognName=t.value,e.ognId=t.lable}function j(){R({}).then(a=>{a.result&&a.result.length>0&&a.result.forEach(t=>{u.value.push({value:t.stationName,lable:t.id})})}),O({}).then(a=>{a.result&&a.result.length>0&&a.result.forEach(t=>{p.value.push({value:t.label,lable:t.value})})})}const E=K(),{currentRoute:V}=E;g(V).query,ee(a=>b(this,null,function*(){debugger;if(a){const t=getFieldsValue();a.stationId&&(t.stationId=a.stationId,setFieldsValue(t))}j()}));const[B,{reload:z}]=Q({title:"人员结构统计",api:h,columns:ae,useSearchForm:!1,bordered:!0,pagination:!1,showIndexColumn:!1,showTableSetting:!1,tableSetting:{fullScreen:!0},afterFetch:function(a){const t={};for(let n=0;n<a.length;n++){const l=a[n];if(t[l.orgId]){t[l.orgId]++;continue}t[l.orgId]=1}for(let n=0;n<a.length;n++){const l=a[n];for(const c in t)l.orgId===c&&(l.rowOrgSpan=t[c],t[c]=0)}return a}});function P(){e.ognId=null,e.stationId=void 0,e.ognName=null,e.stationName=void 0,e.dateCycle="year",e.yearValue=new Date().getFullYear()+"",e.startMonth=null,e.endMonth=null,e.startDate=null,e.endDate=null,o.searchDate=null,o.searchMonth=null,z()}const y=x();function H(){let a=[],t=[];y.value&&y.value.validateFields().then(()=>{if(Array.isArray(e.stationName))if(e.stationName.forEach(n=>{n.option!=null&&(a.push(n.option.value),t.push(n.option.lable))}),a.length>0){let n=a.join("|"),l=t.join("|");e.stationId=l,e.stationName=n}else{let n=e.stationName.join("|"),l=e.stationId.join("|");e.stationId=l,e.stationName=n}o.searchMonth!=null&&(e.startMonth=o.searchMonth[0],e.endMonth=o.searchMonth[1]),o.searchDate!=null&&(e.startDate=o.searchDate[0],e.endDate=o.searchDate[1]),z()})}return(a,t)=>{const n=I("a-select"),l=I("a-form-item"),c=I("a-button"),L=I("a-form");return M(),D(g($),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:s(()=>[N("div",le,[N("div",ie,[r(L,{model:e,name:"searchInfo",layout:"inline",autocomplete:"off",class:"search-form",ref_key:"searchFormRef",ref:y},{default:s(()=>[g(S)().isMultiOrganization?(M(),D(l,{key:0,name:"ognName",label:"所属公司",labelCol:{span:6},rules:[{required:!1,message:"请选择所属公司"}],style:{width:"26.5%"}},{default:s(()=>[r(n,{value:e.ognName,"onUpdate:value":t[0]||(t[0]=m=>e.ognName=m),"show-search":"","allow-clear":"",style:{width:"100%"},placeholder:"请选择所属公司",options:p.value,onChange:T},null,8,["value","options"])]),_:1})):te("",!0),r(l,{name:"stationName",label:"电站",labelCol:{span:6},rules:[{required:!1,message:"请选择电站"}],style:{width:"26.5%"}},{default:s(()=>[r(n,{value:e.stationName,"onUpdate:value":t[1]||(t[1]=m=>e.stationName=m),"show-search":"","allow-clear":"",mode:"multiple",style:{width:"100%"},placeholder:"请选择电站",options:u.value,onChange:k,labelInValue:"","max-tag-count":"responsive"},null,8,["value","options"])]),_:1}),r(l,{class:"search-btns"},{default:s(()=>[r(c,{style:{margin:"0 8px"},onClick:P},{default:s(()=>[C("重置")]),_:1}),r(c,{type:"primary",class:"tab-button",onClick:H},{default:s(()=>[C("查询")]),_:1})]),_:1})]),_:1},8,["model"])]),N("div",oe,[r(g(q),{onRegister:g(B),onResizeColumn:t[2]||(t[2]=(m,U)=>U.width=m)},{toolbar:s(()=>[r(c,{class:"yellow-btn",preIcon:g(X).EXPORT,onClick:w},{default:s(()=>[C("导出")]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])])])]),_:1})}}});const ke=Z(se,[["__scopeId","data-v-ac979e7e"]]);export{ke as default};
//# sourceMappingURL=index-a61bfb21.js.map
