var r=(L,u,f)=>new Promise((t,y)=>{var x=s=>{try{C(f.next(s))}catch(w){y(w)}},a=s=>{try{C(f.throw(s))}catch(w){y(w)}},C=s=>s.done?t(s.value):Promise.resolve(s.value).then(x,a);C((f=f.apply(L,u)).next())});import{B as Q}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as Y}from"./useTable-109483b3.js";import{a2 as b}from"./antd-15ac76ed.js";import{au as ee,a7 as te,av as h,ax as O,_ as ae}from"./index.js";import{P as ne}from"./index-20519caf.js";import{C as se}from"./CommonTree-c4ed7838.js";import"./index-74ac3212.js";import{e as oe,f as m,g as re,h as ie,u as K,i as le,j as P,k as de}from"./index-45369bb7.js";import{j as ue}from"./Export2Excel-389a8fc9.js";import{d as ce,k as i,r as pe,o as me,al as fe,Z as N,_ as k,f as l,aa as d,$ as R,u as n,E as _,F as Ie,ac as D,J as ve}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";import"./useRender-21ce56fb.js";const be={class:"right-table-layout"},ge={key:0,style:{color:"#19be6b"}},he={key:1,style:{color:"red"}},_e=ce({__name:"index",setup(L){let u=i("");const{createConfirm:f}=ee(),t=pe({assetCode:null,deviceCode:null,userName:null,status:null}),y=i([]),x=i({}),a=i([]),C=P(),s=i([]),w=()=>r(this,null,function*(){let e=yield de(t);return s.value=e.result,e.result}),A={baseColProps:{span:8},labelWidth:120,autoAdvancedLine:1,showAdvancedButton:!0,schemas:[{field:"assetCode",component:"Input",label:"资产编号"},{field:"deviceCode",component:"Input",label:"设备编号"},{field:"simNumber",component:"Input",label:"SIM卡号"},{field:"status",label:"状态:",component:"Select",componentProps:{options:[{label:"启用",value:"1"},{label:"禁用",value:"0"}]}}]},[j,{reload:g,getPaginationRef:M}]=Y({title:"巡检仪设置列表",api:()=>r(this,null,function*(){const e=M();return t.pageNo=e.current,t.pageSize=e.pageSize,yield w()}),columns:C,useSearchForm:!0,formConfig:A,showTableSetting:!0,bordered:!0,rowKey:"id",rowSelection:{type:"radio",onChange:V},handleSearchInfoFn(e){return t.status=e.status,t.assetCode=e.assetCode,t.deviceCode=e.deviceCode,t.simNumber=e.simNumber,e},sortFn:e=>{e.order?(t.sortField=e.field,t.sortOrder=e.order.replace("end","")):(t.sortField=null,t.sortOrder=null)}});function V(e,o){o.length>0?(a.value=[e[0]],u.value=e[0]):(a.value=[],u.value="")}function z(){return r(this,null,function*(){const e=yield oe({});y.value=e.result,g()})}function H(){if(m.id="",m.deviceType="巡检仪",m.disabledInput="false",t.stationId==null){b.error("请先选择电站。");return}O("/baseset/monitor/smartdevices/inspectioninstrument/create","添加巡检仪设置",ve(m))}function W(e){O(`/baseset/monitor/smartdevices/inspectioninstrument/create?id=${e.id}&disabledInput=true`,"查看巡检仪设置")}function X(){return r(this,null,function*(){if(!S())return;if((yield re({id:a.value[0]})).result.status==0){b.error("已禁用，不可修改.");return}O("/baseset/monitor/smartdevices/inspectioninstrument/create?id="+a.value[0]+"&disabledInput=false","修改巡检仪设置")})}function $(){return r(this,null,function*(){if(console.log(a.value),a.value.length!=1)return b.info("请选择一条数据."),!1;f({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return r(this,null,function*(){ie(a.value[0]).then(()=>{b.success("已删除。"),a.value=[],g()})})}})})}function q(){if(!S())return;const e="?id="+a.value[0]+"&status=1";K(e).then(()=>{b.success("已启用"),g()})}function J(){if(!S())return;const e="?id="+a.value[0]+"&status=0";K(e).then(()=>{b.success("已禁用"),g()})}function U(e={}){t.stationId=null,t.stationName=null,t.stationOrganId=null,t.stationOrganName=null,t.nodeKindId=null,x.value.nodeKindId=null,t.searchId=null,e!=null&&(t.stationOrganId=e.organId,t.stationOrganName=e.organName,e.nodeKindId=="station"&&(t.stationId=e.powerStationId,t.stationName=e.name,x.value.stationId=e.powerStationId,m.stationId=t.stationId,m.stationName=t.stationName,m.stationOrganId=t.stationOrganId,m.stationOrganName=t.stationOrganName),t.nodeKindId=e.nodeKindId,x.value.nodeKindId=e.nodeKindId,t.searchId=e.id),g()}function S(){return a.value.length==0||a.value.length>1||!a.value[0]?(b.error("请选择一行数据"),!1):!0}function Z(){return r(this,null,function*(){f({title:"导出",iconType:"warning",content:"确定要导出所有记录？",onOk(){return r(this,null,function*(){const o=i({index:"序号"}),c=P(),p=i([]),I=i([]);c.forEach(v=>{v.dataIndex!=="id"&&(o.value[v.dataIndex]=v.title,I.value.push(v.dataIndex))});let B=yield le(t);s.value=B.result,s.value.forEach(function(v,G){let E="";switch(v.status){case 0:E="禁用";break;case 1:E="启用";break}let F=i({index:G+1});I.value.forEach(T=>{F.value[T]=T==="status"?E:v[T]}),p.value.push(F.value)}),ue({data:p.value,header:o.value,filename:"巡检仪设置.xlsx"})})}})})}return me(()=>{z(),te.getInstance().listen("inspectionInstrument",function(){setTimeout(()=>{g()},500)})}),(e,o)=>{const c=fe("a-button");return N(),k("div",null,[l(n(ne),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:d(()=>[l(se,{title:"电站组织",onSelect:U,value:y.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),R("div",be,[R("div",null,[l(n(Q),{class:"fix-basic-table",onRegister:n(j),searchInfo:t,onResizeColumn:o[0]||(o[0]=(p,I)=>I.width=p),onRowDbClick:o[1]||(o[1]=p=>W(p))},{toolbar:d(()=>[l(c,{type:"primary",preIcon:n(h).ADD,onClick:H},{default:d(()=>[_("添加")]),_:1},8,["preIcon"]),l(c,{type:"primary",disabled:n(u)=="",preIcon:n(h).EDIT,onClick:X},{default:d(()=>[_("修改")]),_:1},8,["disabled","preIcon"]),l(c,{class:"red-btn",disabled:n(u)=="",preIcon:n(h).DELETE,onClick:$},{default:d(()=>[_("删除")]),_:1},8,["disabled","preIcon"]),l(c,{class:"green-btn",disabled:n(u)=="",preIcon:n(h).ENABLE,onClick:q},{default:d(()=>[_("启用")]),_:1},8,["disabled","preIcon"]),l(c,{class:"grey-btn",disabled:n(u)=="",preIcon:n(h).DISABLE,onClick:J},{default:d(()=>[_("禁用")]),_:1},8,["disabled","preIcon"]),l(c,{class:"yellow-btn",preIcon:n(h).EXPORT,onClick:Z},{default:d(()=>[_("导出")]),_:1},8,["preIcon"])]),bodyCell:d(({column:p,text:I,record:B})=>[p.dataIndex==="status"?(N(),k(Ie,{key:0},[I==1?(N(),k("span",ge,"启用")):D("",!0),I==0?(N(),k("span",he,"禁用")):D("",!0)],64)):D("",!0)]),_:1},8,["onRegister","searchInfo"])])])]),_:1})])}}});const Qe=ae(_e,[["__scopeId","data-v-677a6ce8"]]);export{Qe as default};
//# sourceMappingURL=index-f6605683.js.map
