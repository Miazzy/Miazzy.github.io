var b=(s,l,o)=>new Promise((h,f)=>{var a=r=>{try{m(o.next(r))}catch(c){f(c)}},w=r=>{try{m(o.throw(r))}catch(c){f(c)}},m=r=>r.done?h(r.value):Promise.resolve(r.value).then(a,w);m((o=o.apply(s,l)).next())});import{P as G}from"./index-20519caf.js";import{a5 as R,a7 as Z,at as J,ax as L}from"./index.js";import{B as N}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as k}from"./useTable-109483b3.js";import{a2 as F}from"./antd-15ac76ed.js";import{C as Q}from"./CommonTree-c4ed7838.js";import{u as X,B as ee}from"./useForm-dea3ed18.js";import{d as te,k as v,o as ae,al as _,Z as D,a9 as I,aa as i,f as u,$ as y,u as d,E as oe,ad as re,ac as ne}from"./vue-71d1abb3.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-316f6ffb.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./index-3801a970.js";import"./uniqBy-92d3bc7f.js";const z=s=>R.get({url:"/oa/info-query/page",params:s},{}),le=()=>R.get({url:"/oa/info-query/readNotCount"},{isOnlyResult:!0}),ie=s=>R.put({url:"/oa/info-release-collection/cancelCollection?infoReleaseId="+s},{}),se=s=>R.get({url:"/oa/infoKind/type/getTree",params:s},{}),O=[{title:"通知主题",dataIndex:"subject",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"信息类型",dataIndex:"infoKindName",width:120,sorter:!0,resizable:!0},{title:"所在部门",dataIndex:"deptName",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"发布人",dataIndex:"personMemberName",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"发布时间",dataIndex:"finishedDate",width:120,sorter:!0,resizable:!0},{title:"阅读状态",dataIndex:"readStatusText",width:120,sorter:!0,resizable:!0}],ce=[{label:"信息主题",field:"subject",component:"Input",colProps:{span:8}},{label:"阅读状态",field:"readStatus",component:"DictSelectBox",componentProps:{type:"read_status"},colProps:{span:8}},{field:"[startPublishedDate, endPublishedDate]",label:"发布时间",component:"RangePicker",colProps:{span:8},componentProps:{format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",placeholder:["开始日期","结束日期"]}}],ue={class:"right-table-layout tab-model"},de={class:"tab-button-div"},pe={class:"tab-table-div",id:"more-tab-content"},fe=y("span",null,"我接收的",-1),me=y("span",null," 我收藏的 ",-1),Ae=te({__name:"index",setup(s){const l=v([]),o=v("receiver"),h=v(0),f=v(),a=v({pageNo:1,pageSize:10,sortField:"finishedDate",sortOrder:"desc"}),w=()=>{const e=d(f);if(!e)throw new Error("tree is null!");return e},m=()=>{debugger;C(),c()};function r(e){if(!e){J.getInstance().success("请选择一行数据");return}let t=e.type==="infoNotice"?"infoNotice":"officeDoc";L(`/oa/info/officedoc/view?bizId=${e.infoReleaseId}&module=`+t,t=="infoNotice"?"查看通知":"查看公文")}const c=()=>{o.value==="receiver"?T():P()};function K(e){a.value.infoKindId="",e&&(a.value.infoKindId=e.id),c()}const B=()=>{let e=A();ie(e[0].infoReleaseId).then(t=>{t.code==0?(F.info("取消成功."),P()):F.error("取消成功.原因:"+t.message)})},M=e=>{r(e)},[V,{resetFields:Y,getFieldsValue:S}]=X({labelWidth:120,baseColProps:{span:8},actionColOptions:{span:24},schemas:ce,compact:!0,resetButtonOptions:{onClick:()=>b(this,null,function*(){yield Y(),c()})},submitFunc:()=>(c(),Promise.resolve())}),[j,{reload:P,getPaginationRef:q,getSelectRows:A}]=k({api:()=>b(this,null,function*(){const e=q();return Object.assign(a.value,S()),a.value.tabType=o.value,a.value.pageNo=e.current,a.value.pageSize=e.pageSize,(yield z(a.value)).result}),columns:O,bordered:!0,rowKey:"infoReleaseId",useSearchForm:!1,target:"#more-tab-content",targetTabKey:"collection",targetTabValue:o,rowSelection:{type:"radio"},sortFn:e=>{e.order?(a.value.sortField=e.field.replace("Text",""),a.value.sortOrder=e.order.replace("end","")):(a.value.sortField="finishedDate",a.value.sortOrder="desc")},handleSearchInfoFn(e){for(const t in e)a.value[t]=e[t]}}),H=e=>{r(e)},[E,{reload:T,getPaginationRef:U}]=k({api:()=>b(this,null,function*(){const e=U();Object.assign(a.value,S()),a.value.tabType=o.value,a.value.pageNo=e.current,a.value.pageSize=e.pageSize;let t=yield z(a.value);return w().loadBadge(),t.result}),columns:O,bordered:!0,rowKey:"infoReleaseId",target:"#more-tab-content",targetTabKey:"receiver",targetTabValue:o,useSearchForm:!1,sortFn:e=>{e.order?(a.value.sortField=e.field.replace("Text",""),a.value.sortOrder=e.order.replace("end","")):(a.value.sortField="finishedDate",a.value.sortOrder="desc")},handleSearchInfoFn(e){for(const t in e)a.value[t]=e[t]}}),C=()=>{let e=0;le().then(t=>{for(let n=0;n<l.value.length;n++)l.value[n].badge="";for(let n in t)if(n!=="notype"){e+=t[n].num;for(let p=0;p<l.value.length;p++)l.value[p].codePre==n&&(l.value[p].badge=t[n].num)}h.value=e})};return ae(()=>b(this,null,function*(){let t=yield se({});Z.getInstance().listen("info-query",()=>{console.log(">>>>>>>>>>>>>>>>>>>>>>>>info-query"),T(),C()}),l.value=t.result,C()})),(e,t)=>{const n=_("a-badge"),p=_("a-tab-pane"),W=_("a-button"),$=_("a-tabs");return D(),I(d(G),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:i(()=>[u(Q,{ref_key:"treeRef",ref:f,title:"信息分类",onSelect:K,value:l.value,class:"left-tree-layout",fieldNames:{key:"id",title:"name"}},null,8,["value"]),y("div",ue,[y("div",de,[u(d(ee),{onRegister:d(V)},null,8,["onRegister"])]),y("div",pe,[u($,{activeKey:o.value,"onUpdate:activeKey":t[2]||(t[2]=g=>o.value=g),onChange:m},{default:i(()=>[u(p,{key:"receiver"},{tab:i(()=>[u(n,{count:h.value,offset:[16,-12],numberStyle:{transform:"scale(0.8)"}},{default:i(()=>[fe]),_:1},8,["count","numberStyle"])]),default:i(()=>[u(d(N),{onRegister:d(E),class:"fix-basic-table",onRowDbClick:H,onResizeColumn:t[0]||(t[0]=(g,x)=>x.width=g)},null,8,["onRegister"])]),_:1}),u(p,{key:"collection"},{tab:i(()=>[me]),default:i(()=>[u(d(N),{onRegister:d(j),class:"fix-basic-table",onRowDbClick:M,onResizeColumn:t[1]||(t[1]=(g,x)=>x.width=g)},{toolbar:i(()=>[o.value=="collection"?(D(),I(W,{key:0,type:"primary",onClick:B},{default:i(()=>[oe(re("取消收藏"))]),_:1})):ne("",!0)]),_:1},8,["onRegister"])]),_:1})]),_:1},8,["activeKey"])])])]),_:1})}}});export{Ae as default};
//# sourceMappingURL=index-db6ffbff.js.map
