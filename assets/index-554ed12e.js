var d=(n,a,s)=>new Promise((h,l)=>{var m=o=>{try{p(s.next(o))}catch(c){l(c)}},b=o=>{try{p(s.throw(o))}catch(c){l(c)}},p=o=>o.done?h(o.value):Promise.resolve(o.value).then(m,b);p((s=s.apply(n,a)).next())});import{a5 as T,b as Y,au as A,a7 as B,av as I,ax as y,az as j,at as C,aA as V}from"./index.js";import{P as H}from"./index-20519caf.js";import{B as L}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as W}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{e as $}from"./download-03e71dd5.js";import"./index-316f6ffb.js";import{u as q}from"./useRender-21ce56fb.js";import{d as K,k as v,o as X,al as Z,Z as _,a9 as G,aa as u,f,u as i,E as w,ad as g,_ as J,ac as Q}from"./vue-71d1abb3.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";function U(n){return T.get({url:"/po/safe-check-issue/page",params:n})}function ee(n){return T.download({url:"/po/safe-check-issue/export-excel",params:n},{isReturnNativeResponse:!0})}const te={0:"#dc0000",1:"#338ed1",2:"#30ca5a",3:"#929292",4:"#929292",5:"#929292",6:"#fda941"},ae=[{title:"单据编号",dataIndex:"billCode",width:165,sorter:!0,resizable:!0},{title:"主题",dataIndex:"subject",align:"left",headAlign:"center",width:165,sorter:!0,resizable:!0},{title:"任务日期",dataIndex:"taskDate",width:165,sorter:!0,resizable:!0},{title:"专项检查模板",dataIndex:"templateName",width:200,sorter:!0,resizable:!0},{title:"下发人",dataIndex:"issuedPersonName",width:130,sorter:!0,resizable:!0},{title:"下发电站",dataIndex:"issueComplete",align:"right",headAlign:"center",width:130,sorter:!0,resizable:!0},{title:"已完成电站",dataIndex:"issueCompleteNum",align:"right",headAlign:"center",width:130,sorter:!0,resizable:!0},{title:"审批状态",dataIndex:"statusText",width:130,sorter:!0,resizable:!0,customRender:({text:n,record:a})=>q.renderTag(n,te[a.status])},{title:"创建人",dataIndex:"personMemberName",width:130,sorter:!0,resizable:!0},{title:"创建时间",dataIndex:"fillinDate",sorter:!0,resizable:!0}],se=[{label:"单据编号",field:"billCode",component:"Input",colProps:{span:8}},{label:"主题",field:"subject",component:"Input",colProps:{span:8}},{field:"[startTaskDate, endTaskDate]",label:"任务时间",component:"RangePicker",colProps:{span:8},componentProps:{format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",placeholder:["开始日期","结束日期"]}},{label:"状态",field:"status",component:"DictSelectBox",componentProps:{type:"bpm_process_instance_result"},colProps:{span:8}}],re=["onClick"],Fe=K({name:"SafeCheckIssue",__name:"index",setup(n){const a=v({status:"",checkType:"",subject:"",billCode:"",startTaskDate:"",endTaskDate:"",pageNo:1,pageSize:10,sortField:"fillinDate",sortOrder:"desc"});let s=v("");const h=e=>{y("/po/safety/safechecktemplate/create?id="+e,"查看专项检查下发")},{t:l}=Y(),{createConfirm:m,createMessage:b}=A(),[p,{getForm:o,reload:c,getPaginationRef:P,getSelectRows:S}]=W({title:"专项检查下发",api:()=>d(this,null,function*(){const e=P();return a.value.pageNo=e.current,a.value.pageSize=e.pageSize,(yield U(a.value)).result}),columns:ae,rowKey:"id",bordered:!0,formConfig:{labelWidth:120,schemas:se,showAdvancedButton:!0,autoAdvancedLine:1},sortFn:e=>{e.order?(a.value.sortField=e.field.replace("Text",""),a.value.sortOrder=e.order.replace("end","")):(a.value.sortField="fillinDate",a.value.sortOrder="desc")},useSearchForm:!0,showTableSetting:!0,rowSelection:{type:"radio",fixed:!0,onSelect:D},handleSearchInfoFn(e){for(const t in e)a.value[t]=e[t]}});function D(e,t){t?s.value=e.id:s.value=""}function z({keys:e,rows:t}){if(t&&t.length>0){const r=t[0];s.value=r.id}else s.value=""}function R(){y("/po/safety/safecheckissue/create?id=","添加专项检查下发")}const F=(e,t,r)=>{M(e)};function M(e){j(e.id)}const N=()=>d(this,null,function*(){let e=S();if(e.length!=1){C.getInstance().success("请选择一行数据");return}let t=e[0];m({title:"提示",iconType:"warning",content:"确定要删除选中的记录？",onOk(){return d(this,null,function*(){if(t.status!=0){C.getInstance().success("非草稿状态不能删除");return}yield V(t.processInstanceId),C.getInstance().success("删除成功"),c()})}})});function E(){return d(this,null,function*(){m({title:l("common.exportTitle"),iconType:"warning",content:l("common.exportMessage"),onOk(){return d(this,null,function*(){let t=o().getFieldsValue();Object.assign(t,a.value),yield ee(t).then(r=>{$(r==null?void 0:r.data,"专项检查下发.xls")}),b.success(l("common.exportSuccessText"))})}})})}return X(()=>{B.getInstance().listen("safe-check-issue",()=>{c()})}),(e,t)=>{const r=Z("a-button");return _(),G(i(H),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:u(()=>[f(i(L),{onRegister:i(p),onResizeColumn:t[0]||(t[0]=(x,k)=>k.width=x),onRowDbClick:F,onSelectionChange:z},{toolbar:u(()=>[f(r,{type:"primary",preIcon:i(I).ADD,onClick:R},{default:u(()=>[w(g("添加"))]),_:1},8,["preIcon"]),f(r,{class:"red-btn",disabled:i(s)=="",preIcon:i(I).DELETE,onClick:N},{default:u(()=>[w(g("删除"))]),_:1},8,["disabled","preIcon"]),f(r,{class:"yellow-btn",preIcon:i(I).EXPORT,onClick:E},{default:u(()=>[w(g("导出"))]),_:1},8,["preIcon"])]),bodyCell:u(({column:x,text:k,record:O})=>[x.dataIndex==="templateName"?(_(),J("a",{key:0,onClick:oe=>h(`${O.templateId}`),target:"_blank"},g(k),9,re)):Q("",!0)]),_:1},8,["onRegister"])]),_:1})}}});export{Fe as default};
//# sourceMappingURL=index-554ed12e.js.map
