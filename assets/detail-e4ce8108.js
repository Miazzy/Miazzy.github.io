var h=(S,x,d)=>new Promise((e,I)=>{var f=r=>{try{v(d.next(r))}catch(F){I(F)}},g=r=>{try{v(d.throw(r))}catch(F){I(F)}},v=r=>r.done?e(r.value):Promise.resolve(r.value).then(f,g);v((d=d.apply(S,x)).next())});import{d as le,J as ie,r as q,k as m,ax as re,u as T,o as de,al as c,Z as V,_ as ue,f as a,aa as i,$ as _,a9 as pe,ac as Y,v as y,A as C,E as w}from"./vue-71d1abb3.js";import{g as H,c as me,s as ce}from"./askReport-bafaf7e2.js";import{W as fe}from"./WfApproveBox-a3448232.js";import{a0 as ge,bP as ve,aB as be,a7 as _e,aC as Ie,_ as he}from"./index.js";import{B as ye}from"./BillTitle-d17ab3e4.js";import{O as R}from"./OrganDialog-dd1023ce.js";import{T as Ce}from"./index-aadc7f51.js";import{U as Fe}from"./UploadBox-636ecf02.js";import{a as D}from"./assign-37f1c13d.js";import{a2 as Ne}from"./antd-15ac76ed.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-f4fc48e6.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./Dialog-0a006d82.js";import"./index-085d06c7.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useRender-21ce56fb.js";import"./index.esm-c216ed00.js";import"./index-fda2d66c.js";import"./BasicTable-0434a334.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./useTable-109483b3.js";import"./index-c0893416.js";import"./index-33af41d1.js";import"./tree-fc0e156a.js";const De={class:"load"},Me={class:"process-box"},ke={class:"header-box"},we={class:"content"},xe={style:{float:"left",width:"10%"}},Ue={style:{float:"left",width:"10%"}},Be={style:{margin:"10px 0 0 80px"}},Se={class:"clearfix"},ze=le({__name:"detail",setup(S){const x=ge(),d=ie(x.getUserInfo),e=q({spinning:!1,handleForList:[],copyForList:[]}),I=m([]),f=m(!1);m([]),m([]);const g=m(!1),v=m(!0),r=q({});r.subject="请示报告",r.infoItems=[];const F=re(),{currentRoute:j}=F,p=T(j).query,E=()=>{f.value=!1};function K(){f.value=!0}const P=()=>{e.handleFor="",M.value=[]};D(e,{spinning:!1,processInstanceId:"",id:"",billCode:"",fullId:"",status:0,subject:"",finishedDate:"",name:"",content:"",copyFor:"",handleFor:"",bizFileId:"",fillinDate:A(new Date),personMemberId:d.orgs[0].personId,personMemberName:d.orgs[0].personMemberName,deptId:d.orgs[0].deptId,deptName:d.orgs[0].deptName,organId:d.orgs[0].orgId,organName:d.orgs[0].orgName});function A(t){const o=t.getFullYear(),s=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,n=t.getDate()<10?"0"+t.getDate():t.getDate(),u=t.getHours()<10?"0"+t.getHours():t.getHours(),b=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),U=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds();return o+"-"+s+"-"+n+" "+u+":"+b+":"+U}const $=()=>{g.value=!1};function W(){g.value=!0}const J=()=>{e.copyFor="",k.value=[]};function Z(){return h(this,null,function*(){const t=yield me({orgKindIds:"ogn,dpt,pos,psm",showPosition:!0,status:1});I.value=z(t.result)})}function z(t){const o=[];for(let s=0;s<t.length;s++){const n=t[s],u={code:n.code,fullId:n.code,name:n.name,nodeId:n.id,nodeName:n.name,orgId:n.orgId,parentId:n.parentId,disabled:n.orgKindId!=="psm"};n.children&&n.children.length>0&&(u.children=z(n.children)),o.push(u)}return o}const M=m([]),k=m([]),G=t=>{if(M.value.length=0,t.length>0){let o=[];t.forEach(s=>{const n={orgUnitId:s.value,orgUnitName:s.label};M.value.push(n),o.push(s.label)}),e.handleFor=o.join(",")}f.value=!1},Q=t=>{if(k.value.length=0,t.length>0){let o=[];t.forEach(s=>{const n={orgUnitId:s.value,orgUnitName:s.label};k.value.push(n),o.push(s.label)}),e.copyFor=o.join(",")}g.value=!1},L=m();function O(t){e.spinning=!0;try{t=t||0,e.handleForList=M.value,e.copyForList=k.value,L.value.validateFields().then(()=>{e.status=t,ce(e).then(o=>{e.id=o,H({id:o}).then(s=>{D(e,s.result)}),Ne.success(t==1?"提交成功。":"保存成功"),_e.getInstance().sendMsg("askreport",{}),t==1&&(v.value=!0,Ie())})})}catch(o){console.log("error",o)}finally{e.spinning=!1}}function X(){O(1)}function ee(){O(0)}de(()=>h(this,null,function*(){p.id=yield oe(),yield H({id:p.id}).then(t=>{p.id?(D(e,t.result),e.status==0&&e.personMemberId.substring(0,32)!=d.userId&&(e.status=10)):(D(e,p),e.spinning=!1,e.status=0,e.billCode=t.result.billCode,e.personMemberName=t.result.personMemberName,e.fillinDate=t.result.fillinDate,e.deptName=t.result.deptName),e.status==1&&(v.value=!0)}),p.id||(v.value=!1),yield ae(),Z(),(e.bizFileId==null||e.bizFileId==null||e.bizFileId=="")&&te()}));const te=()=>h(this,null,function*(){ve().then(t=>{e.bizFileId=t})}),oe=()=>h(this,null,function*(){let t=p.id;if(!t&&p.processInstanceId){const s=(yield be(p.processInstanceId)).businessKey;p.id=s,t=s}return t}),ae=()=>h(this,null,function*(){v.value=e.status!=0,r.title="请示报告",e.processInstanceId=p.processInstanceId;let{billCode:t,fillinDate:o,personMemberName:s,deptName:n}=e;D(r,{billCode:t,fillinDate:o,personMemberName:s,deptName:n})});return(t,o)=>{const s=c("a-input"),n=c("a-form-item"),u=c("a-col"),b=c("a-row"),U=c("a-date-picker"),N=c("a-button"),B=c("a-card"),se=c("a-form"),ne=c("a-spin");return V(),ue("div",De,[a(ne,{spinning:e.spinning,tip:"Loading..."},{default:i(()=>[_("div",Me,[_("div",ke,[a(ye,{options:r},null,8,["options"]),e.status!=10?(V(),pe(fe,{key:0,onSave:ee,onSubmit:X,processInstanceId:e.processInstanceId,processStatus:e.status},null,8,["processInstanceId","processStatus"])):Y("",!0)]),_("div",we,[a(se,{ref_key:"formRef",ref:L,model:e,labelAlign:"right",autocomplete:"off"},{default:i(()=>[a(B,{title:"基本信息",bordered:!1},{default:i(()=>[a(b,{gutter:24},{default:i(()=>[y(a(u,{span:12},{default:i(()=>[a(n,{name:"deptName",label:"所在组织",labelCol:{span:4},rules:[{required:!0}]},{default:i(()=>[a(s,{disabled:"",value:e.deptName,"onUpdate:value":o[0]||(o[0]=l=>e.deptName=l),style:{"margin-left":"2px"}},null,8,["value"]),Y("",!0)]),_:1})]),_:1},512),[[C,!0]]),y(a(u,{span:12},{default:i(()=>[a(n,{name:"personMemberName",label:"呈报人",labelCol:{span:4},rules:[{required:!0}]},{default:i(()=>[a(s,{disabled:"",value:e.personMemberName,"onUpdate:value":o[2]||(o[2]=l=>e.personMemberName=l)},null,8,["value"])]),_:1})]),_:1},512),[[C,!0]])]),_:1}),a(b,{gutter:24},{default:i(()=>[y(a(u,{span:12},{default:i(()=>[a(n,{name:"fillinDate",label:"呈报时间",labelCol:{span:4},rules:[{required:!0}]},{default:i(()=>[a(U,{value:e.fillinDate,"onUpdate:value":o[3]||(o[3]=l=>e.fillinDate=l),"value-format":"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm:ss",style:{width:"100%","margin-left":"2px"},"show-time":"",disabled:""},null,8,["value"])]),_:1})]),_:1},512),[[C,!0]])]),_:1}),a(b,{gutter:24},{default:i(()=>[y(a(u,{span:24},{default:i(()=>[a(n,{name:"name",label:"主题",labelCol:{span:2},rules:[{required:!0,message:"请输入主题"}]},{default:i(()=>[a(s,{value:e.name,"onUpdate:value":o[4]||(o[4]=l=>e.name=l),placeholder:"请输入主题",disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[C,!0]])]),_:1}),a(b,{gutter:24},{default:i(()=>[y(a(u,{span:24},{default:i(()=>[a(n,{name:"handleFor",label:"审批人",labelCol:{span:2},rules:[{required:!0,message:"请输入审批人"}]},{default:i(()=>[_("div",xe,[a(N,{type:"link",onClick:K,disabled:e.status!=0},{default:i(()=>[w("选择")]),_:1},8,["disabled"]),a(N,{type:"link",onClick:P,disabled:e.status!=0},{default:i(()=>[w("清空")]),_:1},8,["disabled"])]),a(s,{value:e.handleFor,"onUpdate:value":o[5]||(o[5]=l=>e.handleFor=l),class:"input-input",disabled:""},null,8,["value"]),a(R,{title:"组织人员",visible:f.value,"onUpdate:visible":[o[6]||(o[6]=l=>f.value=l),o[8]||(o[8]=l=>f.value=l)],value:e.handleForList,"onUpdate:value":o[7]||(o[7]=l=>e.handleForList=l),tdata:I.value,tfields:{key:"nodeId",title:"nodeName"},width:800,height:600,onCancel:E,onConfirm:G},null,8,["visible","value","tdata"])]),_:1})]),_:1},512),[[C,!0]])]),_:1}),a(b,{gutter:24},{default:i(()=>[y(a(u,{span:24},{default:i(()=>[a(n,{name:"copyFor",label:"抄送人",labelCol:{span:2},rules:[{required:!1,message:"请输入抄送人"}]},{default:i(()=>[_("div",Ue,[a(N,{type:"link",onClick:W,disabled:e.status!=0},{default:i(()=>[w("选择")]),_:1},8,["disabled"]),a(N,{type:"link",onClick:J,disabled:e.status!=0},{default:i(()=>[w("清空")]),_:1},8,["disabled"])]),a(s,{value:e.copyFor,"onUpdate:value":o[9]||(o[9]=l=>e.copyFor=l),class:"input-input",disabled:""},null,8,["value"]),a(R,{title:"组织人员",visible:g.value,"onUpdate:visible":[o[10]||(o[10]=l=>g.value=l),o[12]||(o[12]=l=>g.value=l)],value:e.copyForList,"onUpdate:value":o[11]||(o[11]=l=>e.copyForList=l),tdata:I.value,tfields:{key:"nodeId",title:"nodeName"},width:800,height:600,onCancel:$,onConfirm:Q},null,8,["visible","value","tdata"])]),_:1})]),_:1},512),[[C,!0]])]),_:1})]),_:1}),a(B,{title:"正文",bordered:!1},{default:i(()=>[_("div",Be,[a(T(Ce),{modelValue:e.content,"onUpdate:modelValue":o[13]||(o[13]=l=>e.content=l),width:"calc(100% - 16px)",height:400,maxChars:5e3,disabled:e.status!=0},null,8,["modelValue","width","disabled"])])]),_:1}),a(B,{title:"附件信息",bordered:!1},{default:i(()=>[_("div",Se,[a(Fe,{width:800,height:550,maxCount:20,maxSize:100*1024*1024,application:"po",module:"askReport",vmode:e.status==0?"box":"view",bizId:e.bizFileId},null,8,["vmode","bizId"])])]),_:1})]),_:1},8,["model"])])])]),_:1},8,["spinning"])])}}});const gt=he(ze,[["__scopeId","data-v-c03b7397"]]);export{gt as default};
//# sourceMappingURL=detail-e4ce8108.js.map
