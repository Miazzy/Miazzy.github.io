var l=(I,r,s)=>new Promise((h,y)=>{var _=c=>{try{a(s.next(c))}catch(u){y(u)}},o=c=>{try{a(s.throw(c))}catch(u){y(u)}},a=c=>c.done?h(c.value):Promise.resolve(c.value).then(_,o);a((s=s.apply(I,r)).next())});import{a5 as Y,b as q,au as ee,a0 as te,a7 as ae,av as p,ax as oe,_ as ne}from"./index.js";import{b as re}from"./index-316f6ffb.js";import{B as se}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as ie}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{P as ce}from"./index-20519caf.js";import{C as le}from"./CommonTree-c4ed7838.js";import{e as de}from"./download-03e71dd5.js";import{f as me}from"./index-5d738211.js";import{g as ue,a as E,d as pe,e as fe}from"./index-9919c3bd.js";import{c as ge,s as Ie}from"./attend.data-d9985a5d.js";import{_ as ye}from"./PeriodModal.vue_vue_type_script_setup_true_lang-fe2bc293.js";import{a as v}from"./assign-37f1c13d.js";import{d as _e,J as N,k as C,r as T,o as he,al as we,x as Se,Z as k,a9 as O,aa as d,f as m,$ as be,u as n,E as f,ad as g,v as xe}from"./vue-71d1abb3.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";const ve=I=>Y.get({url:"/baseset/powerstation/get",params:I},{}),Ce={class:"right-table-layout"},Te=_e({__name:"index",setup(I){const{t:r}=q(),s=ee(),h=te(),y=N(h.getUserInfo),_=C([]),o=T({}),a=T({}),c=C(!0),[u,{openModal:D}]=re(),F=()=>l(this,null,function*(){const e=M(),t=T({});return v(t,o),t.pageNo=e.current,t.pageSize=e.pageSize,t.sortField||(t.sortField="createTime",t.sortOrder="desc"),yield ue(t)}),w=C("月排班"),[$,{reload:S,clearSelectedRowKeys:B,getPaginationRef:M,getSelectRows:L}]=ie({title:w,api:F,columns:ge(),useSearchForm:!0,formConfig:Ie,bordered:!0,rowKey:"id",rowSelection:{type:"radio"},sortFn:e=>{var i;const t=(i=e.order)==null?void 0:i.replace("end","");o.sortOrder=t,o.sortField=t?e.field:void 0},handleSearchInfoFn(e){return v(o,e),e},showTableSetting:!0,tableSetting:{fullScreen:!0},showIndexColumn:!0});function K(){return l(this,null,function*(){const e=yield me({});_.value=e.result})}function U(e){o.stationId=null,o.stationOrganId=null,a.stationId="",a.stationName="",a.stationOrganId="",a.stationOrganName="",e&&(e.nodeKindId==="org"&&(o.stationOrganId=e.id),e.nodeKindId==="station"&&(o.stationId=e.powerStationId,a.stationId=e.powerStationId,a.stationName=e.powerStationName,a.stationOrganId=e.organId,a.stationOrganName=e.organName)),S()}const V=()=>l(this,null,function*(){if(!a.stationId){s.warning("请选择电站组织");return}const e=yield ve({id:a.stationId});e.result&&(a.connectCapacity=e.result.connectCapacity),b(N(a))}),z=()=>l(this,null,function*(){const e=R();e&&b({id:e.id})}),A=e=>l(this,null,function*(){b({id:e.id,isReadonly:!0})}),b=e=>l(this,null,function*(){const t=yield G();t&&(v(e,t),oe("/oa/attend/create",H(e,e.isReadonly),e))}),H=(e,t)=>{const i=w.value;return t?`查看${i}`:e!=null&&e.id?`${r("common.action.edit")}${i}`:`${r("common.action.create")}${i}`},G=()=>l(this,null,function*(){const e=yield E();if(!e.result||e.result.length==0)return s.warning("请进行排班周期设置"),!1;const t=e.result[0];return{periodRule:t.rule,periodStartDay:t.startDay,periodEndDay:t.endDay}}),J=()=>l(this,null,function*(){const e=R();if(e){if(y.userId!==e.creator){s.error("您无权删除该数据");return}yield s.delConfirm(),yield pe(e.id),s.success(r("common.delSuccess")),B(),S()}});function R(){const e=L();return e.length==0?(s.error("请选择一行数据"),!1):e[0]}function W(){s.createConfirm({title:r("common.message.confirmTitle"),iconType:"warning",content:r("common.message.exportMessage"),onOk(){return l(this,null,function*(){o.filename=`${w.value}.xls`,yield fe(o).then(t=>{de(t==null?void 0:t.data,o.filename)}),o.filename=null,s.success(r("common.exportSuccessText"))})}})}const P={visible:!0};function X(){E().then(e=>{const t=e.result;t.length==0?D(P,{isUpdate:!1}):D(P,{record:t[0],isUpdate:!0})})}function Z({rows:e}){c.value=e.length===0}return he(()=>{K(),ae.getInstance().listen("oa-attend",S)}),(e,t)=>{const i=we("a-button"),j=Se("auth");return k(),O(n(ce),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:d(()=>[m(le,{title:"电站组织",onSelect:U,value:_.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),be("div",Ce,[m(n(se),{onRegister:n($),onResizeColumn:t[0]||(t[0]=(x,Q)=>Q.width=x),onRowDbClick:t[1]||(t[1]=x=>A(x)),class:"fix-basic-table",searchInfo:o,onSelectionChange:Z},{toolbar:d(()=>[m(i,{type:"primary",preIcon:n(p).ADD,onClick:V},{default:d(()=>[f(g(n(r)("common.action.create")),1)]),_:1},8,["preIcon"]),m(i,{disabled:c.value,type:"primary",preIcon:n(p).EDIT,onClick:z},{default:d(()=>[f(g(n(r)("common.action.edit")),1)]),_:1},8,["disabled","preIcon"]),m(i,{disabled:c.value,class:"red-btn",preIcon:n(p).DELETE,onClick:J},{default:d(()=>[f(g(n(r)("common.delText")),1)]),_:1},8,["disabled","preIcon"]),m(i,{class:"yellow-btn",preIcon:n(p).EXPORT,onClick:W},{default:d(()=>[f(g(n(r)("common.action.export")),1)]),_:1},8,["preIcon"]),xe((k(),O(i,{type:"primary",preIcon:n(p).SETTING,onClick:X},{default:d(()=>[f(g(n(r)("排班周期设置")),1)]),_:1},8,["preIcon"])),[[j,"oa:att:index:setting"]])]),_:1},8,["onRegister","searchInfo"])]),m(ye,{onRegister:n(u)},null,8,["onRegister"])]),_:1})}}});const rt=ne(Te,[["__scopeId","data-v-145603a2"]]);export{rt as default};
//# sourceMappingURL=index-ac55139f.js.map
