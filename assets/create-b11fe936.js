var F=(d,N,y)=>new Promise((w,f)=>{var p=e=>{try{u(y.next(e))}catch(_){f(_)}},h=e=>{try{u(y.throw(e))}catch(_){f(_)}},u=e=>e.done?w(e.value):Promise.resolve(e.value).then(p,h);u((y=y.apply(d,N)).next())});import{P as K}from"./index-20519caf.js";import{a5 as B,a0 as X,aj as ee,aD as ae,at as O,a7 as V,aC as te,ax as $,_ as le}from"./index.js";import{S}from"./SearchBox-22bb02d6.js";import{B as se}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as oe}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{U as ne}from"./UploadBox-636ecf02.js";import{d as ie,J as re,k as U,e as de,r as ue,o as pe,al as m,Z as x,a9 as me,aa as l,f as t,$ as C,_ as M,E as q,ad as b,ac as T,u as c,aG as ce,aH as fe}from"./vue-71d1abb3.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./Dialog-0a006d82.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";function ge(d){return B.get({url:"/po/safety-tools/get",params:d})}function ye(d){return B.post({url:"/po/safety-tools/create",params:d})}function be(d){return B.get({url:"/po/safety-tools-check/getBySafetyToolsId",params:d})}const _e="/baseset/material/searchPage",H="/baseset/related-party/page",ve=[{title:"关联流程",dataIndex:"billCode",width:180},{title:"检验日期",dataIndex:"checkDate",width:260},{title:"检验单位",dataIndex:"checkCompany",align:"left",headAlign:"center",width:160},{title:"检验结果",dataIndex:"checkResultText",width:100},{title:"下次检验日期",dataIndex:"nextCheckDate",width:120},{title:"附件",dataIndex:"file",width:160}],Ce=[{title:"物料编码",dataIndex:"code",width:80},{title:"大类",dataIndex:"categoryName1",width:80},{title:"中类",dataIndex:"categoryName2",width:80},{title:"小类",dataIndex:"categoryName3",width:80},{title:"物料名称",dataIndex:"name",width:80}],he=[{title:"生产厂家",dataIndex:"name",width:80}],Ie=[{title:"供应商",dataIndex:"name",width:80}],xe=d=>(ce("data-v-cde97cb5"),d=d(),fe(),d),Ne={class:"process-box"},we={class:"header-box"},ke=xe(()=>C("div",{class:"header-left"},"安全工具器",-1)),De={key:0,class:"header-right"},Fe={class:"content"},Se=["onClick"],Ue=["onClick"],Me=ie({__name:"create",setup(d){const N=X(),y=re(N.getUserInfo),w=U(""),f=U(),p=de(()=>e.status!=0||e.status==0&&e.personMemberId!=""&&e.personMemberId.substring(0,32)!=y.userId),h=U(!1);let{params:u}=ee();const e=ue({id:u.id||"",stationName:u.stationName||"",stationId:u.stationId||"",stationCode:u.powerStationCode||"",stationOrganName:u.stationOrganName||"",stationOrganId:u.stationOrganId||"",lastCategoryName:"",name:"",materialId:"",materialName:"",materialCode:"",materialFullName:"",code:"",specification:"",factoryId:"",factoryName:"",supplierId:"",supplierName:"",productionDate:"",purchasingDate:"",materialCategoryCode:"",personMemberId:"",cycle:"",spinning:!1,nextCheckDate:"",remark:"",scrapBillCode:"",scrapDate:"",status:0,billCode:"",fillinDate:"",bizFileId:""}),_=(o,a)=>{let r=a.record;e.materialId!=r.key&&(e.supplierId="",e.supplierName="",e.factoryId="",e.factoryName=""),e.materialCode=r.code,e.materialId=r.key,e.materialName=r.name,e.name=r.name,e.materialCategoryCode=r.materialCategoryCode,e.materialFullName=R(r)},R=o=>{let a="";return o.categoryName1&&(a+=o.categoryName1+"-",e.lastCategoryName=o.categoryName1),o.categoryName2&&(a+=o.categoryName2+"-",e.lastCategoryName=o.categoryName1),o.categoryName3&&(a+=o.categoryName3+"-",e.lastCategoryName=o.categoryName1),a+=o.name,a},j=()=>{const o=f.value;o&&(e.spinning=!0,o.validateFields().then(()=>{ye(e).then(a=>{a.result!=""?(e.id=a.result.id,e.code=a.result.code,O.getInstance().success("保存成功"),V.getInstance().sendMsg("safety-tools",{})):(e.status=0,O.getInstance().error("保存失败")),e.spinning=!1}).catch(a=>{e.status=0,e.spinning=!1,console.log(a)})}).catch(a=>{console.log(a),e.spinning=!1,e.status=0}))},L=()=>{te(),V.getInstance().sendMsg("safety-tools",{})},Y=o=>{o&&$("/po/safetytools/safetytoolscheck/create?processInstanceId="+o)},E=()=>{e.scrapId&&$("/po/safetytools/safetytoolsscrap/create?processInstanceId="+e.scrapId)},[A]=oe({title:"",api:()=>F(this,null,function*(){if(e.id)return(yield be({safetyToolsId:e.id})).result}),bordered:!0,columns:ve,useSearchForm:!1,showTableSetting:!1,pagination:!1}),k=o=>{var a;h.value&&((a=f==null?void 0:f.value)==null||a.validate(o))};return pe(()=>F(this,null,function*(){ge({id:e.id}).then(o=>{let a=o.result;if(e.id){for(let r in a)e[r]=a[r];e.status=a.edit?0:1,u.status&&(e.status=Number(u.status))}else e.bizFileId=ae();h.value=!0}).then(()=>{})})),(o,a)=>{const r=m("a-button"),v=m("a-input"),n=m("a-form-item"),i=m("a-col"),D=m("a-date-picker"),G=m("a-input-number"),J=m("a-textarea"),P=m("a-row"),I=m("a-card"),Q=m("a-form"),W=m("a-spin");return x(),me(c(K),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:l(()=>[t(W,{spinning:e.spinning,tip:"Loading..."},{default:l(()=>[C("div",Ne,[C("div",we,[ke,p.value?T("",!0):(x(),M("div",De,[t(r,{style:{"margin-right":"10px"},onClick:L},{default:l(()=>[q(b("取消"))]),_:1}),t(r,{type:"primary",onClick:j,loading:e.spinning},{default:l(()=>[q(b("保存"))]),_:1},8,["loading"])]))]),C("div",Fe,[t(Q,{model:e,name:"basic",ref_key:"formRef",ref:f,autocomplete:"off"},{default:l(()=>[t(I,{title:"基本信息",bordered:!1},{default:l(()=>[t(P,{gutter:32},{default:l(()=>[t(i,{span:12},{default:l(()=>[t(n,{label:"电站名称",name:"formState.stationName",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:l(()=>[t(v,{value:e.stationName,"onUpdate:value":a[0]||(a[0]=s=>e.stationName=s),disabled:"true"},null,8,["value"])]),_:1})]),_:1}),t(i,{span:12},{default:l(()=>[t(n,{label:"工器具名称",name:"name",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"工器具名称不能为空。"}]},{default:l(()=>[t(S,{value:e.name,"onUpdate:value":a[1]||(a[1]=s=>e.name=s),columns:c(Ce),disabled:p.value,api:c(_e),onSearch:a[2]||(a[2]=s=>{w.value=s}),vfield:"name",pagination:!0,validateFunc:()=>{k("name")},style:{width:"100%"},onChange:_},null,8,["value","columns","disabled","api","validateFunc"])]),_:1})]),_:1}),t(i,{span:12},{default:l(()=>[t(n,{label:"物料编码",name:"materialCode",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:l(()=>[t(v,{value:e.materialCode,"onUpdate:value":a[3]||(a[3]=s=>e.materialCode=s),disabled:"true"},null,8,["value"])]),_:1})]),_:1}),t(i,{span:12},{default:l(()=>[t(n,{label:"物料全称",name:"materialFullName",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:l(()=>[t(v,{value:e.materialFullName,"onUpdate:value":a[4]||(a[4]=s=>e.materialFullName=s),disabled:"true"},null,8,["value"])]),_:1})]),_:1}),t(i,{span:12},{default:l(()=>[t(n,{label:"工器具编码",name:"code",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:l(()=>[t(v,{value:e.code,"onUpdate:value":a[5]||(a[5]=s=>e.code=s),disabled:"true"},null,8,["value"])]),_:1})]),_:1}),t(i,{span:12},{default:l(()=>[t(n,{label:"规格型号",name:"specification",labelCol:{style:{width:"124px"}},rules:[{required:!1,message:"规格型号不能为空"}]},{default:l(()=>[t(v,{value:e.specification,"onUpdate:value":a[6]||(a[6]=s=>e.specification=s),disabled:p.value,maxlength:"32"},null,8,["value","disabled"])]),_:1})]),_:1}),t(i,{span:12},{default:l(()=>[t(n,{label:"生产厂家",name:"factoryName",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"生产厂家不能为空"}]},{default:l(()=>[t(S,{value:e.factoryName,"onUpdate:value":a[7]||(a[7]=s=>e.factoryName=s),columns:c(he),disabled:p.value,api:c(H),apiParamFunc:()=>({partyTypeCodes:"manufacturer",materialCategoryIds:e.materialCategoryCode}),vfield:"name",pagination:!0,style:{width:"100%"},validateFunc:()=>{k("factoryName")},onChange:a[8]||(a[8]=(s,g)=>{e.factoryId=g.record.key,e.factoryName=g.record.name})},null,8,["value","columns","disabled","api","apiParamFunc","validateFunc"])]),_:1})]),_:1}),t(i,{span:12},{default:l(()=>[t(n,{label:"供应商",name:"supplierName",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"供应商不能为空"}]},{default:l(()=>[t(S,{value:e.supplierName,"onUpdate:value":a[9]||(a[9]=s=>e.supplierName=s),columns:c(Ie),disabled:p.value,api:c(H),apiParamFunc:()=>({partyTypeCodes:"supplier",materialCategoryIds:e.materialCategoryCode}),vfield:"name",pagination:!0,style:{width:"100%"},validateFunc:()=>{k("supplierName")},onChange:a[10]||(a[10]=(s,g)=>{e.supplierId=g.record.key,e.supplierName=g.record.name})},null,8,["value","columns","disabled","api","apiParamFunc","validateFunc"])]),_:1})]),_:1}),t(i,{span:12},{default:l(()=>[t(n,{label:"生产日期",name:"productionDate",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"生产日期不能为空"}]},{default:l(()=>[t(D,{value:e.productionDate,"onUpdate:value":a[11]||(a[11]=s=>e.productionDate=s),valueFormat:"YYYY-MM-DD",style:{width:"100%"},disabled:p.value},null,8,["value","disabled"])]),_:1})]),_:1}),t(i,{span:12},{default:l(()=>[t(n,{label:"购买日期",name:"purchasingDate",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"购买日期不能为空"}]},{default:l(()=>[t(D,{value:e.purchasingDate,"onUpdate:value":a[12]||(a[12]=s=>e.purchasingDate=s),valueFormat:"YYYY-MM-DD",style:{width:"100%"},disabled:p.value},null,8,["value","disabled"])]),_:1})]),_:1}),t(i,{span:12},{default:l(()=>[t(n,{label:"检验周期(月)",name:"cycle",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"检验周期(月)不能为空"}]},{default:l(()=>[t(G,{value:e.cycle,"onUpdate:value":a[13]||(a[13]=s=>e.cycle=s),min:"0",max:"99",disabled:p.value},null,8,["value","disabled"])]),_:1})]),_:1}),t(i,{span:12},{default:l(()=>[t(n,{label:"计划下次检验日期",name:"nextCheckDate",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"计划下次检验日期不能为空"}]},{default:l(()=>[t(D,{valueFormat:"YYYY-MM-DD",value:e.nextCheckDate,"onUpdate:value":a[14]||(a[14]=s=>e.nextCheckDate=s),style:{width:"100%"},disabled:e.id!=null&&e.id!=""},null,8,["value","disabled"])]),_:1})]),_:1}),t(i,{span:24},{default:l(()=>[t(n,{label:"备注",name:"remark",labelCol:{style:{width:"124px"}},rules:[{required:!1}]},{default:l(()=>[t(J,{value:e.remark,"onUpdate:value":a[15]||(a[15]=s=>e.remark=s),row:"3",style:{width:"100%"},maxlength:"1024",disabled:p.value},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),t(I,{title:"检验记录",bordered:!1},{default:l(()=>[t(c(se),{sticky:"",onRegister:c(A),class:"w-4/4 xl:w-12/12"},{bodyCell:l(({column:s,text:g,record:z})=>[s.dataIndex==="billCode"?(x(),M("a",{key:0,onClick:Z=>Y(`${z.safetyToolsCheckId}`),target:"_blank"},b(g),9,Se)):T("",!0),s.dataIndex==="file"?(x(),M("a",{key:1,onClick:Z=>Y(`${z.dtlIds}`),target:"_blank"},b(g),9,Ue)):T("",!0)]),_:1},8,["onRegister"])]),_:1}),t(I,{title:"报废信息",bordered:!1},{default:l(()=>[t(P,{gutter:24},{default:l(()=>[t(i,{span:12},{default:l(()=>[t(n,{label:"报废流程单号",name:"scrapBillCode",labelCol:{span:4},wrapperCol:7,rules:[{required:!1}]},{default:l(()=>[C("a",{onClick:E},b(e.scrapBillCode),1)]),_:1})]),_:1}),t(i,{span:12},{default:l(()=>[t(n,{label:"报废时间",name:"scrapDate",labelCol:{span:4},wrapperCol:7,rules:[{required:!1}]},{default:l(()=>[q(b(e.scrapDate),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(I,{title:"附件上传",bordered:!1,class:"file-upload-content"},{default:l(()=>[t(ne,{width:800,height:550,maxCount:20,maxSize:100*1024*1024,application:"po",module:"safetytools",vmode:e.status==0?"box":"view",bizId:e.bizFileId},null,8,["vmode","bizId"])]),_:1})]),_:1},8,["model"])])])]),_:1},8,["spinning"])]),_:1})}}});const la=le(Me,[["__scopeId","data-v-cde97cb5"]]);export{la as default};
//# sourceMappingURL=create-b11fe936.js.map
