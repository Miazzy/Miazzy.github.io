{"version":3,"file":"LoginForm-b88b47a8.js","sources":["../../src/views/sys/login/LoginForm.vue"],"sourcesContent":["<template>\n  <LoginFormTitle v-show=\"getShow\" class=\"enter-x\" />\n  <Form\n    class=\"p-4 enter-x\"\n    :model=\"formData\"\n    :rules=\"getFormRules\"\n    ref=\"formRef\"\n    v-show=\"getShow\"\n    @keypress.enter=\"handleLogin\"\n  >\n    <FormItem name=\"account\" class=\"enter-x\">\n      <Input\n        v-model:value=\"formData.account\"\n        :placeholder=\"t('sys.login.userName')\"\n        class=\"fix-auto-fill\"\n      />\n    </FormItem>\n    <FormItem name=\"password\" class=\"enter-x\">\n      <InputPassword\n        visibilityToggle\n        v-model:value=\"formData.password\"\n        :placeholder=\"t('sys.login.password')\"\n      />\n    </FormItem>\n\n    <ARow class=\"enter-x\">\n      <ACol :span=\"12\">\n        <FormItem>\n          <Checkbox v-model:checked=\"rememberMe\" size=\"small\">\n            {{ t('sys.login.rememberMe') }}\n          </Checkbox>\n        </FormItem>\n      </ACol>\n      <ACol :span=\"12\" class=\"forget-password\">\n        <FormItem :style=\"{ 'text-align': 'right' }\">\n          <Button type=\"link\" size=\"small\" @click=\"setLoginState(LoginStateEnum.RESET_PASSWORD)\">\n            {{ t('sys.login.forgetPassword') }}\n          </Button>\n        </FormItem>\n      </ACol>\n    </ARow>\n\n    <FormItem class=\"enter-x\">\n      <Button type=\"primary\" block @click=\"handleLogin\" :loading=\"loading\">\n        {{ t('sys.login.loginButton') }}\n      </Button>\n    </FormItem>\n  </Form>\n</template>\n<script lang=\"ts\" setup>\n  import { reactive, ref, unref, computed, onMounted } from 'vue';\n  import { Checkbox, Form, Input, Row, Col, Button } from 'ant-design-vue';\n  import LoginFormTitle from './LoginFormTitle.vue';\n  import { useI18n } from '/@/hooks/web/useI18n';\n  import { useMessage } from '/@/hooks/web/useMessage';\n  import { useUserStore } from '/@/store/modules/user';\n  import { LoginStateEnum, useLoginState, useFormRules, useFormValid } from './useLogin';\n  import { useDesign } from '/@/hooks/web/useDesign';\n  import { md5 } from '/@/utils/encryption/crypto';\n\n  const ACol = Col;\n  const ARow = Row;\n  const FormItem = Form.Item;\n  const InputPassword = Input.Password;\n  const { t } = useI18n();\n  const { notification, createErrorModal } = useMessage();\n  const { prefixCls } = useDesign('login');\n  const userStore = useUserStore();\n\n  const { setLoginState, getLoginState } = useLoginState();\n  const { getFormRules } = useFormRules();\n\n  const formRef = ref();\n  const loading = ref(false);\n  const rememberMe = ref(false);\n\n  const formData = reactive({\n    account: '',\n    password: '',\n  });\n\n  const { validForm } = useFormValid(formRef);\n  const getShow = computed(() => unref(getLoginState) === LoginStateEnum.LOGIN);\n\n  async function handleLogin() {\n    const data = await validForm();\n    if (!data) return;\n    try {\n      loading.value = true;\n      const userInfo = await userStore.login({\n        loginName: data.account,\n        password: md5(data.password),\n        mode: 'none', //不要默认的错误提示\n      });\n      if (userInfo) {\n        const params = {\n          remember: rememberMe.value,\n          account: data.account,\n          password: data.password,\n        };\n        rememberMe.value\n          ? localStorage.setItem('REMEMBER_ME_INFO', JSON.stringify(params))\n          : localStorage.setItem('REMEMBER_ME_INFO', '');\n        localStorage.setItem('LOGIN_TIMESTAMP', String(new Date().getTime()));\n        const username = userInfo.username || userInfo.userId;\n        notification.success({\n          message: t('sys.login.loginSuccessTitle'),\n          description: `${t('sys.login.loginSuccessDesc')}: ${username}`,\n          duration: 3,\n        });\n      }\n    } catch (error) {\n      createErrorModal({\n        title: t('sys.api.errorTip'),\n        content: (error as unknown as Error).message || t('sys.api.networkExceptionMsg'),\n        getContainer: () => document.body.querySelector(`.${prefixCls}`) || document.body,\n      });\n    } finally {\n      loading.value = false;\n    }\n  }\n\n  const handleLoadAccount = () => {\n    const info = localStorage.getItem('REMEMBER_ME_INFO');\n    if (info) {\n      const data = JSON.parse(info);\n      rememberMe.value = data.remember;\n      formData.account = data.account;\n      formData.password = data.password;\n    }\n  };\n\n  onMounted(() => {\n    handleLoadAccount();\n  });\n</script>\n<style lang=\"less\" scoped>\n  .enter-x {\n    .forget-password {\n      display: none;\n    }\n  }\n</style>\n"],"names":["ACol","Col","ARow","Row","FormItem","Form","InputPassword","Input","useI18n","notification","createErrorModal","useMessage","prefixCls","useDesign","userStore","useUserStore","setLoginState","getLoginState","useLoginState","getFormRules","useFormRules","formRef","ref","loading","rememberMe","formData","reactive","validForm","useFormValid","getShow","computed","unref","LoginStateEnum","handleLogin","__async","data","userInfo","md5","params","username","error","handleLoadAccount","info","onMounted"],"mappings":"8qBA4DE,MAAMA,EAAOC,GACPC,EAAOC,GACPC,EAAWC,EAAK,KAChBC,EAAgBC,EAAM,SACtB,CAAE,GAAMC,IACR,CAAE,aAAAC,EAAc,iBAAAC,CAAiB,EAAIC,EAAW,EAChD,CAAE,UAAAC,CAAA,EAAcC,EAAU,OAAO,EACjCC,EAAYC,IAEZ,CAAE,cAAAC,EAAe,cAAAC,CAAc,EAAIC,EAAc,EACjD,CAAE,aAAAC,GAAiBC,IAEnBC,EAAUC,IACVC,EAAUD,EAAI,EAAK,EACnBE,EAAaF,EAAI,EAAK,EAEtBG,EAAWC,EAAS,CACxB,QAAS,GACT,SAAU,EAAA,CACX,EAEK,CAAE,UAAAC,CAAA,EAAcC,EAAaP,CAAO,EACpCQ,EAAUC,EAAS,IAAMC,EAAMd,CAAa,IAAMe,EAAe,KAAK,EAE5E,SAAeC,GAAc,QAAAC,EAAA,sBACrB,MAAAC,EAAO,MAAMR,IACnB,GAAKQ,EACD,GAAA,CACFZ,EAAQ,MAAQ,GACV,MAAAa,EAAW,MAAMtB,EAAU,MAAM,CACrC,UAAWqB,EAAK,QAChB,SAAUE,GAAIF,EAAK,QAAQ,EAC3B,KAAM,MAAA,CACP,EACD,GAAIC,EAAU,CACZ,MAAME,EAAS,CACb,SAAUd,EAAW,MACrB,QAASW,EAAK,QACd,SAAUA,EAAK,QAAA,EAEjBX,EAAW,MACP,aAAa,QAAQ,mBAAoB,KAAK,UAAUc,CAAM,CAAC,EAC/D,aAAa,QAAQ,mBAAoB,EAAE,EAClC,aAAA,QAAQ,kBAAmB,OAAO,IAAI,KAAO,EAAA,QAAS,CAAA,CAAC,EAC9D,MAAAC,EAAWH,EAAS,UAAYA,EAAS,OAC/C3B,EAAa,QAAQ,CACnB,QAAS,EAAE,6BAA6B,EACxC,YAAa,GAAG,EAAE,4BAA4B,CAAC,KAAK8B,CAAQ,GAC5D,SAAU,CAAA,CACX,CACH,QACOC,EAAO,CACG9B,EAAA,CACf,MAAO,EAAE,kBAAkB,EAC3B,QAAU8B,EAA2B,SAAW,EAAE,6BAA6B,EAC/E,aAAc,IAAM,SAAS,KAAK,cAAc,IAAI5B,CAAS,EAAE,GAAK,SAAS,IAAA,CAC9E,CAAA,QACD,CACAW,EAAQ,MAAQ,EAClB,CACF,GAEA,MAAMkB,EAAoB,IAAM,CACxB,MAAAC,EAAO,aAAa,QAAQ,kBAAkB,EACpD,GAAIA,EAAM,CACF,MAAAP,EAAO,KAAK,MAAMO,CAAI,EAC5BlB,EAAW,MAAQW,EAAK,SACxBV,EAAS,QAAUU,EAAK,QACxBV,EAAS,SAAWU,EAAK,QAC3B,CAAA,EAGF,OAAAQ,EAAU,IAAM,CACIF,GAAA,CACnB"}