{"version":3,"file":"DataBoard-11d23701.js","sources":["../../src/views/workbench/DataBoard.vue"],"sourcesContent":["<template>\n  <a-card class=\"data-board\" title=\"数据看板\" :bordered=\"false\">\n    <template #extra>\n      <span class=\"card-extra-text\"> 你的数据范围：</span>\n      <a-select\n        ref=\"select\"\n        label-in-value\n        v-model:value=\"searchInfo.selectStationValue\"\n        :options=\"optionsPermissionData\"\n        style=\"width: 200px\"\n      />\n      <Icon icon=\"ion:settings-outline\" :size=\"17\" @click=\"handleOpenDialog()\" />\n    </template>\n    <div class=\"card-content\">\n      <a-carousel dotsClass=\"carousel-dots\" :after-change=\"onChange\">\n        <div class=\"nav-page\" v-for=\"(pageItem, pageIndex) in dataBoard\" :key=\"pageIndex\">\n          <div class=\"nav-item-container\">\n            <div class=\"data-board-item-layout\" v-for=\"(n, index) in pageItem\" :key=\"index\">\n              <div class=\"data-board-item\">\n                <div class=\"date-type-tag\">{{ n.dateTypeText }}</div>\n                <div class=\"label-text\">{{ n.name }}</div>\n                <div class=\"value-text\">{{ n.value }}</div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </a-carousel>\n    </div>\n  </a-card>\n\n  <IndexSelectDialog\n    title=\"指标库\"\n    v-model:visible=\"openDialog\"\n    :value=\"formState.dataBoard\"\n    :tdata=\"indexTreeData\"\n    :tfields=\"{\n      key: 'value',\n      title: 'label',\n    }\"\n    :width=\"1000\"\n    :height=\"600\"\n    @cancel=\"receiverCancel\"\n    @confirm=\"receiverConfirm\"\n    :scolumns=\"menuTableColumn\"\n    :max=\"30\"\n    :rightColumns=\"rightTableColumns\"\n  />\n</template>\n<script lang=\"ts\" setup>\n  import { ref, reactive, onMounted, UnwrapRef } from 'vue';\n  import Icon from '@/components/Icon/Icon.vue';\n  import IndexSelectDialog from './IndexSelectDialog.vue';\n  import { TreeSelectProps, message } from 'ant-design-vue';\n  import {\n    getIndexTreeData,\n    saveDataBoard,\n    getDataBoard,\n    getDataBoardResult,\n    getStationTreeList,\n  } from './data';\n  import * as CommonApi from '@/api/da/common';\n\n  const openDialog = ref(false);\n  const indexTreeData = ref<TreeSelectProps['treeData']>();\n  const formState: any = reactive({\n    dataBoard: [],\n  });\n\n  const dataBoard = ref([]);\n\n  const searchInfo: UnwrapRef<any> = reactive({});\n\n  const optionsPermissionData: any = ref([]);\n\n  const optionsDimension: any = ref([]);\n\n  const menuTableColumn = ref([\n    {\n      title: '指标类型',\n      dataIndex: '',\n      customRender: ({ record }) => {\n        return record.parent_node.label;\n      },\n    },\n    { title: '指标名称', dataIndex: 'title' },\n  ]);\n\n  const rightTableColumns = ref([\n    { title: '序号', dataIndex: 'index', key: 'index', width: 60 },\n    { title: '名称', dataIndex: 'label', key: 'label' },\n    { title: '颗粒度', dataIndex: 'dataGranularity', key: 'dataGranularity' },\n    {\n      title: '时间维度',\n      dataIndex: 'dateType',\n      key: 'dateType',\n      width: 100,\n      type: 'select',\n      selectOptions: {\n        day: [\n          {\n            label: '今日',\n            value: 'today',\n          },\n          {\n            label: '本周',\n            value: 'current_week',\n          },\n          {\n            label: '当月',\n            value: 'current_month',\n          },\n          {\n            label: '本季度',\n            value: 'current_quarter',\n          },\n          {\n            label: '当年',\n            value: 'current_year',\n          },\n          {\n            label: '累计',\n            value: 'total',\n          },\n        ],\n        month: [\n          {\n            label: '当月',\n            value: 'current_month',\n          },\n          {\n            label: '本季度',\n            value: 'current_quarter',\n          },\n          {\n            label: '当年',\n            value: 'current_year',\n          },\n          {\n            label: '累计',\n            value: 'total',\n          },\n        ],\n        year: [\n          {\n            label: '当年',\n            value: 'current_year',\n          },\n          {\n            label: '累计',\n            value: 'total',\n          },\n        ],\n      },\n    },\n    { title: '排序', dataIndex: 'sort', key: 'sort', width: 60 },\n    { title: '操作', dataIndex: 'action', key: 'action', width: 60 },\n  ]);\n\n  onMounted(async () => {\n    queryDataBoardByUserId();\n    const permissionResult = await getStationTreeList({});\n    if (permissionResult) {\n      permissionResult.forEach((e) => {\n        if (e.children?.length) {\n          e.children.forEach((e) => {\n            optionsPermissionData.value.push({ value: e.id, label: e.name });\n          });\n        }\n      });\n    }\n    if (optionsPermissionData.value?.length) {\n      searchInfo.selectStationValue = optionsPermissionData.value[0].value;\n    }\n  });\n\n  //当前登录人的数据看板设置\n  const queryDataBoardByUserId = async () => {\n    //弹框回显\n    await getDataBoard({}).then((rsp) => {\n      if (rsp) {\n        formState.dataBoard = [];\n        rsp.forEach((e) => {\n          formState.dataBoard.push({\n            value: e.parentId,\n            label: e.name,\n            parentId: e.parentId,\n            name: e.name,\n            fullName: e.fullName,\n            dataGranularity: e.dataGranularity,\n            dateType: e.dateType,\n          });\n        });\n      }\n    });\n\n    //工作台数据展示\n    await getDataBoardResult({}).then((rsp) => {\n      if (rsp) {\n        dataBoard.value = rsp;\n        formState.dataResult = [];\n        rsp.forEach((e) => {\n          formState.dataResult.push({\n            value: e.value,\n            label: e.name,\n          });\n        });\n      }\n    });\n  };\n\n  //查询树\n  const queryIndexTreeData = async () => {\n    const typeSubList = await getIndexTreeData({});\n    indexTreeData.value = dig(typeSubList.result, true);\n  };\n\n  function dig(data, selectIndex) {\n    const list: TreeSelectProps['treeData'] = [];\n    for (let i = 0; i < data.length; i++) {\n      const item = data[i];\n      const treeNode: TreeSelectProps['treeData'][number] = {\n        label: item.name,\n        value: item.id,\n        parentId: item.parentId,\n        dataGranularity: item.dataGranularity,\n        disabled: selectIndex ? item.type !== 'index' : false,\n      };\n\n      if (item.children && item.children.length > 0) {\n        treeNode.children = dig(item.children, selectIndex);\n      }\n      list.push(treeNode);\n    }\n    return list;\n  }\n\n  //打开\n  const handleOpenDialog = async () => {\n    openDialog.value = true;\n    queryIndexTreeData();\n  };\n\n  //清空\n  const receiverCancel = () => {\n    openDialog.value = false; // 关闭弹框\n  };\n\n  //保存\n  const receiverConfirm = (allList) => {\n    \n    let dataList: any = [];\n    if (allList && allList.length > 0) {\n      allList.forEach((e, index) => {\n        dataList.push({\n          indexStorehouseId: e.value,\n          dateType: e.dateType,\n          dataGranularity: e.dataGranularity,\n          sort: index + 1,\n        });\n      });\n    }\n    saveDataBoard(dataList).then(() => {\n      message.success('操作成功');\n      queryDataBoardByUserId();\n\topenDialog.value = false;\n    });\n  };\n\n  const onChange = (current: number) => {\n    console.log(current);\n  };\n</script>\n\n<style lang=\"less\" scoped>\n  .ant-card-extra > .ant-select-show-arrow {\n    width: 300px;\n    margin-right: 10px;\n  }\n\n  // 深浅主题适配\n  .theme1 {\n    .card-extra-text {\n      color: rgba(255, 255, 255, 0.85);\n    }\n  }\n\n  .theme3 {\n    .card-extra-text {\n      color: rgba(0, 0, 0, 0.85);\n    }\n  }\n\n  .card-content {\n    height: 278px;\n\n    .nav-page {\n      height: 278px;\n      padding: 16px 0;\n    }\n\n    .data-board-item-layout {\n      width: 20%;\n      padding: 0 7px;\n      margin-bottom: 16px;\n    }\n\n    .data-board-item {\n      width: 100%;\n      height: 100px;\n      padding-top: 28px;\n      padding-left: 20px;\n      border-radius: 2px;\n      line-height: 1;\n      position: relative;\n      overflow: hidden;\n      .date-type-tag {\n        position: absolute;\n        top: 4px;\n        left: -14px;\n        font-size: 12px;\n        color: #fff;\n        height: 18px;\n        line-height: 18px;\n        padding: 0 15px;\n        transform: rotate(-45deg);\n      }\n\n      .label-text {\n        margin-bottom: 8px;\n        font-size: 13px;\n        color: rgba(255, 255, 255, 0.7);\n      }\n\n      .value-text {\n        margin-bottom: 12px;\n        font-size: 24px;\n        font-weight: 500;\n        color: #fff;\n      }\n\n      .percentage-box {\n        display: flex;\n        align-items: center;\n        font-size: 12px;\n      }\n\n      .pLabel-text {\n        margin-right: 11px;\n      }\n\n      .pValue-text {\n        &.up {\n          color: #ff4d4f;\n        }\n\n        &.up::before {\n          content: '▲';\n          display: inline-block;\n          transform: scale(0.6);\n          color: #ff4d4f;\n        }\n\n        &.down {\n          color: #52c41a;\n        }\n\n        &.down::before {\n          content: '▼';\n          display: inline-block;\n          transform: scale(0.6);\n          color: #52c41a;\n        }\n      }\n    }\n\n    .nav-item-container {\n      display: flex;\n      flex-wrap: wrap;\n    }\n\n    .data-board-item-layout {\n      &:nth-child(1) {\n        .data-board-item {\n          background: linear-gradient(\n            180deg,\n            rgba(108, 106, 255, 0.96) 0%,\n            rgba(77, 39, 213, 0.96) 100%\n          );\n          .date-type-tag {\n            background-color: rgba(94, 67, 226, 1);\n          }\n        }\n      }\n\n      &:nth-child(2) {\n        .data-board-item {\n          background: linear-gradient(\n            180deg,\n            rgba(101, 199, 248, 0.96) 0%,\n            rgba(68, 145, 226, 0.96) 100%\n          );\n          .date-type-tag {\n            background-color: rgba(66, 142, 221, 1);\n          }\n        }\n      }\n      &:nth-child(3) {\n        .data-board-item {\n          background: linear-gradient(\n            180deg,\n            rgba(108, 221, 177, 0.96) 0%,\n            rgba(82, 169, 222, 0.96) 100%\n          );\n          .date-type-tag {\n            background-color: rgba(37, 180, 158, 1);\n          }\n        }\n      }\n      &:nth-child(4) {\n        .data-board-item {\n          background: linear-gradient(\n            180deg,\n            rgba(242, 202, 105, 0.96) 0%,\n            rgba(239, 137, 139, 0.96) 100%\n          );\n          .date-type-tag {\n            background-color: rgba(230, 135, 136, 1);\n          }\n        }\n      }\n      &:nth-child(5) {\n        .data-board-item {\n          background: linear-gradient(\n            180deg,\n            rgba(60, 125, 236, 0.96) 0%,\n            rgba(105, 117, 221, 0.96) 100%\n          );\n          .date-type-tag {\n            background-color: rgba(83, 100, 224, 1);\n          }\n        }\n      }\n      &:nth-child(6) {\n        .data-board-item {\n          background: linear-gradient(\n            180deg,\n            rgba(57, 116, 241, 0.96) 0%,\n            rgba(51, 90, 244, 0.96) 100%\n          );\n          .date-type-tag {\n            background-color: rgba(46, 88, 230, 1);\n          }\n        }\n      }\n      &:nth-child(7) {\n        .data-board-item {\n          background: linear-gradient(\n            180deg,\n            rgba(228, 126, 122, 0.96) 0%,\n            rgba(183, 75, 101, 0.96) 100%\n          );\n          .date-type-tag {\n            background-color: rgba(201, 89, 109, 1);\n          }\n        }\n      }\n      &:nth-child(8) {\n        .data-board-item {\n          background: linear-gradient(\n            180deg,\n            rgba(146, 186, 246, 0.96) 0%,\n            rgba(33, 82, 208, 0.96) 100%\n          );\n          .date-type-tag {\n            background-color: rgba(90, 133, 225, 1);\n          }\n        }\n      }\n      &:nth-child(9) {\n        .data-board-item {\n          background: linear-gradient(\n            180deg,\n            rgba(91, 231, 234, 0.96) 0%,\n            rgba(67, 143, 203, 0.96) 100%\n          );\n          .date-type-tag {\n            background-color: rgba(81, 171, 215, 1);\n          }\n        }\n      }\n      &:nth-child(10) {\n        .data-board-item {\n          background: linear-gradient(\n            180deg,\n            rgba(56, 187, 254, 0.96) 0%,\n            rgba(40, 95, 207, 0.96) 100%\n          );\n          .date-type-tag {\n            background-color: rgba(53, 129, 223, 1);\n          }\n        }\n      }\n    }\n\n    :deep(.carousel-dots) {\n      bottom: 0;\n    }\n\n    :deep(.carousel-dots > li) {\n      width: 32px;\n      height: 4px;\n      border-radius: 2px;\n\n      button {\n        background-color: transparent;\n      }\n\n      &.slick-active {\n        background-color: #1890ff;\n\n        button {\n          background-color: transparent;\n        }\n      }\n    }\n  }\n\n  .workbench .data-board {\n    :deep(.ant-card-body) {\n      padding: 0 9px;\n    }\n  }\n</style>\n"],"names":["openDialog","ref","indexTreeData","formState","reactive","dataBoard","searchInfo","optionsPermissionData","menuTableColumn","record","rightTableColumns","onMounted","__async","queryDataBoardByUserId","permissionResult","getStationTreeList","e","_a","getDataBoard","rsp","getDataBoardResult","queryIndexTreeData","typeSubList","getIndexTreeData","dig","data","selectIndex","list","i","item","treeNode","handleOpenDialog","receiverCancel","receiverConfirm","allList","dataList","index","saveDataBoard","message","onChange","current"],"mappings":"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"}