var d=(r,l,c)=>new Promise((a,s)=>{var u=n=>{try{p(c.next(n))}catch(m){s(m)}},b=n=>{try{p(c.throw(n))}catch(m){s(m)}},p=n=>n.done?a(n.value):Promise.resolve(n.value).then(u,b);p((c=c.apply(r,l)).next())});import{a0 as F,a5 as y,au as M,b as A,a7 as E,av as h,at as x,ax as B,az as Y,aA as V,_ as j}from"./index.js";import{P as H}from"./index-20519caf.js";import{B as K}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as L}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{s as W,a as q}from"./stationTree-56a32762.js";import{e as U}from"./download-03e71dd5.js";import"./index-316f6ffb.js";import{u as X}from"./useRender-21ce56fb.js";import{d as Z,k as _,o as $,al as G,Z as J,a9 as Q,aa as g,f,$ as ee,u as i,E as I,ad as v}from"./vue-71d1abb3.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./CommonTree-c4ed7838.js";import"./index-3801a970.js";function te(r){return y.get({url:"/po/inspection-execution/page",params:r})}function ae(r){return y.download({url:"/po/inspection-execution/export-excel",params:r},{isReturnNativeResponse:!0})}const ne={0:"#dc0000",1:"#338ed1",2:"#30ca5a",3:"#929292",4:"#929292",5:"#929292",6:"#fda941"},oe=[{title:"单据编号",dataIndex:"billCode",width:160,sorter:!0,resizable:!0},{title:"所属公司",dataIndex:"stationOrganName",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0,ifShow:F().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"巡检时间",dataIndex:"inspectionData",width:120,sorter:!0,resizable:!0},{title:"巡检区域",dataIndex:"inspectionAreaTypeText",width:120,sorter:!0,resizable:!0},{title:"巡检设备",dataIndex:"deviceName",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"巡查人",dataIndex:"inspectorName",width:120,sorter:!0,resizable:!0},{title:"检查项次",dataIndex:"checkNum",align:"right",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"整改项次",dataIndex:"rectification",align:"right",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"审批状态",dataIndex:"statusText",width:100,sorter:!0,resizable:!0,customRender:({text:r,record:l})=>X.renderTag(r,ne[l.status])}],re=[{label:"单据编号",field:"billCode",component:"Input",colProps:{span:8}},{label:"巡检区域",field:"inspectionAreaType",component:"DictSelectBox",componentProps:{type:"commDeviceCategory"},colProps:{span:8}},{label:"状态",field:"status",component:"DictSelectBox",componentProps:{type:"bpm_process_instance_result"},colProps:{span:8}},{field:"[startInspectionDate, endInspectionDate]",label:"巡检时间",component:"RangePicker",colProps:{span:8},componentProps:{format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",placeholder:["开始日期","结束日期"]}}],se={class:"right-table-layout"},ie=Z({__name:"index",setup(r){const{createConfirm:l,createMessage:c}=M(),a=_({status:"",businessKind:"",examinationResult:"",billCode:"",pageNo:1,pageSize:10,sortField:"billCode",sortOrder:"desc"});let s=_("");const{t:u}=A();function b(){return d(this,null,function*(){l({title:u("common.exportTitle"),iconType:"warning",content:u("common.exportMessage"),onOk(){return d(this,null,function*(){let t=w().getFieldsValue();Object.assign(t,a.value),yield ae(t).then(o=>{U(o==null?void 0:o.data,"巡检执行.xls")}),c.success(u("common.exportSuccessText"))})}})})}const[p,{reload:n,getPaginationRef:m,getForm:w,getSelectRows:C}]=L({title:"巡检执行",api:()=>d(this,null,function*(){const e=m();return a.value.pageNo=e.current,a.value.pageSize=e.pageSize,(yield te(a.value)).result}),columns:oe,rowKey:"id",bordered:!0,formConfig:{labelWidth:120,schemas:re,showAdvancedButton:!0,autoAdvancedLine:1},sortFn:e=>{e.order?(a.value.sortField=e.field.replace("Text",""),a.value.sortOrder=e.order.replace("end","")):(a.value.sortField="billCode",a.value.sortOrder="desc")},useSearchForm:!0,showTableSetting:!0,rowSelection:{type:"radio",fixed:!0,onSelect:T},handleSearchInfoFn(e){for(const t in e)a.value[t]=e[t]}});function T(e,t){t?s.value=e.id:s.value=""}function S({keys:e,rows:t}){if(t&&t.length>0){const o=t[0];s.value=o.id}else s.value=""}function P(e){q(e,a,{stationType:""},n)}function z(){if(!a.value.stationId){x.getInstance().info("请选中电站添加");return}B("/po/inspection/inspectionexecution/create?id=","添加巡检执行",{stationId:a.value.stationId,stationName:a.value.stationName,stationType:a.value.stationType,stationOrganId:a.value.stationOrganId,stationOrganName:a.value.stationOrganName})}const O=(e,t,o)=>{D(e)};function D(e){Y(e.id)}const N=()=>d(this,null,function*(){let e=C();if(e.length!=1){x.getInstance().success("请选择一行数据");return}let t=e[0];l({title:"提示",iconType:"warning",content:"确定要删除选中的记录？",onOk(){return d(this,null,function*(){if(t.status!=0){x.getInstance().success("非草稿状态不能删除");return}yield V(t.processInstanceId),x.getInstance().success("删除成功"),n()})}})});return $(()=>{E.getInstance().listen("inspection-execution",()=>{n()})}),(e,t)=>{const o=G("a-button");return J(),Q(i(H),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:g(()=>[f(W,{onSelectTree:P}),ee("div",se,[f(i(K),{onRegister:i(p),class:"fix-basic-table",onResizeColumn:t[0]||(t[0]=(R,k)=>k.width=R),onSelectionChange:S,onRowDbClick:O},{toolbar:g(()=>[f(o,{type:"primary",preIcon:i(h).ADD,onClick:z},{default:g(()=>[I(v("添加"))]),_:1},8,["preIcon"]),f(o,{class:"red-btn",disabled:i(s)=="",preIcon:i(h).DELETE,onClick:N},{default:g(()=>[I(v("删除"))]),_:1},8,["disabled","preIcon"]),f(o,{class:"yellow-btn",preIcon:i(h).EXPORT,onClick:b},{default:g(()=>[I(v("导出"))]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])])]),_:1})}}});const Ee=j(ie,[["__scopeId","data-v-baa0e44c"]]);export{Ee as default};
//# sourceMappingURL=index-e0ad8443.js.map
