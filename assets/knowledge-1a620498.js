var I=(j,k,y)=>new Promise((b,m)=>{var O=i=>{try{v(y.next(i))}catch(p){m(p)}},a=i=>{try{v(y.throw(i))}catch(p){m(p)}},v=i=>i.done?b(i.value):Promise.resolve(i.value).then(O,a);v((y=y.apply(j,k)).next())});import{d as Te,J as Q,r as z,k as o,ax as xe,o as Ne,al as _,Z as D,_ as X,f as l,aa as r,$ as Ce,u as c,E as A,a9 as ee,ac as L,v as te,A as ne}from"./vue-71d1abb3.js";import{B as Fe}from"./BasicTable-0434a334.js";import{T as Se}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as De}from"./useTable-109483b3.js";import{a2 as u}from"./antd-15ac76ed.js";import{b as Re,au as Oe,a0 as Ee,a7 as Me,av as R,ax as P,_ as Be}from"./index.js";import{P as Ue}from"./index-20519caf.js";import{C as ze}from"./CommonTree-c4ed7838.js";import{g as Ae,a as Le,s as Pe,f as s,d as je,b as He,c as Ve,e as $e}from"./knowledge-473fa26e.js";import{x as ae}from"./index-66d20ba6.js";import{U as Ke}from"./UploadBox-636ecf02.js";import{D as qe}from"./Dialog-0a006d82.js";import{a as We}from"./assign-37f1c13d.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";const Ge={class:"right-table-layout"},Je={key:0,class:"dialog-mask"},Ye=Te({__name:"knowledge",setup(j){const{t:k}=Re(),{createConfirm:y}=Oe(),b=Ee(),m=Q(b.getUserInfo),O=b.getUserInfo,a=z({knowledgeType:""}),v=o([]),i=o(!0),p=o({typeId:"",fullName:"",id:"",name:"",kind:"",existChildNode:!1});xe();const f=z({open:{type:o(!1),index:o(!1)},title:{type:o(""),index:o("")}}),T=o(!1),le=o(!1),g=o([]),oe=Ve(),n=z({id:"",name:"",fullId:"",type:"",knowledgeTypeName:"",knowledgeType:"",fullName:"",parentId:"",checkItem:"",description:"",parentName:"",parentFullId:"",parentFullName:"",readOnly:!1}),H=o(),E=o(),re=o(),w=o([]),se=()=>I(this,null,function*(){let e=yield $e(a);return w.value=e.result,w.value}),ie={showAdvancedButton:!1,baseColProps:{span:8},labelWidth:120,autoAdvancedLine:1,schemas:[{label:"主题",field:"subject",component:"Input"}]},[ue,{reload:M,getPaginationRef:de}]=De({title:"知识库",api:()=>I(this,null,function*(){const e=de();return a.pageNo=e.current,a.pageSize=e.pageSize,yield se()}),columns:oe,useSearchForm:!0,showIndexColumn:!1,formConfig:ie,showTableSetting:!0,resizeHeightOffset:32,pagination:!0,canResize:!0,bordered:!0,rowKey:"id",rowSelection:{type:"radio",onChange:ce},handleSearchInfoFn(e){return a.subject=e.subject,e},sortFn:e=>{e.order?(a.sortField=e.field,a.sortOrder=e.order.replace("end","")):(a.sortField=null,a.sortOrder=null)}});let x=o("");function ce(e,t){t.length>0?(g.value=[e[0]],x.value=e[0]):(g.value=[],x.value="")}function V(){return I(this,null,function*(){const e=yield Ae({code:"checkIndexType"});v.value=e.result})}function me(e){if(n.id="",n.type="",n.parentId="root",n.fullId="",n.parentName="",n.parentFullName="",n.name="",e&&(n.parentId=e.id,n.type=e.type,n.parentName=e.name,n.fullId=e.fullId,n.parentFullName=e.fullName,e.fullId&&e.fullId.split("/").length>4)){u.error("最多允许新增4个层级");return}const t=U(n);K(e,t)&&(f.open.type=!0,f.title.type=t+"知识库类型")}function $(e){return e?!0:(u.error("请选择知识库类型节点"),!1)}function pe(e){if(!$(e))return;const t=U({id:e.id});if(e.parentId==="root"){u.error(`父节点，不能${t}`);return}if(e.children.length>0){u.error(`该知识库类型存在子节点，不能${t}`);return}K(e,t)&&(Le({id:e.id}).then(h=>{We(n,h.result)}),f.open.type=!0,f.title.type=t+"知识库类型")}function K(e,t){return e&&e.children.length==0&&e.fullId&&w.value&&w.value.list.length>0?(u.error("该知识库分类存在知识库，不能"+t),!1):!0}function fe(e){if($(e)){if(e.children.length>0)return u.error("该知识库类型存在子节点，不能删除"),!1;if(w.value.list.length>0)return u.error("该知识库存在数据，不能删除"),!1;ge(function(){He("?id="+e.id).then(()=>{B()})})}}function ge(e){y({title:k("common.message.confirmTitle"),iconType:"warning",content:k("common.message.delMessage"),onOk(){return I(this,null,function*(){yield e(),u.success(k("common.delSuccessText"))})}})}function B(){V()}function ye(){let e=E.value;e&&e.validateFields().then(()=>{T.value=!0,n.fullName=he();let t=U(n);Pe(n).then(()=>{u.success(t+"成功"),q(),B(),f.open.type=!1,T.value=!1}).catch(()=>{T.value=!1})})}function U(e){return e.id?"修改":"添加"}function he(){let e=n.parentFullName;return e?e+"-"+ae.trim(n.name):ae.trim(n.name)}function ve(){q(),f.open.type=!1}function q(){var e,t;(e=E.value)==null||e.resetFields(),(t=re.value)==null||t.resetFields()}function Ie(e){a.typeFullId=null,a.knowledgeType=null,a.knowledgeTypeName=null,e&&(a.typeFullId=e.fullId,a.knowledgeType=e.id,a.knowledgeTypeName=e.name,p.value={typeId:e.id,fullName:e.fullName,id:e.id,name:e.name,kind:e.kind,existChildNode:e.children!=null&&e.children.length>0}),M()}function _e(){const e=H.value.getSelectedTreeNode();if(!e){u.error("请选择知识库类型");return}if(e.children.length>0){u.error("请选择知识库类型的末级节点");return}n.knowledgeTypeName=p.value.name,n.knowledgeType=p.value.id,s.id="",s.subject="",s.content="",s.status=1,s.knowledgeType=p.value.id,s.knowledgeTypeName=p.value.name,s.createTime=ke(new Date),s.creator=m.orgs[0].personId,s.creatorName=m.orgs[0].personMemberName,s.deptId=m.orgs[0].deptId,s.deptName=m.orgs[0].deptName,s.organId=m.orgs[0].orgId,s.organName=m.orgs[0].orgName,P("/po/integrated/knowledge/create","添加知识库",Q(s))}function ke(e){const t=e.getFullYear(),h=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,N=e.getDate()<10?"0"+e.getDate():e.getDate(),C=e.getHours()<10?"0"+e.getHours():e.getHours(),F=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),S=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds();return t+"-"+h+"-"+N+" "+C+":"+F+":"+S}function W(){return console.log("checkedKeys",g),g.value.length==0||g.value.length>1||!g.value[0]?(u.error("请选择一行数据"),!1):!0}function we(){W()&&P("/po/integrated/knowledge/detail?id="+g.value[0],"修改知识库")}function G(e){P(`/po/integrated/knowledge/detail?id=${e.id}&readOnly=true`,"查看知识库")}function be(){W()&&y({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return I(this,null,function*(){je("?id="+g.value[0]).then(()=>{u.success("已删除"),delete g.value[0],M()})})}})}return Ne(()=>{V();let t=O.permissions.includes("po:knowledgetype:*");i.value=t,Me.getInstance().listen("integrated-knowledge",function(){setTimeout(()=>{M()},500)})}),(e,t)=>{const h=_("a-button"),N=_("a-input"),C=_("a-form-item"),F=_("a-col"),S=_("a-row"),J=_("a-form");return D(),X("div",null,[l(c(Ue),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:r(()=>[l(ze,{ref_key:"treeRef",ref:H,title:"知识库分类",style:{"font-size":"1px"},onSelect:Ie,value:v.value,class:"left-tree-layout",fieldNames:{key:"id",title:"name"},isShowOperationBtns:i.value,canAdd:i.value,canEdit:i.value,canDelete:i.value,onAdd:me,onEdit:pe,onDelete:fe,onRefresh:B},null,8,["value","isShowOperationBtns","canAdd","canEdit","canDelete"]),Ce("div",Ge,[l(c(Fe),{class:"fix-basic-table",onRegister:c(ue),searchInfo:a,onResizeColumn:t[0]||(t[0]=(d,Y)=>Y.width=d),onRowDbClick:t[1]||(t[1]=d=>G(d))},{toolbar:r(()=>[l(h,{type:"primary",preIcon:c(R).ADD,onClick:_e},{default:r(()=>[A("添加")]),_:1},8,["preIcon"]),l(h,{type:"primary",disabled:c(x)=="",preIcon:c(R).EDIT,onClick:we},{default:r(()=>[A("修改")]),_:1},8,["disabled","preIcon"]),l(h,{class:"red-btn",disabled:c(x)=="",preIcon:c(R).DELETE,onClick:be},{default:r(()=>[A("删除")]),_:1},8,["disabled","preIcon"])]),bodyCell:r(({column:d,text:Y,record:Z})=>[d.key==="files"?(D(),ee(Ke,{key:0,width:800,height:550,maxCount:20,maxSize:100*1024*1024,application:"po",module:"knowledge",vmode:"view",bizId:Z.bizFileId},null,8,["bizId"])):L("",!0),d.key==="action"?(D(),ee(c(Se),{key:1,actions:[{icon:c(R).LOG,label:"查看",onClick:G.bind(null,Z)}]},null,8,["actions"])):L("",!0)]),_:1},8,["onRegister","searchInfo"])]),l(qe,{visible:f.open.type,"onUpdate:visible":t[4]||(t[4]=d=>f.open.type=d),title:f.title.type,onOk:ye,onCancel:ve,height:200,width:600},{default:r(()=>[l(J,{ref_key:"modalFormRef",ref:E,model:n,name:"userForm"},{default:r(()=>[l(S,{gutter:24},{default:r(()=>[te(l(F,{span:20},{default:r(()=>[l(C,{label:"所属类型",name:"parentName",labelCol:{style:{width:"124px"}}},{default:r(()=>[l(N,{value:n.parentName,"onUpdate:value":t[2]||(t[2]=d=>n.parentName=d),disabled:!0},null,8,["value"])]),_:1})]),_:1},512),[[ne,!0]])]),_:1}),l(S,{gutter:24},{default:r(()=>[te(l(F,{span:20},{default:r(()=>[l(C,{label:"知识库类型",name:"name",labelCol:{style:{width:"124px"}},rules:[{required:!0,max:30}]},{default:r(()=>[l(N,{value:n.name,"onUpdate:value":t[3]||(t[3]=d=>n.name=d),maxlength:30,disabled:le.value},null,8,["value","disabled"])]),_:1})]),_:1},512),[[ne,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),T.value?(D(),X("div",Je)):L("",!0)]),_:1})])}}});const Ct=Be(Ye,[["__scopeId","data-v-0cf338a8"]]);export{Ct as default};
//# sourceMappingURL=knowledge-1a620498.js.map
