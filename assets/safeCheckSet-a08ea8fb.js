var E=(n,P,w)=>new Promise((g,D)=>{var K=x=>{try{o(w.next(x))}catch(p){D(p)}},y=x=>{try{o(w.throw(x))}catch(p){D(p)}},o=x=>x.done?g(x.value):Promise.resolve(x.value).then(K,y);o((w=w.apply(n,P)).next())});import{d as Re,k as d,r as j,o as Oe,al as m,Z as B,a9 as le,aa as l,f as a,$ as Ae,u as i,E as _,ad as Le,_ as M,F as Pe,ac as O,v as A,A as L}from"./vue-71d1abb3.js";import{B as qe}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as He}from"./useTable-109483b3.js";import{a2 as f}from"./antd-15ac76ed.js";import{a5 as h,au as Ve,bS as je,av as N,_ as Me}from"./index.js";import{P as Ke}from"./index-20519caf.js";import{C as We}from"./CommonTree-c4ed7838.js";import"./index-74ac3212.js";import{x as J}from"./index-66d20ba6.js";import{D as ne}from"./Dialog-0a006d82.js";import{a as se}from"./assign-37f1c13d.js";import{j as oe}from"./Export2Excel-389a8fc9.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";function re(){return[{title:"ID",dataIndex:"id",defaultHidden:!0},{title:"检查类型",dataIndex:"checkTypeName",width:100,resizable:!0,sorter:!0},{title:"检查项目",dataIndex:"checkItem",width:200,headAlign:"center",align:"left",resizable:!0,sorter:!0},{title:"检查内容",dataIndex:"description",width:200,headAlign:"center",align:"left",resizable:!0,sorter:!0},{title:"状态",dataIndex:"status",width:100,resizable:!0,sorter:!0},{title:"排序",dataIndex:"sort",editRow:!0,width:100,headAlign:"center",align:"right",resizable:!0,sorter:!0},{title:"创建人",dataIndex:"creator",width:100,resizable:!0,sorter:!0},{title:"创建时间",dataIndex:"createTime",width:200,resizable:!0,sorter:!0},{title:"修改人",dataIndex:"updater",width:100,resizable:!0,sorter:!0},{title:"修改时间",dataIndex:"updateTime",width:100,resizable:!0,sorter:!0}]}const Xe=n=>h.get({url:"/baseset/safeCheck/getTree",params:n},{}),$e=n=>h.post({url:"/baseset/safeCheck/type/create",params:n},{}),Ze=n=>h.put({url:"/baseset/safeCheck/type/update",params:n},{}),Ge=n=>n.id?Ze(n):$e(n),Je=n=>h.get({url:"/baseset/safeCheck/page",params:n},{}),Qe=n=>h.get({url:"/baseset/safeCheck/exportExcel",params:n},{}),ie=n=>h.get({url:"/baseset/safeCheck/get",params:n},{}),Ye=n=>h.post({url:"/baseset/safeCheck/create",params:n},{}),et=n=>h.put({url:"/baseset/safeCheck/update",params:n},{}),tt=n=>n.id?et(n):Ye(n),de=n=>h.put({url:"/baseset/safeCheck/updateStatus",params:n},{}),at=n=>h.put({url:"/baseset/safeCheck/updateBatchSort",params:n},{}),lt=n=>h.delete({url:"/baseset/safeCheck/delete",params:n},{}),nt={class:"right-table-layout"},st={key:0,style:{color:"#19be6b"}},ot={key:1,style:{color:"red"}},rt={key:0,class:"dialog-mask"},it=Re({__name:"safeCheckSet",setup(n){const{createConfirm:P}=Ve(),w={Authorization:`Bearer ${je()}`,_t:new Date().getTime(),version:"4.5.4"};let g=d(""),D="/admin-api/baseset/safeCheck/import-excel?_t="+new Date().getTime();const K=()=>{w._t=new Date().getTime(),D=D+"?_t="+new Date().getTime()};let y=!1;const o=j({checkType:"",checkItem:"",description:""}),x=d([]),p=d({typeId:"",fullName:"",code:"",name:"",existChildNode:!1}),u=j({open:{type:d(!1),index:d(!1)},title:{type:d(""),index:d("")}}),S=d(!1),ue=d(!1),v=d([]),ce=re(),c=j({id:"",name:"",fullId:"",code:"",checkTypeText:"",checkType:"",fullName:"",parentId:"",checkItem:"",description:"",parentName:"",parentFullId:"",parentFullName:""}),r=j({id:"",typeId:"",name:"",code:"",fullName:"",checkTypeText:"",checkType:"",checkItem:"",description:"",status:1,sort:1,remark:""}),W=d(),X=d(),U=d([]),pe=()=>E(this,null,function*(){let e=yield Je(o);return U.value=e.result,U.value}),me={baseColProps:{span:8},labelWidth:120,showAdvancedButton:!1,schemas:[{label:"检查项目",field:"checkItem",component:"Input"},{label:"检查内容",field:"description",component:"Input"},{label:"状态",field:"status",component:"Select",componentProps:{options:[{label:"启用",value:"1"},{label:"禁用",value:"0"}]}}]},[fe,{reload:F,getPaginationRef:he,getDataSource:ut}]=He({title:"安全检查指标",api:()=>E(this,null,function*(){const e=he();return o.pageNo=e.current,o.pageSize=e.pageSize,yield pe()}),columns:ce,useSearchForm:!0,formConfig:me,showTableSetting:!1,pagination:{pageSize:20},bordered:!0,rowKey:"id",rowSelection:{type:"radio",onChange:xe},indexColumnProps:{fixed:"left"},handleSearchInfoFn(e){return o.checkItem=e.checkItem,o.description=e.description,o.status=e.status,e},sortFn:e=>{e.order?(o.sortField=e.field,o.sortOrder=e.order.replace("end","")):(o.sortField=null,o.sortOrder=null)}});function xe(e,t){t.length>0?(v.value=[e[0]],g.value=e[0]):(v.value=[],g.value="")}function Q(){return E(this,null,function*(){const e=yield Xe({code:"checkIndexType"});x.value=e.result})}function ve(){Q()}function be(){let e=W.value;e&&e.validateFields().then(()=>{S.value=!0,c.fullId=c.parentFullId,c.fullName=_e();let t=Y(c);Ge(c).then(()=>{f.success(t+"成功"),$(),ve(),u.open.type=!1,S.value=!1}).catch(()=>{S.value=!1})})}function Y(e){return e.id?"修改":"添加"}function Ie(){let e=X.value;e&&e.validateFields().then(()=>{S.value=!0;let t=Y(c);r.name=J.trim(r.name),tt(r).then(()=>{f.success(t+"成功"),$(),F(),u.open.index=!1,S.value=!1}).catch(()=>{S.value=!1})})}function _e(){let e=c.parentFullName;return e?e+"-"+J.trim(c.name):J.trim(c.name)}function ee(){$(),u.open.type=!1,u.open.index=!1}function $(){var e,t;(e=W.value)==null||e.resetFields(),(t=X.value)==null||t.resetFields()}function ye(e){o.typeFullId=null,p.value={typeId:"",fullName:"",code:"",name:"",existChildNode:!1},e?(o.typeFullId=e.fullId,o.checkType=e.code,p.value={typeId:e.id,fullName:e.fullName,code:e.code,name:e.name,existChildNode:!1}):(o.typeFullId=null,o.checkType=null),F()}function ke(){if(!p.value.typeId){f.error("请选择安全检查类型");return}if(p.value.existChildNode){f.error("请选择安全检查类型的末级节点");return}c.checkTypeText=p.value.name,c.checkType=p.value.code,r.id="",r.checkItem="",r.description="",r.status=1,r.checkTypeText=p.value.name,r.checkType=p.value.code,r.typeId=p.value.typeId,r.fullName=p.value.fullName,y=!1,u.open.index=!0,u.title.index="添加安全检查指标"}function q(){return v.value.length==0||v.value.length>1||!v.value[0]?(f.error("请选择一行数据"),!1):!0}function ge(){q()&&(ie({id:v.value[0]}).then(e=>{se(r,e.result)}),y=!1,u.open.index=!0,u.title.index="修改安全检查指标")}function Ce(e){ie({id:e.id}).then(t=>{se(r,t.result)}),y=!0,u.open.index=!0,u.title.index="查看安全检查指标"}function Te(){q()&&P({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return E(this,null,function*(){lt("?id="+v.value[0]).then(()=>{f.success("已删除"),delete v.value[0],F()})})}})}function we(){P({title:"导出",iconType:"warning",content:"确定要导出所有记录？",onOk(){return E(this,null,function*(){const t=d({index:"序号"}),b=re(),z=d([]),H=d([]);b.forEach(I=>{I.dataIndex!=="id"&&(t.value[I.dataIndex]=I.title,H.value.push(I.dataIndex))});let Z=yield Qe(o);U.value=Z.result,U.value.forEach(function(I,G){let C="";I.status==1?C="启用":I.status==0&&(C="禁用");let T=d({index:G+1});H.value.forEach(k=>{T.value[k]=k==="status"?C:I[k]}),z.value.push(T.value)}),oe({data:z.value,header:t.value,filename:"安全检查指标.xlsx"})})}})}function Se(){if(!q())return;const e="?id="+v.value[0]+"&status=1";de(e).then(()=>{f.success("已启用"),F()})}function Fe(){if(!q())return;const e="?id="+v.value[0]+"&status=0";de(e).then(()=>{f.success("已禁用"),F()})}function Ne(){const e=d([]);U.value.list.forEach(t=>{if(!t.sort)throw f.error("排序不能为空"),Error("排序不能为空");e.value.push({id:t.id,sort:t.sort})}),at(e.value).then(()=>{f.success("保存排序成功"),F()})}function De({key:e}){e==="downloadTemplate"&&Ee()}function Ee(){oe({data:[{}],header:{checkType:"检查类型",checkItem:"检查项目",description:"检查内容"},filename:"安全检查指标模板.xlsx"})}const Be=e=>{const t=e.file;t.status==="done"?F():t.status==="error"&&f.error("导入数据失败")};return Oe(()=>{Q()}),(e,t)=>{const b=m("a-button"),z=m("a-menu-item"),H=m("a-upload"),Z=m("a-menu"),I=m("a-dropdown"),G=m("a-input-number"),C=m("a-input"),T=m("a-form-item"),k=m("a-col"),R=m("a-row"),te=m("a-form"),Ue=m("a-textarea");return B(),le(i(Ke),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:l(()=>[a(We,{title:"安全检查类型",onSelect:ye,value:x.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"code",title:"name"}},null,8,["value"]),Ae("div",nt,[a(i(qe),{class:"fix-basic-table",onRegister:i(fe),searchInfo:o,resizeHeightOffset:0,onResizeColumn:t[0]||(t[0]=(s,V)=>V.width=s),onRowDbClick:t[1]||(t[1]=s=>Ce(s))},{toolbar:l(()=>[a(b,{type:"primary",preIcon:i(N).ADD,onClick:ke},{default:l(()=>[_("添加")]),_:1},8,["preIcon"]),a(b,{type:"primary",disabled:i(g)=="",preIcon:i(N).EDIT,onClick:ge},{default:l(()=>[_("修改")]),_:1},8,["disabled","preIcon"]),a(b,{class:"red-btn",disabled:i(g)=="",preIcon:i(N).DELETE,onClick:Te},{default:l(()=>[_("删除")]),_:1},8,["disabled","preIcon"]),a(I,null,{overlay:l(()=>[a(Z,{onClick:De},{default:l(()=>[a(z,{key:"downloadTemplate"},{default:l(()=>[_("下载模板")]),_:1}),a(z,{key:"import"},{default:l(()=>[a(H,{name:"file",showUploadList:!1,headers:w,accept:".xls,.xlsx",onChange:Be,beforeUpload:K,action:i(D)},{default:l(()=>[_(Le("导入数据"))]),_:1},8,["action"])]),_:1})]),_:1})]),default:l(()=>[a(b,{class:"yellow-btn",preIcon:i(N).IMPORT},{default:l(()=>[_(" 导入 ")]),_:1},8,["preIcon"])]),_:1}),a(b,{class:"yellow-btn",preIcon:i(N).EXPORT,onClick:we},{default:l(()=>[_("导出")]),_:1},8,["preIcon"]),a(b,{class:"green-btn",disabled:i(g)=="",preIcon:i(N).ENABLE,onClick:Se},{default:l(()=>[_("启用")]),_:1},8,["disabled","preIcon"]),a(b,{class:"grey-btn",disabled:i(g)=="",preIcon:i(N).DISABLE,onClick:Fe},{default:l(()=>[_("禁用")]),_:1},8,["disabled","preIcon"]),a(b,{type:"primary",onClick:Ne},{default:l(()=>[_("保存排序")]),_:1})]),bodyCell:l(({column:s,text:V,record:ae})=>[s.dataIndex==="status"?(B(),M(Pe,{key:0},[V==1?(B(),M("span",st,"启用")):O("",!0),V==0?(B(),M("span",ot,"禁用")):O("",!0)],64)):O("",!0),s.dataIndex==="sort"?(B(),le(G,{key:1,value:ae[s.dataIndex],"onUpdate:value":ze=>ae[s.dataIndex]=ze,min:1,max:1e4,step:1,precision:0,status:"error"},null,8,["value","onUpdate:value"])):O("",!0)]),_:1},8,["onRegister","searchInfo"])]),a(ne,{visible:u.open.type,"onUpdate:visible":t[4]||(t[4]=s=>u.open.type=s),title:u.title.type,maskClosable:!1,onOk:be,onCancel:ee,smode:"normal",showBtm:!i(y)},{default:l(()=>[a(te,{ref_key:"modalFormRef",ref:W,model:c,name:"userForm"},{default:l(()=>[a(R,{gutter:24},{default:l(()=>[A(a(k,{span:20},{default:l(()=>[a(T,{label:"编码",name:"code",labelCol:{style:{width:"124px"}}},{default:l(()=>[a(C,{value:c.code,"onUpdate:value":t[2]||(t[2]=s=>c.code=s)},null,8,["value"])]),_:1})]),_:1},512),[[L,!0]])]),_:1}),a(R,{gutter:24},{default:l(()=>[A(a(k,{span:20},{default:l(()=>[a(T,{label:"类型名称",name:"name",labelCol:{style:{width:"124px"}},rules:[{required:!0,max:30}]},{default:l(()=>[a(C,{value:c.name,"onUpdate:value":t[3]||(t[3]=s=>c.name=s),maxlength:30,disabled:ue.value},null,8,["value","disabled"])]),_:1})]),_:1},512),[[L,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","showBtm"]),a(ne,{visible:u.open.index,"onUpdate:visible":t[8]||(t[8]=s=>u.open.index=s),title:u.title.index,maskClosable:!1,onOk:Ie,onCancel:ee,height:400,width:800,smode:"normal",showBtm:!i(y)},{default:l(()=>[a(te,{ref_key:"modalIndexFormRef",ref:X,model:r,name:"userIndexForm"},{default:l(()=>[a(R,{gutter:24},{default:l(()=>[A(a(k,{span:22},{default:l(()=>[a(T,{label:"检查类型",name:"checkTypeText",labelCol:{style:{width:"124px"}},rules:[{required:!0}]},{default:l(()=>[a(C,{value:r.checkTypeText,"onUpdate:value":t[5]||(t[5]=s=>r.checkTypeText=s),disabled:""},null,8,["value"])]),_:1})]),_:1},512),[[L,!0]])]),_:1}),a(R,{gutter:24},{default:l(()=>[A(a(k,{span:22},{default:l(()=>[a(T,{label:"检查项目",name:"checkItem",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请填写检查项目"}]},{default:l(()=>[a(C,{value:r.checkItem,"onUpdate:value":t[6]||(t[6]=s=>r.checkItem=s),min:1,max:1e5,disabled:i(y)},null,8,["value","disabled"])]),_:1})]),_:1},512),[[L,!0]])]),_:1}),a(R,{gutter:24},{default:l(()=>[A(a(k,{span:22},{default:l(()=>[a(T,{label:"检查内容",name:"description",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请填写检查内容"}]},{default:l(()=>[a(Ue,{value:r.description,"onUpdate:value":t[7]||(t[7]=s=>r.description=s),rows:5,style:{width:"100%"},maxLength:500,disabled:i(y)},null,8,["value","disabled"])]),_:1})]),_:1},512),[[L,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","showBtm"]),S.value?(B(),M("div",rt)):O("",!0)]),_:1})}}});const Vt=Me(it,[["__scopeId","data-v-0ea99b5e"]]);export{Vt as default};
//# sourceMappingURL=safeCheckSet-a08ea8fb.js.map
