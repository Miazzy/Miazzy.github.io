var S=(i,v,n)=>new Promise((s,I)=>{var p=l=>{try{c(n.next(l))}catch(h){I(h)}},_=l=>{try{c(n.throw(l))}catch(h){I(h)}},c=l=>l.done?s(l.value):Promise.resolve(l.value).then(p,_);c((n=n.apply(i,v)).next())});import{P as O}from"./index-20519caf.js";import{a5 as x,au as L,a7 as H,av as f,ax as k,at as r}from"./index.js";import{B as K}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as V}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{d as U,k as D,o as W,al as C,Z as w,a9 as P,aa as d,f as u,u as o,E as m,ad as g,ac as $}from"./vue-71d1abb3.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";function q(i){return x.get({url:"/oa/information/page",params:i})}function Z(i){return x.put({url:"/oa/information/saveSort",params:i})}function T(i){return x.put({url:"/oa/information/update",params:i})}function G(i){return x.delete({url:"/oa/information/delete?id="+i})}const J=[{title:"主题",dataIndex:"subject",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"信息来源",dataIndex:"sourceText",width:120,sorter:!0,resizable:!0},{title:"信息类别",dataIndex:"typeText",width:120,sorter:!0,resizable:!0},{title:"发布人",dataIndex:"publisher",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"发布日期",dataIndex:"publishedDate",width:120,sorter:!0,resizable:!0},{title:"排序号",dataIndex:"sort",width:80,align:"right",headAlign:"center",sorter:!0,resizable:!0},{title:"状态",dataIndex:"statusText",width:120,sorter:!0,resizable:!0},{title:"备注",dataIndex:"remark",width:120,align:"left",headAlign:"center",sorter:!0,resizable:!0}],Q=[{label:"主题",field:"subject",component:"Input",colProps:{span:8}},{label:"信息类型",field:"type",component:"DictSelectBox",componentProps:{type:"information_type"},colProps:{span:8}},{field:"[startPublishedDate, endPublishedDate]",label:"发布时间",component:"RangePicker",colProps:{span:8},componentProps:{format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",placeholder:["开始日期","结束日期"]}},{label:"状态",field:"status",component:"DictSelectBox",colProps:{span:8},componentProps:{type:"enable_or_disable"}}],ke=U({__name:"index",setup(i){const{createConfirm:v}=L();let n=D("");const s=D({status:"",subject:"",infoKindId:"",startFinisheddate:"",endFinisheddate:"",pageNo:1,pageSize:10,sortField:"sort",sortOrder:"desc"}),[I,{reload:p,getPaginationRef:_,getSelectRowKeys:c,getDataSource:l}]=V({title:"资讯发布",api:()=>S(this,null,function*(){const e=_();return s.value.pageNo=e.current,s.value.pageSize=e.pageSize,(yield q(s.value)).result}),columns:J,rowKey:"id",bordered:!0,showTableSetting:!0,formConfig:{labelWidth:120,schemas:Q,showAdvancedButton:!0,autoAdvancedLine:1},sortFn:e=>{e.order?(s.value.sortField=e.field.replace("Text",""),s.value.sortOrder=e.order.replace("end","")):(s.value.sortField="sort",s.value.sortOrder="desc")},useSearchForm:!0,rowSelection:{type:"radio",fixed:!0,onSelect:h},handleSearchInfoFn(e){for(const t in e)s.value[t]=e[t]}});function h(e,t){t?n.value=e.id:n.value=""}function E({keys:e,rows:t}){if(t&&t.length>0){const a=t[0];n.value=a.id}else n.value=""}function z(){k("/oa/info/information/create?id=","添加资讯")}const F=()=>{let e=c();if(e.length!=1){r.getInstance().info("请选择一行记录操作");return}T({id:e[0],status:0}).then(t=>{t.code==0?(r.getInstance().info("禁用成功."),p()):r.getInstance().error("禁用成功.原因:"+t.message)})},A=(e,t,a)=>{k(`/oa/info/information/create?id=${e.id}&readonly=1`,"查看资讯详情")},B=()=>{let e=c();if(e.length!=1){r.getInstance().info("请选择一行记录操作");return}T({id:e[0],status:1}).then(t=>{t.code==0?(r.getInstance().info("启用成功."),p()):r.getInstance().error("启用成功.原因:"+t.message)})};function M(){let e=c();if(e.length!=1){r.getInstance().info("请选择一行记录操作");return}k(`/oa/info/information/create?id=${e[0]}`,"修改资讯详情")}const R=()=>{let e=c();if(e.length!=1){r.getInstance().info("请选择一行记录操作");return}v({title:"提示",iconType:"warning",content:"确定要删除选中的记录？",onOk(){return S(this,null,function*(){G(e[0]).then(a=>{a.code==0?r.getInstance().info("删除成功."):r.getInstance().error("删除失败.原因:"+a.message),p()})})}})},Y=()=>{let e=l();if(e.length==0)return;let t={};e.forEach(a=>{t[a.id]=a.sort}),Z(t).then(a=>{console.log(a),r.getInstance().info("保存成功")})};return W(()=>{H.getInstance().listen("oa-information",()=>{p()})}),(e,t)=>{const a=C("a-button"),j=C("a-input-number");return w(),P(o(O),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:d(()=>[u(o(K),{onRegister:o(I),onResizeColumn:t[0]||(t[0]=(b,y)=>y.width=b),onSelectionChange:E,onRowDbClick:A},{toolbar:d(()=>[u(a,{type:"primary",preIcon:o(f).ADD,onClick:z},{default:d(()=>[m(g("添加"))]),_:1},8,["preIcon"]),u(a,{type:"primary",disabled:o(n)=="",preIcon:o(f).EDIT,onClick:M},{default:d(()=>[m(g("修改"))]),_:1},8,["disabled","preIcon"]),u(a,{class:"red-btn",disabled:o(n)=="",preIcon:o(f).DELETE,onClick:R},{default:d(()=>[m(g("删除"))]),_:1},8,["disabled","preIcon"]),u(a,{type:"primary",preIcon:o(f).EDIT,onClick:Y},{default:d(()=>[m(g("保存排序号"))]),_:1},8,["preIcon"]),u(a,{class:"green-btn",disabled:o(n)=="",preIcon:o(f).ENABLE,onClick:B},{default:d(()=>[m(g("启用"))]),_:1},8,["disabled","preIcon"]),u(a,{class:"grey-btn",disabled:o(n)=="",preIcon:o(f).DISABLE,onClick:F},{default:d(()=>[m(g("禁用"))]),_:1},8,["disabled","preIcon"])]),bodyCell:d(({column:b,record:y})=>[b.dataIndex==="sort"?(w(),P(j,{key:0,value:y[b.dataIndex],"onUpdate:value":N=>y[b.dataIndex]=N,style:{width:"100%","text-align":"right"},min:1},null,8,["value","onUpdate:value"])):$("",!0)]),_:1},8,["onRegister"])]),_:1})}}});export{ke as default};
//# sourceMappingURL=index-8ee1e86f.js.map
