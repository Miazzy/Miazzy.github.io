{"version":3,"file":"detail-3d2c0ebe.js","sources":["../../src/views/baseset/monitor/smartdevices/inspectioninstrument/detail.vue"],"sourcesContent":["<template>\n  <div class=\"load\">\n    <a-spin :spinning=\"detailFormState.spinning\" tip=\"Loading...\">\n      <div class=\"process-box\">\n        <!-- 标题 -->\n        <div class=\"header-box\">\n          <div class=\"header-left\">巡检仪</div>\n          <div v-if=\"!disabledInput\" class=\"header-right\">\n            <a-button @click=\"handleCancel\"> 取消</a-button>\n            <a-button class=\"!ml-4\" type=\"primary\" @click=\"onSave\" :loading=\"isLoading\">\n              保存</a-button\n            >\n          </div>\n        </div>\n\n        <!-- 表单内容 -->\n        <div class=\"content\">\n          <a-form ref=\"formRef\" :model=\"detailFormState\" labelAlign=\"right\" autocomplete=\"off\">\n            <a-card title=\"基本信息\" :bordered=\"false\">\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"assetCode\"\n                    label=\"资产编号\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: false, message: '请输入资产编号' }]\"\n                  >\n                    <a-input disabled v-model:value=\"detailFormState.assetCode\" />\n                  </a-form-item>\n                </a-col>\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"deviceType\"\n                    label=\"智能设备类型\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: true, message: '请输入智能设备类型' }]\"\n                  >\n                    <a-input\n                      v-model:value=\"detailFormState.deviceType\"\n                      placeholder=\"请输入智能设备类型\"\n                      disabled\n                    />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"deviceCode\"\n                    label=\"设备编号\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: true, message: '请输入设备编号' }]\"\n                  >\n                    <a-input\n                      :disabled=\"disabledInput\"\n                      v-model:value=\"detailFormState.deviceCode\"\n                      placeholder=\"请输入设备编号\"\n                      :maxlength=\"100\"\n                    />\n                  </a-form-item>\n                </a-col>\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"brand\"\n                    label=\"品牌\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: true, message: '请输入品牌' }]\"\n                  >\n                    <a-input\n                      v-model:value=\"detailFormState.brand\"\n                      placeholder=\"请输入品牌\"\n                      :disabled=\"disabledInput\"\n                      :maxlength=\"50\"\n                    />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"model\"\n                    label=\"型号\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: true, message: '请输入型号' }]\"\n                  >\n                    <a-input\n                      v-model:value=\"detailFormState.model\"\n                      placeholder=\"请输入型号\"\n                      :disabled=\"disabledInput\"\n                      :maxlength=\"50\"\n                    />\n                  </a-form-item>\n                </a-col>\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"simNumber\"\n                    label=\"SIM卡号\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: true, message: '请输入SIM卡号' }]\"\n                  >\n                    <a-input\n                      :disabled=\"disabledInput\"\n                      v-model:value=\"detailFormState.simNumber\"\n                      placeholder=\"请输入SIM卡号\"\n                      :maxlength=\"50\"\n                    />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"purchaseDate\"\n                    label=\"购买日期\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: true, message: '请选择购买日期' }]\"\n                  >\n                    <a-date-picker\n                      v-model:value=\"detailFormState.purchaseDate\"\n                      format=\"YYYY-MM-DD\"\n                      value-format=\"YYYY-MM-DD 00:00:00\"\n                      style=\"width: 100%\"\n                      :disabled=\"disabledInput\"\n                    />\n                  </a-form-item>\n                </a-col>\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"startDate\"\n                    label=\"启用日期\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: true, message: '请选择启用日期' }]\"\n                  >\n                    <a-date-picker\n                      v-model:value=\"detailFormState.startDate\"\n                      format=\"YYYY-MM-DD\"\n                      value-format=\"YYYY-MM-DD 00:00:00\"\n                      style=\"width: 100%\"\n                      :disabled=\"disabledInput\"\n                    />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"endDate\"\n                    label=\"有效期止\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: true, message: '请选择有效期止' }]\"\n                  >\n                    <a-date-picker\n                      v-model:value=\"detailFormState.endDate\"\n                      format=\"YYYY-MM-DD\"\n                      value-format=\"YYYY-MM-DD 00:00:00\"\n                      style=\"width: 100%\"\n                      :disabled=\"disabledInput\"\n                    />\n                  </a-form-item>\n                </a-col>\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"stationName\"\n                    label=\"电站\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: true, message: '请选择电站' }]\"\n                  >\n                    <a-select\n                      v-model:value=\"detailFormState.stationName\"\n                      allow-clear\n                      show-search\n                      style=\"width: 100%\"\n                      placeholder=\"请选择电站\"\n                      :options=\"stationOptions\"\n                      :disabled=\"disabledInput\"\n                      @change=\"handleChange\"\n                    />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"deviceName\"\n                    label=\"设备名称\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: false, message: '设备名称' }]\"\n                  >\n                    <a-input\n                      :maxlength=\"50\"\n                      :disabled=\"disabledInput\"\n                      placeholder=\"请输入设备名称\"\n                      v-model:value=\"detailFormState.deviceName\"\n                    />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"24\">\n                  <a-form-item\n                    name=\"remark\"\n                    label=\"备注\"\n                    :labelCol=\"{ span: 3 }\"\n                    :rules=\"[{ required: false, message: '备注' }]\"\n                  >\n                    <a-input\n                      :maxlength=\"500\"\n                      :disabled=\"disabledInput\"\n                      v-model:value=\"detailFormState.remark\"\n                    />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n            </a-card>\n\n            <a-card title=\"电站记录\" :bordered=\"false\">\n              <BasicTable @register=\"registerTaskTable\" />\n            </a-card>\n\n            <a-card title=\"附件信息\" :bordered=\"false\">\n              <div class=\"clearfix\" style=\"padding-left: 15px\">\n                <UploadBox\n                  :width=\"800\"\n                  :height=\"550\"\n                  :maxCount=\"20\"\n                  :maxSize=\"100 * 1024 * 1024\"\n                  :application=\"`base`\"\n                  :module=\"`inspectionInstrument`\"\n                  :vmode=\"!disabledInput ? `box` : `view`\"\n                  :bizId=\"detailFormState.bizFileId\"\n                />\n              </div>\n            </a-card>\n          </a-form>\n        </div>\n      </div>\n    </a-spin>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\n  import { reactive, ref, onMounted, unref } from 'vue';\n  import {\n    saveData,\n    getIndex,\n    getDetailList,\n    detailColumns,\n    detailTableProps,\n    getStation,\n  } from './index';\n  import { FormInstance, SelectProps, message } from 'ant-design-vue';\n  import { useRouter } from 'vue-router';\n  import { assign } from 'lodash-es';\n  import BillTitle from '/@/components/Framework/BillTitle/BillTitle.vue';\n  import { BasicTable, useTable } from '/@/components/Table';\n\n  import * as FileApi from '@/api/infra/file';\n  import UploadBox from '@/components/Framework/Combox/UploadBox.vue';\n  import { closeCurrentTab } from '@/utils/route';\n  import { MsgManager } from '/@/message/MsgManager';\n\n  const detailFormState = reactive({ spinning: false });\n  const stationOptions = ref<SelectProps['options']>([]) as any;\n  const isLoading = ref(false);\n  const detailDataSource = ref<any[]>();\n  const disabledInput = ref<boolean>(true);\n  const billTitleOption = reactive<any>({});\n  billTitleOption.title = '巡检仪设置';\n  billTitleOption.infoItems = [];\n  const router = useRouter();\n  const { currentRoute } = router;\n  const route = unref(currentRoute);\n  const query = route.query;\n\n  function initStationOptions() {\n    getStation({}).then((res) => {\n      if (res.result && res.result.length > 0) {\n        res.result.forEach((item) => {\n          stationOptions.value.push({ value: item.powerStationName, lable: item.id });\n        });\n      }\n    });\n  }\n\n  function handleChange(value: string, option) {\n    detailFormState.stationId = option.lable;\n  }\n\n  const formRef = ref<FormInstance>();\n\n  // 取消按钮\n  function handleCancel() {\n    closeCurrentTab();\n  }\n\n  function onSave() {\n    detailFormState.spinning = true;\n    try {\n      formRef.value.validateFields().then(() => {\n        saveData(detailFormState).then((data) => {\n          detailFormState.id = data;\n          getIndex({ id: data }).then((data) => {\n            assign(detailFormState, data.result);\n            initTableData();\n          });\n          message.success('保存成功');\n          MsgManager.getInstance().sendMsg('inspectionInstrument', {});\n        });\n      });\n    } catch (error) {\n      console.log('error', error);\n    } finally {\n      detailFormState.spinning = false;\n    }\n  }\n\n  const [registerTaskTable, { reload }] = useTable(\n    assign(\n      {\n        dataSource: detailDataSource,\n        columns: detailColumns,\n      },\n      detailTableProps,\n    ),\n  );\n\n  const initTableData = async () => {\n    detailDataSource.value = await getTaskData({});\n  };\n\n  const getTaskData = async (paramObj) => {\n    const param = await getDetailQueryParam(paramObj);\n    const dataObj = await getDetailList(param);\n\n    return dataObj.result;\n  };\n\n  const getDetailQueryParam = async (paramObj) => {\n    const id = await getBizParamId();\n    return { inspectionInstrumentId: paramObj.inspectionInstrumentId ? paramObj.id : id + '' };\n  };\n\n  onMounted(async () => {\n    query.id = await getBizParamId();\n    if (query.id) {\n      await getIndex({ id: query.id }).then((data) => {\n        assign(detailFormState, data.result);\n      });\n    } else {\n      assign(detailFormState, query);\n      detailFormState.spinning = false;\n      detailFormState.status = 1;\n    }\n    disabledInput.value = query.disabledInput == 'false' ? false : true;\n\n    await getRecordable();\n    initTableData();\n    initStationOptions();\n\n    if (\n      detailFormState.bizFileId == null ||\n      detailFormState.bizFileId == undefined ||\n      detailFormState.bizFileId == ''\n    ) {\n      getBizFileId();\n    }\n  });\n\n  const getBizParamId = async () => {\n    let id = query.id;\n    if (!id && detailFormState.id) {\n      query.id = detailFormState.id;\n      id = detailFormState.id;\n    }\n    return id;\n  };\n\n  const getRecordable = async () => {\n    billTitleOption.title = '巡检仪设置';\n  };\n\n  //==================================附件资料  begin ==================================\n\n  const getBizFileId = async () => {\n    FileApi.getBizId().then((res) => {\n      detailFormState.bizFileId = res;\n    });\n  };\n\n  //==================================附件资料  end ==================================\n</script>\n<style lang=\"less\" scoped>\n  .bill-title-box {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    width: 100%;\n\n    .bill-title {\n      font-size: 16px;\n    }\n  }\n</style>\n"],"names":["detailFormState","reactive","stationOptions","ref","isLoading","detailDataSource","disabledInput","billTitleOption","router","useRouter","currentRoute","query","unref","initStationOptions","getStation","res","item","handleChange","value","option","formRef","handleCancel","closeCurrentTab","onSave","saveData","data","getIndex","assign","initTableData","message","MsgManager","error","registerTaskTable","reload","useTable","detailColumns","detailTableProps","__async","getTaskData","paramObj","param","getDetailQueryParam","getDetailList","id","getBizParamId","onMounted","getRecordable","getBizFileId","FileApi.getBizId"],"mappings":"ylDAyQE,MAAMA,EAAkBC,EAAS,CAAE,SAAU,EAAO,CAAA,EAC9CC,EAAiBC,EAA4B,CAAA,CAAE,EAC/CC,EAAYD,EAAI,EAAK,EACrBE,EAAmBF,IACnBG,EAAgBH,EAAa,EAAI,EACjCI,EAAkBN,EAAc,CAAA,CAAE,EACxCM,EAAgB,MAAQ,QACxBA,EAAgB,UAAY,GAC5B,MAAMC,EAASC,IACT,CAAE,aAAAC,CAAiB,EAAAF,EAEnBG,EADQC,EAAMF,CAAY,EACZ,MAEpB,SAASG,GAAqB,CAC5BC,GAAW,CAAE,CAAA,EAAE,KAAMC,GAAQ,CACvBA,EAAI,QAAUA,EAAI,OAAO,OAAS,GAChCA,EAAA,OAAO,QAASC,GAAS,CACZd,EAAA,MAAM,KAAK,CAAE,MAAOc,EAAK,iBAAkB,MAAOA,EAAK,EAAA,CAAI,CAAA,CAC3E,CACH,CACD,CACH,CAES,SAAAC,EAAaC,EAAeC,EAAQ,CAC3CnB,EAAgB,UAAYmB,EAAO,KACrC,CAEA,MAAMC,EAAUjB,IAGhB,SAASkB,GAAe,CACNC,IAClB,CAEA,SAASC,GAAS,CAChBvB,EAAgB,SAAW,GACvB,GAAA,CACFoB,EAAQ,MAAM,eAAiB,EAAA,KAAK,IAAM,CACxCI,GAASxB,CAAe,EAAE,KAAMyB,GAAS,CACvCzB,EAAgB,GAAKyB,EACrBC,EAAS,CAAE,GAAID,CAAM,CAAA,EAAE,KAAMA,GAAS,CAC7BE,EAAA3B,EAAiByB,EAAK,MAAM,EACrBG,GAAA,CACf,EACDC,GAAQ,QAAQ,MAAM,EACtBC,GAAW,YAAY,EAAE,QAAQ,uBAAwB,CAAE,CAAA,CAAA,CAC5D,CAAA,CACF,QACMC,EAAO,CACN,QAAA,IAAI,QAASA,CAAK,CAAA,QAC1B,CACA/B,EAAgB,SAAW,EAC7B,CACF,CAEA,KAAM,CAACgC,EAAmB,CAAE,OAAAC,EAAA,CAAQ,EAAIC,GACtCP,EACE,CACE,WAAYtB,EACZ,QAAS8B,EACX,EACAC,EACF,CAAA,EAGIR,EAAgB,IAAYS,EAAA,sBAChChC,EAAiB,MAAQ,MAAMiC,EAAY,CAAE,CAAA,CAAA,GAGzCA,EAAqBC,GAAaF,EAAA,sBAChC,MAAAG,EAAQ,MAAMC,EAAoBF,CAAQ,EAGhD,OAFgB,MAAMG,GAAcF,CAAK,GAE1B,MAAA,GAGXC,EAA6BF,GAAaF,EAAA,sBACxC,MAAAM,EAAK,MAAMC,IACjB,MAAO,CAAE,uBAAwBL,EAAS,uBAAyBA,EAAS,GAAKI,EAAK,GAAG,GAG3FE,EAAU,IAAYR,EAAA,sBACd1B,EAAA,GAAK,MAAMiC,IACbjC,EAAM,GACF,MAAAe,EAAS,CAAE,GAAIf,EAAM,GAAI,EAAE,KAAMc,GAAS,CACvCE,EAAA3B,EAAiByB,EAAK,MAAM,CAAA,CACpC,GAEDE,EAAO3B,EAAiBW,CAAK,EAC7BX,EAAgB,SAAW,GAC3BA,EAAgB,OAAS,GAE3BM,EAAc,MAAQK,EAAM,eAAiB,QAE7C,MAAMmC,EAAc,EACNlB,IACKf,KAGjBb,EAAgB,WAAa,MAC7BA,EAAgB,WAAa,MAC7BA,EAAgB,WAAa,KAEhB+C,GACf,EACD,EAED,MAAMH,EAAgB,IAAYP,EAAA,sBAChC,IAAIM,EAAKhC,EAAM,GACX,MAAA,CAACgC,GAAM3C,EAAgB,KACzBW,EAAM,GAAKX,EAAgB,GAC3B2C,EAAK3C,EAAgB,IAEhB2C,CAAA,GAGHG,EAAgB,IAAYT,EAAA,sBAChC9B,EAAgB,MAAQ,OAAA,GAKpBwC,EAAe,IAAYV,EAAA,sBAC/BW,GAAiB,EAAE,KAAMjC,GAAQ,CAC/Bf,EAAgB,UAAYe,CAAA,CAC7B,CAAA"}