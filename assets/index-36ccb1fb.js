var b=(N,c,f)=>new Promise((w,T)=>{var p=t=>{try{v(f.next(t))}catch(I){T(I)}},o=t=>{try{v(f.throw(t))}catch(I){T(I)}},v=t=>t.done?w(t.value):Promise.resolve(t.value).then(p,o);v((f=f.apply(N,c)).next())});import{d as ye,k,r as L,o as be,al as _,x as _e,Z as x,a9 as P,aa as n,f as l,$ as O,E as g,ad as D,u as m,_ as S,F as U,v as M,A as V,ac as A,J as $}from"./vue-71d1abb3.js";import{b as xe,au as we,a7 as Ie,av as C,ax as F,at as B,a5 as he,bX as Ce,_ as Ne}from"./index.js";import{B as Te}from"./BasicTable-0434a334.js";import{a as ke}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as De}from"./useTable-109483b3.js";import{bB as Se,bC as Ee,a2 as E}from"./antd-15ac76ed.js";import{P as qe}from"./index-20519caf.js";import{C as ze}from"./CommonTree-c4ed7838.js";import{_ as Oe}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{e as Fe}from"./download-03e71dd5.js";import{u as H,d as Be,e as Re,g as Ue}from"./index-04498ccb.js";import{g as Me}from"./index-5d738211.js";import"./index-316f6ffb.js";import{u as Ae}from"./useRender-21ce56fb.js";import{a as Le}from"./assign-37f1c13d.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";const Pe=[{title:"电站",dataIndex:"stationName",width:160,sorter:!0,resizable:!0},{title:"期数",dataIndex:"periodName",width:160,sorter:!0,resizable:!0},{title:"设备编码",dataIndex:"code",width:160,sorter:!0,resizable:!0},{title:"区域子阵",dataIndex:"subarrayName",width:160,sorter:!0,resizable:!0},{title:"设备名称",dataIndex:"name",width:160,sorter:!0,resizable:!0},{title:"物料全称",dataIndex:"materialWholeName",width:160,sorter:!0,resizable:!0},{title:"生产厂家",dataIndex:"factoryName",width:160,sorter:!0,resizable:!0},{title:"供应商",dataIndex:"supplierName",width:160,sorter:!0,resizable:!0},{title:"数量",dataIndex:"qty",width:160,sorter:!0,resizable:!0},{title:"计量单位",dataIndex:"unitId",width:160,sorter:!0,resizable:!0},{title:"关联设备",dataIndex:"deviceCode",width:200,sorter:!0,resizable:!0,customRender:({text:N,record:c})=>{let f=`/baseset/monitor/device?deviceEsn=${c.deviceCode}`;return Ae.renderIframeLink(f,N,null,N)}},{title:"投运日期",dataIndex:"usedDate",width:160,sorter:!0,resizable:!0},{title:"状态",dataIndex:"status",width:160,sorter:!0,resizable:!0}],Ve={class:"right-table-layout tab-model"},$e={class:"tab-button-div"},He={class:"tab-table-div"},Ye={key:0,style:{color:"#19be6b"}},je={key:1,style:{color:"red"}},Ke="/baseset/material-category/getTreeData",We=ye({name:"Equipment",__name:"index",setup(N){const{t:c}=xe(),{createConfirm:f,createMessage:w}=we(),T=k([]),p=k({}),o=k([]),v=k(!1),t=L({code:"",name:"",supplierName:"",factoryName:"",rangeData:null,status:"",materialTypeCodes:[],materialCategoryNames:[]}),I=k([]),Y=()=>he.get({url:Ke},{});function j(){return b(this,null,function*(){const e=yield Y();I.value=e.result})}const K=()=>{h()},W=()=>{t.code="",t.name="",t.supplierName="",t.factoryName="",t.rangeData=null,t.status="",t.materialTypeCodes=[],t.materialCategoryNames=[]},X=(e,a)=>{let s=a.selectedNodes,u=[],i=[];if(Array.isArray(s)&&(s.forEach(d=>{i.push(d.name),u.push(d.id)}),i.length>0)){let d=i.join(","),y=u.join(",");t.materialTypeCodes=y,t.materialCategoryNames=d}},R=L({}),q=()=>o.value.length==0,[J,{getForm:Z,reload:h,redoHeight:G,getSelectRows:Q}]=De({title:"设备物资台账",api:Ue,columns:Pe,useSearchForm:!1,bordered:!0,rowKey:"id",rowSelection:{type:"checkbox",selectedRowKeys:o,onSelect:ee,onSelectAll:te},beforeFetch(e){return e.stationOrganId=p.value.stationOrganId,e.stationId=p.value.stationId,e.periodId=p.value.periodId,e.code=t.code,e.name=t.name,e.supplierName=t.supplierName,e.factoryName=t.factoryName,e.status=t.status,e.materialTypeCode=t.materialTypeCodes.join(","),t.rangeData!=null&&(e.startDate=t.rangeData[0],e.endDate=t.rangeData[1]),Le(e,R),o.value.splice(0,o.value.length),e},sortFn:e=>{var s;const a=(s=e.order)==null?void 0:s.replace("end","");R.sortOrder=a,R.sortField=a?Ce(e.field):void 0},showTableSetting:!0,tableSetting:{fullScreen:!0},showIndexColumn:!0});function ee(e,a){a?o.value=[...o.value,e.id]:o.value=o.value.filter(s=>s!==e.id)}function te(e,a,s){const u=s.map(i=>i.id);e?o.value=[...o.value,...u]:o.value=o.value.filter(i=>!u.includes(i))}function ae(){return o.value.length==0||o.value.length>1||!o.value[0]?(E.warning("请选择一行数据"),!1):!0}const le=()=>{if(o.value.length==0){E.warning("请选择数据。");return}f({title:"确认操作",iconType:"warning",content:"确定要启用选中数据吗？",onOk(){return b(this,null,function*(){yield H(o.value,1),h(),w.success("操作成功。")})}})},ne=()=>{if(o.value.length==0){E.warning("请选择数据。");return}f({title:"确认操作",iconType:"warning",content:"确定要禁用选中数据吗？",onOk(){return b(this,null,function*(){yield H(o.value,0),h(),w.success("操作成功。")})}})};function oe(){if(p.value.periodId==null||p.value.periodId==""){E.warning("请选择电站分期。");return}const e=$(p.value);F("/po/equipment/create","添加物资",e)}function re(){if(!ae())return;const e=o.value[0];F("/po/equipment/create","修改物资",{id:e})}function se(){let e=Q();if(e.length!==1)return B.getInstance().warning("请选择一条数据。"),!1;let a=e[0];if(a.status==0)return B.getInstance().warning("该设备物资已禁用,不能拆分。"),!1;let s=a.qty;if(s<=1)return B.getInstance().warning("该设备物资数量为"+s+",不能进行拆分。"),!1;if(!/^\d+$/.test(s))return B.getInstance().warning("该设备物资数量不是正整数，不能进行拆分。"),!1;F("/po/equipment/split","物资拆分",{id:a.id})}function ie(){if(o.value.length==0){E.warning("请选择数据。");return}f({title:c("common.message.confirmTitle"),iconType:"warning",content:c("common.message.delMessage"),onOk(){return b(this,null,function*(){yield Be(o.value),h(),o.value.splice(0,o.value.length),w.success(c("common.delSuccessText"))})}})}function ue(e){const a=$(e);F("/po/equipment/create","查看物资",{id:a.id,page_readonly:"true"})}function de(){return b(this,null,function*(){f({title:c("common.exportTitle"),iconType:"warning",content:c("common.exportMessage"),onOk(){return b(this,null,function*(){yield Re(Z().getFieldsValue()).then(a=>{Fe(a==null?void 0:a.data,"设备物资台账.xls")}),w.success(c("common.exportSuccessText"))})}})})}function me(e={}){var a,s,u,i,d,y;p.value.stationOrganId=(a=e==null?void 0:e.organId)!=null?a:"",p.value.stationOrganName=(s=e==null?void 0:e.organName)!=null?s:"",p.value.stationId=(u=e==null?void 0:e.powerStationId)!=null?u:"",p.value.stationName=(i=e==null?void 0:e.powerStationName)!=null?i:"",p.value.periodId=(d=e==null?void 0:e.powerStationPeriodId)!=null?d:"",p.value.periodName=(y=e==null?void 0:e.powerStationPeriodName)!=null?y:"",h()}function ce(){return b(this,null,function*(){const e=yield Me();T.value=e})}const pe=()=>{v.value=!v.value,setTimeout(G,300)};return be(()=>{ce(),j(),Ie.getInstance().listen("equipment-page",h)}),(e,a)=>{const s=_("a-input"),u=_("a-form-item"),i=_("a-col"),d=_("a-button"),y=_("a-row"),fe=_("a-range-picker"),ge=_("a-form"),ve=_e("auth");return x(),P(m(qe),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:n(()=>[l(ze,{title:"电站组织",onSelect:me,value:T.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),O("div",Ve,[O("div",$e,[l(ge,{model:t,autocomplete:"off"},{default:n(()=>[l(y,{gutter:32},{default:n(()=>[l(i,{flex:"27.5%"},{default:n(()=>[l(u,{name:"code",label:"设备编码",colon:!1,labelCol:{style:{width:"120px"}}},{default:n(()=>[l(s,{value:t.code,"onUpdate:value":a[0]||(a[0]=r=>t.code=r),maxlength:"64"},null,8,["value"])]),_:1})]),_:1}),l(i,{flex:"27.5%"},{default:n(()=>[l(u,{name:"name",label:"设备名称",colon:!1,labelCol:{style:{width:"120px"}}},{default:n(()=>[l(s,{value:t.name,"onUpdate:value":a[1]||(a[1]=r=>t.name=r),maxlength:"64"},null,8,["value"])]),_:1})]),_:1}),l(i,{flex:"27.5%"},{default:n(()=>[l(u,{name:"supplierName",label:"供应商",colon:!1,labelCol:{style:{width:"120px"}}},{default:n(()=>[l(s,{value:t.supplierName,"onUpdate:value":a[2]||(a[2]=r=>t.supplierName=r),maxlength:"64"},null,8,["value"])]),_:1})]),_:1}),l(i,{flex:"17.5%"},{default:n(()=>[l(u,{style:{"text-align":"right"}},{default:n(()=>[l(d,{class:"tab-button",onClick:W},{default:n(()=>[g(D(m(c)("common.resetText")),1)]),_:1}),l(d,{type:"primary",class:"tab-button",onClick:K},{default:n(()=>[g(D(m(c)("common.queryText")),1)]),_:1}),O("a",{style:{"font-size":"12px"},onClick:pe},[v.value?(x(),S(U,{key:0},[g(" 收起 "),l(m(Se))],64)):(x(),S(U,{key:1},[g(" 展开 "),l(m(Ee))],64))])]),_:1})]),_:1})]),_:1}),M(l(y,{gutter:32},{default:n(()=>[l(i,{flex:"27.5%"},{default:n(()=>[l(u,{name:"factoryName",label:"生产厂家",colon:!1,labelCol:{style:{width:"120px"}}},{default:n(()=>[l(s,{value:t.factoryName,"onUpdate:value":a[3]||(a[3]=r=>t.factoryName=r),maxlength:"64"},null,8,["value"])]),_:1})]),_:1}),l(i,{flex:"27.5%"},{default:n(()=>[l(u,{label:"投运日期",name:"rangeData",labelCol:{style:{width:"120px"}},colon:!1},{default:n(()=>[l(fe,{value:t.rangeData,"onUpdate:value":a[4]||(a[4]=r=>t.rangeData=r),"value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),l(i,{flex:"27.5%"},{default:n(()=>[l(u,{name:"status",label:"状态",labelCol:{style:{width:"120px"}},colon:!1},{default:n(()=>[l(Oe,{type:"enable_or_disable",onChange:a[5]||(a[5]=r=>"()=> seachFormState.status = value"),value:t.status,"onUpdate:value":a[6]||(a[6]=r=>t.status=r),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[V,v.value]]),M(l(y,{gutter:32},{default:n(()=>[l(i,{flex:"27.5%"},{default:n(()=>[l(u,{label:"物料类别",name:"materialCategoryNames",labelCol:{style:{width:"120px"}},colon:!1},{default:n(()=>[l(ke,{value:t.materialCategoryNames,"onUpdate:value":a[7]||(a[7]=r=>t.materialCategoryNames=r),skeys:t.materialTypeCodes,"onUpdate:skeys":a[8]||(a[8]=r=>t.materialTypeCodes=r),multiple:!0,tfields:{key:"code",title:"name",children:"children"},data:I.value,onSelect:X},null,8,["value","skeys","data"])]),_:1})]),_:1})]),_:1},512),[[V,v.value]])]),_:1},8,["model"])]),O("div",He,[l(m(Te),{class:"fix-basic-table",onRegister:m(J),onResizeColumn:a[9]||(a[9]=(r,z)=>z.width=r),onRowDbClick:a[10]||(a[10]=r=>ue(r))},{toolbar:n(()=>[l(d,{type:"primary",preIcon:m(C).ADD,onClick:oe},{default:n(()=>[g(D(m(c)("common.action.create")),1)]),_:1},8,["preIcon"]),l(d,{type:"primary",disabled:q(),preIcon:m(C).EDIT,onClick:re},{default:n(()=>[g(D(m(c)("common.action.edit")),1)]),_:1},8,["disabled","preIcon"]),M((x(),P(d,{type:"primary",onClick:se},{default:n(()=>[g(" 拆分 ")]),_:1})),[[ve,"po:equipment:index:split"]]),l(d,{class:"red-btn",disabled:q(),preIcon:m(C).DELETE,onClick:ie},{default:n(()=>[g(D(m(c)("common.delText")),1)]),_:1},8,["disabled","preIcon"]),l(d,{class:"green-btn",disabled:q(),preIcon:m(C).ENABLE,onClick:le},{default:n(()=>[g(" 启用 ")]),_:1},8,["disabled","preIcon"]),l(d,{class:"grey-btn",disabled:q(),preIcon:m(C).DISABLE,onClick:ne},{default:n(()=>[g(" 禁用 ")]),_:1},8,["disabled","preIcon"]),l(d,{class:"yellow-btn",preIcon:m(C).EXPORT,onClick:de},{default:n(()=>[g(" 导出 ")]),_:1},8,["preIcon"])]),bodyCell:n(({column:r,text:z})=>[r.dataIndex==="status"?(x(),S(U,{key:0},[z==1?(x(),S("span",Ye,"启用")):A("",!0),z==0?(x(),S("span",je,"禁用")):A("",!0)],64)):A("",!0)]),_:1},8,["onRegister"])])])]),_:1})}}});const Tt=Ne(We,[["__scopeId","data-v-6af314fa"]]);export{Tt as default};
//# sourceMappingURL=index-36ccb1fb.js.map
