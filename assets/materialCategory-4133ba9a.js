var D=(s,w,c)=>new Promise((b,v)=>{var i=o=>{try{e(c.next(o))}catch(_){v(_)}},d=o=>{try{e(c.throw(o))}catch(_){v(_)}},e=o=>o.done?b(o.value):Promise.resolve(o.value).then(i,d);e((c=c.apply(s,w)).next())});import{d as B,k as g,r as E,o as R,al as C,Z as M,_ as O,f as r,aa as p,v as H,A as P,F as V}from"./vue-71d1abb3.js";import{C as Z}from"./CommonTree-c4ed7838.js";import{D as j}from"./Dialog-0a006d82.js";import{a5 as N,_ as z}from"./index.js";import{a2 as f}from"./antd-15ac76ed.js";import"./index-3801a970.js";const G=s=>N.get({url:"/baseset/material-category/getTreeData",params:s},{}),J=s=>N.post({url:"/baseset/material-category/create",params:s},{}),K=s=>N.put({url:"/baseset/material-category/update",params:s},{}),L=s=>N.delete({url:"/baseset/material-category/delete",params:s},{}),Q=B({__name:"materialCategory",emits:["select-tree"],setup(s,{emit:w}){const c=g([]),b=g(!0),v=g({}),i=g([]),d=g(!1),e=E({parentId:"",parentName:"",parentCode:"",name:"",code:"",id:""}),o=g(),_=()=>D(this,null,function*(){let a={};i.value=yield G(a);let t=i.value.result.filter(l=>{let n=i.value.result.filter(m=>l.id==m.parentId&&l.id!="");return n.length>0&&(l.children=n),l.parentId==""});c.value=t});function y(){_()}const I=()=>{e.parentId="",e.parentName="",e.parentCode="",e.name="",e.code="",e.id=""};function A(a){I(),a&&(e.parentId=a.id,e.parentCode=a.code,e.parentName=a.name,e.id=""),b.value=a&&a.id!="",d.value=!0}function F(a){if(a){if(k(a)){f.info("有子节点,不能删除");return}L("?id="+a.id).then(()=>{f.success("已删除。"),y()})}}function S(a){if(I(),a){let t=T(a.parentId,i.value.result)||{},l={id:t.id||"",code:t.code||"",name:t.name||""};e.parentId=l.id,e.parentCode=l.code,e.parentName=l.name,e.name=a.name,e.code=a.code,e.id=a.id,b.value=l&&l.id!=""}else return f.info("请选择节点"),!1;d.value=!0}function T(a,t){var l;for(let n=0;n<t.length;n++){let m=t[n];if(m.id==a)return m;if(((l=m.children)==null?void 0:l.length)>0){let h=T(a,m.children);if(h!=null)return h}}return null}const x=()=>D(this,null,function*(){let a=o.value;a!=null&&a.validateFields().then(()=>D(this,null,function*(){e.id==""?(yield J(e)).code==0?(f.success("创建成功"),y(),d.value=!1):f.error("创建失败"):(yield K(e)).code==0?(f.success("更新成功"),y(),d.value=!1):f.error("更新失败")}))});function U(a={}){a?(v.value=a,v.value.hasChildren=k(a)):(v.value={},e.parentId="",e.parentCode="",e.parentName="",e.name="",e.id=""),w("select-tree",a)}function k(a){for(let t=0;t<i.value.result.length;t++)if(i.value.result[t].parentId==a.id)return!0;return!1}return R(()=>{_()}),(a,t)=>{const l=C("a-input"),n=C("a-form-item"),m=C("a-col"),h=C("a-row"),q=C("a-form");return M(),O(V,null,[r(Z,{title:"物料分类",onSelect:U,value:c.value,onRefresh:y,onAdd:A,onEdit:S,onDelete:F,isShowOperationBtns:!0,class:"left-tree-layout",fieldNames:{key:"id",title:"name"}},null,8,["value"]),r(j,{visible:d.value,"onUpdate:visible":t[4]||(t[4]=u=>d.value=u),title:"添加物料类别",onOk:x,width:600,height:350},{default:p(()=>[r(q,{ref_key:"modalFormRef",ref:o,model:e,name:"categoryForm"},{default:p(()=>[r(h,{gutter:32},{default:p(()=>[H(r(m,{span:24},{default:p(()=>[r(n,{label:"所属类型",name:"parentName",labelCol:{span:5},wrapperCol:15,rules:[{required:!1,message:"请选择编码范围"}]},{default:p(()=>[r(l,{value:e.parentName,"onUpdate:value":t[0]||(t[0]=u=>e.parentName=u),disabled:""},null,8,["value"])]),_:1}),r(n,{label:"所属类型编码",name:"parentCode",labelCol:{span:5},rules:[{required:!1,message:"请选择编码范围"}]},{default:p(()=>[r(l,{value:e.parentCode,"onUpdate:value":t[1]||(t[1]=u=>e.parentCode=u),disabled:""},null,8,["value"])]),_:1}),r(n,{label:"物料类型",name:"name",labelCol:{span:5},rules:[{required:!0,message:"请选择编码范围"}]},{default:p(()=>[r(l,{value:e.name,"onUpdate:value":t[2]||(t[2]=u=>e.name=u)},null,8,["value"])]),_:1}),r(n,{label:"物料类型编码",name:"name",labelCol:{span:5},rules:[{required:!1,message:""}]},{default:p(()=>[r(l,{value:e.code,"onUpdate:value":t[3]||(t[3]=u=>e.code=u),disabled:""},null,8,["value"])]),_:1})]),_:1},512),[[P,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])],64)}}});const le=z(Q,[["__scopeId","data-v-51f25632"]]);export{le as default};
//# sourceMappingURL=materialCategory-4133ba9a.js.map
