{"version":3,"file":"SysCommonTree-90bc100f.js","sources":["../../src/views/system/configuration/commontree/index.ts","../../src/views/system/configuration/commontree/SysCommonTree.vue"],"sourcesContent":["import { defHttp } from '/@/utils/http/axios';\nimport { reactive } from 'vue';\n\nenum Api {\n  getTreeTypeUrl = '/system/common-tree/getTree',\n  getTypeUrl = '/system/common-tree/get',\n  createTypeUrl = '/system/common-tree/create',\n  updateTypeUrl = '/system/common-tree/update',\n  deleteTypeUrl = '/system/common-tree/delete',\n}\n\n// 组织树数据\nexport const getTreeData = (params) =>\n  defHttp.get(\n    {\n      url: Api.getTreeTypeUrl,\n      params,\n    },\n    {},\n  );\n\n// 获取系统参数分类\nexport const getType = (params) =>\n  defHttp.get(\n    {\n      url: Api.getTypeUrl,\n      params,\n    },\n    {},\n  );\n\n// 新增系统参数分类\nexport const insertType = (params) =>\n  defHttp.post(\n    {\n      url: Api.createTypeUrl,\n      params,\n    },\n    {},\n  );\n\n// 修改系统参数分类\nexport const updateType = (params) =>\n  defHttp.put(\n    {\n      url: Api.updateTypeUrl,\n      params,\n    },\n    {},\n  );\n\nexport const saveType = (params) => {\n  if (!params.id) {\n    return insertType(params);\n  }\n  return updateType(params);\n};\n\n// 删除系统参数分类\nexport const deleteType = (params) =>\n  defHttp.delete(\n    {\n      url: Api.deleteTypeUrl,\n      params,\n    },\n    {},\n  );\n","<template>\n  <!-- 系统参数分类树 -->\n  <CommonTree\n    :treeType=\"treeType\"\n    :title=\"title\"\n    :toolbar=\"toolbar\"\n    :search=\"search\"\n    :class=\"treeClass\"\n    ref=\"treeRef\"\n    style=\"font-size: 1px\"\n    @select=\"handleSelect\"\n    :value=\"treeData\"\n    :isShowOperationBtns=\"true\"\n    :fieldNames=\"{ key: 'id', title: 'name' }\"\n    @add=\"handleTreeAdd\"\n    @edit=\"handleTreeEdit\"\n    @delete=\"handleTreeDelete\"\n    @refresh=\"handleTreeRefresh\"\n    @after-save=\"afterSave\"\n  />\n\n  <!-- 系统参数分类弹窗 -->\n  <Dialog\n    v-model:visible=\"modal.open.type\"\n    :title=\"modal.title.type\"\n    :maskClosable=\"false\"\n    @ok=\"handleSuccess\"\n    @cancel=\"cancel\"\n    :height=\"350\"\n    :width=\"600\"\n  >\n    <a-form ref=\"modalFormRef\" :model=\"formState\" name=\"userForm\">\n      <a-row :gutter=\"24\">\n        <a-col v-show=\"true\" :span=\"23\">\n          <a-form-item\n            label=\"类型名称\"\n            name=\"name\"\n            :labelCol=\"{ span: 6 }\"\n            :rules=\"[{ required: true, max: 30 }]\"\n          >\n            <a-input\n              v-model:value=\"formState.name\"\n              :maxlength=\"30\"\n              :disabled=\"disabledType\"\n              style=\"margin-top: 10px\"\n            />\n          </a-form-item>\n        </a-col>\n        <a-col v-show=\"true\" :span=\"23\">\n          <a-form-item\n            label=\"备注\"\n            name=\"remark\"\n            :labelCol=\"{ span: 6 }\"\n            :rules=\"[{ required: false, max: 250 }]\"\n          >\n            <a-textarea\n              v-model:value=\"formState.remark\"\n              :maxlength=\"250\"\n              :disabled=\"disabledType\"\n              :rows=\"5\"\n            />\n          </a-form-item>\n        </a-col>\n      </a-row>\n    </a-form>\n  </Dialog>\n</template>\n<script lang=\"ts\" setup>\n  import { onMounted, reactive, ref, watch } from 'vue';\n  import { TreeItem } from '/@/components/Tree';\n  import CommonTree from '@/components/Framework/Tree/CommonTree.vue';\n  import { message, FormInstance } from 'ant-design-vue';\n  import { getTreeData, getType, saveType, deleteType } from './index';\n  import { assign } from 'lodash-es';\n  import { trim } from 'xe-utils';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { useMessage } from '@/hooks/web/useMessage';\n  import { bool } from 'vue-types';\n  import Dialog from '@/components/Framework/Modal/Dialog.vue';\n\n  const props = defineProps({\n    treeType: { type: String }, // 树类型\n    title: { type: String }, // 树标题\n    toolbar: { type: Boolean },\n    search: { type: Boolean },\n    treeClass: { type: String },\n    beforeDelete: { type: Function, default: () => true },\n  });\n  const emit = defineEmits(['select', 'afterSave']);\n\n  const { t } = useI18n();\n  const { createConfirm } = useMessage();\n  // 左侧树数据\n  const treeData = ref<TreeItem[]>([]);\n  const modal = reactive({\n    open: {\n      type: ref<boolean>(false),\n      index: ref<boolean>(false),\n    },\n    title: {\n      type: ref<string>(''),\n      index: ref<string>(''),\n    },\n  });\n  const loadingFlag = ref<boolean>(false);\n  const disabledType = ref<boolean>(false);\n  const formState = reactive({\n    id: '',\n    name: '',\n    fullId: '',\n    remark: '',\n    fullName: '',\n    parentId: '',\n    checkItem: '',\n    description: '',\n    parentName: '',\n    parentFullId: '',\n    parentFullName: '',\n    kindId: '',\n    readOnly: false,\n  });\n\n  const treeRef = ref();\n  const modalFormRef = ref<FormInstance>();\n  const modalIndexFormRef = ref<FormInstance>();\n\n  // 查询左侧树数据\n  async function queryTreeList() {\n    const typeList = await getTreeData({ treeType: props.treeType });\n    treeData.value = typeList.result as unknown[] as TreeItem[];\n  }\n\n  // 新增树节点的的回调\n  function handleTreeAdd(node) {\n    formState.id = '';\n    formState.parentId = 'root';\n    formState.fullId = '';\n    formState.parentName = '';\n    formState.parentFullName = '';\n    formState.name = '';\n    formState.remark = '';\n    if (node) {\n      formState.parentId = node.id;\n      formState.parentName = node.name;\n      formState.fullId = node.fullId;\n      formState.parentFullName = node.fullName;\n      formState.kindId = node.kindId;\n      // if (node.fullId && node.fullId.split('/').length > 4) {\n      //   message.error('最多允许新增4个层级');\n      //   return;\n      // }\n    } else {\n      message.error('请选择要添加的节点。');\n      return;\n    }\n    const operateText = getOperateText(formState);\n    if (!isEditTree(node, operateText)) {\n      return;\n    }\n    modal.open.type = true;\n    modal.title.type = operateText + props.title;\n  }\n\n  function isSelectNode(node) {\n    if (!node) {\n      message.error('请选择' + props.title + '节点');\n      return false;\n    }\n    return true;\n  }\n\n  // 修改树节点的的回调\n  function handleTreeEdit(node) {\n    if (!isSelectNode(node)) {\n      return;\n    }\n    const operateText = getOperateText({ id: node.id });\n    if (node.parentId === 'root') {\n      message.error(`父节点，不能${operateText}`);\n      return;\n    }\n    if (node.children.length > 0) {\n      message.error(`该` + props.title + `存在子节点，不能${operateText}`);\n      return;\n    }\n    if (!isEditTree(node, operateText)) {\n      return;\n    }\n    getType({ id: node.id }).then((data) => {\n      assign(formState, data.result);\n    });\n    modal.open.type = true;\n    modal.title.type = operateText + props.title;\n  }\n  function isEditTree(node, operateText) {\n    if (!node) {\n      return true;\n    }\n    // if (node.children.length == 0 && node.fullId) {\n    //   message.error('该系统参数分类存在系统参数，不能' + operateText);\n    //   return false;\n    // }\n    return true;\n  }\n\n  // 保存后事件\n  function afterSave(node) {\n    emit('afterSave', node);\n  }\n\n  // 删除树节点的回调\n  const handleTreeDelete = async (node) => {\n    if (!isSelectNode(node)) {\n      return;\n    }\n\n    if (node.children.length > 0) {\n      message.error('该' + props.title + '存在子节点，不能删除');\n      return false;\n    }\n\n    let beforeDeleteRes = true;\n    if (props.beforeDelete) {\n      beforeDeleteRes = await props.beforeDelete(node);\n    }\n\n    if (beforeDeleteRes) {\n      deleteConfirm(function () {\n        deleteType('?id=' + node.id).then(() => {\n          handleTreeRefresh();\n        });\n      });\n    }\n  };\n\n  function deleteConfirm(callback: Function) {\n    createConfirm({\n      title: t('common.message.confirmTitle'),\n      iconType: 'warning',\n      content: t('common.message.delMessage'),\n      async onOk() {\n        await callback();\n        message.success(t('common.delSuccessText'));\n      },\n    });\n  }\n  // 刷新树的回调\n  function handleTreeRefresh() {\n    queryTreeList();\n  }\n\n  // 数据创建成功回调函数\n  function handleSuccess() {\n    let value = modalFormRef.value;\n    if (value) {\n      value.validateFields().then(() => {\n        loadingFlag.value = true;\n        formState.fullName = getFullName();\n        let operateText = getOperateText(formState);\n        saveType(formState)\n          .then(() => {\n            message.success(operateText + '成功');\n            afterSave({ ...formState });\n            resetForm();\n            handleTreeRefresh();\n            modal.open.type = false;\n            loadingFlag.value = false;\n          })\n          .catch(() => {\n            loadingFlag.value = false;\n          });\n      });\n    }\n  }\n\n  function getOperateText(params) {\n    return !params.id ? '添加' : '修改';\n  }\n\n  function getFullName() {\n    let parentFullName = formState.parentFullName;\n    if (parentFullName) {\n      return parentFullName + '/' + trim(formState.name);\n    }\n    return trim(formState.name);\n  }\n  function cancel() {\n    resetForm();\n    modal.open.type = false;\n  }\n\n  // 重置表单\n  function resetForm() {\n    modalFormRef.value?.resetFields();\n    modalIndexFormRef.value?.resetFields();\n  }\n\n  // 左侧树状菜单选中事件\n  function handleSelect(node) {\n    emit('select', node);\n  }\n\n  watch(\n    () => props.treeType,\n    () => {\n      queryTreeList();\n    },\n  );\n\n  // 启动执行代码;\n  onMounted(() => {\n    if (props.treeType) {\n      queryTreeList();\n    }\n  });\n</script>\n<style lang=\"less\" scoped>\n  .dialog-loading {\n    position: absolute;\n    z-index: 1000 !important;\n    top: 45%;\n    left: 45%;\n  }\n\n  .tab-model {\n    margin-top: 10px;\n    margin-right: 16px;\n    margin-left: 16px;\n  }\n\n  .tab-button-div {\n    height: auto;\n    padding: 14px;\n    background: white;\n\n    :deep(.ant-form-inline .ant-form-item) {\n      margin-bottom: 10px;\n    }\n  }\n\n  .tab-button {\n    margin-right: 5px;\n  }\n\n  .dialog-mask {\n    position: absolute;\n    z-index: 1001 !important;\n    top: -1px;\n    width: 100%;\n    height: 100%;\n    opacity: 0.3;\n    background: #ccc;\n  }\n\n  .tab-table-div {\n    height: 600%;\n    margin-top: 16px;\n    margin-bottom: 16px;\n    padding-left: 14px;\n    overflow: auto;\n    background: white;\n  }\n\n  .left-tree-layout {\n    flex-shrink: 0;\n    width: 298px;\n    border-radius: 2px;\n  }\n</style>\n"],"names":["getTreeData","params","defHttp","getType","insertType","updateType","saveType","deleteType","t","useI18n","createConfirm","useMessage","treeData","ref","modal","reactive","loadingFlag","disabledType","formState","treeRef","modalFormRef","modalIndexFormRef","queryTreeList","__async","typeList","props","handleTreeAdd","node","message","operateText","getOperateText","isEditTree","isSelectNode","handleTreeEdit","data","assign","afterSave","emit","handleTreeDelete","beforeDeleteRes","deleteConfirm","handleTreeRefresh","callback","handleSuccess","value","getFullName","__spreadValues","resetForm","parentFullName","trim","cancel","_a","_b","handleSelect","watch","onMounted"],"mappings":"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"}