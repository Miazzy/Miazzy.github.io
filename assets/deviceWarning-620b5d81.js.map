{"version":3,"file":"deviceWarning-620b5d81.js","sources":["../../src/views/monitor/component/deviceWarning.vue"],"sourcesContent":["<!--\n * @Description: 升压站总览-设备告警\n * @Date: 2023-10-19 17:20:55\n * @LastEditTime: 2023-11-09 13:43:13\n * @FilePath: \\ygwl-framework\\src\\views\\monitor\\component\\deviceWarning.vue\n-->\n<template>\n  <div class=\"device-warning\">\n    <div class=\"operation-btns\"></div>\n    <div class=\"table-box\">\n      <div class=\"device-table-box\">\n        <BasicTable @register=\"registerTable\" :clickToRowSelect=\"false\">\n          <template #bodyCell=\"{ column, text, record }\">\n            <template v-if=\"column.key === 'deviceStatus'\">\n              <a style=\"color: #dc0000\" v-if=\"text == 0 || text == null\">告警中</a>\n              <a style=\"color: #30ca5a\" v-if=\"text == 1\">已恢复</a>\n            </template>\n            <template v-if=\"column.key === 'isConfirm'\">\n              <a style=\"color: #dc0000\" v-if=\"text == 0 || text == null\">未确认</a>\n              <a style=\"color: #30ca5a\" v-if=\"text == 1\">已确认</a>\n            </template>\n            <template v-if=\"column.key === 'typeText'\">\n              <span v-if=\"record.type == 'interrupt'\">通讯告警</span>\n              <span v-if=\"record.type == 'electricity'\">电量告警</span>\n            </template>\n          </template>\n          <template #toolbar>\n            <div class=\"operation-btn-box\">\n              <a-button\n                class=\"operation-btn yellow-btn\"\n                :preIcon=\"IconEnum.EXPORT\"\n                @click=\"exportData\"\n              >\n                导出\n              </a-button>\n            </div>\n          </template>\n          <template #action=\"{ record }\">\n            <TableAction :actions=\"getAction(record)\" />\n          </template>\n        </BasicTable>\n      </div>\n    </div>\n    <!-- 运维建议 -->\n    <Dialog\n      v-model:visible=\"operationVisible\"\n      title=\"运维建议\"\n      height=\"400px\"\n      width=\"600px\"\n      :showBtm=\"false\"\n    >\n      <span>{{ operationRemark }}</span>\n    </Dialog>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\n  import { ref, onMounted } from 'vue';\n  import { Button, Dropdown, Menu, MenuItem } from 'ant-design-vue';\n  import Icon from '@/components/Icon/Icon.vue';\n  import { BasicTable, useTable, TableAction, BasicColumn } from '/@/components/Table';\n  import type { MenuProps } from 'ant-design-vue';\n  import { exportExcelFile } from '@/utils/file/download';\n  import { IconEnum } from '@/enums/appEnum';\n  import Dialog from '@/components/Framework/Modal/Dialog.vue';\n  import {\n    getStationTree,\n    getAlarmsCount,\n    getAlarmPage,\n    getAlarmTypes,\n    getAlarmLevels,\n    createWorkOrder,\n    createFaultWorkOrder,\n    getWorkOrderId,\n    exportExcel,\n    confirm,\n  } from '../monitorApi.ts';\n  import { useMessage } from '@/hooks/web/useMessage';\n\n  const { createConfirm } = useMessage();\n\n  const operationVisible = ref<boolean>(false);\n  const props = defineProps({\n    curStationId: { type: String, default: '' },\n    esn: { type: String, default: '' },\n    height: { type: [Number, String], default: 600 }, // 弹框高度\n  });\n\n  const handleList = () => {\n    console.log('挂牌');\n  };\n\n  const handleTurnWorkOrder = () => {\n    console.log('转工单');\n  };\n\n  // 更多\n  const handleMenuClick: MenuProps['onClick'] = (e) => {\n    const { key } = e;\n    switch (key) {\n      case '1':\n        // 1\n        console.log('操作1');\n        break;\n      case '2':\n        // 2\n        console.log('操作2');\n        break;\n      case '3':\n        // 3\n        console.log('操作3');\n        break;\n    }\n  };\n  const getAction = (record: any) => {\n    if (record.workOrderId) {\n      return [\n        {\n          label: '运维建议',\n          icon: 'clarity:note-edit-line',\n          onClick: handleAdvice.bind(null, record),\n        },\n        {\n          label: '工单详情',\n          icon: 'ant-design:calendar-outlined',\n          onClick: handleWorkOrderDetail.bind(null, record),\n        },\n      ];\n    } else {\n      return [\n        {\n          label: '运维建议',\n          icon: 'clarity:note-edit-line',\n          onClick: handleAdvice.bind(null, record),\n        },\n      ];\n    }\n  };\n\n  // 表格\n  const columns: BasicColumn[] = [\n    {\n      title: '告警名称',\n      dataIndex: 'alarmName',\n      width: 150,\n    },\n    {\n      title: '级别',\n      dataIndex: 'levelText',\n      width: 80,\n    },\n    {\n      title: '类型',\n      dataIndex: 'typeText',\n      width: 80,\n    },\n    {\n      title: '发生时间',\n      dataIndex: 'firstAlarmTime',\n      sorter: true,\n      width: 150,\n    },\n    {\n      title: '告警时长(h)',\n      dataIndex: 'showAlarmDuration',\n      sorter: true,\n      width: 150,\n    },\n    {\n      title: '恢复时间',\n      dataIndex: 'recoveryTime',\n      sorter: true,\n      width: 150,\n    },\n    {\n      title: '确认状态',\n      dataIndex: 'isConfirm',\n      width: 100,\n    },\n    {\n      title: '确认人',\n      dataIndex: 'confirmPersonName',\n      width: 100,\n    },\n    {\n      title: '确认时间',\n      dataIndex: 'confirmTime',\n      sorter: true,\n      width: 150,\n    },\n  ];\n  const tableData = ref([\n    {\n      warningName: '主变进线智能操控报警 ',\n      level: '重要',\n      category: '分类1',\n      status: '激活',\n      happenTime: '2023-08-25 14:54',\n      recoverTime: '2023-08-25 15:54',\n    },\n  ]);\n\n  const searchInfo = ref({});\n  const getDataList = async () => {\n    const paginationRef = getPaginationRef() as any;\n    let param = {\n      deviceEsn: props.esn,\n      pageNo: paginationRef.current,\n      pageSize: paginationRef.pageSize,\n      sortField: searchInfo.sortField,\n      sortOrder: searchInfo.sortOrder,\n    };\n    let res = await getAlarmPage(param);\n    tableData.value = res.list;\n    return res;\n  };\n  const [registerTable, { reload, getPaginationRef, reloadData, redoHeight }] = useTable({\n    api: getDataList,\n    columns,\n    bordered: true,\n    actionColumn: {\n      width: 280,\n      title: '操作',\n      dataIndex: 'action',\n      slots: { customRender: 'action' },\n    },\n    // fetchSetting: {\n    //   listField: 'list', // 请求返回结果list字段\n    //   pageField: 'page', // page字段\n    //   sizeField: 'pageSize', // pageSize字段\n    //   totalField: 'total', // 请求返回结果total字段\n    // },\n    rowSelection: { type: 'checkbox' },\n    pagination: { pageSize: 10 },\n    showTableSetting: true,\n    tableSetting: { fullScreen: false, redo: false, size: false },\n    scroll: { y: props.height },\n    sortFn: (sortInfo: SorterResult) => {\n      if (sortInfo.order) {\n        if (sortInfo.field === 'showAlarmDuration') {\n          searchInfo.sortField = 'alarmDuration';\n        } else {\n          searchInfo.sortField = sortInfo.field;\n        }\n        searchInfo.sortOrder = sortInfo.order.replace('end', '');\n      }\n    },\n  });\n  const operationRemark = ref('');\n  const handleAdvice = (record) => {\n    // 打开遥测修复建议\n    operationRemark.value = record.operationRemark;\n    operationVisible.value = true;\n  };\n  // 点击工单详情\n  const handleWorkOrderDetail = (record) => {\n    console.log('工单详情', record);\n  };\n  // 点击挂牌详情\n  const handleListDetail = (record) => {\n    console.log('挂牌详情', record);\n  };\n  // 导出\n  async function exportData() {\n    createConfirm({\n      title: '提示',\n      iconType: 'warning',\n      content: '确定要导出所有记录？',\n      async onOk() {\n        // 到处方法需要处理数据为字符串：因为直接数组导致报错\n        let param = {\n          deviceEsn: props.esn,\n        };\n        await exportExcel(param).then((res) => {\n          exportExcelFile(res?.data, '设备告警.xls');\n        });\n      },\n    });\n  }\n\n  onMounted(async () => {\n    getDataList();\n  });\n\n  defineExpose({\n    getDataList,\n    reloadData,\n  });\n</script>\n\n<style lang=\"less\">\n  @import '../style/themes.less';\n</style>\n\n<style lang=\"less\" scoped>\n  .device-warning {\n    .operation-btns {\n      display: flex;\n      justify-content: flex-end;\n    }\n\n    .operation-btn.ant-btn {\n      margin-right: 10px;\n      padding: 4px 8px;\n\n      &:last-child {\n        margin-right: 0;\n      }\n\n      & > span + .anticon {\n        margin-left: 0;\n      }\n    }\n  }\n</style>\n"],"names":["createConfirm","useMessage","operationVisible","ref","getAction","record","handleAdvice","handleWorkOrderDetail","columns","tableData","searchInfo","getDataList","__async","paginationRef","getPaginationRef","param","props","res","getAlarmPage","registerTable","reload","reloadData","redoHeight","useTable","sortInfo","operationRemark","exportData","exportExcel","exportExcelFile","onMounted","__expose"],"mappings":"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"}