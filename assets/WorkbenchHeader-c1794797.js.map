{"version":3,"file":"WorkbenchHeader-c1794797.js","sources":["../../src/message/CacheManager.ts","../../src/views/workbench/WorkbenchHeader.vue"],"sourcesContent":["const STRING_PREFIX = '__s__';\nconst OBJECT_PREFIX = '__o__';\n\nexport class CacheManager {\n  private static instance: CacheManager | undefined;\n  private static storage: any;\n\n  constructor() {\n    CacheManager.storage = sessionStorage;\n  }\n\n  // 获取示例函数\n  static getInstance(): CacheManager {\n    if (!CacheManager.instance) {\n      const instance = new CacheManager();\n      CacheManager.instance = instance;\n      try {\n        if (!Reflect.has(window, 'MsgManager')) {\n          window.CacheManager = instance;\n        }\n        if (!Reflect.has(window.top, 'MsgManager')) {\n          window.top.CacheManager = instance;\n        }\n      } catch (error) {\n        window.CacheManager = instance;\n      }\n    }\n    return CacheManager.instance as CacheManager;\n  }\n\n  // 设置缓存\n  setCache<T>(key: string, value: T): void {\n    let storedValue: string;\n    if (typeof value === 'string') {\n      storedValue = `${STRING_PREFIX}${value}`;\n    } else {\n      storedValue = `${OBJECT_PREFIX}${JSON.stringify(value)}`;\n    }\n    CacheManager.storage.setItem(key, storedValue);\n  }\n\n  // 获取缓存\n  getCache<T>(key: string): T | null {\n    const storedValue = CacheManager.storage.getItem(key);\n    if (!storedValue) {\n      return null;\n    }\n    try {\n      if (storedValue.startsWith(STRING_PREFIX)) {\n        return storedValue.slice(STRING_PREFIX.length) as T;\n      } else if (storedValue.startsWith(OBJECT_PREFIX)) {\n        return JSON.parse(storedValue.slice(OBJECT_PREFIX.length)) as T;\n      } else {\n        return null;\n      }\n    } catch (error) {\n      console.error('Error parsing cached value:', error);\n      return null;\n    }\n  }\n\n  // 移除缓存\n  remove(key: string): void {\n    CacheManager.storage.removeItem(key);\n  }\n\n  // 清除所有缓存\n  clear(): void {\n    CacheManager.storage.clear();\n  }\n}\n","<template>\n  <a-card :bordered=\"false\">\n    <div class=\"workbench-header\">\n      <div class=\"user-icon-box\">\n        <img class=\"user-icon-img\" :src=\"avatarSrc\" />\n      </div>\n      <div class=\"info-box\">\n        <p class=\"black-text\">上午好，{{ getLoginName() }}，开始您一天的工作吧！</p>\n        <p class=\"grey-text\">今日晴，20℃ - 32℃！</p>\n      </div>\n    </div>\n  </a-card>\n</template>\n<script lang=\"ts\" setup>\n  import { ref, computed, onMounted } from 'vue';\n  import { useUserStore } from '/@/store/modules/user';\n  import { MsgManager } from '/@/message/MsgManager';\n  import defaultAvatar from '@/assets/images/default-avatar-s.png';\n  import { CacheManager } from '/@/message/CacheManager';\n\n  const userStore = useUserStore();\n  const avatarURL = ref(defaultAvatar);\n\n  const getUserInfo = computed(() => {\n    const { username = '', avatar } = userStore.getUserInfo || {};\n    setAvatarURL(avatar);\n    return { username, avatar };\n  });\n\n  const avatarSrc = computed(() => {\n    if (avatarURL.value === defaultAvatar) {\n      const { avatar } = userStore.getUserInfo || {};\n      setAvatarURL(avatar);\n    }\n    if (!avatarURL.value) {\n      return defaultAvatar;\n    }\n    return avatarURL.value;\n  });\n\n  const setAvatarURL = (avatar) => {\n    if (avatar) {\n      avatarURL.value = avatar;\n    } else {\n      avatarURL.value = CacheManager.getInstance().getCache<string>('AVATAR');\n    }\n  };\n\n  const getLoginName = () => {\n    return getUserInfo.value.username;\n  };\n\n  onMounted(() => {\n    MsgManager.getInstance().listen('avatar-update-message', (message) => {\n      if (message?.path) {\n        avatarURL.value = message?.path || avatarURL.value;\n      }\n    });\n  });\n</script>\n<style lang=\"less\" scoped>\n  .workbench-header {\n    display: flex;\n    align-items: center;\n    height: 72px;\n\n    .user-icon-box {\n      width: 46px;\n      height: 46px;\n      margin-right: 16px;\n      overflow: hidden;\n      border-radius: 50%;\n\n      & > .user-icon-img {\n        width: 102%;\n      }\n    }\n\n    .info-box {\n      line-height: 1;\n\n      .black-text {\n        margin-bottom: 8px;\n        font-size: 14px;\n        font-weight: 500;\n      }\n\n      .grey-text {\n        margin-bottom: 0;\n        font-size: 12px;\n      }\n    }\n  }\n</style>\n"],"names":["STRING_PREFIX","OBJECT_PREFIX","_CacheManager","instance","error","key","value","storedValue","__publicField","CacheManager","userStore","useUserStore","avatarURL","ref","defaultAvatar","getUserInfo","computed","username","avatar","setAvatarURL","avatarSrc","getLoginName","onMounted","MsgManager","message"],"mappings":"8XAAA,MAAMA,EAAgB,QAChBC,EAAgB,QAETC,EAAN,MAAMA,CAAa,CAIxB,aAAc,CACZA,EAAa,QAAU,cACzB,CAGA,OAAO,aAA4B,CAC7B,GAAA,CAACA,EAAa,SAAU,CACpB,MAAAC,EAAW,IAAID,EACrBA,EAAa,SAAWC,EACpB,GAAA,CACG,QAAQ,IAAI,OAAQ,YAAY,IACnC,OAAO,aAAeA,GAEnB,QAAQ,IAAI,OAAO,IAAK,YAAY,IACvC,OAAO,IAAI,aAAeA,SAErBC,EAAO,CACd,OAAO,aAAeD,CACxB,CACF,CACA,OAAOD,EAAa,QACtB,CAGA,SAAYG,EAAaC,EAAgB,CACnC,IAAAC,EACA,OAAOD,GAAU,SACLC,EAAA,GAAGP,CAAa,GAAGM,CAAK,GAEtCC,EAAc,GAAGN,CAAa,GAAG,KAAK,UAAUK,CAAK,CAAC,GAE3CJ,EAAA,QAAQ,QAAQG,EAAKE,CAAW,CAC/C,CAGA,SAAYF,EAAuB,CACjC,MAAME,EAAcL,EAAa,QAAQ,QAAQG,CAAG,EACpD,GAAI,CAACE,EACI,OAAA,KAEL,GAAA,CACE,OAAAA,EAAY,WAAWP,CAAa,EAC/BO,EAAY,MAAMP,EAAc,MAAM,EACpCO,EAAY,WAAWN,CAAa,EACtC,KAAK,MAAMM,EAAY,MAAMN,EAAc,MAAM,CAAC,EAElD,WAEFG,EAAO,CACN,eAAA,MAAM,8BAA+BA,CAAK,EAC3C,IACT,CACF,CAGA,OAAOC,EAAmB,CACXH,EAAA,QAAQ,WAAWG,CAAG,CACrC,CAGA,OAAc,CACZH,EAAa,QAAQ,OACvB,CACF,EAlEEM,EADWN,EACI,YACfM,EAFWN,EAEI,WAFV,IAAMO,EAANP,4PCiBL,MAAMQ,EAAYC,IACZC,EAAYC,EAAIC,CAAa,EAE7BC,EAAcC,EAAS,IAAM,CACjC,KAAM,CAAE,SAAAC,EAAW,GAAI,OAAAC,CAAW,EAAAR,EAAU,aAAe,GAC3D,OAAAS,EAAaD,CAAM,EACZ,CAAE,SAAAD,EAAU,OAAAC,EAAO,CAC3B,EAEKE,EAAYJ,EAAS,IAAM,CAC3B,GAAAJ,EAAU,QAAUE,EAAe,CACrC,KAAM,CAAE,OAAAI,CAAW,EAAAR,EAAU,aAAe,CAAA,EAC5CS,EAAaD,CAAM,CACrB,CACI,OAACN,EAAU,MAGRA,EAAU,MAFRE,CAEQ,CAClB,EAEKK,EAAgBD,GAAW,CAC3BA,EACFN,EAAU,MAAQM,EAElBN,EAAU,MAAQH,EAAa,YAAY,EAAE,SAAiB,QAAQ,CACxE,EAGIY,EAAe,IACZN,EAAY,MAAM,SAG3B,OAAAO,EAAU,IAAM,CACdC,EAAW,YAAY,EAAE,OAAO,wBAA0BC,GAAY,CAChEA,GAAA,MAAAA,EAAS,OACDZ,EAAA,OAAQY,GAAA,YAAAA,EAAS,OAAQZ,EAAU,MAC/C,CACD,CAAA,CACF"}