{"version":3,"file":"index-413c0a53.js","sources":["../../src/views/oa/schedule/work/record/record.data.ts","../../src/views/oa/schedule/work/record/index.vue"],"sourcesContent":["import { defHttp } from '/@/utils/http/axios';\nimport { BasicColumn, useRender } from '/@/components/Table';\nimport type { FormProps } from '/@/components/Form/src/types/form';\nimport dayjs from 'dayjs';\n\nenum Api {\n  CREATE_URL = '/oa/work-record/create',\n  UPDATE_URL = '/oa/work-record/update',\n  GET_URL = '/oa/work-record/get',\n  PAGE_URL = '/oa/work-record/page',\n  EXPORT_EXCEL_URL = '/oa/work-record/export-excel',\n}\n\n// 新增工作记录\nexport const createData = (params) =>\n  defHttp.post(\n    {\n      url: Api.CREATE_URL,\n      params,\n    },\n    {},\n  );\n\n// 修改工作记录\nexport const updateData = (params) =>\n  defHttp.put(\n    {\n      url: Api.UPDATE_URL,\n      params,\n    },\n    {},\n  );\n\nexport const saveData = (params) => {\n  if (!params.id) {\n    return createData(params);\n  }\n  return updateData(params);\n};\n\n// 获取工作记录数据\nexport const getData = (workScheduleId: string, stationId: string) =>\n  defHttp.get(\n    {\n      url: `${Api.GET_URL}?workScheduleId=${workScheduleId}&stationId=${stationId}`,\n    },\n    { isOnlyResult: true },\n  );\n\n// 分页获取工作记录列表\nexport const getPage = (params) =>\n  defHttp.get(\n    {\n      url: Api.PAGE_URL,\n      params,\n    },\n    { isOnlyResult: true },\n  );\n\n// 导出工作记录\nexport const exportExcel = (params) =>\n  defHttp.post(\n    {\n      url: Api.EXPORT_EXCEL_URL,\n      params,\n      responseType: 'blob',\n    },\n    { isOnlyResult: true },\n  );\n\nexport const columns: BasicColumn[] = [\n  {\n    title: '类型',\n    dataIndex: 'type',\n    width: 100,\n    sorter: true,\n    resizable: true,\n    customRender: ({ record }) => {\n      return record.typeText;\n    },\n  },\n  {\n    title: '内容',\n    dataIndex: 'content',\n    headAlign: 'center',\n    align: 'left',\n    width: 220,\n    sorter: true,\n    resizable: true,\n    customRender: ({ text, record }) => {\n      if (!record.url) {\n        return text;\n      }\n      return useRender.renderIframeLink(record.url, undefined, {}, text);\n    },\n  },\n  {\n    title: '日期',\n    dataIndex: 'workDate',\n    width: 100,\n    sorter: true,\n    resizable: true,\n  },\n  {\n    title: '建议时间',\n    dataIndex: 'reminderTime',\n    width: 100,\n    sorter: true,\n    resizable: true,\n  },\n  {\n    title: '状态',\n    dataIndex: 'status',\n    width: 100,\n    sorter: true,\n    resizable: true,\n  },\n];\n\nconst currentDate = dayjs().format('YYYY-MM-DD');\nexport const searchForm: FormProps = {\n  baseColProps: { span: 8 },\n  labelWidth: 120,\n  autoAdvancedLine: 1,\n  schemas: [\n    {\n      field: '[startWorkDate, endWorkDate]',\n      label: '日期',\n      component: 'RangePicker',\n      defaultValue: [currentDate, currentDate],\n      componentProps: {\n        format: 'YYYY-MM-DD',\n        valueFormat: 'YYYY-MM-DD',\n        placeholder: ['开始日期', '结束日期'],\n        style: 'width:100%',\n      },\n    },\n    {\n      label: '类型',\n      field: 'type',\n      component: 'DictSelectBox',\n      componentProps: {\n        type: 'work_schedule_type',\n      },\n    },\n    {\n      label: '内容',\n      field: 'content',\n      component: 'Input',\n    },\n    {\n      label: '状态',\n      field: 'status',\n      component: 'DictSelectBox',\n      componentProps: {\n        type: 'work_record_status',\n      },\n    },\n  ],\n};\n","<template>\n  <PageWrapper dense contentFullHeight fixedHeight contentClass=\"flex\" style=\"position: relative\">\n    <BasicTable\n      class=\"fix-basic-table\"\n      @register=\"registerTable\"\n      @resize-column=\"handleResizeColumn\"\n    >\n      <template #toolbar>\n        <a-button class=\"yellow-btn\" :preIcon=\"IconEnum.EXPORT\" @click=\"handleExport\">{{\n          t('common.action.export')\n        }}</a-button>\n      </template>\n      <template #bodyCell=\"{ column, text }\">\n        <template v-if=\"column.dataIndex === 'status'\">\n          <span style=\"color: #19be6b\" v-if=\"text == 1\">已完成</span>\n          <span style=\"color: red\" v-if=\"text == 0\">未完成</span>\n        </template>\n      </template>\n    </BasicTable>\n  </PageWrapper>\n</template>\n<script lang=\"ts\" setup>\n  import { reactive, ref } from 'vue';\n  import { IconEnum } from '@/enums/appEnum';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { useMessage } from '@/hooks/web/useMessage';\n  import { BasicTable, useTable, SorterResult } from '/@/components/Table';\n  import { PageWrapper } from '/@/components/Page';\n  import { exportExcelFile } from '@/utils/file/download';\n  import { exportExcel, getPage, columns, searchForm } from './record.data';\n\n  const { t } = useI18n();\n  const message = useMessage();\n  const searchInfo = reactive<any>({});\n\n  const getParam = (isPage: boolean) => {\n    const form = getForm();\n    const query = { ...form.getFieldsValue(), sortField: 'workDate', sortOrder: 'asc' } as any;\n    if (isPage) {\n      const paginationRef = getPaginationRef() as any;\n      query.pageNo = paginationRef.current;\n      query.pageSize = paginationRef.pageSize;\n    }\n    if (searchInfo.sortField) {\n      query.sortField = searchInfo.sortField;\n      query.sortOrder = searchInfo.sortOrder;\n    }\n    return query;\n  };\n\n  const getListByParam = async () => {\n    return await getPage(getParam(true));\n  };\n\n  const tableTitle = ref<string>('工作安排');\n  const [registerTable, { getForm, getPaginationRef }] = useTable({\n    title: tableTitle,\n    api: getListByParam,\n    columns: columns,\n    useSearchForm: true,\n    formConfig: searchForm,\n    showTableSetting: true,\n    bordered: true,\n    rowKey: 'id',\n    sortFn: (sortInfo: SorterResult) => {\n      const sortOrder = sortInfo.order?.replace('end', '');\n      searchInfo.sortOrder = sortOrder;\n      searchInfo.sortField = sortOrder ? sortInfo.field : undefined;\n    },\n  });\n\n  function handleResizeColumn(w, col) {\n    col.width = w;\n  }\n\n  function handleExport() {\n    message.createConfirm({\n      title: t('common.message.confirmTitle'),\n      iconType: 'warning',\n      content: t('common.message.exportMessage'),\n      async onOk() {\n        const query = getParam(false);\n        query.filename = `${tableTitle.value}.xlsx`;\n        query.excelList = columns;\n        await exportExcel(query).then((res) => {\n          exportExcelFile(res?.data, query.filename);\n        });\n        message.success(t('common.exportSuccessText'));\n      },\n    });\n  }\n</script>\n<style lang=\"less\" scoped>\n  @import '/@/design/biz/bizList.less';\n</style>\n"],"names":["getPage","params","defHttp","exportExcel","columns","record","text","useRender","currentDate","dayjs","searchForm","t","useI18n","message","useMessage","searchInfo","reactive","getParam","isPage","form","getForm","query","__spreadProps","__spreadValues","paginationRef","getPaginationRef","getListByParam","__async","tableTitle","ref","registerTable","useTable","sortInfo","sortOrder","_a","handleResizeColumn","w","col","handleExport","res","exportExcelFile"],"mappings":"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"}