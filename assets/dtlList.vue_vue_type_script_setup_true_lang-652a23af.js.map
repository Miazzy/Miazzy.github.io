{"version":3,"file":"dtlList.vue_vue_type_script_setup_true_lang-652a23af.js","sources":["../../src/views/po/inspection/inspectionplan/dtlList.vue"],"sourcesContent":["<template>\n  <BasicTable  @register=\"table\">\n    <template #toolbar>\n      <a-button @click=\"addRow\" \n      v-if=\"activeKey=='dtlChild'\" \n      type=\"primary\" \n      :style=\"{ 'margin-right': '10px' }\" :preIcon=\"IconEnum.ADD\"\n        >添加</a-button\n      >\n      <a-button\n        v-if=\"activeKey=='dtlChild'\" \n        @click=\"deleteRow\"\n        :style=\"{ 'margin-right': '10px' }\"\n        :preIcon=\"IconEnum.DELETE\"\n        >删除</a-button\n      >\n      <a-button @click=\"importData\" :preIcon=\"IconEnum.DOWNLOAD\">批量引入</a-button>\n    </template>\n  </BasicTable>\n\n    <Dialog\n      v-model:visible=\"open\"\n      :maskClosable=\"false\"\n      title=\"选择巡检指标\"\n      @ok=\"handleOk\"\n      :width=\"1000\"\n    >\n      <BasicTable\n        class=\"table-in-dialog\"\n        @register=\"modalTable\"\n        :searchInfo=\"searchForm\"\n      />\n    </Dialog>\n</template>\n\n<script lang=\"ts\" setup>\n  import { ref } from 'vue';\n  import Dialog from '@/components/Framework/Modal/Dialog.vue';\n  import { BasicTable, useTable } from '@/components/Table';\n  import { getPlanDtlData,   getSafeCheckIndexPage } from './create';\n  import { IconEnum } from '@/enums/appEnum';\n  import { useMessage } from '@/hooks/web/useMessage';\n  import { SysMessage } from '/@/hooks/web/useMessage';\n\n  const { createConfirm } = useMessage();\n\n  const inspectionPlanId = ref('');\n  const activeKey = ref('dtlChild');\n  const initReload = ref(true);\n\n  const addRow = () => {\n    open.value = true;\n  };\n  const deleteRow = () => {\n    deleteTableDataRecord(getSelectRowKeys());\n  };\n  const importData = () => {\n    createConfirm({\n      title: '提示',\n      iconType: 'warning',\n      content: '确定引入全部检查数据?',\n      async onOk() {\n        let dataObj = await getSafeCheckIndexPage({ usePage: 0 });\n        let rows: any = [];\n        dataObj.result.list.forEach((e) => {\n          rows.push({ indexId: e.id, indexItem: e.checkItem, indexContent: e.description });\n        });\n        setTableData(rows);\n        clearSelectedRowKeys();\n      },\n    });\n  };\n  const reloadGrid = (param) => {\n    inspectionPlanId.value = param.inspectionPlanId;\n    activeKey.value = param.activeKey;\n    if(param.forceReload){\n      reload();\n    }\n    if (initReload.value) {\n      reload();\n      initReload.value = false;\n    }\n  };\n\n\nconst searchForm = [\n    {\n      label: '关键字',\n      field: 'name',\n      component: 'Input',\n      colProps: { span: 8 },\n    },\n  ];\n  \n  const [\n    table,\n    {\n      setTableData,\n      getSelectRowKeys,\n      reload,\n      clearSelectedRowKeys,\n      getDataSource,\n      deleteTableDataRecord,\n    },\n  ] = useTable({\n    title: '',\n    api: async () => {\n      let dataObj = await getPlanDtlData({ inspectionPlanId: inspectionPlanId.value });\n      return dataObj.result;\n    },\n    columns: [\n      { title: '项目', dataIndex: 'indexItem',align: 'left',headAlign:'center', width: 80 },\n      { title: '巡检内容及标准', dataIndex: 'indexContent',align: 'left',headAlign:'center', width: 160 },\n    ],\n    bordered: true,\n    useSearchForm: false,\n    showTableSetting: false,\n    target: '#more-tab-content',\n    targetTabKey: 'dtlChild',\n    targetTabValue: activeKey,\n    pagination: false,\n    rowSelection: {\n      type: 'checkbox',\n    },\n  });\n  const open = ref(false);\n\n  const handleOk = () => {\n    let rows = modalSelectRow();\n    if (rows.length == 0) {\n      SysMessage.getInstance().info('请选择指标');\n      return false;\n    }\n    open.value = false;\n    let existData = getDataSource();\n    let keyMap = {};\n    existData.forEach((e) => {\n      keyMap[e.indexId] = e.indexId;\n    });\n    rows.forEach((e) => {\n      if (!keyMap[e.id]) {\n        existData.push({ indexId: e.id, indexItem: e.checkItem, indexContent: e.description });\n      }\n    });\n\n    setTableData(existData);\n\n    clearSelectKey();\n  };\n\n  \n  const queryParam = ref({ checkItem: '', description: '', pageNo: 1, pageSize: 10, usePage: 1 });\n\n  const [\n    modalTable,\n    {\n      getSelectRows: modalSelectRow,\n      clearSelectedRowKeys: clearSelectKey,\n      getPaginationRef: getPageInfo,\n    },\n  ] = useTable({\n    title: '',\n    api: async () => {\n      const paginationRef = getPageInfo() as any;\n      queryParam.value.pageNo = paginationRef.current;\n      queryParam.value.pageSize = paginationRef.pageSize;\n      let dataObj = await getSafeCheckIndexPage(queryParam.value);\n      return dataObj.result;\n    },\n    columns: [\n      { title: '检查项目', dataIndex: 'checkItem',align: 'left',headAlign:'center', width: 80 },\n      { title: '检查内容', dataIndex: 'description',align: 'left',headAlign:'center', width: 160 },\n    ],\n    pagination: true,\n    formConfig: {\n      labelWidth: 120,\n      schemas: [\n        { label: '检查项目', field: 'checkItem', component: 'Input', colProps: { span: 10 } },\n        { label: '检查内容', field: 'description', component: 'Input', colProps: { span: 10 } },\n      ],\n    },\n    useSearchForm: true,\n    showTableSetting: false,\n    maxHeight: 343,\n    rowSelection: {\n      type: 'checkbox',\n    },\n    handleSearchInfoFn(info) {\n      queryParam.value.checkItem = info.checkItem;\n      queryParam.value.description = info.description;\n    },\n  });\n\n\n  defineExpose({ reloadGrid, getDataSource });\n</script>"],"names":["createConfirm","useMessage","inspectionPlanId","ref","activeKey","initReload","addRow","open","deleteRow","deleteTableDataRecord","getSelectRowKeys","importData","__async","dataObj","getSafeCheckIndexPage","rows","e","setTableData","clearSelectedRowKeys","reloadGrid","param","reload","searchForm","table","getDataSource","useTable","getPlanDtlData","handleOk","modalSelectRow","SysMessage","existData","keyMap","clearSelectKey","queryParam","modalTable","getPageInfo","paginationRef","info","__expose"],"mappings":"6sBA4CQ,KAAA,CAAE,cAAAA,GAAkBC,IAEpBC,EAAmBC,EAAI,EAAE,EACzBC,EAAYD,EAAI,UAAU,EAC1BE,EAAaF,EAAI,EAAI,EAErBG,EAAS,IAAM,CACnBC,EAAK,MAAQ,EAAA,EAETC,EAAY,IAAM,CACtBC,EAAsBC,GAAkB,CAAA,EAEpCC,EAAa,IAAM,CACTX,EAAA,CACZ,MAAO,KACP,SAAU,UACV,QAAS,cACH,MAAO,QAAAY,EAAA,sBACX,IAAIC,EAAU,MAAMC,EAAsB,CAAE,QAAS,CAAG,CAAA,EACpDC,EAAY,CAAA,EAChBF,EAAQ,OAAO,KAAK,QAASG,GAAM,CAC5BD,EAAA,KAAK,CAAE,QAASC,EAAE,GAAI,UAAWA,EAAE,UAAW,aAAcA,EAAE,WAAa,CAAA,CAAA,CACjF,EACDC,EAAaF,CAAI,EACIG,GACvB,GAAA,CACD,CAAA,EAEGC,EAAcC,GAAU,CAC5BlB,EAAiB,MAAQkB,EAAM,iBAC/BhB,EAAU,MAAQgB,EAAM,UACrBA,EAAM,aACAC,IAELhB,EAAW,QACNgB,IACPhB,EAAW,MAAQ,GACrB,EAIEiB,EAAa,CACf,CACE,MAAO,MACP,MAAO,OACP,UAAW,QACX,SAAU,CAAE,KAAM,CAAE,CACtB,CAAA,EAGI,CACJC,EACA,CACE,aAAAN,EACA,iBAAAP,EACA,OAAAW,EACA,qBAAAH,EACA,cAAAM,EACA,sBAAAf,CACF,GACEgB,EAAS,CACX,MAAO,GACP,IAAK,IAAYb,EAAA,sBAEf,OADc,MAAMc,EAAe,CAAE,iBAAkBxB,EAAiB,MAAO,GAChE,MACjB,GACA,QAAS,CACP,CAAE,MAAO,KAAM,UAAW,YAAY,MAAO,OAAO,UAAU,SAAU,MAAO,EAAG,EAClF,CAAE,MAAO,UAAW,UAAW,eAAe,MAAO,OAAO,UAAU,SAAU,MAAO,GAAI,CAC7F,EACA,SAAU,GACV,cAAe,GACf,iBAAkB,GAClB,OAAQ,oBACR,aAAc,WACd,eAAgBE,EAChB,WAAY,GACZ,aAAc,CACZ,KAAM,UACR,CAAA,CACD,EACKG,EAAOJ,EAAI,EAAK,EAEhBwB,EAAW,IAAM,CACrB,IAAIZ,EAAOa,IACP,GAAAb,EAAK,QAAU,EACN,OAAAc,EAAA,YAAA,EAAc,KAAK,OAAO,EAC9B,GAETtB,EAAK,MAAQ,GACb,IAAIuB,EAAYN,IACZO,EAAS,CAAA,EACHD,EAAA,QAASd,GAAM,CAChBe,EAAAf,EAAE,OAAO,EAAIA,EAAE,OAAA,CACvB,EACID,EAAA,QAASC,GAAM,CACbe,EAAOf,EAAE,EAAE,GACJc,EAAA,KAAK,CAAE,QAASd,EAAE,GAAI,UAAWA,EAAE,UAAW,aAAcA,EAAE,WAAa,CAAA,CACvF,CACD,EAEDC,EAAaa,CAAS,EAEPE,GAAA,EAIXC,EAAa9B,EAAI,CAAE,UAAW,GAAI,YAAa,GAAI,OAAQ,EAAG,SAAU,GAAI,QAAS,CAAG,CAAA,EAExF,CACJ+B,EACA,CACE,cAAeN,EACf,qBAAsBI,EACtB,iBAAkBG,CACpB,GACEV,EAAS,CACX,MAAO,GACP,IAAK,IAAYb,EAAA,sBACf,MAAMwB,EAAgBD,IACX,OAAAF,EAAA,MAAM,OAASG,EAAc,QAC7BH,EAAA,MAAM,SAAWG,EAAc,UAC5B,MAAMtB,EAAsBmB,EAAW,KAAK,GAC3C,MACjB,GACA,QAAS,CACP,CAAE,MAAO,OAAQ,UAAW,YAAY,MAAO,OAAO,UAAU,SAAU,MAAO,EAAG,EACpF,CAAE,MAAO,OAAQ,UAAW,cAAc,MAAO,OAAO,UAAU,SAAU,MAAO,GAAI,CACzF,EACA,WAAY,GACZ,WAAY,CACV,WAAY,IACZ,QAAS,CACP,CAAE,MAAO,OAAQ,MAAO,YAAa,UAAW,QAAS,SAAU,CAAE,KAAM,GAAK,EAChF,CAAE,MAAO,OAAQ,MAAO,cAAe,UAAW,QAAS,SAAU,CAAE,KAAM,GAAK,CACpF,CACF,EACA,cAAe,GACf,iBAAkB,GAClB,UAAW,IACX,aAAc,CACZ,KAAM,UACR,EACA,mBAAmBI,EAAM,CACZJ,EAAA,MAAM,UAAYI,EAAK,UACvBJ,EAAA,MAAM,YAAcI,EAAK,WACtC,CAAA,CACD,EAGY,OAAAC,EAAA,CAAE,WAAAnB,EAAY,cAAAK,CAAA,CAAe"}