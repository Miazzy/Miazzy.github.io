var r=(L,c,f)=>new Promise((t,_)=>{var y=s=>{try{x(f.next(s))}catch(k){_(k)}},a=s=>{try{x(f.throw(s))}catch(k){_(k)}},x=s=>s.done?t(s.value):Promise.resolve(s.value).then(y,a);x((f=f.apply(L,c)).next())});import{B as Q}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as Y}from"./useTable-109483b3.js";import{a2 as b}from"./antd-15ac76ed.js";import{au as ee,a7 as te,av as h,ax as O,_ as ae}from"./index.js";import{P as ne}from"./index-20519caf.js";import{C as se}from"./CommonTree-c4ed7838.js";import"./index-74ac3212.js";import{g as oe,f as m,a as re,d as le,u as K,e as ie,b as P,c as de}from"./index-69777d73.js";import{j as ce}from"./Export2Excel-389a8fc9.js";import{d as ue,k as l,r as pe,o as me,al as fe,Z as w,_ as E,f as i,aa as d,$ as R,u as n,E as C,F as Ie,ac as D,J as ve}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";import"./useRender-21ce56fb.js";const be={class:"right-table-layout"},ge={key:0,style:{color:"#19be6b"}},he={key:1,style:{color:"red"}},Ce=ue({__name:"index",setup(L){let c=l("");const{createConfirm:f}=ee(),t=pe({assetCode:null,deviceCode:null,userName:null,status:null}),_=l([]),y=l({}),a=l([]),x=P(),s=l([]),k=()=>r(this,null,function*(){let e=yield de(t);return s.value=e.result,e.result}),W={baseColProps:{span:8},labelWidth:120,autoAdvancedLine:1,showAdvancedButton:!0,schemas:[{field:"assetCode",component:"Input",label:"资产编号"},{field:"deviceCode",component:"Input",label:"设备编号"},{field:"userName",component:"Input",label:"当前使用人"},{field:"status",label:"状态",component:"Select",componentProps:{options:[{label:"启用",value:"1"},{label:"禁用",value:"0"}]}}]},[A,{reload:g,getPaginationRef:V}]=Y({title:"电子工牌设置列表",api:()=>r(this,null,function*(){const e=V();return t.pageNo=e.current,t.pageSize=e.pageSize,yield k()}),columns:x,useSearchForm:!0,formConfig:W,showTableSetting:!0,bordered:!0,rowKey:"id",rowSelection:{type:"radio",onChange:j},handleSearchInfoFn(e){return t.status=e.status,t.assetCode=e.assetCode,t.deviceCode=e.deviceCode,t.userName=e.userName,e},sortFn:e=>{e.order?(t.sortField=e.field,t.sortOrder=e.order.replace("end","")):(t.sortField=null,t.sortOrder=null)}});function j(e,o){o.length>0?(a.value=[e[0]],c.value=e[0]):(a.value=[],c.value="")}function M(){return r(this,null,function*(){const e=yield oe({});_.value=e.result,g()})}function z(){if(m.id="",m.deviceType="电子工牌",m.disabledInput="false",t.stationId==null){b.error("请先选择电站。");return}O("/baseset/monitor/smartdevices/eleworkcard/create","添加电子工牌设置",ve(m))}function H(e){O(`/baseset/monitor/smartdevices/eleworkcard/create?id=${e.id}&disabledInput=true`,"查看电子工牌设置")}function X(){return r(this,null,function*(){if(!N())return;if((yield re({id:a.value[0]})).result.status==0){b.error("已禁用，不可修改.");return}O("/baseset/monitor/smartdevices/eleworkcard/create?id="+a.value[0]+"&disabledInput=false","修改电子工牌设置")})}function $(){return r(this,null,function*(){if(console.log(a.value),a.value.length!=1)return b.info("请选择一条数据."),!1;f({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return r(this,null,function*(){le(a.value[0]).then(()=>{b.success("已删除。"),a.value=[],g()})})}})})}function q(){if(!N())return;const e="?id="+a.value[0]+"&status=1";K(e).then(()=>{b.success("已启用"),g()})}function J(){if(!N())return;const e="?id="+a.value[0]+"&status=0";K(e).then(()=>{b.success("已禁用"),g()})}function U(e={}){t.stationId=null,t.stationName=null,t.stationOrganId=null,t.stationOrganName=null,t.nodeKindId=null,y.value.nodeKindId=null,t.searchId=null,e!=null&&(t.stationOrganId=e.organId,t.stationOrganName=e.organName,e.nodeKindId=="station"&&(t.stationId=e.powerStationId,t.stationName=e.name,y.value.stationId=e.powerStationId,m.stationId=t.stationId,m.stationName=t.stationName,m.stationOrganId=t.stationOrganId,m.stationOrganName=t.stationOrganName),t.nodeKindId=e.nodeKindId,y.value.nodeKindId=e.nodeKindId,t.searchId=e.id),g()}function N(){return a.value.length==0||a.value.length>1||!a.value[0]?(b.error("请选择一行数据"),!1):!0}function Z(){return r(this,null,function*(){f({title:"导出",iconType:"warning",content:"确定要导出所有记录？",onOk(){return r(this,null,function*(){const o=l({index:"序号"}),u=P(),p=l([]),I=l([]);u.forEach(v=>{v.dataIndex!=="id"&&(o.value[v.dataIndex]=v.title,I.value.push(v.dataIndex))});let B=yield ie(t);s.value=B.result,s.value.forEach(function(v,G){let S="";switch(v.status){case 0:S="禁用";break;case 1:S="启用";break}let F=l({index:G+1});I.value.forEach(T=>{F.value[T]=T==="status"?S:v[T]}),p.value.push(F.value)}),ce({data:p.value,header:o.value,filename:"电子工牌设置.xlsx"})})}})})}return me(()=>{M(),te.getInstance().listen("eleWorkCard",function(){setTimeout(()=>{g()},500)})}),(e,o)=>{const u=fe("a-button");return w(),E("div",null,[i(n(ne),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:d(()=>[i(se,{title:"电站组织",onSelect:U,value:_.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),R("div",be,[R("div",null,[i(n(Q),{class:"fix-basic-table",onRegister:n(A),searchInfo:t,onResizeColumn:o[0]||(o[0]=(p,I)=>I.width=p),onRowDbClick:o[1]||(o[1]=p=>H(p))},{toolbar:d(()=>[i(u,{type:"primary",preIcon:n(h).ADD,onClick:z},{default:d(()=>[C("添加")]),_:1},8,["preIcon"]),i(u,{type:"primary",disabled:n(c)=="",preIcon:n(h).EDIT,onClick:X},{default:d(()=>[C("修改")]),_:1},8,["disabled","preIcon"]),i(u,{class:"red-btn",disabled:n(c)=="",preIcon:n(h).DELETE,onClick:$},{default:d(()=>[C("删除")]),_:1},8,["disabled","preIcon"]),i(u,{class:"green-btn",disabled:n(c)=="",preIcon:n(h).ENABLE,onClick:q},{default:d(()=>[C("启用")]),_:1},8,["disabled","preIcon"]),i(u,{class:"grey-btn",disabled:n(c)=="",preIcon:n(h).DISABLE,onClick:J},{default:d(()=>[C("禁用")]),_:1},8,["disabled","preIcon"]),i(u,{class:"yellow-btn",preIcon:n(h).EXPORT,onClick:Z},{default:d(()=>[C("导出")]),_:1},8,["preIcon"])]),bodyCell:d(({column:p,text:I,record:B})=>[p.dataIndex==="status"?(w(),E(Ie,{key:0},[I==1?(w(),E("span",ge,"启用")):D("",!0),I==0?(w(),E("span",he,"禁用")):D("",!0)],64)):D("",!0)]),_:1},8,["onRegister","searchInfo"])])])]),_:1})])}}});const Qe=ae(Ce,[["__scopeId","data-v-4cc26dbe"]]);export{Qe as default};
//# sourceMappingURL=index-c775300a.js.map
