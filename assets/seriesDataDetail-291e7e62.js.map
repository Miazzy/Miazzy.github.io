{"version":3,"file":"seriesDataDetail-291e7e62.js","sources":["../../src/views/monitor/realTimeAnalysis/seriesDataDetail.vue"],"sourcesContent":["<template>\n  <div class=\"data-detail\">\n    <div class=\"header-box\">\n      <div class=\"header-left\">\n        <div class=\"radio-btn-box\">\n          <RadioGroup v-model:value=\"showMode\" size=\"small\">\n            <RadioButton value=\"chart\">\n              <Icon icon=\"ant-design:line-chart-outlined\" class=\"radio-btn-icon\" :size=\"14\" />\n            </RadioButton>\n            <RadioButton value=\"table\">\n              <Icon icon=\"ant-design:insert-row-above-outlined\" class=\"radio-btn-icon\" :size=\"14\" />\n            </RadioButton>\n          </RadioGroup>\n        </div>\n        <div class=\"date-picker-box\">\n          <DatePicker v-model:value=\"date\" valueFormat=\"YYYY-MM-DD\" @change=\"handleChangeDate\" />\n        </div>\n        <div v-if=\"showMode === 'chart'\" class=\"select-box\">\n          <Select\n            v-model:value=\"target\"\n            mode=\"multiple\"\n            style=\"min-width: 206px\"\n            placeholder=\"选择指标\"\n            :options=\"targetOptions\"\n            :max-tag-count=\"2\"\n            showArrow\n            @change=\"handleTargetChange\"\n          />\n        </div>\n      </div>\n      <div class=\"header-right\" v-if=\"showMode === 'table'\">\n        <Button type=\"primary\" @click=\"exportData\">导出</Button>\n      </div>\n    </div>\n    <div class=\"content-box\">\n      <div v-if=\"showMode === 'chart'\" class=\"chart-box\">\n        <EchartLineChart :data=\"chartData\" :width=\"1372\" :height=\"302\" />\n      </div>\n      <div v-if=\"showMode === 'table'\" class=\"table-box\">\n        <BasicTable @register=\"registerTable\" :scroll=\"{ y: 500 }\" />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\n  import { onMounted, ref, reactive, defineEmits, watch } from 'vue';\n  import { RadioGroup, RadioButton, Select, DatePicker, Button } from 'ant-design-vue';\n  import Icon from '@/components/Icon/Icon.vue';\n  import type { SelectProps } from 'ant-design-vue';\n\n  import dayjs, { Dayjs } from 'dayjs';\n  import { BasicTable, useTable, TableAction, BasicColumn } from '/@/components/Table';\n  import { formatDate } from '/@/utils/dateUtil';\n  import EchartLineChart from '/@/components/Framework/Chart/EchartLineChart.vue';\n  import { getChartData, getRealTimeYc } from '../monitorApi.ts';\n  import { jsonToSheetXlsx } from '/@/components/Excel';\n\n  // 表格\n  const columns = ref([]);\n  const tableData = ref([]);\n\n  const initTableData = async () => {\n    return tableData;\n  };\n  const [registerTable, { reload }] = useTable({\n    api: initTableData,\n    columns,\n    bordered: true,\n    showTableSetting: false,\n    rowKey: 'time',\n    pagination: { show: true, pageSize: 15 },\n    tableSetting: { fullScreen: false },\n    // dataSource: tableData,\n  });\n  // 显示方式：图表/表格 chart/table\n  const showMode = ref('chart');\n\n  // 选择日期\n  const date = ref<Dayjs>();\n  const handleChangeDate = (value) => {\n    console.log('选择日期', value);\n    loadChartData();\n  };\n\n  // 选择指标\n  const target = ref([]);\n  const targetOptions = ref<SelectProps['options']>([]);\n  const handleTargetChange = (value: string[]) => {\n    console.log(`selected ${value}`);\n    target.value = value;\n    loadChartData();\n  };\n  // 父组件穿过来的表格字段，指标列表\n  interface Props {\n    tableColumns?: [];\n    stationDeviceInfo?: {};\n  }\n  const props = withDefaults(defineProps<Props>(), {});\n  const loadBaseInfo = () => {\n    columns.value = props.tableColumns;\n    // 初始化日期\n    let current = new Date();\n    date.value = dayjs(formatDate(current), 'YYYY-MM-DD');\n  };\n  // 获取指标选项\n  const getTargetOptions = async (params) => {\n    let { stationId, areaId, esn } = params;\n    let res = await getRealTimeYc({\n      stationId,\n      areaId,\n      esn,\n      dataType: 3,\n    });\n    let tempOptions = [];\n    res.forEach((item) => {\n      tempOptions.push({ label: item.addressDesc, value: item.addressField });\n    });\n    targetOptions.value = tempOptions;\n  };\n  const chartData = reactive({\n    categories: [],\n    lineData: [],\n    units: [],\n    seriesName: [],\n  });\n  // 获取数据\n  const loadChartData = async () => {\n    let params = {};\n    let esns = [];\n    esns.push(props.stationDeviceInfo.esn);\n    params.queryFieldList = target.value;\n    params.startDate = formatDate(date.value);\n    params.endDate = formatDate(date.value);\n    params.esns = esns;\n    params.esn = props.stationDeviceInfo.esn;\n    params.dataType = 1;\n    let res = await getChartData(params);\n    if (res?.length && res[0]) {\n      Object.assign(chartData, {\n        lineData: res[0].dataList,\n        categories: res[0].timeList,\n        units: res[0].unitList,\n        seriesName: res[0].zhList,\n      });\n    } else {\n      Object.assign(chartData, {\n        lineData: [],\n        categories: [],\n        units: [],\n        seriesName: [],\n      });\n    }\n    Object.assign(chartData, {\n      categories: ['组串1', '组串2', '组串3'],\n      lineData: [\n        [1, 2, 4],\n        [6, 5, 4],\n        [11, 23, 17],\n        [20, 10, 30],\n      ],\n      units: ['kw', 'kwh', 'mw', 'h'],\n      seriesName: ['指标1', '指标2', '指标3', '指标4'],\n    });\n\n    // loadTableData(res);\n  };\n\n  // 处理表数据\n  const loadTableData = async (res: array) => {\n    let timeList = res[0].timeList;\n    let columnList = res[0].zhList;\n    let enList = res[0].enList;\n    let unitList = res[0].unitList;\n    let dataList = res[0].dataList;\n    let preColumns = [{ title: '时间', dataIndex: 'time' }];\n    if (columnList.length > 0) {\n      for (let i = 0; i < columnList.length; i++) {\n        let column = { title: columnList[i] + '（' + unitList[i] + '）', dataIndex: enList[i] };\n        preColumns.push(column);\n      }\n      columns.value = preColumns;\n    }\n    if (timeList.length > 0) {\n      let tableList = [];\n      for (let j = 0; j < timeList.length; j++) {\n        let data = { time: timeList[j] };\n        for (let k = 0; k < enList.length; k++) {\n          data[enList[k]] = dataList[k][j];\n        }\n        tableList.push(data);\n      }\n      tableData.value = tableList;\n    }\n  };\n\n  // 导出\n  function exportData() {\n    let header = {};\n    columns.value.forEach((item) => {\n      header[item.dataIndex] = item.title;\n    });\n\n    let exportDataList = [];\n    tableData.value.forEach((element) => {\n      let temp = {};\n      for (let k in header) {\n        temp[k] = element[k];\n      }\n      exportDataList.push(temp);\n    });\n\n    jsonToSheetXlsx({\n      data: exportDataList,\n      header: header,\n      filename: '数据明细.xlsx',\n    });\n  }\n\n  watch(\n    () => props.stationDeviceInfo,\n    (value) => {\n      Object.assign(chartData, {\n        lineData: [],\n        categories: [],\n        units: [],\n        seriesName: [],\n      });\n      target.value = [];\n      targetOptions.value = [];\n      getTargetOptions(value);\n    },\n    {\n      deep: true,\n    },\n  );\n\n  // 启动执行代码\n  onMounted(() => {\n    loadBaseInfo();\n  });\n  // defineExpose({ loadBaseInfo });\n</script>\n\n<style lang=\"less\">\n  @import '../style/themes.less';\n</style>\n\n<style lang=\"less\" scoped>\n  .data-detail {\n    .header-box {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 10px 15px 0;\n\n      .header-left {\n        display: flex;\n        align-items: center;\n      }\n    }\n\n    .radio-btn-box {\n      margin-right: 20px;\n    }\n\n    .date-picker-box {\n      margin-right: 20px;\n    }\n\n    .content-box {\n      .table-box {\n        height: 600px;\n        padding: 0 9px;\n        overflow: auto;\n      }\n    }\n  }\n</style>\n"],"names":["columns","ref","tableData","initTableData","__async","registerTable","reload","useTable","showMode","date","handleChangeDate","value","loadChartData","target","targetOptions","handleTargetChange","loadBaseInfo","props","current","dayjs","formatDate","getTargetOptions","params","stationId","areaId","esn","res","getRealTimeYc","tempOptions","item","chartData","reactive","esns","getChartData","exportData","header","exportDataList","element","temp","k","jsonToSheetXlsx","watch","onMounted"],"mappings":"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"}