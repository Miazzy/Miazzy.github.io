var p=(y,A,f)=>new Promise((w,n)=>{var _=l=>{try{v(f.next(l))}catch(b){n(b)}},I=l=>{try{v(f.throw(l))}catch(b){n(b)}},v=l=>l.done?w(l.value):Promise.resolve(l.value).then(_,I);v((f=f.apply(y,A)).next())});import{C as te}from"./CommonTree-c4ed7838.js";import{B as ae}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as oe}from"./useTable-109483b3.js";import{aC as le}from"./antd-15ac76ed.js";import{au as re,av as se,_ as ie}from"./index.js";import{e as ne}from"./download-03e71dd5.js";import{o as ce,h as de,B as ue,C as pe,D as he}from"./monitorApi-44e70004.js";import"./index-d8a2358f.js";import{d as fe,k as r,I as me,o as ye,al as S,Z as be,_ as ve,f as h,aa as g,$ as c,ad as xe,u as C,E as z,aG as ge,aH as we}from"./vue-71d1abb3.js";import{i as _e}from"./install-58e0bd81.js";import"./index-3801a970.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";const N=y=>(ge("data-v-02c41f6f"),y=y(),we(),y),Se={class:"real-time-analysis"},Ce={class:"right-box"},Ae={class:"box-header"},Ie={class:"header-left"},Te={class:"header-right"},ke=N(()=>c("div",{class:"box-content"},[c("div",{class:"chart-box"},[c("div",{id:"customerChart",style:{width:"1300px",height:"320px"}})])],-1)),Ke={class:"right-row-box"},Be={class:"data-table-box"},Oe=N(()=>c("div",{class:"table-title-line"},null,-1)),Ee=fe({__name:"areaRealTimeAnalysis",setup(y){const{createConfirm:A}=re(),f=r([]),w=r([]),n=r(""),_=r([]);function I(){return p(this,null,function*(){let e=yield ce();_.value=e,setTimeout(()=>{w.value=[e[0].id,e[0].children[0].id],f.value=[e[0].children[0].id],n.value=e[0].children[0].id,E(),B(),K()},500)})}function v(){return p(this,arguments,function*(e={}){n.value=null,e.id!=null&&e.nodeKindId=="station"&&(n.value=e.powerStationId,E(),B(),K())})}const l=r(["all"]),b=r([]),E=()=>p(this,null,function*(){let e=yield de({stationId:n.value});if(e!=null&&e.length){l.value=["all"];let t=[{label:"全部区域",value:"all"}];e.forEach(o=>{t.push({value:o.id,label:o.name})}),b.value=t}}),V=e=>{console.log(`selected ${e}`),e.length>1&&e.includes("all")?e[e.length-1]==="all"?l.value=["all"]:l.value=e.slice(1):l.value=e,K(),B()},$=(e,t)=>t.label.indexOf(e)>=0,G=()=>p(this,null,function*(){A({title:"提示",iconType:"warning",content:"确定要导出所有记录？",onOk(){return p(this,null,function*(){yield ue({stationId:n.value}).then(t=>{ne(t==null?void 0:t.data,"区域实时数据.xls")})})}})}),s=r({label:"等效小时数",value:"ppr",dataKind:"bar"}),J=r([{label:"装机容量",value:"installedCapacity",dataKind:"bar"},{label:"等效小时数",value:"ppr",dataKind:"bar"},{label:"输入功率",value:"inputPower",dataKind:"line"},{label:"输出功率",value:"activePower",dataKind:"line"},{label:"kw输出功率",value:"kwActivePower",dataKind:"line"},{label:"峰值输出功率",value:"topActivePower",dataKind:"bar"},{label:"日发电量",value:"outputPowerDay",dataKind:"bar"},{label:"无功功率",value:"reactivePower",dataKind:"line"}]);function H(e,t){return p(this,null,function*(){s.value=t,D()})}const Z=[{title:"区域",dataIndex:"areaName",width:100},{title:"装机容量(kWp)",dataIndex:"installedCapacity",sorter:!0,width:100},{title:"等效小时数(h)",dataIndex:"ppr",sorter:!0,width:100},{title:"输入功率(kW) ",dataIndex:"inputPower",sorter:!0,width:100},{title:"输出功率(kW)",dataIndex:"activePower",sorter:!0,width:100},{title:"kw输出功率(kW)",dataIndex:"kwActivePower",sorter:!0,width:100},{title:"峰值输出功率(kW)",dataIndex:"topActivePower",sorter:!0,width:100},{title:"日发电量(kWh)",dataIndex:"outputPowerDay",sorter:!0,width:100},{title:"无功功率(kVar)",dataIndex:"reactivePower",sorter:!0,width:100}],M=r(),U=r(),T=r("area_code"),k=r("asc"),L=()=>p(this,null,function*(){let e={stationId:n.value,areaIds:l.value,sortColumn:T.value,sortRule:k.value},t=yield he(e);return M.value=t,t}),[Y,{reload:K}]=oe({api:L,title:"数据列表",columns:Z,bordered:!0,pagination:{pageSize:20,pageSizeOptions:["20","50","100","200"]},showTableSetting:!0,tableSetting:{fullScreen:!1,redo:!1,size:!1},sortFn:e=>{e.order?(T.value=e.field,k.value=e.order.replace("end","")):(T.value="area_code",k.value="asc"),L()}}),W=r(!1),j={color:["#1729F6","#FCAB28","#09D963","#FF1EE9","#B32630","#009588","#C9930F","#FF5906","#f3a33f","#fe8466","#8A69FF","#FF7669"],tooltip:{show:!0,trigger:"axis",formatter:"台",axisPointer:{type:"line",lineStyle:{type:"dashed",color:"rgba(1,180,241,.5)"},crossStyle:{type:"dashed",color:"rgba(1,180,241,.5)"}},backgroundColor:" #f5fbfb",borderColor:"#c6ecea",borderWidth:1},dataZoom:[{type:"inside"}],legend:{top:20,right:200,padding:[10,0],itemGap:14,itemWidth:14,itemHeight:10,textStyle:{color:"#bce2e3"}},grid:{top:70,bottom:30,left:40,right:10},xAxis:{type:"category",boundaryGap:!0,axisTick:{alignWithLabel:!0,show:!1},axisLine:{lineStyle:{color:"#ccc"}},axisLabel:{color:"#888"}},yAxis:{type:"value",nameTextStyle:{color:"#888"},axisLine:{show:!0,lineStyle:{color:"#ccc"}},axisLabel:{color:"#888",formatter:"{value}"},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgba(0, 0, 0, .1)",type:"dashed"}}}},q={dataZoom:[{type:"inside"}],tooltip:{trigger:"axis",axisPointer:{type:"line",lineStyle:{type:"dashed",color:"rgba(1,180,241,.5)"},crossStyle:{type:"dashed",color:"rgba(1,180,241,.5)"}},textStyle:{color:"#666"},backgroundColor:"#f5fbfb",borderColor:"#c6ecea",borderWidth:1,formatter:e=>'<p style="text-align: left; line-height: 20px;font-size:12px;">'+e[0].axisValue+'</p> <p style="font-size:12px;">日发电量  <span style="color: #3dd4cc;font-size:13px;">'+e[0].data+"</span> kWh</p>"},grid:{top:70,bottom:30,left:40,right:10},xAxis:[{type:"category",boundaryGap:!0,axisTick:{alignWithLabel:!0,show:!1},axisLine:{lineStyle:{color:"#ccc"}},axisLabel:{color:"#888"}}],yAxis:[{type:"value",name:"kWh",nameTextStyle:{color:"#888"},axisLine:{show:!0,lineStyle:{color:"#ccc"}},axisLabel:{color:"#888",formatter:"{value}"},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgba(0, 0, 0, .1)",type:"dashed"}}}],series:[{name:"日发电量",type:"bar",color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(73,207,246,.8)"},{offset:1,color:"#49b5f6"}]},barWidth:14,barGap:"20%",showSymbol:null,smooth:".6",lineStyle:{color:"#01d2f1"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(255, 227, 151, .3)"},{offset:1,color:"rgba(255, 227, 151, .1)"}],globalCoord:!0}},itemStyle:{normal:{barBorderRadius:[2,2,0,0],shadowColor:"rgba(0,0,0,0.1)",shadowBlur:3,shadowOffsetY:3}}}]},P=r(""),R=r(""),D=()=>p(this,null,function*(){if(n.value==null||s.value==null)return;s.value.dataKind=="bar"&&(P.value=s.value.value,R.value="desc");let e={stationId:n.value,showData:s.value.value,dataKind:s.value.dataKind,sortColumn:P.value,sortRule:R.value,areaIds:l.value},t=yield pe(e);t!=null&&s.value.dataKind=="line"?X(t):t!=null&&s.value.dataKind=="bar"&&Q(t,s.value.value)});function B(){D()}const x=me({});function X(e){let t=JSON.parse(JSON.stringify(j)),o=[],u=[],i=e;x.value={},W.value=!0,e.data&&(t.xAxis.data=i.x,t.yAxis.name=i.unit,i.data.forEach(a=>{let d;u.push(a.name),i.chartType==="bar"?d={name:a.name,type:i.chartType,barWidth:14,data:a.y}:d={name:a.name,type:i.chartType,smooth:.5,showSymbol:!1,symbolSize:8,lineStyle:{width:2,shadowColor:"rgba(0, 0, 0, .6)"},connectNulls:!0,data:a.y},o.push(d)}),t.legend.data=u,t.legend.show=!1,t.series=o,t.tooltip.formatter=a=>{let d=[`<label class="chart-tooltip-label">${a[0].axisValue}</label><br/>`];for(let m=0;m<a.length;m++){let ee=i.unit,O=null;a[m].data!=null||a[m].data!=null?O=Number(a[m].data):O="--",d.push(`<span class="chart-tooltip-item">${a[m].seriesName} <span style="color:${a[m].color};font-weight:bold;">${O}</span> ${ee}</span><br/>`)}return d.join("")},F(document.getElementById("customerChart"),t))}function Q(e,t){let o=JSON.parse(JSON.stringify(q)),u=[],i=s.value.label;W.value=!0,o.xAxis[0].data=e.x,o.yAxis[0].name=e.unit,o.tooltip.formatter=a=>'<p style="text-align: left;color:#666;opacity: .8; line-height: 20px;font-size:12px;">'+a[0].axisValue+'</p> <p style="font-size:12px;color:#666;">'+i+'  <span style="color: #3ccacc;font-size:13px;font-weight:bold;">'+a[0].data+"</span> "+e.unit+"</p>",u.push({name:i,type:"line",color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(64,202,192,0.7)"},{offset:1,color:"#40caa1"}]},barWidth:30,barGap:"40%",showSymbol:null,smooth:!1,lineStyle:{color:"rgba(252,171,40,1)"},label:{show:"abcccccc",formatter:"{b}: {c}%",overflow:"break",textBorderType:"none",color:"#fff"},itemStyle:{normal:{barBorderRadius:[2,2,0,0],shadowColor:"rgba(0,0,0,0.1)",shadowBlur:3,shadowOffsetY:3}},data:e.y}),o.series=u,F(document.getElementById("customerChart"),o)}function F(e,t,o){const u=document.getElementById("customerChart");x.value=_e(u),x.value.setOption(t,!0),o&&o(x),window.addEventListener("resize",()=>{x.value.resize()})}return ye(()=>{I()}),(e,t)=>{const o=S("a-col"),u=S("a-select"),i=S("a-button"),a=S("a-row");return be(),ve("div",Se,[h(a,{class:"real-time-analysis-row",type:"flex",wrap:!1},{default:g(()=>[h(o,{flex:"298px"},{default:g(()=>[h(te,{toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,class:"fit-common-tree",title:"电站组织",value:_.value,fieldNames:{key:"id",title:"name"},onSelect:v,selectedKeys:f.value,expandedKeys:w.value},null,8,["value","selectedKeys","expandedKeys"])]),_:1}),h(o,{flex:"auto"},{default:g(()=>[c("div",Ce,[c("div",{id:"chart-box-content",class:"right-row-box chart-box-content",ref_key:"chartBoxContent",ref:U},[c("div",Ae,[c("div",Ie,xe(s.value.label),1),c("div",Te,[h(C(le),{value:l.value,"onUpdate:value":t[0]||(t[0]=d=>l.value=d),mode:"multiple",style:{"min-width":"206px"},placeholder:"选择区域",options:b.value,"max-tag-count":2,"filter-option":$,showArrow:"",onChange:V},null,8,["value","options"]),z("   "),h(u,{value:s.value,"onUpdate:value":t[1]||(t[1]=d=>s.value=d),"allow-clear":"",style:{"min-width":"206px"},placeholder:"选择指标项",options:J.value,showArrow:"",onChange:H},null,8,["value","options"])])]),ke],512),c("div",Ke,[c("div",Be,[Oe,h(C(ae),{onRegister:C(Y)},{toolbar:g(()=>[h(i,{style:{"margin-top":"-9px"},class:"yellow-btn",onClick:G,preIcon:C(se).EXPORT},{default:g(()=>[z(" 导出 ")]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])])])])]),_:1})]),_:1})])}}});const it=ie(Ee,[["__scopeId","data-v-02c41f6f"]]);export{it as default};
//# sourceMappingURL=areaRealTimeAnalysis-4b16c6a3.js.map
