var r=(m,b,y)=>new Promise((i,_)=>{var T=p=>{try{C(y.next(p))}catch(I){_(I)}},F=p=>{try{C(y.throw(p))}catch(I){_(I)}},C=p=>p.done?i(p.value):Promise.resolve(p.value).then(T,F);C((y=y.apply(m,b)).next())});import{au as Ne,ad as E,I as Oe,av as Ae,_ as Ee}from"./index.js";import{B as Le}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as Re}from"./useTable-109483b3.js";import{aC as Y,aD as L,aH as oe}from"./antd-15ac76ed.js";import Pe from"./deviceDialog-59d49a92.js";import{e as Fe}from"./download-03e71dd5.js";import{g as Ue,h as ze,c as Be,p as Ve,e as Me,f as Ye,m as $e}from"./monitorApi-44e70004.js";import{d as Ge,k as s,w as He,r as We,o as je,al as ne,Z as x,a9 as ie,aa as d,$ as l,f as u,u as c,E as re,ad as w,_ as R,F as Xe,ae as Ze,a5 as P,ac as $,aG as qe,aH as Je}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./deviceWarning-620b5d81.js";import"./dataDetail-62a9c747.js";import"./EchartLineChart.vue_vue_type_style_index_0_lang-c85cdf3b.js";import"./install-58e0bd81.js";import"./helper-474c7a04.js";import"./api-32c7505d.js";import"./index-74ac3212.js";import"./Export2Excel-389a8fc9.js";import"./dataComparison-458260e7.js";const k=m=>(qe("data-v-e55dd1e0"),m=m(),Je(),m),Ke={class:"group-series-overview"},Qe={class:"area-box box-style"},ea={class:"area-hearder-box"},aa={class:"station-selector-box"},ta={class:"refresh-box"},sa={class:"area-content-box"},la={class:"content-header-box"},oa={class:"header-left"},na={class:"select-box"},ia=k(()=>l("div",{class:"select-label-box"},"区域",-1)),ra={class:"select-box"},ua=k(()=>l("div",{class:"select-label-box"},"类型",-1)),ca={class:"status-checkbox-group-box"},da=k(()=>l("span",{class:"status-label-text"},"设备状态",-1)),pa=k(()=>l("span",{class:"status-label-text"},"全部",-1)),va={class:"status-label-text"},ma=k(()=>l("span",{class:"status-label-text",style:{"margin-left":"50px"}},"   组串状态",-1)),ha=k(()=>l("span",null,"电流异常",-1)),ga={class:"device-table-box"},fa=["onClick"],G="GROUPS_SERIES",ba=Ge({__name:"groupSeriesOverview",props:{stationId:String,areaId:String},setup(m){const b=m,{createConfirm:y}=Ne(),i=s(),_=s([]),T=s(0),F=(e,a)=>r(this,null,function*(){i.value=e,v.value=[],yield W(),yield X(),f()}),C=(e,a)=>a.name.indexOf(e)>=0,p=(e,a)=>a.label.indexOf(e)>=0,I=()=>r(this,null,function*(){let e=yield Ue();e!=null&&e.length&&(_.value=e,i.value||(i.value=_.value[0].id,yield W(),yield X(),f()))}),v=s(["all"]),H=s([]),W=()=>r(this,null,function*(){let e=yield ze({stationId:i.value});if(e!=null&&e.length){v.value=["all"];let a=[{label:"全部区域",value:"all"}];e.forEach(n=>{a.push({value:n.id,label:n.name})}),H.value=a}}),ue=e=>{console.log(`selected ${e}`),e.length>1&&e.includes("all")?e[e.length-1]==="all"?v.value=["all"]:v.value=e.slice(1):v.value=e,f()},h=s([]),j=s([]),ce={StringFormation:{value:"StringFormation",label:"组串式逆变器"},CombinerDc:{value:"CombinerDc",label:"直流汇流箱"}},de=e=>{h.value=e,f()},X=()=>r(this,null,function*(){let e=yield Be({stationId:i.value}),a=[],n=["StringFormation","CombinerDc"],O=[];e!=null&&e.forEach(t=>{n.includes(t.deviceType)&&(a.push(ce[t.deviceType]),O.push(t.deviceType))}),j.value=a,h.value=O}),S=s([{label:"正常",value:"normal",number:585},{label:"告警",value:"alarm",number:1},{label:"通讯中断",value:"interrupt",number:1}]),D=s(!0),g=s(["normal","alarm","interrupt"]),N=s(!1),Z=s(""),pe=e=>{console.log("checkedValue",e),g.value=e,f()},ve=e=>{console.log("checkedValue",e),e.length>0?N.value=!0:N.value=!1,f()},me=e=>{g.value=e.target.checked?["normal","alarm","interrupt"]:[],f()};He(g,e=>{e.length===4||e.length===3&&!e.includes("abnormal_current")?D.value=!0:D.value=!1});const he=We({}),q=s([]),U=s([]),z=s(0);s("abnormal_current");const ge=()=>r(this,null,function*(){if(h.value.length==0||i.value==null)return;const e=we();let a=yield $e({stationId:i.value,areaIds:v.value,abnormalType:g.value,deviceTypeList:h.value,pageNo:e.current,pageSize:e.pageSize,isAbnormalCurrent:N.value});return console.log("getInverterData",a),Object.assign(he,a.abnormalInfo),S.value[0].number=a.normalNum,S.value[1].number=a.alarmNum,S.value[2].number=a.interruptNum,z.value=a.serialErrorNum,a!=null&&(U.value=a.headerList,q.value={list:a.dataPage,total:a.total},T.value=a.deviceNum,console.log("getDeviceData",a),fe()),q.value}),B=s([]),fe=()=>r(this,null,function*(){var a;let e=[{title:"状态",dataIndex:"abnormalTypesStr",width:120},{title:"更新时间",dataIndex:"time",width:150},{title:"区域",dataIndex:"areaName",width:120},{title:"设备名称",dataIndex:"deviceName",width:120},{title:"有功功率(kW)",dataIndex:"activePower",width:120}];((a=U.value)==null?void 0:a.length)>0&&U.value.forEach(n=>{e.push({title:n.value,dataIndex:n.key,width:50})}),B.value=e}),be={normal:"green",alarm:"red",interrupt:"grey",interrupt:"grey"},ye=(e,a)=>a[e.key]!=null&&a[e.key].isAlarm==1&&a[e.key].value!="--"?"red":"",[_e,{reload:f,reloadData:xe,getPaginationRef:we,setTableData:ya}]=Re({api:ge,columns:B,bordered:!0,pagination:{pageSize:20,pageSizeOptions:["20","50","100","200"]},tableSetting:{setting:!0,redo:!1,size:!1},showTableSetting:!0,showIndexColumn:!0}),ke=()=>r(this,null,function*(){y({title:"提示",iconType:"warning",content:"确定要导出所有记录？",onOk(){return r(this,null,function*(){try{let a={stationId:i.value,areaIds:v.value,abnormalType:g.value,deviceTypeList:h.value,isAbnormalCurrent:N.value};a.fileName="组串数据",a.excelList=B.value,yield Ve(a).then(n=>{Fe(n==null?void 0:n.data,a.fileName)})}catch(a){console.error("export group series data error:",a)}})}})});function Ce(e){Ie(e)}const V=s(!1),J=s(""),K=s({}),Ie=e=>{V.value=!0,J.value=e.esn,K.value=e,Te(e),Se(e)},Q=s([]),Te=e=>r(this,null,function*(){let a=yield Me({stationId:b.stationId,areaId:b.areaId,esn:e.esn,dataType:3});Q.value=a}),ee=s([]),ae=s(""),Se=e=>r(this,null,function*(){let a=yield Ye({stationId:b.stationId,areaId:b.areaId,esn:e.esn,dataType:1});ee.value=a.dataList,ae.value=a.showTimeStr}),M=s(!0),te=()=>r(this,null,function*(){console.info("refreshData:",Math.random());try{xe(void 0,!1)}catch(e){}}),De=e=>{var a;try{(a=e==null?void 0:e.target)!=null&&a.checked?E.getInstance().pushListTask(G,te,5e3):E.getInstance().removeListTask(G)}catch(n){}};return je(()=>{I(),E.getInstance().start(),M.value&&E.getInstance().pushListTask(G,te,5e3)}),(e,a)=>{const n=ne("a-button"),O=ne("PageWrapper");return x(),ie(O,{fixedHeight:"",contentClass:"flex",style:{overflow:"hidden"}},{default:d(()=>[l("div",Ke,[l("div",Qe,[l("div",ea,[l("div",aa,[u(Oe,{class:"icon-left",icon:"mdi:house-city",color:"#1890FF",size:15}),u(c(Y),{style:{width:"200px"},value:i.value,"onUpdate:value":a[0]||(a[0]=t=>i.value=t),"show-search":"",options:_.value,"filter-option":C,fieldNames:{value:"id",label:"name"},onChange:F},null,8,["value","options"])]),l("div",ta,[u(c(L),{checked:M.value,"onUpdate:checked":a[1]||(a[1]=t=>M.value=t),onChange:De},{default:d(()=>[re("自动刷新")]),_:1},8,["checked"])])]),l("div",sa,[l("div",la,[l("div",oa,[l("div",na,[ia,u(c(Y),{value:v.value,"onUpdate:value":a[2]||(a[2]=t=>v.value=t),mode:"multiple",style:{"min-width":"256px"},placeholder:"选择区域",options:H.value,"max-tag-count":2,"filter-option":p,showArrow:"",onChange:ue},null,8,["value","options"])]),l("div",ra,[ua,u(c(Y),{value:h.value,"onUpdate:value":a[3]||(a[3]=t=>h.value=t),mode:"multiple",style:{"min-width":"256px"},placeholder:"选择类型",options:j.value,showArrow:"",onChange:de},null,8,["value","options"])]),l("div",ca,[da,u(c(L),{checked:D.value,"onUpdate:checked":a[4]||(a[4]=t=>D.value=t),onChange:me},{default:d(()=>[pa,l("span",null,w(T.value),1)]),_:1},8,["checked"]),u(c(oe),{value:g.value,"onUpdate:value":a[5]||(a[5]=t=>g.value=t),onChange:pe},{default:d(()=>[(x(!0),R(Xe,null,Ze(S.value,(t,o)=>(x(),ie(c(L),{key:o,value:t.value},{default:d(()=>[l("span",va,w(t.label),1),l("span",{class:P({"red-text":t.value!=="normal"&&t.number>0})},w(t.number),3)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),ma,u(c(oe),{value:Z.value,"onUpdate:value":a[6]||(a[6]=t=>Z.value=t),onChange:ve},{default:d(()=>[u(c(L),{value:"abnormalCurrent"},{default:d(()=>[ha,l("span",{class:P({"red-text":z.value>0})},w(z.value),3)]),_:1})]),_:1},8,["value"])])])]),l("div",ga,[u(c(Le),{onRegister:c(_e)},{toolbar:d(()=>[u(n,{class:"yellow-btn",preIcon:c(Ae).EXPORT,onClick:ke},{default:d(()=>[re("导出")]),_:1},8,["preIcon"])]),bodyCell:d(({text:t,column:o,record:A})=>{var se,le;return[(o==null?void 0:o.key)==="abnormalTypesStr"?(x(),R("span",{key:0,class:P(["status-icon",be[A.deviceShowFlag]])},null,2)):$("",!0),(o==null?void 0:o.key)==="deviceName"?(x(),R("a",{key:1,onClick:_a=>Ce(A)},w(t),9,fa)):$("",!0),(se=o==null?void 0:o.key)!=null&&se.match(/^[i]\d{1,}$/)?(x(),R("span",{key:2,class:P(["table-cell-text",ye(o,A)])},w((le=A[o==null?void 0:o.key])==null?void 0:le.value),3)):$("",!0)]}),_:1},8,["onRegister"])])])]),u(Pe,{title:J.value,visible:V.value,ycData:Q.value,yxData:ee.value,yxTime:ae.value,data:K.value,"onUpdate:visible":a[7]||(a[7]=t=>V.value=t)},null,8,["title","visible","ycData","yxData","yxTime","data"])])]),_:1})}}});const at=Ee(ba,[["__scopeId","data-v-e55dd1e0"]]);export{at as default};
//# sourceMappingURL=groupSeriesOverview-9cd81d48.js.map
