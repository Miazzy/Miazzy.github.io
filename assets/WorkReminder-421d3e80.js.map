{"version":3,"file":"WorkReminder-421d3e80.js","sources":["../../src/views/workbench/WorkReminder.vue"],"sourcesContent":["<template>\n  <a-card title=\"工作安排\" :bordered=\"false\">\n    <template #extra>\n      <span @click=\"handleRecordView\">更多 &gt;</span>\n    </template>\n    <div class=\"card-content\">\n      <div class=\"table-box\">\n        <BasicTable @register=\"registerWorkReminderTable\">\n          <template #bodyCell=\"{ text, column, record }\">\n            <template v-if=\"column.dataIndex === 'content'\">\n              <a v-if=\"record.url\" @click=\"handleView(record)\" :title=\"text\">\n                {{ text }}\n              </a>\n              <span v-else :title=\"text\">{{ text }}</span>\n            </template>\n            <template v-if=\"column.dataIndex === 'status'\">\n              <span\n                v-if=\"record.type === 'site_work'\"\n                :class=\"statusColors[record.status]\"\n                style=\"cursor: pointer\"\n                @click=\"handleClick(record)\"\n                >{{ record.statusText }}</span\n              >\n              <span v-else :class=\"statusColors[record.status]\">{{ record.statusText }}</span>\n            </template>\n          </template>\n        </BasicTable>\n      </div>\n    </div>\n  </a-card>\n\n  <Dialog\n    v-model:visible=\"modal.open\"\n    title=\"工作安排\"\n    smode=\"default\"\n    @ok=\"handleSuccess\"\n    @cancel=\"handleCancel\"\n    :width=\"520\"\n    :height=\"380\"\n  >\n    <a-form ref=\"modalFormRef\" :model=\"formState\" name=\"recordForm\" autocomplete=\"off\">\n      <a-row>\n        <a-col v-show=\"true\" :span=\"24\">\n          <a-form-item\n            label=\"类型\"\n            name=\"typeText\"\n            :labelCol=\"{ style: { width: '124px' } }\"\n            :rules=\"[{ required: false }]\"\n          >\n            <a-input v-model:value=\"formState.typeText\" :disabled=\"true\" />\n          </a-form-item>\n        </a-col>\n      </a-row>\n      <a-row>\n        <a-col v-show=\"true\" :span=\"24\">\n          <a-form-item\n            label=\"内容\"\n            name=\"content\"\n            :labelCol=\"{ style: { width: '124px' } }\"\n            :rules=\"[{ required: false }]\"\n          >\n            <a-input v-model:value=\"formState.content\" :disabled=\"true\" />\n          </a-form-item>\n        </a-col>\n      </a-row>\n      <a-row>\n        <a-col v-show=\"true\" :span=\"24\">\n          <a-form-item\n            label=\"执行时间\"\n            name=\"executionTime\"\n            :labelCol=\"{ style: { width: '124px' } }\"\n            :rules=\"[{ required: true }]\"\n          >\n            <a-time-picker\n              v-model:value=\"formState.executionTime\"\n              style=\"width: 100%\"\n              format=\"HH:mm\"\n              value-format=\"HH:mm\"\n            />\n          </a-form-item>\n        </a-col>\n      </a-row>\n      <a-row>\n        <a-col v-show=\"true\" :span=\"24\">\n          <a-form-item\n            label=\"状态\"\n            name=\"status\"\n            :labelCol=\"{ style: { width: '124px' } }\"\n            :rules=\"[{ required: true, message: '请选择状态！' }]\"\n          >\n            <DictRadioGroup v-model:value=\"formState.status\" :type=\"`work_record_status`\" />\n          </a-form-item>\n        </a-col>\n      </a-row>\n    </a-form>\n  </Dialog>\n</template>\n\n<script lang=\"ts\" setup>\n  import { ref, reactive, onMounted } from 'vue';\n  import dayjs from 'dayjs';\n  import { assign } from 'lodash-es';\n  import { FormInstance } from 'ant-design-vue';\n  import Dialog from '@/components/Framework/Modal/Dialog.vue';\n  import { BasicTable, useTable, BasicColumn } from '@/components/Table';\n  import DictRadioGroup from '@/components/Framework/Radio/DictRadioGroup.vue';\n  import { addTabPage } from '@/utils/route';\n  import { SysMessage } from '@/hooks/web/useMessage';\n  import { getWorkRecord, getWorkRecordPage, saveWorkRecord } from './data';\n  import { MsgManager } from '/@/message/MsgManager';\n\n  const modal = reactive({\n    open: ref<boolean>(false),\n  });\n  const loadingFlag = ref<boolean>(false);\n  const modalFormRef = ref<FormInstance>();\n  const formState = reactive<any>({});\n  const statusColors = {\n    '0': 'red-text',\n    '1': 'blue-text',\n  };\n\n  const tableColumns: BasicColumn[] = [\n    {\n      title: '类型',\n      dataIndex: 'type',\n      width: 80,\n      customRender: ({ record }) => {\n        return record.typeText;\n      },\n    },\n    {\n      title: '内容',\n      dataIndex: 'content',\n      headAlign: 'center',\n      align: 'left',\n      width: 220,\n    },\n    {\n      title: '时间',\n      dataIndex: 'reminderTime',\n      width: 100,\n    },\n    {\n      title: '状态',\n      dataIndex: 'status',\n      width: 60,\n    },\n  ];\n\n  const getListByParam = async () => {\n    const workDate = dayjs().format('YYYY-MM-DD');\n    return await getWorkRecordPage({ workDate: workDate });\n  };\n\n  const [registerWorkReminderTable, { reload }] = useTable({\n    api: getListByParam,\n    columns: tableColumns,\n    pagination: false,\n    striped: false,\n    useSearchForm: false,\n    showTableSetting: false,\n    bordered: false,\n    showIndexColumn: true,\n    canResize: false,\n  });\n\n  const handleSuccess = async () => {\n    const value = modalFormRef.value;\n    if (value) {\n      value.validateFields().then(async () => {\n        loadingFlag.value = true;\n        await saveWorkRecord(formState)\n          .then(() => {\n            SysMessage.getInstance().success('保存成功');\n            reload();\n            modal.open = false;\n            loadingFlag.value = false;\n          })\n          .catch(() => {\n            loadingFlag.value = false;\n          });\n      });\n    }\n  };\n\n  const handleCancel = () => {\n    modal.open = false;\n  };\n\n  const handleClick = async (record) => {\n    const data = await getWorkRecord(record.workScheduleId, record.stationId);\n    if (data.id) {\n      assign(formState, data);\n      formState.type = record.type;\n      formState.typeText = record.typeText;\n      formState.content = record.content;\n    } else {\n      assign(formState, record);\n    }\n    formState.status = data.status ? String(data.status) : null;\n    modal.open = true;\n  };\n\n  const handleView = (record) => {\n    addTabPage(record.url);\n  };\n\n  const handleRecordView = () => {\n    addTabPage('/oa/schedule/work/record/index');\n  };\n\n  onMounted(() => {\n    MsgManager.getInstance().listen('home-page-work-schedule', () => {\n      reload();\n    });\n  });\n</script>\n\n<style lang=\"less\" scoped>\n  .set-class {\n    margin-right: 8px;\n    font-size: 17px !important;\n  }\n\n  .card-content {\n    height: 318px;\n    padding: 16px 0;\n\n    :deep(.vben-basic-table .ant-table-wrapper) {\n      padding: 0;\n    }\n\n    :deep(.ant-table-thead th.text-center) {\n      text-align: center !important;\n    }\n\n    .table-box {\n      height: 286px;\n      overflow: hidden;\n\n      .blue-text {\n        color: rgb(24 144 255 / 85%);\n      }\n\n      .red-text {\n        color: rgb(240 3 31 / 85%);\n      }\n\n      :deep(.ant-table-body) {\n        height: 248px;\n      }\n\n      :deep(.ant-table-expanded-row-fixed .ant-empty-normal) {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        height: 160px;\n      }\n    }\n  }\n</style>\n"],"names":["modal","reactive","ref","loadingFlag","modalFormRef","formState","statusColors","tableColumns","record","getListByParam","__async","workDate","dayjs","getWorkRecordPage","registerWorkReminderTable","reload","useTable","handleSuccess","value","saveWorkRecord","SysMessage","handleCancel","handleClick","data","getWorkRecord","assign","handleView","addTabPage","handleRecordView","onMounted","MsgManager"],"mappings":"23CA+GE,MAAMA,EAAQC,EAAS,CACrB,KAAMC,EAAa,EAAK,CAAA,CACzB,EACKC,EAAcD,EAAa,EAAK,EAChCE,EAAeF,IACfG,EAAYJ,EAAc,CAAA,CAAE,EAC5BK,EAAe,CACnB,EAAK,WACL,EAAK,WAAA,EAGDC,EAA8B,CAClC,CACE,MAAO,KACP,UAAW,OACX,MAAO,GACP,aAAc,CAAC,CAAE,OAAAC,KACRA,EAAO,QAElB,EACA,CACE,MAAO,KACP,UAAW,UACX,UAAW,SACX,MAAO,OACP,MAAO,GACT,EACA,CACE,MAAO,KACP,UAAW,eACX,MAAO,GACT,EACA,CACE,MAAO,KACP,UAAW,SACX,MAAO,EACT,CAAA,EAGIC,EAAiB,IAAYC,EAAA,sBACjC,MAAMC,EAAWC,EAAA,EAAQ,OAAO,YAAY,EAC5C,OAAO,MAAMC,GAAkB,CAAE,SAAAF,CAAA,CAAoB,CAAA,GAGjD,CAACG,EAA2B,CAAE,OAAAC,CAAQ,CAAA,EAAIC,EAAS,CACvD,IAAKP,EACL,QAASF,EACT,WAAY,GACZ,QAAS,GACT,cAAe,GACf,iBAAkB,GAClB,SAAU,GACV,gBAAiB,GACjB,UAAW,EAAA,CACZ,EAEKU,EAAgB,IAAYP,EAAA,sBAChC,MAAMQ,EAAQd,EAAa,MACvBc,GACIA,EAAA,iBAAiB,KAAK,IAAYR,EAAA,sBACtCP,EAAY,MAAQ,GACpB,MAAMgB,GAAed,CAAS,EAC3B,KAAK,IAAM,CACCe,GAAA,YAAA,EAAc,QAAQ,MAAM,EAChCL,IACPf,EAAM,KAAO,GACbG,EAAY,MAAQ,EAAA,CACrB,EACA,MAAM,IAAM,CACXA,EAAY,MAAQ,EAAA,CACrB,CAAA,EACJ,CACH,GAGIkB,EAAe,IAAM,CACzBrB,EAAM,KAAO,EAAA,EAGTsB,EAAqBd,GAAWE,EAAA,sBACpC,MAAMa,EAAO,MAAMC,GAAchB,EAAO,eAAgBA,EAAO,SAAS,EACpEe,EAAK,IACPE,EAAOpB,EAAWkB,CAAI,EACtBlB,EAAU,KAAOG,EAAO,KACxBH,EAAU,SAAWG,EAAO,SAC5BH,EAAU,QAAUG,EAAO,SAE3BiB,EAAOpB,EAAWG,CAAM,EAE1BH,EAAU,OAASkB,EAAK,OAAS,OAAOA,EAAK,MAAM,EAAI,KACvDvB,EAAM,KAAO,EAAA,GAGT0B,EAAclB,GAAW,CAC7BmB,EAAWnB,EAAO,GAAG,CAAA,EAGjBoB,EAAmB,IAAM,CAC7BD,EAAW,gCAAgC,CAAA,EAG7C,OAAAE,EAAU,IAAM,CACdC,EAAW,YAAY,EAAE,OAAO,0BAA2B,IAAM,CACxDf,GAAA,CACR,CAAA,CACF"}