var c=(v,s,a)=>new Promise((u,o)=>{var f=i=>{try{r(a.next(i))}catch(d){o(d)}},h=i=>{try{r(a.throw(i))}catch(d){o(d)}},r=i=>i.done?u(i.value):Promise.resolve(i.value).then(f,h);r((a=a.apply(v,s)).next())});import{C as L}from"./CommonTree-c4ed7838.js";import{P as V}from"./index-20519caf.js";import{B as A}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as j}from"./useTable-109483b3.js";import{a2 as I}from"./antd-15ac76ed.js";import{b as H,au as K,a7 as W,av as _,ax as X,az as Z,aA as $,_ as q}from"./index.js";import{e as G}from"./download-03e71dd5.js";import{g as J,a as Q,e as U,c as Y,s as ee,b as te}from"./data-f99de3f0.js";import{a as y}from"./assign-37f1c13d.js";import{d as ae,r as x,k as N,o as oe,al as ne,Z as re,a9 as ie,aa as p,f as m,$ as se,u as n,E as b,ad as w}from"./vue-71d1abb3.js";import"./index-3801a970.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useRender-21ce56fb.js";const le={class:"right-table-layout"},ce=ae({__name:"index",setup(v){const{t:s}=H(),a=x({}),u=N([]),o=x({}),{createConfirm:f,createMessage:h}=K();let r=N("");oe(()=>{i(),W.getInstance().listen("infoarchive",g)});function i(){return c(this,null,function*(){u.value=yield J({}),g()})}function d(e){a.stationOrganId=null,a.stationId=null,a.periodId=null,e&&(a.stationOrganId=e.organId,a.stationId=e.powerStationId,a.periodId=e.powerStationPeriodId,o.stationOrganId=e.organId,o.stationOrganName=e.organName,o.stationId=e.powerStationId,o.stationName=e.powerStationName,o.periodId=e.powerStationPeriodId,o.periodName=e.powerStationPeriodName,o.nodeKindId=e.nodeKindId),g()}const C=()=>c(this,null,function*(){const e=F(),t=x({});return y(t,a),t.pageNo=e.current,t.pageSize=e.pageSize,t.order||(t.field="fillinDate",t.order="desc"),yield te(t)}),[O,{reload:g,getSelectRows:T,getPaginationRef:F}]=j({title:"信息档案列表",api:C,columns:Y,formConfig:ee,useSearchForm:!0,fetchSetting:{listField:"list",pageField:"pageNo",sizeField:"pageSize",totalField:"total"},handleSearchInfoFn(e){return y(a,e),e},sortFn:e=>{e.order?(a.sortField=e.field,a.sortOrder=e.order.replace("end","")):(a.sortField="",a.sortOrder="")},bordered:!0,pagination:{pageSize:20},showIndexColumn:!0,showTableSetting:!0,tableSetting:{fullScreen:!0},rowSelection:{type:"radio",fixed:!0,onSelect:R}});function P(){if(!o.periodId){I.error("请先选择电站分期。");return}X("/po/integrated/infoarchive/create","添加信息档案",{stationOrganId:o.stationOrganId,stationOrganName:o.stationOrganName,stationId:o.stationId,stationName:o.stationName,periodId:o.periodId,periodName:o.periodName,id:""})}function k(e){Z(e.id)}function D({keys:e,rows:t}){if(t&&t.length>0){const l=t[0];r.value=l.id}else r.value=""}function R(e,t){t?r.value=e.id:r.value=""}function E(){const e=T();return e.length==0?(I.error("请选择一行数据"),!1):e[0]}function z(){return c(this,null,function*(){const e=E();if(!e.id)return;const t=yield Q({id:e.id});f({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return c(this,null,function*(){if(t.result.status!=0){I.error("非草稿状态不能删除。");return}yield $(t.result.processInstanceId),I.success("已删除。"),g()})}})})}function B(){f({title:s("common.exportTitle"),iconType:"warning",content:s("common.message.exportMessage"),onOk(){return c(this,null,function*(){yield U(a).then(t=>{G(t==null?void 0:t.data,"信息档案.xls")}),h.success(s("common.exportSuccessText"))})}})}return(e,t)=>{const l=ne("a-button");return re(),ie(n(V),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:p(()=>[m(L,{title:"电站组织",onSelect:d,value:u.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),se("div",le,[m(n(A),{onRegister:n(O),class:"fix-basic-table",searchInfo:a,onResizeColumn:t[0]||(t[0]=(S,M)=>M.width=S),onRowDbClick:t[1]||(t[1]=S=>k(S)),onSelectionChange:D},{toolbar:p(()=>[m(l,{type:"primary",preIcon:n(_).ADD,onClick:P},{default:p(()=>[b(w(n(s)("common.action.create")),1)]),_:1},8,["preIcon"]),m(l,{class:"red-btn",disabled:n(r)=="",preIcon:n(_).DELETE,onClick:z},{default:p(()=>[b(w(n(s)("common.delText")),1)]),_:1},8,["disabled","preIcon"]),m(l,{class:"yellow-btn",preIcon:n(_).EXPORT,onClick:B},{default:p(()=>[b(w(n(s)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister","searchInfo"])])]),_:1})}}});const Ae=q(ce,[["__scopeId","data-v-5ce2bf3a"]]);export{Ae as default};
//# sourceMappingURL=index-3e779874.js.map
