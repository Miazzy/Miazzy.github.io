var u=(M,p,o)=>new Promise((b,v)=>{var _=d=>{try{n(o.next(d))}catch(f){v(f)}},k=d=>{try{n(o.throw(d))}catch(f){v(f)}},n=d=>d.done?b(d.value):Promise.resolve(d.value).then(_,k);n((o=o.apply(M,p)).next())});import{d as le,r as C,k as m,e as se,o as ie,al as r,Z as y,a9 as T,aa as l,$ as h,f as a,E as w,v as U,A,u as de,_ as L,ac as P}from"./vue-71d1abb3.js";import{B as re}from"./BillTitle-d17ab3e4.js";import{ak as ue,av as ce,a7 as me,bZ as pe,_ as _e}from"./index.js";import{j as fe,k as ve,a as ge,l as ye,m as he,n as be}from"./monthly-62dfedc7.js";import{a as xe}from"./assign-37f1c13d.js";import{a2 as j}from"./antd-15ac76ed.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-f4fc48e6.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./index-085d06c7.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useRender-21ce56fb.js";const Ie={class:"load"},Se={class:"process-box"},Ce={class:"header-box"},we={class:"content"},je={class:"left-panel"},ke={key:0},Ke={key:1},Te=le({name:"LeaveCreate",__name:"scoring",setup(M){const p=ue.getInstance().getQuery(),o=C({}),b=m(!1);m("");const v=m([]),_=m([]),k=m(),n=C({status:0}),d=C({}),f=m([]),D=m([]);d.infoItems=[];const V=()=>u(this,null,function*(){let t=yield he({evaluationTemplateId:n.evaluationTemplateId,indexKind:n.indexKind}),e=[];t.forEach(s=>{e.push({value:s.id,label:s.indexName})}),f.value=e}),z=()=>u(this,null,function*(){let t=yield be({monthlyEvaluationId:n.id}),e=[];t.forEach(s=>{e.push({value:s.stationId,label:s.stationName})}),D.value=e}),Y=t=>u(this,null,function*(){let e=parseInt(t.evaluationScore)+parseInt(t.adjustmentScore);e>t.tdMaxScore||e<0?(j.error("最终得分应在：【0 ~ "+t.tdMaxScore+"】之间。"),t.adjustmentScore=null,t.finalScore=null):t.finalScore=e}),$=()=>u(this,null,function*(){let t=!1;if(x.selectedRowKeys.length==0){j.error("请选择指标。");return}if(o.adjustmentScore==null){j.error("请输入调整分");return}_.value.forEach(e=>{if(x.selectedRowKeys.includes(e.id)){e.adjustmentScore=o.adjustmentScore;let s=parseInt(e.evaluationScore)+parseInt(e.adjustmentScore);s>e.tdMaxScore||s<0?(t=!0,e.adjustmentScore=null,e.finalScore=null):e.finalScore=s}}),t&&j.error("最终得分应在：【0~最大分值】之间。")});function H(){K()}function W(){o.evaluationTemplateDtlId=null,o.stationId=null}const x=C({selectedRowKeys:[],loading:!1});se(()=>x.selectedRowKeys.length>0);const Z=t=>{console.log("selectedRowKeys changed: ",t),x.selectedRowKeys=t},K=()=>u(this,null,function*(){let t={monthlyEvaluationId:n.id,stationId:o.stationId,evaluationTemplateDtlId:o.evaluationTemplateDtlId,indexKind:n.indexKind,sortField:o.sortField,sortOrder:o.sortOrder},e=yield fe(t);_.value=e}),q=(t,e,s)=>{s.order?(o.sortField=s.field,o.sortOrder=s.order.replace("end","")):(o.sortField="",o.sortOrder=""),K()},G=()=>{Q(1)},Q=t=>{n.scoringList=_.value,n.status=t,ve(n).then(()=>{setTimeout(function(){me.getInstance().sendMsg("scoring-evaluation",{}),pe(`/po/integrated/assessmentevaluation/monthly/create?id=${n.id}`)},200)}).catch(()=>{})},J=()=>u(this,null,function*(){let t=yield ge(n.id);ee(t),xe(n,t),V(),z(),K()}),X=()=>u(this,null,function*(){v.value=ye()}),ee=t=>u(this,null,function*(){let{billCode:e,fillinDate:s,personMemberName:I,deptName:c}=t;Object.assign(d,{billCode:e,fillinDate:s,personMemberName:I,deptName:c})});return ie(()=>u(this,null,function*(){yield X(),p.monthlyEvaluationId&&(n.id=p.monthlyEvaluationId,n.indexKind=p.indexKind,d.subject=p.kindName,J())})),(t,e)=>{const s=r("a-button"),I=r("a-input"),c=r("a-form-item"),F=r("a-col"),te=r("a-date-picker"),ae=r("a-row"),N=r("a-card"),B=r("a-form"),E=r("a-select"),R=r("a-input-number"),oe=r("a-table"),ne=r("PageWrapper");return y(),T(ne,{detail:!0,dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"fix-detail-page",style:{position:"relative"}},{default:l(()=>[h("div",Ie,[h("div",Se,[h("div",Ce,[a(re,{options:d},null,8,["options"]),a(s,{type:"primary",onClick:G},{default:l(()=>[w("保存")]),_:1})]),h("div",we,[h("div",je,[a(B,{ref_key:"templateFormRef",ref:k,model:n,name:"Form"},{default:l(()=>[a(N,{title:"基础信息",bordered:!1},{default:l(()=>[a(ae,{gutter:32},{default:l(()=>[U(a(F,{span:12},{default:l(()=>[a(c,{label:"主题",name:"subject",labelAlign:"right",labelCol:{span:4}},{default:l(()=>[a(I,{value:n.subject,"onUpdate:value":e[0]||(e[0]=i=>n.subject=i),disabled:"",style:{width:"100%"},maxlength:"128"},null,8,["value"])]),_:1})]),_:1},512),[[A,!0]]),U(a(F,{span:12},{default:l(()=>[a(c,{label:"评价周期",name:"evaluationPeriod",labelAlign:"right",labelCol:{span:4}},{default:l(()=>[a(te,{value:n.evaluationPeriod,"onUpdate:value":e[1]||(e[1]=i=>n.evaluationPeriod=i),"value-format":"YYYY-MM",disabled:"",onChange:t.changeReportDay,style:{"min-width":"100%"},picker:"month"},null,8,["value","onChange"])]),_:1})]),_:1},512),[[A,!0]])]),_:1})]),_:1})]),_:1},8,["model"]),a(N,{title:"指标评分",bordered:!1},{extra:l(()=>[a(B,{model:o,name:"indexSearch",layout:"inline",autocomplete:"off"},{default:l(()=>[a(c,{label:"指标",name:"indexId"},{default:l(()=>[a(E,{style:{width:"200px"},"allow-clear":"",value:o.evaluationTemplateDtlId,"onUpdate:value":e[2]||(e[2]=i=>o.evaluationTemplateDtlId=i),placeholder:"请选择评价指标",options:f.value},null,8,["value","options"])]),_:1}),a(c,{label:"电站",name:"evaluationMethod"},{default:l(()=>[a(E,{style:{width:"200px"},"allow-clear":"",value:o.stationId,"onUpdate:value":e[3]||(e[3]=i=>o.stationId=i),placeholder:"请选择电站",options:D.value},null,8,["value","options"])]),_:1}),a(c,null,{default:l(()=>[a(s,{class:"form-but",onClick:W},{default:l(()=>[w("重置")]),_:1}),a(s,{type:"primary",onClick:H},{default:l(()=>[w("查询")]),_:1})]),_:1}),a(c,{label:"调整分",name:"adjustmentScore"},{default:l(()=>[a(R,{value:o.adjustmentScore,"onUpdate:value":e[4]||(e[4]=i=>o.adjustmentScore=i)},null,8,["value"])]),_:1}),a(c,null,{default:l(()=>[a(s,{type:"primary",preIcon:de(ce).SETTING,onClick:$},{default:l(()=>[w("批量设置调整分")]),_:1},8,["preIcon"])]),_:1})]),_:1},8,["model"])]),default:l(()=>[a(oe,{style:{margin:"0 8px"},columns:v.value,"data-source":_.value,pagination:!1,size:"small",bordered:"",rowKey:"id","row-selection":{selectedRowKeys:t.selectedRowKeys,onChange:Z,fixed:!0},onChange:q,onResizeColumn:e[5]||(e[5]=(i,O)=>O.width=i),scroll:{x:480,y:480}},{bodyCell:l(({column:i,text:O,record:g})=>[i.dataIndex==="adjustmentScore"?(y(),L("div",ke,[(y(),T(R,{key:0,value:g[i.dataIndex],"onUpdate:value":S=>g[i.dataIndex]=S,onChange:S=>Y(g),max:9999,disabled:b.value,controls:!1},null,8,["value","onUpdate:value","onChange","disabled"]))])):P("",!0),i.dataIndex==="evaluationDesc"?(y(),L("div",Ke,[(y(),T(I,{key:0,value:g[i.dataIndex],"onUpdate:value":S=>g[i.dataIndex]=S,disabled:b.value,controls:!1,maxlength:"128"},null,8,["value","onUpdate:value","disabled"]))])):P("",!0)]),_:1},8,["columns","data-source","row-selection"])]),_:1})])])])])]),_:1})}}});const Xe=_e(Te,[["__scopeId","data-v-4d386ba5"]]);export{Xe as default};
//# sourceMappingURL=scoring-247b781a.js.map
