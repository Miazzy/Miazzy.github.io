var d=(S,F,N)=>new Promise((p,O)=>{var x=c=>{try{s(N.next(c))}catch(f){O(f)}},$=c=>{try{s(N.throw(c))}catch(f){O(f)}},s=c=>c.done?p(c.value):Promise.resolve(c.value).then(x,$);s((N=N.apply(S,F)).next())});import{au as je,ad as Y,I as U,av as qe,_ as Ke}from"./index.js";import{B as Xe}from"./BasicTable-0434a334.js";import{T as Ze}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as Je}from"./useTable-109483b3.js";import{aC as j,aD as ae,aF as Qe,aG as xe,aH as ea}from"./antd-15ac76ed.js";import aa from"./deviceItem-f8cae721.js";import ta from"./deviceDialog-59d49a92.js";import{e as la}from"./download-03e71dd5.js";import{g as oa,e as sa,f as na,h as ia,c as ra,i as ua,j as ca,k as da}from"./monitorApi-44e70004.js";import{d as va,k as l,w as pa,r as ma,o as ha,al as te,Z as v,a9 as P,aa as h,$ as o,f as r,u as i,E as le,ac as L,ad as q,_ as C,F as K,ae as oe,a5 as se,a6 as fa,aG as ga,aH as ba}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./deviceWarning-620b5d81.js";import"./dataDetail-62a9c747.js";import"./EchartLineChart.vue_vue_type_style_index_0_lang-c85cdf3b.js";import"./install-58e0bd81.js";import"./helper-474c7a04.js";import"./api-32c7505d.js";import"./index-74ac3212.js";import"./Export2Excel-389a8fc9.js";import"./dataComparison-458260e7.js";const W=S=>(ga("data-v-64d4f554"),S=S(),ba(),S),ya={class:"inverter-overview"},_a={class:"station-selector-box"},xa={class:"refresh-box"},wa={class:"area-content-box"},Ta={class:"header-left"},ka={class:"radio-btn-box"},Ia=W(()=>o("div",{class:"left-divider"},null,-1)),Ca={class:"select-box"},Sa={class:"select-box"},Da=W(()=>o("div",{class:"select-label-box"},"区域：",-1)),Ra={class:"select-box"},La=W(()=>o("div",{class:"select-label-box"},"类型：",-1)),Fa={class:"status-checkbox-group-box"},Na=W(()=>o("span",{class:"status-label-text"},"全部",-1)),Oa={class:"status-label-text"},Ba=W(()=>o("div",{class:"header-right"},null,-1)),za={class:"device-list-box"},Ea={key:0,class:"area-pagination-box"},Ha=["onClick"],Pa={key:1,class:"device-table-box"},Aa={class:"operation-btn-box"},ne="INVERTER_REFRESH",Ma=va({__name:"inverterOverview",props:{stationId:String,areaId:String},setup(S){const F=S,{createConfirm:N}=je(),p=l(),O=l([]),x=l(0),$=l(0);l(1);const s=l(1),c=l(24),f=l(1),we=(e,a)=>d(this,null,function*(){p.value=e,g.value=[],yield me(),yield fe(),s.value=1,I(),_()}),Te=(e,a)=>a.name.indexOf(e)>=0,ke=(e,a)=>a.label.indexOf(e)>=0,Ie=()=>d(this,null,function*(){let e=yield oa();e!=null&&e.length&&(O.value=e,p.value||(p.value=O.value[0].id,yield me(),yield fe()))}),X=l(!1),ie=l(""),re=l({}),ue=e=>{X.value=!0,ie.value=e.esn,re.value=e,Ce(e),Se(e)},ce=l([]),Ce=e=>d(this,null,function*(){let a=yield sa({stationId:F.stationId,areaId:F.areaId,esn:e.esn,dataType:3});ce.value=a}),de=l([]),ve=l(""),Se=e=>d(this,null,function*(){let a=yield na({stationId:F.stationId,areaId:F.areaId,esn:e.esn,dataType:1});de.value=a.dataList,ve.value=a.showTimeStr}),A=l("card"),B=l("valid_hours"),w=l("desc"),De=()=>{w.value==="asc"?w.value="desc":w.value="asc",s.value=1,I(),_()},Re=l([{value:"valid_hours",label:"等效小时数"},{value:"single_kw_elec",label:"单kW功率"},{value:"output_power_day",label:"日发电量"},{value:"active_power",label:"有功功率"}]),Le=e=>{console.log(`selected ${e}`),B.value=e,I(),_()},g=l(["all"]),pe=l([]),me=()=>d(this,null,function*(){let e=yield ia({stationId:p.value});if(e!=null&&e.length){g.value=["all"];let a=[{label:"全部区域",value:"all"}];e.forEach(n=>{a.push({value:n.id,label:n.name})}),pe.value=a}}),Fe=e=>{console.log(`selected ${e}`),e.length>1&&e.includes("all")?e[e.length-1]==="all"?g.value=["all"]:g.value=e.slice(1):g.value=e,s.value=1,I(),_()},Ne={StringFormation:{value:"StringFormation",label:"组串式"},Concentrate:{value:"Concentrate",label:"集中式"}},D=l([]),he=l([]),Oe=e=>{console.log(`selected ${e}`),D.value=e,s.value=1,I(),_()},fe=()=>d(this,null,function*(){let e=yield ra({stationId:p.value}),a=[],n=["StringFormation","Concentrate"],u=[];e!=null&&e.forEach(m=>{n.includes(m.deviceType)&&(a.push(Ne[m.deviceType]),u.push(m.deviceType))}),he.value=a,D.value=u}),b=l([{label:"正常",value:"normal",number:585},{label:"停机",value:"halt",number:1},{label:"告警",value:"alarm",number:1},{label:"通讯中断",value:"interrupt",number:1}]),Z=l(!0),T=l(["normal","halt","alarm","interrupt"]),Be=e=>{console.log("checkedValue",e),T.value=e,s.value=1,I(),_()},ze=e=>{T.value=e.target.checked?["normal","halt","alarm","interrupt"]:[],s.value=1,I(),_()};pa(T,e=>{Z.value=e.length===4});const Ee=l({deviceLabelKey:"deviceName",left:"pvTotal"}),V=e=>{s.value=e},y=ma({}),z=l([]),G=l([]),He=l([]),ge=l([{title:"状态",dataIndex:"abnormalTypesStr",width:150},{title:"设备名称",dataIndex:"deviceName",sorter:!0,width:150},{title:"容量(kWp)",dataIndex:"pvTotal",sorter:!0,width:150},{title:"输入功率(kW) ",dataIndex:"dcInputTotalPower",sorter:!0,width:150},{title:"有功功率(kW)",dataIndex:"activePower",sorter:!0,width:150},{title:"日发电量(kWh)",dataIndex:"outputPowerDay",sorter:!0,width:150},{title:"等效小时数(h) ",dataIndex:"validHours",sorter:!0,width:150},{title:"更新时间",dataIndex:"time",sorter:!0,width:150}]),Pe={正常:"green",告警:"red",通讯中断:"grey",停机:"white"},k=l([]),R=l(""),M=l("");l(!1);const _=()=>d(this,null,function*(){let e=B.value,a=w.value;R.value!==""&&(e=R.value,a=M.value),Me();let n={stationId:p.value,areaIds:g.value,abnormalType:T.value,deviceTypeList:D.value,sortType:a,sortField:e},u=yield ua(n);return b.value[0].number=y.normalNum,b.value[1].number=y.haltNum,b.value[2].number=y.alarmNum,b.value[3].number=y.interruptNum,V(s.value),k.value=u.dataList,{list:u.dataList,total:u.total}}),[Ae,{getPaginationRef:Me,reloadByDataSource:Ue,reloadApiDataByLocal:We}]=Je({dataSource:[],api:()=>d(this,null,function*(){var a;const e=(a=k==null?void 0:k.value)!=null&&a.length?k==null?void 0:k.value:z==null?void 0:z.value;return yield We(e)}),columns:ge,bordered:!0,actionColumn:{title:"操作",dataIndex:"action",slots:{customRender:"action"}},pagination:{pageSize:20,pageSizeOptions:["20","50","100","200"]},showTableSetting:!0,tableSetting:{setting:!0,redo:!1,size:!1},showIndexColumn:!0,sortFn:e=>{e.order?(R.value=e.field,M.value=e.order.replace("end","")):(R.value="",M.value=""),_()}}),$e=()=>d(this,null,function*(){N({title:"提示",iconType:"warning",content:"确定要导出所有记录？",onOk(){return d(this,null,function*(){R.value===""&&(R.value=B.value,M.value=w.value);let a={stationId:p.value,areaIds:g.value,abnormalType:T.value,deviceTypeList:D.value,sortType:M.value,sortField:R.value};a.fileName="逆变器数据",a.excelList=ge.value,yield ca(a).then(n=>{la(n==null?void 0:n.data,a.fileName)})})}})}),I=()=>d(this,null,function*(){var a,n;let e=yield da({stationId:p.value,areaIds:g.value,abnormalType:T.value,deviceTypeList:D.value,sortType:w.value,sortField:B.value});if(Object.assign(y,e.abnormalInfo),b.value[0].number=y.normalNum,b.value[1].number=y.haltNum,b.value[2].number=y.alarmNum,b.value[3].number=y.interruptNum,e!=null){if(z.value=e==null?void 0:e.dataList,x.value=(a=e.dataList)==null?void 0:a.length,$.value=(n=e.abnormalInfo)==null?void 0:n.deviceNum,He.value=e==null?void 0:e.showColumns,G.value=[],x.value>0){f.value=Math.ceil(x.value/c.value);for(let u=0;u<f.value;u++){let m=u*c.value,E=Math.min((u+1)*c.value,x.value);G.value.push(e.dataList.slice(m,E))}}console.info(s.value),V(s.value)}}),be=l(),ye=l(),_e=l(),J=l(""),Ve=()=>{J.value=`${i(be).offsetHeight-i(ye).offsetHeight-i(_e).offsetHeight-44}px`};function Ge(e){ue(e.record)}const Q=()=>d(this,null,function*(){console.info("refreshData:",Math.random());try{yield I(),yield _(),Ue(k.value)}catch(e){}}),ee=l(!0),Ye=e=>{var a;try{(a=e==null?void 0:e.target)!=null&&a.checked?Y.getInstance().pushListTask(ne,Q,5e3):Y.getInstance().removeListTask(ne)}catch(n){}};return ha(()=>d(this,null,function*(){Ve(),yield Ie(),Y.getInstance().start(),ee.value&&Y.getInstance().pushListTask(ne,Q,5e3),window.addEventListener("resize",()=>{const e=document.body.clientHeight,a=document.body.clientWidth,n=Math.floor((a-29)/208);J.value.slice(0,-2),c.value=Math.floor((e-168)/181)*n;let u=[];f.value=Math.ceil(x.value/c.value);for(let m=0;m<f.value;m++){let E=m*c.value,t=Math.min((m+1)*c.value,x.value);u.push(z.value.slice(E,t))}G.value=u}),window.dispatchEvent(new Event("resize")),yield Q()})),(e,a)=>{const n=te("a-pagination"),u=te("a-button"),m=te("PageWrapper");return v(),P(m,{fixedHeight:"",contentClass:"flex",style:{overflow:"hidden"}},{default:h(()=>{var E;return[o("div",ya,[o("div",{class:"area-box box-style",ref_key:"contentBoxRef",ref:be},[o("div",{class:"area-hearder-box",ref_key:"areaHearderBoxRef",ref:ye},[o("div",_a,[r(U,{class:"icon-left",icon:"mdi:house-city",color:"#1890FF",size:15}),r(i(j),{style:{width:"200px"},value:p.value,"onUpdate:value":a[0]||(a[0]=t=>p.value=t),"show-search":"",options:O.value,"filter-option":Te,fieldNames:{value:"id",label:"name"},onChange:we},null,8,["value","options"])]),o("div",xa,[r(i(ae),{checked:ee.value,"onUpdate:checked":a[1]||(a[1]=t=>ee.value=t),onChange:Ye},{default:h(()=>[le("自动刷新")]),_:1},8,["checked"])])],512),o("div",wa,[o("div",{class:"content-header-box",ref_key:"areaContentHearderBoxRef",ref:_e},[o("div",Ta,[o("div",ka,[r(i(Qe),{value:A.value,"onUpdate:value":a[2]||(a[2]=t=>A.value=t),size:"small"},{default:h(()=>[r(i(xe),{value:"card"},{default:h(()=>[r(U,{icon:"ant-design:menu-outlined",class:"radio-btn-icon",size:14})]),_:1}),r(i(xe),{value:"table"},{default:h(()=>[r(U,{icon:"ant-design:insert-row-above-outlined",class:"radio-btn-icon",size:14})]),_:1})]),_:1},8,["value"])]),Ia,o("div",Ca,[o("div",{class:"select-label-box",onClick:De},[le("排序 "),w.value==="asc"?(v(),P(U,{key:0,icon:"bx:sort-up",size:14})):L("",!0),w.value==="desc"?(v(),P(U,{key:1,icon:"bx:sort-down",size:14})):L("",!0)]),r(i(j),{ref:"sortFieldSelect",value:B.value,"onUpdate:value":a[3]||(a[3]=t=>B.value=t),style:{width:"206px"},options:Re.value,placeholder:"选择排序",allowClear:"",onChange:Le},null,8,["value","options"])]),o("div",Sa,[Da,r(i(j),{value:g.value,"onUpdate:value":a[4]||(a[4]=t=>g.value=t),mode:"multiple",style:{"min-width":"206px"},placeholder:"选择区域",options:pe.value,"filter-option":ke,"max-tag-count":2,showArrow:"",onChange:Fe},null,8,["value","options"])]),o("div",Ra,[La,r(i(j),{value:D.value,"onUpdate:value":a[5]||(a[5]=t=>D.value=t),mode:"multiple",style:{"min-width":"206px"},placeholder:"选择类型",options:he.value,showArrow:"",onChange:Oe},null,8,["value","options"])]),o("div",Fa,[r(i(ae),{checked:Z.value,"onUpdate:checked":a[6]||(a[6]=t=>Z.value=t),onChange:ze},{default:h(()=>[Na,o("span",null,q($.value),1)]),_:1},8,["checked"]),r(i(ea),{value:T.value,"onUpdate:value":a[7]||(a[7]=t=>T.value=t),onChange:Be},{default:h(()=>[(v(!0),C(K,null,oe(b.value,(t,H)=>(v(),P(i(ae),{key:H,value:t.value},{default:h(()=>[o("span",Oa,q(t.label),1),o("span",{class:se({"red-text":t.value!=="normal"&&t.number>0})},q(t.number),3)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),Ba],512),A.value==="card"?(v(),C(K,{key:0},[o("div",{class:"device-content",style:fa({height:J.value})},[o("div",za,[(v(!0),C(K,null,oe(G.value[s.value-1],(t,H)=>(v(),P(aa,{class:"device-item-layout",key:H,options:Ee.value,data:t,showSeries:!1,deviceType:t.deviceType,onDblclick:Ua=>ue(t)},null,8,["options","data","deviceType","onDblclick"]))),128))])],4),((E=z.value)==null?void 0:E.length)>0?(v(),C("div",Ea,[(v(!0),C(K,null,oe(f.value,t=>(v(),C("div",{style:{display:"none"},class:se(["pagination-item",{"current-page":s.value===t}]),key:t,onClick:H=>V(t)},q(t),11,Ha))),128)),r(n,{current:s.value,"onUpdate:current":a[8]||(a[8]=t=>s.value=t),total:f.value,pageSize:1,showSizeChanger:!1,"show-less-items":"","show-quick-jumper":"",onChange:V},null,8,["current","total"])])):L("",!0)],64)):L("",!0),A.value==="table"?(v(),C("div",Pa,[r(i(Xe),{onRegister:i(Ae)},{toolbar:h(()=>[o("div",Aa,[A.value==="table"?(v(),P(u,{key:0,class:"yellow-btn",preIcon:i(qe).EXPORT,onClick:$e},{default:h(()=>[le("导出")]),_:1},8,["preIcon"])):L("",!0)])]),action:h(({record:t})=>[r(i(Ze),{actions:[{label:"详情",icon:"clarity:note-edit-line",onClick:Ge.bind(null,{record:t})}]},null,8,["actions"])]),bodyCell:h(({column:t,record:H})=>[t.key==="abnormalTypesStr"?(v(),C("span",{key:0,class:se(["status-icon",Pe[H.abnormalTypesStr]])},null,2)):L("",!0)]),_:1},8,["onRegister"])])):L("",!0)])],512),r(ta,{title:ie.value,visible:X.value,ycData:ce.value,yxTime:ve.value,yxData:de.value,data:re.value,"onUpdate:visible":a[9]||(a[9]=t=>X.value=t)},null,8,["title","visible","ycData","yxTime","yxData","data"])])]}),_:1})}}});const Tt=Ke(Ma,[["__scopeId","data-v-64d4f554"]]);export{Tt as default};
//# sourceMappingURL=inverterOverview-231aded9.js.map
