var _=(o,C,a)=>new Promise((T,s)=>{var p=r=>{try{y(a.next(r))}catch(l){s(l)}},u=r=>{try{y(a.throw(r))}catch(l){s(l)}},y=r=>r.done?T(r.value):Promise.resolve(r.value).then(p,u);y((a=a.apply(o,C)).next())});import{d as Y,r as x,k as h,o as ee,al as I,Z as K,a9 as B,aa as i,f as n,$ as te,u as f,E as ae,ad as oe,ac as le,v as M,A as N}from"./vue-71d1abb3.js";import{B as ne}from"./BasicTable-0434a334.js";import{T as ie}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as se}from"./useTable-109483b3.js";import{a2 as d}from"./antd-15ac76ed.js";import{a5 as v,b as re,av as de,_ as ue}from"./index.js";import{D as ce}from"./Dialog-0a006d82.js";import{_ as A}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{P as pe}from"./index-20519caf.js";import{C as me}from"./CommonTree-c4ed7838.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";function fe(){return[{title:"型号编码",dataIndex:"code",editRow:!0,editByNull:!0,width:350,editRule:ve,sorter:!0,resizable:!0},{title:"型号名称",dataIndex:"name",width:350,editRow:!0,align:"left",headAlign:"center",sorter:!0,resizable:!0}]}const ve=o=>_(void 0,null,function*(){return o?"":"不能为空"}),ye=o=>v.post({url:"/baseset/devicetype/tree",params:o},{}),ge=o=>v.post({url:"/baseset/devicemodel/list",params:o},{}),be=o=>v.post({url:"/baseset/devicemodel/create",params:o},{}),_e=o=>v.delete({url:"/baseset/devicemodel/delete?id="+o},{}),he=o=>v.post({url:"/baseset/devicetype/create",params:o},{}),Ie=o=>v.delete({url:"/baseset/devicetype/delete",params:o},{}),Te={class:"right-table-layout"},Ce=Y({__name:"modelSet",setup(o){const{t:C}=re(),a=x({}),T=h([]),s=x({stationId:"",category:"",deviceType:"",nodeType:""}),p=h(!1),u=h(""),y=fe();let r=h([]);const l=x({deviceCategory:"",codes:[],stationId:"",categorySort:null}),E=h(),L=()=>_(this,null,function*(){let e=yield ge(a);return e.result.forEach(t=>{t.key=t.code}),e.result}),[V,{reload:w,getDataSource:H,deleteTableDataRecord:O}]=se({title:"型号列表",api:L,columns:y,useSearchForm:!1,showTableSetting:!0,pagination:!1,bordered:!0,rowKey:"key",handleSearchInfoFn(){return a},actionColumn:{title:"操作",dataIndex:"action"},sortFn:e=>{e.order?(a.sortField=e.field,a.sortOrder=e.order.replace("end","")):(a.sortField="",a.sortOrder="")}});function R(){return _(this,null,function*(){const t=yield ye({parentId:"HZ93a0a37bcad63b017bd784ee2012e7"});T.value=t.result})}function U(e){if(e==null||e.nodeKindId!="station"){d.error("请选择电站。");return}l.codes=[],p.value=!0}function q(e){if(e.nodeKindId=="category"){l.deviceCategory=e.deviceCategory;let t=[];e.children.forEach(m=>{t.push(m.deviceType)}),l.codes=t,p.value=!0}else d.error("请选择设备大类")}function z(e){if(e.nodeKindId!="category"&&e.nodeKindId!="type"){d.error("请选择设备大类或类型。");return}else e.nodeType=e.nodeKindId,e.stationId=e.powerStationId,Ie(e).then(()=>{d.success("已删除"),k()})}function k(e){R()}function P(){if(s.nodeType!="type"){d.error("请选择设备类型。");return}r.value=H();let t={id:"",key:r.value.length+1,code:null,name:"",editable:!0,editRule:!0};r.value.unshift(t),F(t)}function Z(){E.value.validateFields().then(()=>{let e=[];l.codes.forEach(t=>{e.push(t)}),l.codes=e,l.stationId=s.stationId,he(l).then(()=>{d.success("已添加类型"),k(),w(),p.value=!1}).catch(()=>{})})}function $(){p.value=!1}function W(e=[]){if(s.nodeType=e.nodeKindId,s.category=e.deviceCategory,s.deviceType=e.deviceType,s.stationId=e.powerStationId,e.nodeKindId=="org"?(a.deviceCategory=null,a.deviceType=null,a.stationId=null,a.orgId=e.id):(a.deviceCategory=e.deviceCategory,a.deviceType=e.deviceType,a.stationId=e.powerStationId,a.orgId=null),u.value!="")return d.error("请先完成编辑。"),!1;w()}function F(e){var t;u.value=e.key,(t=e.onEdit)==null||t.call(e,!0)}function j(e){return _(this,null,function*(){var m;if(yield(m=e.onValid)==null?void 0:m.call(e))try{e.deviceType=e.deviceType==null?s.deviceType:e.deviceType,e.stationId=e.stationId==null?s.stationId:e.stationId,be(e).then(g=>{var b;e.id=g.result,((b=e.onEdit)==null?void 0:b.call(e,!1,!0))&&(u.value=""),d.success({content:"数据已保存",key:"saving"})})}catch(g){d.error({content:"保存失败",key:"saving"})}else d.error({content:"请填写正确的数据",key:"saving"})})}function G(e){var t;e.id==""&&O(e.key),u.value="",(t=e.onEdit)==null||t.call(e,!1,!1)}function J(e){var t;_e(e.id).then(()=>{d.success("已删除。"),w()}),u.value="",(t=e.onEdit)==null||t.call(e,!1,!1)}function Q(e){return e.editable?[{label:"保存",onClick:j.bind(null,e)},{label:"取消",popConfirm:{title:"是否取消修改",confirm:G.bind(null,e)}}]:[{label:"修改",icon:"clarity:bullet-list-line",disabled:u.value?u.value!==e.key:!1,onClick:F.bind(null,e)},{label:"删除",icon:"ant-design:delete-outlined",popConfirm:{title:"是否删除",confirm:J.bind(null,e)}}]}return ee(()=>{R()}),(e,t)=>{const m=I("a-button"),g=I("a-form-item"),D=I("a-col"),b=I("a-row"),X=I("a-form");return K(),B(f(pe),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:i(()=>[n(me,{title:"电站组织",onSelect:W,value:T.value,class:"left-tree-layout",onAdd:U,onEdit:q,onDelete:z,onRefresh:k,isShowOperationBtns:!0,fieldNames:{key:"id",title:"name"}},null,8,["value"]),te("div",Te,[n(f(ne),{onRegister:f(V),class:"fix-basic-table",searchInfo:a,onResizeColumn:t[0]||(t[0]=(c,S)=>S.width=c)},{toolbar:i(()=>[n(m,{type:"primary",onClick:P,preIcon:f(de).ADD},{default:i(()=>[ae(oe(f(C)("common.action.create")),1)]),_:1},8,["preIcon"])]),bodyCell:i(({column:c,record:S})=>[c.key==="action"?(K(),B(f(ie),{key:0,actions:Q(S)},null,8,["actions"])):le("",!0)]),_:1},8,["onRegister","searchInfo"])]),n(ce,{visible:p.value,"onUpdate:visible":t[3]||(t[3]=c=>p.value=c),width:500,height:300,smode:"normal",title:"新增设备类型",onOk:Z,onCancel:$},{default:i(()=>[n(X,{ref_key:"modalFormRef",ref:E,model:l,name:"userForm"},{default:i(()=>[n(b,{gutter:24},{default:i(()=>[M(n(D,{span:20},{default:i(()=>[n(g,{label:"设备大类",name:"deviceCategory",labelCol:{span:5},rules:[{required:!0,message:"请选择设备大类"}]},{default:i(()=>[n(A,{style:{width:"100%"},value:l.deviceCategory,"onUpdate:value":t[1]||(t[1]=c=>l.deviceCategory=c),type:"commDeviceCategory"},null,8,["value"])]),_:1})]),_:1},512),[[N,!0]])]),_:1}),n(b,{gutter:24},{default:i(()=>[M(n(D,{span:20},{default:i(()=>[n(g,{label:"设备小类",name:"codes",labelCol:{span:5},rules:[{required:!0,message:"请选择设备小类"}]},{default:i(()=>[n(A,{style:{width:"100%"},multiple:"multiple",value:l.codes,"onUpdate:value":t[2]||(t[2]=c=>l.codes=c),type:"commDeviceType"},null,8,["value"])]),_:1})]),_:1},512),[[N,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])]),_:1})}}});const Qe=ue(Ce,[["__scopeId","data-v-315b1b41"]]);export{Qe as default};
//# sourceMappingURL=modelSet-8c5d4a6f.js.map
