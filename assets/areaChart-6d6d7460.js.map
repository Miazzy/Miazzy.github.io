{"version":3,"file":"areaChart-6d6d7460.js","sources":["../../src/views/monitor/PVArea/subareaOverview/areaChart.vue"],"sourcesContent":["<template>\n  <div class=\"data-detail\">\n    <div class=\"header-box\">\n      <div class=\"header-left\">\n        <div class=\"radio-btn-box\">\n          <RadioGroup v-model:value=\"showMode\" size=\"small\">\n            <RadioButton value=\"chart\">\n              <Icon icon=\"ant-design:line-chart-outlined\" class=\"radio-btn-icon\" :size=\"14\" />\n            </RadioButton>\n            <RadioButton value=\"table\">\n              <Icon icon=\"ant-design:insert-row-above-outlined\" class=\"radio-btn-icon\" :size=\"14\" />\n            </RadioButton>\n          </RadioGroup>\n        </div>\n        <div class=\"date-picker-box\">\n          <DatePicker v-model:value=\"date\" valueFormat=\"YYYY-MM-DD\" @change=\"handleChangeDate\" />\n        </div>\n        <div v-if=\"showMode === 'chart'\" class=\"select-box\">\n          <Select\n            v-model:value=\"target\"\n            mode=\"multiple\"\n            style=\"min-width: 206px\"\n            placeholder=\"选择指标\"\n            :options=\"targetOptions\"\n            :max-tag-count=\"2\"\n            showArrow\n            @change=\"handleTargetChange\"\n          />\n        </div>\n      </div>\n      <div class=\"header-right\" v-if=\"showMode === 'table'\">\n        <Button type=\"primary\" @click=\"handleExport\">导出</Button>\n      </div>\n    </div>\n    <div class=\"content-box\">\n      <div v-if=\"showMode === 'chart'\" class=\"chart-box\">\n        <div style=\"margin-top: 10px; transform: scale(0.85); transform-origin: 0 0\">\n          <EchartLineChart\n            :data=\"pchartData\"\n            :colors=\"pchartData.colors\"\n            :width=\"850\"\n            :height=\"600\"\n          />\n        </div>\n      </div>\n      <div v-if=\"showMode === 'table'\" class=\"table-box\">\n        <BasicTable @register=\"registerTable\" :scroll=\"{ x: 200, y: 400 }\" />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\n  import { onMounted, ref, reactive } from 'vue';\n  import { RadioGroup, RadioButton, Select, DatePicker, Button } from 'ant-design-vue';\n  import Icon from '@/components/Icon/Icon.vue';\n  import type { SelectProps } from 'ant-design-vue';\n  import { useI18n } from '@/hooks/web/useI18n';\n\n  import { exportExcelFile } from '@/utils/file/download';\n  import { useMessage } from '@/hooks/web/useMessage';\n  import dayjs, { Dayjs } from 'dayjs';\n  import { BasicTable, useTable, TableAction, BasicColumn } from '/@/components/Table';\n  import { formatDate } from '/@/utils/dateUtil';\n  import EchartLineChart from '/@/components/Framework/Chart/EchartLineChart.vue';\n  import { getDialogAreaExport, getAreaDialogChartData } from '../../monitorApi.ts';\n\n  const { t } = useI18n();\n  const { createConfirm, createMessage } = useMessage();\n  const pchartData = reactive({\n    barData: [],\n    lineData: [],\n    categories: [],\n    units: [],\n    colors: [\n      ['#078C5D', '#68E4B8'],\n      ['#E59837', '#FAE895'],\n      ['#078C5D', '#68E4B8'],\n    ],\n  });\n  const pChartSeriesName = ref([]);\n\n  // 显示方式：图表/表格 chart/table\n  const showMode = ref('chart');\n\n  // 选择日期\n  const date = ref<Dayjs>();\n  const handleChangeDate = (value) => {\n    console.log('选择日期', value);\n    loadChartData();\n  };\n\n  // 选择指标\n  const target = ref([]);\n  const targetOptions = ref<SelectProps['options']>([]);\n  const handleTargetChange = (value: string[]) => {\n    console.log(`selected ${value}`);\n    target.value = value;\n    loadChartData();\n  };\n  // 父组件穿过来的表格字段，指标列表\n  interface Props {\n    index?: [];\n    areaId?: String;\n  }\n  const props = withDefaults(defineProps<Props>(), {});\n  const loadBaseInfo = async () => {\n    columns.value = props.tableColumns;\n    let tempOptions = [];\n    if (props.index?.length > 0) {\n      props.index.forEach((item) => {\n        if (target.value.length == 0) {\n          target.value.push(item.value);\n        }\n        tempOptions.push(item);\n      });\n    }\n\n    targetOptions.value = tempOptions;\n    // 初始化日期\n    let current = new Date();\n    date.value = dayjs(formatDate(current), 'YYYY-MM-DD');\n    loadChartData();\n  };\n  // 获取数据\n  const loadChartData = async () => {\n    let params = {};\n    params.queryFieldList = target.value;\n    params.startDate = formatDate(date.value);\n    params.endDate = formatDate(date.value);\n    params.areaId = props.areaId;\n    params.isCrossTian = false;\n    let res = await getAreaDialogChartData(params);\n    pchartData.lineData = res.lineData;\n    pchartData.categories = res.timeList;\n    pchartData.units = res.unitList;\n    pchartData.seriesName = res.seriesName;\n    loadTableData(res);\n  };\n\n  // 处理表数据\n  const loadTableData = async (res: array) => {\n    let columnList = res.columnList;\n    let enList = res.enList;\n    let preColumns = [{ title: '时间', dataIndex: 'time', width: 120 }];\n    if (columnList.length > 0) {\n      for (let i = 0; i < columnList.length; i++) {\n        let column = { title: columnList[i], dataIndex: enList[i], width: 120 };\n        preColumns.push(column);\n      }\n      columns.value = preColumns;\n    }\n    tableData.value = res.allData;\n    reload();\n  };\n\n  // 导出\n  async function handleExport() {\n    let params = {};\n    params.startDate = formatDate(date.value);\n    params.endDate = formatDate(date.value);\n    params.areaId = props.areaId;\n    params.isCrossTian = false;\n    createConfirm({\n      title: t('common.exportTitle'),\n      iconType: 'warning',\n      content: t('common.message.exportMessage'),\n      async onOk() {\n        await getDialogAreaExport(params).then((res) => {\n          exportExcelFile(res?.data, '区域实时数据.xls');\n        });\n        createMessage.success(t('common.exportSuccessText'));\n      },\n    });\n  }\n  // 表格\n  const columns = ref([]);\n  const tableData = ref([]);\n  const [registerTable, { reload }] = useTable({\n    // api: getDataList,\n    columns,\n    bordered: true,\n    showTableSetting: false,\n    rowKey: 'time',\n    pagination: { show: true, pageSize: 15 },\n    tableSetting: { fullScreen: true },\n    dataSource: tableData,\n  });\n  // 启动执行代码\n  onMounted(() => {\n    loadBaseInfo();\n  });\n</script>\n\n<style lang=\"less\"></style>\n\n<style lang=\"less\" scoped>\n  .data-detail {\n    .header-box {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 10px 15px 0;\n\n      .header-left {\n        display: flex;\n        align-items: center;\n      }\n    }\n\n    .radio-btn-box {\n      margin-right: 20px;\n    }\n\n    .date-picker-box {\n      margin-right: 20px;\n    }\n\n    .content-box {\n      .table-box {\n        width: 740px;\n        height: 500px;\n        padding: 0 9px;\n        overflow: auto;\n      }\n    }\n  }\n</style>\n"],"names":["t","useI18n","createConfirm","createMessage","useMessage","pchartData","reactive","ref","showMode","date","handleChangeDate","value","loadChartData","target","targetOptions","handleTargetChange","loadBaseInfo","__async","columns","props","tempOptions","_a","item","current","dayjs","formatDate","params","res","getAreaDialogChartData","loadTableData","columnList","enList","preColumns","i","column","tableData","reload","handleExport","getDialogAreaExport","exportExcelFile","registerTable","useTable","onMounted"],"mappings":"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"}