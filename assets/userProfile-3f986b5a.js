var N=(p,m,w)=>new Promise((b,t)=>{var o=c=>{try{g(w.next(c))}catch(P){t(P)}},_=c=>{try{g(w.throw(c))}catch(P){t(P)}},g=c=>c.done?b(c.value):Promise.resolve(c.value).then(o,_);g((w=w.apply(p,m)).next())});import{_ as H}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{a5 as S,at as y,bt as Q,bu as R,a0 as Y,aa as X,a7 as Z,_ as J}from"./index.js";import{K as U,bE as T}from"./antd-15ac76ed.js";import{g as W}from"./upload-27040ac3.js";import{m as K}from"./crypto-ca21d37f.js";import{d as ee,k as h,r as L,o as ae,al as f,Z as te,_ as le,$ as d,u as x,f as a,aa as l,E as j,a5 as D,G as se,F as ne,J as re,aG as oe,aH as de}from"./vue-71d1abb3.js";const ue=p=>{const m={url:"/system/user/profile/update",data:p};return S.put(m,{})},ie=(p,m)=>{const b={url:"/system/user/profile/update-password",data:{oldPassword:p,newPassword:m}};return S.put(b,{})},pe=()=>{const p={url:"/system/user/profile/getUserProfile"};return S.get(p,{})},fe="/assets/default-avatar-ee5833c9.png",me=p=>(oe("data-v-72d789b2"),p=p(),de(),p),ve={class:"left"},_e={class:"avatar"},ce=["src"],ge={class:"right"},we={class:"passwdLeft"},be={class:"grade"},ye=me(()=>d("div",{class:"passwdRight"},[d("div",{style:{"text-indent":"20px"}},"1. 为了充分确保您个人密码在系统中的安全使用，请您设置一个高强度、不易猜测的密码作为您的密码."),d("div",{style:{"text-indent":"20px"}},"2. 简单密码具有较为明显的规律性和客户信息的针对性，极易被他人猜测、被黑客破解，因此，请避免使用简单密码"),d("div",{style:{"text-indent":"20px"}},'3. 密码要求由6-10位数字，大写字母，小写字母和特珠符号组成,分为弱，中，强一种强度，密码若只有数字或只有字母或只有特珠符号组成， 强度为弱，密码若由数字和字母组成、或数字和特殊符号组成、或字母与持殊符号组成为中等强度，密码若由数字、字母、特殊符号共同组成，强度为强。系统推荐使用者采用"高强度密码”设置'),d("div",{style:{"text-indent":"20px"}},"4. 请保护好您的用户名和登录密码，不要随意透露给任何人。若有任何怀疑，请立即联系系统管理人员。")],-1)),Pe=ee({__name:"userProfile",setup(p){let m=h(),w=h(),b=h();const t=L({}),o=L({}),_=h(0),g=h([]),c={authorization:"authorization-text"},P=()=>{t.birthday&&(t.birthday=U(t.birthday).format("YYYY-MM-DD")),t.joinDate&&(t.joinDate=U(t.joinDate).format("YYYY-MM-DD")),ue(t).then(n=>{n.result&&y.getInstance().info("保存成功")})},O=n=>{const e=new FormData;e.append("application","system"),e.append("module","org"),e.append("bizId",t.id),e.append("fileKindId","");let r=g.value[0];r.id||e.append("files[]",r.originFileObj),r.percent==100&&(t.avatarId?Q(t.avatarId).then(C=>{C&&R(e).then(v=>{q()})}):R(e).then(C=>{q()}))},A=(n,e)=>e!=o.newPassword?(n.message="和新密码不一致",Promise.reject()):Promise.resolve(),B=(n,e)=>(_.value=0,e?(/[A-Za-z]+/.test(e)&&(n.message="须包含字母",_.value+=1),/[0-9]+/.test(e)&&(n.message="须包含数字",_.value+=1),/[\!\@\#\$\%\^\&\*\(\)\_\+\{\}\[\]\|\"\'\:\<\>\?]+/.test(e)&&(n.message="须包含特殊符号",_.value+=1),e.length<6||e.length>10?(n.message="密码长度6-10位",Promise.reject()):Promise.resolve()):Promise.resolve()),k=()=>{o.confirmPassword&&o.newPassword},V=()=>{b.value.validateFields().then(()=>N(this,null,function*(){if(o.newPassword!==o.confirmPassword){y.getInstance().error("新密码和确认密码不一致。");return}ie(K(o.oldPassword),K(o.newPassword)).then(e=>{e.result&&(y.getInstance().info("保存成功。"),Y().logout(!0))})}))},q=()=>{X({bizId:t.id}).then(n=>{const e=Y();t.avatarId=n[0].id;const r=re(e.getUserInfo);return t.url=r.avatar=W(n[0].url),e.setUserInfo(r),Z.getInstance().sendMsg("avatar-update-message",{path:r.avatar}),r==null?void 0:r.avatar})},E=n=>{if(n.size>2*1024*1024)return y.getInstance().warning("文件大小超过最大限度2MB"),!1;if(n.size===0)return y.getInstance().warning("不能上传空文件或目录，请重新选择"),!1;const e=n.name.slice(n.name.lastIndexOf(".")+1).toLowerCase();return"png,jpeg,gif,jpg".indexOf(e)==-1?(y.getInstance().warning(`不支持${e}类型的文件上传`),!1):(g.value=[n],!0)};return ae(()=>{pe().then(n=>{Object.assign(t,n.result),n.result.birthday&&(t.birthday=U(n.result.birthday)),n.result.joinDate&&(t.joinDate=U(n.result.joinDate))}).then(()=>{q()})}),(n,e)=>{const r=f("a-button"),C=f("a-upload"),v=f("a-input"),u=f("a-form-item"),i=f("a-col"),M=f("a-date-picker"),F=f("a-form"),z=f("a-tab-pane"),I=f("a-input-password"),$=f("a-row"),G=f("a-tabs");return te(),le(ne,null,[d("div",ve,[d("div",_e,[d("div",null,[d("img",{src:t.url?t.url:x(fe),width:200,height:280},null,8,ce)]),a(C,{"file-list":g.value,"onUpdate:fileList":e[0]||(e[0]=s=>g.value=s),name:"file",headers:c,onChange:O,"before-upload":E,showUploadList:!1},{default:l(()=>[a(r,{style:{"margin-top":"20px","margin-left":"40%"}},{default:l(()=>[a(x(T)),j(" 上传头像 ")]),_:1})]),_:1},8,["file-list"])])]),d("div",ge,[a(G,{activeKey:x(m),"onUpdate:activeKey":e[15]||(e[15]=s=>se(m)?m.value=s:m=s)},{default:l(()=>[a(z,{key:"profile",tab:"个人信息简介"},{default:l(()=>[a(F,{model:t,name:"basic",ref_key:"formRef",ref:w,"label-col":{span:4},"wrapper-col":{span:18},autocomplete:"off"},{default:l(()=>[a(i,{span:20},{default:l(()=>[a(u,{label:"姓名",name:"name",labelCol:{span:4},wrapperCol:5,rules:[{required:!1}]},{default:l(()=>[a(v,{value:t.name,"onUpdate:value":e[1]||(e[1]=s=>t.name=s),disabled:""},null,8,["value"])]),_:1})]),_:1}),a(i,{span:20},{default:l(()=>[a(u,{label:"登录账号",name:"loginName",labelCol:{span:4},wrapperCol:7,rules:[{required:!1}]},{default:l(()=>[a(v,{value:t.loginName,"onUpdate:value":e[2]||(e[2]=s=>t.loginName=s),disabled:""},null,8,["value"])]),_:1})]),_:1}),a(i,{span:20},{default:l(()=>[a(u,{label:"出生日期",name:"birthday",labelCol:{span:4},wrapperCol:7,rules:[{required:!1}]},{default:l(()=>[a(M,{value:t.birthday,"onUpdate:value":e[3]||(e[3]=s=>t.birthday=s),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),a(i,{span:20},{default:l(()=>[a(u,{label:"工作日期",name:"joinDate",labelCol:{span:4},wrapperCol:7,rules:[{required:!1}]},{default:l(()=>[a(M,{value:t.joinDate,"onUpdate:value":e[4]||(e[4]=s=>t.joinDate=s),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),a(i,{span:20},{default:l(()=>[a(u,{label:"学历",name:"degree",labelCol:{span:4},wrapperCol:7,rules:[{required:!1}]},{default:l(()=>[a(H,{type:"degree",value:t.degree,"onUpdate:value":e[5]||(e[5]=s=>t.degree=s),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),a(i,{span:20},{default:l(()=>[a(u,{label:"毕业院校",name:"graduateSchool",labelCol:{span:4},wrapperCol:7,rules:[{required:!1}]},{default:l(()=>[a(v,{value:t.graduateSchool,"onUpdate:value":e[6]||(e[6]=s=>t.graduateSchool=s)},null,8,["value"])]),_:1})]),_:1}),a(i,{span:20},{default:l(()=>[a(u,{label:"专业",name:"speciality",labelCol:{span:4},wrapperCol:7,rules:[{required:!1}]},{default:l(()=>[a(v,{value:t.speciality,"onUpdate:value":e[7]||(e[7]=s=>t.speciality=s)},null,8,["value"])]),_:1})]),_:1}),a(i,{span:20},{default:l(()=>[a(u,{label:"工作电话",name:"officePhone",labelCol:{span:4},wrapperCol:7,rules:[{required:!1}]},{default:l(()=>[a(v,{value:t.officePhone,"onUpdate:value":e[8]||(e[8]=s=>t.officePhone=s)},null,8,["value"])]),_:1})]),_:1}),a(i,{span:20},{default:l(()=>[a(u,{label:"手机",name:"mobile",labelCol:{span:4},wrapperCol:7,rules:[{required:!1}]},{default:l(()=>[a(v,{value:t.mobile,"onUpdate:value":e[9]||(e[9]=s=>t.mobile=s)},null,8,["value"])]),_:1})]),_:1}),a(i,{span:20},{default:l(()=>[a(u,{label:"邮箱",name:"email",labelCol:{span:4},wrapperCol:7,rules:[{required:!1}]},{default:l(()=>[a(v,{value:t.email,"onUpdate:value":e[10]||(e[10]=s=>t.email=s)},null,8,["value"])]),_:1})]),_:1}),a(i,{span:20},{default:l(()=>[a(u,{label:"QQ",name:"qq",labelCol:{span:4},wrapperCol:7,rules:[{required:!1}]},{default:l(()=>[a(v,{value:t.qq,"onUpdate:value":e[11]||(e[11]=s=>t.qq=s)},null,8,["value"])]),_:1})]),_:1}),a(r,{class:"btn",type:"primary","html-type":"submit",onClick:P},{default:l(()=>[j("保存")]),_:1})]),_:1},8,["model"])]),_:1}),a(z,{key:"passw",tab:"修改密码"},{default:l(()=>[d("div",we,[a(F,{model:o,name:"basicPasswd",ref_key:"formRefpasswd",ref:b,"label-col":{span:4},"wrapper-col":{span:20},autocomplete:"off"},{default:l(()=>[a(i,{span:24},{default:l(()=>[a(u,{label:"原密码",name:"oldPassword",labelCol:{span:6},wrapperCol:7,rules:[{required:!0,message:"原密码不能为空"}]},{default:l(()=>[a(I,{value:o.oldPassword,"onUpdate:value":e[12]||(e[12]=s=>o.oldPassword=s)},null,8,["value"])]),_:1})]),_:1}),a(i,{span:24},{default:l(()=>[a(u,{label:"新密码",name:"newPassword",labelCol:{span:6},wrapperCol:7,rules:[{required:!0,message:"新密码不能为空",validator:B,length:[6,10],trigger:"change"}]},{default:l(()=>[a(I,{value:o.newPassword,"onUpdate:value":e[13]||(e[13]=s=>o.newPassword=s),onChange:k},null,8,["value"])]),_:1},8,["rules"])]),_:1}),a(i,{span:24},{default:l(()=>[a(u,{label:"确认密码",name:"confirmPassword",labelCol:{span:6},wrapperCol:7,rules:[{required:!0,message:"确认密码不能为空",validator:A,length:[6,10],trigger:"change"}]},{default:l(()=>[a(I,{value:o.confirmPassword,"onUpdate:value":e[14]||(e[14]=s=>o.confirmPassword=s),onChange:k},null,8,["value"])]),_:1},8,["rules"])]),_:1}),a($,null,{default:l(()=>[d("div",be,[d("span",{class:D(_.value==1?"low":"")},"弱",2),d("span",{class:D(_.value==2?"mid":"")},"中",2),d("span",{class:D(_.value==3?"hig":"")},"高",2)])]),_:1}),a(r,{class:"btnpass",type:"primary","html-type":"submit",onClick:V},{default:l(()=>[j("保存")]),_:1})]),_:1},8,["model"])]),ye]),_:1})]),_:1},8,["activeKey"])])],64)}}});const De=J(Pe,[["__scopeId","data-v-72d789b2"]]);export{De as default};
//# sourceMappingURL=userProfile-3f986b5a.js.map
