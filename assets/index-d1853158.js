var u=(r,c,d)=>new Promise((p,s)=>{var a=n=>{try{i(d.next(n))}catch(m){s(m)}},b=n=>{try{i(d.throw(n))}catch(m){s(m)}},i=n=>n.done?p(n.value):Promise.resolve(n.value).then(a,b);i((d=d.apply(r,c)).next())});import{a0 as F,a5 as v,au as M,b as E,a7 as A,av as x,at as h,ax as B,az as Y,aA as V,_ as j}from"./index.js";import{P as H}from"./index-20519caf.js";import{B as K}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as L}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{s as W,a as q}from"./stationTree-56a32762.js";import"./index-316f6ffb.js";import{u as U}from"./useRender-21ce56fb.js";import{e as X}from"./download-03e71dd5.js";import{d as Z,k as y,o as $,al as G,Z as J,a9 as Q,aa as f,f as g,$ as ee,u as l,E as I,ad as _}from"./vue-71d1abb3.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./CommonTree-c4ed7838.js";import"./index-3801a970.js";function te(r){return v.get({url:"/po/safety-tools-check/page",params:r})}function ae(r){return v.download({url:"/po/safety-tools-check/export-excel",params:r},{isReturnNativeResponse:!0})}const oe={0:"#dc0000",1:"#338ed1",2:"#30ca5a",3:"#929292",4:"#929292",5:"#929292",6:"#fda941"},ne=[{title:"单据编号",dataIndex:"billCode",width:180,sorter:!0,resizable:!0},{title:"所属公司",dataIndex:"stationOrganName",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0,ifShow:F().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"检验日期",dataIndex:"checkDate",width:120,sorter:!0,resizable:!0},{title:"检验单位",dataIndex:"checkCompany",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"检验数量",dataIndex:"checkNum",align:"right",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"送检人",dataIndex:"checkByName",width:120,sorter:!0,resizable:!0},{title:"状态",dataIndex:"statusText",width:120,sorter:!0,resizable:!0,customRender:({text:r,record:c})=>U.renderTag(r,oe[c.status])},{title:"创建人",dataIndex:"personMemberName",width:100,sorter:!0,resizable:!0},{title:"创建时间",dataIndex:"fillinDate",width:100,sorter:!0,resizable:!0}],re=[{label:"单据编号",field:"billCode",component:"Input",colProps:{span:8}},{label:"检验单位",field:"checkCompany",component:"Input",colProps:{span:7}},{field:"[checkDateStart, checkDateEnd]",label:"检验日期",component:"RangePicker",colProps:{span:7},componentProps:{format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",placeholder:["开始日期","结束日期"]}},{label:"状态",field:"status",component:"DictSelectBox",componentProps:{type:"bpm_process_instance_result"},colProps:{span:7}}],se={class:"right-table-layout"},ie=Z({__name:"index",setup(r){const{createConfirm:c,createMessage:d}=M(),{t:p}=E();let s=y("");const a=y({status:"",businessKind:"",examinationResult:"",billCode:"",sortField:"fillinDate",sortOrder:"desc",pageNo:1,pageSize:10}),[b,{reload:i,getPaginationRef:n,getForm:m,getSelectRows:w}]=L({title:"安全工器具检验",api:()=>u(this,null,function*(){const e=n();return a.value.pageNo=e.current,a.value.pageSize=e.pageSize,(yield te(a.value)).result}),columns:ne,rowKey:"id",bordered:!0,formConfig:{labelWidth:120,schemas:re,showAdvancedButton:!0,autoAdvancedLine:1},useSearchForm:!0,showTableSetting:!0,sortFn:e=>{e.order?(a.value.sortField=e.field.replace("Text",""),a.value.sortOrder=e.order.replace("end","")):(a.value.sortField="fillinDate",a.value.sortOrder="desc")},rowSelection:{type:"radio",fixed:!0,onSelect:k},handleSearchInfoFn(e){for(const t in e)a.value[t]=e[t]}});function k(e,t){t?s.value=e.id:s.value=""}function C({keys:e,rows:t}){if(t&&t.length>0){const o=t[0];s.value=o.id}else s.value=""}function S(e){q(e,a,null,i)}function T(){if(!a.value.stationId){h.getInstance().info("请选中电站添加");return}B("/po/safetytools/safetytoolscheck/create?id=","添加安全工器具检验",{stationId:a.value.stationId,stationName:a.value.stationName,stationOrganId:a.value.stationOrganId,stationOrganName:a.value.stationOrganName})}const D=(e,t,o)=>{P(e)};function P(e){Y(e.id,null)}const z=()=>u(this,null,function*(){let e=w();if(e.length!=1){h.getInstance().success("请选择一行数据");return}let t=e[0];c({title:"提示",iconType:"warning",content:"确定要删除选中的记录？",onOk(){return u(this,null,function*(){if(t.status!=0){h.getInstance().success("非草稿状态不能删除");return}yield V(t.processInstanceId),h.getInstance().success("删除成功"),i()})}})});function O(){return u(this,null,function*(){c({title:p("common.exportTitle"),iconType:"warning",content:p("common.exportMessage"),onOk(){return u(this,null,function*(){let t=m().getFieldsValue();Object.assign(t,a.value),yield ae(t).then(o=>{X(o==null?void 0:o.data,"安全工器具检验.xls")}),d.success(p("common.exportSuccessText"))})}})})}return $(()=>{A.getInstance().listen("safety-tools-check",()=>{i()})}),(e,t)=>{const o=G("a-button");return J(),Q(l(H),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:f(()=>[g(W,{onSelectTree:S}),ee("div",se,[g(l(K),{onRegister:l(b),class:"fix-basic-table",onResizeColumn:t[0]||(t[0]=(N,R)=>R.width=N),onSelectionChange:C,onRowDbClick:D},{toolbar:f(()=>[g(o,{type:"primary",preIcon:l(x).ADD,onClick:T},{default:f(()=>[I(_("添加"))]),_:1},8,["preIcon"]),g(o,{class:"red-btn",disabled:l(s)=="",preIcon:l(x).DELETE,onClick:z},{default:f(()=>[I(_("删除"))]),_:1},8,["disabled","preIcon"]),g(o,{class:"yellow-btn",preIcon:l(x).EXPORT,onClick:O},{default:f(()=>[I(_("导出"))]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])])]),_:1})}}});const Ae=j(ie,[["__scopeId","data-v-5adfee61"]]);export{Ae as default};
//# sourceMappingURL=index-d1853158.js.map
