var u=(m,b,_)=>new Promise((d,x)=>{var h=v=>{try{I(_.next(v))}catch(T){x(T)}},y=v=>{try{I(_.throw(v))}catch(T){x(T)}},I=v=>v.done?d(v.value):Promise.resolve(v.value).then(h,y);I((_=_.apply(m,b)).next())});import{au as Te,ad as H,I as G,av as De,_ as Se}from"./index.js";import{B as Re}from"./BasicTable-0434a334.js";import{T as Le}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as ze}from"./useTable-109483b3.js";import{aC as Be,aD as Y,aF as Oe,aG as ue,aH as Ee}from"./antd-15ac76ed.js";import He from"./deviceItem-f8cae721.js";import Ne from"./deviceDialog-59d49a92.js";import{e as Fe}from"./download-03e71dd5.js";import{g as Pe,l as Me,e as Ue,f as Ae,t as Ve}from"./monitorApi-44e70004.js";import{d as $e,k as o,r as Ge,w as Ye,o as je,al as j,Z as i,a9 as q,aa as c,$ as n,f as l,u as r,E as de,ad as S,_ as p,F as R,ae as N,a5 as F,a6 as qe,ac as K,aG as Ke,aH as We}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./deviceWarning-620b5d81.js";import"./dataDetail-62a9c747.js";import"./EchartLineChart.vue_vue_type_style_index_0_lang-c85cdf3b.js";import"./install-58e0bd81.js";import"./helper-474c7a04.js";import"./api-32c7505d.js";import"./index-74ac3212.js";import"./Export2Excel-389a8fc9.js";import"./dataComparison-458260e7.js";const Xe=m=>(Ke("data-v-cd123822"),m=m(),We(),m),Ze={class:"box-transformer-substation-overview"},Je={class:"station-selector-box"},Qe={class:"refresh-box"},ea={class:"area-content-box"},aa={class:"header-left"},ta={class:"radio-btn-box"},oa={class:"status-checkbox-group-box"},sa=Xe(()=>n("span",{class:"status-label-text"},"全部",-1)),na={class:"status-label-text"},la={class:"device-list-box"},ra={class:"area-pagination-box"},ia=["onClick"],ca={class:"area-pagination-box"},ua=["onClick"],da={key:1,class:"device-table-box"},W=24,X="TRANSFORMER_REFRESH",va=$e({__name:"boxTransformerSubstationOverview",props:{stationId:String,areaId:String},setup(m){const b=m,{createConfirm:_}=Te(),d=o(),x=o([]),h=o(0),y=o(1),I=(e,a)=>u(this,null,function*(){d.value=e,D()}),v=(e,a)=>a.name.indexOf(e)>=0,T=()=>u(this,null,function*(){let e=yield Pe();e!=null&&e.length&&(x.value=e,d.value||(d.value=x.value[0].id,D()))}),L=Ge({}),Z=o([]),P=o([]),M=o([]),z=o(1),k=o(1),B=e=>{z.value=e},D=()=>u(this,null,function*(){var a;let e=yield Me({stationId:d.value,abnormalType:f.value,deviceType:"Transformer"});if(Object.assign(L,e.abnormalInfo),E.value[0].number=L.normalNum,E.value[1].number=L.alarmNum,E.value[2].number=L.interruptNum,e!=null){if(Z.value=e.dataList,h.value=(a=e.dataList)==null?void 0:a.length,M.value=e.showColumns,P.value=[],h.value>0){k.value=Math.ceil(h.value/W);for(let s=0;s<k.value;s++){let w=s*W,C=Math.min((s+1)*W,h.value);P.value.push(e.dataList.slice(w,C))}}be(),ke(void 0,!1)}}),O=o("card"),E=o([{label:"正常",value:"normal",number:585},{label:"告警",value:"alarm",number:1},{label:"通讯中断",value:"interrupt",number:1}]),U=o(!0),f=o(["normal","alarm","interrupt"]),ve=e=>{console.log("checkedValue",e),f.value=e,D()},pe=e=>{f.value=e.target.checked?["normal","alarm","interrupt"]:[],D()};Ye(f,e=>{U.value=e.length===3});const A=o(!1),J=o(""),Q=o({}),ee=e=>{A.value=!0,J.value=e.esn,Q.value=e,me(e),he(e)},ae=o([]),me=e=>u(this,null,function*(){let a=yield Ue({stationId:b.stationId,areaId:b.areaId,esn:e.esn,dataType:3});ae.value=a}),te=o([]),oe=o(null),he=e=>u(this,null,function*(){let a=yield Ae({stationId:b.stationId,areaId:b.areaId,esn:e.esn,dataType:1});te.value=a.dataList,oe.value=a.showTimeStr}),fe=o({deviceLabelKey:"deviceName",left:"pvTotal",right:[],hasStatus:!1}),se=o(),ne=o(),le=o(),re=o(""),ge=()=>{re.value=`${r(se).offsetHeight-r(ne).offsetHeight-r(le).offsetHeight-44}px`},V=o([]),be=()=>u(this,null,function*(){var a;let e=[{title:"状态",dataIndex:"abnormalTypesStr",sorter:!0,width:80},{title:"设备名称",dataIndex:"deviceName",sorter:!0,width:150}];((a=M.value)==null?void 0:a.length)>0&&M.value.forEach(s=>{e.push({title:s.unit!=null?s.addressDesc+"("+s.unit+")":s.addressDesc,dataIndex:s.addressField,width:150})}),e.push({title:"更新时间",dataIndex:"time",sorter:!0,width:150}),V.value=e}),_e={normal:"green",alarm:"red",interrupt:"grey"},ie=o([]),xe=()=>u(this,null,function*(){let e=Z.value,a=[];return e.length>0&&e.forEach(s=>{var w;(w=s.actualDataList)!=null&&w.length&&s.actualDataList.forEach(C=>{s[C.addressField]=C.data}),a.push(s)}),ie.value=a,ie.value});o([]);const[ye,{reload:pa,reloadData:ke}]=ze({api:xe,columns:V,bordered:!0,actionColumn:{title:"操作",dataIndex:"action",slots:{customRender:"action"}},rowKey:"deviceId",pagination:{pageSize:20,pageSizeOptions:["20","50","100","200"]},showTableSetting:!0,tableSetting:{setting:!0,redo:!1,size:!1},showIndexColumn:!0});function we(){_({title:"提示",iconType:"warning",content:"确定要导出所有记录？",onOk(){return u(this,null,function*(){let a={stationId:d.value,abnormalType:f.value,deviceType:"Transformer"};a.fileName="箱变数据",a.excelList=V.value,yield Ve(a).then(s=>{Fe(s==null?void 0:s.data,a.fileName)})})}})}function Ce(e){ee(e.record)}const $=o(!0),ce=()=>u(this,null,function*(){console.info("refreshData:",Math.random());try{yield D()}catch(e){}}),Ie=e=>{var a;try{(a=e==null?void 0:e.target)!=null&&a.checked?H.getInstance().pushListTask(X,ce,5e3):H.getInstance().removeListTask(X)}catch(s){}};return je(()=>u(this,null,function*(){ge(),yield T(),H.getInstance().start(),$.value&&H.getInstance().pushListTask(X,ce,5e3)})),(e,a)=>{const s=j("a-pagination"),w=j("a-button"),C=j("PageWrapper");return i(),q(C,{fixedHeight:"",contentClass:"flex",style:{overflow:"hidden"}},{default:c(()=>[n("div",Ze,[n("div",{class:"area-box box-style",ref_key:"contentBoxRef",ref:se},[n("div",{class:"area-hearder-box",ref_key:"areaHearderBoxRef",ref:ne},[n("div",Je,[l(G,{class:"icon-left",icon:"mdi:house-city",color:"#1890FF",size:15}),l(r(Be),{style:{width:"200px"},value:d.value,"onUpdate:value":a[0]||(a[0]=t=>d.value=t),"show-search":"",options:x.value,"filter-option":v,fieldNames:{value:"id",label:"name"},onChange:I},null,8,["value","options"])]),n("div",Qe,[l(r(Y),{checked:$.value,"onUpdate:checked":a[1]||(a[1]=t=>$.value=t),onChange:Ie},{default:c(()=>[de("自动刷新")]),_:1},8,["checked"])])],512),n("div",ea,[n("div",{class:"content-header-box",ref_key:"areaContentHearderBoxRef",ref:le},[n("div",aa,[n("div",ta,[l(r(Oe),{value:O.value,"onUpdate:value":a[2]||(a[2]=t=>O.value=t),size:"small"},{default:c(()=>[l(r(ue),{value:"card"},{default:c(()=>[l(G,{icon:"ant-design:menu-outlined",class:"radio-btn-icon",size:14})]),_:1}),l(r(ue),{value:"table"},{default:c(()=>[l(G,{icon:"ant-design:insert-row-above-outlined",class:"radio-btn-icon",size:14})]),_:1})]),_:1},8,["value"])]),n("div",oa,[l(r(Y),{checked:U.value,"onUpdate:checked":a[3]||(a[3]=t=>U.value=t),onChange:pe},{default:c(()=>[sa,n("span",null,S(h.value),1)]),_:1},8,["checked"]),l(r(Ee),{value:f.value,"onUpdate:value":a[4]||(a[4]=t=>f.value=t),onChange:ve},{default:c(()=>[(i(!0),p(R,null,N(E.value,(t,g)=>(i(),q(r(Y),{key:g,value:t.value},{default:c(()=>[n("span",na,S(t.label),1),n("span",{class:F({"red-text":t.value!=="normal"&&t.number>0})},S(t.number),3)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])],512),O.value==="card"?(i(),p(R,{key:0},[n("div",{class:"device-content",style:qe({height:re.value})},[n("div",la,[(i(!0),p(R,null,N(P.value[z.value-1],(t,g)=>(i(),q(He,{class:"device-item-layout",key:g,options:fe.value,data:t,onDblclick:ma=>ee(t)},null,8,["options","data","onDblclick"]))),128))])],4),n("div",ra,[(i(!0),p(R,null,N(k.value,t=>(i(),p("div",{style:{display:"none"},class:F(["pagination-item",{"current-page":z.value===t}]),key:t,onClick:g=>B(t)},S(t),11,ia))),128)),l(s,{class:"pagination",current:y.value,"onUpdate:current":a[5]||(a[5]=t=>y.value=t),total:k.value,pageSize:1,showSizeChanger:!1,"show-less-items":"","show-quick-jumper":"",onChange:B},null,8,["current","total"])]),n("div",ca,[(i(!0),p(R,null,N(k.value,t=>(i(),p("div",{style:{display:"none"},class:F(["pagination-item",{"current-page":z.value===t}]),key:t,onClick:g=>B(t)},S(t),11,ua))),128)),l(s,{class:"pagination",current:y.value,"onUpdate:current":a[6]||(a[6]=t=>y.value=t),total:k.value,pageSize:1,showSizeChanger:!1,"show-less-items":"","show-quick-jumper":"",onChange:B},null,8,["current","total"])])],64)):K("",!0),O.value==="table"?(i(),p("div",da,[l(r(Re),{onRegister:r(ye)},{toolbar:c(()=>[l(w,{class:"yellow-btn",preIcon:r(De).EXPORT,onClick:we},{default:c(()=>[de("导出")]),_:1},8,["preIcon"])]),action:c(({record:t})=>[l(r(Le),{actions:[{label:"详情",icon:"clarity:note-edit-line",onClick:Ce.bind(null,{record:t})}]},null,8,["actions"])]),bodyCell:c(({column:t,record:g})=>[t.key==="abnormalTypesStr"?(i(),p("span",{key:0,class:F(["status-icon",_e[g.deviceShowFlag]])},null,2)):K("",!0)]),_:1},8,["onRegister"])])):K("",!0)])],512),l(Ne,{title:J.value,visible:A.value,ycData:ae.value,yxData:te.value,yxTime:oe.value,data:Q.value,"onUpdate:visible":a[7]||(a[7]=t=>A.value=t)},null,8,["title","visible","ycData","yxData","yxTime","data"])])]),_:1})}}});const Xa=Se(va,[["__scopeId","data-v-cd123822"]]);export{Xa as default};
//# sourceMappingURL=boxTransformerSubstationOverview-f2edef9e.js.map
