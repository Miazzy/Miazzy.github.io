var r=(z,W,m)=>new Promise((d,s)=>{var B=n=>{try{l(m.next(n))}catch(i){s(i)}},U=n=>{try{l(m.throw(n))}catch(i){s(i)}},l=n=>n.done?d(n.value):Promise.resolve(n.value).then(B,U);l((m=m.apply(z,W)).next())});import{B as ce}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as y}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{a0 as le,a7 as $,ax as D,az as j,bB as k,bD as ue,_ as pe}from"./index.js";import{u as de,g as me,a as fe,b as be,c as he,d as ve}from"./index-c0893416.js";import ge from"./Schedule-729c0814.js";import{h as R}from"./moment-4717c495.js";import{a as _}from"./assign-37f1c13d.js";import{d as Te,k as c,o as we,al as A,Z as L,_ as q,f as C,aa as b,$ as H,F as G,ae as ye,a9 as De,ad as ke,u as _e}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";const Ce={class:"card-content"},Ie={class:"tab-text"},Ye={class:"table-box"},Pe=Te({__name:"Approval",setup(z){const m=le().getUserInfo,d=c([{key:"1",tab:"待办任务",count:0},{key:"2",tab:"待阅任务",count:0},{key:"3",tab:"本人发起",count:0},{key:"4",tab:"已办任务",count:0},{key:"5",tab:"日程提醒",count:0}]),s=c("1"),B=a=>{a==="1"?x():a==="2"?N():a==="3"?V():a==="4"?E():a==="5"&&K()},U=()=>{s.value=="1"?D("/bpm/task/taskCenter","任务中心",{flowType:"010001"}):s.value=="2"?D("/bpm/task/taskCenter","任务中心",{flowType:"010002"}):s.value=="3"?D("/bpm/task/taskCenter","任务中心",{flowType:"020001"}):s.value=="4"?D("/bpm/task/taskCenter","任务中心",{flowType:"020003"}):s.value=="5"&&D("/oa/schedule/index","日程提醒")},l=[{title:"标题",dataIndex:"title",width:220,align:"left",customHeaderCell:a=>({class:"text-center"})},{title:"流程名称",dataIndex:"flowName",width:100},{title:"申请部门",dataIndex:"dept",width:120},{title:"申请人",dataIndex:"person",width:80},{title:"申请时间",dataIndex:"time",width:120}],n=[{title:"提醒",dataIndex:"content",width:330,align:"left",customHeaderCell:a=>({class:"text-center"})},{title:"开始时间",dataIndex:"startTime",width:100},{title:"创建人",dataIndex:"creator",width:120}],i={pagination:!1,striped:!1,useSearchForm:!1,showTableSetting:!1,bordered:!1,showIndexColumn:!0,canResize:!1},h=c([]),v=c([]),g=c([]),T=c([]),o=c([]),[J,I]=y(_({dataSource:h,columns:l},i)),[Q,Y]=y(_({dataSource:v,columns:l},i)),[X,P]=y(_({dataSource:g,columns:l},i)),[ee,M]=y(_({dataSource:T,columns:l},i)),[ae,S]=y(_({dataSource:o,columns:n},i)),te=c([J,Q,X,ee,ae]),Z=c(),se=a=>{s.value=="2"?de(a.processInstanceId).then(e=>{e.result&&(N(),j(a.businessKey))}):s.value=="5"?Z.value.handleView({id:a.id,type:a.type}):j(a.businessKey)},x=()=>r(this,null,function*(){const a=yield me();h.value.splice(0,h.value.length),a&&(d.value[0].count=a.total,a.list.forEach(e=>{h.value.push({title:e.description,flowName:e.processInstance.name,dept:e.processInstance.deptName,person:e.processInstance.startUserNickname,time:k.format(e.createTime,"YYYY-MM-DD hh:mm"),viewPath:e.bpmProcessDefinitionRespVO.formCustomCreatePath,processInstanceId:e.processInstance.id,businessKey:e.businessKey})})),I&&(I==null||I.setTableData(h.value))}),N=()=>r(this,null,function*(){const a=yield fe();v.value.splice(0,v.value.length),a&&(d.value[1].count=a.total,a.list.forEach(e=>{v.value.push({title:e.description,flowName:e.processInstance.name,dept:e.processInstance.deptName,person:e.processInstance.startUserNickname,time:k.format(e.createTime,"YYYY-MM-DD hh:mm"),viewPath:e.bpmProcessDefinitionRespVO.formCustomCreatePath,processInstanceId:e.processInstance.id,businessKey:e.businessKey})})),Y&&(Y==null||Y.setTableData(v.value))}),V=()=>r(this,null,function*(){const a=yield ue();if(g.value.splice(0,g.value.length),a){const e=yield be();d.value[2].count=e,a.list.forEach(t=>{g.value.push({title:t.description,flowName:t.name,dept:t.deptName,person:m.username,time:k.format(t.createTime,"YYYY-MM-DD hh:mm"),viewPath:t.bpmProcessDefinitionRespVO.formCustomCreatePath,processInstanceId:t.id,businessKey:t.businessKey})})}P&&(P==null||P.setTableData(g.value))}),E=()=>r(this,null,function*(){const a=yield he();T.value.splice(0,T.value.length),a&&a.list.forEach(e=>{T.value.push({title:e.description,flowName:e.processInstance.name,dept:e.processInstance.deptName,person:e.processInstance.startUserNickname,time:k.format(e.createTime,"YYYY-MM-DD hh:mm"),viewPath:e.bpmProcessDefinitionRespVO.formCustomCreatePath,processInstanceId:e.processInstance.id,businessKey:e.businessKey})}),M&&(M==null||M.setTableData(T.value))}),K=()=>r(this,null,function*(){const a=yield ve();o.value=[],a&&(a.forEach(e=>{let t={content:e.content,id:e.id,type:e.type,startTime:k.format(e.startTime,"YYYY-MM-DD HH:mm"),creator:e.creator};if(e.type=="schedule"){let u=new Date().getDay(),w=new Date(e.startTime).getDay(),F=R(new Date(e.startTime)).format("HH:mm"),p=R(new Date).format("HH:mm")>=F;switch(e.notificationRules){case"not":R(new Date).format("YYYY-MM-DD")==R(new Date(e.startTime)).format("YYYY-MM-DD")&&p&&o.value.push(t);break;case"day":p&&o.value.push(t);break;case"workday":u>=1&&u<=5&&p&&o.value.push(t);break;case"weekday":u==w&&p&&o.value.push(t);break;case"monthly":let O=Math.ceil(new Date().getDate()/7),re=Math.ceil(new Date(e.startTime).getDate()/7);u==w&&O==re&&p&&o.value.push(t);break;case"monthly2":new Date(e.startTime).getDate()==new Date().getDate()&&p&&o.value.push(t);break}}else{let u=new Date().getTime();new Date(e.startTime).getTime()-u<=oe[e.notificationRules]&&o.value.push(t)}}),d.value[4].count=o.value.length),S&&(S==null||S.setTableData(o.value))}),oe={start:0,"5min":5*60*1e3,"15min":15*60*1e3,"30min":30*60*1e3,"1h":60*60*1e3,"2h":2*60*60*1e3,"4h":4*60*60*1e3,"8h":8*60*60*1e3},ne=()=>r(this,null,function*(){setTimeout(()=>{x(),N(),V(),E(),K()},1500)}),ie=()=>r(this,null,function*(){setTimeout(()=>{x(),E()},1500)});return we(()=>r(this,null,function*(){x(),N(),V(),K(),$.getInstance().listen("workflow-task-done",ie),$.getInstance().listen("workbench-approval",ne),$.getInstance().listen("setMeeting",K)})),(a,e)=>{const t=A("a-badge"),u=A("a-tab-pane"),w=A("a-tabs"),F=A("a-card");return L(),q(G,null,[C(F,{title:"任务看板",bordered:!1},{extra:b(()=>[H("span",{onClick:U},"更多 >")]),default:b(()=>[H("div",Ce,[C(w,{activeKey:s.value,"onUpdate:activeKey":e[1]||(e[1]=f=>s.value=f),onChange:B},{default:b(()=>[(L(!0),q(G,null,ye(d.value,(f,p)=>(L(),De(u,{key:f.key},{tab:b(()=>[C(t,{count:f.count,offset:[16,-12],numberStyle:{transform:"scale(0.9)"}},{default:b(()=>[H("span",Ie,ke(f.tab),1)]),_:2},1032,["count","numberStyle"])]),default:b(()=>[H("div",Ye,[C(_e(ce),{onRegister:te.value[p],onRowDbClick:e[0]||(e[0]=O=>se(O)),scroll:{y:248}},null,8,["onRegister"])])]),_:2},1024))),128))]),_:1},8,["activeKey"])])]),_:1}),C(ge,{ref_key:"schedule",ref:Z},null,512)],64)}}});const ta=pe(Pe,[["__scopeId","data-v-baca2fc1"]]);export{ta as default};
//# sourceMappingURL=Approval-ff8e3a42.js.map
