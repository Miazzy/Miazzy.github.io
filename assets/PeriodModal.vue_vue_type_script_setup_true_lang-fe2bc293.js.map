{"version":3,"file":"PeriodModal.vue_vue_type_script_setup_true_lang-fe2bc293.js","sources":["../../src/views/oa/attend/PeriodModal.vue"],"sourcesContent":["<template>\n  <BasicModal v-bind=\"$attrs\" @register=\"registerModal\" title=\"排班周期设置\" @ok=\"handleSubmit\">\n    <BasicForm @register=\"registerForm\" />\n  </BasicModal>\n</template>\n<script lang=\"ts\" setup>\n  import { ref, unref } from 'vue';\n  import { BasicModal, useModalInner } from '/@/components/Modal';\n  import { BasicForm, useForm } from '/@/components/Form';\n  import { modalFormSchema } from './attend.data';\n  import * as AttendApi from '/@/api/oa/att';\n\n  defineOptions({ name: 'PeriodModal' });\n\n  const emit = defineEmits(['success', 'register']);\n\n  const isUpdate = ref(true);\n  const rowId = ref('');\n\n  const [registerForm, { resetFields, setFieldsValue, validate }] = useForm({\n    labelWidth: 100,\n    baseColProps: { span: 24 },\n    schemas: modalFormSchema,\n    showActionButtonGroup: false,\n  });\n\n  const [registerModal, { setModalProps, closeModal }] = useModalInner(async (data) => {\n    resetFields();\n    setModalProps({ confirmLoading: false });\n    isUpdate.value = !!data?.isUpdate;\n    if (unref(isUpdate)) {\n      rowId.value = data.record.id;\n      setFieldsValue({\n        ...data.record,\n      });\n    }\n  });\n\n  async function handleSubmit() {\n    try {\n      const values = await validate();\n      setModalProps({ confirmLoading: true });\n      // custom api\n      values.id = rowId.value;\n      await AttendApi.savePeriodData(values);\n      closeModal();\n      emit('success', { isUpdate: unref(isUpdate), values: { ...values, id: rowId.value } });\n    } finally {\n      setModalProps({ confirmLoading: false });\n    }\n  }\n</script>\n"],"names":["isUpdate","ref","rowId","registerForm","resetFields","setFieldsValue","validate","useForm","modalFormSchema","registerModal","setModalProps","closeModal","useModalInner","data","__async","unref","__spreadValues","handleSubmit","values","AttendApi.savePeriodData","emit","__spreadProps"],"mappings":"4iCAgBQ,MAAAA,EAAWC,EAAI,EAAI,EACnBC,EAAQD,EAAI,EAAE,EAEd,CAACE,EAAc,CAAE,YAAAC,EAAa,eAAAC,EAAgB,SAAAC,CAAS,CAAC,EAAIC,EAAQ,CACxE,WAAY,IACZ,aAAc,CAAE,KAAM,EAAG,EACzB,QAASC,EACT,sBAAuB,EAAA,CACxB,EAEK,CAACC,EAAe,CAAE,cAAAC,EAAe,WAAAC,EAAY,EAAIC,EAAqBC,GAASC,EAAA,sBACvEV,IACEM,EAAA,CAAE,eAAgB,EAAA,CAAO,EAC9BV,EAAA,MAAQ,CAAC,EAACa,GAAA,MAAAA,EAAM,UACrBE,EAAMf,CAAQ,IACVE,EAAA,MAAQW,EAAK,OAAO,GACXR,EAAAW,EAAA,GACVH,EAAK,OACT,EACH,EACD,EAED,SAAeI,GAAe,QAAAH,EAAA,sBACxB,GAAA,CACI,MAAAI,EAAS,MAAMZ,IACPI,EAAA,CAAE,eAAgB,EAAA,CAAM,EAEtCQ,EAAO,GAAKhB,EAAM,MACZ,MAAAiB,EAAyBD,CAAM,EAC1BP,IACXS,EAAK,UAAW,CAAE,SAAUL,EAAMf,CAAQ,EAAG,OAAQqB,EAAAL,EAAA,GAAKE,GAAL,CAAa,GAAIhB,EAAM,KAAA,EAAS,CAAA,CAAA,QACrF,CACcQ,EAAA,CAAE,eAAgB,EAAA,CAAO,CACzC,CACF"}