var k=(l,m,y)=>new Promise((S,f)=>{var u=g=>{try{v(y.next(g))}catch(C){f(C)}},P=g=>{try{v(y.throw(g))}catch(C){f(C)}},v=g=>g.done?S(g.value):Promise.resolve(g.value).then(u,P);v((y=y.apply(l,m)).next())});import{d as fe,k as p,r as M,o as ve,al as w,Z as N,a9 as he,aa as r,f as s,u as o,$ as V,E as x,_ as E,F as ge,ac as R,v as q,A as j,a7 as be}from"./vue-71d1abb3.js";import{D as we}from"./Dialog-0a006d82.js";import{B as _e}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as ye}from"./useTable-109483b3.js";import{a2 as c}from"./antd-15ac76ed.js";import{a0 as Ie,a5 as _,au as ke,av as T,aw as Ce,_ as xe}from"./index.js";import{P as Te}from"./index-20519caf.js";import{e as De}from"./download-03e71dd5.js";import{C as Ne}from"./CommonTree-c4ed7838.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";const Se=[{key:"organName",title:"所属公司",dataIndex:"organName",width:120,resizable:!0,sorter:!0,ifShow:Ie().isMultiOrganization,headAlign:"center",align:"left"},{key:"stationName",title:"所属电站",dataIndex:"stationName",headAlign:"center",align:"left",width:120,resizable:!0,sorter:!0},{key:"name",title:"库房名称",dataIndex:"name",headAlign:"center",align:"left",width:120,resizable:!0,sorter:!0},{key:"warehouseTypeText",title:"库房类型",dataIndex:"warehouseTypeText",align:"center",width:120,resizable:!0,sorter:!0},{key:"managerName",title:"管理员",dataIndex:"managerName",align:"center",width:120,resizable:!0,sorter:!0},{key:"status",title:"状态",dataIndex:"status",align:"center",width:120,resizable:!0,sorter:!0}],Ae=l=>_.post({url:"/baseset/common/list-orgStationTree",params:l},{}),H=l=>_.get({url:"/baseset/warehouse/page",params:l},{isOnlyResult:!0}),Fe=l=>_.get({url:"/baseset/warehouse/get",params:l},{}),Ee=l=>_.post({url:"/baseset/common/list-stationPerson",params:l},{}),Re=l=>_.post({url:"/baseset/warehouse/create",params:l},{}),Pe=l=>_.put({url:"/baseset/warehouse/update",params:l},{}),K=l=>_.put({url:"/baseset/warehouse/updateStatus",params:l},{}),Oe=l=>_.delete({url:"/baseset/warehouse/delete",params:l},{}),Be=l=>_.download({url:"/baseset/warehouse/export-excel",params:l},{isReturnNativeResponse:!0}),ze={class:"right-table-layout"},We={key:0,style:{color:"#19be6b"}},Ue={key:1,style:{color:"red"}},Le={class:"dialog-loading"},Me={key:0,class:"dialog-mask"},Ve=fe({__name:"warehouse",setup(l){let m=!1;const{createConfirm:y}=ke(),S=p([]),f=p({}),u=M({}),P=()=>k(this,null,function*(){let e=yield Ae({});S.value=e.result});let v=p("");function g(t={}){f.value=t,t?f.value.nodeKindId=="org"?(u.organId=f.value.id,u.stationId=""):(u.stationId=f.value.id,u.organId=""):(u.organId="",u.stationId=""),I()}const C=p(),d=p({});p([]);const b=p(!1),A=p("添加库房"),h=p(!1);p([]);const a=M({id:"",name:"",warehouseType:"",stationId:"",stationName:"",managerId:"",remark:""}),X=[{label:"启用",value:"1"},{label:"禁用",value:"0"}],O=p([]),B=p([]),Z={baseColProps:{span:8},labelWidth:120,showAdvancedButton:!1,schemas:[{label:"库房名称",field:"name",component:"Input"},{label:"库房类型",field:"warehouseType",component:"Select",componentProps:{options:O}},{label:"状态",field:"status",component:"Select",componentProps:{options:X}}]},$=t=>k(this,null,function*(){let e=Object.assign(t,u);e.pageNo=t.page;let n=yield H(e);return d.value={},n}),G=()=>k(this,null,function*(){const t=yield Ce({dictTypeList:"warehouse_type"});Reflect.has(t,"result")&&Object.keys(t.result).forEach(e=>{O.value=t.result[e]})}),[J,{reload:I,getPaginationRef:qe}]=ye({title:"库房列表",api:$,columns:Se,bordered:!0,useSearchForm:!0,formConfig:Z,rowSelection:{type:"radio",onChange:Q},showTableSetting:!0,tableSetting:{fullScreen:!0},showIndexColumn:!0,indexColumnProps:{fixed:"left"},fetchSetting:{listField:"list",pageField:"page",sizeField:"pageSize",totalField:"total"},sortFn:t=>{t.order?(u.sortField=t.field,u.sortOrder=t.order.replace("end","")):(u.sortField=null,u.sortOrder=null)}});function Q(t,e,n){e.length>0?(d.value=e[0],v.value=e[0]):(d.value={},v.value="")}const Y={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}}},ee=()=>{b.value=!1};function z(){a.id="",a.name="",a.stationId="",a.stationName="",a.managerId="",a.managerName="",a.warehouseType="",a.remark=""}const W=()=>k(this,null,function*(){const t=yield Ee("?stationId="+a.stationId);Reflect.has(t,"result")&&(B.value=[],t.result.forEach(e=>{let n={label:e.name,value:e.userId};B.value.push(n)}))});function ae(){if(A.value="添加库房",!f.value||f.value.nodeKindId!="station")return c.warn("请选择电站"),!1;z(),a.stationName=f.value.name,a.stationId=f.value.id,W(),b.value=!0,m=!1}function te(){if(A.value="修改库房",!d.value||!d.value.id){c.warn("请选择数据");return}H({id:d.value.id}).then(t=>{let e=t.list[0];a.id=e.id,a.name=e.name,a.stationId=e.stationId,a.stationName=e.stationName,a.managerId=e.managerId,a.warehouseType=e.warehouseType,a.remark=e.remark,W(),b.value=!0,m=!1})}function se(t){A.value="查看库房",Fe({id:t.id}).then(e=>{let n=e.result;a.id=n.id,a.name=n.name,a.stationId=n.stationId,a.stationName=n.stationName,a.managerId=n.managerId,a.warehouseType=n.warehouseType,a.remark=n.remark,W(),b.value=!0,m=!0})}function le(){if(!d.value||!d.value.id){c.warn("请选择数据");return}y({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return k(this,null,function*(){Oe("?id="+d.value.id).then(e=>{e.code=="0"?(c.success("数据已删除。"),I()):c.error("数据删除失败。"),h.value=!1,b.value=!1})})}})}function oe(){if(!d.value||!d.value.id){c.warn("请选择数据");return}K({id:d.value.id,status:1}).then(t=>{t.code=="0"?(c.success("启用成功。"),I()):c.error("启用失败。"),h.value=!1})}function ne(){if(!d.value||!d.value.id){c.warn("请选择数据");return}K({id:d.value.id,status:0}).then(t=>{t.code=="0"?(c.success("禁用成功。"),I()):c.error("禁用失败。"),h.value=!1})}function re(){y({title:"导出",iconType:"warning",content:"确定要导出所有记录？",onOk(){return k(this,null,function*(){Be(u).then(e=>{De(e==null?void 0:e.data,"库房设置.xls")})})}})}function ie(){C.value.validateFields().then(()=>{h.value=!0,a.id==""?Re(a).then(t=>{t.code=="0"?(c.success("数据已生成。"),I()):(c.success("数据生成失败。"),h.value=!1),h.value=!1,b.value=!1}).then(()=>{z()}):Pe(a).then(t=>{t.code=="0"?(c.success("数据已更新。"),I()):(c.success("数据更新失败。"),h.value=!1),h.value=!1,b.value=!1}).then(()=>{z()})})}return ve(()=>{P(),G()}),(t,e)=>{const n=w("a-button"),ue=w("a-spin"),U=w("a-input"),D=w("a-form-item"),L=w("a-select"),de=w("a-textarea"),ce=w("a-col"),pe=w("a-row"),me=w("a-form");return N(),he(o(Te),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:r(()=>[s(Ne,{title:"电站组织",onSelect:g,value:S.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,onRefresh:o(I),fieldNames:{key:"id",title:"name"}},null,8,["value","onRefresh"]),V("div",ze,[s(o(_e),{class:"fix-basic-table",onRegister:o(J),searchInfo:u,onResizeColumn:e[0]||(e[0]=(i,F)=>F.width=i),onRowDbClick:e[1]||(e[1]=i=>se(i))},{toolbar:r(()=>[s(n,{type:"primary",preIcon:o(T).ADD,onClick:ae},{default:r(()=>[x("添加")]),_:1},8,["preIcon"]),s(n,{type:"primary",disabled:o(v)=="",preIcon:o(T).EDIT,onClick:te},{default:r(()=>[x("修改")]),_:1},8,["disabled","preIcon"]),s(n,{class:"red-btn",disabled:o(v)=="",preIcon:o(T).DELETE,onClick:le},{default:r(()=>[x("删除")]),_:1},8,["disabled","preIcon"]),s(n,{class:"yellow-btn",preIcon:o(T).EXPORT,onClick:re},{default:r(()=>[x("导出")]),_:1},8,["preIcon"]),s(n,{class:"green-btn",disabled:o(v)=="",preIcon:o(T).ENABLE,onClick:oe},{default:r(()=>[x("启用")]),_:1},8,["disabled","preIcon"]),s(n,{class:"grey-btn",disabled:o(v)=="",preIcon:o(T).DISABLE,onClick:ne},{default:r(()=>[x("禁用")]),_:1},8,["disabled","preIcon"])]),bodyCell:r(({column:i,text:F})=>[i.key==="status"?(N(),E(ge,{key:0},[F==1?(N(),E("span",We,"启用")):R("",!0),F==0?(N(),E("span",Ue,"禁用")):R("",!0)],64)):R("",!0)]),_:1},8,["onRegister","searchInfo"])]),s(we,{visible:b.value,"onUpdate:visible":e[7]||(e[7]=i=>b.value=i),title:A.value,onCancel:ee,onOk:ie,height:450,width:800,smode:"normal",showBtm:!o(m)},{default:r(()=>[q(V("div",Le,[s(ue)],512),[[j,h.value]]),s(me,be({model:a,name:"createMaterial",labelAlign:"center"},Y,{ref_key:"modalFormRef",ref:C}),{default:r(()=>[s(pe,{gutter:24},{default:r(()=>[q(s(ce,{span:22},{default:r(()=>[s(D,{label:"电站",name:"stationName",labelCol:{style:{width:"124px"}},wrapperCol:15,rules:[{required:!0,message:"请选择电站"}],disabled:o(m)},{default:r(()=>[s(U,{value:a.stationName,"onUpdate:value":e[2]||(e[2]=i=>a.stationName=i),disabled:""},null,8,["value"])]),_:1},8,["disabled"]),s(D,{label:"库房名称",name:"name",labelCol:{style:{width:"124px"}},wrapperCol:15,rules:[{required:!0,message:"请输入库房名称"}]},{default:r(()=>[s(U,{value:a.name,"onUpdate:value":e[3]||(e[3]=i=>a.name=i),disabled:o(m)},null,8,["value","disabled"])]),_:1}),s(D,{label:"类型",name:"warehouseType",labelCol:{style:{width:"124px"}},wrapperCol:15,rules:[{required:!0,message:"请选择类型"}]},{default:r(()=>[s(L,{value:a.warehouseType,"onUpdate:value":e[4]||(e[4]=i=>a.warehouseType=i),options:O.value,"allow-clear":"",disabled:o(m)},null,8,["value","options","disabled"])]),_:1}),s(D,{label:"管理员",name:"managerId",labelCol:{style:{width:"124px"}},wrapperCol:15,rules:[{required:!0,message:"请输入管理员名称"}]},{default:r(()=>[s(L,{value:a.managerId,"onUpdate:value":e[5]||(e[5]=i=>a.managerId=i),options:B.value,"allow-clear":"",disabled:o(m)},null,8,["value","options","disabled"])]),_:1}),s(D,{label:"备注",name:"remark",labelCol:{style:{width:"124px"}}},{default:r(()=>[s(de,{value:a.remark,"onUpdate:value":e[6]||(e[6]=i=>a.remark=i),disabled:o(m)},null,8,["value","disabled"])]),_:1})]),_:1},512),[[j,!0]])]),_:1})]),_:1},16,["model"])]),_:1},8,["visible","title","showBtm"]),h.value?(N(),E("div",Me)):R("",!0)]),_:1})}}});const ga=xe(Ve,[["__scopeId","data-v-3084d81b"]]);export{ga as default};
//# sourceMappingURL=warehouse-4de4f1b2.js.map
