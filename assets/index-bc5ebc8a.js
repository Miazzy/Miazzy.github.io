var de=Object.defineProperty;var B=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var L=(i,e,a)=>e in i?de(i,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[e]=a,X=(i,e)=>{for(var a in e||(e={}))ce.call(e,a)&&L(i,a,e[a]);if(B)for(var a of B(e))ue.call(e,a)&&L(i,a,e[a]);return i};var d=(i,e,a)=>new Promise((c,u)=>{var n=t=>{try{b(a.next(t))}catch(y){u(y)}},p=t=>{try{b(a.throw(t))}catch(y){u(y)}},b=t=>t.done?c(t.value):Promise.resolve(t.value).then(n,p);b((a=a.apply(i,e)).next())});import{B as D}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as R}from"./useTable-109483b3.js";import{K as x}from"./antd-15ac76ed.js";import{a5 as _,a0 as T,aj as me,b as he,au as pe,aw as ge,av as M,_ as be}from"./index.js";import{e as z}from"./download-03e71dd5.js";import{u as fe,B as we}from"./useForm-dea3ed18.js";import{d as ye,k as S,r as xe,o as Te,al as A,Z as I,_ as ve,$ as q,f as h,u as r,aa as m,a9 as k,E as j,ad as P,ac as N}from"./vue-71d1abb3.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./uniqBy-92d3bc7f.js";const W=i=>_.get({url:"/bi/common/org/info",params:i},{isOnlyResult:!0}),Z=i=>_.post({url:"/baseset/common/list-station",params:i}),E=i=>_.post({url:"/bi/hidden/export-excel",params:i,responseType:"blob"},{isReturnNativeResponse:!0});function F(i,e){return e.tab=i,_.post({url:"/bi/hidden/list",params:e})}const H=[{title:"所属公司",dataIndex:"stationOrganName",align:"left",headAlign:"center",width:"12%",resizable:!0,customCell:(i,e,a)=>({rowSpan:i.rowSpan}),ifShow:T().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",align:"left",headAlign:"center",width:"12%",resizable:!0},{title:"隐患总数",dataIndex:"hiddenTotal",align:"right",headAlign:"center",width:160,resizable:!0},{title:"隐患处理数",dataIndex:"hiddenRect",align:"right",headAlign:"center",width:160,resizable:!0},{title:"隐患待处理数",dataIndex:"hiddenRectNot",align:"right",headAlign:"center",width:160,resizable:!0},{title:"超期处理隐患数",dataIndex:"hiddenRectOver",align:"right",headAlign:"center",width:160,resizable:!0},{title:"隐患处理率(%)",dataIndex:"rectRate",align:"right",headAlign:"center",width:160,resizable:!0},{title:"按期处理数",dataIndex:"hiddenRectInTime",align:"right",headAlign:"center",width:160,resizable:!0},{title:"按期处理率(%)",dataIndex:"rectRateInTime",align:"right",headAlign:"center",width:160,resizable:!0},{title:"超期未处理隐患数",dataIndex:"hiddenRectOverNot",align:"right",headAlign:"center",width:160,resizable:!0},{title:"超期待处理率(%)",dataIndex:"hiddenRectOverNotRate",align:"right",headAlign:"center",width:160,resizable:!0}];function U(i,e,a,c){const u=[{title:"所属公司",dataIndex:"stationOrganName",width:160,resizable:!0,align:"left",headAlign:"center",customCell:(n,p,b)=>({rowSpan:n.rowSpan}),ifShow:T().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",align:"left",headAlign:"center",width:160,resizable:!0},{title:"隐患总数",dataIndex:"hiddenTotal",align:"right",headAlign:"center",width:100,resizable:!0}];if(i=="year")for(let n=1;n<=12;n++){const p=e+"-"+(n<10?"0"+n:n);u.push({title:p,align:"right",headAlign:"center",dataIndex:p,width:100,resizable:!0})}else{let n=x(a);do u.push({title:n.format("YYYY-MM"),dataIndex:n.format("YYYY-MM"),width:100,resizable:!0}),n=n.add(1,"month");while(n.toISOString().substring(0,10)<=c)}return u}const Y=[{title:"所属公司",dataIndex:"stationOrganName",width:160,resizable:!0,align:"left",headAlign:"center",customCell:(i,e,a)=>({rowSpan:i.rowSpan}),ifShow:T().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",align:"left",headAlign:"center",width:160,resizable:!0},{title:"隐患总数",dataIndex:"hiddenTotal",align:"right",headAlign:"center",width:100,resizable:!0},{title:"安全检查",dataIndex:"safety",children:[],resizable:!0},{title:"车辆检查",dataIndex:"vehicle",children:[],resizable:!0},{title:"巡检",dataIndex:"inspection",children:[],resizable:!0}],Ie=String(x().year()),Ye=i=>[{field:"dateType",label:"时间维度",component:"Select",defaultValue:"year",componentProps:({formModel:e})=>({allowClear:!1,options:[{value:"year",label:"年度"},{value:"month",label:"月份"},{value:"day",label:"自然日"}],onChange:a=>{e.year="",e["[startMonth, endMonth]"]=[null,null],e["[startDate, endDate]"]=[null,null]}})},{field:"year",label:"发现时间",component:"DatePicker",defaultValue:Ie,componentProps:{allowClear:!1,format:"YYYY",valueFormat:"YYYY-MM-DD",picker:"year",style:"width: 100%"},show:({values:e})=>e.dateType==="year"},{field:"[startDate, endDate]",label:"发现时间",component:"RangePicker",componentProps:{allowClear:!1,format:"YYYY-MM",valueFormat:"YYYY-MM-DD",picker:"month",placeholder:["开始月份","结束月份"],style:"width: 100%"},show:({values:e})=>e.dateType==="month"},{field:"[startDate, endDate]",label:"发现时间",component:"RangePicker",componentProps:{allowClear:!1,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",picker:"day",placeholder:["开始日期","结束日期"],style:"width: 100%"},show:({values:e})=>e.dateType==="day"},{field:"stationOrganId",label:"所属公司",component:"ApiSelect",componentProps:({formModel:e})=>({api:()=>d(void 0,null,function*(){return yield W({})}),onChange:a=>{e.stationIds=[]}}),ifShow:T().isMultiOrganization},{field:"stationId",label:"电站名称",component:"ApiSelect",componentProps:{api:()=>d(void 0,null,function*(){const e=yield Z({}),a=[];return e.result&&e.result.length>0&&e.result.forEach(c=>{a.push({value:c.id,label:c.name})}),a}),filterOption:(e,a)=>a.label.toLowerCase().indexOf(e.toLowerCase())>=0}}],_e={class:"tab-model"},Oe={class:"tab-button-div"},Ce={class:"tab-table-div tab-table-content",id:"more-tab-content"},De=ye({__name:"index",setup(i){var K,V;let{params:e}=me();e.dateType&&(((K=e.startDate)==null?void 0:K.length)==7&&(e.startDate=e.startDate+"-01"),((V=e.endDate)==null?void 0:V.length)==7&&(e.endDate=e.endDate+"-01"));const{t:a}=he(),{createConfirm:c,createMessage:u}=pe(),n=S("statistics"),p=S([]),b=S([]),t=xe({dateType:"year",year:x(new Date).format("YYYY-MM-DD")}),[y,{resetFields:$,getFieldsValue:g,setFieldsValue:G}]=fe({labelWidth:120,baseColProps:{span:8},actionColOptions:{span:24},autoAdvancedLine:1,showAdvancedButton:T().isMultiOrganization,schemas:Ye(),compact:!0,resetButtonOptions:{onClick:()=>d(this,null,function*(){yield $(),O()})},submitFunc:()=>(O(),Promise.resolve())}),O=()=>{n.value==="statistics"&&Q(),n.value==="month"&&ae(),n.value==="hiddenType"&&oe()},[J,{reload:Q}]=R({api:()=>d(this,null,function*(){return Object.assign(t,g()),Object.assign(t,e),(yield F("statistics",t)).result}),columns:H,target:"#more-tab-content",targetTabKey:"statistics",targetTabValue:n,rowKey:"id",bordered:!0,useSearchForm:!1,pagination:!1}),[ee,{setColumns:te,reload:ae}]=R({api:()=>d(this,null,function*(){return Object.assign(t,g()),Object.assign(t,e),(yield F("month",t)).result}),target:"#more-tab-content",targetTabKey:"month",targetTabValue:n,columns:[{title:"所属公司",dataIndex:"stationOrganName",width:160},{title:"电站名称",dataIndex:"stationName",width:160},{title:"隐患总数",dataIndex:"hiddenTotal",width:100}],rowKey:"id",bordered:!0,useSearchForm:!1,pagination:!1,beforeFetch:()=>{Object.assign(t,g()),te(U(t.dateType,x(t.year).format("YYYY"),t.startDate,t.endDate))}}),[ne,{setColumns:ie,reload:oe}]=R({api:()=>d(this,null,function*(){return Object.assign(t,g()),Object.assign(t,e),(yield F("hiddenType",t)).result}),columns:Y,rowKey:"id",bordered:!0,useSearchForm:!1,target:"#more-tab-content",targetTabKey:"hiddenType",targetTabValue:n,pagination:!1});function le(){c({title:a("common.message.confirmTitle"),iconType:"warning",content:a("common.message.exportMessage"),onOk(){return d(this,null,function*(){Object.assign(t,g()),t.filename="统计报表.xls",t.excelList=H,yield E(t).then(o=>{z(o==null?void 0:o.data,t.filename)}),t.filename=null,t.excelList=null,u.success(a("common.exportSuccessText"))})}})}function se(){c({title:a("common.message.confirmTitle"),iconType:"warning",content:a("common.message.exportMessage"),onOk(){return d(this,null,function*(){Object.assign(t,g()),t.filename="月统计.xls",t.excelList=U(t.dateType,x(t.year).format("YYYY"),t.startDate,t.endDate),yield E(t).then(o=>{z(o==null?void 0:o.data,t.filename)}),t.filename=null,t.excelList=null,u.success(a("common.exportSuccessText"))})}})}function re(){c({title:a("common.message.confirmTitle"),iconType:"warning",content:a("common.message.exportMessage"),onOk(){return d(this,null,function*(){Object.assign(t,g()),t.filename="分类统计.xls",t.excelList=Y,yield E(t).then(o=>{z(o==null?void 0:o.data,t.filename)}),t.filename=null,t.excelList=null,u.success(a("common.exportSuccessText"))})}})}return Te(()=>d(this,null,function*(){G(X({},e));let f=[],o=[],w=[];ge({dictTypeList:"hidden_danger_type"}).then(l=>{l.result.hidden_danger_type.forEach(s=>{s.relationDict=="safety"&&f.push({title:s.label,align:"right",headAlign:"center",dataIndex:s.value,width:100}),s.relationDict=="vehicle"&&o.push({title:s.label,align:"right",headAlign:"center",dataIndex:s.value,width:100}),s.relationDict=="inspection"&&w.push({title:s.label,align:"right",headAlign:"center",dataIndex:s.value,width:100})})}).then(()=>{Y.forEach(l=>{l.dataIndex=="safety"&&(l.children=f),l.dataIndex=="vehicle"&&(l.children=o),l.dataIndex=="inspection"&&(l.children=w)}),ie(Y)}),(yield Z({})).result.forEach(l=>{b.value.push({value:l.powerStationId,label:l.powerStationName})});const C=yield W({});p.value=C})),(f,o)=>{const w=A("a-button"),v=A("a-tab-pane"),C=A("a-tabs");return I(),ve("div",_e,[q("div",Oe,[h(r(we),{onRegister:r(y),onAdvancedChange:O},null,8,["onRegister"])]),q("div",Ce,[h(C,{activeKey:n.value,"onUpdate:activeKey":o[3]||(o[3]=l=>n.value=l)},{default:m(()=>[h(v,{key:"statistics",tab:"统计报表"},{default:m(()=>[h(r(D),{onRegister:r(J),onResizeColumn:o[0]||(o[0]=(l,s)=>s.width=l),class:"w-4/4 xl:w-12/12"},{toolbar:m(()=>[n.value=="statistics"?(I(),k(w,{key:0,class:"yellow-btn",preIcon:r(M).EXPORT,onClick:le},{default:m(()=>[j(P(r(a)("common.action.export")),1)]),_:1},8,["preIcon"])):N("",!0)]),_:1},8,["onRegister"])]),_:1}),h(v,{key:"month",tab:"月统计"},{default:m(()=>[h(r(D),{onRegister:r(ee),onResizeColumn:o[1]||(o[1]=(l,s)=>s.width=l),class:"w-4/4 xl:w-12/12"},{toolbar:m(()=>[n.value=="month"?(I(),k(w,{key:0,class:"yellow-btn",preIcon:r(M).EXPORT,onClick:se},{default:m(()=>[j(P(r(a)("common.action.export")),1)]),_:1},8,["preIcon"])):N("",!0)]),_:1},8,["onRegister"])]),_:1}),h(v,{key:"hiddenType",tab:"分类统计"},{default:m(()=>[h(r(D),{onRegister:r(ne),onResizeColumn:o[2]||(o[2]=(l,s)=>s.width=l),class:"w-4/4 xl:w-12/12"},{toolbar:m(()=>[n.value=="hiddenType"?(I(),k(w,{key:0,class:"yellow-btn",preIcon:r(M).EXPORT,onClick:re},{default:m(()=>[j(P(r(a)("common.action.export")),1)]),_:1},8,["preIcon"])):N("",!0)]),_:1},8,["onRegister"])]),_:1})]),_:1},8,["activeKey"])])])}}});const Je=be(De,[["__scopeId","data-v-cd5222c0"]]);export{Je as default};
//# sourceMappingURL=index-bc5ebc8a.js.map
