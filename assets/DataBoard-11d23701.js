var f=(v,r,d)=>new Promise((i,m)=>{var h=o=>{try{y(d.next(o))}catch(_){m(_)}},p=o=>{try{y(d.throw(o))}catch(_){m(_)}},y=o=>o.done?i(o.value):Promise.resolve(o.value).then(h,p);y((d=d.apply(v,r)).next())});import{I as F,_ as L}from"./index.js";import O from"./IndexSelectDialog-0532c0db.js";import{g as $,a as z,b as H,s as M,c as P}from"./data-70d59c19.js";import{d as Z,k as u,r as w,o as j,al as B,Z as b,_ as g,f as x,aa as D,$ as c,F as k,ae as S,ad as C,aG as A,aH as J}from"./vue-71d1abb3.js";import{a2 as K}from"./antd-15ac76ed.js";import"./Dialog-0a006d82.js";const Q=v=>(A("data-v-760847f0"),v=v(),J(),v),W=Q(()=>c("span",{class:"card-extra-text"}," 你的数据范围：",-1)),X={class:"card-content"},Y={class:"nav-item-container"},aa={class:"data-board-item"},ea={class:"date-type-tag"},ta={class:"label-text"},la={class:"value-text"},na=Z({__name:"DataBoard",setup(v){const r=u(!1),d=u(),i=w({dataBoard:[]}),m=u([]),h=w({}),p=u([]);u([]);const y=u([{title:"指标类型",dataIndex:"",customRender:({record:e})=>e.parent_node.label},{title:"指标名称",dataIndex:"title"}]),o=u([{title:"序号",dataIndex:"index",key:"index",width:60},{title:"名称",dataIndex:"label",key:"label"},{title:"颗粒度",dataIndex:"dataGranularity",key:"dataGranularity"},{title:"时间维度",dataIndex:"dateType",key:"dateType",width:100,type:"select",selectOptions:{day:[{label:"今日",value:"today"},{label:"本周",value:"current_week"},{label:"当月",value:"current_month"},{label:"本季度",value:"current_quarter"},{label:"当年",value:"current_year"},{label:"累计",value:"total"}],month:[{label:"当月",value:"current_month"},{label:"本季度",value:"current_quarter"},{label:"当年",value:"current_year"},{label:"累计",value:"total"}],year:[{label:"当年",value:"current_year"},{label:"累计",value:"total"}]}},{title:"排序",dataIndex:"sort",key:"sort",width:60},{title:"操作",dataIndex:"action",key:"action",width:60}]);j(()=>f(this,null,function*(){var a;_();const e=yield $({});e&&e.forEach(l=>{var n;(n=l.children)!=null&&n.length&&l.children.forEach(t=>{p.value.push({value:t.id,label:t.name})})}),(a=p.value)!=null&&a.length&&(h.selectStationValue=p.value[0].value)}));const _=()=>f(this,null,function*(){yield z({}).then(e=>{e&&(i.dataBoard=[],e.forEach(a=>{i.dataBoard.push({value:a.parentId,label:a.name,parentId:a.parentId,name:a.name,fullName:a.fullName,dataGranularity:a.dataGranularity,dateType:a.dateType})}))}),yield H({}).then(e=>{e&&(m.value=e,i.dataResult=[],e.forEach(a=>{i.dataResult.push({value:a.value,label:a.name})}))})}),G=()=>f(this,null,function*(){const e=yield P({});d.value=T(e.result,!0)});function T(e,a){const l=[];for(let n=0;n<e.length;n++){const t=e[n],s={label:t.name,value:t.id,parentId:t.parentId,dataGranularity:t.dataGranularity,disabled:a?t.type!=="index":!1};t.children&&t.children.length>0&&(s.children=T(t.children,a)),l.push(s)}return l}const E=()=>f(this,null,function*(){r.value=!0,G()}),N=()=>{r.value=!1},R=e=>{let a=[];e&&e.length>0&&e.forEach((l,n)=>{a.push({indexStorehouseId:l.value,dateType:l.dateType,dataGranularity:l.dataGranularity,sort:n+1})}),M(a).then(()=>{K.success("操作成功"),_(),r.value=!1})},V=e=>{console.log(e)};return(e,a)=>{const l=B("a-select"),n=B("a-carousel"),t=B("a-card");return b(),g(k,null,[x(t,{class:"data-board",title:"数据看板",bordered:!1},{extra:D(()=>[W,x(l,{ref:"select","label-in-value":"",value:h.selectStationValue,"onUpdate:value":a[0]||(a[0]=s=>h.selectStationValue=s),options:p.value,style:{width:"200px"}},null,8,["value","options"]),x(F,{icon:"ion:settings-outline",size:17,onClick:a[1]||(a[1]=s=>E())})]),default:D(()=>[c("div",X,[x(n,{dotsClass:"carousel-dots","after-change":V},{default:D(()=>[(b(!0),g(k,null,S(m.value,(s,q)=>(b(),g("div",{class:"nav-page",key:q},[c("div",Y,[(b(!0),g(k,null,S(s,(I,U)=>(b(),g("div",{class:"data-board-item-layout",key:U},[c("div",aa,[c("div",ea,C(I.dateTypeText),1),c("div",ta,C(I.name),1),c("div",la,C(I.value),1)])]))),128))])]))),128))]),_:1})])]),_:1}),x(O,{title:"指标库",visible:r.value,"onUpdate:visible":a[2]||(a[2]=s=>r.value=s),value:i.dataBoard,tdata:d.value,tfields:{key:"value",title:"label"},width:1e3,height:600,onCancel:N,onConfirm:R,scolumns:y.value,max:30,rightColumns:o.value},null,8,["visible","value","tdata","scolumns","rightColumns"])],64)}}});const va=L(na,[["__scopeId","data-v-760847f0"]]);export{va as default};
//# sourceMappingURL=DataBoard-11d23701.js.map
