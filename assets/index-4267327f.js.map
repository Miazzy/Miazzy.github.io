{"version":3,"file":"index-4267327f.js","sources":["../../src/views/po/integrated/assessmentevaluation/daily/index.vue"],"sourcesContent":["<template>\n  <PageWrapper dense contentFullHeight fixedHeight contentClass=\"flex\" style=\"position: relative\">\n    <!-- <stationTree @select-tree=\"selectTree\" /> -->\n    <CommonTree\n      title=\"电站组织\"\n      @select=\"selectTree\"\n      :value=\"treeData\"\n      :canEdit=\"false\"\n      :canAdd=\"false\"\n      :canDelete=\"false\"\n      class=\"left-tree-layout\"\n      :isShowOperationBtns=\"false\"\n      :fieldNames=\"{ key: 'id', title: 'name' }\"\n    />\n    <!-- 数据表格 -->\n    <div class=\"right-table-layout\">\n      <BasicTable\n        class=\"fix-basic-table\"\n        @register=\"registerTable\"\n        @resize-column=\"(w, col) => (col.width = w)\"\n        @row-db-click=\"(record) => handleReadOnlyView(record)\"\n        @selection-change=\"handleSelectChange\"\n      >\n        <template #toolbar>\n          <a-button type=\"primary\" :preIcon=\"IconEnum.ADD\" @click=\"handleAdd\">\n            {{ t('common.action.create') }}</a-button\n          >\n          <a-button\n            class=\"red-btn\"\n            :disabled=\"selectedRowId == ''\"\n            :preIcon=\"IconEnum.DELETE\"\n            @click=\"handleDelete\"\n          >\n            {{ t('common.delText') }}</a-button\n          >\n        </template>\n        <template #bodyCell=\"{ column, text, record }\">\n          <template v-if=\"column.key === 'businessStatus'\">\n            <span style=\"color: red\" v-if=\"text == 0\">禁用</span>\n            <span style=\"color: #30ca5a\" v-if=\"text == 1\">启用</span>\n          </template>\n        </template>\n      </BasicTable>\n    </div>\n  </PageWrapper>\n</template>\n<script lang=\"ts\" setup>\n  import { onMounted, ref, reactive } from 'vue';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { ElMessageBox } from 'element-plus';\n  import { BasicTable, useTable, TableAction } from '/@/components/Table';\n  import { useRouter } from 'vue-router';\n  import { PageWrapper } from '/@/components/Page';\n  import { IconEnum } from '@/enums/appEnum';\n  import { cancelProcessInstance } from '@/api/bpm/processInstance';\n  import { message } from 'ant-design-vue';\n  import { columns, getDailyPage, searchFormSchema, getTreeDataApi } from './daily.ts';\n  import { setStationAndOrgan } from '@/views/po/stationtree/stationTree';\n  import CommonTree from '@/components/Framework/Tree/CommonTree.vue';\n  import stationTree from '@/views/po/stationtree/stationTree.vue';\n  import { assign } from 'lodash-es';\n  import { addTabPage } from '@/utils/route';\n  import { MsgManager } from '/@/message/MsgManager';\n  import * as ProcessInstanceApi from '@/api/bpm/processInstance';\n  import { useMessage } from '@/hooks/web/useMessage';\n  import * as CommonUtil from '/@/utils/common';\n  const { createConfirm } = useMessage();\n\n  const router = useRouter();\n  const queryParam = ref({\n    stationId: '',\n    stationOrganId: '',\n    pageNo: 1,\n    pageSize: 10,\n  });\n\n  const { t } = useI18n();\n  let selectedRowId = ref('');\n  let selectedRow = reactive({});\n  const sortData = reactive({});\n  const treeData = ref<TreeItem[]>([]);\n\n  const getTreeData = async () => {\n    let param = {};\n    let rs = await getTreeDataApi(param);\n    treeData.value = rs.result;\n  };\n\n  const getPageByParam = async () => {\n    const paginationRef = getPaginationRef() as any;\n    const searchPageInfo = getForm().getFieldsValue();\n    assign(searchPageInfo, queryParam.value);\n    searchPageInfo.pageNo = paginationRef.current;\n    searchPageInfo.pageSize = paginationRef.pageSize;\n    searchPageInfo.sortField = sortData.sortField;\n    searchPageInfo.sortOrder = sortData.sortOrder;\n    let pageList = await getDailyPage(searchPageInfo);\n    return pageList;\n  };\n  const [registerTable, { reload, getPaginationRef, getForm, getSelectRows }] = useTable({\n    title: '日常评价',\n    api: getPageByParam,\n    rowKey: 'id',\n    columns,\n    useSearchForm: true,\n    showTableSetting: true,\n    bordered: true,\n    pagination: { pageSize: 20, pageSizeOptions: ['20', '50', '100', '200'] },\n    handleSearchInfoFn(searchInfo) {\n      return searchInfo;\n    },\n    formConfig: {\n      labelWidth: 120,\n      actionColOptions: { span: 24 },\n      autoAdvancedLine: 1,\n      baseColProps: { span: 7 },\n      schemas: searchFormSchema,\n      noHideBtnFlag: true,\n      autoSubmitOnEnter: true,\n    },\n    rowSelection: {\n      type: 'radio',\n      fixed: true,\n      onSelect: onSelect,\n    },\n    sortFn: (sortInfo: SorterResult) => {\n      if (sortInfo.order) {\n        sortData.sortField = sortInfo.field;\n        sortData.sortOrder = sortInfo.order.replace('end', '');\n      } else {\n        sortData.sortField = '';\n        sortData.sortOrder = '';\n      }\n    },\n  });\n\n  function handleSelectChange({ keys, rows }) {\n    if (rows && rows.length > 0) {\n      const record = rows[0];\n      selectedRowId.value = record.id;\n      selectedRow = record;\n    } else {\n      selectedRowId.value = '';\n      selectedRow = null;\n    }\n  }\n\n  function onSelect(record, selected) {\n    if (selected) {\n      selectedRowId.value = record.id;\n      selectedRow = record;\n    } else {\n      selectedRowId.value = '';\n      selectedRow = null;\n    }\n  }\n  // 树的点击操作\n  function selectTree(data) {\n    // setStationAndOrgan(data, queryParam, reload);\n    if (data != null) {\n      queryParam.value.stationId = data.powerStationId;\n      queryParam.value.stationName = data.powerStationName;\n      queryParam.value.stationOrganId = data.organId;\n    }\n    reload();\n  }\n\n  //---------------------------------操作按钮---------------------------------------\n  // 新增\n  const handleAdd = async () => {\n    if (queryParam.value.stationId == '') {\n      message.error('请选择电站。');\n      return;\n    }\n    addTabPage(\n      '/po/integrated/assessmentevaluation/daily/create?stationId=' +\n        queryParam.value.stationId +\n        '&stationName=' +\n        queryParam.value.stationName,\n      '添加日常评价',\n    );\n  };\n\n  function handleReadOnlyView(record: any) {\n    CommonUtil.toFlowPage(record.id);\n  }\n\n  //获取表格选择数据\n  function checkSelectData() {\n    const selectRows = getSelectRows();\n    if (selectRows.length == 0) {\n      message.error('请选择一行数据');\n      return false;\n    }\n    return selectRows[0] as any;\n  }\n  //删除\n  async function handleDelete() {\n    createConfirm({\n      title: '提示',\n      iconType: 'warning',\n      content: '确定要删除选中记录？',\n      async onOk() {\n        const row = checkSelectData();\n        if (!row.id) {\n          return;\n        }\n        // const res = await getTemplate({ id: row.id });\n        if (row.status != 0) {\n          message.error('非草稿状态不能删除。');\n          return;\n        }\n        // 发起取消\n        await ProcessInstanceApi.deleteProcessInstance(row.processInstanceId);\n        message.success('已删除。');\n        reload();\n      },\n    });\n  }\n\n  // 启动执行代码\n  onMounted(async () => {\n    getTreeData();\n    MsgManager.getInstance().listen('daily-evaluation', reload);\n  });\n</script>\n<style lang=\"less\" scoped>\n  .left-tree-layout {\n    flex-shrink: 0;\n    width: 298px;\n    border-radius: 2px;\n  }\n\n  .right-table-layout {\n    width: calc(100% - 308px);\n  }\n\n  .fix-basic-table {\n    :deep(&.vben-basic-table .ant-table-wrapper) {\n      padding: 10px 16px 12px;\n    }\n\n    :deep(.table-settings .anticon-setting) {\n      margin-right: 0;\n    }\n  }\n</style>\n"],"names":["createConfirm","useMessage","useRouter","queryParam","ref","t","useI18n","selectedRowId","reactive","sortData","treeData","getTreeData","__async","rs","getTreeDataApi","getPageByParam","paginationRef","getPaginationRef","searchPageInfo","getForm","assign","getDailyPage","registerTable","reload","getSelectRows","useTable","columns","searchInfo","searchFormSchema","onSelect","sortInfo","handleSelectChange","keys","rows","record","selected","selectTree","data","handleAdd","message","addTabPage","handleReadOnlyView","CommonUtil.toFlowPage","checkSelectData","selectRows","handleDelete","row","ProcessInstanceApi.deleteProcessInstance","onMounted","MsgManager"],"mappings":"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"}