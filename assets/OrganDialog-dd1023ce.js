import{d as se,k as p,w as N,o as oe,al as O,Z as f,a9 as _,aa as z,$ as d,a6 as C,f as k,af as ce,a5 as ie,ac as D,_ as L,ae as re,F as de,u as ue,B as pe,ad as ve,aG as fe,aH as he}from"./vue-71d1abb3.js";import{D as ye}from"./Dialog-0a006d82.js";import{I as y,at as ge,_ as _e}from"./index.js";import{a0 as A}from"./antd-15ac76ed.js";const R=h=>(fe("data-v-5e1b8a26"),h=h(),he(),h),ke={class:"category-tree"},xe=R(()=>d("span",{class:"category-title"},[d("span",null,"组织结构")],-1)),be={class:"category-search-box",style:{position:"relative"}},Ie=R(()=>d("span",{class:"search-title",style:{}},"搜索",-1)),we={class:"search-icon",style:{left:"300px"}},me={class:"search-icon",style:{left:"340px"}},Ce={class:"employee-table"},De=R(()=>d("span",{class:"employee-title"},[d("span",null,"被选人员")],-1)),Me={class:"employee-content"},Se={class:"component-wrap"},Ne=["title"],Oe={class:"icon-close"},ze=se({__name:"OrganDialog",props:{visible:Boolean,title:String,width:{type:Number,default:700},height:{type:Number,default:500},value:{type:Array,default:[]},tdata:{type:Array},tfields:{type:Object,default:{key:"id",title:"title",dept:"dept",postion:"postion"}},ticons:{type:Object,default:{parent:"ant-design:down-outlined",middle:"mingcute:department-line",leaf:"gridicons:multiple-users"}},message:{type:Object,default:{none:"当前没有被选人员，无法删除！",double:"该节点已经被选中，请不要重复勾选！",delete:"请您确认是否删除所有勾选节点？"}}},emits:["update:visible","update:value","cancel","confirm","close"],setup(h,{emit:g}){const s=h,x=p(!1),B=p([]),v=p(""),b=p(null),r=p([]),u=p(),I=p([]),E=p([]),U=p([{title:"名称",dataIndex:"title",key:"title",fixed:!0,width:80},{title:"公司",dataIndex:"company",key:"company",fixed:!1,width:200},{title:"部门",dataIndex:"dept",key:"dept",fixed:!1,width:150},{title:"岗位",dataIndex:"postion",key:"postion",fixed:!1,width:150}]),q=()=>{r.value=[],g("cancel")},G=()=>{const n=s==null?void 0:s.tfields,c=X(r.value,n);g("update:value",r.value),g("confirm",c,r.value)},H=()=>{g("cancel")},Z=n=>{x.value=n,g("update:visible",!1)},F=n=>!!u.value.get(n),w=n=>n[s.tfields.title]||n.title||n.label,T=n=>n[s.tfields.key]||n.value||n.key,J=(n,c)=>{const t=c.node;b.value=t},P=()=>{const n=b.value||{};(typeof r.value=="undefined"||r.value==null)&&(r.value=[]),(r.value?r.value.findIndex(t=>{const a=T(t)===T(n),l=w(t)===w(n);return a&&l}):-1)<0?r.value.map(a=>a.value).includes(n.value)||r.value.push(b.value):ge.getInstance().warning(s.message.double)},Q=()=>{r.value&&r.value.length>0?A.confirm({title:s.message.delete,onOk(){r.value=[]}}):A.warning({title:s.message.none})},W=(n,c)=>{r.value=r.value.filter((t,a)=>a!==c)},M=n=>{const c={};for(const t in n)c[n[t]]=t;return c},X=(n,c)=>{const t=M(c);return n.map(a=>{const l={};for(const e in a)e in t?t[e]=="dept"||t[e]=="postion"?(l[t[e]]=a[e],l[e]=a[e]):t[e]=="id"?(l[t[e]]=parseInt(Math.random()*100)+"@"+a[e],l[e]=a[e]):t[e]=="title"?(l[t[e]]=a[e],l[e]=a[e],l.label=a[e]):t[e]=="key"&&(l[t[e]]=parseInt(Math.random()*100)+"@"+a[e],l[e]=a[e],l.value=a[e]):l[e]=a[e];return l})},$=(n,c,t="top",a)=>{const l=M(c);if(n.map(e=>{const i={};for(const o in e)o in l&&(l[o]=="dept"||l[o]=="postion"?(i[l[o]]=e[o],i[o]=e[o]):l[o]=="title"?(i[l[o]]=e[o],i[o]=e[o],i.label=e[o]):l[o]=="id"?(i[o]=parseInt(Math.random()*100)+"@"+e[o],i[o]=e[o]):l[o]=="key"&&(i[l[o]]=parseInt(Math.random()*100)+"@"+e[o],i[o]=e[o],i.value=e[o])),i[o]=e[o],a&&(i.parent_node=a);u.value.set(e[s.tfields.key],e),I.value.push(i),e.children&&e.children.length>0&&$(e.children,c,"none",e)}),t=="top"){const e=I.value.filter((i,o,S)=>S.findIndex(m=>m[s.tfields.key]===i[s.tfields.key]&&m[s.tfields.title]===i[s.tfields.title])===o);I.value=e}},K=(n,c)=>{const t=M(c);return n.map(a=>{const l={};for(const e in a)e in t?t[e]=="dept"||t[e]=="postion"?(l[t[e]]=a[e],l[e]=a[e]):t[e]=="id"?(l[t[e]]=parseInt(Math.random()*100)+"@"+a[e],l[e]=a[e]):t[e]=="title"?(l[t[e]]=a[e],l[e]=a[e],l.label=a[e]):t[e]=="key"&&(l[t[e]]=parseInt(Math.random()*100)+"@"+a[e],l[e]=a[e],l.value=a[e]):l[e]=a[e];return a.children&&a.children.length>0&&(l.children=K(a.children,c)),l})},Y=(n,c)=>{const t=new Map;return n.forEach(a=>{const l=a[c.key];t.set(l,a)}),t},V=()=>{const n=v.value?v.value.trim():"",c=I.value.filter(t=>{const a=t[s.tfields.title].includes(n);return a&&(t.company=u.value.get(t.orgId)?u.value.get(t.orgId)[s.tfields.title]:"",t.dept=u.value.get(t.parent_node.parentId)?u.value.get(t.parent_node.parentId)[s.tfields.title]:"",t.postion=u.value.get(t.parentId)?u.value.get(t.parentId)[s.tfields.title]:""),a});E.value=c.map(t=>{const{company:a,dept:l,key:e,label:i,orgId:o,parentId:S,parent_node:j,postion:m,title:ae,value:le,orgKindId:ne}=t;return{company:a,dept:l,key:e,label:i,orgId:o,parentId:S,parent_node:j,postion:m,title:ae,value:le,orgKindId:ne}})},ee=(n,c)=>({onclick:a=>{const l=a.currentTarget;l.parentElement.querySelectorAll(".ant-table-row").forEach(i=>{i.classList.remove("selected")}),l.classList.add("selected"),b.value=n}}),te=n=>{n.key==="Enter"&&n.preventDefault()};return N(()=>s.value,n=>{r.value&&n&&r.value.length!=n.length&&(r.value=n)}),N(()=>s.visible,n=>{x.value=n,n?r.value&&s.value&&r.value.length!=s.value.length&&(r.value=[...s.value]):v.value=""},{deep:!0}),N(()=>s.tdata,n=>{const c=s==null?void 0:s.tfields,t=ue(s.tdata);B.value=K(t,c),u.value=Y(t,c),$(t,c,"top",null)}),oe(()=>{x.value=s.visible,r.value=[...s.value]}),(n,c)=>{const t=O("a-input-search"),a=O("a-tree"),l=O("a-table");return f(),_(ye,{title:h.title,visible:x.value,"onUpdate:visible":Z,width:s.width,height:s.height,onCancel:q,onConfirm:G,onClose:H},{default:z(()=>[d("div",{class:"dialog-content",style:C(`height: calc(${s.height}px - 90px)`)},[d("div",ke,[xe,d("div",{class:"category-content",style:C(`height: calc(${s.height}px - 130px)`)},[d("div",be,[Ie,k(t,{value:v.value,"onUpdate:value":c[0]||(c[0]=e=>v.value=e),class:"search-input",placeholder:"请输入搜索内容","enter-button":"",onChange:V,onSearch:V,onKeydown:ce(pe(te,["prevent"]),["enter"])},null,8,["value","onKeydown"]),d("span",we,[k(y,{icon:"mdi:arrow-up",size:"22",class:"rotate-left",onClick:P})]),d("span",me,[k(y,{icon:"material-symbols:delete-outline",class:"icon-delete",size:"22",onClick:Q})])]),d("div",{class:"tree-value",style:C(`height: calc(${s.height}px - 228px);`)},[v.value.length<=0?(f(),_(a,{key:0,"tree-data":B.value,"show-icon":"","default-expand-all":!1,onSelect:J},{switcherIcon:z(({switcherCls:e})=>[k(y,{icon:s.ticons.parent,size:"14",class:ie(e)},null,8,["icon","class"])]),icon:z(({key:e,isLeaf:i})=>[i&&!F(e)?(f(),_(y,{key:0,icon:s.ticons.leaf,size:"14"},null,8,["icon"])):D("",!0),!i&&!F(e)?(f(),_(y,{key:1,icon:s.ticons.middle,size:"14"},null,8,["icon"])):D("",!0)]),_:1},8,["tree-data"])):D("",!0),v.value.length>0?(f(),_(l,{key:1,size:"small",columns:U.value,"data-source":E.value,pagination:!1,scroll:{x:(s.width-30)/2,y:s.height-220},style:{"overflow-x":"hidden"},customRow:ee},null,8,["columns","data-source","scroll"])):D("",!0)],4)],4)]),d("div",Ce,[De,d("div",Me,[d("div",{position:"center",class:"layout-content",style:C(`height: calc(${s.height}px - 140px);`)},[d("div",Se,[(f(!0),L(de,null,re(r.value,(e,i)=>(f(),L("a",{key:i,class:"component-item"},[d("span",{class:"ui-component-text",title:w(e)},ve(w(e)),9,Ne),d("i",Oe,[k(y,{icon:"typcn:delete",size:"18",onClick:o=>W(e,i)},null,8,["onClick"])])]))),128))])],4)])])],4)]),_:1},8,["title","visible","width","height"])}}});const Te=_e(ze,[["__scopeId","data-v-5e1b8a26"]]);export{Te as O};
//# sourceMappingURL=OrganDialog-dd1023ce.js.map
