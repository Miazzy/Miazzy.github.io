var q=Object.defineProperty;var P=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var S=(a,n,t)=>n in a?q(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t,k=(a,n)=>{for(var t in n||(n={}))Y.call(n,t)&&S(a,t,n[t]);if(P)for(var t of P(n))j.call(n,t)&&S(a,t,n[t]);return a};var u=(a,n,t)=>new Promise((o,f)=>{var x=d=>{try{I(t.next(d))}catch(m){f(m)}},v=d=>{try{I(t.throw(d))}catch(m){f(m)}},I=d=>d.done?o(d.value):Promise.resolve(d.value).then(x,v);I((t=t.apply(a,n)).next())});import{P as G}from"./index-20519caf.js";import{a0 as V,a5 as g,aj as $,b as H,au as L,a7 as K,av as b,at as s,ax as C,_ as U}from"./index.js";import{B as X}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as Z}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{s as J,a as Q}from"./stationTree-56a32762.js";import{e as ee}from"./download-03e71dd5.js";import"./index-316f6ffb.js";import{u as te}from"./useRender-21ce56fb.js";import{d as ae,k as T,o as ne,al as re,Z as oe,a9 as ie,aa as c,f as p,u as l,$ as le,E as h,ad as y}from"./vue-71d1abb3.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./CommonTree-c4ed7838.js";import"./index-3801a970.js";function se(a){return g.get({url:"/po/fault-manage/page",params:a})}function de(a){return g.delete({url:"/po/fault-manage/delete?id="+a})}function ue(a){return g.download({url:"/po/fault-manage/export-excel",params:a},{isReturnNativeResponse:!0})}function ce(a){return g.get({url:"/baseset/related-party/get-list?partyTypeCodes=supplier",params:a})}function pe(a){return g.get({url:"/baseset/related-party/get-list?partyTypeCodes=manufacturer",params:a})}function fe(a){return g.post({url:"/po/workorder/generate/fault",params:a})}const me=[{title:"单据编号",dataIndex:"billCode",width:180,sorter:!0,resizable:!0},{title:"工单编号",dataIndex:"workBillCode",width:180,sorter:!0,resizable:!0},{title:"所属公司",dataIndex:"stationOrganName",align:"left",headAlign:"center",width:160,sorter:!0,resizable:!0,ifShow:V().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",align:"left",headAlign:"center",width:160,sorter:!0,resizable:!0},{title:"期数",dataIndex:"periodName",width:160,sorter:!0,resizable:!0},{title:"来源任务",dataIndex:"sourceBillCode",width:200,sorter:!0,resizable:!0,customRender:({text:a,record:n})=>{let t="";switch(n.sourceType){case"technicalSupervision":t=`/po/supervision/create?processInstanceId=${n.sourceParentProcessId}`;break}return te.renderIframeLink(t,a,null,a)}},{title:"发现时间",dataIndex:"findDate",width:160,sorter:!0,resizable:!0},{title:"物料类别",dataIndex:"materialName",align:"left",headAlign:"center",width:160,sorter:!0,resizable:!0},{title:"设备名称",dataIndex:"equipmentName",align:"left",headAlign:"center",width:160,sorter:!0,resizable:!0},{title:"供应商",dataIndex:"supplierName",align:"left",headAlign:"center",width:160,sorter:!0,resizable:!0},{title:"生产厂家",dataIndex:"factoryName",align:"left",headAlign:"center",width:160,sorter:!0,resizable:!0},{title:"缺陷类别",dataIndex:"faultTypeText",width:160,sorter:!0,resizable:!0},{title:"缺陷等级",dataIndex:"faultGradeText",width:160,sorter:!0,resizable:!0},{title:"原因分析",dataIndex:"reason",align:"left",headAlign:"center",width:160,sorter:!0,resizable:!0},{title:"缺陷状态",dataIndex:"validateResultText",width:160,sorter:!0,resizable:!0},{title:"创建人",dataIndex:"personMemberName",width:160,sorter:!0,resizable:!0},{title:"创建时间",dataIndex:"fillinDate",width:160,sorter:!0,resizable:!0}],ge=[{label:"单据编号",field:"billCode",component:"Input",colProps:{span:8}},{label:"物料类别",field:"materialName",component:"Input",colProps:{span:8}},{label:"设备名称",field:"equipmentName",component:"Input",colProps:{span:8}},{label:"供应商",field:"supplierId",component:"ApiSelect",componentProps:{options:[],api:()=>u(void 0,null,function*(){const a=[];return ce({}).then(n=>{n.result.forEach(t=>{a.push({value:t.id,label:t.name})})}),a})},colProps:{span:8}},{label:"生产厂家",field:"factoryId",component:"ApiSelect",componentProps:{options:[],api:()=>u(void 0,null,function*(){const a=[];return pe({}).then(n=>{n.result.forEach(t=>{a.push({value:t.id,label:t.name})})}),a})},colProps:{span:8}},{label:"缺陷类别",field:"faultType",component:"DictSelectBox",componentProps:{type:"fault_type"},colProps:{span:8}},{label:"缺陷等级",field:"faultGrade",component:"DictSelectBox",componentProps:{type:"fault_grade"},colProps:{span:8}},{field:"[startFindDate, endFindDate]",label:"发现时间",component:"RangePicker",colProps:{span:8},componentProps:{format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",placeholder:["开始日期","结束日期"]}},{label:"是否转工单",field:"isConvertWorkBill",component:"DictSelectBox",componentProps:{type:"yes_or_no"},colProps:{span:8}},{label:"缺陷状态",field:"resolutionStatus",component:"DictSelectBox",componentProps:{type:"validate_result"},colProps:{span:8}}],Ie={class:"right-table-layout"},be=ae({__name:"index",setup(a){let{params:n}=$(),t=T("");const o=T({billCode:"",materialId:"",assetName:"",supplierId:"",factoryId:"",faultType:"",faultGrade:"",isConvertWorkBill:n.isConvertWorkBill,startFindDate:n.startFindDate,endFindDate:n.endFindDate,stationOrganId:n.stationOrganId,stationId:n.stationId,resolutionStatus:n.resolutionStatus,status:"",pageNo:1,sortField:"billCode",sortOrder:"desc",pageSize:10}),{t:f}=H(),{createConfirm:x,createMessage:v}=L();function I(r){Q(r,o,null,w)}const[d,{getForm:m,reload:w,getPaginationRef:D,getSelectRows:_}]=Z({title:"缺陷管理",api:()=>u(this,null,function*(){const r=D();return o.value.pageNo=r.current,o.value.pageSize=r.pageSize,(yield se(o.value)).result.page}),columns:me,rowKey:"id",bordered:!0,formConfig:{labelWidth:120,schemas:ge,showAdvancedButton:!0,autoAdvancedLine:1},sortFn:r=>{r.order?(o.value.sortField=r.field.replace("Text",""),o.value.sortOrder=r.order.replace("end","")):(o.value.sortField="billCode",o.value.sortOrder="desc")},useSearchForm:!0,showTableSetting:!0,rowSelection:{type:"radio",fixed:!0,onSelect:O},handleSearchInfoFn(r){for(const e in r)o.value[e]=r[e]}});function O(r,e){e?t.value=r.id:t.value=""}function z({keys:r,rows:e}){if(e&&e.length>0){const i=e[0];t.value=i.id}else t.value=""}function B(){if(!o.value.stationId){s.getInstance().info("请选中电站添加");return}C("/po/fault/create?id=","添加缺陷",{stationId:o.value.stationId,stationName:o.value.stationName,stationOrganId:o.value.stationOrganId,stationOrganName:o.value.stationOrganName})}const F=(r,e,i)=>{C(`/po/fault/create?id=${r.id}&readonly=1`,"查看缺陷")};function M(){let r=_();if(r.length!==1)return s.getInstance().info("请选择一条数据."),!1;let e=r[0];if(e.workBillCode)return s.getInstance().info("已转工单不能修改."),!1;C(`/po/fault/create?id=${e.id}`,e.status!=0||e.sourceId!=""?"查看缺陷":"修改缺陷")}function R(){return u(this,null,function*(){let r=_();if(r.length!==1)return s.getInstance().info("请选择一条数据."),!1;let e=r[0];x({title:"提示",iconType:"warning",content:"确定要删除选中的记录？",onOk(){return u(this,null,function*(){if(e.workBillCode)return s.getInstance().info("已转工单不能修改."),!1;de(e.id).then(N=>{s.getInstance().info("删除成功"),w()})})}})})}function A(){return u(this,null,function*(){x({title:f("common.exportTitle"),iconType:"warning",content:f("common.exportMessage"),onOk(){return u(this,null,function*(){let e=m().getFieldsValue();Object.assign(e,o.value),yield ue(e).then(i=>{ee(i==null?void 0:i.data,"缺陷管理.xls")}),v.success(f("common.exportSuccessText"))})}})})}function E(){return u(this,null,function*(){let r=_();if(r.length!==1){s.getInstance().info("只能选择一条记录。");return}let e=r[0];if(e.workBillCode)return s.getInstance().info("不能重复转工单."),!1;fe({stationOrganId:e.stationOrganId,stationOrganName:e.stationOrganName,stationId:e.stationId,stationName:e.stationName,periodId:e.periodId,periodName:e.periodName,sourceCode:e.billCode,sourceId:e.id,subject:"",fault:{faultType:e.faultType,findById:e.findById,findByName:e.findByName,findDate:e.findDate,equipmentId:e.equipmentId,equipmentName:e.equipmentName,isWarrantyPeriod:e.isWarrantyPeriod,faultGrade:e.faultGrade,checkContent:e.checkContent,reason:e.reason,planMeasure:e.measure}}).then(i=>{i.code==0?(s.getInstance().info("工单生成成功."),w()):s.getInstance().error("工单生成失败.原因:"+i.message)})})}return ne(()=>{m().setFieldsValue(k({},n)),K.getInstance().listen("po-fault-manage",()=>{w()})}),(r,e)=>{const i=re("a-button");return oe(),ie(l(G),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:c(()=>[p(J,{onSelectTree:I,stationId:l(n).stationId,stationOrganId:l(n).stationOrganId},null,8,["stationId","stationOrganId"]),le("div",Ie,[p(l(X),{onRegister:l(d),class:"fix-basic-table",onResizeColumn:e[0]||(e[0]=(N,W)=>W.width=N),onSelectionChange:z,onRowDbClick:F},{toolbar:c(()=>[p(i,{type:"primary",preIcon:l(b).ADD,onClick:B},{default:c(()=>[h(y("添加"))]),_:1},8,["preIcon"]),p(i,{type:"primary",disabled:l(t)=="",preIcon:l(b).EDIT,onClick:M},{default:c(()=>[h(y("修改"))]),_:1},8,["disabled","preIcon"]),p(i,{class:"red-btn",disabled:l(t)=="",preIcon:l(b).DELETE,onClick:R},{default:c(()=>[h(y("删除"))]),_:1},8,["disabled","preIcon"]),p(i,{class:"yellow-btn",preIcon:l(b).EXPORT,onClick:A},{default:c(()=>[h(y("导出"))]),_:1},8,["preIcon"]),p(i,{type:"primary",disabled:l(t)=="",preIcon:l(b).ADD,onClick:E},{default:c(()=>[h(y("转工单"))]),_:1},8,["disabled","preIcon"])]),_:1},8,["onRegister"])])]),_:1})}}});const Le=U(be,[["__scopeId","data-v-273f24b2"]]);export{Le as default};
//# sourceMappingURL=index-0918be26.js.map
