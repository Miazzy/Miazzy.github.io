var U=(d,x,p)=>new Promise((v,m)=>{var w=s=>{try{e(p.next(s))}catch(f){m(f)}},c=s=>{try{e(p.throw(s))}catch(f){m(f)}},e=s=>s.done?v(s.value):Promise.resolve(s.value).then(w,c);e((p=p.apply(d,x)).next())});import{d as L,J as P,k as I,e as D,r as E,o as $,al as o,Z as b,a9 as g,aa as t,f as a,$ as y,_ as A,E as M,ad as S,ac as h,v as J,u as q,A as W,a6 as Z}from"./vue-71d1abb3.js";import{P as G}from"./index-20519caf.js";import{a5 as F,a0 as K,aj as O,aD as Q,at as V,a7 as z,aC as X}from"./index.js";import{T as ee}from"./index-aadc7f51.js";import{_ as B}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{U as ae}from"./UploadBox-636ecf02.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./antd-15ac76ed.js";import"./Dialog-0a006d82.js";function te(d){return F.get({url:"/oa/information/get",params:d})}function le(d){return F.post({url:"/oa/information/create",params:d})}const se={class:"process-box"},ne={class:"header-box"},oe=y("div",{class:"header-left"},"资讯发布",-1),re={key:0,class:"header-right"},ie={class:"content"},ye=L({__name:"create",setup(d){const x=K(),p=P(x.getUserInfo),v=I();let{params:m}=O();const w=D(()=>e.source==2?"":"height:calc(41vh)"),c=I(m.readonly),e=E({id:m.id||"",spinning:!1,personMemberId:"",status:1}),s=D(()=>!1),f=()=>{v.value.validate().then(()=>{e.spinning=!0,le(e).then(r=>{r.result!=""?(e.id=r.result,V.getInstance().success("保存成功"),z.getInstance().sendMsg("oa-information",{})):V.getInstance().error("保存失败."),e.spinning=!1}).catch(r=>{e.spinning=!1,e.status=1,console.log(r)})})},N=()=>{X(),z.getInstance().sendMsg("oa-information",{})};return $(()=>U(this,null,function*(){e.id?te({id:e.id}).then(r=>{let l=r.result;for(let _ in l)e[_]=l[_];e.status=Number(e.status),e.status==0&&e.personMemberId.substring(0,32)!=p.userId}):(e.status=1,e.bizFileId=Q()),c.value==1})),(r,l)=>{const _=o("a-button"),C=o("a-input"),i=o("a-form-item"),u=o("a-col"),R=o("a-date-picker"),T=o("a-textarea"),j=o("a-row"),k=o("a-card"),Y=o("a-form"),H=o("a-spin");return b(),g(q(G),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:t(()=>[a(H,{spinning:e.spinning,tip:"Loading..."},{default:t(()=>[y("div",se,[y("div",ne,[oe,s.value?h("",!0):(b(),A("div",re,[c.value!=1?(b(),g(_,{key:0,type:"default",style:{"margin-right":"10px"},onClick:N},{default:t(()=>[M(S("取消"))]),_:1})):h("",!0),c.value!=1?(b(),g(_,{key:1,type:"primary",onClick:f,loading:e.spinning},{default:t(()=>[M(S("保存"))]),_:1},8,["loading"])):h("",!0)]))]),y("div",ie,[a(Y,{ref_key:"basicRef",ref:v,name:"basic",model:e,autocomplete:"off"},{default:t(()=>[a(k,{title:"基本信息",bordered:!1},{default:t(()=>[a(j,{gutter:32},{default:t(()=>[a(u,{span:24},{default:t(()=>[a(i,{label:"主题",name:"subject",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"主题不能为空"}]},{default:t(()=>[a(C,{value:e.subject,"onUpdate:value":l[0]||(l[0]=n=>e.subject=n),maxlength:"128",disabled:s.value},null,8,["value","disabled"])]),_:1})]),_:1}),a(u,{span:24},{default:t(()=>[a(i,{label:"信息类别",name:"type",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"信息类别不能为空"}]},{default:t(()=>[a(B,{value:e.type,"onUpdate:value":l[1]||(l[1]=n=>e.type=n),type:"information_type",style:"width: 100%",disabled:s.value},null,8,["value","disabled"])]),_:1})]),_:1}),a(u,{span:24},{default:t(()=>[a(i,{label:"信息来源",name:"source",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"信息来源不能为空"}]},{default:t(()=>[a(B,{value:e.source,"onUpdate:value":l[2]||(l[2]=n=>e.source=n),type:"information_source",style:"width: 100%",disabled:s.value},null,8,["value","disabled"])]),_:1})]),_:1}),e.source==1?(b(),g(u,{key:0,span:24},{default:t(()=>[a(i,{label:"URL地址",name:"url",labelCol:{style:{width:"124px"}},rules:[{required:e.source==1,message:"URL地址不能为空"}]},{default:t(()=>[a(C,{value:e.url,"onUpdate:value":l[3]||(l[3]=n=>e.url=n),maxlength:"256",disabled:s.value},null,8,["value","disabled"])]),_:1},8,["rules"])]),_:1})):h("",!0),a(u,{span:24},{default:t(()=>[a(i,{label:"发布人",name:"publisher",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"发布人不能为空"}]},{default:t(()=>[a(C,{value:e.publisher,"onUpdate:value":l[4]||(l[4]=n=>e.publisher=n),maxlength:"32",disabled:s.value},null,8,["value","disabled"])]),_:1})]),_:1}),a(u,{span:24},{default:t(()=>[a(i,{label:"发布日期",name:"publishedDate",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"发布日期不能为空"}]},{default:t(()=>[a(R,{value:e.publishedDate,"onUpdate:value":l[5]||(l[5]=n=>e.publishedDate=n),valueFormat:"YYYY-MM-DD",style:{width:"100%"},disabled:s.value},null,8,["value","disabled"])]),_:1})]),_:1}),a(u,{span:24},{default:t(()=>[a(i,{label:"备注",name:"remark",labelCol:{style:{width:"124px"}},rules:[{required:!1,message:"备注不能为空"}]},{default:t(()=>[a(T,{rows:3,value:e.remark,"onUpdate:value":l[6]||(l[6]=n=>e.remark=n),placeholder:"512字以内",maxlength:512,"show-count":"",disabled:s.value},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),J(a(k,{title:"正文",bordered:!1},{default:t(()=>[a(q(ee),{modelValue:e.content,"onUpdate:modelValue":l[7]||(l[7]=n=>e.content=n),width:"calc(99%)",height:300,maxChars:2e4,disabled:s.value},null,8,["modelValue","width","disabled"])]),_:1},512),[[W,e.source==2]]),a(k,{title:"附件上传",bordered:!1,style:Z(w.value)},{default:t(()=>[a(ae,{width:800,height:550,maxCount:20,maxSize:100*1024*1024,application:"oa",module:"information",vmode:"box",bizId:e.bizFileId},null,8,["bizId"])]),_:1},8,["style"])]),_:1},8,["model"])])])]),_:1},8,["spinning"])]),_:1})}}});export{ye as default};
//# sourceMappingURL=create-32928edb.js.map
