{"version":3,"file":"processDev-937763a6.js","sources":["../../src/views/dev/oaLeave.data.ts","../../src/views/dev/processDev.vue"],"sourcesContent":["import { assign, forEach } from 'min-dash';\nimport type { DescItem } from '@/components/Description';\nimport type { BasicColumn, FormSchema } from '@/components/Table';\nimport { useRender } from '@/components/Table';\nimport { DICT_TYPE, getDictOptions } from '@/utils/dict';\n\nconst oaLeaveTypeOptions = [\n  {\n    dictType: 'bpm_oa_leave_type',\n    value: '1',\n    label: '病假',\n    colorType: 'primary',\n    cssClass: '',\n  },\n  {\n    dictType: 'bpm_oa_leave_type',\n    value: '2',\n    label: '事假',\n    colorType: 'info',\n    cssClass: '',\n  },\n  {\n    dictType: 'bpm_oa_leave_type',\n    value: '3',\n    label: '婚假',\n    colorType: 'warning',\n    cssClass: '',\n  },\n];\n\nconst bpmProcessInstanceResult = [\n  {\n    dictType: 'bpm_process_instance_result',\n    value: '1',\n    label: '处理中',\n    colorType: 'primary',\n    cssClass: '',\n  },\n  {\n    dictType: 'bpm_process_instance_result',\n    value: '2',\n    label: '通过',\n    colorType: 'success',\n    cssClass: '',\n  },\n  {\n    dictType: 'bpm_process_instance_result',\n    value: '3',\n    label: '不通过',\n    colorType: 'danger',\n    cssClass: '',\n  },\n  {\n    dictType: 'bpm_process_instance_result',\n    value: '4',\n    label: '已取消',\n    colorType: 'info',\n    cssClass: '',\n  },\n];\n\nexport const columns: BasicColumn[] = [\n  {\n    title: '申请编号',\n    dataIndex: 'id',\n    width: 100,\n  },\n  {\n    title: '状态',\n    dataIndex: 'result',\n    width: 180,\n    customRender: ({ text }) => {\n      return getInstanceResult(text)['label'];\n      //return useRender.renderDict(text, DICT_TYPE.BPM_PROCESS_INSTANCE_RESULT);\n    },\n  },\n  {\n    title: '开始时间',\n    dataIndex: 'startTime',\n    width: 180,\n    customRender: ({ text }) => {\n      return useRender.renderDate(text);\n    },\n  },\n  {\n    title: '结束时间',\n    dataIndex: 'endTime',\n    width: 180,\n    customRender: ({ text }) => {\n      return useRender.renderDate(text);\n    },\n  },\n  {\n    title: '请假类型',\n    dataIndex: 'type',\n    width: 180,\n    customRender: ({ text }) => {\n      return getTypeObj(text)['label'];\n      //return useRender.renderDict(text, DICT_TYPE.BPM_OA_LEAVE_TYPE);\n    },\n  },\n  {\n    title: '原因',\n    dataIndex: 'reason',\n    width: 180,\n  },\n  {\n    title: '申请时间',\n    dataIndex: 'createTime',\n    width: 180,\n    customRender: ({ text }) => {\n      return useRender.renderDate(text);\n    },\n  },\n];\n\nexport const searchFormSchema: FormSchema[] = [\n  {\n    label: '请假类型',\n    field: 'type',\n    component: 'Select',\n    componentProps: {\n      // options: getDictOptions(DICT_TYPE.BPM_OA_LEAVE_TYPE),\n      options: oaLeaveTypeOptions,\n    },\n    colProps: { span: 8 },\n  },\n  {\n    label: '申请时间',\n    field: 'createTime',\n    component: 'RangePicker',\n    colProps: { span: 8 },\n    componentProps: {\n      showTime: true,\n      format: 'YYYY-MM-DD HH:mm:ss',\n      valueFormat: 'x',\n    },\n  },\n  {\n    label: '结果',\n    field: 'result',\n    component: 'Select',\n    componentProps: {\n      options: bpmProcessInstanceResult,\n      //options: getDictOptions(DICT_TYPE.BPM_PROCESS_INSTANCE_RESULT),\n    },\n    colProps: { span: 8 },\n  },\n  {\n    label: '原因',\n    field: 'reason',\n    component: 'Input',\n    colProps: { span: 8 },\n  },\n];\n\nexport const formSchema: FormSchema[] = [\n  {\n    label: '请假类型',\n    field: 'type',\n    required: true,\n    component: 'Select',\n    componentProps: {\n      // options: getDictOptions(DICT_TYPE.BPM_OA_LEAVE_TYPE),\n      options: oaLeaveTypeOptions,\n    },\n  },\n  {\n    label: '开始时间',\n    field: 'startTime',\n    required: true,\n    component: 'DatePicker',\n    componentProps: {\n      showTime: true,\n      format: 'YYYY-MM-DD HH:mm:ss',\n      valueFormat: 'x',\n    },\n  },\n  {\n    label: '结束时间',\n    field: 'endTime',\n    required: true,\n    component: 'DatePicker',\n    componentProps: {\n      showTime: true,\n      format: 'YYYY-MM-DD HH:mm:ss',\n      valueFormat: 'x',\n    },\n  },\n  {\n    label: '原因',\n    field: 'reason',\n    required: true,\n    component: 'Input',\n  },\n];\n\nexport const descSchema: DescItem[] = [\n  {\n    label: '请假类型',\n    field: 'merchantOrderId',\n    render: (curVal) => {\n      return useRender.renderTag(curVal);\n    },\n  },\n  {\n    label: '开始时间',\n    field: 'startTime',\n    render: (curVal) => {\n      return useRender.renderDate(curVal, 'YYYY-MM-DD');\n    },\n  },\n  {\n    label: '结束时间',\n    field: 'endTime',\n    render: (curVal) => {\n      return useRender.renderDate(curVal, 'YYYY-MM-DD');\n    },\n  },\n  {\n    label: '原因',\n    field: 'reason',\n  },\n];\n\nexport function getInstanceResult(value: any) {\n  const obj = {};\n  forEach(bpmProcessInstanceResult, function (def) {\n    if (def.value === value.toString()) {\n      assign(obj, def);\n    }\n  });\n  return obj;\n}\n\nexport function getTypeObj(type: any) {\n  const obj = {};\n  forEach(oaLeaveTypeOptions, function (def) {\n    if (def.value === type.toString()) {\n      assign(obj, def);\n    }\n  });\n  return obj;\n}\n\nexport function getTypeOption(type: any) {\n  const obj = {};\n  forEach(oaLeaveTypeOptions, function (def) {\n    if (def.label === type.toString()) {\n      assign(obj, def);\n    }\n  });\n  return obj;\n}\n","<template>\n  <div class=\"process-box\">\n    <!-- 标题 -->\n    <BillTitle :options=\"billTitleOptions\" />\n    <!-- 表单内容 -->\n    <div class=\"content\">\n      <div class=\"left-panel\">\n        <a-form :layout=\"formState.layout\" :model=\"formState\" v-bind=\"formItemLayout\">\n          <a-form-item label=\"Form Layout\">\n            <a-radio-group v-model:value=\"formState.layout\">\n              <a-radio-button value=\"horizontal\">Horizontal</a-radio-button>\n              <a-radio-button value=\"vertical\">Vertical</a-radio-button>\n              <a-radio-button value=\"inline\">Inline</a-radio-button>\n            </a-radio-group>\n          </a-form-item>\n          <a-form-item label=\"Field A\">\n            <a-input v-model:value=\"formState.fieldA\" placeholder=\"input placeholder\" />\n          </a-form-item>\n          <a-form-item label=\"Field B\">\n            <a-input v-model:value=\"formState.fieldB\" placeholder=\"input placeholder\" />\n          </a-form-item>\n          <a-form-item label=\"Field C\">\n            <a-input v-model:value=\"formState.fieldC\" placeholder=\"input placeholder\" />\n          </a-form-item>\n          <a-form-item label=\"Field D\">\n            <a-input v-model:value=\"formState.fieldD\" placeholder=\"input placeholder\" />\n          </a-form-item>\n          <a-form-item label=\"Field E\">\n            <a-input v-model:value=\"formState.fieldE\" placeholder=\"input placeholder\" />\n          </a-form-item>\n          <a-form-item label=\"Field F\">\n            <a-input v-model:value=\"formState.fieldF\" placeholder=\"input placeholder\" />\n          </a-form-item>\n          <a-form-item :wrapper-col=\"buttonItemLayout.wrapperCol\" style=\"display: none\">\n            <a-button type=\"primary\">Submit</a-button>\n          </a-form-item>\n        </a-form>\n      </div>\n      <div class=\"right-panel\">\n        <WfApproveBox\n          :data=\"flowData\"\n          @agree=\"handleAgree\"\n          @reject=\"handleReject\"\n          @save=\"handleSave\"\n          @end=\"handleEnd\"\n          @transfer=\"handleTransfer\"\n          @notice=\"handleNotice\"\n          @collect=\"handleCollect\"\n          @submit=\"handleSubmit\"\n        />\n      </div>\n    </div>\n  </div>\n</template>\n<script lang=\"ts\" setup>\n  import { computed, onMounted, reactive, ref, unref, UnwrapRef } from 'vue';\n  import BillTitle from '/@/components/Framework/BillTitle/BillTitle.vue';\n  import { formSchema, getTypeObj, getTypeOption } from './oaLeave.data';\n  import { createOaLeave, getOaLeave, updateOaLeave } from '@/api/hr/oaleave';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { useMessage } from '@/hooks/web/useMessage';\n  import { useRouter } from 'vue-router';\n  import WfApproveBox from '/@/components/Framework/WorkFlow/WfApproveBox.vue';\n\n  defineOptions({ name: 'LeaveCreate' });\n  const { t } = useI18n();\n  const { createMessage } = useMessage();\n  const router = useRouter();\n  const { currentRoute } = router;\n  const route = unref(currentRoute);\n  const query = route.query;\n\n  interface FormState {\n    layout: 'horizontal' | 'vertical' | 'inline';\n    fieldA: string;\n    fieldB: string;\n    fieldC: string;\n    fieldD: string;\n    fieldE: string;\n    fieldF: string;\n  }\n  const formState: UnwrapRef<FormState> = reactive({\n    layout: 'horizontal',\n    fieldA: '',\n    fieldB: '',\n    fieldC: '',\n    fieldD: '',\n    fieldE: '',\n    fieldF: '',\n  });\n  const formItemLayout = computed(() => {\n    const { layout } = formState;\n    return layout === 'horizontal'\n      ? {\n          labelCol: { span: 4 },\n          wrapperCol: { span: 14 },\n        }\n      : {};\n  });\n  const buttonItemLayout = computed(() => {\n    const { layout } = formState;\n    return layout === 'horizontal'\n      ? {\n          wrapperCol: { span: 14, offset: 4 },\n        }\n      : {};\n  });\n  const flowData = ref([]);\n  // 获取流程节点数据\n  async function queryFlowNodeList() {\n    const flowNodeList = JSON.parse(\n      '[{\"id\":\"fa4b117c-5395-11ee-b5c1-480fcf57f666\",\"name\":\"总经理审批\",\"claimTime\":null,\"createTime\":\"2023-09-15 15:03:31\",\"suspensionState\":null,\"processInstance\":{\"id\":\"0e1ab04c-5390-11ee-b5c1-480fcf57f666\",\"name\":\"业务报销\",\"startUserId\":129,\"startUserNickname\":\"宋彪\",\"processDefinitionId\":\"BMProc:1:c38d2a4b-4886-11ee-8c22-480fcf57f666\"},\"endTime\":null,\"durationInMillis\":null,\"result\":1,\"reason\":null,\"definitionKey\":\"Activity_1ge9o3y\",\"assigneeUser\":{\"id\":128,\"nickname\":\"饶勇\",\"deptId\":138,\"deptName\":\"总经办\"}},{\"id\":\"6186a3a5-5395-11ee-b5c1-480fcf57f666\",\"name\":\"财务部负责人审批\",\"claimTime\":null,\"createTime\":\"2023-09-15 14:59:15\",\"suspensionState\":null,\"processInstance\":{\"id\":\"0e1ab04c-5390-11ee-b5c1-480fcf57f666\",\"name\":\"业务报销\",\"startUserId\":129,\"startUserNickname\":\"宋彪\",\"processDefinitionId\":\"BMProc:1:c38d2a4b-4886-11ee-8c22-480fcf57f666\"},\"endTime\":\"2023-09-15 15:03:31\",\"durationInMillis\":256225,\"result\":2,\"reason\":\"同意。\",\"definitionKey\":\"Activity_12fthtb\",\"assigneeUser\":{\"id\":130,\"nickname\":\"曾宁若\",\"deptId\":139,\"deptName\":\"财务部\"}},{\"id\":\"63d8cdd0-5391-11ee-b5c1-480fcf57f666\",\"name\":\"部门领导审批\",\"claimTime\":null,\"createTime\":\"2023-09-15 14:30:41\",\"suspensionState\":null,\"processInstance\":{\"id\":\"0e1ab04c-5390-11ee-b5c1-480fcf57f666\",\"name\":\"业务报销\",\"startUserId\":129,\"startUserNickname\":\"宋彪\",\"processDefinitionId\":\"BMProc:1:c38d2a4b-4886-11ee-8c22-480fcf57f666\"},\"endTime\":\"2023-09-15 14:59:15\",\"durationInMillis\":1714085,\"result\":2,\"reason\":\"同意。\",\"definitionKey\":\"Activity_0zvw3s2\",\"assigneeUser\":{\"id\":126,\"nickname\":\"刘超\",\"deptId\":136,\"deptName\":\"技术中心\"}},{\"id\":\"4b70bf0b-5390-11ee-b5c1-480fcf57f666\",\"name\":\"财务部负责人审批\",\"claimTime\":null,\"createTime\":\"2023-09-15 14:22:50\",\"suspensionState\":null,\"processInstance\":{\"id\":\"0e1ab04c-5390-11ee-b5c1-480fcf57f 666\",\"name\":\"业务报销\",\"startUserId\":129,\"startUserNickname\":\"宋彪\",\"processDefinitionId\":\"BMProc:1:c38d2a4b-4886-11ee-8c22-480fcf57f666\"},\"endTime\":\"2023-09-15 14:30:41\",\"durationInMillis\":470436,\"result\":4,\"reason\":\"Change activity to Activity_0zvw3s2\",\"definitionKey\":\"Activity_12fthtb\",\"assigneeUser\":{\"id\":130,\"nickname\":\"曾宁若\",\"deptId\":139,\"deptName\":\"财务部\"}},{\"id\":\"0e202e9c-5390-11ee-b5c1-480fcf57f666\",\"name\":\"部门领导审批\",\"claimTime\":null,\"createTime\":\"2023-09-15 14:21:07\",\"suspensionState\":null,\"processInstance\":{\"id\":\"0e1ab04c-5390-11ee-b5c1-480fcf57f666\",\"name\":\"业务报销\",\"startUserId\":129,\"startUserNickname\":\"宋彪\",\"processDefinitionId\":\"BMProc:1:c38d2a4b-4886-11ee-8c22-480fcf57f666\"},\"endTime\":\"2023-09-15 14:22:50\",\"durationInMillis\":102859,\"result\":2,\"reason\":\"测试打回。\",\"definitionKey\":\"Activity_0zvw3s2\",\"assigneeUser\":{\"id\":126,\"nickname\":\"刘超\",\"deptId\":136,\"deptName\":\"技术中心\"}}]',\n    );\n    flowData.value = flowNodeList;\n  }\n\n  const billTitleOptions = reactive<any>({});\n  billTitleOptions.title = '请假申请';\n  billTitleOptions.infoItems = [\n    {\n      key: 'billCode',\n      label: '单据编号',\n      value: 'DZSSDL-202308110001',\n      position: 'left',\n    },\n    {\n      key: 'fillinDate',\n      label: '制单日期',\n      value: '2023-08-11 13:38',\n      position: 'center',\n    },\n    {\n      key: 'createPerson',\n      label: '创建人',\n      value: '软件部.管理员',\n      position: 'right',\n    },\n  ];\n\n  async function handleSubmit() {\n    try {\n      // const values = await validate();\n      // const typeObj = getTypeOption(values.type);\n      // values['type'] = typeObj['value'];\n      // if (query.id) {\n      //   values.id = query.id;\n      //   await updateOaLeave(values);\n      // } else {\n      //   await createOaLeave(values);\n      // }\n    } finally {\n      createMessage.success(t('common.saveSuccessText'));\n      router.push('/hr/manage/oaleave');\n    }\n  }\n\n  const getRecordable = async () => {\n    if (query.id) {\n      await getOaLeave(query.id)\n        .then((res) => {\n          const obj: any = {};\n          formSchema.forEach((item) => {\n            obj[item.field] = res.result[item.field];\n          });\n          const typeObj = getTypeObj(obj.type);\n\n          obj['type'] = typeObj['label'];\n          // setFieldsValue(obj);\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    }\n  };\n\n  const handleAgree = (flowData) => {\n    console.log('同意', flowData);\n  };\n\n  const handleReject = (flowData) => {\n    console.log('驳回', flowData);\n  };\n\n  const handleSave = (flowData) => {\n    console.log('保存', flowData);\n  };\n\n  const handleEnd = (flowData) => {\n    console.log('终止', flowData);\n  };\n\n  const handleTransfer = (flowData) => {\n    console.log('转办', flowData);\n  };\n\n  const handleNotice = (flowData) => {\n    console.log('知会', flowData);\n  };\n\n  const handleCollect = (flowData) => {\n    console.log('收藏', flowData);\n  };\n\n  onMounted(async () => {\n    if (query.id) {\n      await getRecordable();\n    } else {\n      // resetFields();\n    }\n    queryFlowNodeList();\n  });\n</script>\n<style lang=\"less\" scoped>\n  .process-box {\n    width: calc(100% - 20px);\n    height: calc(100% - 20px);\n    margin: 10px;\n\n    .content {\n      background: #fefefe;\n      .left-panel {\n        width: 83.5%;\n        float: left;\n        background: #fefefe;\n        border: 1px solid #f0f0f0;\n        margin: 5px 0px;\n        padding: 10px 0px 5px 0px;\n        height: calc(100vh - 200px);\n      }\n      .right-panel {\n        width: 16.25%;\n        float: right;\n        background: #fefefe;\n        border: 1px solid #f0f0f0;\n        margin: 5px 0px;\n        padding: 10px 0px 5px 0px;\n        height: calc(100vh - 200px);\n\n        .button-content {\n          margin: 16px 0 0 16px;\n          .ant-btn {\n            margin: 0px 10px 0px 0px;\n          }\n        }\n      }\n    }\n  }\n</style>\n"],"names":["oaLeaveTypeOptions","formSchema","getTypeObj","type","obj","forEach","def","assign","t","useI18n","createMessage","useMessage","router","useRouter","currentRoute","query","unref","formState","reactive","formItemLayout","computed","layout","buttonItemLayout","flowData","ref","queryFlowNodeList","__async","flowNodeList","billTitleOptions","handleSubmit","getRecordable","getOaLeave","res","item","typeObj","err","handleAgree","handleReject","handleSave","handleEnd","handleTransfer","handleNotice","handleCollect","onMounted"],"mappings":"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"}