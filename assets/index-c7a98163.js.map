{"version":3,"file":"index-c7a98163.js","sources":["../../src/views/po/safety/safechecktemplate/safeCheckTemplate.ts","../../src/views/po/safety/safechecktemplate/index.vue"],"sourcesContent":["import { BasicColumn, FormSchema, useRender } from '@/components/Table';\nimport { defHttp } from '@/utils/http/axios';\n\nenum Api {\n  getSafeCheckTemplatePage = '/po/safe-check-template/page',\n  // deleteTemplateData = '/po/safe-check-template/delete',\n  getTemplateData = '/po/safe-check-template/get',\n  updateStatus = '/po/safe-check-template/updateStatus',\n  exportTemplateData = '/po/safe-check-template/export-excel',\n}\n\n// 查询安全检查模版列表\nexport function getSafeCheckTemplatePage(params) {\n  return defHttp.get({ url: Api.getSafeCheckTemplatePage, params });\n}\nexport function getTemplateData(params) {\n  return defHttp.get({ url: Api.getTemplateData, params });\n}\n// // 删除安全检查模版\n// export function deleteSafeCheckTemplate(id: string) {\n//   return defHttp.delete({ url: Api.deleteTemplateData + '?id=' + id });\n// }\nexport function updateStatus(params) {\n  let para = '';\n  for (const key in params) {\n    para += key + '=' + params[key] + '&';\n  }\n  return defHttp.put({ url: Api.updateStatus + '?' + para });\n}\n\n// 导出安全检查模版 Excel\nexport function exportSafeCheckTemplate(params) {\n  return defHttp.download(\n    { url: Api.exportTemplateData, params },\n    { isReturnNativeResponse: true },\n  );\n}\n\nconst statusColor = {\n  0: '#dc0000', // 草稿\n  1: '#338ed1', // 处理中\n  2: '#30ca5a', // 通过\n  3: '#929292', // 不通过\n  4: '#929292', // 已取消\n  5: '#929292', // 已终止\n  6: '#fda941', // 退回/驳回\n};\n\nexport const columns: BasicColumn[] = [\n  { title: '单据编号', dataIndex: 'billCode', width: 165, sorter: true, resizable: true },\n  { title: '主题', dataIndex: 'subject',align: 'left',headAlign:'center', width: 200, sorter: true, resizable: true },\n  { title: '检查类型', dataIndex: 'checkTypeText', width: 165, sorter: true, resizable: true },\n  { title: '检查频率', dataIndex: 'checkPeriodText', width: 165, sorter: true, resizable: true },\n  {\n    title: '设置日期',\n    dataIndex: 'validDate',\n    width: 165,\n    customRender: ({ text }) => {\n      return useRender.renderDate(text, 'YYYY-MM-DD');\n    },\n    sorter: true,\n    resizable: true,\n  },\n  {\n    title: '审批状态',\n    dataIndex: 'statusText',\n    width: 130,\n    customRender: ({ text, record }) => {\n      return useRender.renderTag(text, statusColor[record.status]);\n    },\n    sorter: true,\n    resizable: true,\n  },\n  { title: '模板状态', dataIndex: 'bizStatusText', width: 130, sorter: true, resizable: true },\n  { title: '创建人', dataIndex: 'personMemberName', width: 130, sorter: true, resizable: true },\n  { title: '创建时间', dataIndex: 'fillinDate', sorter: true, resizable: true },\n];\n\nexport const searchFormSchema: FormSchema[] = [\n  { label: '单据编号', field: 'billCode', component: 'Input', colProps: { span: 8 } },\n  { label: '主题', field: 'subject', component: 'Input', colProps: { span: 8 } },\n  {\n    label: '检查类型',\n    field: 'checkType',\n    component: 'DictSelectBox',\n    componentProps: {\n      type: 'check_type',\n    },\n    colProps: { span: 8 },\n  },\n  {\n    label: '审批状态',\n    field: 'status',\n    component: 'DictSelectBox',\n    componentProps: {\n      type: 'bpm_process_instance_result',\n    },\n    colProps: { span: 8 },\n  },\n];\n","<template>\n  <PageWrapper dense contentFullHeight fixedHeight contentClass=\"flex\"  style=\"position: relative\">\n    <BasicTable @register=\"registerTable\" \n    @resize-column=\"(w, col) => (col.width = w)\" \n    @row-dbClick=\"dbClick\" \n    @selection-change=\"handleSelectChange\">\n      <template #toolbar>\n        <a-button type=\"primary\" :preIcon=\"IconEnum.ADD\" @click=\"handleCreate\">\n          {{ '添加' }}\n        </a-button>\n        <a-button class=\"red-btn\" :disabled=\"selectedRowId == ''\" :preIcon=\"IconEnum.DELETE\" @click=\"handleCancel\">\n          {{ '删除' }}\n        </a-button>\n        <a-button class=\"yellow-btn\" :preIcon=\"IconEnum.EXPORT\" @click=\"handleExport\">\n          {{ '导出' }}\n        </a-button>\n        <a-button class=\"green-btn\" v-auth=\"`po:safechecktemplate:enable`\" :disabled=\"selectedRowId == ''\" :preIcon=\"IconEnum.ENABLE\" @click=\"handleEnable\">启用</a-button>\n        <a-button class=\"grey-btn\" v-auth=\"`po:safechecktemplate:disabled`\" :disabled=\"selectedRowId == ''\" :preIcon=\"IconEnum.DISABLE\" @click=\"handleDisable\">禁用</a-button>\n      </template>\n    </BasicTable>\n  </PageWrapper>\n</template>\n\n<script lang=\"ts\" setup>\n\timport * as CommonUtil from '/@/utils/common';\n  import { PageWrapper } from '/@/components/Page';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { useMessage, SysMessage } from '@/hooks/web/useMessage';\n  import { IconEnum } from '@/enums/appEnum';\n  import { BasicTable, useTable, SorterResult } from '@/components/Table';\n\n  import { ref, onMounted } from 'vue';\n  import { exportExcelFile } from '@/utils/file/download';\n  import { deleteProcessInstance } from '@/api/bpm/processInstance';\n  import { MsgManager } from '/@/message/MsgManager';\n  import {\n    columns,\n    searchFormSchema,\n    getSafeCheckTemplatePage,\n    exportSafeCheckTemplate,\n    updateStatus,\n  } from './safeCheckTemplate';\n  import { addTabPage } from '@/utils/route';\n\n  const queryParam = ref({\n    status: '',\n    checkType: '',\n    subject: '',\n    billCode: '',\n    pageNo: 1,\n    pageSize: 10,\n    sortField: 'fillinDate',\n    sortOrder: 'desc',\n  });\n  let selectedRowId = ref('');\n  defineOptions({ name: 'SafeCheckTemplate' });\n\n  const { t } = useI18n();\n  const { createConfirm, createMessage } = useMessage();\n\n  const [registerTable, { getForm, reload, getSelectRowKeys, getSelectRows, getPaginationRef }] =\n    useTable({\n      title: '安全检查模板',\n      api: async () => {\n        const paginationRef = getPaginationRef() as any;\n        queryParam.value.pageNo = paginationRef.current;\n        queryParam.value.pageSize = paginationRef.pageSize;\n        let dataObj = await getSafeCheckTemplatePage(queryParam.value);\n        return dataObj.result;\n      },\n      columns,\n      rowKey: 'id',\n      bordered: true,\n      formConfig: {\n        labelWidth: 120,\n        schemas: searchFormSchema,\n        showAdvancedButton: true,\n        autoAdvancedLine: 1,\n      },\n      sortFn: (sortInfo: SorterResult) => {\n        if (sortInfo.order) {\n          queryParam.value.sortField = sortInfo.field.replace('Text', '');\n          queryParam.value.sortOrder = sortInfo.order.replace('end', '');\n        } else {\n          queryParam.value.sortField = 'fillinDate';\n          queryParam.value.sortOrder = 'desc';\n        }\n      },\n      useSearchForm: true,\n      showTableSetting: true,\n      rowSelection: {\n        type: 'radio',\n        fixed: true,\n        onSelect: onSelect\n      },\n      handleSearchInfoFn(info) {\n        for (const key in info) {\n          queryParam.value[key] = info[key];\n        }\n      },\n    });\n\n  const dbClick = (record, index, event) => {\n    handleEdit(record);\n  };\n\n  function onSelect(record, selected) {\n    if (selected) {\n      selectedRowId.value = record.id;\n    } else {\n      selectedRowId.value = '';\n    }\n  }\n  function handleSelectChange({ keys, rows }) {\n    if (rows && rows.length > 0) {\n      const record = rows[0];\n      selectedRowId.value = record.id;\n    } else {\n      selectedRowId.value = '';\n    }\n  }\n  function handleCreate() {\n    // router.push(`/po/safety/safechecktemplate/create?id=`);\n    addTabPage(`/po/safety/safechecktemplate/create?id=`, '添加安全检查模板');\n  }\n\n  function handleEdit(record) {\n    // router.push(\n    //   `/po/safety/safechecktemplate/create?id=${record.id}&processInstanceId=${record.processInstanceId}`,\n    // );\n    // let str = '';\n    // if (record.status == 0) {\n    //   str = '修改';\n    // } else if (record.status == 1) {\n    //   str = '审批';\n    // } else {\n    //   str = '查看';\n    // }\n    // addTabPage(\n    //   `/po/safety/safechecktemplate/create?id=${record.id}&processInstanceId=${record.processInstanceId}`,\n    //   str + '安全检查模板',\n    // );\n    CommonUtil.toFlowPage(record.id);\n  }\n  const handleDisable = () => {\n    updateData(0);\n  };\n  const handleEnable = () => {\n    updateData(1);\n  };\n\n  const updateData = (status) => {\n    let keys = getSelectRowKeys();\n    updateStatus({ ids: keys.join(','), status: status }).then((resp) => {\n      if (resp.code == 0) {\n        SysMessage.getInstance().info(status == '1' ? '启用成功' : '禁用成功');\n      } else {\n        SysMessage.getInstance().error(resp.message);\n      }\n      reload();\n    });\n  };\n\n  const handleCancel = async () => {\n    let rows = getSelectRows();\n    if (rows.length != 1) {\n      SysMessage.getInstance().success('请选择一行数据');\n      return;\n    }\n    let record = rows[0];\n\n    createConfirm({\n      title: '提示',\n      iconType: 'warning',\n      content: '确定要删除选中的记录？',\n      async onOk() {\n        if (record.status != 0) {\n          SysMessage.getInstance().success('非草稿状态不能删除');\n          return;\n        }\n\n        await deleteProcessInstance(record.processInstanceId);\n        SysMessage.getInstance().success('删除成功');\n        reload();\n      },\n    });\n  };\n\n  async function handleExport() {\n    createConfirm({\n      title: t('common.exportTitle'),\n      iconType: 'warning',\n      content: t('common.exportMessage'),\n      async onOk() {\n        let exportParams = getForm().getFieldsValue();\n        Object.assign(exportParams, queryParam.value);\n        await exportSafeCheckTemplate(exportParams).then((res) => {\n          exportExcelFile(res?.data, '安全检查模板.xls');\n        });\n        createMessage.success(t('common.exportSuccessText'));\n      },\n    });\n  }\n  onMounted(() => {\n    MsgManager.getInstance().listen('safe-check-template',  ()=>{\n      reload()\n    });\n  });\n</script>\n"],"names":["getSafeCheckTemplatePage","params","defHttp","updateStatus","para","key","exportSafeCheckTemplate","statusColor","columns","text","useRender","record","searchFormSchema","queryParam","ref","selectedRowId","t","useI18n","createConfirm","createMessage","useMessage","registerTable","getForm","reload","getSelectRowKeys","getSelectRows","getPaginationRef","useTable","__async","paginationRef","sortInfo","onSelect","info","dbClick","index","event","handleEdit","selected","handleSelectChange","keys","rows","handleCreate","addTabPage","CommonUtil.toFlowPage","handleDisable","updateData","handleEnable","status","resp","SysMessage","handleCancel","deleteProcessInstance","handleExport","exportParams","res","exportExcelFile","onMounted","MsgManager"],"mappings":"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"}