var b=(e,r,s)=>new Promise((g,t)=>{var n=i=>{try{p(s.next(i))}catch(m){t(m)}},h=i=>{try{p(s.throw(i))}catch(m){t(m)}},p=i=>i.done?g(i.value):Promise.resolve(i.value).then(n,h);p((s=s.apply(e,r)).next())});import{B as S}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as O}from"./useTable-109483b3.js";import{K as I}from"./antd-15ac76ed.js";import{a0 as y,a5 as f,b as C,au as T,aj as _,av as z}from"./index.js";import{e as D}from"./download-03e71dd5.js";import{P as F}from"./index-20519caf.js";import{d as v,r as E,o as P,al as R,Z as Y,a9 as N,aa as x,f as w,u,E as B,ad as k}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";const A=e=>f.post({url:"/bi/safety/export-agreement",params:e,responseType:"blob"},{isReturnNativeResponse:!0}),j=e=>f.get({url:"/bi/safety/agreement",params:e},{isOnlyResult:!0}),H=e=>f.get({url:"/bi/common/org/info",params:e},{isOnlyResult:!0}),V=e=>f.post({url:"/baseset/common/list-station",params:e}),L={labelWidth:120,actionColOptions:{span:24},autoAdvancedLine:1,showAdvancedButton:!0,baseColProps:{span:7},autoSubmitOnEnter:!0,noHideBtnFlag:!0,schemas:[{field:"orgId",label:"所属公司",component:"ApiSelect",componentProps:{options:[],api:H,placeholder:"请选择所属公司"},show:y().isMultiOrganization},{field:"stationId",label:"电站名称",component:"ApiSelect",componentProps:{options:[],api:()=>b(void 0,null,function*(){const e=yield V({}),r=[];return e.result.forEach(s=>{r.push({value:s.powerStationId,label:s.powerStationName})}),r}),placeholder:"请输入电站名称"}}]},M=[{title:"所属公司",dataIndex:"stationOrganName",width:120,customCell:e=>({rowSpan:e.rowOrgSpan}),resizable:!0,ifShow:y().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",width:120,resizable:!0},{title:"在职人数",dataIndex:"total",width:80,resizable:!0},{title:"应签数",dataIndex:"total",width:80,resizable:!0},{title:"已签数",dataIndex:"signTotal",width:80,resizable:!0},{title:"签订率(%)",dataIndex:"rate",width:80,resizable:!0},{title:"未签订",dataIndex:"persionName",width:250,resizable:!0}],gt=v({__name:"index",setup(e){const{t:r}=C(),{createConfirm:s,createMessage:g}=T();let{params:t}=_();t.dateCycle&&(t.startDate.length==7&&(t.startMonth=t.startDate),t.endDate.length==7&&(t.endMonth=t.endDate));const n=E({});function h(){s({title:r("common.message.confirmTitle"),iconType:"warning",content:r("common.message.exportMessage"),onOk(){return b(this,null,function*(){Object.assign(n,m().getFieldsValue()),Object.assign(n,t),n.filename="安全责任书.xls",n.excelList=M,yield A(n).then(a=>{D(a==null?void 0:a.data,n.filename)}),n.filename=null,n.excelList=null,g.success(r("common.exportSuccessText"))})}})}const p=o=>(o.startMonth&&(o.startMonth=I(o.startMonth).format("YYYY-MM")),o.endMonth&&(o.endMonth=I(o.endMonth).format("YYYY-MM")),j(o)),[i,{getForm:m}]=O({title:"安全责任书统计",api:p,columns:M,formConfig:L,useSearchForm:!0,bordered:!0,pagination:!1,showIndexColumn:!0,showTableSetting:!0,tableSetting:{redo:!1,size:!1,setting:!0,fullScreen:!1},afterFetch:function(o){const a={};for(let l=0;l<o.length;l++){const c=o[l];if(a[c.stationOrganId]){a[c.stationOrganId]++;continue}a[c.stationOrganId]=1}for(let l=0;l<o.length;l++){const c=o[l];for(const d in a)c.stationOrganId===d&&(c.rowOrgSpan=a[d],a[d]=0)}return o}});return P(()=>{t.dateCycle&&m().setFieldsValue({dateCycle:t.dateCycle,startMonth:t.startMonth,endMonth:t.endMonth,orgId:t.orgId,stationId:t.stationId})}),(o,a)=>{const l=R("a-button");return Y(),N(u(F),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:x(()=>[w(u(S),{onRegister:u(i),onResizeColumn:a[0]||(a[0]=(c,d)=>d.width=c)},{toolbar:x(()=>[w(l,{class:"yellow-btn",preIcon:u(z).EXPORT,onClick:h},{default:x(()=>[B(k(u(r)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])]),_:1})}}});export{gt as default};
//# sourceMappingURL=index-c8526b64.js.map
