var f=(K,v,b)=>new Promise((A,w)=>{var e=o=>{try{m(b.next(o))}catch(_){w(_)}},k=o=>{try{m(b.throw(o))}catch(_){w(_)}},m=o=>o.done?A(o.value):Promise.resolve(o.value).then(e,k);m((b=b.apply(K,v)).next())});import{B as ie}from"./BasicTable-0434a334.js";import{T as re}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as ue}from"./useTable-109483b3.js";import{bB as de,bC as ce,a2 as x}from"./antd-15ac76ed.js";import{au as me,b as pe,a7 as fe,av as C,ax as ve,az as be,bQ as ge,bR as Ie,aA as ye,a0 as he,_ as we}from"./index.js";import{P as _e}from"./index-20519caf.js";import{C as xe}from"./CommonTree-c4ed7838.js";import"./index-74ac3212.js";import{_ as R}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{g as z,a as Ce,f as l,b as V,e as ke,c as Ne}from"./safetyAccident-b1bf9388.js";import{d as Se,k as r,r as Te,ax as Oe,o as Pe,al as S,Z as I,_ as B,f as s,aa as i,$ as T,a9 as O,ac as P,E as y,F as j,u as d,J as Le}from"./vue-71d1abb3.js";import{j as Fe}from"./Export2Excel-389a8fc9.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";import"./useRender-21ce56fb.js";const Ee={class:"right-table-layout"},De={class:"tab-button-div"},Re={class:"tab-table-div"},Be=Se({__name:"index",setup(K){const v=r(!1),{createConfirm:b,createMessage:A}=me(),{t:w}=pe(),e=Te({name:null,accidentLevel:null,isPowerFailure:null,status:null,billCode:null}),k=r([]);r({});const m=r({}),o=r([]);r([]);const _=z();Oe(),r([{label:"草稿",value:"0"},{label:"处理中",value:"1"},{label:"通过",value:"2"},{label:"不通过",value:"3"},{label:"已取消",value:"4"},{label:"已终止",value:"5"},{label:"退回",value:"6"}]);const L=r([]),$=()=>f(this,null,function*(){let a=yield Ne(e);return L.value=a.result,a.result}),H={baseColProps:{lg:6,md:8},labelWidth:90,schemas:[]};function G(){J(),v.value=!v.value}const[W,{reload:g,getPaginationRef:X,getForm:Ke,redoHeight:J}]=ue({title:"安全事故列表",api:()=>f(this,null,function*(){const a=X();return e.pageNo=a.current,e.pageSize=a.pageSize,yield $()}),columns:_,useSearchForm:!1,formConfig:H,showTableSetting:!0,bordered:!0,rowKey:"id",rowSelection:{type:"radio",onChange:Q},handleSearchInfoFn(a){return e.status=a.status,e.name=a.name,e.accidentLevel=a.accidentLevel,e.isPowerFailure=a.isPowerFailure,a},sortFn:a=>{a.order?(e.sortField=a.field,e.sortOrder=a.order.replace("end","")):(e.sortField=null,e.sortOrder=null)}});let F=r("");function Q(a,n){n.length>0?(o.value=[a[0]],F.value=a[0]):(o.value=[],F.value="")}function Z(){return f(this,null,function*(){const a=yield Ce({});k.value=a.result,g()})}function Y(){if(l.id="",l.name="",l.accidentDate="",l.accidentLevel="",l.isReportGovernment="",l.isInvolveThird="",l.thirdPartyName="",l.isInsuranceClaims="",l.isInsured="",l.casualties="",l.casualtiesTotal="",l.damage="",l.isPowerFailure="",l.blackoutRange="",l.equipment="",l.content="",e.periodId==null){x.error("请先选择电站分期。");return}e.nodeKindId=="station"&&q(),e.nodeKindId=="period"&&q(),ve("/po/safetyAccident/create","添加安全事故快报",Le(l))}function M(a){a.status==0||a.status==1,be(a.id)}const ee=a=>f(this,null,function*(){const n=yield V({id:a.id}),{value:h}=yield ge.prompt("请输入取消原因","取消流程",{confirmButtonText:w("common.okText"),cancelButtonText:w("common.cancelText"),inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"取消原因不能为空"});yield Ie(n.result.processInstanceId,h),x.success("已取消"),g()});function ae(){return f(this,null,function*(){if(!se())return;const a=yield V({id:o.value[0]});b({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return f(this,null,function*(){if(a.result.status!=0){x.error("非草稿状态不能删除。");return}yield ye(a.result.processInstanceId),x.success("已删除。"),o.value=[],g()})}})})}function te(){e.name=null,e.accidentLevel=null,e.isPowerFailure=null,e.status=null,e.billCode=null,g()}function ne(){g()}function q(){m.value.stationId}function le(a={}){e.stationId=null,e.stationName=null,e.periodName=null,e.periodId=null,e.stationOrganId=null,e.stationOrganName=null,e.nodeKindId=null,m.value.nodeKindId=null,e.searchId=null,a!=null&&(e.stationOrganId=a.organId,e.stationOrganName=a.organName,a.nodeKindId=="station"&&(e.stationId=a.powerStationId,e.stationName=a.name,m.value.stationId=a.powerStationId),a.nodeKindId=="period"&&(e.stationId=a.powerStationId,e.stationName=a.orgName,e.periodName=a.powerStationPeriodName,e.periodId=a.powerStationPeriodId,m.value.stationId=a.powerStationId,l.stationId=e.stationId,l.stationName=e.stationName,l.periodName=e.periodName,l.periodId=e.periodId,l.stationOrganId=e.stationOrganId,l.stationOrganName=e.stationOrganName),e.nodeKindId=a.nodeKindId,m.value.nodeKindId=a.nodeKindId,e.searchId=a.id),g()}function se(){return o.value.length==0||o.value.length>1||!o.value[0]?(x.error("请选择一行数据"),!1):!0}function oe(){return f(this,null,function*(){b({title:"导出",iconType:"warning",content:"确定要导出所有记录？",onOk(){return f(this,null,function*(){const n=r({index:"序号"}),h=z(),c=r([]),p=r([]);h.forEach(t=>{t.dataIndex!=="id"&&(t.dataIndex==="stationOrganName"&&he().isMultiOrganization||t.dataIndex!=="stationOrganName")&&(n.value[t.dataIndex]=t.title,p.value.push(t.dataIndex))});let E=yield ke(e);L.value=E.result,L.value.forEach(function(t,N){let u="";switch(t.status){case 0:u="草稿";break;case 1:u="处理中";break;case 2:u="通过";break;case 3:u="不通过";break;case 4:u="已取消";break;case 5:u="已终止";break;case 6:u="退回/驳回";break}let U=r({index:N+1});p.value.forEach(D=>{U.value[D]=D==="status"?u:t[D]}),c.value.push(U.value)}),Fe({data:c.value,header:n.value,filename:"安全事故快报.xlsx"})})}})})}return Pe(()=>{Z(),fe.getInstance().listen("safetyAccident",function(){setTimeout(()=>{g()},500)})}),(a,n)=>{const h=S("a-input"),c=S("a-form-item"),p=S("a-button"),E=S("a-form");return I(),B("div",null,[s(d(_e),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:i(()=>[s(xe,{title:"电站组织",onSelect:le,value:k.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),T("div",Ee,[T("div",De,[s(E,{model:e,name:"searchInfo",layout:"inline",autocomplete:"off",class:"search-form"},{default:i(()=>[s(c,{name:"billCode",label:"单据编号",labelCol:{span:12},rules:[{required:!1,message:"请输入单据编号"}],style:{width:"26.5%"},colon:!1},{default:i(()=>[s(h,{value:e.billCode,"onUpdate:value":n[0]||(n[0]=t=>e.billCode=t),placeholder:"请输入单据编号",style:{width:"100%"}},null,8,["value"])]),_:1}),s(c,{name:"name",label:"主题",labelCol:{span:12},rules:[{required:!1,message:"请输入主题"}],style:{width:"26.5%"},colon:!1},{default:i(()=>[s(h,{value:e.name,"onUpdate:value":n[1]||(n[1]=t=>e.name=t),placeholder:"请输入主题",style:{width:"100%"}},null,8,["value"])]),_:1}),s(c,{name:"accidentLevel",label:"事故评估等级",labelCol:{span:12},rules:[{required:!1,message:"请选择事故评估等级"}],style:{width:"26.5%"},colon:!1},{default:i(()=>[s(R,{type:"safeAccidentLevel",value:e.accidentLevel,"onUpdate:value":n[2]||(n[2]=t=>e.accidentLevel=t),width:"100%"},null,8,["value"])]),_:1}),v.value?(I(),O(c,{key:0,style:{width:"100%",height:"10px"}})):P("",!0),v.value?(I(),O(c,{key:1,name:"isPowerFailure",label:"停电",labelCol:{span:20},rules:[{required:!1,message:"请输入停电"}],style:{width:"26.5%"},colon:!1},{default:i(()=>[s(R,{type:"yes_or_no",value:e.isPowerFailure,"onUpdate:value":n[3]||(n[3]=t=>e.isPowerFailure=t),width:"100%"},null,8,["value"])]),_:1})):P("",!0),v.value?(I(),O(c,{key:2,name:"status",label:"审批状态",labelCol:{span:20},rules:[{required:!1,message:"请选择审批状态"}],style:{width:"26.5%"},colon:!1},{default:i(()=>[s(R,{type:"bpm_process_instance_result",onChange:n[4]||(n[4]=t=>"()=> searchInfo.status = value"),value:e.status,"onUpdate:value":n[5]||(n[5]=t=>e.status=t),width:"100%"},null,8,["value"])]),_:1})):P("",!0),s(c,{class:"search-btns"},{default:i(()=>[s(p,{style:{margin:"0 8px"},onClick:te},{default:i(()=>[y("重置")]),_:1}),s(p,{type:"primary",class:"tab-button",onClick:ne},{default:i(()=>[y("查询")]),_:1}),T("a",{style:{"margin-left":"12px","font-size":"14px"},onClick:G},[v.value?(I(),B(j,{key:0},[y(" 收起 "),s(d(de))],64)):(I(),B(j,{key:1},[y(" 展开 "),s(d(ce))],64))])]),_:1})]),_:1},8,["model"])]),T("div",Re,[s(d(ie),{onRegister:d(W),class:"fix-basic-table",onResizeColumn:n[6]||(n[6]=(t,N)=>N.width=t),onRowDbClick:n[7]||(n[7]=t=>M(t))},{toolbar:i(()=>[s(p,{type:"primary",preIcon:d(C).ADD,onClick:Y},{default:i(()=>[y("添加")]),_:1},8,["preIcon"]),s(p,{class:"red-btn",disabled:d(F)=="",preIcon:d(C).DELETE,onClick:ae},{default:i(()=>[y("删除")]),_:1},8,["disabled","preIcon"]),s(p,{class:"yellow-btn",preIcon:d(C).EXPORT,onClick:oe},{default:i(()=>[y("导出")]),_:1},8,["preIcon"])]),bodyCell:i(({column:t,text:N,record:u})=>[t.key==="action"?(I(),O(d(re),{key:0,actions:[{icon:d(C).LOG,label:"进度",onClick:M.bind(null,u)},{icon:d(C).DELETE,danger:!0,label:"取消",ifShow:()=>u.status==0,onClick:ee.bind(null,u)}]},null,8,["actions"])):P("",!0)]),_:1},8,["onRegister"])])])]),_:1})])}}});const va=we(Be,[["__scopeId","data-v-a8850c48"]]);export{va as default};
//# sourceMappingURL=index-2cfac70a.js.map
