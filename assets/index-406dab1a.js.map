{"version":3,"file":"index-406dab1a.js","sources":["../../src/views/oa/schedule/work/schedule/index.vue"],"sourcesContent":["<template>\n  <PageWrapper dense contentFullHeight fixedHeight contentClass=\"flex\" style=\"position: relative\">\n    <BasicTable\n      class=\"fix-basic-table\"\n      @register=\"registerTable\"\n      @resize-column=\"handleResizeColumn\"\n      @row-db-click=\"(record) => handleView(record)\"\n      @selection-change=\"handleSelectionChange\"\n    >\n      <template #toolbar>\n        <a-button type=\"primary\" :preIcon=\"IconEnum.ADD\" @click=\"handleCreate\">{{\n          t('common.action.create')\n        }}</a-button>\n        <a-button\n          :disabled=\"disabledBtn\"\n          type=\"primary\"\n          :preIcon=\"IconEnum.EDIT\"\n          @click=\"handleUpdate\"\n          >{{ t('common.action.edit') }}</a-button\n        >\n        <a-button\n          :disabled=\"disabledBtn\"\n          class=\"red-btn\"\n          :preIcon=\"IconEnum.DELETE\"\n          @click=\"handleDelete\"\n          >{{ t('common.delText') }}</a-button\n        >\n        <a-button\n          :disabled=\"disabledBtn\"\n          class=\"green-btn\"\n          :preIcon=\"IconEnum.ENABLE\"\n          @click=\"handleEnable\"\n          >{{ '启用' }}</a-button\n        >\n        <a-button\n          :disabled=\"disabledBtn\"\n          class=\"grey-btn\"\n          :preIcon=\"IconEnum.DISABLE\"\n          @click=\"handleDisable\"\n          >{{ '禁用' }}</a-button\n        >\n        <a-button class=\"yellow-btn\" :preIcon=\"IconEnum.EXPORT\" @click=\"handleExport\">{{\n          t('common.action.export')\n        }}</a-button>\n      </template>\n      <template #bodyCell=\"{ column, text }\">\n        <template v-if=\"column.dataIndex === 'status'\">\n          <span style=\"color: #19be6b\" v-if=\"text == 1\">启用</span>\n          <span style=\"color: red\" v-if=\"text == 0\">禁用</span>\n        </template>\n      </template>\n    </BasicTable>\n  </PageWrapper>\n</template>\n<script lang=\"ts\" setup>\n  import { onMounted, reactive, ref, toRaw } from 'vue';\n  import { IconEnum } from '@/enums/appEnum';\n  import { useUserStore } from '/@/store/modules/user';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { useMessage } from '@/hooks/web/useMessage';\n  import { BasicTable, useTable, SorterResult } from '/@/components/Table';\n  import { PageWrapper } from '/@/components/Page';\n  import { exportExcelFile } from '@/utils/file/download';\n  import {\n    exportExcel,\n    getPage,\n    deleteData,\n    columns,\n    searchForm,\n    updateStatus,\n  } from './schedule.data';\n  import { addTabPage } from '@/utils/route';\n  import { MsgManager } from '@/message/MsgManager';\n\n  const { t } = useI18n();\n  const message = useMessage();\n  const searchInfo = reactive<any>({});\n  const disabledBtn = ref<boolean>(true);\n  const userStore = useUserStore();\n  const userInfo = toRaw(userStore.getUserInfo);\n\n  const getParam = (isPage: boolean) => {\n    const form = getForm();\n    const query = { ...form.getFieldsValue(), sortField: 'createTime', sortOrder: 'desc' } as any;\n    if (isPage) {\n      const paginationRef = getPaginationRef() as any;\n      query.pageNo = paginationRef.current;\n      query.pageSize = paginationRef.pageSize;\n    }\n    if (searchInfo.sortField) {\n      query.sortField = searchInfo.sortField;\n      query.sortOrder = searchInfo.sortOrder;\n    }\n    return query;\n  };\n\n  const getListByParam = async () => {\n    return await getPage(getParam(true));\n  };\n\n  const tableTitle = ref<string>('工作安排设置');\n  const [\n    registerTable,\n    { getForm, getSelectRows, getPaginationRef, clearSelectedRowKeys, reload },\n  ] = useTable({\n    title: tableTitle,\n    api: getListByParam,\n    columns: columns,\n    useSearchForm: true,\n    formConfig: searchForm,\n    showTableSetting: true,\n    bordered: true,\n    rowKey: 'id',\n    rowSelection: {\n      type: 'radio',\n    },\n    sortFn: (sortInfo: SorterResult) => {\n      const sortOrder = sortInfo.order?.replace('end', '');\n      searchInfo.sortOrder = sortOrder;\n      searchInfo.sortField = sortOrder ? sortInfo.field : undefined;\n    },\n  });\n\n  function handleResizeColumn(w, col) {\n    col.width = w;\n  }\n\n  function handleCreate() {\n    addTabPage('/oa/schedule/work/schedule/create', getTabPageName({}));\n  }\n\n  function checkSelectData() {\n    const rows = getSelectRows();\n    if (rows.length == 0) {\n      message.error('请选择一行数据');\n      return false;\n    }\n    return rows[0];\n  }\n\n  function handleUpdate() {\n    const record = checkSelectData();\n    if (!record) {\n      return;\n    }\n    addTabPage(`/oa/schedule/work/schedule/create?id=${record.id}`, getTabPageName(record));\n  }\n\n  function handleView(record: any) {\n    addTabPage(\n      `/oa/schedule/work/schedule/create?id=${record.id}&isReadonly=true`,\n      getTabPageName(record, true),\n    );\n  }\n\n  function handleSelectionChange({ rows }) {\n    let creator = '';\n    if (rows.length) {\n      creator = rows[0].creator;\n    }\n    disabledBtn.value = creator !== userInfo.userId;\n  }\n\n  const getTabPageName = (record: any, isView?: boolean) => {\n    const name = tableTitle.value;\n    if (isView) {\n      return `查看${name}`;\n    }\n    if (!record?.id) {\n      return `${t('common.action.create')}${name}`;\n    }\n    return `${t('common.action.edit')}${name}`;\n  };\n\n  function handleDelete() {\n    const record = checkSelectData();\n    if (!record) {\n      return;\n    }\n    deleteConfirm(function () {\n      deleteData(record.id).then(() => {\n        message.success(t('common.delSuccessText'));\n        clearSelectedRowKeys();\n        reload();\n      });\n    });\n  }\n\n  function deleteConfirm(callback: Function) {\n    message.createConfirm({\n      title: t('common.message.confirmTitle'),\n      iconType: 'warning',\n      content: t('common.message.delMessage'),\n      async onOk() {\n        callback();\n      },\n    });\n  }\n\n  function handleEnable() {\n    updateCommonStatus(1, '已启用');\n  }\n\n  function handleDisable() {\n    updateCommonStatus(0, '已禁用');\n  }\n\n  function updateCommonStatus(status, msg) {\n    const record = checkSelectData();\n    if (!record) {\n      return;\n    }\n    updateStatus(record.id, status).then(() => {\n      message.success(msg);\n      reload();\n    });\n  }\n\n  function handleExport() {\n    message.createConfirm({\n      title: t('common.message.confirmTitle'),\n      iconType: 'warning',\n      content: t('common.message.exportMessage'),\n      async onOk() {\n        const query = getParam(false);\n        query.filename = `${tableTitle.value}.xlsx`;\n        query.excelList = columns;\n        await exportExcel(query).then((res) => {\n          exportExcelFile(res?.data, query.filename);\n        });\n        message.success(t('common.exportSuccessText'));\n      },\n    });\n  }\n\n  onMounted(() => {\n    MsgManager.getInstance().listen('work-schedule', reload);\n  });\n</script>\n\n<style lang=\"less\" scoped>\n  .fix-basic-table {\n    width: 100%;\n    padding: 10px;\n\n    :deep(&.vben-basic-table .ant-table-wrapper) {\n      padding: 10px 16px 12px;\n    }\n\n    :deep(.table-settings .anticon-setting) {\n      margin-right: 0;\n    }\n  }\n</style>\n"],"names":["useI18n","message","useMessage","searchInfo","reactive","disabledBtn","ref","userStore","useUserStore","userInfo","toRaw","getParam","isPage","form","getForm","query","__spreadProps","__spreadValues","paginationRef","getPaginationRef","getListByParam","__async","getPage","tableTitle","registerTable","getSelectRows","clearSelectedRowKeys","reload","useTable","columns","searchForm","sortInfo","sortOrder","_a","handleResizeColumn","w","col","handleCreate","addTabPage","getTabPageName","checkSelectData","rows","handleUpdate","record","handleView","handleSelectionChange","creator","isView","name","handleDelete","deleteConfirm","deleteData","callback","handleEnable","updateCommonStatus","handleDisable","status","msg","updateStatus","handleExport","exportExcel","res","exportExcelFile","onMounted","MsgManager"],"mappings":"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"}