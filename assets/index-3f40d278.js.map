{"version":3,"file":"index-3f40d278.js","sources":["../../src/views/po/integrated/assessmentevaluation/report/report.ts","../../src/views/po/integrated/assessmentevaluation/report/index.vue"],"sourcesContent":["import { defHttp } from '/@/utils/http/axios';\nimport dayjs from 'dayjs';\nimport { FormSchema } from '/@/components/Table';\n\nenum Api {\n  dataList = '/po/monthly-evaluation/report',\n  reportExport = '/po/monthly-evaluation/export',\n  getDynamicData = '/po/monthly-evaluation/getReportDynamicColumns',\n}\n\nexport const searchFormSchema: FormSchema[] = [\n  {\n    field: 'year',\n    component: 'YearPicker',\n    label: '考评年度',\n    defaultValue: dayjs(new Date()).format('YYYY'),\n    componentProps: {\n      width: '100%',\n      format: 'YYYY',\n      valueFormat: 'YYYY',\n    },\n    required: true,\n  },\n];\n\n// 列表数据\nexport const getDataList = (params) =>\n  defHttp.get(\n    {\n      url: Api.dataList,\n      params,\n    },\n    { isOnlyResult: true },\n  );\n\n// 列表数据\nexport const getDynamicColumns = (params) =>\n  defHttp.get(\n    {\n      url: Api.dataList,\n      params,\n    },\n    { isOnlyResult: true },\n  );\n\n// 导出报表数据\nexport const getReportExport = (params) =>\n  defHttp.post(\n    {\n      url: Api.reportExport,\n      params,\n      responseType: 'blob',\n    },\n    { isReturnNativeResponse: true },\n  );\n","<template>\n  <PageWrapper dense contentFullHeight fixedHeight contentClass=\"flex\" style=\"position: relative\">\n    <!-- 数据表格 -->\n    <BasicTable @register=\"registerTable\" :searchInfo=\"searchInfo\" class=\"fix-basic-table\">\n      <template #bodyCell=\"{ column, text, record }\">\n        <template\n          v-if=\"\n            column.key != 'stationName' &&\n            column.key != 'orgName' &&\n            column.key != 'yearAvg' &&\n            text != 0\n          \"\n        >\n          <a @click=\"openStationDtl(column.customTitle, column.key, record)\">{{\n            text\n          }}</a></template\n        >\n\n        <template v-if=\"text == 0\"> &nbsp </template>\n      </template>\n      <template #toolbar>\n        <a-button class=\"yellow-btn\" @click=\"exportData\" :preIcon=\"IconEnum.EXPORT\">\n          导出\n        </a-button>\n        <!-- <PrintButton /> -->\n      </template>\n    </BasicTable>\n  </PageWrapper>\n</template>\n<script lang=\"ts\" setup>\n  import { onMounted, ref, unref } from 'vue';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { BasicTable, useTable } from '/@/components/Table';\n  import { useRouter } from 'vue-router';\n  import { PageWrapper } from '/@/components/Page';\n  import { useMessage } from '@/hooks/web/useMessage';\n  import { getDataList, searchFormSchema, getReportExport } from './report.ts';\n  import { addTabPage } from '@/utils/route';\n  import { IconEnum } from '@/enums/appEnum';\n  import PrintButton from '/@/components/Framework/Button/PrintButton.vue';\n  import { exportExcelFile } from '@/utils/file/download';\n  import { useUserStore } from '/@/store/modules/user';\n  import { Memory } from '@/router/index';\n\n  const router = useRouter();\n  const { createConfirm, createMessage } = useMessage();\n  const { t } = useI18n();\n  const detailColumns = ref([]);\n  const loadDataList = async () => {\n    await loadColumns();\n    let param = getForm().getFieldsValue();\n    let dataList = await getDataList(param);\n    return dataList;\n  };\n  const [registerTable, { getForm }] = useTable({\n    title: '得分详情',\n    api: loadDataList,\n    columns: detailColumns,\n    showIndexColumn: false,\n    useSearchForm: true,\n    showTableSetting: false,\n    bordered: true,\n    pagination: false,\n    handleSearchInfoFn(info) {\n      return info;\n    },\n    formConfig: {\n      labelWidth: 120,\n      actionColOptions: { span: 24 },\n      autoAdvancedLine: 1,\n      baseColProps: { span: 7 },\n      schemas: searchFormSchema,\n      autoSubmitOnEnter: true,\n    },\n  });\n\n  // 跳转到电站详情\n  function openStationDtl(evaluationPeriod: any, cloumnKey: string, record: any) {\n    if (record[cloumnKey] > 0) {\n      // router.push(\n      //   `/po/integrated/assessmentevaluation/monthly/stationDtl?evaluationPeriod=${evaluationPeriod}&stationId=${record.stationId}`,\n      // );\n      addTabPage(\n        `/po/integrated/assessmentevaluation/monthly/stationDtl?evaluationPeriod=${evaluationPeriod}&stationId=${record.stationId}`,\n      );\n    }\n  }\n\n  // 加载动态列头\n  const loadColumns = async () => {\n    let columns = [\n      {\n        title: '所属公司',\n        dataIndex: 'orgName',\n        align: 'left',\n        width: 150,\n        ifShow: useUserStore().isMultiOrganization,\n      },\n      {\n        title: '电站名称',\n        dataIndex: 'stationName',\n        align: 'left',\n        width: 150,\n      },\n    ];\n    let formState = getForm().getFieldsValue();\n    if (formState.year != null) {\n      for (let i = 1; i <= 12; i++) {\n        let title = formState.year + '-' + (i > 9 ? i + '' : '0' + i);\n        let dataIndex = formState.year + (i > 9 ? i + '' : '0' + i);\n        let c = { title: title, dataIndex: dataIndex, align: 'center', width: 100 };\n        columns.push(c);\n      }\n      columns.push({\n        title: '年度平均分',\n        dataIndex: 'yearAvg',\n        align: 'center',\n      });\n    }\n    detailColumns.value = columns;\n    return columns;\n  };\n\n  // 导出\n  const exportData = async () => {\n    createConfirm({\n      title: '提示',\n      iconType: 'warning',\n      content: '确定要导出所有记录？',\n      async onOk() {\n        let param = getForm().getFieldsValue();\n        param.excelList = detailColumns.value;\n        await getReportExport(param).then((res) => {\n          exportExcelFile(res?.data, '评价报表.xls');\n        });\n      },\n    });\n  };\n  //-----------------跳转相关--------------------\n  const { currentRoute } = router;\n  const route = unref(currentRoute);\n  const routeParam = Memory.getInstance().getQuery(); // route.query;\n  const dealJumpParam = async () => {\n    let date = new Date(routeParam.startDate + '-01');\n    let paramTemp = getForm().getFieldsValue();\n    paramTemp.year = date.getFullYear() + '';\n    getForm().setFieldsValue(paramTemp);\n  };\n  // 启动执行代码\n  onMounted(async () => {\n    if (routeParam.dateType != null) {\n      dealJumpParam();\n    }\n    loadColumns();\n  });\n</script>\n<style lang=\"less\" scoped>\n  :deep(.ant-picker) {\n    width: 100%;\n  }\n\n  .fix-basic-table {\n    :deep(&.vben-basic-table .ant-table-wrapper) {\n      padding: 10px 16px 12px;\n    }\n\n    :deep(.table-settings .anticon-setting) {\n      margin-right: 0;\n    }\n  }\n</style>\n"],"names":["searchFormSchema","dayjs","getDataList","params","defHttp","getReportExport","router","useRouter","createConfirm","createMessage","useMessage","useI18n","detailColumns","ref","loadDataList","__async","loadColumns","param","getForm","registerTable","useTable","info","openStationDtl","evaluationPeriod","cloumnKey","record","addTabPage","columns","useUserStore","formState","i","title","dataIndex","c","exportData","res","exportExcelFile","currentRoute","unref","routeParam","Memory","dealJumpParam","date","paramTemp","onMounted"],"mappings":"6tCAUO,MAAMA,EAAiC,CAC5C,CACE,MAAO,OACP,UAAW,aACX,MAAO,OACP,aAAcC,EAAM,IAAI,IAAM,EAAE,OAAO,MAAM,EAC7C,eAAgB,CACd,MAAO,OACP,OAAQ,OACR,YAAa,MACf,EACA,SAAU,EACZ,CACF,EAGaC,EAAeC,GAC1BC,EAAQ,IACN,CACE,IAAK,gCACL,OAAAD,CACF,EACA,CAAE,aAAc,EAAK,CACvB,EAaWE,EAAmBF,GAC9BC,EAAQ,KACN,CACE,IAAK,gCACL,OAAAD,EACA,aAAc,MAChB,EACA,CAAE,uBAAwB,EAAK,CACjC,6CCVA,MAAMG,EAASC,IACT,CAAE,cAAAC,EAAe,cAAAC,CAAc,EAAIC,EAAW,EACtCC,EAAQ,EAChB,MAAAC,EAAgBC,EAAI,CAAA,CAAE,EACtBC,EAAe,IAAYC,EAAA,sBAC/B,MAAMC,EAAY,EACd,IAAAC,EAAQC,IAAU,iBAEf,OADQ,MAAMhB,EAAYe,CAAK,CAC/B,GAEH,CAACE,EAAe,CAAE,QAAAD,CAAS,CAAA,EAAIE,EAAS,CAC5C,MAAO,OACP,IAAKN,EACL,QAASF,EACT,gBAAiB,GACjB,cAAe,GACf,iBAAkB,GAClB,SAAU,GACV,WAAY,GACZ,mBAAmBS,EAAM,CAChB,OAAAA,CACT,EACA,WAAY,CACV,WAAY,IACZ,iBAAkB,CAAE,KAAM,EAAG,EAC7B,iBAAkB,EAClB,aAAc,CAAE,KAAM,CAAE,EACxB,QAASrB,EACT,kBAAmB,EACrB,CAAA,CACD,EAGQ,SAAAsB,EAAeC,EAAuBC,EAAmBC,EAAa,CACzEA,EAAOD,CAAS,EAAI,GAItBE,EACE,2EAA2EH,CAAgB,cAAcE,EAAO,SAAS,EAAA,CAG/H,CAGA,MAAMT,EAAc,IAAYD,EAAA,sBAC9B,IAAIY,EAAU,CACZ,CACE,MAAO,OACP,UAAW,UACX,MAAO,OACP,MAAO,IACP,OAAQC,IAAe,mBACzB,EACA,CACE,MAAO,OACP,UAAW,cACX,MAAO,OACP,MAAO,GACT,CAAA,EAEEC,EAAYX,IAAU,iBACtB,GAAAW,EAAU,MAAQ,KAAM,CAC1B,QAASC,EAAI,EAAGA,GAAK,GAAIA,IAAK,CACxB,IAAAC,EAAQF,EAAU,KAAO,KAAOC,EAAI,EAAIA,EAAI,GAAK,IAAMA,GACvDE,EAAYH,EAAU,MAAQC,EAAI,EAAIA,EAAI,GAAK,IAAMA,GACrDG,EAAI,CAAE,MAAAF,EAAc,UAAAC,EAAsB,MAAO,SAAU,MAAO,KACtEL,EAAQ,KAAKM,CAAC,CAChB,CACAN,EAAQ,KAAK,CACX,MAAO,QACP,UAAW,UACX,MAAO,QAAA,CACR,CACH,CACA,OAAAf,EAAc,MAAQe,EACfA,CAAA,GAIHO,EAAa,IAAYnB,EAAA,sBACfP,EAAA,CACZ,MAAO,KACP,SAAU,UACV,QAAS,aACH,MAAO,QAAAO,EAAA,sBACP,IAAAE,EAAQC,IAAU,iBACtBD,EAAM,UAAYL,EAAc,MAChC,MAAMP,EAAgBY,CAAK,EAAE,KAAMkB,GAAQ,CACzBC,EAAAD,GAAA,YAAAA,EAAK,KAAM,UAAU,CAAA,CACtC,CACH,GAAA,CACD,CAAA,GAGG,CAAE,aAAAE,CAAiB,EAAA/B,EACXgC,EAAMD,CAAY,EAChC,MAAME,EAAaC,EAAO,YAAY,EAAE,SAAS,EAC3CC,EAAgB,IAAY1B,EAAA,sBAChC,IAAI2B,EAAO,IAAI,KAAKH,EAAW,UAAY,KAAK,EAC5CI,EAAYzB,IAAU,iBAChByB,EAAA,KAAOD,EAAK,YAAA,EAAgB,GAC9BxB,EAAA,EAAE,eAAeyB,CAAS,CAAA,GAGpC,OAAAC,EAAU,IAAY7B,EAAA,sBAChBwB,EAAW,UAAY,MACXE,IAEJzB,GAAA,EACb"}