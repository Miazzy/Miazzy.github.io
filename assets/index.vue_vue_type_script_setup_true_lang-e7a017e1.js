var g=(_,n,c)=>new Promise((y,k)=>{var D=a=>{try{u(c.next(a))}catch(p){k(p)}},I=a=>{try{u(c.throw(a))}catch(p){k(p)}},u=a=>a.done?y(a.value):Promise.resolve(a.value).then(D,I);u((c=c.apply(_,n)).next())});import{b as B,D as G}from"./dict-c04c0dd8.js";import{T as Y,g as $}from"./taskAssignRuleForm-a40563e3.js";import{a5 as P}from"./index.js";import{g as H}from"./index-6f04a2b9.js";import{g as Z}from"./index-b9390eab.js";import{d as j,aD as z,k as r,r as J,o as Q,al as b,x as h,Z as l,_ as T,f as d,aa as i,v as R,a9 as v,E as O,ad as C,F as q,ae as E,ac as X}from"./vue-71d1abb3.js";const ee=()=>g(void 0,null,function*(){const n={url:"/system/role/list-all-simple",params:{status:1}};return P.get(n,{isOnlyResult:!0})}),te=()=>g(void 0,null,function*(){const n={url:"/system/org/list-all-simple",params:{orgKindId:"dpt"}};return P.get(n,{isOnlyResult:!0})}),se=()=>g(void 0,null,function*(){const n={url:"/system/post/list-all-simple",params:{orgKindId:"pos"}};return P.get(n,{isOnlyResult:!0})}),ue=j({name:"BpmTaskAssignRule",__name:"index",props:{modelId:{type:String,default:""},processDefinitionId:{type:String,default:""}},setup(_){const n=_,{query:c}=z(),y=r(!0),k=r([]),D=J({modelId:c.modelId||n.modelId,processDefinitionId:c.processDefinitionId||n.processDefinitionId}),I=r([]),u=r([]),a=r([]),p=r([]),S=r([]),F=B(G.BPM_TASK_ASSIGN_SCRIPT),A=()=>g(this,null,function*(){y.value=!0;try{k.value=yield $(D)}finally{y.value=!1}}),M=t=>{const s=B(G.BPM_TASK_ASSIGN_RULE_TYPE);for(const e of s)if(e.value===t)return e.label;return""},L=(t,s)=>{if(t===10){for(const e of I.value)if(e.id===s)return e.name}else if(t===20||t===21){for(const e of u.value)if(e.id===s)return e.name}else if(t===22){for(const e of a.value)if(e.id===s)return e.name}else if(t===30||t===31||t===32){for(const e of p.value)if(e.id===s)return e.name}else if(t===40){for(const e of S.value)if(e.id===s)return e.name}else if(t===50){s=s+"";for(const e of F)if(e.value===s)return e.label}return"未知("+s+")"},N=r(),x=(t,s)=>{const e={role:I.value,dept:u.value,post:a.value,user:p.value,userGroup:S.value};let m={id:t.id,taskDefinitionKey:t.taskDefinitionKey,taskDefinitionName:t.taskDefinitionName,processDefinitionId:t.processDefinitionId==null?"":t.processDefinitionId,type:t.type,options:t.options};s=="cc"&&(m.id=t.ccId,m.type=t.ccType,m.options=t.ccOptions),N.value.open(D.modelId,m,e,s)};return Q(()=>g(this,null,function*(){I.value=yield ee(),u.value=yield te(),a.value=yield se(),p.value=yield H(),S.value=yield Z(),yield A()})),(t,s)=>{const e=b("el-table-column"),m=b("el-tag"),w=b("el-button"),U=b("el-table"),V=b("ContentWrap"),K=h("hasPermi"),W=h("loading");return l(),T("div",null,[d(V,null,{default:i(()=>[R((l(),v(U,{data:k.value},{default:i(()=>[d(e,{label:"任务名",align:"center",prop:"taskDefinitionName"}),d(e,{label:"任务标识",align:"center",prop:"taskDefinitionKey"}),d(e,{label:"规则类型",align:"center",prop:"type"},{default:i(o=>[O(C(M(o.row.type)),1)]),_:1}),d(e,{label:"规则范围",align:"center",prop:"options"},{default:i(o=>[(l(!0),T(q,null,E(o.row.options,f=>(l(),v(m,{class:"mr-5px",key:f},{default:i(()=>[O(C(L(o.row.type,f)),1)]),_:2},1024))),128))]),_:1}),d(e,{label:"抄送范围",align:"center",prop:"options"},{default:i(o=>[(l(!0),T(q,null,E(o.row.ccOptions,f=>(l(),v(m,{class:"mr-5px",key:f},{default:i(()=>[O(C(L(o.row.ccType,f)),1)]),_:2},1024))),128))]),_:1}),D.modelId?(l(),v(e,{key:0,label:"操作",align:"center"},{default:i(o=>[R((l(),v(w,{link:"",type:"primary",onClick:f=>x(o.row,"assign")},{default:i(()=>[O(" 修改 ")]),_:2},1032,["onClick"])),[[K,["bpm:task-assign-rule:update"]]]),R((l(),v(w,{link:"",type:"primary",onClick:f=>x(o.row,"cc")},{default:i(()=>[O(" 抄送 ")]),_:2},1032,["onClick"])),[[K,["bpm:task-assign-rule:update"]]])]),_:1})):X("",!0)]),_:1},8,["data"])),[[W,y.value]])]),_:1}),d(Y,{ref_key:"formRef",ref:N,onSuccess:A},null,512)])}}});export{ue as _};
//# sourceMappingURL=index.vue_vue_type_script_setup_true_lang-e7a017e1.js.map
