var p=(K,k,v)=>new Promise((P,_)=>{var a=u=>{try{r(v.next(u))}catch(I){_(I)}},f=u=>{try{r(v.throw(u))}catch(I){_(I)}},r=u=>u.done?P(u.value):Promise.resolve(u.value).then(a,f);r((v=v.apply(K,k)).next())});import{B as U}from"./BasicTable-0434a334.js";import{T as Z}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as Y}from"./useTable-109483b3.js";import{a2 as C}from"./antd-15ac76ed.js";import{au as ee,b as ae,a7 as te,av as S,ax as ne,az as se,bQ as oe,bR as le,aA as ie,a0 as re,_ as ue}from"./index.js";import{P as de}from"./index-20519caf.js";import{C as ce}from"./CommonTree-c4ed7838.js";import"./index-74ac3212.js";import{g as R,a as pe,f as s,b as me,c as F,e as ve,d as fe}from"./plannedElectricity-27bdb078.js";import{d as Ie,r as be,k as o,ax as ge,o as he,al as ye,Z as g,_ as N,f as h,aa as y,$ as _e,u as i,E as B,F as xe,ac as E,a9 as we,J as Ce}from"./vue-71d1abb3.js";import{j as Se}from"./Export2Excel-389a8fc9.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";import"./useRender-21ce56fb.js";const Ne={class:"right-table-layout"},Ee={key:0,style:{color:"#b0b4b2"}},ke={key:1,style:{color:"#19be6b"}},Te={key:2,style:{color:"red"}},Oe=Ie({__name:"plannedElectricity",setup(K){const{createConfirm:k}=ee(),{t:v}=ae(),P=be({}),_=o([]),a=o({}),f=o({}),r=o([]);o([]);const u=R();ge();const I=o([]),M=()=>p(this,null,function*(){let e=yield fe(a.value);return I.value=e.result,e.result});let D=o("");const V={showAdvancedButton:!1,baseColProps:{span:8},labelWidth:120,autoAdvancedLine:1,schemas:[{field:"billCode",component:"Input",label:"单据编号"},{field:"status",label:"审批状态",component:"DictSelectBox",componentProps:{type:"bpm_process_instance_result"}}]},[A,{reload:x,getPaginationRef:j}]=Y({title:"计划电量列表",api:()=>p(this,null,function*(){const e=j();return a.value.pageNo=e.current,a.value.pageSize=e.pageSize,yield M()}),columns:u,useSearchForm:!0,formConfig:V,showTableSetting:!0,bordered:!0,rowKey:"id",rowSelection:{type:"radio",onChange:G},handleSearchInfoFn(e){return a.value.status=e.status,a.value.billCode=e.billCode,e},sortFn:e=>{e.order?(a.value.sortField=e.field,a.value.sortOrder=e.order.replace("end","")):(a.value.sortField=null,a.value.sortOrder=null)}});function G(e,n){n.length>0?(r.value=[e[0]],D.value=e[0]):(r.value=[],D.value="")}function H(){return p(this,null,function*(){const e=yield pe({});_.value=e.result,x()})}function W(){if(s.id="",a.value.periodId==null){C.error("请先选择电站分期。");return}a.value.nodeKindId=="station"&&z(),a.value.nodeKindId=="period"&&z(),me({periodId:s.periodId}).then(e=>{s.connectCapacity=e.result.connectCapacity,s.fullGirdDate=e.result.fullGirdDate,s.bizVersion=e.result.bizVersion,ne("/po/elec/plannedelec/plannedElecCreate","添加计划电量",Ce(s))})}function L(e){e.status==0||e.status==1,se(e.id)}const X=e=>p(this,null,function*(){const n=yield F({id:e.id}),{value:b}=yield oe.prompt("请输入取消原因","取消流程",{confirmButtonText:v("common.okText"),cancelButtonText:v("common.cancelText"),inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"取消原因不能为空"});yield le(n.result.processInstanceId,b),C.success("已取消"),x()});function $(){return p(this,null,function*(){if(r.value.length!=1)return C.info("请选择一条数据."),!1;const e=yield F({id:r.value[0]});k({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return p(this,null,function*(){if(e.result.status!=0){C.error("非草稿状态不能删除。");return}yield ie(e.result.processInstanceId),C.success("已删除。"),r.value=[],x()})}})})}function z(){f.value.stationId}function q(e={}){a.value.stationId=null,a.value.stationName=null,a.value.periodName=null,a.value.periodId=null,a.value.nodeKindId=null,f.value.nodeKindId=null,a.value.searchId=null,a.value.stationOrganId=null,a.value.stationOrganName=null,e!=null&&(a.value.stationOrganId=e.organId,a.value.stationOrganName=e.organName,e.nodeKindId=="station"&&(a.value.stationId=e.powerStationId,a.value.stationName=e.name,f.value.stationId=e.powerStationId),e.nodeKindId=="period"&&(a.value.stationId=e.powerStationId,a.value.stationName=e.orgName,a.value.periodName=e.powerStationPeriodName,a.value.periodId=e.powerStationPeriodId,f.value.stationId=e.powerStationId,s.stationId=a.value.stationId,s.stationName=a.value.stationName,s.periodName=a.value.periodName,s.periodId=a.value.periodId,s.stationOrganId=a.value.stationOrganId,s.stationOrganName=a.value.stationOrganName),a.value.nodeKindId=e.nodeKindId,f.value.nodeKindId=e.nodeKindId,a.value.searchId=e.id),x()}function J(){return p(this,null,function*(){k({title:"导出",iconType:"warning",content:"确定要导出所有记录？",onOk(){return p(this,null,function*(){const n=o({index:"序号"}),b=R(),d=o([]),c=o([]);b.forEach(t=>{t.dataIndex!=="id"&&(t.dataIndex==="stationOrganName"&&re().isMultiOrganization||t.dataIndex!=="stationOrganName")&&(n.value[t.dataIndex]=t.title,c.value.push(t.dataIndex))});let w=yield ve(a.value);I.value=w.result,I.value.forEach(function(t,Q){let m="",T="";switch(t.status){case 0:m="草稿";break;case 1:m="处理中";break;case 2:m="通过";break;case 3:m="不通过";break;case 4:m="已取消";break;case 5:m="已终止";break;case 6:m="退回/驳回";break}switch(t.bizStatus){case 0:T="未生效";break;case 1:T="生效";break;case 2:T="失效";break}let O=o({index:Q+1});c.value.forEach(l=>{l==="status"?O.value[l]=l==="status"?m:t[l]:l==="bizStatus"?O.value[l]=l==="bizStatus"?T:t[l]:O.value[l]=t[l]}),d.value.push(O.value)}),Se({data:d.value,header:n.value,filename:"计划电量.xlsx"})})}})})}return he(()=>{H(),te.getInstance().listen("plannedElectricity",function(){setTimeout(()=>{x()},500)})}),(e,n)=>{const b=ye("a-button");return g(),N("div",null,[h(i(de),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:y(()=>[h(ce,{title:"电站组织",onSelect:q,value:_.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),_e("div",Ne,[h(i(U),{class:"fix-basic-table",onRegister:i(A),searchInfo:P,onResizeColumn:n[0]||(n[0]=(d,c)=>c.width=d),onRowDbClick:n[1]||(n[1]=d=>L(d))},{toolbar:y(()=>[h(b,{type:"primary",preIcon:i(S).ADD,onClick:W},{default:y(()=>[B("添加")]),_:1},8,["preIcon"]),h(b,{class:"red-btn",disabled:i(D)=="",preIcon:i(S).DELETE,onClick:$},{default:y(()=>[B("删除")]),_:1},8,["disabled","preIcon"]),h(b,{class:"yellow-btn",preIcon:i(S).EXPORT,onClick:J},{default:y(()=>[B("导出")]),_:1},8,["preIcon"])]),bodyCell:y(({column:d,text:c,record:w})=>[d.dataIndex==="bizStatus"?(g(),N(xe,{key:0},[c==2?(g(),N("span",Ee,"失效")):E("",!0),c==1?(g(),N("span",ke,"生效")):E("",!0),c==0?(g(),N("span",Te,"未生效")):E("",!0)],64)):E("",!0),d.key==="action"?(g(),we(i(Z),{key:1,actions:[{icon:i(S).LOG,label:"进度",onClick:L.bind(null,w)},{icon:i(S).DELETE,danger:!0,label:"取消",ifShow:()=>w.status==0,onClick:X.bind(null,w)}]},null,8,["actions"])):E("",!0)]),_:1},8,["onRegister","searchInfo"])])]),_:1})])}}});const ra=ue(Oe,[["__scopeId","data-v-56a1c361"]]);export{ra as default};
//# sourceMappingURL=plannedElectricity-f0f41c7d.js.map
