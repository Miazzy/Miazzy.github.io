var ee=Object.defineProperty,se=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var z=(l,t,o)=>t in l?ee(l,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[t]=o,C=(l,t)=>{for(var o in t||(t={}))le.call(t,o)&&z(l,o,t[o]);if(Y)for(var o of Y(t))ae.call(t,o)&&z(l,o,t[o]);return l},A=(l,t)=>se(l,te(t));var v=(l,t,o)=>new Promise((f,y)=>{var _=m=>{try{d(o.next(m))}catch(s){y(s)}},h=m=>{try{d(o.throw(m))}catch(s){y(s)}},d=m=>m.done?f(m.value):Promise.resolve(m.value).then(_,h);d((o=o.apply(l,t)).next())});import{D as oe}from"./Dialog-0a006d82.js";import{b as D,D as O}from"./dict-c04c0dd8.js";import{d as H,h as Z}from"./tree-fc0e156a.js";import{a5 as V,b_ as ue,au as re,_ as pe}from"./index.js";import{d as ie,k as r,r as ne,w as de,o as me,al as b,Z as g,a9 as I,aa as i,f as p,E as $,ac as k,u as w}from"./vue-71d1abb3.js";const Ne=l=>v(void 0,null,function*(){const t={url:"/bpm/task-assign-rule/list",params:l};return V.get(t,{isOnlyResult:!0})}),ce=l=>v(void 0,null,function*(){const t={url:"/bpm/task-assign-rule/create",data:l};return V.post(t,{})}),ve=l=>v(void 0,null,function*(){const t={url:"/bpm/task-assign-rule/update",data:l};return V.put(t,{})}),fe=l=>v(void 0,null,function*(){const t={url:"/bpm/task-cc-rule/create",data:l};return V.post(t,{})}),ye=l=>v(void 0,null,function*(){const t={url:"/bpm/task-cc-rule/update",data:l};return V.put(t,{})}),ge=ie({name:"BpmTaskAssignRuleForm",__name:"taskAssignRuleForm",props:{visible:Boolean,title:String,width:{type:Number,default:750},height:{type:Number,default:500},modelId:{type:String,default:""},row:{type:Object,default:null}},emits:["update:visible","success"],setup(l,{expose:t,emit:o}){const f=l,{t:y}=ue(),_=re(),h=r(null),d=r(!1);r(!1);const m=r(!1),s=r({type:NaN,modelId:"",category:"",options:[],roleIds:[],deptIds:[],postIds:[],userIds:[],userGroupIds:[],scripts:[]}),J=ne({type:[{required:!0,message:"规则类型不能为空",trigger:"change"}],roleIds:[{required:!0,message:"指定角色不能为空",trigger:"change"}],deptIds:[{required:!0,message:"指定部门不能为空",trigger:"change"}],postIds:[{required:!0,message:"指定岗位不能为空",trigger:"change"}],userIds:[{required:!0,message:"指定用户不能为空",trigger:"change"}],userGroupIds:[{required:!0,message:"指定用户组不能为空",trigger:"change"}],scripts:[{required:!0,message:"指定脚本不能为空",trigger:"change"}]}),N=r(),G=r([]),P=r([]),x=r(),q=r([]),U=r(),F=r([]),B=r([]),Q=D(O.BPM_TASK_ASSIGN_SCRIPT),R=r([]),S=r({label:"name",value:"id",options:"options"}),E=(c,e,u,n)=>v(this,null,function*(){n=="cc"?h.value="修改抄送规则":h.value="修改任务规则",d.value=!0,o("update:visible",!0),L(),R.value=D(O.BPM_TASK_ASSIGN_RULE_TYPE),s.value=A(C({},e),{modelId:c,category:n,options:[],roleIds:[],deptIds:[],postIds:[],userIds:[],userGroupIds:[],scripts:[]}),G.value=u.role,P.value=u.dept,x.value=Z(P.value,"id"),q.value=u.post,U.value=Z(q.value,"id"),F.value=u.user,B.value=u.userGroup,e.type===10?s.value.roleIds.push(...e.options):e.type===20||e.type===21?s.value.deptIds.push(...e.options):e.type===22?s.value.postIds.push(...e.options):e.type===30||e.type===31||e.type===32?s.value.userIds.push(...e.options):e.type===40?s.value.userGroupIds.push(...e.options):e.type===50&&s.value.scripts.push(...e.options)}),K=()=>v(this,null,function*(){if(!N.value)return;debugger;if(!(yield N.value.validate()))return;const e=A(C({},s.value),{taskDefinitionName:void 0});e.type===10?e.options=e.roleIds:e.type===20||e.type===21?e.options=e.deptIds:e.type===22?e.options=e.postIds:e.type===30||e.type===31||e.type===32?e.options=e.userIds:e.type===40?e.options=e.userGroupIds:e.type===50&&(e.options=e.scripts),e.roleIds=void 0,e.deptIds=void 0,e.postIds=void 0,e.userIds=void 0,e.userGroupIds=void 0,e.scripts=void 0,m.value=!0;try{const u=e;e.category=="assign"?u.id?(yield ve(u),_.success(y("common.updateSuccess"))):(yield ce(u),_.success(y("common.createSuccess"))):u.id?(yield ye(u),_.success(y("common.updateSuccess"))):(yield fe(u),_.success(y("common.createSuccess"))),o("success")}finally{m.value=!1,d.value=!1}}),L=()=>{var c;(c=N.value)==null||c.resetFields()},W=(c,e)=>e.name.toLowerCase().indexOf(c.toLowerCase())>=0;return de(()=>f.visible,c=>{d.value=c,c==!0&&E(f.modelId,f.row,{})}),me(()=>v(this,null,function*(){d.value=f.visible,R.value=D(O.BPM_TASK_ASSIGN_RULE_TYPE)})),t({open:E,resetForm:L,submitForm:K}),(c,e)=>{const u=b("el-input"),n=b("el-form-item"),T=b("a-select"),M=b("el-tree-select"),X=b("el-form"),j=b("el-button");return g(),I(oe,{title:h.value,visible:d.value,"onUpdate:visible":e[10]||(e[10]=a=>d.value=a),width:f.width,height:f.height},{footer:i(()=>[p(j,{disabled:m.value,type:"primary",onClick:K},{default:i(()=>[$("确 定")]),_:1},8,["disabled"]),p(j,{onClick:e[9]||(e[9]=a=>d.value=!1)},{default:i(()=>[$("取 消")]),_:1})]),default:i(()=>[p(X,{class:"task-assign-rule-form",ref_key:"formRef",ref:N,model:s.value,rules:J,"label-width":"80px"},{default:i(()=>[p(n,{label:"任务名称",prop:"taskDefinitionName"},{default:i(()=>[p(u,{modelValue:s.value.taskDefinitionName,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.taskDefinitionName=a),disabled:"",placeholder:"请输入流标标识"},null,8,["modelValue"])]),_:1}),p(n,{label:"任务标识",prop:"taskDefinitionKey"},{default:i(()=>[p(u,{modelValue:s.value.taskDefinitionKey,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.taskDefinitionKey=a),disabled:"",placeholder:"请输入任务标识"},null,8,["modelValue"])]),_:1}),p(n,{label:"规则类型",prop:"type"},{default:i(()=>[p(T,{value:s.value.type,"onUpdate:value":e[2]||(e[2]=a=>s.value.type=a),options:R.value,allowClear:"",style:{width:"100%"}},null,8,["value","options"])]),_:1}),s.value.type===10?(g(),I(n,{key:0,label:"指定角色",prop:"roleIds"},{default:i(()=>[p(T,{mode:"multiple",value:s.value.roleIds,"onUpdate:value":e[3]||(e[3]=a=>s.value.roleIds=a),options:G.value,allowClear:"",fieldNames:S.value,style:{width:"100%"}},null,8,["value","options","fieldNames"])]),_:1})):k("",!0),s.value.type===20||s.value.type===21?(g(),I(n,{key:1,label:"指定部门",prop:"deptIds",span:"24"},{default:i(()=>[p(M,{ref:"treeRef",modelValue:s.value.deptIds,"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.deptIds=a),data:x.value,props:w(H),"empty-text":"加载中，请稍后",multiple:"","node-key":"id","show-checkbox":"","check-strictly":"","check-on-click-node":""},null,8,["modelValue","data","props"])]),_:1})):k("",!0),s.value.type===22?(g(),I(n,{key:2,label:"指定岗位",prop:"postIds",span:"24"},{default:i(()=>[p(M,{ref:"treeRef",modelValue:s.value.postIds,"onUpdate:modelValue":e[5]||(e[5]=a=>s.value.postIds=a),data:U.value,props:w(H),"empty-text":"加载中，请稍后",multiple:"","node-key":"id","show-checkbox":""},null,8,["modelValue","data","props"])]),_:1})):k("",!0),s.value.type===30||s.value.type===31||s.value.type===32?(g(),I(n,{key:3,label:"指定用户",prop:"userIds",span:"24"},{default:i(()=>[p(T,{value:s.value.userIds,"onUpdate:value":e[6]||(e[6]=a=>s.value.userIds=a),mode:"multiple","show-search":"","allow-clear":"",placeholder:"请选择用户",style:{width:"100%"},fieldNames:S.value,options:F.value,"filter-option":W},null,8,["value","fieldNames","options"])]),_:1})):k("",!0),s.value.type===40?(g(),I(n,{key:4,label:"指定用户组",prop:"userGroupIds"},{default:i(()=>[p(T,{modelValue:s.value.userGroupIds,"onUpdate:modelValue":e[7]||(e[7]=a=>s.value.userGroupIds=a),options:B.value,fieldNames:S.value,mode:"multiple",allowClear:"",style:{width:"100%"}},null,8,["modelValue","options","fieldNames"])]),_:1})):k("",!0),s.value.type===50?(g(),I(n,{key:5,label:"指定脚本",prop:"scripts"},{default:i(()=>[p(T,{modelValue:s.value.scripts,"onUpdate:modelValue":e[8]||(e[8]=a=>s.value.scripts=a),options:w(Q),mode:"multiple",allowClear:"",style:{width:"100%"}},null,8,["modelValue","options"])]),_:1})):k("",!0)]),_:1},8,["model","rules"])]),_:1},8,["title","visible","width","height"])}}});const Ie=pe(ge,[["__scopeId","data-v-c517a2b1"]]),Re=Object.freeze(Object.defineProperty({__proto__:null,default:Ie},Symbol.toStringTag,{value:"Module"}));export{Ie as T,Ne as g,Re as t};
//# sourceMappingURL=taskAssignRuleForm-a40563e3.js.map
