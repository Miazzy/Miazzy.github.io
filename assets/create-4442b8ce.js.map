{"version":3,"file":"create-4442b8ce.js","sources":["../../src/components/Framework/Button/PrintButton.vue","../../src/views/po/integrated/assessmentevaluation/daily/create.vue"],"sourcesContent":["<template>\n  <a-button class=\"print-btn\" @click=\"printPage\">打印</a-button>\n</template>\n<script lang=\"ts\" setup>\n  import printJS from 'print-js';\n\n  const props = defineProps({\n    config: {\n      type: Object,\n      default: {}, // 配置参数参考print-js\n    },\n  });\n\n  // 默认打印配置\n  const defaultConfig = {\n    printable: 'app', // 文档来源：pdf或图像的url，html元素的id或json数据的对象\n    type: 'html', // 可打印类型。可用的打印选项包括：pdf，html，image，json和raw-html。\n    maxWidth: 1100, // 最大文档宽度（像素）。根据需要更改此项。在打印HTML，图像或JSON时使用。\n    scanStyles: false, // 设置为false时，库不会处理应用于正在打印的html的样式。使用css参数时很有用。\n    css: './css/printStyle.css', // 这允许我们传递一个或多个应该应用于正在打印的html的css文件URL。值可以是包含单个URL的字符串，也可以是包含多个URL的数组。\n  };\n  // 打印\n  const printPage = () => {\n    let printJSConfig = {};\n    Object.assign(printJSConfig, defaultConfig, props.config);\n    printJS(printJSConfig);\n  };\n</script>\n","<template>\n  <PageWrapper\n    :detail=\"true\"\n    dense\n    contentFullHeight\n    fixedHeight\n    contentClass=\"fix-detail-page\"\n    style=\"position: relative\"\n  >\n    <div class=\"load\">\n      <div class=\"process-box\">\n        <div class=\"header-box\">\n          <!-- 标题 -->\n          <BillTitle :options=\"billTitleOptions\" />\n          <PrintButton v-if=\"formState.status === 2 ? true : false\" />\n          <WfApproveBox\n            @save=\"onSave\"\n            @submit=\"onSubmit\"\n            :processStatus=\"formState.status\"\n            :processInstanceId=\"formState.processInstanceId\"\n          />\n        </div>\n        <!-- 表单内容 -->\n        <div class=\"content\">\n          <div class=\"left-panel\">\n            <a-form ref=\"dailyFormRef\" :model=\"formState\" name=\"dailyForm\">\n              <a-card title=\"基础信息\" :bordered=\"false\">\n                <a-row>\n                  <a-col v-show=\"true\" :span=\"12\">\n                    <a-form-item\n                      label=\"电站名称\"\n                      name=\"stationName\"\n                      labelAlign=\"right\"\n                      :labelCol=\"{ span: 4 }\"\n                      :rules=\"[{ required: true }]\"\n                    >\n                      <a-input\n                        v-model:value=\"formState.stationName\"\n                        disabled\n                        style=\"width: 100%\"\n                        maxlength=\"128\"\n                      />\n                    </a-form-item>\n                  </a-col>\n                  <a-col v-show=\"true\" :span=\"12\">\n                    <a-form-item\n                      label=\"评价日期\"\n                      name=\"evaluationDate\"\n                      labelAlign=\"right\"\n                      :labelCol=\"{ span: 4 }\"\n                      :rules=\"[{ required: true, message: '请选择日期' }]\"\n                    >\n                      <a-date-picker\n                        v-model:value=\"formState.evaluationDate\"\n                        :disabled=\"iProcess\"\n                        @change=\"changeEvaluationDate\"\n                        style=\"min-width: 100%\"\n                        value-format=\"YYYY-MM-DD\"\n                        picker=\"date\"\n                      />\n                    </a-form-item>\n                  </a-col>\n                  <a-col v-show=\"true\" :span=\"12\">\n                    <a-form-item\n                      label=\"评价指标\"\n                      name=\"evaluationTemplateDtlId\"\n                      labelAlign=\"right\"\n                      :labelCol=\"{ span: 4 }\"\n                      :rules=\"[{ required: true, message: '请选择评价指标' }]\"\n                    >\n                      <a-select\n                        v-model:value=\"formState.evaluationTemplateDtlId\"\n                        allow-clear\n                        style=\"width: 100%\"\n                        placeholder=\"请选择评价指标\"\n                        :options=\"indexOptions\"\n                        @change=\"selectIndex\"\n                        :disabled=\"indexOptions.length == 0 || iProcess\"\n                      />\n                    </a-form-item>\n                  </a-col>\n\n                  <a-col v-show=\"true\" :span=\"12\">\n                    <a-form-item\n                      label=\"评价分数\"\n                      name=\"score\"\n                      labelAlign=\"right\"\n                      :labelCol=\"{ span: 4 }\"\n                      :rules=\"[{ required: true, message: '请输入评价分数' }]\"\n                    >\n                      <a-input-number\n                        v-model:value=\"formState.score\"\n                        :disabled=\"iProcess\"\n                        style=\"min-width: 100%\"\n                      />\n                    </a-form-item>\n                  </a-col>\n                  <a-col v-show=\"true\" :span=\"24\" class=\"textarea-item\">\n                    <a-form-item\n                      label=\"考核目标\"\n                      name=\"assessTarget\"\n                      labelAlign=\"right\"\n                      :labelCol=\"{ span: 2 }\"\n                    >\n                      <a-textarea disabled :rows=\"2\" v-model:value=\"formState.assessTarget\" />\n                    </a-form-item>\n                  </a-col>\n                  <a-col v-show=\"true\" :span=\"24\" class=\"textarea-item\">\n                    <a-form-item\n                      label=\"评分规则描述\"\n                      name=\"scoreRuleDesc\"\n                      labelAlign=\"right\"\n                      :labelCol=\"{ span: 2 }\"\n                    >\n                      <a-textarea disabled :rows=\"3\" v-model:value=\"formState.scoreRuleDesc\" />\n                    </a-form-item>\n                  </a-col>\n                  <a-col v-show=\"true\" :span=\"24\" class=\"textarea-item\">\n                    <a-form-item\n                      label=\"评价说明\"\n                      name=\"evaluationDesc\"\n                      labelAlign=\"right\"\n                      :labelCol=\"{ span: 2 }\"\n                    >\n                      <a-textarea\n                        :rows=\"3\"\n                        v-model:value=\"formState.evaluationDesc\"\n                        :maxlength=\"1000\"\n                        :disabled=\"iProcess\"\n                        show-count\n                      />\n                    </a-form-item>\n                  </a-col>\n                </a-row>\n              </a-card>\n            </a-form>\n            <a-card title=\"日常评价附件\" :bordered=\"false\">\n              <UploadBox\n                :width=\"800\"\n                :height=\"550\"\n                :maxCount=\"20\"\n                :maxSize=\"100 * 1024 * 1024\"\n                :application=\"`po`\"\n                :module=\"`evaluationDaily`\"\n                :vmode=\"formState.status == 0 ? `box` : `view`\"\n                :bizId=\"formState.bizFileId\"\n              />\n            </a-card>\n          </div>\n        </div>\n      </div>\n    </div>\n  </PageWrapper>\n</template>\n<script lang=\"ts\" setup>\n  import { onMounted, reactive, ref, unref, nextTick } from 'vue';\n  import BillTitle from '/@/components/Framework/BillTitle/BillTitle.vue';\n  import { useRouter } from 'vue-router';\n  import { assign } from 'lodash-es';\n  import * as ProcessInstanceApi from '@/api/bpm/processInstance';\n  import Icon from '@/components/Icon/Icon.vue';\n  import { message, FormInstance } from 'ant-design-vue';\n  import WfApproveBox from '/@/components/Framework/WorkFlow/WfApproveBox.vue';\n  import { getTemplateDtl, saveDaily, getDaily } from './daily';\n  import { useTabs } from '/@/hooks/web/useTabs';\n  import { addTabPage } from '@/utils/route';\n  import * as FileApi from '@/api/infra/file';\n  import UploadBox from '@/components/Framework/Combox/UploadBox.vue';\n  import { MsgManager } from '@/message/MsgManager';\n  import { SysMessage } from '/@/hooks/web/useMessage';\n  import { closeCurrentTab } from '@/utils/route';\n  import PrintButton from '/@/components/Framework/Button/PrintButton.vue';\n  import { PageWrapper } from '/@/components/Page';\n  import { Memory } from '@/router/index';\n\n  const router = useRouter();\n  const { currentRoute } = router;\n  const route = unref(currentRoute);\n  const query = Memory.getInstance().getQuery(); // route.query;\n  const processInstanceId = ref(null);\n  const iProcess = ref<boolean>(false);\n  const bizId = ref('');\n  const dailyFormRef = ref<FormInstance>();\n  const formState = reactive({ status: 0 });\n  const indexOptions = ref<SelectProps['indexOptions']>([]); //模板指标\n\n  const indexList = ref([]);\n  const billTitleOptions = reactive<any>({});\n  billTitleOptions.subject = '日常评价';\n  billTitleOptions.infoItems = [];\n\n  //-------------------------------------------------------模板明细相关-------------------------------------------------------------\n  // 选择日期获取模板数据\n  const changeEvaluationDate = async () => {\n    const data = await getTemplateDtl(formState);\n\n    if (data.length > 0) {\n      indexList.value = data;\n      let options = [];\n      data.forEach((element) => {\n        options.push({ label: element.indexName, value: element.id });\n      });\n      indexOptions.value = options;\n      if (formState.evaluationTemplateDtlId) {\n        await selectIndex();\n      }\n    }\n  };\n\n  const selectIndex = async () => {\n    let selectedIndex = indexList.value.find((item) => item.id == formState.evaluationTemplateDtlId);\n    formState.evaluationTemplateId = selectedIndex.evaluationTemplateId;\n    formState.assessTarget = selectedIndex.assessTarget;\n    formState.scoreRuleDesc = selectedIndex.scoreRuleDesc;\n    return formState;\n  };\n  //-------------------------------------------------------流程相关操作-------------------------------------------------------------\n\n  const onSave = () => {\n    doSave(0);\n  };\n\n  const onSubmit = () => {\n    doSave(1);\n  };\n\n  const doSave = (status: number) => {\n    dailyFormRef.value.validateFields().then(() => {\n      formState.status = status;\n      saveDaily(formState)\n        .then((data) => {\n          SysMessage.getInstance().success('保存成功');\n          bizId.value = data.result;\n          loadBizData();\n        })\n        .catch(() => {});\n\n      if (status >= 1) {\n        setTimeout(function () {\n          MsgManager.getInstance().sendMsg('daily-evaluation', {});\n          closeCurrentTab();\n        }, 200);\n      }\n    });\n  };\n  async function loadBizBaseInfo(res: any) {\n    let { billCode, fillinDate, personMemberName, deptName } = res;\n    Object.assign(billTitleOptions, { billCode, fillinDate, personMemberName, deptName });\n  }\n  // 填充流程数和业务数据const getPageByParam = async () =>\n  async function loadBizData() {\n    const res = await getDaily({ id: bizId.value });\n    // 填充业务数据\n    iProcess.value = res.status > 0;\n    loadBizBaseInfo(res);\n    // 加载指标数据\n    await assign(formState, res);\n    if (!formState.processInstanceId) {\n      formState.processInstanceId = query.processInstanceId;\n    }\n    nextTick(async () => {\n      await changeEvaluationDate();\n    });\n  }\n  const getBizFileId = async () => {\n    FileApi.getBizId().then((res) => {\n      formState.bizFileId = res;\n    });\n  };\n\n  onMounted(async () => {\n    assign(formState, query);\n    if (query.id) {\n      bizId.value = query.id;\n      await loadBizData();\n    } else if (query.processInstanceId) {\n      processInstanceId.value = query.processInstanceId as unknown as string;\n      ProcessInstanceApi.getProcessInstance(processInstanceId.value)\n        .then(async (res) => {\n          bizId.value = res.businessKey;\n          loadBizData();\n        })\n        .catch((err) => {\n          console.error(err);\n          alert('getProcessInstance请求失败。error:' + err);\n        });\n    } else if (query.stationId) {\n      const res = await getDaily({ id: '' });\n      loadBizBaseInfo(res);\n      formState.billCode = res.billCode;\n      formState.fillinDate = res.fillinDate;\n      formState.stationName = query.stationName;\n      formState.stationId = query.stationId;\n      // 获取附件id\n      getBizFileId();\n    }\n  });\n</script>\n<style lang=\"less\">\n  .theme1 {\n    .form-subtitle-box {\n      .title-left {\n        color: rgb(255 255 255 / 85%);\n      }\n    }\n  }\n\n  .theme3 {\n    .form-subtitle-box {\n      .title-left {\n        color: rgb(0 0 0 / 85%);\n      }\n    }\n  }\n</style>\n<style lang=\"less\" scoped>\n  .form-subtitle-box {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 6px;\n    padding: 9px 16px 0;\n\n    .title-left {\n      display: flex;\n      align-items: center;\n      font-size: 14px;\n      font-weight: 500;\n      line-height: 28px;\n\n      &::before {\n        content: '';\n        display: inline-block;\n        width: 3px;\n        height: 16px;\n        margin-right: 10px;\n        background-color: #1890ff;\n      }\n    }\n\n    .title-right {\n      :deep(.ant-btn) {\n        height: 28px;\n        margin-right: 10px;\n        padding: 3px 13px;\n        font-size: 12px;\n\n        &:last-child {\n          margin-right: 0;\n        }\n      }\n    }\n  }\n\n  .fix-detail-page {\n    :deep(&.vben-page-wrapper-content.detail-content) {\n      margin: 0;\n    }\n  }\n</style>\n"],"names":["defaultConfig","printPage","printJSConfig","props","printJS","router","useRouter","currentRoute","unref","query","Memory","processInstanceId","ref","iProcess","bizId","dailyFormRef","formState","reactive","indexOptions","indexList","billTitleOptions","changeEvaluationDate","__async","data","getTemplateDtl","options","element","selectIndex","selectedIndex","item","onSave","doSave","onSubmit","status","saveDaily","SysMessage","loadBizData","MsgManager","closeCurrentTab","loadBizBaseInfo","res","billCode","fillinDate","personMemberName","deptName","getDaily","assign","nextTick","getBizFileId","FileApi.getBizId","onMounted","ProcessInstanceApi.getProcessInstance","err"],"mappings":"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"}