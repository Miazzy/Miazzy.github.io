{"version":3,"file":"index-736b6851.js","sources":["../../src/views/po/drone/dronearchive/index.vue"],"sourcesContent":["<template>\n  <PageWrapper dense contentFullHeight fixedHeight contentClass=\"flex\" style=\"position: relative\">\n    <BasicTable\n      @register=\"registerTable\"\n      :searchInfo=\"searchInfo\"\n      @resize-column=\"(w, col) => (col.width = w)\"\n      @row-db-click=\"(record) => handleView(record)\"\n      @selection-change=\"handleSelectionChange\"\n    >\n      <template #toolbar>\n        <a-button type=\"primary\" :preIcon=\"IconEnum.ADD\" @click=\"handleAdd\">{{\n          t('common.action.create')\n        }}</a-button>\n        <!-- v-auth=\"`po:drone:archive:update`\" -->\n        <a-button\n          v-auth=\"`po:drone:dronearchive:update`\"\n          :disabled=\"disabledBtn\"\n          type=\"primary\"\n          :preIcon=\"IconEnum.EDIT\"\n          @click=\"handleEdit\"\n          >{{ t('common.action.edit') }}</a-button\n        >\n        <a-button\n          class=\"grey-btn\"\n          :disabled=\"disabledBtn\"\n          :preIcon=\"IconEnum.DISABLE\"\n          @click=\"scrapHandler\"\n          >报废</a-button\n        >\n        <a-button class=\"yellow-btn\" :preIcon=\"IconEnum.EXPORT\" @click=\"handleExportIndex\">{{\n          t('common.action.export')\n        }}</a-button>\n      </template>\n      <template #bodyCell=\"{ column, text }\">\n        <template v-if=\"column.dataIndex === 'status'\">\n          <span style=\"color: #19be6b\" v-if=\"text == 1\">正常</span>\n          <span style=\"color: red\" v-if=\"text == 0\">报废</span>\n        </template>\n        <template v-if=\"column.dataIndex === 'insuranceStatus'\">\n          <span style=\"color: #337ab7\" v-if=\"text == '在保'\">在保</span>\n          <span style=\"color: #d9534f\" v-if=\"text == '过保'\">过保</span>\n          <span style=\"color: #ec971f\" v-if=\"text == '临保'\">临保</span>\n        </template>\n      </template>\n    </BasicTable>\n  </PageWrapper>\n</template>\n<script lang=\"ts\" setup>\n  import { onMounted, reactive, ref } from 'vue';\n  import { useMessage } from '@/hooks/web/useMessage';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { IconEnum } from '@/enums/appEnum';\n  import { BasicTable, useTable, SorterResult } from '/@/components/Table';\n  import { PageWrapper } from '/@/components/Page';\n  import { exportExcelFile } from '@/utils/file/download';\n  import {\n    getPage,\n    exportExcel,\n    getColumns,\n    searchForm,\n    deleteData,\n    updateStatus,\n    checkMainEdit,\n    checkScrap,\n  } from './drone.data';\n  import { assign } from 'lodash-es';\n  import { addTabPage } from '@/utils/route';\n  import { MsgManager } from '@/message/MsgManager';\n\n  const { t } = useI18n();\n  const message = useMessage();\n  const { createConfirm } = useMessage();\n  const searchInfo = reactive<any>({});\n  const disabledBtn = ref<boolean>(true);\n  const getPageByParam = async () => {\n    const paginationRef = getPaginationRef() as any;\n    const searchPageInfo = reactive<any>({});\n    assign(searchPageInfo, searchInfo);\n    searchPageInfo.pageNo = paginationRef.current;\n    searchPageInfo.pageSize = paginationRef.pageSize;\n    if (!searchPageInfo.sortField) {\n      searchPageInfo.sortField = 'createTime';\n      searchPageInfo.sortOrder = 'desc';\n    }\n    let pageList = await getPage(searchPageInfo);\n    return pageList.result;\n  };\n\n  const tableTitle = ref<string>('无人机档案');\n  const [registerTable, { reload, clearSelectedRowKeys, getPaginationRef, getSelectRows }] =\n    useTable({\n      title: tableTitle,\n      api: getPageByParam,\n      columns: getColumns() as any,\n      useSearchForm: true,\n      formConfig: searchForm,\n      bordered: true,\n      rowKey: 'id',\n      rowSelection: {\n        type: 'radio',\n      },\n      sortFn: (sortInfo: SorterResult) => {\n        const sortOrder = sortInfo.order?.replace('end', '');\n        searchInfo.sortOrder = sortOrder;\n        searchInfo.sortField = sortOrder ? sortInfo.field : undefined;\n      },\n      handleSearchInfoFn(info) {\n        assign(searchInfo, info);\n        return info;\n      },\n      showTableSetting: true,\n      tableSetting: { fullScreen: true },\n      showIndexColumn: true,\n    });\n\n  function handleAdd() {\n    addTabPage('/po/drone/dronearchive/create', getTabPageName({}));\n  }\n\n  function handleEdit() {\n    const id = checkSelectData();\n    if (!id) {\n      return;\n    }\n    checkMainEdit('?id=' + id).then(() => {\n      addTabPage(`/po/drone/dronearchive/create?id=${id}`, getTabPageName({ id: id }));\n    });\n  }\n\n  function scrapHandler() {\n    const id = checkSelectData();\n    if (!id) {\n      return;\n    }\n\n    checkScrap('?id=' + id).then(() => {\n      createConfirm({\n        title: '提示',\n        iconType: 'warning',\n        content: '确实要报废选中数据吗？',\n        async onOk() {\n          const params = '?id=' + id + '&status=0';\n          updateStatus(params).then(() => {\n            message.success('已报废');\n            reload();\n          });\n        },\n      });\n    });\n  }\n\n  function handleView(record: any) {\n    addTabPage(\n      `/po/drone/dronearchive/create?id=${record.id}&isReadonly=true`,\n      getTabPageName(record, true),\n    );\n  }\n\n  const getTabPageName = (record: any, isView?: boolean) => {\n    const name = tableTitle.value;\n    if (isView) {\n      return `查看${name}`;\n    }\n    if (!record?.id) {\n      return `${t('common.action.create')}${name}`;\n    }\n    return `${t('common.action.edit')}${name}`;\n  };\n\n  const handleDelete = async () => {\n    const id = checkSelectData();\n    if (!id) {\n      return;\n    }\n    await message.delConfirm();\n    await deleteData(`?id=${id}`);\n    message.success(t('common.delSuccess'));\n    clearSelectedRowKeys();\n    reload();\n  };\n\n  function checkSelectData() {\n    const rows = getSelectRows();\n    if (rows.length == 0) {\n      message.error('请选择一行数据');\n      return false;\n    }\n    return rows[0].id;\n  }\n\n  function handleExportIndex() {\n    createConfirm({\n      title: t('common.message.confirmTitle'),\n      iconType: 'warning',\n      content: t('common.message.exportMessage'),\n      async onOk() {\n        searchInfo.filename = `${tableTitle.value}.xls`;\n        await exportExcel(searchInfo).then((res) => {\n          exportExcelFile(res?.data, searchInfo.filename);\n        });\n        searchInfo.filename = null;\n        message.success(t('common.exportSuccessText'));\n      },\n    });\n  }\n\n  function handleSelectionChange({ rows }) {\n    disabledBtn.value = rows.length === 0;\n  }\n\n  // 启动执行代码\n  onMounted(() => {\n    MsgManager.getInstance().listen('drone_archive', reload);\n  });\n</script>\n<style lang=\"less\" scoped>\n  .search-form {\n    position: relative;\n\n    .search-btns {\n      position: absolute;\n      right: 0;\n      bottom: 0;\n    }\n  }\n\n  .tab-table-div {\n    margin-top: 10px;\n\n    :deep(.ant-table-placeholder) {\n      height: 591px;\n    }\n  }\n\n  .fix-basic-table {\n    width: 100%;\n    padding: 10px;\n\n    :deep(&.vben-basic-table .ant-table-wrapper) {\n      padding: 10px 16px 12px;\n    }\n\n    :deep(.table-settings .anticon-setting) {\n      margin-right: 0;\n    }\n  }\n</style>\n"],"names":["t","useI18n","message","useMessage","createConfirm","searchInfo","reactive","disabledBtn","ref","getPageByParam","__async","paginationRef","getPaginationRef","searchPageInfo","assign","getPage","tableTitle","registerTable","reload","clearSelectedRowKeys","getSelectRows","useTable","getColumns","searchForm","sortInfo","sortOrder","_a","info","handleAdd","addTabPage","getTabPageName","handleEdit","id","checkSelectData","checkMainEdit","scrapHandler","checkScrap","params","updateStatus","handleView","record","isView","name","rows","handleExportIndex","exportExcel","res","exportExcelFile","handleSelectionChange","onMounted","MsgManager"],"mappings":"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"}