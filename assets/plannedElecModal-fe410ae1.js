var E=(V,e,b)=>new Promise((T,m)=>{var f=r=>{try{g(b.next(r))}catch(I){m(I)}},M=r=>{try{g(b.throw(r))}catch(I){m(I)}},g=r=>r.done?T(r.value):Promise.resolve(r.value).then(f,M);g((b=b.apply(V,e)).next())});import{d as ie,r as A,k as i,ax as ue,u as h,o as de,al as u,Z as B,_ as ce,f as a,aa as n,$ as S,a9 as F,ac as U,v as w,A as C,E as k,ad as pe}from"./vue-71d1abb3.js";import{c as W,h as me,i as $,j as fe,s as _e}from"./plannedElectricity-27bdb078.js";import{W as he}from"./WfApproveBox-a3448232.js";import{a0 as ve,ak as be,bS as ge,aB as Ie,av as ye,a7 as xe,aC as we,_ as Ce}from"./index.js";import{B as De}from"./BillTitle-d17ab3e4.js";import{B as Ee}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as Se}from"./useTable-109483b3.js";import{ai as ke,bA as Te,a2 as R}from"./antd-15ac76ed.js";import"./index-74ac3212.js";import{a as v}from"./assign-37f1c13d.js";import{j}from"./Export2Excel-389a8fc9.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useRender-21ce56fb.js";import"./index.esm-c216ed00.js";import"./index-fda2d66c.js";import"./OrganDialog-dd1023ce.js";import"./Dialog-0a006d82.js";import"./index-c0893416.js";import"./index-33af41d1.js";import"./tree-fc0e156a.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";const Me={class:"load"},Ne={class:"process-box"},Be={class:"header-box"},Ue={class:"content"},Re={class:"tab-table-div"},Ve=ie({__name:"plannedElecModal",setup(V){const e=A({spinning:!1}),T=ve().getUserInfo,m=i(!0),f=A({});f.subject="计划电量",f.infoItems=[];const M=ue(),{currentRoute:g}=M;h(g);const r=be.getInstance().getQuery();i([]);const I=$(),q=i();i([]);const G=i(),z={Authorization:`Bearer ${ge()}`,_t:new Date().getTime(),version:"4.5.4"};let N="/admin-api/po/plannedElectricity/import-excel?_t="+new Date().getTime();const O=()=>{z._t=new Date().getTime(),N=N+"?_t="+new Date().getTime()},[K,{getDataSource:D}]=Se(v({dataSource:G,columns:I},{pagination:!1,striped:!1,useSearchForm:!1,showTableSetting:!1,bordered:!0,showIndexColumn:!0,canResize:!1}));function Q({key:s}){s==="downloadTemplate"&&X()}function X(){j({data:[{}],header:{year:"自然年",plannedElec:"计划电量",month1:"1月",month2:"2月",month3:"3月",month4:"4月",month5:"5月",month6:"6月",month7:"7月",month8:"8月",month9:"9月",month10:"10月",month11:"11月",month12:"12月"},filename:"计划电量内容模板.xlsx"})}const Z=s=>{const t=s.file;if(t.status==="done"&&t.response&&t.response.data){L(t.response.data);return}else t.status==="error"&&R.error("导入数据失败")};function L(s,t){const l=D();l.splice(0,l.length),s.forEach(o=>{const c={year:o.year,plannedElec:o.plannedElec,month1:o.month1,month2:o.month2,month3:o.month3,month4:o.month4,month5:o.month5,month6:o.month6,month7:o.month7,month8:o.month8,month9:o.month9,month10:o.month10,month11:o.month11,month12:o.month12,editable:!1,isNew:!0,key:`${Date.now()}`};l.push(c)})}function P(s){const t=i([]);D().forEach(l=>{const o=i({});v(o.value,l),t.value.push(o.value)}),e.dtlList=t.value,e.spinning=!0;try{s=s||0,q.value.validateFields().then(()=>{e.status=s,_e(e).then(l=>{e.id=l,W({id:l}).then(o=>{v(e,o.result)}),R.success(s==1?"提交成功。":"保存成功"),xe.getInstance().sendMsg("plannedElectricity",{}),s==1&&(m.value=!0,we())})})}catch(l){console.log("error",l)}finally{e.spinning=!1}}function H(){fe({periodId:e.periodId}).then(s=>{if(D().length==0){R.error("请添加计划电量明细。");return}P(1)})}function J(){P(0)}function Y(){const s=i({}),t=i([]);D().forEach(d=>{const _=i({});v(_.value,d),t.value.push(_.value)});const l=$(),o=i([]),c=i([]);l.forEach(d=>{s.value[d.dataIndex]=d.title,c.value.push(d.dataIndex)}),t.value.forEach(function(d,_){let y=i({});c.value.forEach(x=>{y.value[x]=d[x]}),o.value.push(y.value)}),j({data:o.value,header:s.value,filename:"计划电量明细.xlsx"})}de(()=>E(this,null,function*(){r.id=yield ee(),yield W({id:r.id}).then(t=>{r.id?(v(e,t.result),e.status==0&&e.personMemberId.substring(0,32)!=T.userId&&(e.status=10)):(v(e,r),e.spinning=!1,e.status=0,e.billCode=t.result.billCode,e.personMemberName=t.result.personMemberName,e.fillinDate=t.result.fillinDate,e.deptName=t.result.deptName),e.status>0,e.status==1&&(m.value=!0)});let s=yield me(r.id);L(s.result),r.id||(m.value=!1),yield te()}));const ee=()=>E(this,null,function*(){let s=r.id;if(!s&&r.processInstanceId){const l=(yield Ie(r.processInstanceId)).businessKey;r.id=l,s=l}return s}),te=()=>E(this,null,function*(){m.value=e.status!=0,f.title="计划电量",e.processInstanceId=r.processInstanceId;let{billCode:s,fillinDate:t,personMemberName:l,deptName:o}=e;v(f,{billCode:s,fillinDate:t,personMemberName:l,deptName:o})});return(s,t)=>{const l=u("a-input"),o=u("a-form-item"),c=u("a-col"),d=u("a-row"),_=u("a-input-number"),y=u("a-card"),x=u("a-menu-item"),ae=u("a-upload"),oe=u("a-menu"),ne=u("a-button"),se=u("a-dropdown"),le=u("a-form"),re=u("a-spin");return B(),ce("div",Me,[a(re,{spinning:e.spinning,tip:"Loading..."},{default:n(()=>[S("div",Ne,[S("div",Be,[a(De,{options:f},null,8,["options"]),e.status!=10?(B(),F(he,{key:0,onSave:J,onSubmit:H,processInstanceId:e.processInstanceId,processStatus:e.status},null,8,["processInstanceId","processStatus"])):U("",!0)]),S("div",Ue,[a(le,{ref_key:"formRef",ref:q,model:e,labelAlign:"right",autocomplete:"off"},{default:n(()=>[a(y,{title:"基本信息",bordered:!1},{default:n(()=>[a(d,{gutter:24},{default:n(()=>[w(a(c,{span:12},{default:n(()=>[a(o,{name:"stationName",label:"电站名称",labelCol:{span:6},rules:[{required:!0,message:"请输入电站名称"}]},{default:n(()=>[a(l,{disabled:"",value:e.stationName,"onUpdate:value":t[0]||(t[0]=p=>e.stationName=p),placeholder:"请输入电站名称"},null,8,["value"]),U("",!0)]),_:1})]),_:1},512),[[C,!0]]),w(a(c,{span:12},{default:n(()=>[a(o,{name:"periodName",label:"期数",labelCol:{span:6},rules:[{required:!0,message:"请输入期数"}]},{default:n(()=>[a(l,{disabled:"",value:e.periodName,"onUpdate:value":t[2]||(t[2]=p=>e.periodName=p),placeholder:"请输入期数"},null,8,["value"])]),_:1})]),_:1},512),[[C,!0]])]),_:1}),a(d,{gutter:24},{default:n(()=>[w(a(c,{span:12},{default:n(()=>[a(o,{name:"connectCapacity",label:"并网容量(MW)",labelCol:{span:6},rules:[{required:!1,message:"请输入并网容量(MW)"}]},{default:n(()=>[a(_,{disabled:"",value:e.connectCapacity,"onUpdate:value":t[3]||(t[3]=p=>e.connectCapacity=p),placeholder:"请输入并网容量(MW)"},null,8,["value"])]),_:1})]),_:1},512),[[C,!0]]),w(a(c,{span:12},{default:n(()=>[a(o,{name:"fullGirdDate",label:"全容量并网时间",labelCol:{span:6},rules:[{required:!1,message:"请输入全容量并网时间"}]},{default:n(()=>[a(_,{disabled:"",value:e.fullGirdDate,"onUpdate:value":t[4]||(t[4]=p=>e.fullGirdDate=p),placeholder:"请输入全容量并网时间"},null,8,["value"])]),_:1})]),_:1},512),[[C,!0]])]),_:1}),a(d,{gutter:24},{default:n(()=>[w(a(c,{span:12},{default:n(()=>[a(o,{name:"bizVersion",label:"版本",labelCol:{span:6},rules:[{required:!1,message:"请输入版本"}]},{default:n(()=>[a(_,{disabled:"",value:e.bizVersion,"onUpdate:value":t[5]||(t[5]=p=>e.bizVersion=p),placeholder:"请输入版本"},null,8,["value"])]),_:1})]),_:1},512),[[C,!0]])]),_:1})]),_:1}),a(y,{title:"",bordered:!1},{default:n(()=>[S("div",Re,[a(h(Ee),{onRegister:h(K)},{toolbar:n(()=>[e.status==0?(B(),F(se,{key:0},{overlay:n(()=>[a(oe,{onClick:Q},{default:n(()=>[a(x,{key:"downloadTemplate"},{default:n(()=>[k("下载模板")]),_:1}),a(x,{key:"import"},{default:n(()=>[a(ae,{name:"file",showUploadList:!1,headers:z,accept:".xls,.xlsx",onChange:Z,beforeUpload:O,action:h(N)},{default:n(()=>[k(pe("导入数据"))]),_:1},8,["action"])]),_:1})]),_:1})]),default:n(()=>[a(ne,{type:"primary",preIcon:h(ye).IMPORT},{default:n(()=>[k(" 导入 ")]),_:1},8,["preIcon"])]),_:1})):U("",!0),a(h(ke),{onClick:Y},{icon:n(()=>[a(h(Te))]),default:n(()=>[k("导出")]),_:1})]),_:1},8,["onRegister"])])]),_:1})]),_:1},8,["model"])])])]),_:1},8,["spinning"])])}}});const vt=Ce(Ve,[["__scopeId","data-v-28160228"]]);export{vt as default};
//# sourceMappingURL=plannedElecModal-fe410ae1.js.map
