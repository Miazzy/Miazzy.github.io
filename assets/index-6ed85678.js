var u=(s,c,d)=>new Promise((p,r)=>{var a=n=>{try{i(d.next(n))}catch(m){r(m)}},x=n=>{try{i(d.throw(n))}catch(m){r(m)}},i=n=>n.done?p(n.value):Promise.resolve(n.value).then(a,x);i((d=d.apply(s,c)).next())});import{a0 as D,a5 as y,au as A,b as E,a7 as M,av as h,at as b,ax as B,az as V,aA as j,_ as H}from"./index.js";import{P as K}from"./index-20519caf.js";import{B as L}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as W}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{s as q,a as U}from"./stationTree-56a32762.js";import"./index-316f6ffb.js";import{u as X}from"./useRender-21ce56fb.js";import{e as Z}from"./download-03e71dd5.js";import{d as $,k as v,o as G,al as J,Z as Q,a9 as Y,aa as f,f as g,$ as ee,u as l,E as I,ad as _}from"./vue-71d1abb3.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./CommonTree-c4ed7838.js";import"./index-3801a970.js";function te(s){return y.get({url:"/po/safety-tools-scrap/page",params:s})}function ae(s){return y.download({url:"/po/safety-tools-scrap/export-excel",params:s},{isReturnNativeResponse:!0})}const oe={0:"#dc0000",1:"#338ed1",2:"#30ca5a",3:"#929292",4:"#929292",5:"#929292",6:"#fda941"},ne=[{title:"单据编号",dataIndex:"billCode",width:180,sorter:!0,resizable:!0},{title:"所属公司",dataIndex:"stationOrganName",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0,ifShow:D().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"工器具名称",dataIndex:"name",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"工器具编码",dataIndex:"code",align:"left",headAlign:"center",width:180,sorter:!0,resizable:!0},{title:"规格型号",dataIndex:"specification",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"报废时间",dataIndex:"scrapDate",width:120,sorter:!0,resizable:!0},{title:"创建人",dataIndex:"personMemberName",width:100,sorter:!0,resizable:!0},{title:"创建时间",dataIndex:"fillinDate",width:160,sorter:!0,resizable:!0},{title:"状态",dataIndex:"statusText",sorter:!0,resizable:!0,customRender:({text:s,record:c})=>X.renderTag(s,oe[c.status])}],se=[{label:"单据编号",field:"billCode",component:"Input",colProps:{span:8}},{label:"工器具名称",field:"name",component:"Input",colProps:{span:7}},{label:"工器具编码",field:"code",component:"Input",colProps:{span:7}},{label:"状态",field:"status",component:"DictSelectBox",componentProps:{type:"bpm_process_instance_result"},colProps:{span:7}}],re={class:"right-table-layout"},ie=$({__name:"index",setup(s){const{createConfirm:c,createMessage:d}=A(),{t:p}=E();let r=v("");const a=v({status:"",businessKind:"",examinationResult:"",billCode:"",sortField:"fillinDate",sortOrder:"desc",pageNo:1,pageSize:10}),[x,{reload:i,getPaginationRef:n,getForm:m,getSelectRows:w}]=W({title:"安全工器具报废",api:()=>u(this,null,function*(){const e=n();return a.value.pageNo=e.current,a.value.pageSize=e.pageSize,(yield te(a.value)).result}),columns:ne,rowKey:"id",bordered:!0,formConfig:{labelWidth:120,schemas:se,showAdvancedButton:!0,autoAdvancedLine:1},useSearchForm:!0,showTableSetting:!0,rowSelection:{type:"radio",fixed:!0,onSelect:C},sortFn:e=>{e.order?(a.value.sortField=e.field.replace("Text",""),a.value.sortOrder=e.order.replace("end","")):(a.value.sortField="fillinDate",a.value.sortOrder="desc")},handleSearchInfoFn(e){for(const t in e)a.value[t]=e[t]}});function S(e){U(e,a,null,i)}function C(e,t){t?r.value=e.id:r.value=""}function T({keys:e,rows:t}){if(t&&t.length>0){const o=t[0];r.value=o.id}else r.value=""}function z(){if(!a.value.stationId){b.getInstance().info("请选中电站添加");return}B("/po/safetytools/safetytoolsscrap/create?id=","添加安全工器具报废",{stationId:a.value.stationId,stationName:a.value.stationName,stationOrganId:a.value.stationOrganId,stationOrganName:a.value.stationOrganName})}const O=(e,t,o)=>{P(e)};function P(e){V(e.id)}const R=()=>u(this,null,function*(){let e=w();if(e.length!=1){b.getInstance().success("请选择一行数据");return}let t=e[0];c({title:"提示",iconType:"warning",content:"确定要删除选中的记录？",onOk(){return u(this,null,function*(){if(t.status!=0){b.getInstance().success("非草稿状态不能删除");return}yield j(t.processInstanceId),b.getInstance().success("删除成功"),i()})}})});function N(){return u(this,null,function*(){c({title:p("common.exportTitle"),iconType:"warning",content:p("common.exportMessage"),onOk(){return u(this,null,function*(){let t=m().getFieldsValue();Object.assign(t,a.value),yield ae(t).then(o=>{Z(o==null?void 0:o.data,"安全工器具报废.xls")}),d.success(p("common.exportSuccessText"))})}})})}return G(()=>{M.getInstance().listen("safety-tools-scrap",()=>{i()})}),(e,t)=>{const o=J("a-button");return Q(),Y(l(K),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:f(()=>[g(q,{onSelectTree:S}),ee("div",re,[g(l(L),{onRegister:l(x),class:"fix-basic-table",onResizeColumn:t[0]||(t[0]=(k,F)=>F.width=k),onSelectionChange:T,onRowDbClick:O},{toolbar:f(()=>[g(o,{type:"primary",preIcon:l(h).ADD,onClick:z},{default:f(()=>[I(_("添加"))]),_:1},8,["preIcon"]),g(o,{class:"red-btn",disabled:l(r)=="",preIcon:l(h).DELETE,onClick:R},{default:f(()=>[I(_("删除"))]),_:1},8,["disabled","preIcon"]),g(o,{class:"yellow-btn",preIcon:l(h).EXPORT,onClick:N},{default:f(()=>[I(_("导出"))]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])])]),_:1})}}});const Me=H(ie,[["__scopeId","data-v-f28b77c3"]]);export{Me as default};
//# sourceMappingURL=index-6ed85678.js.map
