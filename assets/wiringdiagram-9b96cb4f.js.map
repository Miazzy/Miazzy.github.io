{"version":3,"file":"wiringdiagram-9b96cb4f.js","sources":["../../src/views/baseset/monitor/wiringdiagram/wiringdiagram.ts","../../src/views/baseset/monitor/wiringdiagram/wiringdiagram.vue"],"sourcesContent":["import { defHttp } from '/@/utils/http/axios';\nimport { BasicColumn } from '/@/components/Table';\nimport { reactive } from 'vue';\n\nenum Api {\n  getTreeTypeUrl = '/baseset/wiringdiagram/info/getTree',\n  getTypeUrl = '/baseset/wiringdiagram/info/get',\n  createTypeUrl = '/baseset/wiringdiagram/info/create',\n  updateTypeUrl = '/baseset/wiringdiagram/info/update',\n  deleteTypeUrl = '/baseset/wiringdiagram/info/delete',\n\n  listIdexUrl = '/baseset/wiringdiagram/page',\n  getIndexUrl = '/baseset/wiringdiagram/get',\n  createIndexUrl = '/baseset/wiringdiagram/create',\n  updateIndexUrl = '/baseset/wiringdiagram/update',\n  deleteIndexUrl = '/baseset/wiringdiagram/delete',\n  exportExcelIndexUrl = '/baseset/wiringdiagram/exportExcel',\n  getDevicesUrl = '/baseset/wiringdiagram/geDevices',\n}\n\n// 组织树数据\nexport const getTreeData = (params) =>\n  defHttp.get(\n    {\n      url: Api.getTreeTypeUrl,\n      params,\n    },\n    {},\n  );\n\n// 获取接线图设置分类\nexport const getType = (params) =>\n  defHttp.get(\n    {\n      url: Api.getTypeUrl,\n      params,\n    },\n    {},\n  );\n\n// 新增接线图设置分类\nexport const insertType = (params) =>\n  defHttp.post(\n    {\n      url: Api.createTypeUrl,\n      params,\n    },\n    {},\n  );\n\n// 修改接线图设置分类\nexport const updateType = (params) =>\n  defHttp.put(\n    {\n      url: Api.updateTypeUrl,\n      params,\n    },\n    {},\n  );\n\nexport const getDevices = (params) =>\n  defHttp.get(\n    {\n      url: Api.getDevicesUrl,\n      params,\n    },\n    {},\n  );\n\nexport const saveType = (params) => {\n  if (!params.id) {\n    return insertType(params);\n  }\n  return updateType(params);\n};\n\n// 删除接线图设置分类\nexport const deleteType = (params) =>\n  defHttp.delete(\n    {\n      url: Api.deleteTypeUrl,\n      params,\n    },\n    {},\n  );\n\n// 获取接线图设置列表\nexport const getIndexList = (params) =>\n  defHttp.get(\n    {\n      url: Api.listIdexUrl,\n      params,\n    },\n    {},\n  );\n\n// 新增接线图设置\nexport const insertIndex = (params) =>\n  defHttp.post(\n    {\n      url: Api.createIndexUrl,\n      params,\n    },\n    {},\n  );\n\n// 修改接线图设置\nexport const updateIndex = (params) =>\n  defHttp.put(\n    {\n      url: Api.updateIndexUrl,\n      params,\n    },\n    {},\n  );\n\nexport const saveData = (params) => {\n  if (!params.id) {\n    return insertIndex(params);\n  }\n  return updateIndex(params);\n};\n\n// 删除接线图设置\nexport const deleteIndex = (params) =>\n  defHttp.delete(\n    {\n      url: Api.deleteIndexUrl,\n      params,\n    },\n    {},\n  );\n\n// 导出接线图设置\nexport const exportExcelIndex = (params) =>\n  defHttp.get(\n    {\n      url: Api.exportExcelIndexUrl,\n      params,\n    },\n    {},\n  );\nexport const detailFormState = reactive({ spinning: false });\n\nexport const formIndexState = reactive({\n  id: '',\n  createTime: '',\n});\n","<template>\n  <PageWrapper dense contentFullHeight fixedHeight contentClass=\"flex\" style=\"position: relative\">\n    <!-- 接线图树 -->\n    <CommonTree\n      ref=\"treeRef\"\n      title=\"电站组织\"\n      @select=\"handleSelect\"\n      :value=\"treeData\"\n      class=\"left-tree-layout\"\n      :isShowOperationBtns=\"true\"\n      :fieldNames=\"{ key: 'id', title: 'name' }\"\n      @add=\"handleTreeAdd\"\n      @edit=\"handleTreeEdit\"\n      @delete=\"handleTreeDelete\"\n      @refresh=\"handleTreeRefresh\"\n    />\n    <!-- 数据表格 -->\n    <div class=\"right-table-layout\">\n      <BasicTable\n        class=\"fix-basic-table\"\n        @register=\"registerTable\"\n        :searchInfo=\"searchInfo\"\n        @resize-column=\"(w, col) => (col.width = w)\"\n      >\n        <template #toolbar>\n          <a-button class=\"yellow-btn\" :preIcon=\"IconEnum.IMPORT\" @click=\"importData\"\n            >导入配置</a-button\n          >\n          <!-- <a-upload\n          name=\"file\"\n          :file-list=\"fileList\"\n          :showUploadList=\"false\"\n          :headers=\"headers\"\n          accept=\".json\"\n          @change=\"handleChange\"\n          :disabled=\"uploadDisabled\"\n          action=\"/admin-api/baseset/wiringdiagram/import\"\n        >\n          <a-button type=\"primary\" :preIcon=\"IconEnum.IMPORT\" @click=\"importData\"\n            >导入配置</a-button\n          >\n        </a-upload> -->\n          <a-button type=\"primary\" :preIcon=\"IconEnum.ADD\" @click=\"handleCreateIndex\"\n            >添加</a-button\n          >\n          <a-button\n            class=\"red-btn\"\n            :disabled=\"!hasSelected\"\n            :preIcon=\"IconEnum.DELETE\"\n            @click=\"handleDeleteIndex\"\n            >删除</a-button\n          >\n          <a-button class=\"yellow-btn\" :preIcon=\"IconEnum.EXPORT\" @click=\"handleExportIndex\"\n            >导出</a-button\n          >\n        </template>\n        <template #bodyCell=\"{ column, record }\">\n          <template v-if=\"column.key === 'action'\">\n            <TableAction :actions=\"getWiringAction(record)\" />\n          </template>\n        </template>\n      </BasicTable>\n    </div>\n    <!-- 导入配置 -->\n    <a-modal\n      v-model:visible=\"uploadVisible\"\n      title=\"导入配置\"\n      width=\"600px\"\n      @ok=\"uploadSuccess\"\n      @cancel=\"cancel\"\n    >\n      <a-upload\n        v-model:file-list=\"fileList\"\n        name=\"file\"\n        :headers=\"headers\"\n        @change=\"handleChange\"\n        accept=\".json\"\n        action=\"/admin-api/baseset/wiringdiagram/import\"\n      >\n        <a-button>\n          <upload-outlined />\n          选择文件\n        </a-button>\n      </a-upload>\n    </a-modal>\n\n    <!-- 接线图弹窗 -->\n    <Dialog\n      v-model:visible=\"modal.open.type\"\n      :title=\"modal.title.type\"\n      @ok=\"handleSuccess\"\n      @cancel=\"cancel\"\n      :height=\"250\"\n      :width=\"600\"\n      smode=\"normal\"\n    >\n      <a-form ref=\"modalFormRef\" :model=\"formState\" name=\"userForm\">\n        <a-row :gutter=\"24\">\n          <a-col v-show=\"true\" :span=\"20\">\n            <a-form-item\n              label=\"接线图编码\"\n              name=\"code\"\n              :labelCol=\"{ style: { width: '124px' } }\"\n              :rules=\"[{ required: true, max: 30 }]\"\n            >\n              <a-input v-model:value=\"formState.code\" :maxlength=\"30\" :disabled=\"disabledType\" />\n            </a-form-item>\n          </a-col>\n        </a-row>\n        <a-row :gutter=\"24\">\n          <a-col v-show=\"true\" :span=\"20\">\n            <a-form-item\n              label=\"接线图名称\"\n              name=\"name\"\n              :labelCol=\"{ style: { width: '124px' } }\"\n              :rules=\"[{ required: true, max: 30 }]\"\n            >\n              <a-input v-model:value=\"formState.name\" :maxlength=\"30\" :disabled=\"disabledType\" />\n            </a-form-item>\n          </a-col>\n        </a-row>\n      </a-form>\n    </Dialog>\n\n    <!-- 新增弹窗 -->\n    <div v-if=\"loadingFlag\" class=\"dialog-mask\"></div>\n  </PageWrapper>\n</template>\n<script lang=\"ts\" setup>\n  import Dialog from '@/components/Framework/Modal/Dialog.vue';\n  import type { FormProps } from '/@/components/Form/src/types/form';\n  import { onMounted, reactive, ref, computed } from 'vue';\n  import {\n    BasicTable,\n    useTable,\n    TableAction,\n    EditRecordRow,\n    BasicColumn,\n    SorterResult,\n  } from '/@/components/Table';\n  import { TreeItem } from '/@/components/Tree';\n  import { PageWrapper } from '/@/components/Page';\n  import CommonTree from '@/components/Framework/Tree/CommonTree.vue';\n  import { message, FormInstance } from 'ant-design-vue';\n  import { IconEnum } from '@/enums/appEnum';\n  import { jsonToSheetXlsx } from '/@/components/Excel';\n  import {\n    getTreeData,\n    getType,\n    saveType,\n    deleteType,\n    getIndexList,\n    deleteIndex,\n    saveData,\n    exportExcelIndex,\n  } from './wiringdiagram';\n  import { assign } from 'lodash-es';\n  import { trim } from 'xe-utils';\n  import { useUserStore } from '/@/store/modules/user';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { useMessage } from '@/hooks/web/useMessage';\n  import { addTabPage } from '@/utils/route';\n  import type { UploadChangeParam, SelectProps } from 'ant-design-vue';\n  import { setCustomCompOptions } from '@/utils/cache';\n\n  const currentEditNodeRef = ref();\n  const currentEditKeyRef = ref('');\n  const deviceParam = ref({}); // 查询分期下拉框数据的参数\n  const uploadVisible = ref<boolean>(false);\n  const saveItem = ref<boolean>(false);\n  const uploadDisabled = ref<boolean>(true);\n  const fileList = ref();\n  const { t } = useI18n();\n  const { createConfirm } = useMessage();\n  const userStore = useUserStore();\n\n  // 查询信息\n  const searchInfo = reactive<any>({ folderId: 'test' });\n  // 左侧树数据\n  const treeData = ref<TreeItem[]>([]);\n  // 被选择的树节点\n  const selectedNode = ref({\n    typeId: '',\n    fullName: '',\n    id: '',\n    name: '',\n    nodeKindId: '',\n    existChildNode: false,\n  });\n  const modal = reactive({\n    open: {\n      type: ref<boolean>(false),\n      index: ref<boolean>(false),\n    },\n    title: {\n      type: ref<string>(''),\n      index: ref<string>(''),\n    },\n  });\n  const loadingFlag = ref<boolean>(false);\n  const disabledType = ref<boolean>(false);\n  const checkedKeys = ref<Array<string | number>>([]);\n  const searchBoxColumns1 = [\n    { title: 'esc', dataIndex: 'esn', key: 'esn', fixed: 'left', minWidth: 100 },\n    { title: '设备名称', dataIndex: 'deviceName', key: 'deviceName', fixed: 'left', minWidth: 100 },\n  ];\n  const searchBoxColumns2 = [\n    {\n      title: '关联字段',\n      dataIndex: 'addressField',\n      key: 'addressField',\n      fixed: 'left',\n      minWidth: 100,\n    },\n    {\n      title: '字段描述',\n      dataIndex: 'addressDesc',\n      key: 'addressDesc',\n      fixed: 'left',\n      minWidth: 100,\n    },\n  ];\n\n  const options2 = {\n    columns: searchBoxColumns1,\n    pagination: true, // false 关闭分页   true 开启分页\n    tfields: { key: 'name' },\n    vfield: 'name',\n  };\n\n  const options3 = {\n    columns: searchBoxColumns2,\n    pagination: true, // false 关闭分页   true 开启分页\n    tfields: { key: 'name' },\n    vfield: 'name',\n  };\n\n  const indexColumn: BasicColumn[] = [\n    {\n      title: '组件标记',\n      dataIndex: 'tag',\n      width: 80,\n      editRow: true,\n      resizable: true,\n      sorter: true,\n      editRule: async (text, record) => {\n        if (!text) {\n          return '不能为空';\n        }\n      },\n      editComponent: 'Input',\n    },\n    {\n      title: '组件绑定属性',\n      dataIndex: 'bindingProperties',\n      width: 100,\n      editRow: true,\n      resizable: true,\n      sorter: true,\n      editComponent: 'DictSelectBox',\n      editComponentProps: {\n        type: 'bindingProperties',\n      },\n      editRule: async (text, record) => {\n        if (!text) {\n          return '不能为空';\n        }\n      },\n    },\n    {\n      title: '设备esn',\n      dataIndex: 'esn',\n      width: 100,\n      editRow: true,\n      resizable: true,\n      sorter: true,\n      editComponent: 'SearchBox',\n      editComponentProps: {\n        opkey: 'SearchBox123',\n        twidth: '600px',\n        api: '/baseset/wiringdiagram/getDeviceEsnPage?name={name}&pageNo={current}&pageSize={pageSize}',\n        apiParamFunc: () => {\n          return { folderId: deviceParam.value.folderId };\n        },\n        multiple: false,\n        callback: (options) => {\n          deviceParam.value.esn = options.record.esn;\n          currentEditNodeRef.value.esn = options.record.esn;\n          setCustomCompOptions('SearchBox12', options3);\n        },\n      },\n      editRule: async (text, record) => {\n        if (\n          saveItem.value &&\n          !currentEditNodeRef.value.esn &&\n          record.diagramDataType != 'calculated'\n        ) {\n          return '不能为空';\n        }\n      },\n    },\n    {\n      title: '关联字段',\n      dataIndex: 'associatedField',\n      width: 100,\n      editRow: true,\n      resizable: true,\n      sorter: true,\n      editComponent: 'SearchBox',\n      editComponentProps: {\n        opkey: 'SearchBox12',\n        twidth: '600px',\n        api: '/baseset/wiringdiagram/getAddressFieldPage?name={name}&pageNo={current}&pageSize={pageSize}',\n        apiParamFunc: () => {\n          return { esn: deviceParam.value.esn };\n        },\n        multiple: false,\n        callback: (options) => {\n          currentEditNodeRef.value.associatedField = options.record.addressField;\n          currentEditNodeRef.value.descriptionField = options.record.addressDesc;\n        },\n      },\n      editRule: async (text, record) => {\n        if (\n          saveItem.value &&\n          !currentEditNodeRef.value.associatedField &&\n          record.diagramDataType != 'calculated'\n        ) {\n          return '不能为空';\n        }\n      },\n    },\n    {\n      title: '字段描述',\n      resizable: true,\n      sorter: true,\n      dataIndex: 'descriptionField',\n      width: 100,\n    },\n    {\n      title: '数据类型',\n      dataIndex: 'diagramDataType',\n      width: 100,\n      editRow: true,\n      editComponent: 'DictSelectBox',\n      resizable: true,\n      sorter: true,\n      editComponentProps: {\n        type: 'diagramDataType',\n      },\n      editRule: async (text, record) => {\n        if (!text) {\n          return '不能为空';\n        }\n      },\n    },\n  ];\n\n  const formState = reactive({\n    id: '',\n    name: '',\n    fullId: '',\n    code: '',\n    fullName: '',\n    parentId: '',\n    checkItem: '',\n    description: '',\n    parentName: '',\n    parentFullId: '',\n    parentFullName: '',\n    readOnly: false,\n  });\n  const treeRef = ref();\n  const modalFormRef = ref<FormInstance>();\n  const modalIndexFormRef = ref<FormInstance>();\n  const indexList = ref<Array<any>>([]);\n  const getIndexListByParam = async () => {\n    let list = await getIndexList(searchInfo);\n    indexList.value = list.result;\n    return indexList.value;\n  };\n\n  const headers = {\n    authorization: 'Bearer ' + userStore.getToken,\n    folderId: '',\n    infoType: '',\n    version: '4.5.4',\n  };\n\n  // 导入\n  function importData() {\n    fileList.value = [];\n    if (selectedNode.value.nodeKindId != 'wiringDiagramType') {\n      message.error(`请选择接线图节点导入`);\n      uploadDisabled.value = true;\n      return;\n    }\n    createConfirm({\n      title: t('common.message.confirmTitle'),\n      iconType: 'warning',\n      content: '导入后原数据会被覆盖，是否导入配置？',\n      async onOk() {\n        uploadDisabled.value = false;\n        uploadVisible.value = true;\n        headers.folderId = selectedNode.value.id;\n      },\n    });\n  }\n\n  const handleChange = (info: UploadChangeParam) => {\n    if (info.file.status !== 'uploading') {\n      // console.log(info.file, info.fileList);\n    }\n    if (info.file.status === 'done') {\n      message.success(`${info.file.name} file uploaded successfully`);\n      reload();\n      uploadVisible.value = false;\n    } else if (info.file.status === 'error') {\n      message.error(`${info.file.name} file upload failed.`);\n    }\n  };\n\n  function uploadSuccess() {\n    uploadVisible.value = false;\n  }\n\n  const searchForm: FormProps = {\n    baseColProps: { lg: 6, md: 8 },\n    labelWidth: 90,\n    schemas: [\n      {\n        label: '主题',\n        field: 'subject',\n        component: 'Input',\n      },\n    ],\n  };\n\n  const [registerTable, { reload, getPaginationRef, getDataSource: getItemDataSource }] = useTable({\n    title: '接线图',\n    api: async () => {\n      const paginationRef = getPaginationRef() as any;\n      searchInfo.pageNo = paginationRef.current;\n      searchInfo.pageSize = paginationRef.pageSize;\n      let dataObj = await getIndexListByParam();\n      return dataObj;\n    },\n    columns: indexColumn,\n    useSearchForm: false,\n    showIndexColumn: false,\n    formConfig: searchForm,\n    showTableSetting: true,\n    resizeHeightOffset: 33,\n    pagination: true,\n    canResize: true,\n    bordered: true,\n    rowKey: 'id',\n    actionColumn: {\n      width: 80,\n      title: '操作',\n      dataIndex: 'action',\n    },\n    rowSelection: {\n      type: 'checkbox',\n      selectedRowKeys: checkedKeys,\n      onSelect: onSelect,\n      onSelectAll: onSelectAll,\n    },\n    sortFn: (sortInfo: SorterResult) => {\n      if (sortInfo.order) {\n        searchInfo.sortField = sortInfo.field;\n        searchInfo.sortOrder = sortInfo.order.replace('end', '');\n      } else {\n        searchInfo.sortField = null;\n        searchInfo.sortOrder = null;\n      }\n    },\n  });\n  const hasSelected = computed(() => checkedKeys.value.length > 0);\n  function onSelect(record, selected) {\n    if (selected) {\n      checkedKeys.value = [...checkedKeys.value, record.id];\n    } else {\n      checkedKeys.value = checkedKeys.value.filter((id) => id !== record.id);\n    }\n  }\n  function onSelectAll(selected, selectedRows, changeRows) {\n    const changeIds = changeRows.map((item) => item.id);\n    if (selected) {\n      checkedKeys.value = [...checkedKeys.value, ...changeIds];\n    } else {\n      checkedKeys.value = checkedKeys.value.filter((id) => {\n        return !changeIds.includes(id);\n      });\n    }\n  }\n  // 查询左侧树数据\n  async function queryTreeList() {\n    const typeList = await getTreeData({});\n    treeData.value = typeList.result as unknown[] as TreeItem[];\n  }\n\n  // 新增树节点的的回调\n  function handleTreeAdd(node) {\n    formState.id = '';\n    formState.parentId = 'orgRoot';\n    formState.fullId = '';\n    formState.parentName = '';\n    formState.parentFullName = '';\n    if (node) {\n      if (node.nodeKindId != 'station') {\n        message.error('请在电站节点添加。');\n        return;\n      }\n      formState.parentId = node.id;\n      formState.parentName = node.name;\n      formState.fullId = '/' + node.organId + '/' + node.powerStationId;\n      formState.parentFullName = node.organName + '-' + node.powerStationName;\n    } else {\n      message.error('请选中电站节点添加。');\n      return;\n    }\n    const operateText = getOperateText(formState);\n\n    modal.open.type = true;\n    modal.title.type = operateText + '接线图';\n  }\n\n  function isSelectNode(node) {\n    if (!node) {\n      message.error('请选择接线图节点');\n      return false;\n    }\n    return true;\n  }\n\n  // 编辑树节点的的回调\n  function handleTreeEdit(node) {\n    const operateText = getOperateText({ id: node.id });\n    if (!node || node.nodeKindId != 'wiringDiagramType') {\n      message.error(`请选择接线图节点${operateText}`);\n      return;\n    }\n\n    if (!isEditTree(node, operateText)) {\n      return;\n    }\n    getType({ id: node.id }).then((data) => {\n      assign(formState, data.result);\n    });\n    modal.open.type = true;\n    modal.title.type = operateText + '接线图';\n  }\n  function isEditTree(node, operateText) {\n    if (!node) {\n      return false;\n    }\n    if (indexList.value && indexList.value.list && indexList.value.list.length > 0) {\n      message.error('该接线图存在接线图设置，不能' + operateText);\n      return false;\n    }\n    return true;\n  }\n  // 删除树节点的回调\n  function handleTreeDelete(node) {\n    if (!node || node.nodeKindId != 'wiringDiagramType') {\n      message.error(`请选择接线图节点删除`);\n      return;\n    }\n\n    if (node.children.length > 0) {\n      message.error('该接线图存在子节点，不能删除');\n      return false;\n    }\n\n    if (indexList.value && indexList.value.list && indexList.value.list.length > 0) {\n      message.error('该接线图有接线图设置数据，不能删除');\n      return false;\n    }\n    deleteConfirm(function () {\n      deleteType('?id=' + node.id).then(() => {\n        handleTreeRefresh();\n      });\n    });\n  }\n\n  function deleteConfirm(callback: Function) {\n    createConfirm({\n      title: t('common.message.confirmTitle'),\n      iconType: 'warning',\n      content: t('common.message.delMessage'),\n      async onOk() {\n        await callback();\n        message.success(t('common.delSuccessText'));\n      },\n    });\n  }\n  // 刷新树的回调\n  function handleTreeRefresh() {\n    queryTreeList();\n  }\n\n  // 数据创建成功回调函数\n  function handleSuccess() {\n    let value = modalFormRef.value;\n    if (value) {\n      value.validateFields().then(() => {\n        loadingFlag.value = true;\n        formState.fullName = getFullName();\n        let operateText = getOperateText(formState);\n        saveType(formState)\n          .then(() => {\n            message.success(operateText + '成功');\n            resetForm();\n            handleTreeRefresh();\n            modal.open.type = false;\n            loadingFlag.value = false;\n          })\n          .catch(() => {\n            loadingFlag.value = false;\n          });\n      });\n    }\n  }\n\n  function getOperateText(params) {\n    return !params.id ? '添加' : '编辑';\n  }\n\n  function getFullName() {\n    let parentFullName = formState.parentFullName;\n    if (parentFullName) {\n      return parentFullName + '-' + trim(formState.name);\n    }\n    return trim(formState.name);\n  }\n\n  function cancel() {\n    resetForm();\n    uploadVisible.value = false;\n    modal.open.type = false;\n  }\n\n  // 重置表单\n  function resetForm() {\n    modalFormRef.value?.resetFields();\n    modalIndexFormRef.value?.resetFields();\n  }\n\n  // 左侧树状菜单选中事件\n  function handleSelect(node) {\n    searchInfo.stationId = null;\n    searchInfo.stationName = null;\n    searchInfo.stationOrganId = null;\n    searchInfo.stationOrganName = null;\n    searchInfo.nodeKindId = null;\n    searchInfo.folderId = 'test';\n\n    if (node) {\n      searchInfo.stationOrganId = node.organId;\n      searchInfo.stationOrganName = node.organName;\n      searchInfo.nodeKindId = node.nodeKindId;\n\n      let fullName = node.organName;\n      if (node.nodeKindId == 'station') {\n        searchInfo.stationId = node.powerStationId;\n        searchInfo.stationName = node.name;\n        fullName = fullName + '-' + node.name;\n      }\n\n      if (node.nodeKindId == 'wiringDiagramType') {\n        fullName = fullName + '-' + node.name;\n        headers.folderId = node.id;\n        searchInfo.folderId = node.id;\n      }\n\n      selectedNode.value = {\n        typeId: node.id,\n        fullName: fullName,\n        id: node.id,\n        name: node.name,\n        nodeKindId: node.nodeKindId,\n        existChildNode: node.children == null ? false : node.children.length > 0,\n      };\n    }\n\n    // 处理数据编辑状态\n\n    if (currentEditNodeRef.value != undefined) {\n      message.error('请先完成编辑。');\n      return false;\n    } else {\n      reload();\n    }\n  }\n\n  // 添加接线图\n  function handleCreateIndex() {\n    const node = treeRef.value.getSelectedTreeNode();\n    if (!node) {\n      message.error('请选择接线图');\n      return;\n    }\n    if (node.nodeKindId != 'wiringDiagramType') {\n      message.error('请选择接线图的节点');\n      return;\n    }\n    if (currentEditNodeRef.value != undefined) {\n      message.error('请先完成编辑。');\n      return false;\n    }\n    const data = getItemDataSource();\n\n    data.splice(0, data.length);\n    const addRow: EditRecordRow = {\n      folderId: node.id,\n      editable: true,\n      isNew: true,\n      key: `${Date.now()}`,\n    };\n    data.push(addRow);\n\n    deviceParam.value.folderId = node.id;\n    setCustomCompOptions('SearchBox123', options2);\n    currentEditKeyRef.value = handleRecordKey(addRow);\n    currentEditNodeRef.value = addRow;\n  }\n\n  function checkSelectData() {\n    if (checkedKeys.value.length == 0) {\n      message.error('请选择数据');\n      return false;\n    }\n    return true;\n  }\n\n  function getWiringAction(record: EditRecordRow) {\n    if (!record.editable) {\n      return [\n        {\n          label: '修改',\n          icon: 'clarity:bullet-list-line',\n          disabled: handleCellDisabled(record), // record里面不存在字段‘key’，导致异常,\n          onClick: handleEdit.bind(null, record),\n        },\n      ];\n    }\n    return [\n      {\n        label: '保存',\n        onClick: handleSave.bind(null, record),\n      },\n      {\n        label: '取消',\n        popConfirm: {\n          title: '是否取消修改',\n          confirm: handleUnSave.bind(null, record),\n        },\n      },\n    ];\n  }\n\n  function handleEdit(record: EditRecordRow) {\n    deviceParam.value.folderId = record.folderId;\n    deviceParam.value.esn = record.esn;\n    setCustomCompOptions('SearchBox123', options2);\n    setCustomCompOptions('SearchBox12', options3);\n    currentEditKeyRef.value = handleRecordKey(record);\n    currentEditNodeRef.value = record;\n    record.onEdit?.(true);\n  }\n\n  const handleRecordKey = (record) => {\n    if (Reflect.has(record, 'id')) {\n      return Reflect.get(record, 'id');\n    } else {\n      return '';\n    }\n  };\n\n  const handleCellDisabled = (record) => {\n    const result = currentEditKeyRef.value\n      ? currentEditKeyRef.value !== handleRecordKey(record)\n      : false;\n    return result;\n  };\n  // 行修改后保存\n  async function handleSave(record: EditRecordRow) {\n    saveItem.value = true;\n    const valid = await record.onValid?.();\n    if (valid) {\n      saveData(record).then(() => {\n        currentEditKeyRef.value = '';\n        currentEditNodeRef.value = null;\n        message.success('已修改');\n        reload();\n        saveItem.value = false;\n      });\n    }\n  }\n\n  // 行修改取消\n  function handleUnSave(record: EditRecordRow) {\n    currentEditKeyRef.value = '';\n    currentEditNodeRef.value = null;\n    saveItem.value = false;\n    record.onEdit?.(false, false);\n    reload();\n  }\n\n  // 导出\n  async function handleExportIndex() {\n    createConfirm({\n      title: '导出',\n      iconType: 'warning',\n      content: '确定要导出所有记录？',\n      async onOk() {\n        const header = ref({ index: '序号' });\n        const indexColumns = indexColumn;\n        const data = ref<Array<any>>([]);\n        const keys = ref<Array<any>>([]);\n        indexColumns.forEach((column) => {\n          if (!(column.dataIndex === 'id')) {\n            header.value[column.dataIndex] = column.title;\n            keys.value.push(column.dataIndex);\n          }\n        });\n\n        let areaList = await exportExcelIndex(searchInfo);\n        indexList.value = areaList.result;\n        indexList.value.forEach(function (item, index) {\n          let exportItem = ref({ index: index + 1 });\n          keys.value.forEach((key) => {\n            if (key === 'diagramDataType') {\n              exportItem.value[key] = item['diagramDataTypeText'];\n            } else {\n              exportItem.value[key] = item[key];\n            }\n          });\n          data.value.push(exportItem.value);\n        });\n\n        jsonToSheetXlsx({\n          data: data.value,\n          header: header.value,\n          filename: '接线图设置.xlsx',\n        });\n      },\n    });\n  }\n\n  // 删除接线图\n  function handleDeleteIndex() {\n    if (!checkSelectData()) {\n      return;\n    }\n    createConfirm({\n      title: '提示',\n      iconType: 'warning',\n      content: '确定要删除选中记录？',\n      async onOk() {\n        deleteIndex('?ids=' + checkedKeys.value).then(() => {\n          message.success('已删除');\n          checkedKeys.value = [];\n          reload();\n        });\n      },\n    });\n  }\n\n  // 启动执行代码\n  onMounted(() => {\n    queryTreeList();\n  });\n</script>\n<style lang=\"less\" scoped>\n  .dialog-loading {\n    position: absolute;\n    z-index: 1000 !important;\n    top: 45%;\n    left: 45%;\n  }\n\n  .dialog-mask {\n    position: absolute;\n    z-index: 1001 !important;\n    top: -1px;\n    width: 100%;\n    height: 100%;\n    opacity: 0.3;\n    background: #ccc;\n  }\n\n  .left-tree-layout {\n    flex-shrink: 0;\n    width: 298px;\n    border-radius: 2px;\n  }\n\n  .right-table-layout {\n    width: calc(100% - 308px);\n  }\n\n  .fix-basic-table {\n    padding-top: 10px;\n    padding-right: 10px;\n    padding-left: 10px;\n\n    :deep(&.vben-basic-table .ant-table-wrapper) {\n      padding: 10px 16px 12px;\n    }\n\n    :deep(.table-settings) {\n      margin-right: 0;\n    }\n\n    :deep(.table-settings .anticon-setting) {\n      margin-right: 0;\n    }\n  }\n</style>\n"],"names":["getTreeData","params","defHttp","getType","insertType","updateType","saveType","deleteType","getIndexList","insertIndex","updateIndex","saveData","deleteIndex","exportExcelIndex","reactive","currentEditNodeRef","ref","currentEditKeyRef","deviceParam","uploadVisible","saveItem","uploadDisabled","fileList","t","useI18n","createConfirm","useMessage","userStore","useUserStore","searchInfo","treeData","selectedNode","modal","loadingFlag","disabledType","checkedKeys","searchBoxColumns1","searchBoxColumns2","options2","options3","indexColumn","text","record","__async","options","setCustomCompOptions","formState","treeRef","modalFormRef","modalIndexFormRef","indexList","getIndexListByParam","list","headers","importData","message","handleChange","info","reload","uploadSuccess","searchForm","registerTable","getPaginationRef","getItemDataSource","useTable","paginationRef","onSelect","onSelectAll","sortInfo","hasSelected","computed","selected","id","selectedRows","changeRows","changeIds","item","queryTreeList","typeList","handleTreeAdd","node","operateText","getOperateText","handleTreeEdit","isEditTree","data","assign","handleTreeDelete","deleteConfirm","handleTreeRefresh","callback","handleSuccess","value","getFullName","resetForm","parentFullName","trim","cancel","_a","_b","handleSelect","fullName","handleCreateIndex","addRow","handleRecordKey","checkSelectData","getWiringAction","handleSave","handleUnSave","handleCellDisabled","handleEdit","handleExportIndex","header","indexColumns","keys","column","areaList","index","exportItem","key","jsonToSheetXlsx","handleDeleteIndex","onMounted"],"mappings":"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"}