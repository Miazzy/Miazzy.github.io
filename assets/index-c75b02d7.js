var l=(i,t,n)=>new Promise((d,u)=>{var x=o=>{try{p(n.next(o))}catch(m){u(m)}},b=o=>{try{p(n.throw(o))}catch(m){u(m)}},p=o=>o.done?d(o.value):Promise.resolve(o.value).then(x,b);p((n=n.apply(i,t)).next())});import{a0 as B,a5 as z,b as Y,au as V,a7 as j,av as w,ax as k,at as f,az as H,aA as $,_ as L}from"./index.js";import{P as W}from"./index-20519caf.js";import{B as q}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as K}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{s as U,a as X}from"./stationTree-56a32762.js";import{e as Z}from"./download-03e71dd5.js";import"./index-316f6ffb.js";import{u as G}from"./useRender-21ce56fb.js";import{d as J,k as C,o as Q,al as ee,Z as S,a9 as te,aa as c,f as g,$ as ae,u as s,E as y,ad as h,_ as ne,ac as re}from"./vue-71d1abb3.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./CommonTree-c4ed7838.js";import"./index-3801a970.js";function oe(i){return z.get({url:"/po/vehicle-execution/page",params:i})}function ie(i){return z.download({url:"/po/vehicle-execution/export-excel",params:i},{isReturnNativeResponse:!0})}const se={0:"#dc0000",1:"#338ed1",2:"#30ca5a",3:"#929292",4:"#929292",5:"#929292",6:"#fda941"},le=[{title:"单据编号",dataIndex:"billCode",width:160,sorter:!0,resizable:!0},{title:"所属公司",dataIndex:"stationOrganName",align:"left",headAlign:"center",width:160,sorter:!0,resizable:!0,ifShow:B().isMultiOrganization},{title:"电站",dataIndex:"stationName",align:"left",headAlign:"center",width:160,sorter:!0,resizable:!0},{title:"车牌号",dataIndex:"plateNumber",width:120,sorter:!0,resizable:!0},{title:"识别代码",dataIndex:"identificationCode",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"检查开始时间",dataIndex:"startDate",width:120,sorter:!0,resizable:!0},{title:"检查人",dataIndex:"checkerName",width:100,sorter:!0,resizable:!0},{title:"行驶公里数",dataIndex:"mileage",align:"right",headAlign:"center",width:100,sorter:!0,resizable:!0},{title:"检查结论",dataIndex:"checkResultText",width:100,sorter:!0,resizable:!0},{title:"检查情况",dataIndex:"checkDescription",align:"left",headAlign:"center",width:100,sorter:!0,resizable:!0},{title:"检查项次",dataIndex:"checkNum",align:"right",headAlign:"center",width:100,sorter:!0,resizable:!0},{title:"整改项次",dataIndex:"rectification",align:"right",headAlign:"center",width:100,sorter:!0,resizable:!0},{title:"审批状态",dataIndex:"statusText",width:100,sorter:!0,resizable:!0,customRender:({text:i,record:t})=>G.renderTag(i,se[t.status])},{title:"创建人",dataIndex:"personMemberName",width:100,sorter:!0,resizable:!0},{title:"创建时间",dataIndex:"fillinDate",sorter:!0,resizable:!0}],ce=[{label:"单据编号",field:"billCode",component:"Input",colProps:{span:8}},{label:"车牌号",field:"plateNumber",component:"Input",colProps:{span:8}},{field:"[startStartDate, endStartDate]",label:"检查时间",component:"RangePicker",colProps:{span:8},componentProps:{format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",placeholder:["开始日期","结束日期"]}},{label:"检查结论",field:"checkResult",component:"DictSelectBox",colProps:{span:8},componentProps:{type:"inspection_conclusion"}},{label:"状态",field:"status",component:"DictSelectBox",componentProps:{type:"bpm_process_instance_result"},colProps:{span:8}}],de={class:"right-table-layout"},ue=["onClick"],pe=J({__name:"index",setup(i){const t=C({status:"",checkResult:"",startDate:"",endDate:"",plateNumber:"",pageNo:1,pageSize:10,sortField:"fillinDate",sortOrder:"desc"});let n=C("");const{t:d}=Y(),{createConfirm:u,createMessage:x}=V(),b=e=>{k("/po/danger/index?dtlIds="+e)};function p(e){X(e,t,null,I)}const[o,{getForm:m,reload:I,getPaginationRef:D,getSelectRows:P}]=K({title:"车辆检查",api:()=>l(this,null,function*(){const e=D();return t.value.pageNo=e.current,t.value.pageSize=e.pageSize,(yield oe(t.value)).result}),columns:le,rowKey:"id",bordered:!0,formConfig:{labelWidth:120,schemas:ce,showAdvancedButton:!0,autoAdvancedLine:1},sortFn:e=>{e.order?(t.value.sortField=e.field.replace("Text",""),t.value.sortOrder=e.order.replace("end","")):(t.value.sortField="fillinDate",t.value.sortOrder="desc")},useSearchForm:!0,showTableSetting:!0,rowSelection:{type:"radio",fixed:!0,onSelect:N},handleSearchInfoFn(e){for(const a in e)t.value[a]=e[a]}});function N(e,a){a?n.value=e.id:n.value=""}function T({keys:e,rows:a}){if(a&&a.length>0){const r=a[0];n.value=r.id}else n.value=""}function R(){if(!t.value.stationId){f.getInstance().info("请选择电站.");return}k("/po/safety/vehicleexecution/create?id=","新增车辆检查",{stationOrganId:t.value.stationOrganId,stationOrganName:t.value.stationOrganName,stationId:t.value.stationId,stationName:t.value.stationName})}const O=(e,a,r)=>{F(e)};function F(e){H(e.id)}const M=()=>l(this,null,function*(){let e=P();if(e.length!=1){f.getInstance().success("请选择一行数据");return}let a=e[0];u({title:"提示",iconType:"warning",content:"确定要删除选中的记录？",onOk(){return l(this,null,function*(){if(a.status!=0){f.getInstance().success("非草稿状态不能删除");return}yield $(a.processInstanceId),f.getInstance().success("删除成功"),I()})}})});function A(){return l(this,null,function*(){u({title:d("common.exportTitle"),iconType:"warning",content:d("common.exportMessage"),onOk(){return l(this,null,function*(){let a=m().getFieldsValue();Object.assign(a,t.value),yield ie(a).then(r=>{Z(r==null?void 0:r.data,"车辆检查.xls")}),x.success(d("common.exportSuccessText"))})}})})}return Q(()=>{j.getInstance().listen("vehicle-execution",()=>{I()})}),(e,a)=>{const r=ee("a-button");return S(),te(s(W),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:c(()=>[g(U,{onSelectTree:p}),ae("div",de,[g(s(q),{onRegister:s(o),onResizeColumn:a[0]||(a[0]=(_,v)=>v.width=_),onRowDbClick:O,class:"fix-basic-table",onSelectionChange:T},{toolbar:c(()=>[g(r,{type:"primary",preIcon:s(w).ADD,onClick:R},{default:c(()=>[y(h("新增"))]),_:1},8,["preIcon"]),g(r,{class:"red-btn",disabled:s(n)=="",preIcon:s(w).DELETE,onClick:M},{default:c(()=>[y(h("删除"))]),_:1},8,["disabled","preIcon"]),g(r,{class:"yellow-btn",preIcon:s(w).EXPORT,onClick:A},{default:c(()=>[y(h("导出"))]),_:1},8,["preIcon"])]),bodyCell:c(({column:_,text:v,record:E})=>[_.dataIndex==="rectification"?(S(),ne("a",{key:0,onClick:me=>b(`${E.dtlIds}`),target:"_blank"},h(v),9,ue)):re("",!0)]),_:1},8,["onRegister"])])]),_:1})}}});const $e=L(pe,[["__scopeId","data-v-7a0a08c8"]]);export{$e as default};
//# sourceMappingURL=index-c75b02d7.js.map
