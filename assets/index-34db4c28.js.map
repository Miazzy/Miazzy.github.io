{"version":3,"file":"index-34db4c28.js","sources":["../../src/views/po/inspection/inspectionplan/index.ts","../../src/views/po/inspection/inspectionplan/index.vue"],"sourcesContent":["import { BasicColumn, FormSchema } from '@/components/Table';\nimport { defHttp } from '@/utils/http/axios';\n\nenum Api {\n  getPlanPage = '/po/inspection-plan/page',\n  deletePlanData = '/po/inspection-plan/delete',\n  getPlanData = '/po/inspection-plan/get',\n  updateData = '/po/inspection-plan/update',\n}\n\n// 查询\nexport function getPlanPage(params) {\n  return defHttp.get({ url: Api.getPlanPage, params });\n}\nexport function getPlanData(params) {\n  return defHttp.get({ url: Api.getPlanData, params });\n}\n//删除\nexport function deletePlan(id: string) {\n  return defHttp.delete({ url: Api.deletePlanData + '?id=' + id });\n}\n\nexport function updateDataPlan(params) {\n  return defHttp.put({ url: Api.updateData + '?id=' + params.id + '&status=' + params.bizStatus });\n}\nconst statusColor = {\n  0: '#dc0000', // 草稿\n  1: '#338ed1', // 处理中\n  2: '#30ca5a', // 通过\n  3: '#929292', // 不通过\n  4: '#929292', // 已取消\n  5: '#929292', // 已终止\n  6: '#fda941', // 退回/驳回\n};\nexport const columns: BasicColumn[] = [\n  { title: '单据编号', dataIndex: 'billCode', width: 300,sorter: true,resizable: true },\n  { title: '巡检区域', dataIndex: 'inspectionAreaTypeText', width: 300,sorter: true,resizable: true },\n  // { title: '电站类型', dataIndex: 'powerStationTypeText', width: 120 },\n  { title: '主题', dataIndex: 'subject',align: 'left',headAlign:'center', width: 300,sorter: true,resizable: true },\n  // {\n  //   title: '审批状态',\n  //   dataIndex: 'statusText',\n  //   width: 100,\n  //   customRender: ({ text, record }) => {\n  //     return useRender.renderTag(text, statusColor[record.status]);\n  //   },\n  // },\n  { title: '创建人', dataIndex: 'personMemberName', width: 200,sorter: true,resizable: true },\n  { title: '创建时间', dataIndex: 'fillinDate', width: 300,sorter: true,resizable: true },\n  { title: '模板状态', dataIndex: 'bizStatusText',sorter: true,resizable: true },\n];\n\nexport const searchFormSchema: FormSchema[] = [\n  { label: '单据编号', field: 'billCode', component: 'Input', colProps: { span: 8 } },\n  {\n    label: '巡检区域',\n    field: 'inspectionAreaType',\n    component: 'DictSelectBox',\n    componentProps: {\n      type: 'commDeviceCategory',\n    },\n    colProps: { span: 8 },\n  },\n  {\n    label: '状态',\n    field: 'status',\n    component: 'DictSelectBox',\n    componentProps: {\n      type: 'bpm_process_instance_result',\n    },\n    colProps: { span: 8 },\n  },\n  {\n    label: '模板状态',\n    field: 'bizStatus',\n    component: 'Select',\n    componentProps: {\n      options: [\n        { label: '启用', value: '1' },\n        { label: '禁用', value: '0' },\n      ],\n    },\n    colProps: { span: 8 },\n  },\n];\n","<template>\n  <PageWrapper dense contentFullHeight  fixedHeight contentClass=\"flex\" style=\"position: relative\">\n    <BasicTable @register=\"table\" class=\"w-4/4 xl:w-12/12\" \n    @resize-column=\"(w, col) => (col.width = w)\"\n    @selection-change=\"handleSelectChange\"\n    @row-dbClick=\"dbClick\">\n      <template #toolbar>\n        <a-button type=\"primary\" :preIcon=\"IconEnum.ADD\" @click=\"handleCreate\">\n          {{ '添加' }}\n        </a-button>\n        <a-button class=\"red-btn\" :disabled=\"selectedRowId == ''\" :preIcon=\"IconEnum.DELETE\" @click=\"handleCancel\">\n          {{ '删除' }}\n        </a-button>\n        <a-button class=\"green-btn\" :disabled=\"selectedRowId == ''\" v-auth=\"`po:inspectionPlan:enable`\" :preIcon=\"IconEnum.ENABLE\" @click=\"handleEnable\">\n          {{ '启用' }}\n        </a-button>\n        <a-button class=\"grey-btn\" :disabled=\"selectedRowId == ''\" v-auth=\"`po:inspectionPlan:disabled`\" :preIcon=\"IconEnum.DISABLE\" @click=\"handleDisable\">\n          {{ '禁用' }}\n        </a-button>\n      </template>\n    </BasicTable>\n  </PageWrapper>\n</template>\n\n<script lang=\"ts\" setup>\n  import { PageWrapper } from '/@/components/Page';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { useMessage } from '@/hooks/web/useMessage';\n  import { IconEnum } from '@/enums/appEnum';\n  import { BasicTable, useTable,SorterResult } from '@/components/Table';\n  import { ref, onMounted } from 'vue';\n  // import { ElMessageBox } from 'element-plus';\n  // import { cancelProcessInstance } from '@/api/bpm/processInstance';\n  import { columns, searchFormSchema, getPlanPage, updateDataPlan,deletePlan } from './index';\n  import { addTabPage } from '@/utils/route';\n  import { SysMessage } from '/@/hooks/web/useMessage';\n  import { MsgManager } from '/@/message/MsgManager';\n  let selectedRowId = ref('');\n  const queryParam = ref({\n    status: '',\n    inspectionAreaType: '',\n    bizStatus: '',\n    pageNo: 1,\n    pageSize: 10,\n    sortField: 'fillinDate',\n    sortOrder: 'desc'\n  });\n\n  const { t } = useI18n();\n  const { createConfirm } = useMessage();\n\n  const [table, { reload, getSelectRowKeys, getPaginationRef,getSelectRows }] = useTable({\n    title: '巡检计划',\n    api: async () => {\n      const paginationRef = getPaginationRef() as any;\n      queryParam.value.pageNo = paginationRef.current;\n      queryParam.value.pageSize = paginationRef.pageSize;\n      let dataObj = await getPlanPage(queryParam.value);\n      return dataObj.result;\n    },\n    columns,\n    rowKey: 'id',\n    bordered: true,\n    formConfig: { \n      labelWidth: 120, \n      schemas: searchFormSchema,      \n      showAdvancedButton:true,\n      autoAdvancedLine:1,  \n    },\n    sortFn: (sortInfo: SorterResult) => {\n      if (sortInfo.order) {\n        queryParam.value.sortField = sortInfo.field.replace('Text', '');\n        queryParam.value.sortOrder = sortInfo.order.replace('end', '');\n      } else {\n          queryParam.value.sortField = 'fillinDate';\n          queryParam.value.sortOrder = 'desc';\n        }\n    },\n    useSearchForm: true,\n    showTableSetting: true,\n    rowSelection: {\n      type: 'radio',\n      fixed: true,\n      onSelect: onSelect\n    },\n    handleSearchInfoFn(info) {\n      for (const key in info) {\n        queryParam.value[key] = info[key];\n      }\n    },\n  });\n  function onSelect(record, selected) {\n    if (selected) {\n      selectedRowId.value = record.id;\n    } else {\n      selectedRowId.value = '';\n    }\n  }\n  function handleSelectChange({ keys, rows }) {\n    if (rows && rows.length > 0) {\n      const record = rows[0];\n      selectedRowId.value = record.id;\n    } else {\n      selectedRowId.value = '';\n    }\n  }\n  function handleCreate() {\n    // router.push({\n    //   path: `/po/inspection/inspectionplan/create?id=`,\n    //   query: {},\n    // });\n    addTabPage(`/po/inspection/inspectionplan/create?id=`,'添加巡检计划');\n  }\n  const dbClick=(record, index, event)=>{\n    \n    handleEdit(record);\n  }\n  function handleEdit(record) {\n    // router.push(\n    //   `/po/inspection/inspectionplan/create?id=${record.id}&processInstanceId=${record.processInstanceId}`,\n    // );\n    let str='';\n    if(record.status==0){\n      str='修改'\n    } else {\n      str='查看'\n    }\n    addTabPage(\n      `/po/inspection/inspectionplan/create?id=${record.id}`,\n      str+'巡检计划'\n    );\n  }\n  const handleCancel = async () => {\n    let rows = getSelectRows();\n    if(rows.length != 1){\n      SysMessage.getInstance().success('请选择一行数据');\n      return;\n    }\n\n    // 发起删除\n    // await cancelProcessInstance(record.processInstanceId, value);\n    createConfirm({\n      title: '提示',\n      iconType: 'warning',\n      content: '确定要删除选中的记录？',\n      async onOk() {\n        deletePlan(rows[0].id).then((resp)=>{\n          SysMessage.getInstance().success('删除成功');\n          reload();\n        })\n      },\n    });\n\n\n  };\n\n  function handleEnable() {\n    updateBizStatus(1);\n  }\n  function handleDisable() {\n    updateBizStatus(0);\n  }\n  function updateBizStatus(status) {\n    let keys = getSelectRowKeys();\n    if (keys.length !== 1) {\n      SysMessage.getInstance().info('请选择一条数据.');\n      return false;\n    }\n    let tip = status == 1 ? '启用' : '禁用';\n    createConfirm({\n      title: tip,\n      iconType: 'warning',\n      content: t('确定要' + tip + '数据？'),\n      async onOk() {\n        updateDataPlan({ id: keys[0], bizStatus: status }).then(() => {\n          reload();\n        });\n      },\n    });\n    reload();\n  }\n  onMounted(() => {\n    MsgManager.getInstance().listen('inspection-plan',  ()=>{\n      reload()\n    });\n  });\n</script>\n"],"names":["getPlanPage","params","defHttp","deletePlan","id","updateDataPlan","columns","searchFormSchema","selectedRowId","ref","queryParam","t","useI18n","createConfirm","useMessage","table","reload","getSelectRowKeys","getPaginationRef","getSelectRows","useTable","__async","paginationRef","sortInfo","onSelect","info","key","record","selected","handleSelectChange","keys","rows","handleCreate","addTabPage","dbClick","index","event","handleEdit","str","handleCancel","SysMessage","resp","handleEnable","updateBizStatus","handleDisable","status","tip","onMounted","MsgManager"],"mappings":"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"}