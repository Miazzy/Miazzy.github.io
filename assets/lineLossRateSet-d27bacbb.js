var S=(n,I,b)=>new Promise((A,L)=>{var a=c=>{try{p(b.next(c))}catch(_){L(_)}},m=c=>{try{p(b.throw(c))}catch(_){L(_)}},p=c=>c.done?A(c.value):Promise.resolve(c.value).then(a,m);p((b=b.apply(n,I)).next())});import{d as xe,k as u,r as M,o as Se,al as v,Z as V,a9 as W,aa as s,f as l,$ as Le,u as d,E as K,ac as X,v as z,A as F,_ as Ce}from"./vue-71d1abb3.js";import{D as Ne}from"./Dialog-0a006d82.js";import{B as Re}from"./BasicTable-0434a334.js";import{T as ke}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as Pe}from"./useTable-109483b3.js";import{a2 as P}from"./antd-15ac76ed.js";import{a0 as Q,a5 as h,au as Te,av as O,_ as Ee}from"./index.js";import{P as De}from"./index-20519caf.js";import{C as Ke}from"./CommonTree-c4ed7838.js";import"./index-74ac3212.js";import{a as Z}from"./assign-37f1c13d.js";import{j as ze}from"./Export2Excel-389a8fc9.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";const $=n=>h.get({url:"/baseset/linelossrate/periods",params:n},{}),Fe=n=>h.get({url:"/baseset/linelossrate/exportExcel",params:n},{});function G(n){return[{title:"ID",dataIndex:"id",defaultHidden:!0},{title:"所属公司",dataIndex:"orgName",width:160,resizable:!0,sorter:!0,ifShow:Q().isMultiOrganization,headAlign:"center",align:"left"},{title:"电站名称",dataIndex:"stationName",width:180,resizable:!0,sorter:!0,headAlign:"center",align:"left"},{title:"分期",dataIndex:"stationPeriodName",width:120,resizable:!0,sorter:!0,headAlign:"center",align:"left"},{title:"线损率(%)",dataIndex:"lineLossRate",editRow:!0,width:120,resizable:!0,sorter:!0,headAlign:"center",align:"right"},{title:"应用年度",dataIndex:"year",editRow:!0,width:120,resizable:!0,sorter:!0,headAlign:"center",align:"right"},{title:"创建人",dataIndex:"creator",width:100,resizable:!0,sorter:!0},{title:"创建时间",dataIndex:"createTime",width:200,resizable:!0,sorter:!0},{title:"修改人",dataIndex:"updater",width:100,resizable:!0,sorter:!0},{title:"修改时间",dataIndex:"updateTime",width:200,resizable:!0,sorter:!0}]}const J=n=>h.get({url:"/baseset/linelossrate/get",params:n},{}),Oe=n=>h.post({url:"/baseset/common/list-orgStationPeriodTree",params:n},{}),Ae=n=>h.get({url:"/baseset/linelossrate/page",params:n},{}),Ye=n=>h.post({url:"/baseset/linelossrate/create",params:n},{}),ee=n=>h.put({url:"/baseset/linelossrate/update",params:n},{}),Be=n=>n.id?ee(n):Ye(n),Ue=n=>h.delete({url:"/baseset/linelossrate/delete",params:n},{}),qe={class:"right-table-layout"},Ve={key:0,class:"dialog-mask"},je=xe({__name:"lineLossRateSet",setup(n){let I=u("");const{createConfirm:b}=Te(),A=M({}),L=u([]),a=u({}),m=u({}),p=u(!1),c=u(!1),_=u(!1),T=u(""),C=u(""),E=u("");let w=!1;const g=u([]),te=u([]),ae=G(),i=M({stationName:"",stationPeriodName:"",stationPeriodId:"",formState:"",year:"",lineLossRate:""}),j=u(),Y=u([]),le=()=>S(this,null,function*(){let e=yield Ae(a.value);return Y.value=e.result,re(),e.result}),ne={baseColProps:{lg:6,md:8},labelWidth:90,showAdvancedButton:!1,schemas:[{label:"应用年度",field:"year",component:"DatePicker",componentProps:{showTime:!1,format:"YYYY",valueFormat:"YYYY",picker:"year",style:"width: 100%"}}]};function ie(){p.value=!1}const[se,{reload:N,getPaginationRef:oe,clearSelectedRowKeys:re}]=Pe({title:"线损率列表",api:()=>S(this,null,function*(){const e=oe();return a.value.pageNo=e.current,a.value.pageSize=e.pageSize,yield le()}),columns:ae,useSearchForm:!0,formConfig:ne,showTableSetting:!0,pagination:{pageSize:20},bordered:!0,rowKey:"id",rowSelection:{type:"radio",onChange:ue},handleSearchInfoFn(e){return a.value.year=e.year,e},sortFn:e=>{e.order?(a.value.sortField=e.field,a.value.sortOrder=e.order.replace("end","")):(a.value.sortField=null,a.value.sortOrder=null)}});function ue(e,t){t.length>0?(g.value=[e[0]],I.value=e[0]):(g.value=[],I.value="")}function de(){return S(this,null,function*(){const e=yield Oe({});L.value=e.result,N()})}function ce(){if(i.id="",i.lineLossRate="",i.year="",w=!1,a.value.periodId==null){P.error("请先选择电站分期。");return}a.value.nodeKindId=="station"&&(B(),C.value="添加线损率-"+a.value.stationName),a.value.nodeKindId=="period"&&(B(),C.value="添加线损率-"+a.value.stationName),E.value="创建成功",p.value=!0}function pe(){H()&&(J({id:g.value[0]}).then(e=>{Z(i,e.result)}),p.value=!0,w=!1,C.value="修改线损率",E.value="修改成功")}function me(e){J({id:e.id}).then(t=>{Z(i,t.result)}),w=!0,p.value=!0,C.value="查看线损率",E.value="修改成功"}function fe(){H()&&b({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return S(this,null,function*(){Ue(g.value).then(()=>{P.success("已删除。"),N()})})}})}function ve(){j.value.validateFields().then(()=>{i.stationId=a.value.stationId,c.value=!0,Be(i).then(()=>{P.success(E.value),N(),c.value=!1,p.value=!1}).catch(()=>{c.value=!1})})}function B(){let e={stationId:m.value.stationId};$(e).then(t=>{te.value=t.result,window.ASoptions=t.result,a.value.nodeKindId=="station"?(_.value=!1,i.stationPeriodId=t.result[0].value):a.value.nodeKindId=="period"&&(i.stationPeriodId=a.value.periodId,_.value=!0)})}function he(e={}){a.value.stationId=null,a.value.searchId=null,a.value.nodeKindId=null,e&&(e.nodeKindId=="station"&&(a.value.stationId=e.powerStationId,a.value.stationName=e.name,m.value.stationId=e.powerStationId,i.stationName=e.name),e.nodeKindId=="period"&&(a.value.stationId=e.powerStationId,a.value.periodId=e.powerStationPeriodId,m.value.stationId=e.powerStationId,a.value.stationName=e.name,i.stationName=e.orgName,i.stationPeriodName=e.powerStationPeriodName),a.value.nodeKindId=e.nodeKindId,m.value.nodeKindId=e.nodeKindId,a.value.searchId=e.id),N()}function be(e){var t;m.value.stationId=e.stationId,m.value.nodeKindId="station",B(),T.value=e.key,(t=e.onEdit)==null||t.call(e,!0)}function ge(e){ee(e).then(()=>{P.success("已修改"),N()})}function Ie(e){var t;T.value="",(t=e.onEdit)==null||t.call(e,!1,!1)}function _e(e){return e.editable?[{label:"保存",onClick:ge.bind(null,e)},{label:"取消",popConfirm:{title:"是否取消修改",confirm:Ie.bind(null,e)}}]:[{label:"修改",icon:"clarity:bullet-list-line",disabled:T.value?T.value!==e.key:!1,onClick:be.bind(null,e)}]}function H(){return g.value.length==0||g.value.length>1||!g.value[0]?(P.error("请选择一行数据"),!1):!0}function we(){b({title:"导出",iconType:"warning",content:"确定要导出所有记录？",onOk(){return S(this,null,function*(){const t=u({index:"序号"}),y=G(),R=u([]),f=u([]);y.forEach(r=>{r.dataIndex!=="id"&&(r.dataIndex==="stationOrganName"&&Q().isMultiOrganization||r.dataIndex!=="stationOrganName")&&(t.value[r.dataIndex]=r.title,f.value.push(r.dataIndex))});let x=yield Fe(a.value);Y.value=x.result,Y.value.forEach(function(r,U){let k="";r.status==1?k="启用":r.status==0&&(k="禁用");let D=u({index:U+1});f.value.forEach(o=>{D.value[o]=o==="status"?k:r[o]}),R.value.push(D.value)}),ze({data:R.value,header:t.value,filename:"线损率填报.xlsx"})})}})}function ye(){$({stationId:""}).then(e=>{window.ASoptions=e.result})}return Se(()=>{de(),ye()}),(e,t)=>{const y=v("a-button"),R=v("a-input"),f=v("a-form-item"),x=v("a-col"),r=v("a-row"),U=v("a-input-number"),k=v("a-date-picker"),D=v("a-form");return V(),W(d(De),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:s(()=>[l(Ke,{title:"电站组织",onSelect:he,value:L.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),Le("div",qe,[l(d(Re),{class:"fix-basic-table",onRegister:d(se),searchInfo:A,onResizeColumn:t[0]||(t[0]=(o,q)=>q.width=o),onRowDbClick:t[1]||(t[1]=o=>me(o))},{toolbar:s(()=>[l(y,{type:"primary",preIcon:d(O).ADD,onClick:ce},{default:s(()=>[K("添加")]),_:1},8,["preIcon"]),l(y,{type:"primary",disabled:d(I)=="",preIcon:d(O).EDIT,onClick:pe},{default:s(()=>[K("修改")]),_:1},8,["disabled","preIcon"]),l(y,{class:"red-btn",disabled:d(I)=="",preIcon:d(O).DELETE,onClick:fe},{default:s(()=>[K("删除")]),_:1},8,["disabled","preIcon"]),l(y,{class:"yellow-btn",preIcon:d(O).EXPORT,onClick:we},{default:s(()=>[K("导出")]),_:1},8,["preIcon"])]),bodyCell:s(({column:o,record:q})=>[o.key==="action"?(V(),W(d(ke),{key:0,actions:_e(q)},null,8,["actions"])):X("",!0)]),_:1},8,["onRegister","searchInfo"])]),l(Ne,{visible:p.value,"onUpdate:visible":t[6]||(t[6]=o=>p.value=o),title:C.value,maskClosable:!1,onOk:ve,onCancel:ie,height:400,width:800,smode:"normal",showBtm:!d(w)},{default:s(()=>[l(D,{ref_key:"modalFormRef",ref:j,model:i,name:"userForm"},{default:s(()=>[l(r,{gutter:24},{default:s(()=>[z(l(x,{span:22},{default:s(()=>[l(f,{label:"电站名称",name:"stationName",labelCol:{style:{width:"124px"}},rules:[{required:!0}]},{default:s(()=>[l(R,{value:i.stationName,"onUpdate:value":t[2]||(t[2]=o=>i.stationName=o),disabled:"",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1},512),[[F,!0]])]),_:1}),l(r,{gutter:24},{default:s(()=>[z(l(x,{span:22},{default:s(()=>[l(f,{label:"电站分期",name:"stationPeriodName",labelCol:{style:{width:"124px"}},rules:[{required:!0}]},{default:s(()=>[l(R,{value:i.stationPeriodName,"onUpdate:value":t[3]||(t[3]=o=>i.stationPeriodName=o),disabled:"",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1},512),[[F,!0]])]),_:1}),l(r,{gutter:24},{default:s(()=>[z(l(x,{span:22},{default:s(()=>[l(f,{label:"线损率(%)",name:"lineLossRate",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请填写线损率"}]},{default:s(()=>[l(U,{value:i.lineLossRate,"onUpdate:value":t[4]||(t[4]=o=>i.lineLossRate=o),min:0,max:1e5,precision:"2",style:{width:"100%"},disabled:d(w)},null,8,["value","disabled"])]),_:1})]),_:1},512),[[F,!0]])]),_:1}),l(r,{gutter:24},{default:s(()=>[z(l(x,{span:22},{default:s(()=>[l(f,{label:"应用年度",name:"year",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请填写应用年度"}]},{default:s(()=>[l(k,{value:i.year,"onUpdate:value":t[5]||(t[5]=o=>i.year=o),"value-format":"YYYY",picker:"year",style:{width:"100%"},disabled:d(w)},null,8,["value","disabled"])]),_:1})]),_:1},512),[[F,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","showBtm"]),c.value?(V(),Ce("div",Ve)):X("",!0)]),_:1})}}});const wt=Ee(je,[["__scopeId","data-v-0c210525"]]);export{wt as default};
//# sourceMappingURL=lineLossRateSet-d27bacbb.js.map
