var ee=Object.defineProperty,te=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var z=(e,a,n)=>a in e?ee(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,j=(e,a)=>{for(var n in a||(a={}))ae.call(a,n)&&z(e,n,a[n]);if(q)for(var n of q(a))oe.call(a,n)&&z(e,n,a[n]);return e},B=(e,a)=>te(e,ne(a));var L=(e,a,n)=>new Promise((c,l)=>{var d=r=>{try{i(n.next(r))}catch(f){l(f)}},p=r=>{try{i(n.throw(r))}catch(f){l(f)}},i=r=>r.done?c(r.value):Promise.resolve(r.value).then(d,p);i((n=n.apply(e,a)).next())});import{i as O,a as ie,g as se,b as M,c as ce,P as Y,d as re,e as pe}from"./bpmn-embedded-90db6ebb.js";import{a as u,c as le,f as de}from"./index.esm-c216ed00.js";import{b as me,u as ue,e as ve}from"./index-890098c9.js";import{d as Z,al as H,Z as F,a9 as $,ag as be,aa as k,$ as N,ad as K,f as G,ac as J,R as fe,a5 as ge,u as R,ax as he,aD as ye,k as I,o as _e,_ as Ee,a7 as Ce}from"./vue-71d1abb3.js";import{c8 as xe,c9 as ke,b$ as Pe,au as we,bZ as Te}from"./index.js";import"./antd-15ac76ed.js";import"./dict-c04c0dd8.js";function Q(e){return e.originalEvent||e.srcEvent}function Se(){return/mac/i.test(navigator.platform)}function De(e,a){return(Q(e)||e).button===a}function Ae(e){return De(e,0)}function Me(e){var a=Q(e)||e;return Ae(e)?Se()?a.metaKey:a.ctrlKey:!1}function V(e,a,n,c,l,d,p,i,r,f,o,t){e=e||{},c.registerProvider(this),this._contextPad=c,this._modeling=l,this._elementFactory=d,this._connect=p,this._create=i,this._popupMenu=r,this._canvas=f,this._rules=o,this._translate=t,e.autoPlace!==!1&&(this._autoPlace=a.get("autoPlace",!1)),n.on("create.end",250,function(s){const _=s.context.shape;if(!Me(s)||!c.isOpen(_))return;const y=c.getEntries(_);y.replace&&y.replace.action.click(s,_)})}V.$inject=["config.contextPad","injector","eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate","elementRegistry"];V.prototype.getContextPadEntries=function(e){const a=this._contextPad,n=this._modeling,c=this._elementFactory,l=this._connect,d=this._create,p=this._popupMenu,i=this._canvas,r=this._rules,f=this._autoPlace,o=this._translate,t={};if(e.type==="label")return t;const s=e.businessObject;function g(m,h){l.start(m,h)}function _(){n.removeElements([e])}function y(m){const b=i.getContainer(),C=a.getPad(m).html,x=b.getBoundingClientRect(),T=C.getBoundingClientRect(),S=T.top-x.top;return{x:T.left-x.left,y:S+T.height+5}}function v(m,h,b,C){typeof b!="string"&&(C=b,b=o("Append {type}",{type:m.replace(/^bpmn:/,"")}));function x(S,D){const A=c.createShape(u({type:m},C));d.start(S,A,{source:D})}return{group:"model",className:h,title:b,action:{dragstart:x,click:f?function(S,D){const A=c.createShape(u({type:m},C));f.append(D,A)}:x}}}function w(m){return function(h,b){n.splitLane(b,m),a.open(b,!0)}}if(O(s,["bpmn:Lane","bpmn:Participant"])&&ie(s)){const m=se(e);u(t,{"lane-insert-above":{group:"lane-insert-above",className:"bpmn-icon-lane-insert-above",title:o("Add Lane above"),action:{click:function(h,b){n.addLane(b,"top")}}}}),m.length<2&&(e.height>=120&&u(t,{"lane-divide-two":{group:"lane-divide",className:"bpmn-icon-lane-divide-two",title:o("Divide into two Lanes"),action:{click:w(2)}}}),e.height>=180&&u(t,{"lane-divide-three":{group:"lane-divide",className:"bpmn-icon-lane-divide-three",title:o("Divide into three Lanes"),action:{click:w(3)}}})),u(t,{"lane-insert-below":{group:"lane-insert-below",className:"bpmn-icon-lane-insert-below",title:o("Add Lane below"),action:{click:function(h,b){n.addLane(b,"bottom")}}}})}M(s,"bpmn:FlowNode")&&(M(s,"bpmn:EventBasedGateway")?u(t,{"append.receive-task":v("bpmn:ReceiveTask","bpmn-icon-receive-task",o("Append ReceiveTask")),"append.message-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-message",o("Append MessageIntermediateCatchEvent"),{eventDefinitionType:"bpmn:MessageEventDefinition"}),"append.timer-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-timer",o("Append TimerIntermediateCatchEvent"),{eventDefinitionType:"bpmn:TimerEventDefinition"}),"append.condition-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-condition",o("Append ConditionIntermediateCatchEvent"),{eventDefinitionType:"bpmn:ConditionalEventDefinition"}),"append.signal-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-signal",o("Append SignalIntermediateCatchEvent"),{eventDefinitionType:"bpmn:SignalEventDefinition"})}):W(s,"bpmn:BoundaryEvent","bpmn:CompensateEventDefinition")?u(t,{"append.compensation-activity":v("bpmn:Task","bpmn-icon-task",o("Append compensation activity"),{isForCompensation:!0})}):!M(s,"bpmn:EndEvent")&&!s.isForCompensation&&!W(s,"bpmn:IntermediateThrowEvent","bpmn:LinkEventDefinition")&&!ce(s)&&u(t,{"append.end-event":v("bpmn:EndEvent","bpmn-icon-end-event-none",o("Append EndEvent")),"append.gateway":v("bpmn:ExclusiveGateway","bpmn-icon-gateway-none",o("Append Gateway")),"append.append-task":v("bpmn:UserTask","bpmn-icon-user-task",o("Append Task")),"append.intermediate-event":v("bpmn:IntermediateThrowEvent","bpmn-icon-intermediate-event-none",o("Append Intermediate/Boundary Event"))})),p.isEmpty(e,"bpmn-replace")||u(t,{replace:{group:"edit",className:"bpmn-icon-screw-wrench",title:"修改类型",action:{click:function(m,h){const b=u(y(h),{cursor:{x:m.x,y:m.y}});p.open(h,"bpmn-replace",b)}}}}),O(s,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference"])&&u(t,{"append.text-annotation":v("bpmn:TextAnnotation","bpmn-icon-text-annotation"),connect:{group:"connect",className:"bpmn-icon-connection-multi",title:o("Connect using "+(s.isForCompensation?"":"Sequence/MessageFlow or ")+"Association"),action:{click:g,dragstart:g}}}),O(s,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&u(t,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:o("Connect using DataInputAssociation"),action:{click:g,dragstart:g}}}),M(s,"bpmn:Group")&&u(t,{"append.text-annotation":v("bpmn:TextAnnotation","bpmn-icon-text-annotation")});let E=r.allowed("elements.delete",{elements:[e]});return le(E)&&(E=E[0]===e),E&&u(t,{delete:{group:"edit",className:"bpmn-icon-trash",title:o("Remove"),action:{click:_}}}),t};function W(e,a,n){const c=e.$instanceOf(a);let l=!1;const d=e.eventDefinitions||[];return de(d,function(p){p.$type===n&&(l=!0)}),c&&l}const Ne={__init__:["contextPadProvider"],contextPadProvider:["type",V]};function P(e,a,n,c,l,d,p,i){Y.call(this,e,a,n,c,l,d,p,i,2e3)}const U=function(){};U.prototype=Y.prototype;U.prototype.getPaletteEntries=function(){const e={},a=this._create,n=this._elementFactory,c=this._spaceTool,l=this._lassoTool,d=this._handTool,p=this._globalConnect,i=this._translate;function r(t,s,g,_,y){function v(E){const m=n.createShape(u({type:t},y));y&&(m.businessObject.di.isExpanded=y.isExpanded),a.start(E,m)}const w=t.replace(/^bpmn:/,"");return{group:s,className:g,title:_||i("Create {type}",{type:w}),action:{dragstart:v,click:v}}}function f(t){const s=n.createShape({type:"bpmn:SubProcess",x:0,y:0,isExpanded:!0}),g=n.createShape({type:"bpmn:StartEvent",x:40,y:82,parent:s});a.start(t,[s,g],{hints:{autoSelect:[g]}})}function o(t){a.start(t,n.createParticipantShape())}return u(e,{"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:"激活抓手工具",action:{click:function(t){d.activateHand(t)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:i("Activate the lasso tool"),action:{click:function(t){l.activateSelection(t)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:i("Activate the create/remove space tool"),action:{click:function(t){c.activateSelection(t)}}},"global-connect-tool":{group:"tools",className:"bpmn-icon-connection-multi",title:i("Activate the global connect tool"),action:{click:function(t){p.toggle(t)}}},"tool-separator":{group:"tools",separator:!0},"create.start-event":r("bpmn:StartEvent","event","bpmn-icon-start-event-none",i("Create StartEvent")),"create.intermediate-event":r("bpmn:IntermediateThrowEvent","event","bpmn-icon-intermediate-event-none",i("Create Intermediate/Boundary Event")),"create.end-event":r("bpmn:EndEvent","event","bpmn-icon-end-event-none",i("Create EndEvent")),"create.exclusive-gateway":r("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-none",i("Create Gateway")),"create.user-task":r("bpmn:UserTask","activity","bpmn-icon-user-task",i("Create User Task")),"create.data-object":r("bpmn:DataObjectReference","data-object","bpmn-icon-data-object",i("Create DataObjectReference")),"create.data-store":r("bpmn:DataStoreReference","data-store","bpmn-icon-data-store",i("Create DataStoreReference")),"create.subprocess-expanded":{group:"activity",className:"bpmn-icon-subprocess-expanded",title:i("Create expanded SubProcess"),action:{dragstart:f,click:f}},"create.participant-expanded":{group:"collaboration",className:"bpmn-icon-participant",title:i("Create Pool/Participant"),action:{dragstart:o,click:o}},"create.group":r("bpmn:Group","artifact","bpmn-icon-group",i("Create Group"))}),e};P.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","globalConnect","translate"];P.prototype=new U;P.prototype.constructor=P;const Ie={__init__:["paletteProvider"],paletteProvider:["type",P]},X=xe({func:void 0,bool:void 0,string:void 0,number:void 0,object:void 0,integer:void 0}),Fe={class:"flex items-center"},Re={class:"text-16px font-700"},je={class:"max-w-200px"},Be=Z({name:"ContentWrap",__name:"ContentWrap",props:{title:X.string.def(""),message:X.string.def("")},setup(e){const{getPrefixCls:a}=Pe(),n=a("content-wrap");return(c,l)=>{const d=H("Icon"),p=H("ElTooltip");return F(),$(R(ke),{class:ge([R(n),"mb-15px"]),shadow:"never"},be({default:k(()=>[N("div",null,[fe(c.$slots,"default")])]),_:2},[e.title?{name:"header",fn:k(()=>[N("div",Fe,[N("span",Re,K(e.title),1),e.message?(F(),$(p,{key:0,effect:"dark",placement:"right"},{content:k(()=>[N("div",je,K(e.message),1)]),default:k(()=>[G(d,{size:14,class:"ml-5px",icon:"ep:question-filled"})]),_:1})):J("",!0)])]),key:"0"}:void 0]),1032,["class"])}}}),He=Z({name:"BpmModelEditor",__name:"processEditor",setup(e){he();const{query:a}=ye(),n=we(),c=I(void 0),l=I(null),d=I({simulation:!0,labelEditing:!1,labelVisible:!1,prefix:"flowable",headerButtonSize:"mini",additionalModel:[Ne,Ie]}),p=I(),i=o=>{setTimeout(()=>{l.value=o},10)},r=o=>L(this,null,function*(){const t=B(j({},p.value),{bpmnXml:o});t.id?(yield ue(t),n.success("修改成功")):(yield ve(t),n.success("新增成功")),f()}),f=()=>{Te("/bpm/manage/workflow","")};return _e(()=>L(this,null,function*(){const o=a.modelId;if(!o){n.error("缺少模型 modelId 编号");return}const t=yield me(o);c.value=t.bpmnXml,p.value=B(j({},t),{bpmnXml:void 0})})),(o,t)=>(F(),Ee("div",null,[G(Be,null,{default:k(()=>[c.value!==void 0?(F(),$(R(re),Ce({key:"designer",modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=s=>c.value=s),value:c.value},d.value,{keyboard:"",ref:"processDesigner",onInitFinished:i,additionalModel:d.value.additionalModel,onSave:r}),null,16,["modelValue","value","additionalModel"])):J("",!0),G(R(pe),{key:"penal",bpmnModeler:l.value,prefix:d.value.prefix,class:"process-panel",model:p.value},null,8,["bpmnModeler","prefix","model"])]),_:1})]))}});export{He as default};
//# sourceMappingURL=processEditor-fa5cde7b.js.map
