{"version":3,"file":"combinerBoxList-d5b3ce59.js","sources":["../../src/views/monitor/PVArea/subareaOverview/combinerBoxList.vue"],"sourcesContent":["<!--\n * @Description: 分区总览-汇流箱\n * @Date: 2023-10-10 09:40:47\n * @LastEditTime: 2023-11-01 16:00:25\n * @FilePath: \\ygwl-framework\\src\\views\\monitor\\PVArea\\subareaOverview\\combinerBoxList.vue\n-->\n<template>\n  <div class=\"combiner-box-list\">\n    <div class=\"combiner-box-header\">\n      <div class=\"header-left\">\n        <div>汇流箱：{{abnormalInfo.deviceNum}}台</div>\n        <div class=\"status-checkbox-group-box\">\n          <CheckboxGroup v-model:value=\"checkedStatus\" @change=\"handleStatusChange\">\n            <Checkbox v-for=\"(item, index) in statusOptions\" :key=\"index\" :value=\"item.value\">\n            <span class=\"status-label-text\">{{item.label}}</span>\n            <span :class=\"{'red-text': item.value!=='normal'&&item.number>0}\">{{item.number}}</span>\n            </Checkbox>\n          </CheckboxGroup> \n        </div>\n        <div>组串：{{abnormalInfo.pvStringNum}}</div>\n        <div><span>电流异常：</span><span :class=\"{'red-text': abnormalInfo.abnormalCurrentNum>0}\">{{abnormalInfo.abnormalCurrentNum}}</span></div>\n      </div>\n      <div class=\"header-right\">\n        <div class=\"legend-label\">组串图例：</div>\n        <div class=\"legend-item\" v-for=\"(item, index) in legendItems\" :key=\"index\">\n          <span class=\"legend-item-icon\" :class=\"item.className\"></span>\n          <span class=\"legend-item-label\">{{item.label}}</span>\n        </div>\n      </div>\n    </div>\n    <div class=\"combiner-box-content\">\n      <div class=\"combiner-box-list-box\">\n        <DeviceItem class=\"device-item-layout\" v-for=\"(item, index) in combinerDcsData\" :key=\"index\" :options=\"deviceItemOptions\" :data=\"item\" @dblclick=\"handleOpenDeviceDialog(item)\" />\n      </div>\n    </div>\n\n    <!-- 设备弹框 -->\n    <DeviceDialog :title=\"dialogTitle\" :visible=\"dialogVisible\" :ycData=\"ycData\" :yxData=\"yxData\" @update:visible=\"dialogVisible = $event\" />\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\n  import { onMounted, reactive, ref, watch } from 'vue';\n  import { Checkbox, CheckboxGroup } from 'ant-design-vue';\n  import DeviceItem from '../../component/deviceItem.vue';\n  import DeviceDialog from './deviceDialog.vue';\n  import { getCombinerDcs, getRealTimeYc, getRealTimeYx } from '../../monitorApi.ts';\n\n  const props = defineProps({\n    stationId: String,\n    areaId: String\n  });\n\n  // 设备状态选项\n  const statusOptions = ref([\n    { label: '正常', value: 'normal', number: 0 },\n    { label: '停机', value: 'halt', number: 0 },\n    { label: '告警', value: 'alarm', number: 0 },\n    { label: '通讯中断', value: 'interrupt', number: 0 },\n  ]);\n  const checkedStatus = ref(['normal', 'halt', 'alarm', 'interrupt']);\n  const handleStatusChange = (checkedValue)=>{\n    console.log('checkedValue',checkedValue);\n    getCombinerDcsData();\n  };\n\n  const abnormalInfo = reactive({}); // 汇流箱异常数据\n  const combinerDcsData = ref([]); // 汇流箱数据\n  // 获取汇流箱数据\n  const getCombinerDcsData = async () =>{\n    let res = await getCombinerDcs({stationId: props.stationId, areaId: props.areaId, abnormalType: checkedStatus.value });\n    console.log('getCombinerDcsData', res);\n    Object.assign(abnormalInfo, res.abnormalInfo);\n    statusOptions.value[0].number = abnormalInfo.normalNum;\n    statusOptions.value[1].number = abnormalInfo.haltNum;\n    statusOptions.value[2].number = abnormalInfo.alarmNum;\n    statusOptions.value[3].number = abnormalInfo.interruptNum;\n    combinerDcsData.value = res.dataList; \n  };\n\n  // 组串图例\n  const legendItems = [\n    {\n      className: 'normal',\n      label: '正常运行',\n    },\n    {\n      className: 'offline',\n      label: '离网状态',\n    },\n    {\n      className: 'I-abnormal',\n      label: '电流异常',\n    },\n    {\n      className: 'communication-outage',\n      label: '通讯中断',\n    },\n    {\n      className: 'unconnected',\n      label: '组串未接',\n    },\n  ];\n\n  // 设备item显示内容配置\n  const deviceItemOptions = reactive({\n    deviceLabelKey: 'combinerdcESN',\n    // right: [\n    //   {\n    //     label: '电压',\n    //     unit: 'V',\n    //     dataKey: 'pvU',\n    //   },\n    //   {\n    //     label: '电流',\n    //     unit: 'A',\n    //     dataKey: 'pvI',\n    //   },\n    //   {\n    //     label: '温度',\n    //     unit: '°C',\n    //     dataKey: 'temperature'\n    //   }\n    // ],\n    // hasStatus: true,\n    left: 'combinerdcPVtotal'\n  });\n\n  watch(()=>props.areaId, (newValue)=>{\n    if(newValue) {\n      getCombinerDcsData();\n    }\n  });\n\n  // 设备弹框\n  const dialogVisible = ref(false);\n  const dialogTitle = ref('');\n\n  // 打开设备弹框\n  const handleOpenDeviceDialog = (deviceItem) => {\n    dialogVisible.value = true;\n    dialogTitle.value = deviceItem.combinerdcESN;\n    getYcData(deviceItem);\n    getYxData(deviceItem);\n  };\n\n  // 获取实时遥测数据\n  const ycData = ref([]);\n  const getYcData = async (deviceItem)=>{\n    let res = await getRealTimeYc({stationId: props.stationId, areaId: props.areaId, esn: deviceItem.combinerdcESN, dataType:3});\n    ycData.value = res;\n  };\n\n  // 获取实时遥信数据\n  const yxData = ref([]);\n  const getYxData = async (deviceItem)=>{\n    let res = await getRealTimeYx({stationId: props.stationId, areaId: props.areaId, esn: deviceItem.esn, dataType:1});\n    yxData.value = res.dataList;\n  };\n\n  onMounted(()=>{\n    // getCombinerDcsData();\n  });\n  defineExpose({statusOptions});\n</script>\n\n<style lang=\"less\" scoped>\n  .combiner-box-list {\n    .combiner-box-header {\n      display: flex;\n      justify-content: space-between;\n      padding: 0 15px;\n\n      .header-left {\n        display: flex;\n        align-items: center;\n\n        & > div {\n          margin-right: 20px;\n        }\n      }\n\n      .status-checkbox-group-box {\n        .status-label-text {\n          margin-right: 6px;\n        }\n      }\n\n      .red-text {\n        color: #ff4d4f;\n      }\n\n      .header-right {\n        display: flex;\n        align-items: center;\n\n        .legend-label {\n          margin-right: 7px;\n          font-size: 14px;\n        }\n\n        .legend-item {\n          display: flex;\n          align-items: center;\n          margin-right: 36px;\n          font-size: 12px;\n\n          &:last-child {\n            margin-right: 0;\n          }\n\n          .legend-item-icon {\n            width: 25px;\n            height: 12px;\n            margin-right: 7px;\n            background: no-repeat center / 25px 12px;\n\n            &.normal {\n              background-image: url('./images/status-legend1.png');\n            }\n\n            &.offline {\n              background-image: url('./images/status-legend3.png');\n            }\n\n            &.I-abnormal {\n              background-image: url('./images/status-legend2.png');\n            }\n\n            &.communication-outage {\n              background-image: url('./images/status-legend4.png');\n            }\n\n            &.unconnected {\n              background-image: url('./images/status-legend5.png');\n            }\n          }\n        }\n      }\n    }\n\n    .combiner-box-content {\n      .combiner-box-list-box {\n        display: flex;\n        flex-wrap: wrap;\n        margin-right: -20px;\n        padding: 20px 15px 0;\n        overflow: hidden;\n\n        .device-item-layout {\n          margin: 0 20px 16px 0;\n          // float: left;\n          cursor: pointer;\n        }\n      }\n    }\n  }\n</style>"],"names":["statusOptions","ref","checkedStatus","handleStatusChange","checkedValue","getCombinerDcsData","abnormalInfo","reactive","combinerDcsData","__async","res","getCombinerDcs","props","legendItems","deviceItemOptions","watch","newValue","dialogVisible","dialogTitle","handleOpenDeviceDialog","deviceItem","getYcData","getYxData","ycData","getRealTimeYc","yxData","getRealTimeYx","onMounted","__expose"],"mappings":"wiEAsDQA,EAAgBC,EAAI,CACxB,CAAE,MAAO,KAAM,MAAO,SAAU,OAAQ,CAAE,EAC1C,CAAE,MAAO,KAAM,MAAO,OAAQ,OAAQ,CAAE,EACxC,CAAE,MAAO,KAAM,MAAO,QAAS,OAAQ,CAAE,EACzC,CAAE,MAAO,OAAQ,MAAO,YAAa,OAAQ,CAAE,CAAA,CAChD,EACKC,EAAgBD,EAAI,CAAC,SAAU,OAAQ,QAAS,WAAW,CAAC,EAC5DE,EAAsBC,GAAe,CACjC,QAAA,IAAI,eAAeA,CAAY,EACpBC,GAAA,EAGfC,EAAeC,EAAS,CAAA,CAAE,EAC1BC,EAAkBP,EAAI,CAAA,CAAE,EAExBI,EAAqB,IAAWI,EAAA,sBACpC,IAAIC,EAAM,MAAMC,EAAe,CAAC,UAAWC,EAAM,UAAW,OAAQA,EAAM,OAAQ,aAAcV,EAAc,KAAO,CAAA,EAC7G,QAAA,IAAI,qBAAsBQ,CAAG,EAC9B,OAAA,OAAOJ,EAAcI,EAAI,YAAY,EAC5CV,EAAc,MAAM,CAAC,EAAE,OAASM,EAAa,UAC7CN,EAAc,MAAM,CAAC,EAAE,OAASM,EAAa,QAC7CN,EAAc,MAAM,CAAC,EAAE,OAASM,EAAa,SAC7CN,EAAc,MAAM,CAAC,EAAE,OAASM,EAAa,aAC7CE,EAAgB,MAAQE,EAAI,QAAA,GAIxBG,EAAc,CAClB,CACE,UAAW,SACX,MAAO,MACT,EACA,CACE,UAAW,UACX,MAAO,MACT,EACA,CACE,UAAW,aACX,MAAO,MACT,EACA,CACE,UAAW,uBACX,MAAO,MACT,EACA,CACE,UAAW,cACX,MAAO,MACT,CAAA,EAIIC,EAAoBP,EAAS,CACjC,eAAgB,gBAmBhB,KAAM,mBAAA,CACP,EAEDQ,EAAM,IAAIH,EAAM,OAASI,GAAW,CAC/BA,GACkBX,GACrB,CACD,EAGK,MAAAY,EAAgBhB,EAAI,EAAK,EACzBiB,EAAcjB,EAAI,EAAE,EAGpBkB,EAA0BC,GAAe,CAC7CH,EAAc,MAAQ,GACtBC,EAAY,MAAQE,EAAW,cAC/BC,EAAUD,CAAU,EACpBE,EAAUF,CAAU,CAAA,EAIhBG,EAAStB,EAAI,CAAA,CAAE,EACfoB,EAAmBD,GAAaX,EAAA,sBACpC,IAAIC,EAAM,MAAMc,EAAc,CAAC,UAAWZ,EAAM,UAAW,OAAQA,EAAM,OAAQ,IAAKQ,EAAW,cAAe,SAAS,EAAE,EAC3HG,EAAO,MAAQb,CAAA,GAIXe,EAASxB,EAAI,CAAA,CAAE,EACfqB,EAAmBF,GAAaX,EAAA,sBACpC,IAAIC,EAAM,MAAMgB,EAAc,CAAC,UAAWd,EAAM,UAAW,OAAQA,EAAM,OAAQ,IAAKQ,EAAW,IAAK,SAAS,EAAE,EACjHK,EAAO,MAAQf,EAAI,QAAA,GAGrB,OAAAiB,EAAU,IAAI,CAAA,CAEb,EACYC,EAAA,CAAC,cAAA5B,EAAc"}