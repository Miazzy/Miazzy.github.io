var b=(B,F,o)=>new Promise((I,r)=>{var p=l=>{try{T(o.next(l))}catch(_){r(_)}},c=l=>{try{T(o.throw(l))}catch(_){r(_)}},T=l=>l.done?I(l.value):Promise.resolve(l.value).then(p,c);T((o=o.apply(B,F)).next())});import{d as X,r as Z,k as v,w as q,e as J,o as Q,al as ee,Z as S,_ as k,$ as f,f as u,aa as E,u as m,ac as Y,E as te,v as ae,A as se}from"./vue-71d1abb3.js";import{au as oe,I as M,av as le,ay as x,_ as ie}from"./index.js";import{aG as A,aF as ne,ba as re,aC as ce,K as ue}from"./antd-15ac76ed.js";import{B as de}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as pe}from"./useTable-109483b3.js";import{_ as he}from"./EchartLineChart.vue_vue_type_style_index_0_lang-c85cdf3b.js";import{R as me,S as ve}from"./monitorApi-44e70004.js";import"./index-74ac3212.js";import{j as fe}from"./Export2Excel-389a8fc9.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./install-58e0bd81.js";import"./helper-474c7a04.js";import"./api-32c7505d.js";const _e={class:"data-detail"},ge={class:"header-box"},De={class:"header-left"},ye={class:"radio-btn-box"},be={class:"date-picker-box"},xe={key:0,class:"select-box"},Te={key:0,class:"header-right"},we={class:"content-box"},Ce={key:0,class:"chart-box"},Le={style:{"margin-top":"10px",transform:"scale(0.85)","transform-origin":"0 0"}},Se={class:"table-box"},ke=X({__name:"dataDetail",props:{tableColumns:{type:Array,default:[]},indexType:{type:Array,default:[]},esn:{type:String,default:""},echartWidth:{type:Number,default:1200},echartHeight:{type:Number,default:712}},setup(B,{expose:F}){const o=B,{createConfirm:I}=oe(),r=Z({barData:[],lineData:[],categories:[],units:[],colors:[["#078C5D","#68E4B8"],["#E59837","#FAE895"],["#078C5D","#68E4B8"]]});v([]);const p=v("chart"),c=v(),T=e=>{console.log("选择日期",e),w()},l=v([]),_=v([]),R=e=>{console.log(`selected ${e}`),l.value=e,w()},N=()=>b(this,null,function*(){g.value=g.value?g.value:o.tableColumns;let e=[];o.indexType.forEach(a=>{l.value.length==0&&l.value.push(a.addressField),e.push({label:a.addressDesc,value:a.addressField})}),_.value=e;let t=new Date;c.value=ue(x(t),"YYYY-MM-DD"),w()}),w=()=>b(this,null,function*(){var s,n,i,D,C;let e={},t=[];if(t.push(o.esn),l.value.length===0)return;e.queryFieldList=l.value,e.startDate=x(c.value),e.endDate=x(c.value),e.esns=t,e.esn=o.esn,e.dataType=1,e.isCrossTian=!1,e.sortField="timestamps",e.sortType="asc";let a=yield me(e);((s=a.hisData)==null?void 0:s.lenght)>0&&(r.lineData=(n=a.hisData[0])==null?void 0:n.dataList,r.categories=(i=a.hisData[0])==null?void 0:i.timeList,r.units=(D=a.hisData[0])==null?void 0:D.unitList,r.seriesName=(C=a.hisData[0])==null?void 0:C.zhList),O()}),O=()=>b(this,null,function*(){var s;let e={},t=[];t.push(o.esn),e.startDate=x(c.value),e.endDate=x(c.value),e.esns=t,e.esn=o.esn,e.dataType=3,e.isCrossTian=!1,e.sortField="timestamps",e.sortType="desc";let a=yield ve(e);if(((s=a.hisData)==null?void 0:s.lenght)>0){let n=a.hisData[0].timeList,i=a.hisData[0].zhList,D=a.hisData[0].enList,C=a.hisData[0].unitList,W=a.hisData[0].dataList,$=[{title:"时间",dataIndex:"time"}];if(i.length>0){for(let h=0;h<i.length;h++){let y={title:i[h]+"（"+C[h]+"）",dataIndex:D[h]};$.push(y)}g.value=$}if(n.length>0){let h=[];for(let y=0;y<n.length;y++){let z={time:n[y]};for(let L=0;L<D.length;L++)z[D[L]]=W[L][y];h.push(z)}d.value=h}H(d.value)}});function V(){I({title:"提示",iconType:"warning",content:"确定要导出所有记录？",onOk(){return b(this,null,function*(){let t={};g.value.forEach(s=>{t[s.dataIndex]=s.title});let a=[];d.value.forEach(s=>{let n={};for(let i in t)n[i]=s[i];a.push(n)}),fe({data:a,header:t,filename:"数据明细.xlsx"})})}})}const g=v([]),d=v([]),[j,{reload:Ee,reloadByDataSource:H,reloadApiDataByLocal:U}]=pe({api:()=>b(this,null,function*(){var t;const e=(t=d==null?void 0:d.value)!=null&&t.length?d==null?void 0:d.value:[];return yield U(e)}),columns:g,bordered:!0,showTableSetting:!1,rowKey:"time",pagination:{pageSize:100,pageSizeOptions:["20","50","100","200"]},tableSetting:{fullScreen:!0},dataSource:[]}),G=e=>{const t=r.units,a=r.seriesName;let s="";return e!=null&&e.length&&(s=`${x(c.value)} ${e[0].name}<br />`,e.forEach((n,i)=>{s=s+`${a[i]}：${n.value} ${t[i]}`,i<e.length-1&&(s=s+"<br />")})),s};q(()=>o.indexType,e=>{N()});const K=()=>{l.value=[]},P=J(()=>o.echartHeight?o.echartHeight*.85-85:500);return Q(()=>{N()}),F({loadChartData:w,loadBaseInfo:N,clearTarget:K}),(e,t)=>{const a=ee("a-button");return S(),k("div",_e,[f("div",ge,[f("div",De,[f("div",ye,[u(m(ne),{value:p.value,"onUpdate:value":t[0]||(t[0]=s=>p.value=s),size:"small"},{default:E(()=>[u(m(A),{value:"chart"},{default:E(()=>[u(M,{icon:"ant-design:line-chart-outlined",class:"radio-btn-icon",size:14})]),_:1}),u(m(A),{value:"table"},{default:E(()=>[u(M,{icon:"ant-design:insert-row-above-outlined",class:"radio-btn-icon",size:14})]),_:1})]),_:1},8,["value"])]),f("div",be,[u(m(re),{value:c.value,"onUpdate:value":t[1]||(t[1]=s=>c.value=s),valueFormat:"YYYY-MM-DD",onChange:T},null,8,["value"])]),p.value==="chart"?(S(),k("div",xe,[u(m(ce),{value:l.value,"onUpdate:value":t[2]||(t[2]=s=>l.value=s),mode:"multiple",style:{"min-width":"206px"},placeholder:"选择指标",options:_.value,"max-tag-count":2,showArrow:"",onChange:R},null,8,["value","options"])])):Y("",!0)]),p.value==="table"?(S(),k("div",Te,[u(a,{class:"yellow-btn",preIcon:m(le).EXPORT,onClick:V},{default:E(()=>[te("导出")]),_:1},8,["preIcon"])])):Y("",!0)]),f("div",we,[p.value==="chart"?(S(),k("div",Ce,[f("div",Le,[u(he,{data:r,width:o.echartWidth,height:o.echartHeight,smooth:!0,disableDataZoom:!1,customTooltipFormatter:G},null,8,["data","width","height"])])])):Y("",!0),ae(f("div",Se,[u(m(de),{onRegister:m(j),scroll:{y:P.value}},null,8,["onRegister","scroll"])],512),[[se,p.value==="table"]])])])}}});const it=ie(ke,[["__scopeId","data-v-08c9f9f4"]]);export{it as default};
//# sourceMappingURL=dataDetail-62a9c747.js.map
