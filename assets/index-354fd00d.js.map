{"version":3,"file":"index-354fd00d.js","sources":["../../src/views/oa/info/infonotice/index.ts","../../src/views/oa/info/infonotice/index.vue"],"sourcesContent":["import { BasicColumn, FormSchema, useRender } from '@/components/Table';\nimport { defHttp } from '@/utils/http/axios';\nimport { useUserStore } from '/@/store/modules/user';\n\nenum Api {\n  getPage = '/oa/info-notice-release/page',\n  getData = '/oa/info-notice-release/get',\n  updateStatus = '/oa/info-notice-release/update',\n  exportData = '/oa/info-notice-release/export-excel',\n  getInfoKind = '/oa/infoKind/getInfoKindByCodePreAndOrgId',\n}\n// 查询列表\nexport function getPage(params) {\n  return defHttp.get({ url: Api.getPage, params });\n}\n//查询详情\nexport function getData(params) {\n  return defHttp.get({ url: Api.getData, params });\n}\nexport function updateStatus(params) {\n  return defHttp.put({ url: Api.updateStatus, params });\n}\nexport function getInfoKind(params) {\n  return defHttp.get({ url: Api.getInfoKind, params });\n}\n// 导出\nexport function exportData(params) {\n  return defHttp.download({ url: Api.exportData, params }, { isReturnNativeResponse: true });\n}\nconst statusColor = {\n  0: '#dc0000', // 草稿\n  1: '#338ed1', // 处理中\n  2: '#30ca5a', // 通过\n  3: '#929292', // 不通过\n  4: '#929292', // 已取消\n  5: '#929292', // 已终止\n  6: '#fda941', // 退回/驳回\n};\nexport const columns: BasicColumn[] = [\n  { title: '通知主题', dataIndex: 'subject',align: 'left',headAlign:'center', width: 120,sorter: true,resizable: true },\n  { title: '信息类型', dataIndex: 'infoKindName', width: 120,sorter: true,resizable: true },\n  { title: '所在部门', dataIndex: 'deptName',align: 'left',headAlign:'center', width: 120,sorter: true,resizable: true },\n  { title: '发布时间', dataIndex: 'finishedDate', width: 120,sorter: true,resizable: true },\n  {\n    title: '流程状态',\n    dataIndex: 'statusText',\n    width: 100,sorter: true,resizable: true,\n    customRender: ({ text, record }) => {\n      return useRender.renderTag(text, statusColor[record.status]);\n    },\n  },\n  { title: '状态', dataIndex: 'bizStatusText', width: 100,sorter: true,resizable: true },\n];\nexport const searchFormSchema: FormSchema[] = [\n  { label: '通知主题', field: 'subject', component: 'Input', colProps: { span: 8 } },\n  {\n    label: '通知类型',\n    field: 'infoKindId',\n    component: 'ApiSelect',\n    componentProps: {\n      options: [],\n      api: async () =>{\n        const userCache = useUserStore() as any;\n        const orgs = userCache.userInfo.orgs;\n        let mainOrg = orgs.filter((e) => e.isMainOrg == 1)[0];\n        if (mainOrg == null) {\n          mainOrg = orgs[0];\n        }\n         let rs =await getInfoKind({type: 'infoKind', codePre: '02', orgId: mainOrg.orgId});\n        let data=[] as any;\n        for(let i=0;i<rs.result.length;i++){\n          let tmp = rs.result[i];\n          data.push({\n            value:tmp.id,\n            label:tmp.name\n          });\n        }\n        return data;\n      }\n        \n    },\n    colProps: { span: 8 },\n  },\n  {\n    field: '[startFinishedDate, endFinishedDate]',\n    label: '发布时间',\n    component: 'RangePicker',\n    colProps: { span: 8 },\n    componentProps: {\n      format: 'YYYY-MM-DD',\n      valueFormat: 'YYYY-MM-DD',\n      placeholder: ['开始日期', '结束日期'],\n    },\n  },\n  { \n    label: '状态', \n    field: 'bizStatus', \n    component: 'DictSelectBox', \n    colProps: { span: 8 },  \n    componentProps: {\n      type: 'enable_or_disable',\n    }, \n  }\n];\n","<template>\n  <PageWrapper dense contentFullHeight fixedHeight  contentClass=\"flex\" style=\"position: relative\">\n\n    <BasicTable @register=\"registerTable\"  \n    @resize-column=\"(w, col) => (col.width = w)\"\n    @selection-change=\"handleSelectChange\"\n    @row-dbClick=\"dbClick\">\n      <template #toolbar>\n        <a-button type=\"primary\" :preIcon=\"IconEnum.ADD\" @click=\"handleCreate\">\n          {{ '添加' }}\n        </a-button>\n        <a-button class=\"red-btn\" :disabled=\"selectedRowId == ''\" :preIcon=\"IconEnum.DELETE\" @click=\"handleCancel\">\n          {{ '删除' }}\n        </a-button>\n        <a-button class=\"green-btn\" :disabled=\"selectedRowId == ''\" :preIcon=\"IconEnum.ENABLE\" @click=\"handleEnable\">\n          {{ '启用' }}\n        </a-button>\n        <a-button class=\"grey-btn\" :disabled=\"selectedRowId == ''\" :preIcon=\"IconEnum.DISABLE\" @click=\"handleDisable\">\n          {{ '禁用' }}\n        </a-button>\n      </template>\n    </BasicTable>\n  </PageWrapper>\n</template>\n\n<script lang=\"ts\" setup>\n\n  import { PageWrapper } from '/@/components/Page';\n  import { IconEnum } from '@/enums/appEnum';\n  import { BasicTable, useTable,SorterResult } from '@/components/Table';\n  import { SysMessage,useMessage } from '/@/hooks/web/useMessage';\n  import { MsgManager } from '/@/message/MsgManager';\n  import { ref, onMounted } from 'vue';\n  import { deleteProcessInstance } from '@/api/bpm/processInstance';\n  import { columns, searchFormSchema, getPage,  updateStatus } from './index';\n  import { addTabPage } from '@/utils/route';\n\timport * as CommonUtil from '/@/utils/common';\n\n  const { createConfirm } = useMessage();\n  let selectedRowId = ref('');\n  const queryParam:any = ref({\n    status: '',\n    subject: '',\n    infoKindId: '',\n    startFinisheddate: '',\n    endFinisheddate: '',\n    pageNo: 1,\n    pageSize: 10,\n    sortField: 'fillinDate',\n    sortOrder: 'desc'\n  });\n\n  const handleDisable = () => {\n    let keys = getSelectRowKeys();\n    if (keys.length != 1) {\n      SysMessage.getInstance().info('请选择一行记录操作');\n      return;\n    }\n    let rows = getSelectRows();\n    if (rows[0].status != 2) {\n      SysMessage.getInstance().info('已完成得数据才能操作');\n      return;\n    }\n    updateStatus({ id: keys[0], bizStatus: 0 }).then((rsp) => {\n      if (rsp.code == 0) {\n        SysMessage.getInstance().info('禁用成功.');\n        reload();\n      } else {\n        SysMessage.getInstance().error('禁用成功.原因:' + rsp.message);\n      }\n    });\n  };\n  const handleEnable = () => {\n    let keys = getSelectRowKeys();\n    if (keys.length != 1) {\n      SysMessage.getInstance().info('请选择一行记录操作');\n      return;\n    }\n    let rows = getSelectRows();\n    if (rows[0].status != 2) {\n      SysMessage.getInstance().info('已完成得数据才能操作');\n      return;\n    }\n    updateStatus({ id: keys[0], bizStatus: 1 }).then((rsp) => {\n      if (rsp.code == 0) {\n        SysMessage.getInstance().info('启用成功.');\n        reload();\n      } else {\n        SysMessage.getInstance().error('启用成功.原因:' + rsp.message);\n      }\n    });\n  };\n\n  const [registerTable, { reload, getPaginationRef, getSelectRowKeys, getSelectRows }] = useTable({\n    title: '通知发布',\n    api: async () => {\n      const paginationRef = getPaginationRef() as any;\n      queryParam.value.pageNo = paginationRef.current;\n      queryParam.value.pageSize = paginationRef.pageSize;\n      let dataObj = await getPage(queryParam.value);\n      return dataObj.result;\n    },\n    columns,\n    rowKey: 'id',\n    bordered: true,\n    showTableSetting: true,\n    formConfig: { \n      labelWidth: 120, \n      schemas: searchFormSchema,\n      showAdvancedButton:true,\n      autoAdvancedLine:1, \n     },\n     sortFn: (sortInfo: SorterResult) => {\n      if (sortInfo.order) {\n        queryParam.value.sortField = sortInfo.field.replace('Text', '');\n        queryParam.value.sortOrder = sortInfo.order.replace('end', '');\n      } else {\n          queryParam.value.sortField = 'fillinDate';\n          queryParam.value.sortOrder = 'desc';\n        }\n    },\n    useSearchForm: true,\n    rowSelection: {\n      type: 'radio',\n      fixed: true,\n      onSelect: onSelect\n    },\n    handleSearchInfoFn(info) {\n      for (const key in info) {\n        queryParam.value[key] = info[key];\n      }\n    },\n  });\n  function onSelect(record, selected) {\n    if (selected) {\n      selectedRowId.value = record.id;\n    } else {\n      selectedRowId.value = '';\n    }\n  }\n  function handleSelectChange({ keys, rows }) {\n    if (rows && rows.length > 0) {\n      const record = rows[0];\n      selectedRowId.value = record.id;\n    } else {\n      selectedRowId.value = '';\n    }\n  }\n  function handleCreate() {\n    addTabPage(`/oa/info/infonotice/create?id=`, '添加通知发布');\n  }\n  const dbClick=(record, index, event)=>{\n    \n    handleEdit(record);\n  }\n  function handleEdit(record) {\n    // let str='';\n    // if(record.status==0){\n    //   str='修改'\n    // } else if (record.status==1){\n    //   str='审批'\n    // } else {\n    //   str='查看'\n    // }\n    CommonUtil.toFlowPage(record.id);\n    // addTabPage(\n    //   `/oa/info/infonotice/create?id=${record.id}&processInstanceId=${record.processInstanceId}`,\n    //   (str+'通知发布')\n    // );\n  }\n\n  const handleCancel = async () => {\n    let rows = getSelectRows();\n    if(rows.length != 1){\n      SysMessage.getInstance().success('请选择一行数据');\n      return;\n    }\n    let record = rows[0];\n\n    createConfirm({\n      title: '提示',\n      iconType: 'warning',\n      content: '确定要删除选中的记录？',\n      async onOk() {\n        if(record.status !=0){\n          SysMessage.getInstance().success('非草稿状态不能删除');\n          return;\n        }        \n\n        await deleteProcessInstance(record.processInstanceId);\n        SysMessage.getInstance().success('删除成功');\n        reload();\n      },\n    });\n\n  };\n  onMounted(() => {\n    MsgManager.getInstance().listen('info-notice',  ()=>{\n      reload()\n    });\n  });\n</script>\n"],"names":["getPage","params","defHttp","updateStatus","getInfoKind","statusColor","columns","text","record","useRender","searchFormSchema","__async","orgs","useUserStore","mainOrg","e","rs","data","i","tmp","createConfirm","useMessage","selectedRowId","ref","queryParam","handleDisable","keys","getSelectRowKeys","SysMessage","getSelectRows","rsp","reload","handleEnable","registerTable","getPaginationRef","useTable","paginationRef","sortInfo","onSelect","info","key","selected","handleSelectChange","rows","handleCreate","addTabPage","dbClick","index","event","handleEdit","CommonUtil.toFlowPage","handleCancel","deleteProcessInstance","onMounted","MsgManager"],"mappings":"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"}