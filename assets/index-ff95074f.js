var x=(s,e,m)=>new Promise((h,z)=>{var y=r=>{try{l(m.next(r))}catch(f){z(f)}},q=r=>{try{l(m.throw(r))}catch(f){z(f)}},l=r=>r.done?h(r.value):Promise.resolve(r.value).then(y,q);l((m=m.apply(s,e)).next())});import{B as H}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as L}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{a0 as C,a5 as I,b as U,au as W,av as X,_ as Z}from"./index.js";import{P as $}from"./index-20519caf.js";import{d as G,k as w,ax as J,u as c,o as K,r as Y,al as b,Z as R,a9 as M,aa as u,$ as N,f as d,ac as ee,E as _}from"./vue-71d1abb3.js";import{e as te}from"./download-03e71dd5.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";const ne=[{title:"所属公司",dataIndex:"stationOrganName",width:150,headAlign:"center",align:"left",resizable:!0,customCell:s=>({rowSpan:s.rowOrgSpan}),ifShow:C().isMultiOrganization},{title:"电站",dataIndex:"stationName",headAlign:"center",align:"left",width:150,resizable:!0},{title:"调度证",dataIndex:"",resizable:!0,children:[{title:"需求人数",dataIndex:"ddzMinRequirement",headAlign:"center",align:"right",width:100,resizable:!0},{title:"持证人数",dataIndex:"ddzNum",width:100,resizable:!0},{title:"持证率(%)",dataIndex:"ddz",width:100,headAlign:"center",align:"right",resizable:!0,customRender:({text:s,record:e})=>e.ddzMinRequirement!=null&&e.ddzNum!=null&&e.ddzMinRequirement!=0?e.ddzNum>=e.ddzMinRequirement?100:(e.ddzNum/e.ddzMinRequirement*100).toFixed(2):null}]},{title:"高压电工证",dataIndex:"",resizable:!0,children:[{title:"需求人数",dataIndex:"gydgzMinRequirement",headAlign:"center",align:"right",width:100,resizable:!0},{title:"持证人数",dataIndex:"gydgzNum",headAlign:"center",align:"right",width:100,resizable:!0},{title:"持证率(%)",dataIndex:"gydgz",width:100,resizable:!0,headAlign:"center",align:"right",customRender:({text:s,record:e})=>e.gydgzMinRequirement!=null&&e.gydgzNum!=null&&e.gydgzMinRequirement!=0?e.gydgzNum>=e.gydgzMinRequirement?100:(e.gydgzNum/e.gydgzMinRequirement*100).toFixed(2):null}]},{title:"安全资格证",dataIndex:"",resizable:!0,children:[{title:"需求人数",dataIndex:"aqzgzMinRequirement",headAlign:"center",align:"right",width:100,resizable:!0},{title:"持证人数",dataIndex:"aqzgzNum",headAlign:"center",align:"right",width:100,resizable:!0},{title:"持证率(%)",dataIndex:"aqzgz",width:100,headAlign:"center",align:"right",resizable:!0,customRender:({text:s,record:e})=>e.aqzgzMinRequirement!=null&&e.aqzgzNum!=null&&e.aqzgzMinRequirement!=0?e.aqzgzNum>=e.aqzgzMinRequirement?100:(e.aqzgzNum/e.aqzgzMinRequirement*100).toFixed(2):null}]},{title:"登高作业证",dataIndex:"",resizable:!0,children:[{title:"需求人数",dataIndex:"dgzyzMinRequirement",headAlign:"center",align:"right",width:100,resizable:!0},{title:"持证人数",dataIndex:"dgzyzNum",headAlign:"center",align:"right",width:100,resizable:!0},{title:"持证率(%)",dataIndex:"dgzyz",width:100,resizable:!0,headAlign:"center",align:"right",customRender:({text:s,record:e})=>e.dgzyzMinRequirement!=null&&e.dgzyzNum!=null&&e.dgzyzMinRequirement!=0?e.dgzyzNum>=e.dgzyzMinRequirement?100:(e.dgzyzNum/e.dgzyzMinRequirement*100).toFixed(2):null}]}],ae=s=>I.download({url:"/bi/personnelQualifications/qualificationsDetail/export-excel",params:s},{isReturnNativeResponse:!0}),ie={class:"fix-basic-table"},le={class:"tab-button-div"},oe={class:"tab-table-div"},se=G({__name:"index",setup(s){const{t:e}=U(),m=w([]),h=w([]),z=J(),{currentRoute:y}=z,l=c(y).query,{createConfirm:r,createMessage:f}=W();function O(){r({title:e("common.message.confirmTitle"),iconType:"warning",content:e("common.message.exportMessage"),onOk(){return x(this,null,function*(){const n=t;n.filename="人员资质统计.xls",yield ae(n).then(i=>{te(i==null?void 0:i.data,n.filename)}),n.filename=null,f.success(e("common.exportSuccessText"))})}})}K(()=>x(this,null,function*(){B(),l&&l.startDate&&(l.selectType=="station"&&(t.stationName=l.name,t.stationId=l.id),l.selectType=="company"&&(t.ognName=l.name,t.ognId=l.id),l.stationId!=null&&(t.stationId=l.stationId))}));const t=Y({ognId:null,stationId:null}),A=()=>x(this,null,function*(){let a=yield S(t);return t.stationId!=null&&(t.stationId=t.stationId.split("|"),t.stationName=t.stationName.split("|")),a}),S=a=>I.get({url:"/bi/personnelQualifications/qualificationsDetail",params:a},{isOnlyResult:!0}),T=a=>I.get({url:"/bi/common/station/info",params:a},{}),F=a=>I.get({url:"/bi/common/org/info",params:a},{});function k(a,n){a.length==0&&(t.stationId=void 0,t.stationName=void 0)}function E(a,n){t.ognName=n.value,t.ognId=n.lable}function B(){T({}).then(a=>{a.result&&a.result.length>0&&a.result.forEach(n=>{m.value.push({value:n.stationName,lable:n.id})})}),F({}).then(a=>{a.result&&a.result.length>0&&a.result.forEach(n=>{h.value.push({value:n.label,lable:n.value})})})}const[D,{getForm:re,reload:v}]=L({title:"人员资质统计",api:A,columns:ne,useSearchForm:!1,bordered:!0,pagination:!1,showIndexColumn:!1,showTableSetting:!1,tableSetting:{fullScreen:!0},afterFetch:function(a){const n={};for(let i=0;i<a.length;i++){const o=a[i];if(n[o.stationOrganId]){n[o.stationOrganId]++;continue}n[o.stationOrganId]=1}for(let i=0;i<a.length;i++){const o=a[i];for(const g in n)o.stationOrganId===g&&(o.rowOrgSpan=n[g],n[g]=0)}return a}});function P(){t.ognId=null,t.stationId=void 0,t.ognName=null,t.stationName=void 0,v()}function V(){let a=[],n=[];if(Array.isArray(t.stationName))if(t.stationName.forEach(i=>{i.option!=null&&(a.push(i.option.value),n.push(i.option.lable))}),a.length>0){let i=a.join("|"),o=n.join("|");t.stationId=o,t.stationName=i}else{let i=t.stationName.join("|"),o=t.stationId.join("|");t.stationId=o,t.stationName=i}v()}return(a,n)=>{const i=b("a-select"),o=b("a-form-item"),g=b("a-button"),j=b("a-form");return R(),M(c($),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:u(()=>[N("div",ie,[N("div",le,[d(j,{model:t,name:"searchInfo",layout:"inline",autocomplete:"off",class:"search-form"},{default:u(()=>[c(C)().isMultiOrganization?(R(),M(o,{key:0,name:"ognName",label:"所属公司",labelCol:{span:6},rules:[{required:!1,message:"请选择所属公司"}],style:{width:"26.5%"}},{default:u(()=>[d(i,{value:t.ognName,"onUpdate:value":n[0]||(n[0]=p=>t.ognName=p),"show-search":"","allow-clear":"",style:{width:"100%"},placeholder:"请选择所属公司",options:h.value,onChange:E},null,8,["value","options"])]),_:1})):ee("",!0),d(o,{name:"stationName",label:"电站",labelCol:{span:6},rules:[{required:!1,message:"请选择电站"}],style:{width:"26.5%"}},{default:u(()=>[d(i,{value:t.stationName,"onUpdate:value":n[1]||(n[1]=p=>t.stationName=p),"show-search":"","allow-clear":"",mode:"multiple",style:{width:"100%"},placeholder:"请选择电站",options:m.value,onChange:k,labelInValue:"","max-tag-count":"responsive"},null,8,["value","options"])]),_:1}),d(o,{class:"search-btns"},{default:u(()=>[d(g,{style:{margin:"0 8px"},onClick:P},{default:u(()=>[_("重置")]),_:1}),d(g,{type:"primary",class:"tab-button",onClick:V},{default:u(()=>[_("查询")]),_:1})]),_:1})]),_:1},8,["model"])]),N("div",oe,[d(c(H),{onRegister:c(D),onResizeColumn:n[2]||(n[2]=(p,Q)=>Q.width=p)},{toolbar:u(()=>[d(g,{class:"yellow-btn",preIcon:c(X).EXPORT,onClick:O},{default:u(()=>[_("导出")]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])])])]),_:1})}}});const Fe=Z(se,[["__scopeId","data-v-bff0f6e0"]]);export{Fe as default};
//# sourceMappingURL=index-ff95074f.js.map
