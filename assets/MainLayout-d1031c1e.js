var Ve=Object.defineProperty;var Xe=(x,g,n)=>g in x?Ve(x,g,{enumerable:!0,configurable:!0,writable:!0,value:n}):x[g]=n;var pe=(x,g,n)=>(Xe(x,typeof g!="symbol"?g+"":g,n),n);var te=(x,g,n)=>new Promise((T,h)=>{var M=b=>{try{S(n.next(b))}catch(t){h(t)}},$=b=>{try{S(n.throw(b))}catch(t){h(t)}},S=b=>b.done?T(b.value):Promise.resolve(b.value).then(M,$);S((n=n.apply(x,g)).next())});import{d as he,k as o,w as le,o as me,q as J,al as V,Z as p,_ as D,$ as C,f as d,aa as v,F as q,ae as de,a5 as ee,u as j,a9 as W,ac as G,E as se,ad as oe,aG as Qe,aH as ea,e as aa,ab as ta,aE as la,v as ye,A as _e,a6 as re,g as Ne,b as na,B as Ae,j as sa,r as oa}from"./vue-71d1abb3.js";import{o as ra,a0 as we,F as ca,u as ua,ad as ia,ae as De,af as da,ag as va,G as pa,I as X,_ as Ce,a7 as N,ah as fa,ai as ha,a8 as ma,a9 as Ue,a4 as Re,aj as ga,ak as ge,al as ya,am as _a,a5 as ka,an as wa,ao as Ca,a6 as Ta,aa as Ia,ap as Ma,aq as ba,ar as xa}from"./index.js";import{c as La,u as Sa,N as $a,U as Ea}from"./index-56bc5635.js";import{g as Oa}from"./index-c0893416.js";import{_ as Fa}from"./FrameBlank.vue_vue_type_script_setup_true_lang-07b1df98.js";import Ke from"./Workbench-3b43afb2.js";import{C as Aa}from"./WorkbenchHeader-c1794797.js";import{g as Da}from"./upload-27040ac3.js";import{D as Ua}from"./dict-c04c0dd8.js";import"./antd-15ac76ed.js";import"./DataBoard-11d23701.js";import"./IndexSelectDialog-0532c0db.js";import"./Dialog-0a006d82.js";import"./data-70d59c19.js";import"./QuickNav-bee1ce86.js";import"./DataSelectDialog-f9d1c1a8.js";import"./Approval-ff8e3a42.js";import"./BasicTable-0434a334.js";import"./useForm-dea3ed18.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-f4fc48e6.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./uniqBy-92d3bc7f.js";import"./index-085d06c7.js";import"./sortable.esm-4ae27e0b.js";import"./useTable-109483b3.js";import"./Schedule-729c0814.js";import"./assign-37f1c13d.js";import"./moment-4717c495.js";import"./Schedule-8e40d3ee.js";import"./Notice-42c44460.js";import"./WorkReminder-421d3e80.js";import"./default-avatar-s-529dcd14.js";const w=class w{static getInstance(){return w.instance||(w.instance=new w),w.instance}constructor(){w.taskList=[],w.showCallback=null,w.hideCallback=null}start(){window.addEventListener("visibilitychange",this.handleVisible)}end(){window.removeEventListener("visibilitychange",this.handleVisible)}handleVisible(g){var n;try{document.hidden?w.hideCallback&&w.hideCallback(g):(w.showCallback&&w.showCallback(g),((n=w==null?void 0:w.taskList)==null?void 0:n.length)>0&&(w==null||w.taskList.forEach(T=>{const{callback:h}=T;h()})))}catch(T){}}setCallback(g=()=>{},n=()=>{}){w.showCallback=g,w.hideCallback=n}pushTask(g,n=()=>{}){w.taskList.push({id:g,callback:n})}removeTask(g){w.taskList=w.taskList.filter(n=>n.id!==g)}};pe(w,"instance"),pe(w,"taskList",[]),pe(w,"showCallback"),pe(w,"hideCallback");let ke=w;const Ra=x=>(Qe("data-v-59b7f5b2"),x=x(),ea(),x),Ka={class:"app-header"},Pa=Ra(()=>C("div",{class:"logo anticon vben-app-logo light vben-layout-header-logo",style:{width:"220px"}},null,-1)),Na={class:"module-info"},Wa={class:"user-info"},za={class:"icon-element"},Ba={class:"icon-element",style:{display:"none"}},Ya={class:"icon-element",style:{cursor:"pointer"}},qa={class:"icon-element avatar-element",style:{cursor:"pointer"}},ja={class:"icon-element"},Ga=he({__name:"Header",props:{current:{type:String,default:null},modules:{type:Array,default:null}},emits:["click","change","menuclick"],setup(x,{emit:g}){const n=x,T=La(()=>ra(()=>import("./index-e4e0c122.js"),["assets/index-e4e0c122.js","assets/index-fda2d66c.js","assets/index.js","assets/vue-71d1abb3.js","assets/antd-15ac76ed.js","assets/index-19166588.css","assets/index-39b77907.css","assets/index-56bc5635.js"]),{loading:!0}),h=o([]),M=we(),$=o(""),S=o(),b=o(),t=new Map,{getHeaderTheme:y}=Sa(),{toggle:r,isFullscreen:O}=ca();O.value=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);const{prefixCls:U}=ua("layout-header");le(()=>n.modules,()=>{R()});const F=L=>{g("click",L,L.children)},R=()=>{var L;try{n.modules==null||((L=n==null?void 0:n.modules)==null?void 0:L.length)==0?h.value=M.getMenuList:h.value=n.modules,h.value&&h.value.length>0&&($.value=[h.value[0].id],J(()=>{const u=`.id__${h.value[0].id}`;document.querySelector(u).click(),K(h.value),M.setMenuNameMap(t)}))}catch(u){}},K=(L=[])=>{try{for(const u of L){const s=u!=null&&u.url.includes("?")?u==null?void 0:u.url.split("?")[0]:u==null?void 0:u.url;t.set(s,u==null?void 0:u.name),u!=null&&u.children&&(u==null?void 0:u.children.length)>0&&K(u==null?void 0:u.children)}}catch(u){}},Q=()=>{S.value=Oa({})};return me(()=>{R(),b.value=ia.getInstance(De.ONE_SECOND),b.value.pushListTask("execTodoTaskList",Q,De.ONE_HOUR),b.value.start(),ke.getInstance().start(),ke.getInstance().setCallback(()=>te(this,null,function*(){const L=yield da("");console.info("browser visibility: ",L.user_id)})),J(()=>te(this,null,function*(){const s=yield va({orgKindIds:"ogn,dpt,pos,psm",showPosition:!0,status:1});M.setOgranTree(s)}))}),(L,u)=>{const s=V("a-menu-item"),c=V("a-menu");return p(),D("header",Ka,[Pa,C("div",Na,[d(c,{selectedKeys:$.value,"onUpdate:selectedKeys":u[0]||(u[0]=i=>$.value=i),mode:"horizontal"},{default:v(()=>[(p(!0),D(q,null,de(h.value,i=>(p(),W(s,{key:i.id,iconvalue:i.icon,name:i.name,class:ee(`id__${i.id}`),onClick:A=>F(i)},{icon:v(()=>[d(X,{icon:i.icon},null,8,["icon"])]),default:v(()=>[se(" "+oe(i.name),1)]),_:2},1032,["iconvalue","name","class","onClick"]))),128))]),_:1},8,["selectedKeys"])]),C("div",Wa,[C("div",za,[d(j(pa),{class:ee([`${j(U)}-action__item `,"search-icon"])},null,8,["class"])]),C("div",Ba,[d(j($a),{class:ee(`${j(U)}-action__item notify-item notify-icon`)},null,8,["class"])]),C("div",Ya,[j(O)?G("",!0):(p(),W(X,{key:0,icon:"ant-design:fullscreen-outlined",size:"20",class:"fullscreen-icon",onClick:j(r)},null,8,["onClick"])),j(O)?(p(),W(X,{key:1,icon:"ant-design:fullscreen-exit-outlined",size:"20",class:"fullscreen-icon",onClick:j(r)},null,8,["onClick"])):G("",!0)]),C("div",qa,[d(j(Ea),{theme:j(y)},null,8,["theme"])]),C("div",ja,[d(j(T),{class:ee(`${j(U)}-action__item drawer-icon`)},null,8,["class"])])])])}}});const Za=Ce(Ga,[["__scopeId","data-v-59b7f5b2"]]),Ha=he({__name:"Menu",props:{mode:{type:String,default:"inline"},theme:{type:String,default:"light"},menus:{type:Array,default:null}},emits:["click"],setup(x,{emit:g}){const n=x,T=o([]),h=o(""),M=o(""),$=o([""]),S=o([""]),b=o("#333"),t=o(!1),y=o(""),r=o(),O=new Map,U=we(),F=o(!1);le(()=>n.menus,()=>{T.value=n.menus}),le(()=>n.theme,s=>{h.value=n.theme,b.value=s=="dark"?"#ccc":"#333"}),le(()=>n.mode,()=>{M.value=n.mode});const R=()=>{t.value=!t.value,y.value=t.value?"collapsed":"expand",t.value?N.getInstance().sendMsg("system-menu-collapse",{status:"collapsed"}):N.getInstance().sendMsg("system-menu-collapse",{status:"expand"}),y.value=="expand"&&setTimeout(()=>{y.value=""},300)},K=s=>(O.set(s==null?void 0:s.id,s),s==null?void 0:s.id),Q=s=>{let i=(s.startsWith("/")?s:"/"+s).replace("/da/","/");return i=i.startsWith(Re.BASE_HOME)?i:Re.BASE_HOME+i,i.includes("/#")?i:"/#"+i},L=s=>{const{key:c}=s,i=O.get(c),A=new Map(ma);if(i.openWindowModel==="newWindow"){const P=Q(i.url);if(A.has(P)){const Y=A.get(P)||"";Ue(Y,Y.slice(3))}else Ue(P,P.slice(3))}else g("click",c,i,s)},u=s=>{try{const c=fa(ha);if(typeof c=="undefined"||c==null||c=="")return U.logout();F.value,L(s)}catch(c){console.error("menu click error",c)}};return me(()=>{T.value=n.menus,h.value=n.theme,M.value=n.mode,N.getInstance().listen("workbench-loadover",s=>{F.value=s})}),(s,c)=>{const i=V("a-menu-item"),A=V("a-sub-menu"),P=V("a-menu"),Y=V("a-affix");return p(),D("aside",{class:ee(["app-menu",h.value+" "+y.value]),ref_key:"containerRef",ref:r},[d(P,{openKeys:$.value,"onUpdate:openKeys":c[0]||(c[0]=f=>$.value=f),selectedKeys:S.value,"onUpdate:selectedKeys":c[1]||(c[1]=f=>S.value=f),class:"menu-content",mode:M.value,theme:h.value,"inline-collapsed":t.value,onClick:u},{default:v(()=>[(p(!0),D(q,null,de(T.value,f=>(p(),D(q,{key:f.id},[f!=null&&f.visible&&(f==null?void 0:f.component)==="LAYOUT"?(p(),W(A,{key:f==null?void 0:f.id},{icon:v(()=>[d(X,{icon:f.icon,size:"16"},null,8,["icon"])]),title:v(()=>[se(oe(f.name),1)]),default:v(()=>[(p(!0),D(q,null,de(f.children,_=>(p(),D(q,null,[_!=null&&_.visible&&(_==null?void 0:_.component)!=="LAYOUT"?(p(),W(i,{key:K(_)},{default:v(()=>[se(oe(_==null?void 0:_.name),1)]),_:2},1024)):G("",!0),_!=null&&_.visible&&(_==null?void 0:_.component)==="LAYOUT"?(p(),W(A,{key:_==null?void 0:_.id,title:_==null?void 0:_.name},{default:v(()=>[(p(!0),D(q,null,de(_.children,I=>(p(),D(q,null,[I!=null&&I.visible&&(I==null?void 0:I.component)!=="LAYOUT"?(p(),W(i,{key:K(I)},{default:v(()=>[se(oe(I==null?void 0:I.name),1)]),_:2},1024)):G("",!0),I!=null&&I.visible&&(I==null?void 0:I.component)==="LAYOUT"?(p(),W(A,{key:I==null?void 0:I.id,title:I==null?void 0:I.name},{default:v(()=>[(p(!0),D(q,null,de(I.children,z=>(p(),D(q,null,[z!=null&&z.visible?(p(),W(i,{key:K(z)},{default:v(()=>[se(oe(z==null?void 0:z.name),1)]),_:2},1024)):G("",!0)],64))),256))]),_:2},1032,["title"])):G("",!0)],64))),256))]),_:2},1032,["title"])):G("",!0)],64))),256))]),_:2},1024)):f!=null&&f.visible&&(f==null?void 0:f.component)!=="LAYOUT"?(p(),W(i,{key:K(f)},{icon:v(()=>[d(X,{icon:f.icon,size:"16"},null,8,["icon"])]),default:v(()=>[se(" "+oe(f.name),1)]),_:2},1024)):G("",!0)],64))),128))]),_:1},8,["openKeys","selectedKeys","mode","theme","inline-collapsed"]),d(Y,{class:"app-menu-collClass-icon",onClick:R},{default:v(()=>[d(X,{icon:`${t.value?"gg:move-right":"gg:move-left"}`},null,8,["icon"])]),_:1})],2)}}});const Ja=Ce(Ha,[["__scopeId","data-v-c7293583"]]),Va=["url","path"],Xa=["src","panekey","pageurl"],Qa=he({name:"Frame",inheritAttrs:!1,__name:"Frame",props:{isLoadOver:{type:[String,Boolean],default:!1},isFirstPage:{type:[String,Boolean],default:!1},status:{type:[String,Boolean],default:!0},style:{type:[String,Object],default:""},url:{type:String,default:""}},emits:["loadover"],setup(x,{emit:g}){const n=x,T=[["/frame/cachepage",Fa],["/frame/workbench",Ke]],h=o(Ke),M=o(),$=o(""),S=o(),b=o(),t=new Map,y=o(""),r=o(!0),O=aa(()=>r.value?!0:!S.value||!b.value);return le(()=>n.url,()=>te(this,null,function*(){const{path:U,params:F}=ga(n.url),R=t.get(U);$.value=n.url,y.value=U,ge.getInstance().url=n.url,ge.getInstance().path=U,ge.getInstance().params=F,ge.getInstance().query=F,R?h.value=R:r.value=!1})),le(()=>n.isLoadOver,()=>{S.value=n.isLoadOver}),le(()=>n.isFirstPage,()=>{b.value=n.isFirstPage}),me(()=>{$.value=n.url,S.value=n.isLoadOver,b.value=n.isFirstPage,M.value.onload=()=>{setTimeout(()=>{g("loadover",{status:!0}),console.info("myframe 工作台 frame 加载完毕...",new Date().getTime())},1e3)},T.forEach(U=>{const[F,R]=U;typeof F=="string"&&t.set("/#"+F,R)})}),(U,F)=>(p(),D(q,null,[O.value?(p(),D("div",{key:0,id:"iframe-component",class:"iframe-component",url:$.value,path:y.value},[(p(),W(la,null,[(p(),W(ta(h.value)))],1024))],8,Va)):G("",!0),ye(C("iframe",{ref_key:"myFrame",ref:M,src:$.value,panekey:$.value,pageurl:$.value,class:ee(`${x.status?"active":"disactive"}`),style:re(n.style)},null,14,Xa),[[_e,!O.value]])],64))}}),et={class:"app-content"},at={class:"tabs-buttons"},fe="/#/frame/workbench",Pe="/#/frame/cachepage",tt=he({__name:"Content",props:{path:{type:String,default:null},menu:{type:Object,default:null},mode:{type:String,default:"single"}},emits:["change"],setup(x,{expose:g,emit:n}){const T=x,h=o(!1),M=o(!1),$=we(),S={title:"工作台",key:"workbench",closable:!1,show:!0,status:!0,pageurl:fe},b={title:"缓存",key:"cachepage",closable:!1,show:!0,status:!0,pageurl:Pe};new Date().getTime();const t=o([S]),y=new Map,r=o(t.value[0].key),O=o(""),U=o(["click"]),F=o(""),R=o(""),K=o(""),Q=o("width: 100%; height: 100%"),L=Ne(),u=o(275),s=o(!1),c=o(""),i=o(b),A=o(""),P=o(!1),Y=o(!1),f=o(),_=(e,a=null)=>te(this,null,function*(){if(console.info("handleTabChange  :",new Date().getTime()),r.value=e,a)for(let l of t.value)l.status=ue(l.pageurl)===ue(e),a&&l.status&&(l.id=a.id,r.value=l.pageurl)}),I=(e,a)=>{a==="remove"&&ce(e)},z=()=>{Q.value=P.value&&Y.value?"width: 100%; height: 100%;":"width: 100%; height: 100%; opacity: 0;"},Te=()=>{setTimeout(()=>{if(window.screen.availWidth<=1440||window.outerWidth<=1440){O.value=window.outerWidth-u.value-25+"px",F.value="",R.value="",K.value="",z();return}const e=window.screen.availWidth,a=document.body.clientWidth;a===e?(O.value=a-u.value-25+"px",F.value="",R.value="",K.value="",z()):(O.value=a-u.value-25+"px",F.value="layout-xscroll",R.value=`width: ${a-220}px;`,K.value=`width: ${a-220}px;`,z())},100)},ce=e=>{if(e=="/#/frame/workbench")return;let a=0;t.value.forEach((l,m)=>{l.pageurl===e&&(a=m-1)}),t.value=t.value.filter(l=>l.pageurl!==e),y.delete(e),t.value.length&&r.value===e&&(a>=0?r.value=t.value[a].pageurl:r.value=t.value[0].pageurl),Me(),t.value.map(l=>l.status=l.pageurl===r.value),ve()},be=e=>{let a=0,l="";t.value.forEach((m,k)=>{m.id===e&&(a=k-1,l=m.paneurl)}),t.value=t.value.filter(m=>m.id!==e),y.delete(l),t.value.length&&r.value===l&&(a>=0?r.value=t.value[a].pageurl:r.value=t.value[0].pageurl),Me(),t.value.map(m=>m.status=m.pageurl===r.value),ve()},We=e=>{let l=(e.startsWith("/")?e:"/"+e).replace("/da/","/");return l=l.startsWith("/frame")?l:"/frame"+l,l.includes("/#")?l:"/#"+l};function ze(e,a){setTimeout(()=>{const m=e.style.transform.match(/translate\((-?\d+\.?\d*px),\s*(-?\d+\.?\d*px)\)/);if(m){const k=parseFloat(m[1]),ae=parseFloat(m[2]);if(k){const B=k+a;e.style.transform=`translate(${B}px, ${ae}px)`}}},150)}const Ie=(e,a,l)=>{if(Y.value||(Y.value=!0,z()),P.value){const m=e.startsWith("/")?e:"/"+e,k=l&&(l!=null&&l.id)&&Reflect.has(l,"id")?l==null?void 0:l.id:_a(),ae=document.querySelector(".ant-tabs-nav-list");let B=m.replace("/da/","/");B=B.startsWith("/frame")?B:"/frame"+B;let E=B.includes("/#")?B:"/#"+B;if(i.value.pageurl=Pe,!Le(y,E)){const H=Se(E),Je={id:k,title:a||T.menu.name,show:!0,closable:!0,status:!0,pageurl:H};y.set(H,l||T.menu),t.value.push(Je),r.value=H}for(let H of t.value)H.key=H.key?H.key:new Date().getTime(),H.status=ue(H.pageurl)===ue(E),H.status&&(r.value=H.pageurl);ve(),ze(ae,-10)}},xe=(e,a=!1)=>{J(()=>{i.value.pageurl=e,N.getInstance().sendMsg("iframe-url-change",{url:e,loading:a})})},ne=()=>{h.value=!0;for(let e of t.value)r.value==e.pageurl&&(e.show=!1,e.key="",J(()=>{e.key=new Date().getTime(),e.show=!0,xe(Se(r.value),h.value)}),setTimeout(()=>{h.value=!1},1200))},Le=(e,a)=>!!Array.from(e.keys()).find(k=>{const ae=ue(k),B=ue(a);return ae==B}),Se=e=>{const l=`_random_=${Math.floor(Math.random()*1e7)}`;return e!=null&&e.includes("_random_")?e.replace(/_random_=[^&]*/,l):e!=null&&e.includes("?")?e+"&"+l:e+"?"+l},ue=e=>e.replace(/([\?&])_random_=[^&]*&?/,"$1").replace(/&$/,"").replace(/\?$/,""),$e=()=>{c.value==""?(s.value=!0,c.value="iframe-screen",N.getInstance().sendMsg("iframe-screen",{status:"on"})):(s.value=!1,c.value="",N.getInstance().sendMsg("iframe-screen",{status:"off"})),r.value.includes("/frame/cockpit/")&&J(()=>{ne()})},Be=e=>{for(let a of t.value)a.id===e&&(a.show=!1,a.key="",J(()=>{a.key=new Date().getTime(),a.show=!0}))},Z=e=>{const a=JSON.parse(JSON.stringify(S));a.status=!1;const l=t.value.findIndex(m=>m.pageurl===r.value);switch(e){case"now":r.value!==S.pageurl&&ce(r.value);break;case"left":t.value=t.value.filter((m,k)=>k==0||k>=l);break;case"right":t.value=t.value.slice(0,l+1);break;case"other":t.value=t.value.filter((m,k)=>k==0||k==l);break;case"all":r.value=fe,t.value=t.value.filter((m,k)=>k==0);break}y.clear(),Me(),t.value.forEach(m=>{m.status=m.pageurl===r.value,y.set(m.pageurl,m)}),ve()},ve=()=>{$.setCurrentPath(r.value),xe(r.value),n("change",r.value,y.get(r.value))},Ye=()=>{setTimeout(()=>{const e=document.querySelector(".ant-tabs-nav-list"),a=document.querySelector(".ant-tabs-nav-list .ant-tabs-ink-bar");if(e&&a){const l=e.childNodes[e.childNodes.length-2];e.removeChild(l),a.parentNode.removeChild(a)}},300)},qe=e=>{console.info("handleTabMessage:",new Date().getTime());const a=Reflect.has(e,"type")&&Reflect.has(e,"data")?e:e.data,{data:l}=a;ie(),a.type==="addTabPage"?Ie(l.path,l.name,{id:l.id}):a.type==="addTabAndClose"?(typeof l.closeID=="undefined"||l.closeID==null||l.closeID==""?ce(r.value):y.has(l.closeID)?ce(l.closeID):be(l.closeID),y.has(l.path)?(console.info("handleTabChange  :",new Date().getTime()),_(l.path,{id:l.id})):(console.info("handleNewTabPage:",new Date().getTime()),Ie(l.path,l.name,{id:l.id})),l.refresh&&ne()):a.type==="closeTabPage"?ce(l.path):a.type==="closeCurrentTab"?ce(r.value):a.type==="closeTabById"?be(l.id):a.type==="refreshTabPage"?ne():a.type==="reloadTabById"&&Be(l.id)},je=()=>{L!=null&&L.proxy?J(()=>{L==null||L.proxy.$forceUpdate(),Te()}):J(()=>{window.location.hostname==="localhost"||window.location.reload()}),r.value.includes("/frame/cockpit/")&&J(()=>{ne()})},Ge=()=>te(this,null,function*(){console.info("start loading refresh"),setTimeout(()=>{Z("all")},100)}),Ze=e=>{const{status:a}=e;a==="collapsed"?u.value=115:a==="expand"&&(u.value=275),Te(),r.value.includes("/frame/cockpit/")&&J(()=>{setTimeout(()=>{ne()},500)})},Ee=()=>{try{return window.self!==window.top}catch(e){return!0}},Oe=e=>{if(Ee())return;const{type:a}=e;a=="open"?A.value="mask-zindex":a=="remove"&&(A.value="")},ie=()=>{!t.value||t.value.length<=1?(t.value=[S],y.set(t.value[0].pageurl,t.value[0]),r.value=t.value[0].pageurl):t.value[0].pageurl!=fe&&(t.value=[S,...t.value],y.set(t.value[0].pageurl,t.value[0]),r.value=t.value[0].pageurl)},He=e=>{(e==null?void 0:e.status)===!0&&(P.value=e==null?void 0:e.status,z(),ie(),f.value.close())},Fe=e=>{if(Ee())return;const{type:a}=e;a=="open"?M.value=!0:a=="remove"&&(M.value=!1)},Me=()=>{try{ie()}catch(e){}};return le(()=>T.path,()=>{ie();const e=We(T.path);T.path!=""&&(Le(y,e)?_(e,T.menu):Ie(T.path,T.menu.name,T.menu))}),g({handleTabChange:_}),me(()=>{try{f.value=ya.service({fullscreen:!1,background:"#90909010",text:"正在加载框架..."}),y.set(t.value[0].pageurl,t.value[0]),Q.value="width: 100%; height: 100%; opacity: 0;",r.value=t.value[0].pageurl,O.value=document.body.clientWidth-u.value+"px",t.value[0].show=!1,t.value[0].pageurl="",setTimeout(()=>{t.value[0].show=!0,t.value[0].pageurl=fe,i.value.pageurl=fe},100)}catch(e){}N.getInstance().listen("iframe-tabs-message",qe),N.getInstance().listen("iframe-tabs-refresh-all",Ge),N.getInstance().listen("iframe-screen-emit",$e),N.getInstance().listen("system-menu-collapse",Ze),ve(),Te(),Ye(),s.value=!1,window.addEventListener("resize",je),N.getInstance().listen("modal-open",e=>{Oe(e),Fe(e)}),N.getInstance().listen("drawer-open",e=>{Oe(e),Fe(e)}),N.getInstance().listen("workbench-loadover",e=>{e===!0&&(P.value=e,z(),ie(),f.value.close())}),setTimeout(()=>{ie()},1e3)}),na(()=>{Y.value=!1,P.value=!1,f.value.close()}),(e,a)=>{const l=V("a-tab-pane"),m=V("a-tabs"),k=V("a-menu-item"),ae=V("a-menu"),B=V("a-dropdown");return p(),D(q,null,[(p(),W(sa,{to:"body"},[M.value?(p(),D("div",{key:0,class:"modal-mask",onMousewheel:a[1]||(a[1]=Ae(()=>{},["prevent"]))},[C("div",{class:"modal-mask-container",onMousewheel:a[0]||(a[0]=Ae(()=>{},["prevent"]))},null,32)],32)):G("",!0)])),C("main",et,[C("div",{class:ee(["vben-multiple-tabs",c.value+"-tabs"])},[ye(C("div",{class:ee(["tabs-content",c.value]),style:re(K.value)},[d(B,{trigger:["contextmenu"]},{overlay:v(()=>[d(ae,null,{default:v(()=>[d(k,null,{default:v(()=>[C("a",{onClick:ne},"重新加载")]),_:1}),d(k,null,{default:v(()=>[C("a",{onClick:a[3]||(a[3]=E=>Z("now"))},"关闭当前")]),_:1}),d(k,null,{default:v(()=>[C("a",{onClick:a[4]||(a[4]=E=>Z("left"))},"关闭左侧")]),_:1}),d(k,null,{default:v(()=>[C("a",{onClick:a[5]||(a[5]=E=>Z("right"))},"关闭右侧")]),_:1}),d(k,null,{default:v(()=>[C("a",{onClick:a[6]||(a[6]=E=>Z("other"))},"关闭其他")]),_:1}),d(k,null,{default:v(()=>[C("a",{onClick:a[7]||(a[7]=E=>Z("all"))},"关闭全部")]),_:1})]),_:1})]),default:v(()=>[d(m,{activeKey:r.value,"onUpdate:activeKey":a[2]||(a[2]=E=>r.value=E),style:re(`width: ${O.value};`),class:"vben-tabs-panes",type:"editable-card",hideAdd:"",onChange:_,onEdit:I},{default:v(()=>[(p(!0),D(q,null,de(t.value,E=>(p(),W(l,{key:E.pageurl,tab:E.title,closable:E.closable},{default:v(()=>[se(oe(E.content),1)]),_:2},1032,["tab","closable"]))),128))]),_:1},8,["activeKey","style"])]),_:1}),C("div",at,[d(X,{icon:"octicon:screen-full-24",size:"15",style:{opacity:"0",cursor:"unset"}}),d(X,{icon:"icons8:refresh",spin:h.value,size:"15",onClick:ne},null,8,["spin"]),d(B,{trigger:U.value},{overlay:v(()=>[d(ae,null,{default:v(()=>[d(k,null,{default:v(()=>[C("a",{onClick:a[8]||(a[8]=E=>Z("now"))},"关闭当前")]),_:1}),d(k,null,{default:v(()=>[C("a",{onClick:a[9]||(a[9]=E=>Z("left"))},"关闭左侧")]),_:1}),d(k,null,{default:v(()=>[C("a",{onClick:a[10]||(a[10]=E=>Z("right"))},"关闭右侧")]),_:1}),d(k,null,{default:v(()=>[C("a",{onClick:a[11]||(a[11]=E=>Z("other"))},"关闭其他")]),_:1}),d(k,null,{default:v(()=>[C("a",{onClick:a[12]||(a[12]=E=>Z("all"))},"关闭全部")]),_:1})]),_:1})]),default:v(()=>[d(X,{icon:"codicon:fold-down",size:"13"})]),_:1},8,["trigger"])])],6),[[_e,!s.value]])],2),C("div",{class:ee(["iframe-content",F.value+" "+c.value+A.value]),style:re(K.value)},[s.value?(p(),W(X,{key:0,class:"screen-icon",icon:"iconamoon:screen-normal-thin",size:"26",onClick:$e})):G("",!0),C("div",{class:"content",style:re(R.value)},[d(Qa,{onLoadover:He,isLoadOver:P.value,isFirstPage:Y.value,status:i.value.status,style:re(Q.value),url:r.value},null,8,["isLoadOver","isFirstPage","status","style","url"])],4)],6)])],64)}}});const lt=Ce(tt,[["__scopeId","data-v-0e8929e5"]]);function nt(x){return ka.get({url:"/system/parameter/get-code?code="+x},{isOnlyResult:!0})}const st={class:"main-layout"},ot={class:"main-content"},rt=he({__name:"MainLayout",setup(x){const g=Ne(),n=o(null),T=o([]),h=o(""),M=o(""),$=o(),S=o(""),b=o(""),t=oa({path:"",menu:null}),y=o(!1),r=o(!1);o("");const O=we(),U=(s,c)=>{T.value=c,n.value=s},F=(s,c,i)=>{try{M.value="",J(()=>{try{M.value=c.url,$.value=c}catch(A){console.error("menu click nexttick error:",A)}})}catch(A){console.error("menu click error:",A)}},R=(s,c)=>{try{const i=M.value.includes("/#")?M.value:"/#"+M.value;s!=i&&M.value&&(t.path=s,t.menu=c)}catch(i){console.error("tab change error",i)}},K=()=>{setTimeout(()=>{if(window.screen.availWidth<=1440||window.outerWidth<=1440){S.value="",b.value="";return}const s=window.outerWidth,c=window.screen.availWidth;s===c?(S.value="",b.value=""):(S.value="layout-xscroll",b.value=`width: ${c-220}px;`)},100)},Q=s=>{const{status:c}=s;c=="on"?y.value=!0:c=="off"&&(y.value=!1)},L=()=>te(this,null,function*(){try{const s=Ua.SYSTEM_MULTI_ORGANIZATION,c=O.getUserInfo,i=yield nt(s),A=!(i.value=="false"||i.value==!1),P=yield Ia({bizId:c==null?void 0:c.userId}),Y=Da(P[0].url);c.avatar=Y,O.setMultiOrganization(A),O.setUserInfo(c),Aa.getInstance().setCache("AVATAR",Y)}catch(s){}}),u=Ma(()=>te(this,null,function*(){ba.loading("","新版本已发版，正在重新加载框架...",1e3),yield xa(1e3),window.location.hostname==="localhost"||window.location.reload()}),5e3);return me(()=>{r.value=!0,h.value="light",window.name=window.name===""?"frame":window.name,wa(),K(),Ca(),L(),N.getInstance().listen("iframe-screen",Q),N.getInstance().listen("RELOAD_FRAMEWORK",u),window.addEventListener("resize",()=>{Ta(g,K)})}),(s,c)=>(p(),D("div",st,[r.value?(p(),D(q,{key:0},[ye(d(Za,{onClick:U},null,512),[[_e,!y.value]]),C("div",ot,[ye(d(Ja,{menus:T.value,onClick:F,theme:h.value},null,8,["menus","theme"]),[[_e,!y.value]]),d(lt,{path:M.value,menu:$.value,style:re(b.value),onChange:R},null,8,["path","menu","style"])])],64)):G("",!0)]))}});const Jt=Ce(rt,[["__scopeId","data-v-61729451"]]);export{Jt as default};
//# sourceMappingURL=MainLayout-d1031c1e.js.map
