{"version":3,"file":"inverterList-7a8d096e.js","sources":["../../src/views/monitor/PVArea/subareaOverview/inverterList.vue"],"sourcesContent":["<!--\n * @Description: 分区总览-逆变器\n * @Date: 2023-10-10 09:40:47\n * @LastEditTime: 2023-11-01 15:49:35\n * @FilePath: \\ygwl-framework\\src\\views\\monitor\\PVArea\\subareaOverview\\inverterList.vue\n-->\n<template>\n  <div class=\"inverter-list\">\n    <div class=\"inverter-header\">\n      <div class=\"header-left\">\n        <div>{{ props.typeName }}：{{ abnormalInfo.deviceNum }}台</div>\n        <div class=\"status-checkbox-group-box\">\n          <CheckboxGroup v-model:value=\"checkedStatus\" @change=\"handleStatusChange\">\n            <Checkbox v-for=\"(item, index) in statusOptions\" :key=\"index\" :value=\"item.value\">\n              <!-- v-model:checked=\"item.checked\" -->\n              <span class=\"status-label-text\">{{ item.label }}</span>\n              <span :class=\"{ 'red-text': item.value != 'normal' && item.number > 0 }\">{{\n                item.number\n              }}</span>\n            </Checkbox>\n          </CheckboxGroup>\n        </div>\n        <div v-if=\"props.deviceType == 'StringFormation' || props.deviceType == 'CombinerDc'\"\n          >组串：{{ abnormalInfo.pvStringNum }} 条</div\n        >\n        <div v-if=\"props.deviceType == 'StringFormation' || props.deviceType == 'CombinerDc'\"\n          ><span>电流异常：</span>\n          <span :class=\"{ 'red-text': abnormalInfo.abnormalCurrentNum > 0 }\">{{\n            abnormalInfo.abnormalCurrentNum\n          }}</span></div\n        >\n      </div>\n      <div\n        class=\"header-right\"\n        v-if=\"props.deviceType == 'StringFormation' || props.deviceType == 'CombinerDc'\"\n      >\n        <div class=\"legend-label\">组串图例：</div>\n        <div class=\"legend-item\" v-for=\"(item, index) in legendItems\" :key=\"index\">\n          <span class=\"legend-item-icon\" :class=\"item.className\"></span>\n          <span class=\"legend-item-label\">{{ item.label }}</span>\n        </div>\n      </div>\n    </div>\n    <div class=\"inverter-content\">\n      <div class=\"inverter-list-box\">\n        <DeviceItem\n          class=\"device-item-layout\"\n          v-for=\"(item, index) in inverterData\"\n          :key=\"index\"\n          :options=\"deviceItemOptions\"\n          :data=\"item\"\n          showSeries\n          :deviceType=\"props.deviceType\"\n          @dblclick=\"handleOpenDeviceDialog(item)\"\n        />\n      </div>\n    </div>\n\n    <!-- 设备弹框 -->\n    <DeviceDialog\n      :title=\"dialogTitle\"\n      :visible=\"dialogVisible\"\n      :ycData=\"ycData\"\n      :yxData=\"yxData\"\n      :yxTime=\"yxTime\"\n      :data=\"selectedDevice\"\n      @update:visible=\"dialogVisible = $event\"\n    />\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\n  import { onMounted, reactive, ref, watch, defineEmits, defineExpose } from 'vue';\n  import { Checkbox, CheckboxGroup } from 'ant-design-vue';\n  import DeviceItem from '../../component/deviceItem.vue';\n  import DeviceDialog from './deviceDialog.vue';\n  import { getPhotovoltaicDevice, getRealTimeYc, getRealTimeYx } from '../../monitorApi.ts';\n  import { any } from 'vue-types';\n\n  const props = defineProps({\n    stationId: String,\n    areaId: String,\n    statusOptionsIn: Array,\n    deviceType: String,\n    typeName: String,\n  });\n\n  const emit = defineEmits(['alarmItem', 'getDeviceData']);\n  // 设备状态选项\n  const alarmItem = reactive({});\n  const statusOptions = ref([]);\n  const checkedStatus = ref(['normal', 'halt', 'alarm', 'interrupt']);\n  const handleStatusChange = (checkedValue) => {\n    getDeviceData();\n  };\n\n  const abnormalInfo = reactive({}); // 逆变器异常数据\n  const inverterData = ref([]); // 逆变器数据\n  // 获取逆变器数据\n  const getDeviceData = async () => {\n    let res = await getPhotovoltaicDevice({\n      stationId: props.stationId,\n      areaId: props.areaId,\n      abnormalType: checkedStatus.value,\n      deviceType: props.deviceType,\n    });\n    if (res?.abnormalInfo) {\n      Object.assign(abnormalInfo, res.abnormalInfo);\n      let statusTemp = props.statusOptionsIn;\n      statusTemp.forEach((item) => {\n        item.number = res.abnormalInfo[item.valueRef];\n      });\n      statusOptions.value = statusTemp;\n      alarmItem.deviceType = props.deviceType;\n      alarmItem.alarmNum = abnormalInfo.alarmNum;\n      emit('alarm-item', alarmItem);\n      inverterData.value = res.dataList;\n    }\n  };\n  const selectAll = async () => {\n    checkedStatus.value = ['normal', 'halt', 'alarm', 'interrupt'];\n  };\n\n  defineExpose({ selectAll, getDeviceData });\n\n  // 组串图例\n  const legendItems = [\n    {\n      className: 'normal',\n      label: '正常运行',\n    },\n    {\n      className: 'offline',\n      label: '离网状态',\n    },\n    {\n      className: 'I-abnormal',\n      label: '电流异常',\n    },\n    {\n      className: 'communication-outage',\n      label: '通讯中断',\n    },\n    {\n      className: 'unconnected',\n      label: '组串未接',\n    },\n  ];\n\n  // 设备item显示内容配置\n  const deviceItemOptions = ref({\n    deviceLabelKey: 'deviceName',\n    // right: [\n    //   {\n    //     label: '有功功率',\n    //     unit: 'kW',\n    //     dataKey: 'activePower'\n    //   },\n    //   {\n    //     label: '日发电量',\n    //     unit: 'kWh',\n    //     dataKey: 'outputPowerDay'\n    //   },\n    //   {\n    //     label: '等效小时数',\n    //     unit: 'h',\n    //     dataKey: 'validHours'\n    //   },\n    // ],\n    left: 'pvTotal',\n  });\n\n  watch([() => props.areaId, () => props.deviceType], (newValue) => {\n    if (newValue) {\n      getDeviceData();\n    }\n  });\n  // 设备弹框\n  const dialogVisible = ref(false);\n  const dialogTitle = ref('');\n  const selectedDevice = ref({});\n\n  // 打开设备弹框\n  const handleOpenDeviceDialog = (deviceItem) => {\n    dialogVisible.value = true;\n    dialogTitle.value = deviceItem.esn;\n    selectedDevice.value = deviceItem;\n    selectedDevice.value.typeName = props.typeName;\n    getYcData(deviceItem);\n    getYxData(deviceItem);\n  };\n\n  // 获取实时遥测数据\n  const ycData = ref([]);\n  const getYcData = async (deviceItem) => {\n    let res = await getRealTimeYc({\n      stationId: props.stationId,\n      areaId: props.areaId,\n      esn: deviceItem.esn,\n      dataType: 3,\n    });\n    ycData.value = res;\n  };\n\n  // 获取实时遥信数据\n  const yxData = ref([]);\n  const yxTime = ref('');\n  const getYxData = async (deviceItem) => {\n    let res = await getRealTimeYx({\n      stationId: props.stationId,\n      areaId: props.areaId,\n      esn: deviceItem.esn,\n      dataType: 1,\n    });\n    yxData.value = res.dataList;\n    yxTime.value = res.showTimeStr;\n  };\n\n  // defineExpose({ alarmItem });\n  onMounted(() => {\n    statusOptions.value = props.statusOptionsIn;\n    getDeviceData();\n  });\n</script>\n\n<style lang=\"less\" scoped>\n  .inverter-list {\n    .inverter-header {\n      display: flex;\n      justify-content: space-between;\n      padding: 0 15px;\n\n      .header-left {\n        display: flex;\n        align-items: center;\n\n        & > div {\n          margin-right: 20px;\n        }\n      }\n\n      .status-checkbox-group-box {\n        .status-label-text {\n          margin-right: 6px;\n        }\n      }\n\n      .red-text {\n        color: #ff4d4f;\n      }\n\n      .header-right {\n        display: flex;\n        align-items: center;\n\n        .legend-label {\n          margin-right: 7px;\n          font-size: 14px;\n        }\n\n        .legend-item {\n          display: flex;\n          align-items: center;\n          margin-right: 36px;\n          font-size: 12px;\n\n          &:last-child {\n            margin-right: 0;\n          }\n\n          .legend-item-icon {\n            width: 25px;\n            height: 12px;\n            margin-right: 7px;\n            background: no-repeat center / 25px 12px;\n\n            &.normal {\n              background-image: url('./images/status-legend1.png');\n            }\n\n            &.offline {\n              background-image: url('./images/status-legend3.png');\n            }\n\n            &.I-abnormal {\n              background-image: url('./images/status-legend2.png');\n            }\n\n            &.communication-outage {\n              background-image: url('./images/status-legend4.png');\n            }\n\n            &.unconnected {\n              background-image: url('./images/status-legend5.png');\n            }\n          }\n        }\n      }\n    }\n\n    .inverter-content {\n      min-height: 488px;\n\n      .inverter-list-box {\n        display: flex;\n        flex-wrap: wrap;\n        margin-right: -20px;\n        padding: 20px 15px 0;\n        overflow: hidden;\n\n        .device-item-layout {\n          margin: 0 20px 16px 0;\n          // float: left;\n          cursor: pointer;\n        }\n      }\n    }\n  }\n</style>\n"],"names":["alarmItem","reactive","statusOptions","ref","checkedStatus","handleStatusChange","checkedValue","getDeviceData","abnormalInfo","inverterData","__async","res","getPhotovoltaicDevice","props","statusTemp","item","emit","__expose","legendItems","deviceItemOptions","watch","newValue","dialogVisible","dialogTitle","selectedDevice","handleOpenDeviceDialog","deviceItem","getYcData","getYxData","ycData","getRealTimeYc","yxData","yxTime","getRealTimeYx","onMounted"],"mappings":"iqEAyFQA,EAAYC,EAAS,CAAA,CAAE,EACvBC,EAAgBC,EAAI,CAAA,CAAE,EACtBC,EAAgBD,EAAI,CAAC,SAAU,OAAQ,QAAS,WAAW,CAAC,EAC5DE,EAAsBC,GAAiB,CAC7BC,GAAA,EAGVC,EAAeP,EAAS,CAAA,CAAE,EAC1BQ,EAAeN,EAAI,CAAA,CAAE,EAErBI,EAAgB,IAAYG,EAAA,sBAC5B,IAAAC,EAAM,MAAMC,EAAsB,CACpC,UAAWC,EAAM,UACjB,OAAQA,EAAM,OACd,aAAcT,EAAc,MAC5B,WAAYS,EAAM,UAAA,CACnB,EACD,GAAIF,GAAA,MAAAA,EAAK,aAAc,CACd,OAAA,OAAOH,EAAcG,EAAI,YAAY,EAC5C,IAAIG,EAAaD,EAAM,gBACZC,EAAA,QAASC,GAAS,CAC3BA,EAAK,OAASJ,EAAI,aAAaI,EAAK,QAAQ,CAAA,CAC7C,EACDb,EAAc,MAAQY,EACtBd,EAAU,WAAaa,EAAM,WAC7Bb,EAAU,SAAWQ,EAAa,SAClCQ,EAAK,aAAchB,CAAS,EAC5BS,EAAa,MAAQE,EAAI,QAC3B,CAAA,GAMWM,EAAA,CAAE,UAJG,IAAYP,EAAA,sBAC5BN,EAAc,MAAQ,CAAC,SAAU,OAAQ,QAAS,WAAW,CAAA,GAGrC,cAAAG,CAAA,CAAe,EAGzC,MAAMW,EAAc,CAClB,CACE,UAAW,SACX,MAAO,MACT,EACA,CACE,UAAW,UACX,MAAO,MACT,EACA,CACE,UAAW,aACX,MAAO,MACT,EACA,CACE,UAAW,uBACX,MAAO,MACT,EACA,CACE,UAAW,cACX,MAAO,MACT,CAAA,EAIIC,EAAoBhB,EAAI,CAC5B,eAAgB,aAkBhB,KAAM,SAAA,CACP,EAEKiB,EAAA,CAAC,IAAMP,EAAM,OAAQ,IAAMA,EAAM,UAAU,EAAIQ,GAAa,CAC5DA,GACYd,GAChB,CACD,EAEK,MAAAe,EAAgBnB,EAAI,EAAK,EACzBoB,EAAcpB,EAAI,EAAE,EACpBqB,EAAiBrB,EAAI,CAAA,CAAE,EAGvBsB,EAA0BC,GAAe,CAC7CJ,EAAc,MAAQ,GACtBC,EAAY,MAAQG,EAAW,IAC/BF,EAAe,MAAQE,EACRF,EAAA,MAAM,SAAWX,EAAM,SACtCc,EAAUD,CAAU,EACpBE,EAAUF,CAAU,CAAA,EAIhBG,EAAS1B,EAAI,CAAA,CAAE,EACfwB,EAAmBD,GAAehB,EAAA,sBAClC,IAAAC,EAAM,MAAMmB,EAAc,CAC5B,UAAWjB,EAAM,UACjB,OAAQA,EAAM,OACd,IAAKa,EAAW,IAChB,SAAU,CAAA,CACX,EACDG,EAAO,MAAQlB,CAAA,GAIXoB,EAAS5B,EAAI,CAAA,CAAE,EACf6B,EAAS7B,EAAI,EAAE,EACfyB,EAAmBF,GAAehB,EAAA,sBAClC,IAAAC,EAAM,MAAMsB,EAAc,CAC5B,UAAWpB,EAAM,UACjB,OAAQA,EAAM,OACd,IAAKa,EAAW,IAChB,SAAU,CAAA,CACX,EACDK,EAAO,MAAQpB,EAAI,SACnBqB,EAAO,MAAQrB,EAAI,WAAA,GAIrB,OAAAuB,EAAU,IAAM,CACdhC,EAAc,MAAQW,EAAM,gBACdN,GAAA,CACf"}