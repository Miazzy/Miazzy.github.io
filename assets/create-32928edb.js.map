{"version":3,"file":"create-32928edb.js","sources":["../../src/views/oa/info/information/create.ts","../../src/views/oa/info/information/create.vue"],"sourcesContent":["import { defHttp } from '@/utils/http/axios';\n\nenum Api {\n  //查询\n  getData = '/oa/information/get',\n  createData = '/oa/information/create',\n}\n\n// 查询\nexport function getData(params) {\n  return defHttp.get({ url: Api.getData, params });\n}\nexport function createData(params) {\n  return defHttp.post({ url: Api.createData, params });\n}\n","<template>\n<PageWrapper dense contentFullHeight fixedHeight  contentClass=\"flex\" style=\"position: relative\">\n\t<a-spin :spinning=\"formState.spinning\" tip=\"Loading...\">\n    <div class=\"process-box\">\n      <div class=\"header-box\">\n          <div class=\"header-left\">资讯发布</div>\n          <div v-if=\"!disabledInput\" class=\"header-right\">\n            <a-button type=\"default\" style=\"margin-right: 10px;\" @click=\"handleCancel\"  v-if=\"readonly!=1\" >{{ '取消' }}</a-button>\n            <a-button type=\"primary\"   @click=\"onFinish\"  :loading=\"formState.spinning\"\n              v-if=\"readonly!=1\"\n                > {{ '保存' }}</a-button>\n            <!-- <PrintButton style=\"margin-left: 10px\" v-if=\"formState.id !='' \" /> -->\n          </div>\n        </div>\n      <div class=\"content\">\n          <a-form\n            ref=\"basicRef\"\n            name=\"basic\"\n            :model=\"formState\"\n            autocomplete=\"off\"\n          >\n          <a-card title=\"基本信息\" :bordered=\"false\">\n\n            <a-row :gutter=\"32\">\n              <a-col :span=\"24\">\n                <a-form-item\n                  label=\"主题\"\n                  name=\"subject\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: true, message: '主题不能为空' }]\"\n                >\n                  <a-input v-model:value=\"formState.subject\" maxlength=\"128\" :disabled=\"disabledInput\"/>\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"24\">\n                <a-form-item\n                  label=\"信息类别\"\n                  name=\"type\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: true, message: '信息类别不能为空' }]\"\n                >\n                  <DictSelectBox\n                    v-model:value=\"formState.type\"\n                    :type=\"`information_type`\"\n                    :style=\"`width: 100%`\"\n                    :disabled=\"disabledInput\"\n                  />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"24\">\n                <a-form-item\n                  label=\"信息来源\"\n                  name=\"source\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: true, message: '信息来源不能为空' }]\"\n                >\n                  <DictSelectBox\n                    v-model:value=\"formState.source\"\n                    :type=\"`information_source`\"\n                    :style=\"`width: 100%`\"\n                    :disabled=\"disabledInput\"\n                  />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"24\" v-if=\"formState.source == 1\">\n                <a-form-item\n                  label=\"URL地址\"\n                  name=\"url\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: formState.source == 1, message: 'URL地址不能为空' }]\"\n                >\n                  <a-input v-model:value=\"formState.url\" maxlength=\"256\" :disabled=\"disabledInput\"/>\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"24\">\n                <a-form-item\n                  label=\"发布人\"\n                  name=\"publisher\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: true, message: '发布人不能为空' }]\"\n                >\n                  <a-input v-model:value=\"formState.publisher\" maxlength=\"32\" :disabled=\"disabledInput\"/>\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"24\">\n                <a-form-item\n                  label=\"发布日期\"\n                  name=\"publishedDate\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: true, message: '发布日期不能为空' }]\"\n                >\n                  <a-date-picker\n                    v-model:value=\"formState.publishedDate\"\n                    valueFormat=\"YYYY-MM-DD\"\n                    style=\"width: 100%\"\n                    :disabled=\"disabledInput\"\n                  />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"24\">\n                <a-form-item\n                  label=\"备注\"\n                  name=\"remark\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: false, message: '备注不能为空' }]\"\n                >\n                  <a-textarea\n                    :rows=\"3\"\n                    v-model:value=\"formState.remark\"\n                    placeholder=\"512字以内\"\n                    :maxlength=\"512\"\n                    show-count\n                    :disabled=\"disabledInput\"\n                  />\n                </a-form-item>\n              </a-col>\n            </a-row>\n          </a-card>\n          <a-card title=\"正文\" v-show=\"formState.source == 2\" :bordered=\"false\">\n            <Tinymce\n                  v-model=\"formState.content\"\n                  :width=\"`calc(99%)`\"\n                  :height=\"300\"\n                  :maxChars=\"20000\"\n                  :disabled=\"disabledInput\"\n                />     \n          </a-card>\n          <a-card title=\"附件上传\" :bordered=\"false\" :style=\"caclStyle\">\n            <UploadBox\n              :width=\"800\"\n              :height=\"550\"\n              :maxCount=\"20\"\n              :maxSize=\"100 * 1024 * 1024\"\n              :application=\"`oa`\"\n              :module=\"`information`\"\n              :vmode=\"`box`\"\n              :bizId=\"formState.bizFileId\"\n            />\n          </a-card>\n        </a-form>\n\n      </div>\n    </div>\n</a-spin>\n</PageWrapper>\n</template>\n<script lang=\"ts\" setup>\n  import { PageWrapper } from '/@/components/Page';\n  import { reactive, ref, onMounted,toRaw,computed  } from 'vue';\n  import { SysMessage } from '/@/hooks/web/useMessage';\n  import { MsgManager } from '/@/message/MsgManager';\n  import { Tinymce } from '/@/components/Tinymce/index';\n  import { createData, getData } from './create';\n  // import PrintButton from '/@/components/Framework/Button/PrintButton.vue';\n  import DictSelectBox from '@/components/Framework/Combox/DictSelectBox.vue';\n  import { closeCurrentTab } from '@/utils/route';\n  import UploadBox from '@/components/Framework/Combox/UploadBox.vue';\n  import { buildShortUUID } from '@/utils/uuid';\n  import { urlToPath } from '/@/utils/route';\n  import { useUserStore } from '/@/store/modules/user';\n\n\n  const userStore = useUserStore();\n  const userInfo = toRaw(userStore.getUserInfo);\n  \n  const basicRef = ref();\n  let {params} = urlToPath() as any;\n\n\n  const caclStyle=computed(()=>{\n    return formState.source == 2?'':'height:calc(41vh)'\n  });\n  const readonly=ref(params.readonly)\n  const formState: any = reactive({\n    id: params.id || '',\n    spinning:false,\n    personMemberId:'',\n    status:1,\n  });\n  const disabledInput=computed(()=>{\n    return false;\n  })\n\n  const onFinish = () => {\n    basicRef.value.validate().then(() => {\n      formState.spinning=true;\n      createData(formState)\n        .then((rsp) => {\n          if (rsp.result != '') {\n            formState.id = rsp.result;\n            SysMessage.getInstance().success('保存成功');\n            MsgManager.getInstance().sendMsg('oa-information', {});\n          } else {\n            SysMessage.getInstance().error('保存失败.');\n          }\n          formState.spinning=false;\n        })\n        .catch((e) => {\n          formState.spinning=false;\n          formState.status = 1;\n          console.log(e);\n        });\n    });\n  };\n  const handleCancel = () => {\n    closeCurrentTab();\n    MsgManager.getInstance().sendMsg('oa-information', {});\n  };\n\n  // global\n  onMounted(async () => {\n\n    if (formState.id) {\n      getData({ id: formState.id }).then((rsp) => {\n        let rs = rsp.result;\n        for (let key in rs) {\n          formState[key] = rs[key];\n        }\n        formState.status = Number(formState.status);\n        if(formState.status==0 && \n          formState.personMemberId.substring(0,32) != userInfo.userId){\n\n        }\n      });\n    } else {\n      formState.status = 1;\n      formState.bizFileId = buildShortUUID();\n    }\n    if(readonly.value == 1){\n\n    }\n  });\n</script>\n\n<style >\n.content{\n  margin: 10px;\n}\n</style>"],"names":["getData","params","defHttp","createData","userStore","useUserStore","userInfo","toRaw","basicRef","ref","urlToPath","caclStyle","computed","formState","readonly","reactive","disabledInput","onFinish","rsp","SysMessage","MsgManager","e","handleCancel","closeCurrentTab","onMounted","__async","rs","key","buildShortUUID"],"mappings":"yyBASO,SAASA,GAAQC,EAAQ,CAC9B,OAAOC,EAAQ,IAAI,CAAE,IAAK,sBAAa,OAAAD,EAAQ,CACjD,CACO,SAASE,GAAWF,EAAQ,CACjC,OAAOC,EAAQ,KAAK,CAAE,IAAK,yBAAgB,OAAAD,EAAQ,CACrD,wLCoJE,MAAMG,EAAYC,IACZC,EAAWC,EAAMH,EAAU,WAAW,EAEtCI,EAAWC,IACb,GAAA,CAAC,OAAAR,GAAUS,IAGT,MAAAC,EAAUC,EAAS,IAChBC,EAAU,QAAU,EAAE,GAAG,mBACjC,EACKC,EAASL,EAAIR,EAAO,QAAQ,EAC5BY,EAAiBE,EAAS,CAC9B,GAAId,EAAO,IAAM,GACjB,SAAS,GACT,eAAe,GACf,OAAO,CAAA,CACR,EACKe,EAAcJ,EAAS,IACpB,EACR,EAEKK,EAAW,IAAM,CACrBT,EAAS,MAAM,SAAW,EAAA,KAAK,IAAM,CACnCK,EAAU,SAAS,GACnBV,GAAWU,CAAS,EACjB,KAAMK,GAAQ,CACTA,EAAI,QAAU,IAChBL,EAAU,GAAKK,EAAI,OACRC,EAAA,YAAA,EAAc,QAAQ,MAAM,EACvCC,EAAW,YAAY,EAAE,QAAQ,iBAAkB,CAAE,CAAA,GAE1CD,EAAA,YAAA,EAAc,MAAM,OAAO,EAExCN,EAAU,SAAS,EAAA,CACpB,EACA,MAAOQ,GAAM,CACZR,EAAU,SAAS,GACnBA,EAAU,OAAS,EACnB,QAAQ,IAAIQ,CAAC,CAAA,CACd,CAAA,CACJ,CAAA,EAEGC,EAAe,IAAM,CACTC,IAChBH,EAAW,YAAY,EAAE,QAAQ,iBAAkB,CAAE,CAAA,CAAA,EAIvD,OAAAI,EAAU,IAAYC,EAAA,sBAEhBZ,EAAU,GACJb,GAAA,CAAE,GAAIa,EAAU,EAAA,CAAI,EAAE,KAAMK,GAAQ,CAC1C,IAAIQ,EAAKR,EAAI,OACb,QAASS,KAAOD,EACJb,EAAAc,CAAG,EAAID,EAAGC,CAAG,EAEfd,EAAA,OAAS,OAAOA,EAAU,MAAM,EACvCA,EAAU,QAAQ,GACnBA,EAAU,eAAe,UAAU,EAAE,EAAE,GAAKP,EAAS,MAEvD,CACD,GAEDO,EAAU,OAAS,EACnBA,EAAU,UAAYe,KAErBd,EAAS,OAAS,CAErB,EACD"}