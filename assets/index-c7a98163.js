var c=(r,a,o)=>new Promise((d,p)=>{var x=s=>{try{u(o.next(s))}catch(m){p(m)}},I=s=>{try{u(o.throw(s))}catch(m){p(m)}},u=s=>s.done?d(s.value):Promise.resolve(s.value).then(x,I);u((o=o.apply(r,a)).next())});import{a5 as w,b as H,au as V,a7 as K,av as f,ax as W,az as q,at as b,aA as X}from"./index.js";import{P as Z}from"./index-20519caf.js";import{B as G}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as J}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{e as Q}from"./download-03e71dd5.js";import"./index-316f6ffb.js";import{u as T}from"./useRender-21ce56fb.js";import{d as U,k as _,o as $,al as ee,x as te,Z as k,a9 as y,aa as i,f as h,u as l,E as g,ad as v,v as D}from"./vue-71d1abb3.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";function ae(r){return w.get({url:"/po/safe-check-template/page",params:r})}function oe(r){let a="";for(const o in r)a+=o+"="+r[o]+"&";return w.put({url:"/po/safe-check-template/updateStatus?"+a})}function ne(r){return w.download({url:"/po/safe-check-template/export-excel",params:r},{isReturnNativeResponse:!0})}const re={0:"#dc0000",1:"#338ed1",2:"#30ca5a",3:"#929292",4:"#929292",5:"#929292",6:"#fda941"},se=[{title:"单据编号",dataIndex:"billCode",width:165,sorter:!0,resizable:!0},{title:"主题",dataIndex:"subject",align:"left",headAlign:"center",width:200,sorter:!0,resizable:!0},{title:"检查类型",dataIndex:"checkTypeText",width:165,sorter:!0,resizable:!0},{title:"检查频率",dataIndex:"checkPeriodText",width:165,sorter:!0,resizable:!0},{title:"设置日期",dataIndex:"validDate",width:165,customRender:({text:r})=>T.renderDate(r,"YYYY-MM-DD"),sorter:!0,resizable:!0},{title:"审批状态",dataIndex:"statusText",width:130,customRender:({text:r,record:a})=>T.renderTag(r,re[a.status]),sorter:!0,resizable:!0},{title:"模板状态",dataIndex:"bizStatusText",width:130,sorter:!0,resizable:!0},{title:"创建人",dataIndex:"personMemberName",width:130,sorter:!0,resizable:!0},{title:"创建时间",dataIndex:"fillinDate",sorter:!0,resizable:!0}],le=[{label:"单据编号",field:"billCode",component:"Input",colProps:{span:8}},{label:"主题",field:"subject",component:"Input",colProps:{span:8}},{label:"检查类型",field:"checkType",component:"DictSelectBox",componentProps:{type:"check_type"},colProps:{span:8}},{label:"审批状态",field:"status",component:"DictSelectBox",componentProps:{type:"bpm_process_instance_result"},colProps:{span:8}}],Me=U({name:"SafeCheckTemplate",__name:"index",setup(r){const a=_({status:"",checkType:"",subject:"",billCode:"",pageNo:1,pageSize:10,sortField:"fillinDate",sortOrder:"desc"});let o=_("");const{t:d}=H(),{createConfirm:p,createMessage:x}=V(),[I,{getForm:u,reload:s,getSelectRowKeys:m,getSelectRows:P,getPaginationRef:z}]=J({title:"安全检查模板",api:()=>c(this,null,function*(){const e=z();return a.value.pageNo=e.current,a.value.pageSize=e.pageSize,(yield ae(a.value)).result}),columns:se,rowKey:"id",bordered:!0,formConfig:{labelWidth:120,schemas:le,showAdvancedButton:!0,autoAdvancedLine:1},sortFn:e=>{e.order?(a.value.sortField=e.field.replace("Text",""),a.value.sortOrder=e.order.replace("end","")):(a.value.sortField="fillinDate",a.value.sortOrder="desc")},useSearchForm:!0,showTableSetting:!0,rowSelection:{type:"radio",fixed:!0,onSelect:E},handleSearchInfoFn(e){for(const t in e)a.value[t]=e[t]}}),R=(e,t,n)=>{B(e)};function E(e,t){t?o.value=e.id:o.value=""}function F({keys:e,rows:t}){if(t&&t.length>0){const n=t[0];o.value=n.id}else o.value=""}function M(){W("/po/safety/safechecktemplate/create?id=","添加安全检查模板")}function B(e){q(e.id)}const O=()=>{C(0)},j=()=>{C(1)},C=e=>{let t=m();oe({ids:t.join(","),status:e}).then(n=>{n.code==0?b.getInstance().info(e=="1"?"启用成功":"禁用成功"):b.getInstance().error(n.message),s()})},A=()=>c(this,null,function*(){let e=P();if(e.length!=1){b.getInstance().success("请选择一行数据");return}let t=e[0];p({title:"提示",iconType:"warning",content:"确定要删除选中的记录？",onOk(){return c(this,null,function*(){if(t.status!=0){b.getInstance().success("非草稿状态不能删除");return}yield X(t.processInstanceId),b.getInstance().success("删除成功"),s()})}})});function N(){return c(this,null,function*(){p({title:d("common.exportTitle"),iconType:"warning",content:d("common.exportMessage"),onOk(){return c(this,null,function*(){let t=u().getFieldsValue();Object.assign(t,a.value),yield ne(t).then(n=>{Q(n==null?void 0:n.data,"安全检查模板.xls")}),x.success(d("common.exportSuccessText"))})}})})}return $(()=>{K.getInstance().listen("safe-check-template",()=>{s()})}),(e,t)=>{const n=ee("a-button"),S=te("auth");return k(),y(l(Z),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:i(()=>[h(l(G),{onRegister:l(I),onResizeColumn:t[0]||(t[0]=(L,Y)=>Y.width=L),onRowDbClick:R,onSelectionChange:F},{toolbar:i(()=>[h(n,{type:"primary",preIcon:l(f).ADD,onClick:M},{default:i(()=>[g(v("添加"))]),_:1},8,["preIcon"]),h(n,{class:"red-btn",disabled:l(o)=="",preIcon:l(f).DELETE,onClick:A},{default:i(()=>[g(v("删除"))]),_:1},8,["disabled","preIcon"]),h(n,{class:"yellow-btn",preIcon:l(f).EXPORT,onClick:N},{default:i(()=>[g(v("导出"))]),_:1},8,["preIcon"]),D((k(),y(n,{class:"green-btn",disabled:l(o)=="",preIcon:l(f).ENABLE,onClick:j},{default:i(()=>[g("启用")]),_:1},8,["disabled","preIcon"])),[[S,"po:safechecktemplate:enable"]]),D((k(),y(n,{class:"grey-btn",disabled:l(o)=="",preIcon:l(f).DISABLE,onClick:O},{default:i(()=>[g("禁用")]),_:1},8,["disabled","preIcon"])),[[S,"po:safechecktemplate:disabled"]])]),_:1},8,["onRegister"])]),_:1})}}});export{Me as default};
//# sourceMappingURL=index-c7a98163.js.map
