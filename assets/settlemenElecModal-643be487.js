var le=Object.defineProperty;var F=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var q=(b,e,o)=>e in b?le(b,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):b[e]=o,B=(b,e)=>{for(var o in e||(e={}))se.call(e,o)&&q(b,o,e[o]);if(F)for(var o of F(e))ne.call(e,o)&&q(b,o,e[o]);return b};var C=(b,e,o)=>new Promise((E,k)=>{var P=g=>{try{_(o.next(g))}catch(D){k(D)}},u=g=>{try{_(o.throw(g))}catch(D){k(D)}},_=g=>g.done?E(g.value):Promise.resolve(g.value).then(P,u);_((o=o.apply(b,e)).next())});import{d as oe,r as T,k as y,ax as re,u as R,o as ie,al as f,Z as A,_ as ue,f as t,aa as l,$ as N,a9 as de,ac as K,v as p,A as m}from"./vue-71d1abb3.js";import{b as $,d as pe,v as V,h as me,s as ce}from"./settlementElectricity-079df1e5.js";import{W as fe}from"./WfApproveBox-a3448232.js";import{a0 as be,ak as ve,aB as _e,bP as ge,a7 as he,aC as Ie}from"./index.js";import{B as Ce}from"./BillTitle-d17ab3e4.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import{a2 as ye}from"./antd-15ac76ed.js";import"./index-316f6ffb.js";import"./index-085d06c7.js";import{u as ke}from"./useTable-109483b3.js";import{_ as De}from"./UploadTable.vue_vue_type_script_setup_true_lang-5478923e.js";import{a as w}from"./assign-37f1c13d.js";import"./useRender-21ce56fb.js";import"./index.esm-c216ed00.js";import"./index-fda2d66c.js";import"./BasicTable-0434a334.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./useWindowSizeFn-13b1b8a2.js";import"./OrganDialog-dd1023ce.js";import"./Dialog-0a006d82.js";import"./index-c0893416.js";import"./index-33af41d1.js";import"./tree-fc0e156a.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";const we={class:"load"},Ne={class:"process-box"},Ee={class:"header-box"},Pe={class:"content"},xe={style:{margin:"5px 16px 20px 10px"}},pt=oe({__name:"settlemenElecModal",setup(b){const e=T({spinning:!1}),E=be().getUserInfo,k=y([]),P=y(),u=y(!0),_=T({});_.subject="结算电量",_.infoItems=[];const g=re(),{currentRoute:D}=g;R(D);const v=ve.getInstance().getQuery(),x=y();let M=y();function j(s,a){e.settlePartyName=a.label,e.settlePartyId=a.value}const L=s=>{const a=["电费结算单","结算发票","发票回执"],c=["electricity","invoice","receipt"],r={fileKindId:"",filetype:"",bizId:s,maxCount:20,maxSize:20971520,required:!1,readonly:!0},i=[];for(let d=0;d<3;d++){let h=B({},r);h.fileKindId=c[d],h.filetype=a[d],h.readonly=u.value,i.push(h)}k.value=i};function z(s){e.spinning=!0;try{s=s||0,x.value.validateFields().then(()=>{e.status=s,ce(e).then(a=>{e.id=a,$({id:a}).then(c=>{w(e,c.result)}),ye.success(s==1?"提交成功。":"保存成功"),he.getInstance().sendMsg("settlementElectricity",{}),s==1&&(u.value=!0,Ie())})})}catch(a){console.log("error",a)}finally{e.spinning=!1}}function O(){V(e).then(s=>{z(1)})}function Q(){V(e).then(s=>{z(0)})}function U(){me(e).then(s=>{e.genElec=s.result.genElec,e.onlineElec=s.result.onlineElec,e.desulphurizePrice=s.result.desulphurizePrice})}function S(){e.settlementCost&&e.settlementElec&&(e.settlementPrice=parseFloat(e.settlementCost/e.settlementElec).toFixed(6))}w(e,{processInstanceId:"",id:"",billCode:"",fillinDate:"",organId:"",organName:"",deptId:"",deptName:"",positionId:"",positionName:"",personMemberId:"",personMemberName:"",fullId:"",status:0,bizFileId:"",subject:"",finishedDate:"",startDate:"",endDate:"",genElec:"",onlineElec:"",desulphurizePrice:"",settlePartyId:"",settlePartyName:"",settlementElec:"",settlementCost:"",settlementPrice:"",remark:""}),ie(()=>C(this,null,function*(){v.id=yield Z(),yield $({id:v.id}).then(s=>{v.id?(w(e,s.result),e.status==0&&e.personMemberId.substring(0,32)!=E.userId&&(e.status=10)):(w(e,v),e.spinning=!1,e.status=0,e.billCode=s.result.billCode,e.personMemberName=s.result.personMemberName,e.fillinDate=s.result.fillinDate,e.deptName=s.result.deptName),e.status==1&&(u.value=!0)}),v.id||(u.value=!1),yield G(),pe({stationId:e.stationId}).then(s=>{M.value=s.result}),e.bizFileId==null||e.bizFileId==null||e.bizFileId==""?H():Y()}));const Z=()=>C(this,null,function*(){let s=v.id;if(!s&&v.processInstanceId){const c=(yield _e(v.processInstanceId)).businessKey;v.id=c,s=c}return s}),G=()=>C(this,null,function*(){u.value=e.status!=0,_.title="结算电量",e.processInstanceId=v.processInstanceId;let{billCode:s,fillinDate:a,personMemberName:c,deptName:r}=e;w(_,{billCode:s,fillinDate:a,personMemberName:c,deptName:r})}),H=()=>C(this,null,function*(){ge().then(s=>{e.bizFileId=s,Y()})}),J=y([]),Y=()=>C(this,null,function*(){L(e.bizFileId)});return ke({columns:[{title:"附件类型",dataIndex:"fileType",align:"left",width:150,height:200},{title:"附件",dataIndex:"bizFileId",align:"left",width:600}],pagination:!1,showIndexColumn:!1,showTableSetting:!1,isCanResizeParent:!0,tableSetting:{fullScreen:!0},dataSource:J}),(s,a)=>{const c=f("a-input"),r=f("a-form-item"),i=f("a-col"),d=f("a-row"),h=f("a-date-picker"),I=f("a-input-number"),X=f("a-select"),ee=f("a-textarea"),W=f("a-card"),te=f("a-form"),ae=f("a-spin");return A(),ue("div",we,[t(ae,{spinning:e.spinning,tip:"Loading..."},{default:l(()=>[N("div",Ne,[N("div",Ee,[t(Ce,{options:_},null,8,["options"]),e.status!=10?(A(),de(fe,{key:0,onSave:Q,onSubmit:O,processInstanceId:e.processInstanceId,processStatus:e.status},null,8,["processInstanceId","processStatus"])):K("",!0)]),N("div",Pe,[t(te,{ref_key:"formRef",ref:x,model:e,labelAlign:"right",autocomplete:"off"},{default:l(()=>[t(W,{title:"基本信息",bordered:!1},{default:l(()=>[t(d,{gutter:24},{default:l(()=>[p(t(i,{span:12},{default:l(()=>[t(r,{name:"stationName",label:"电站名称",labelCol:{span:6},rules:[{required:!0,message:"请输入电站名称"}]},{default:l(()=>[t(c,{disabled:"",value:e.stationName,"onUpdate:value":a[0]||(a[0]=n=>e.stationName=n),placeholder:"请输入电站名称"},null,8,["value"]),K("",!0)]),_:1})]),_:1},512),[[m,!0]]),p(t(i,{span:12},{default:l(()=>[t(r,{name:"periodName",label:"期数",labelCol:{span:6},rules:[{required:!0,message:"请输入期数"}]},{default:l(()=>[t(c,{disabled:"",value:e.periodName,"onUpdate:value":a[2]||(a[2]=n=>e.periodName=n),placeholder:"请输入期数"},null,8,["value"])]),_:1})]),_:1},512),[[m,!0]])]),_:1}),t(d,{gutter:24},{default:l(()=>[p(t(i,{span:12},{default:l(()=>[t(r,{name:"startDate",label:"开始日期",labelCol:{span:6},rules:[{required:!0,message:"请选择开始日期"}]},{default:l(()=>[t(h,{value:e.startDate,"onUpdate:value":a[3]||(a[3]=n=>e.startDate=n),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},onChange:U,disabled:u.value},null,8,["value","disabled"])]),_:1})]),_:1},512),[[m,!0]]),p(t(i,{span:12},{default:l(()=>[t(r,{name:"endDate",label:"结束日期",labelCol:{span:6},rules:[{required:!0,message:"请选择结束日期"}]},{default:l(()=>[t(h,{value:e.endDate,"onUpdate:value":a[4]||(a[4]=n=>e.endDate=n),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},onChange:U,disabled:u.value},null,8,["value","disabled"])]),_:1})]),_:1},512),[[m,!0]])]),_:1}),t(d,{gutter:24},{default:l(()=>[p(t(i,{span:12},{default:l(()=>[t(r,{name:"genElec",label:"实发电量(kWh)",labelCol:{span:6},rules:[{required:!1,message:"请输入实发电量(kWh)"}]},{default:l(()=>[t(I,{disabled:"",value:e.genElec,"onUpdate:value":a[5]||(a[5]=n=>e.genElec=n),placeholder:"请输入实发电量(kWh)"},null,8,["value"])]),_:1})]),_:1},512),[[m,!0]]),p(t(i,{span:12},{default:l(()=>[t(r,{name:"onlineElec",label:"上网电量(kWh)",labelCol:{span:6},rules:[{required:!1,message:"请输入上网电量(kWh)"}]},{default:l(()=>[t(I,{disabled:"",value:e.onlineElec,"onUpdate:value":a[6]||(a[6]=n=>e.onlineElec=n),placeholder:"请输入上网电量(kWh)"},null,8,["value"])]),_:1})]),_:1},512),[[m,!0]])]),_:1}),t(d,{gutter:24},{default:l(()=>[p(t(i,{span:12},{default:l(()=>[t(r,{name:"desulphurizePrice",label:"脱硫电价(元/kWh)",labelCol:{span:6},rules:[{required:!1,message:"请输入脱硫电价(元/kWh)"}]},{default:l(()=>[t(I,{disabled:"",value:e.desulphurizePrice,"onUpdate:value":a[7]||(a[7]=n=>e.desulphurizePrice=n),placeholder:"请输入脱硫电价(元/kWh)"},null,8,["value"])]),_:1})]),_:1},512),[[m,!0]]),p(t(i,{span:12},{default:l(()=>[t(r,{name:"settlePartyName",label:"结算单位",labelCol:{span:6},rules:[{required:!0,message:"请选择结算单位"}]},{default:l(()=>[t(X,{value:e.settlePartyName,"onUpdate:value":a[8]||(a[8]=n=>e.settlePartyName=n),options:R(M),"allow-clear":"",placeholder:"请选择结算单位",disabled:u.value,onChange:j},null,8,["value","options","disabled"])]),_:1})]),_:1},512),[[m,!0]])]),_:1}),t(d,{gutter:24},{default:l(()=>[p(t(i,{span:12},{default:l(()=>[t(r,{name:"settlementElec",label:"结算电量(kWh)",labelCol:{span:6},rules:[{required:!0,message:"请输入结算电量(kWh)"}]},{default:l(()=>[t(I,{value:e.settlementElec,"onUpdate:value":a[9]||(a[9]=n=>e.settlementElec=n),onChange:S,disabled:u.value,precision:"2"},null,8,["value","disabled"])]),_:1})]),_:1},512),[[m,!0]]),p(t(i,{span:12},{default:l(()=>[t(r,{name:"settlementCost",label:"结算电费(元)",labelCol:{span:6},rules:[{required:!0,message:"请输入结算电费(元)"}]},{default:l(()=>[t(I,{value:e.settlementCost,"onUpdate:value":a[10]||(a[10]=n=>e.settlementCost=n),onChange:S,disabled:u.value,precision:"2"},null,8,["value","disabled"])]),_:1})]),_:1},512),[[m,!0]])]),_:1}),t(d,{gutter:24},{default:l(()=>[p(t(i,{span:12},{default:l(()=>[t(r,{name:"settlementPrice",label:"结算单价(元/kWh)",labelCol:{span:6},rules:[{required:!0,message:"请输入结算单价(元/kWh)"}]},{default:l(()=>[t(I,{value:e.settlementPrice,"onUpdate:value":a[11]||(a[11]=n=>e.settlementPrice=n),disabled:u.value,precision:"6"},null,8,["value","disabled"])]),_:1})]),_:1},512),[[m,!0]])]),_:1}),t(d,{gutter:24},{default:l(()=>[p(t(i,{span:24},{default:l(()=>[t(r,{name:"remark",label:"备注",labelCol:{span:3}},{default:l(()=>[t(ee,{value:e.remark,"onUpdate:value":a[12]||(a[12]=n=>e.remark=n),row:"6","show-count":"",style:{height:"200px"},disabled:u.value,maxlength:1e3},null,8,["value","disabled"])]),_:1})]),_:1},512),[[m,!0]])]),_:1})]),_:1}),t(W,{title:"上传附件",style:{height:"auto"},bordered:!1},{default:l(()=>[N("div",xe,[t(De,{ref_key:"uploadTable",ref:P,rows:k.value,colwidths:["15%","70%","15%"],application:"po",module:"settlementElec",mode:e.status==0?"normal":"view"},null,8,["rows","mode"])])]),_:1})]),_:1},8,["model"])])])]),_:1},8,["spinning"])])}}});export{pt as default};
//# sourceMappingURL=settlemenElecModal-643be487.js.map
