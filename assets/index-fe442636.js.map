{"version":3,"file":"index-fe442636.js","sources":["../../src/views/oa/schedule/work/menu/index.vue"],"sourcesContent":["<template>\n  <PageWrapper dense contentFullHeight fixedHeight contentClass=\"flex\" style=\"position: relative\">\n    <CommonTree\n      ref=\"treeRef\"\n      title=\"菜单树\"\n      @select=\"handleSelect\"\n      :value=\"treeData\"\n      class=\"left-tree-layout\"\n      :toolbar=\"true\"\n      :canEdit=\"false\"\n      :canAdd=\"false\"\n      :canDelete=\"false\"\n      :isShowOperationBtns=\"false\"\n      :fieldNames=\"{ key: 'id', title: 'name' }\"\n    />\n    <div class=\"right-table-layout\">\n      <BasicTable\n        @register=\"registerTable\"\n        :searchInfo=\"searchInfo\"\n        @resize-column=\"handleResizeColumn\"\n        @row-db-click=\"(record) => handleView(record)\"\n        class=\"fix-basic-table\"\n        @selection-change=\"handleSelectionChange\"\n      >\n        <template #toolbar>\n          <a-button type=\"primary\" :preIcon=\"IconEnum.ADD\" @click=\"handleCreate\">{{\n            t('common.action.create')\n          }}</a-button>\n          <a-button\n            :disabled=\"disabledBtn\"\n            type=\"primary\"\n            :preIcon=\"IconEnum.EDIT\"\n            @click=\"handleUpdate\"\n            >{{ t('common.action.edit') }}</a-button\n          >\n          <a-button\n            :disabled=\"disabledBtn\"\n            class=\"red-btn\"\n            :preIcon=\"IconEnum.DELETE\"\n            @click=\"handleDelete\"\n            >{{ t('common.delText') }}</a-button\n          >\n        </template>\n      </BasicTable>\n    </div>\n\n    <Dialog\n      v-model:visible=\"modal.open\"\n      :title=\"modal.title\"\n      :show-btm=\"!disabledInput\"\n      @ok=\"handleSuccess\"\n      @cancel=\"handleCancel\"\n      :width=\"460\"\n      :height=\"330\"\n      smode=\"normal\"\n      overflowY=\"auto\"\n    >\n      <a-form ref=\"modalFormRef\" :model=\"formState\" name=\"menuForm\" autocomplete=\"off\">\n        <a-row>\n          <a-col v-show=\"true\" :span=\"24\">\n            <a-form-item\n              label=\"菜单名称\"\n              name=\"menuName\"\n              :labelCol=\"{ class: 'detail-label' }\"\n              :rules=\"[{ required: false }]\"\n            >\n              <a-input v-model:value=\"formState.menuName\" :disabled=\"true\" />\n            </a-form-item>\n          </a-col>\n        </a-row>\n        <a-row>\n          <a-col v-show=\"true\" :span=\"24\">\n            <a-form-item\n              label=\"表名称\"\n              name=\"tableName\"\n              :labelCol=\"{ class: 'detail-label' }\"\n              :rules=\"[{ required: true }]\"\n            >\n              <SearchBox\n                v-model:value=\"formState.tableName\"\n                :api=\"getTablePageUrl\"\n                :apiParamFunc=\"apiParamFunc\"\n                :columns=\"searchBoxTableColumns\"\n                vfield=\"tableName\"\n                searchKey=\"keyword\"\n                :pagination=\"true\"\n                :disabled=\"disabledInput\"\n              />\n            </a-form-item>\n          </a-col>\n        </a-row>\n        <a-row>\n          <a-col v-show=\"true\" :span=\"24\">\n            <a-form-item\n              label=\"是否是流程\"\n              name=\"isFlow\"\n              :labelCol=\"{ class: 'detail-label' }\"\n              :rules=\"[{ required: true }]\"\n            >\n              <DictRadioGroup\n                v-model:value=\"formState.isFlow\"\n                :type=\"`yes_or_no`\"\n                :disabled=\"disabledInput\"\n                style=\"text-align: left\"\n              />\n            </a-form-item>\n          </a-col>\n        </a-row>\n      </a-form>\n    </Dialog>\n\n    <!-- 新增弹窗 -->\n    <div v-if=\"loadingFlag\" class=\"dialog-mask\"></div>\n  </PageWrapper>\n</template>\n<script lang=\"ts\" setup>\n  import { onMounted, reactive, ref, unref, UnwrapRef } from 'vue';\n  import { IconEnum } from '@/enums/appEnum';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { useMessage } from '@/hooks/web/useMessage';\n  import Dialog from '@/components/Framework/Modal/Dialog.vue';\n  import { BasicTable, useTable, SorterResult } from '/@/components/Table';\n  import { PageWrapper } from '/@/components/Page';\n  import SearchBox from '@/components/Framework/Combox/SearchBox.vue';\n  import DictRadioGroup from '@/components/Framework/Radio/DictRadioGroup.vue';\n  import CommonTree from '@/components/Framework/Tree/CommonTree.vue';\n  import { TreeItem } from '@/components/Tree';\n  import { FormInstance } from 'ant-design-vue';\n  import { SysMessage } from '/@/hooks/web/useMessage';\n  import {\n    getTreeData,\n    getPage,\n    deleteData,\n    saveData,\n    columns,\n    searchForm,\n    searchBoxTableColumns,\n    getTablePageUrl,\n  } from './menu.data';\n  import { assign } from 'lodash-es';\n  import { trim } from 'xe-utils';\n\n  const { t } = useI18n();\n  const { createConfirm } = useMessage();\n  const treeData = ref<TreeItem[]>([]);\n  const searchInfo = reactive<any>({});\n  const selectNode = reactive<any>({});\n  const disabledBtn = ref<boolean>(true);\n  const disabledInput = ref<boolean>(false);\n  const title = ref<string>('工作菜单设置');\n  const modal = reactive({\n    open: ref<boolean>(false),\n    title: ref<string>(''),\n  });\n  const loadingFlag = ref<boolean>(false);\n  const formState: UnwrapRef<any> = reactive({});\n  const modalFormRef = ref<FormInstance>();\n\n  const getParam = (isPage: boolean) => {\n    const query = unref(searchInfo);\n    if (isPage) {\n      const paginationRef = getPaginationRef() as any;\n      query.pageNo = paginationRef.current;\n      query.pageSize = paginationRef.pageSize;\n    }\n    if (!query.sortField) {\n      query.sortField = 'createTime';\n      query.sortOrder = 'desc';\n    }\n    return query;\n  };\n\n  const apiParamFunc = () => {\n    return {};\n  };\n\n  const getListByParam = async () => {\n    return await getPage(getParam(true));\n  };\n\n  const [registerTable, { getSelectRows, getPaginationRef, clearSelectedRowKeys, reload }] =\n    useTable({\n      title: title.value,\n      api: getListByParam,\n      columns: columns,\n      useSearchForm: true,\n      formConfig: searchForm,\n      showTableSetting: true,\n      bordered: true,\n      rowKey: 'id',\n      rowSelection: {\n        type: 'radio',\n      },\n      handleSearchInfoFn(info) {\n        searchInfo.menuName = info.menuName;\n        return info;\n      },\n      sortFn: (sortInfo: SorterResult) => {\n        const sortOrder = sortInfo.order?.replace('end', '');\n        searchInfo.sortOrder = sortOrder;\n        searchInfo.sortField = sortOrder ? sortInfo.field : undefined;\n      },\n    });\n\n  function handleResizeColumn(w, col) {\n    col.width = w;\n  }\n\n  function getOperateText(params) {\n    return !params.id ? t('common.action.create') : t('common.action.edit');\n  }\n\n  function handleSuccess() {\n    const value = modalFormRef.value;\n    if (value) {\n      value.validateFields().then(() => {\n        loadingFlag.value = true;\n        const operateText = getOperateText(formState);\n        formState.name = trim(formState.name);\n        saveData(formState)\n          .then(() => {\n            SysMessage.getInstance().success(operateText + '成功');\n            resetForm();\n            reload();\n            modal.open = false;\n            loadingFlag.value = false;\n          })\n          .catch(() => {\n            loadingFlag.value = false;\n          });\n      });\n    }\n  }\n\n  function handleCancel() {\n    disabledInput.value = false;\n    modal.open = false;\n    resetForm();\n  }\n\n  // 重置表单\n  function resetForm() {\n    modalFormRef.value?.resetFields();\n  }\n\n  const resetFields = () => {\n    disabledInput.value = false;\n    for (let key in formState) {\n      formState[key] = '';\n    }\n  };\n\n  function handleCreate() {\n    resetFields();\n    if (selectNode.nodeKind !== 'fun') {\n      SysMessage.getInstance().error('请选择菜单树末级节点');\n      return;\n    }\n    assign(formState, { id: '', tableName: '', isFlow: '' });\n    formState.menuId = selectNode.id;\n    formState.menuName = selectNode.name;\n    modal.open = true;\n    const operateText = getOperateText({});\n    modal.title = `${operateText}${title.value}`;\n  }\n\n  function checkSelectData() {\n    const rows = getSelectRows();\n    if (rows.length == 0) {\n      SysMessage.getInstance().error('请选择一行数据');\n      return false;\n    }\n    return rows[0];\n  }\n\n  function handleUpdate() {\n    resetFields();\n    const record = checkSelectData();\n    if (!record) {\n      return;\n    }\n    assign(formState, record);\n    formState.isFlow = String(record.isFlow);\n    modal.open = true;\n    const operateText = getOperateText(record);\n    modal.title = `${operateText}${title.value}`;\n  }\n\n  function handleView(record: any) {\n    assign(formState, record);\n    formState.isFlow = String(record.isFlow);\n    disabledInput.value = true;\n    modal.open = true;\n    modal.title = `查看${title.value}`;\n  }\n\n  function handleDelete() {\n    const record = checkSelectData();\n    if (!record) {\n      return;\n    }\n    deleteConfirm(function () {\n      deleteData(record.id).then(() => {\n        SysMessage.getInstance().success(t('common.delSuccessText'));\n        clearSelectedRowKeys();\n        reload();\n      });\n    });\n  }\n\n  function deleteConfirm(callback: Function) {\n    createConfirm({\n      title: t('common.message.confirmTitle'),\n      iconType: 'warning',\n      content: t('common.message.delMessage'),\n      async onOk() {\n        callback();\n      },\n    });\n  }\n\n  async function queryTreeList() {\n    const typeList = await getTreeData({});\n    treeData.value = typeList as unknown[] as TreeItem[];\n  }\n\n  function handleSelect(node) {\n    selectNode.id = null;\n    selectNode.nodeKind = null;\n    selectNode.name = null;\n    searchInfo.fullId = null;\n    if (node) {\n      selectNode.id = node.id;\n      selectNode.nodeKind = node.nodeKind;\n      selectNode.name = node.name;\n      searchInfo.fullId = node.id;\n    }\n    clearSelectedRowKeys();\n    reload();\n  }\n\n  function handleSelectionChange({ rows }) {\n    disabledBtn.value = rows.length === 0;\n  }\n\n  onMounted(() => {\n    queryTreeList();\n  });\n</script>\n<style lang=\"less\" scoped>\n  @import '/@/design/biz/bizList.less';\n</style>\n"],"names":["t","useI18n","createConfirm","useMessage","treeData","ref","searchInfo","reactive","selectNode","disabledBtn","disabledInput","title","modal","loadingFlag","formState","modalFormRef","getParam","isPage","query","unref","paginationRef","getPaginationRef","apiParamFunc","getListByParam","__async","getPage","registerTable","getSelectRows","clearSelectedRowKeys","reload","useTable","columns","searchForm","info","sortInfo","sortOrder","_a","handleResizeColumn","w","col","getOperateText","params","handleSuccess","value","operateText","trim","saveData","SysMessage","resetForm","handleCancel","resetFields","key","handleCreate","assign","checkSelectData","rows","handleUpdate","record","handleView","handleDelete","deleteConfirm","deleteData","callback","queryTreeList","typeList","getTreeData","handleSelect","node","handleSelectionChange","onMounted"],"mappings":"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"}