var w=(_,p,i)=>new Promise((a,b)=>{var y=r=>{try{m(i.next(r))}catch(f){b(f)}},h=r=>{try{m(i.throw(r))}catch(f){b(f)}},m=r=>r.done?a(r.value):Promise.resolve(r.value).then(y,h);m((i=i.apply(_,p)).next())});import{B as Y}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as q}from"./useTable-109483b3.js";import{a2 as E}from"./antd-15ac76ed.js";import{a5 as V,b as j,au as L,_ as W}from"./index.js";import{P as $}from"./index-20519caf.js";import{D as K}from"./Dialog-0a006d82.js";import{a as U}from"./assign-37f1c13d.js";import{d as Z,r as v,k as u,o as G,al as g,Z as k,a9 as J,aa as e,f as t,u as I,_ as S,F as Q,E as P,ad as o,ac as z,$ as c}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";const X=[{field:"module",component:"Input",label:"操作模块",colProps:{span:7},required:!1},{field:"userNickname",component:"Input",label:"操作人员",colProps:{span:7},required:!1},{field:"type",label:"操作类型",component:"DictSelectBox",componentProps:{type:"system_operate_type"},colProps:{span:7},required:!1},{field:"success",label:"状态",component:"Select",componentProps:{options:[{value:1,label:"成功"},{value:0,label:"失败"}]},colProps:{span:7},required:!1},{field:"startTime",component:"RangePicker",label:"操作时间",componentProps:{showTime:!0,width:"100%",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},colProps:{span:7},required:!1}],ee=[{title:"日志编号",dataIndex:"id",align:"center",resizable:!0,width:100},{title:"操作模块",dataIndex:"module",resizable:!0,align:"left",width:200},{title:"操作名",dataIndex:"name",resizable:!0,align:"left",width:200},{title:"操作类型",dataIndex:"typeText",resizable:!0,width:120},{title:"操作人",dataIndex:"userNickname",resizable:!0,width:100},{title:"操作结果",dataIndex:"resultMsg",align:"left",resizable:!0},{title:"操作日期",dataIndex:"startTime",resizable:!0,align:"center",width:150},{title:"执行时间",dataIndex:"duration",resizable:!0,align:"right",width:120},{title:"操作",dataIndex:"action",align:"center",width:120}],te=_=>V.post({url:"/system/operate-log/page",params:_},{isOnlyResult:!0}),ae=["onClick"],le={style:{display:"block",overflow:"auto","word-wrap":"break-word"}},oe=Z({__name:"index",setup(_){j(),L();const p=v({}),i=u(!1),a=v({id:"",module:""});v({});const b=u("操作日志详情");u(!1),u(!1);const y=u();u(),v({});let h=u("");const m=()=>w(this,null,function*(){let l=D().getFieldsValue();const s=A();return l.pageNo=s.current,l.pageSize=s.pageSize,yield te(l)}),[r,{reload:f,getForm:D,getDataSource:ne,getPaginationRef:A}]=q({title:"操作日志",api:m,rowKey:"id",columns:ee,useSearchForm:!0,showTableSetting:!0,bordered:!0,pagination:{pageSize:20,pageSizeOptions:["20","50","100","200"]},handleSearchInfoFn(l){return l},formConfig:{labelWidth:120,actionColOptions:{span:24},autoAdvancedLine:1,baseColProps:{span:7},schemas:X,autoSubmitOnEnter:!0,noHideBtnFlag:!0},sortFn:l=>{l.order?(p.sortField=l.field,p.sortOrder=l.order.replace("end","")):(p.sortField="",p.sortOrder="")}});function M({keys:l,rows:s}){if(s&&s.length>0){const n=s[0];h.value=n.id}else h.value=""}function R({record:l,index:s,key:n,value:d}){saveIndex(l).then(()=>{E.success("已保存"),f()}).catch(()=>{})}function T(l){i.value=!0,U(a,l)}function F(){i.value=!1;debugger}return G(()=>w(this,null,function*(){})),(l,s)=>{const n=g("a-form-item"),d=g("a-col"),B=g("a-row"),H=g("a-form"),N=g("a-button");return k(),J(I($),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:e(()=>[t(I(Y),{class:"fix-basic-table",onRegister:I(r),searchInfo:p,onEditEnd:R,onSelectionChange:M,onResizeColumn:s[0]||(s[0]=(C,x)=>x.width=C)},{toolbar:e(()=>[]),bodyCell:e(({text:C,column:x,record:O})=>[x.dataIndex==="duration"?(k(),S(Q,{key:0},[P(o(C)+"(ms) ",1)],64)):z("",!0),x.dataIndex==="action"?(k(),S("a",{key:1,onClick:se=>T(O)}," 详情",8,ae)):z("",!0)]),_:1},8,["onRegister","searchInfo"]),t(K,{visible:i.value,smode:"normal",title:b.value,width:"1000px",onClose:F},{footer:e(()=>[t(N,{key:"back",onClick:F},{default:e(()=>[P("关闭")]),_:1})]),default:e(()=>[t(H,{id:"index-form",ref_key:"indexFormRef",ref:y,model:a,name:"indexForm",labelAlign:"center",style:{height:"500px",overflow:"auto"}},{default:e(()=>[t(B,null,{default:e(()=>[t(d,{span:22},{default:e(()=>[t(n,{label:"日志主键",labelAlign:"right",labelCol:{span:3}},{default:e(()=>[c("span",null,o(a.id),1)]),_:1})]),_:1}),t(d,{span:22},{default:e(()=>[t(n,{label:"链路追踪",labelAlign:"right",labelCol:{span:3}},{default:e(()=>[c("span",null,o(a.traceId),1)]),_:1})]),_:1}),t(d,{span:22},{default:e(()=>[t(n,{label:"用户信息",labelAlign:"right",labelCol:{span:3}},{default:e(()=>[c("span",null,o(a.id)+" | "+o(a.userNickname)+" | "+o(a.userAgent),1)]),_:1})]),_:1}),t(d,{span:22},{default:e(()=>[t(n,{label:"操作信息",labelAlign:"right",labelCol:{span:3}},{default:e(()=>[c("span",null,o(a.module)+" | "+o(a.name),1)]),_:1})]),_:1}),t(d,{span:22},{default:e(()=>[t(n,{label:"请求信息",labelAlign:"right",labelCol:{span:3}},{default:e(()=>[c("span",null,o(a.requestMethod)+" | "+o(a.requestUrl),1)]),_:1})]),_:1}),t(d,{span:22},{default:e(()=>[t(n,{label:"方法名",labelAlign:"right",labelCol:{span:3}},{default:e(()=>[c("span",null,o(a.javaMethod),1)]),_:1})]),_:1}),t(d,{span:22},{default:e(()=>[t(n,{label:"方法参数",labelAlign:"right",labelCol:{span:3}},{default:e(()=>[c("span",le,o(a.javaMethodArgs),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])]),_:1})}}});const Re=W(oe,[["__scopeId","data-v-ee1211af"]]);export{Re as default};
//# sourceMappingURL=index-84f93da2.js.map
