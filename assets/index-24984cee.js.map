{"version":3,"file":"index-24984cee.js","sources":["../../src/views/sys/codeBuildRule/codeBuildRule.data.ts","../../src/views/sys/codeBuildRule/index.vue"],"sourcesContent":["import { BasicColumn, FormSchema, useRender } from '@/components/Table';\n\nexport const columns: BasicColumn[] = [\n  {\n    title: '编码',\n    dataIndex: 'code',\n    width: 160,\n  },\n  {\n    title: '名称',\n    dataIndex: 'name',\n    width: 160,\n  },\n  {\n    title: '规则',\n    dataIndex: 'rule',\n    width: 160,\n  },\n  {\n    title: '当前值',\n    dataIndex: 'currentValue',\n    width: 160,\n  },\n  {\n    title: '创建时间',\n    dataIndex: 'createTime',\n    width: 180,\n    customRender: ({ text }) => {\n      return useRender.renderDate(text);\n    },\n  },\n];\n\nexport const searchFormSchema: FormSchema[] = [\n  {\n    label: '编码',\n    field: 'code',\n    component: 'Input',\n    colProps: { span: 8 },\n  },\n  {\n    label: '名称',\n    field: 'name',\n    component: 'Input',\n    colProps: { span: 8 },\n  },\n];\n","<script lang=\"ts\" setup>\n  import { reactive, ref, toRaw, UnwrapRef } from 'vue';\n  import { Modal } from 'ant-design-vue';\n  import { BasicTable, useTable, TableAction } from '@/components/Table';\n  import { columns, searchFormSchema } from './codeBuildRule.data';\n  import { useI18n } from '@/hooks/web/useI18n';\n  // import { useMessage } from '@/hooks/web/useMessage';\n  // import { useModal } from '@/components/Modal';\n  import { IconEnum } from '@/enums/appEnum';\n\n  import * as CodeBuildRuleApi from '@/api/sys/codeBuildRule';\n\n  defineOptions({ name: 'CodeBuildRule' });\n\n  const { t } = useI18n();\n  // const { createConfirm, createMessage } = useMessage();\n  // const [registerModal, { openModal }] = useModal();\n\n  const [registerTable, { getForm, reload }] = useTable({\n    title: '单据编号规则列表',\n    api: CodeBuildRuleApi.getCodeBuildRulePage,\n    columns,\n    formConfig: { labelWidth: 120, schemas: searchFormSchema },\n    useSearchForm: true,\n    showTableSetting: true,\n    actionColumn: {\n      width: 140,\n      title: t('common.operate'),\n      dataIndex: 'action',\n      fixed: 'right',\n    },\n  });\n\n  const labelCol = { span: 4 };\n  const wrapperCol = { span: 14 };\n  const visible = ref<boolean>(false);\n  const spinning = ref<boolean>(false);\n\n  const title = ref('新增单据编号规则');\n\n  const showModal = () => {\n    visible.value = true;\n  };\n\n  const cancel = (e: MouseEvent) => {\n    formState.id = '';\n    formState.code = '';\n    formState.name = '';\n    formState.rule = '';\n    formState.currentValue = '';\n  };\n\n  const handleOk = (e: MouseEvent) => {\n    console.log(e);\n    formRef.value\n      .validate()\n      .then(() => {\n        // console.log('values', formState, toRaw(formState));\n        const formData = toRaw(formState);\n        if (formData.id) {\n          CodeBuildRuleApi.updateCodeBuildRule(formData);\n        } else {\n          CodeBuildRuleApi.createCodeBuildRule(formData);\n        }\n        reload();\n        visible.value = false;\n      })\n      .catch((error) => {\n        console.log('error', error);\n      });\n  };\n\n  function handleCreate() {\n    title.value = '新增单据编号规则';\n    showModal();\n  }\n\n  function handleEdit(record) {\n    title.value = '修改单据编号规则';\n    showModal();\n    CodeBuildRuleApi.getCodeBuildRule(record.id).then((res) => {\n      formState.id = res.id;\n      formState.code = res.code;\n      formState.name = res.name;\n      formState.rule = res.rule;\n      formState.currentValue = res.currentValue;\n    });\n  }\n\n  function handleDelete(record) {\n    Modal.confirm({\n      title: '确认操作',\n      content: '请确认是否删除此流程数据项？',\n      onOk() {\n        CodeBuildRuleApi.deleteCodeBuildRule(record.id).then(() => {\n          reload();\n        });\n      },\n    });\n  }\n\n  interface FormState {\n    id: string;\n    code: string;\n    name: string;\n    rule: string;\n    currentValue: number;\n  }\n  const formRef = ref();\n\n  const formState: UnwrapRef<FormState> = reactive({\n    id: '',\n    code: '',\n    name: '',\n    rule: '',\n    currentValue: 1,\n  });\n  const rules = {\n    code: [\n      { required: true, message: '请输入编码', trigger: 'change' },\n      { min: 10, max: 32, message: '长度应该在10到32个字符', trigger: 'change' },\n    ],\n    name: [\n      { required: true, message: '请输入名称', trigger: 'change' },\n      { min: 2, max: 64, message: '长度应该在2到32个字符', trigger: 'change' },\n    ],\n    rule: [{ max: 128, message: '长度应该在128个字符以内', trigger: 'blur' }],\n  };\n</script>\n<template>\n  <a-spin :spinning=\"spinning\" tip=\"Loading...\">\n    <div class=\"process-box\">\n      <BasicTable @register=\"registerTable\">\n        <template #toolbar>\n          <a-button type=\"primary\" :preIcon=\"IconEnum.ADD\" @click=\"handleCreate\"> 添加 </a-button>\n        </template>\n        <template #bodyCell=\"{ column, record }\">\n          <template v-if=\"column.key === 'action'\">\n            <TableAction\n              :actions=\"[\n                {\n                  icon: IconEnum.EDIT,\n                  label: '编辑',\n                  onClick: handleEdit.bind(null, record),\n                },\n                {\n                  icon: IconEnum.DELETE,\n                  danger: true,\n                  label: '删除',\n                  onClick: handleDelete.bind(null, record),\n                },\n              ]\"\n            />\n          </template>\n        </template>\n      </BasicTable>\n\n      <!-- 单据编码规则弹窗 -->\n      <a-modal v-model:visible=\"visible\" :title=\"title\" @ok=\"handleOk\" @cancel=\"cancel\">\n        <a-form\n          ref=\"formRef\"\n          :model=\"formState\"\n          :rules=\"rules\"\n          :label-col=\"labelCol\"\n          :wrapper-col=\"wrapperCol\"\n        >\n          <a-form-item label=\"编码\" name=\"code\">\n            <a-input v-model:value=\"formState.code\" />\n          </a-form-item>\n          <a-form-item label=\"名称\" name=\"name\">\n            <a-input v-model:value=\"formState.name\" />\n          </a-form-item>\n          <a-form-item label=\"编码规则\" name=\"rule\">\n            <a-input v-model:value=\"formState.rule\" />\n          </a-form-item>\n          <a-form-item label=\"当前值\" name=\"currentValue\">\n            <a-input-number v-model:value=\"formState.currentValue\" :min=\"1\" :max=\"999999\" />\n          </a-form-item>\n        </a-form>\n      </a-modal>\n    </div>\n  </a-spin>\n</template>\n"],"names":["columns","text","useRender","searchFormSchema","t","useI18n","registerTable","getForm","reload","useTable","CodeBuildRuleApi.getCodeBuildRulePage","labelCol","wrapperCol","visible","ref","spinning","title","showModal","cancel","e","formState","handleOk","formRef","formData","toRaw","CodeBuildRuleApi.updateCodeBuildRule","CodeBuildRuleApi.createCodeBuildRule","error","handleCreate","handleEdit","record","CodeBuildRuleApi.getCodeBuildRule","res","handleDelete","Modal","CodeBuildRuleApi.deleteCodeBuildRule","reactive","rules"],"mappings":"o/BAEO,MAAMA,GAAyB,CACpC,CACE,MAAO,KACP,UAAW,OACX,MAAO,GACT,EACA,CACE,MAAO,KACP,UAAW,OACX,MAAO,GACT,EACA,CACE,MAAO,KACP,UAAW,OACX,MAAO,GACT,EACA,CACE,MAAO,MACP,UAAW,eACX,MAAO,GACT,EACA,CACE,MAAO,OACP,UAAW,aACX,MAAO,IACP,aAAc,CAAC,CAAE,KAAAC,KACRC,EAAU,WAAWD,CAAI,CAEpC,CACF,EAEaE,GAAiC,CAC5C,CACE,MAAO,KACP,MAAO,OACP,UAAW,QACX,SAAU,CAAE,KAAM,CAAE,CACtB,EACA,CACE,MAAO,KACP,MAAO,OACP,UAAW,QACX,SAAU,CAAE,KAAM,CAAE,CACtB,CACF,8EChCQ,KAAA,CAAE,EAAAC,GAAMC,IAIR,CAACC,EAAe,CAAE,QAAAC,GAAS,OAAAC,CAAQ,CAAA,EAAIC,EAAS,CACpD,MAAO,WACP,IAAKC,EACL,QAAAV,GACA,WAAY,CAAE,WAAY,IAAK,QAASG,EAAiB,EACzD,cAAe,GACf,iBAAkB,GAClB,aAAc,CACZ,MAAO,IACP,MAAOC,EAAE,gBAAgB,EACzB,UAAW,SACX,MAAO,OACT,CAAA,CACD,EAEKO,EAAW,CAAE,KAAM,GACnBC,EAAa,CAAE,KAAM,IACrBC,EAAUC,EAAa,EAAK,EAC5BC,EAAWD,EAAa,EAAK,EAE7BE,EAAQF,EAAI,UAAU,EAEtBG,EAAY,IAAM,CACtBJ,EAAQ,MAAQ,EAAA,EAGZK,EAAUC,GAAkB,CAChCC,EAAU,GAAK,GACfA,EAAU,KAAO,GACjBA,EAAU,KAAO,GACjBA,EAAU,KAAO,GACjBA,EAAU,aAAe,EAAA,EAGrBC,EAAYF,GAAkB,CAClC,QAAQ,IAAIA,CAAC,EACbG,EAAQ,MACL,SACA,EAAA,KAAK,IAAM,CAEJ,MAAAC,EAAWC,EAAMJ,CAAS,EAC5BG,EAAS,GACXE,EAAqCF,CAAQ,EAE7CG,EAAqCH,CAAQ,EAExCf,IACPK,EAAQ,MAAQ,EAAA,CACjB,EACA,MAAOc,GAAU,CACR,QAAA,IAAI,QAASA,CAAK,CAAA,CAC3B,CAAA,EAGL,SAASC,GAAe,CACtBZ,EAAM,MAAQ,WACJC,GACZ,CAEA,SAASY,EAAWC,EAAQ,CAC1Bd,EAAM,MAAQ,WACJC,IACVc,EAAkCD,EAAO,EAAE,EAAE,KAAME,GAAQ,CACzDZ,EAAU,GAAKY,EAAI,GACnBZ,EAAU,KAAOY,EAAI,KACrBZ,EAAU,KAAOY,EAAI,KACrBZ,EAAU,KAAOY,EAAI,KACrBZ,EAAU,aAAeY,EAAI,YAAA,CAC9B,CACH,CAEA,SAASC,EAAaH,EAAQ,CAC5BI,EAAM,QAAQ,CACZ,MAAO,OACP,QAAS,iBACT,MAAO,CACLC,EAAqCL,EAAO,EAAE,EAAE,KAAK,IAAM,CAClDtB,GAAA,CACR,CACH,CAAA,CACD,CACH,CASA,MAAMc,EAAUR,IAEVM,EAAkCgB,EAAS,CAC/C,GAAI,GACJ,KAAM,GACN,KAAM,GACN,KAAM,GACN,aAAc,CAAA,CACf,EACKC,EAAQ,CACZ,KAAM,CACJ,CAAE,SAAU,GAAM,QAAS,QAAS,QAAS,QAAS,EACtD,CAAE,IAAK,GAAI,IAAK,GAAI,QAAS,gBAAiB,QAAS,QAAS,CAClE,EACA,KAAM,CACJ,CAAE,SAAU,GAAM,QAAS,QAAS,QAAS,QAAS,EACtD,CAAE,IAAK,EAAG,IAAK,GAAI,QAAS,eAAgB,QAAS,QAAS,CAChE,EACA,KAAM,CAAC,CAAE,IAAK,IAAK,QAAS,gBAAiB,QAAS,OAAQ,CAAA"}