var f=(n,r,a)=>new Promise((u,d)=>{var m=o=>{try{l(a.next(o))}catch(p){d(p)}},b=o=>{try{l(a.throw(o))}catch(p){d(p)}},l=o=>o.done?u(o.value):Promise.resolve(o.value).then(m,b);l((a=a.apply(n,r)).next())});import{B as I}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as R}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{a7 as P,az as v,bX as F,_ as z}from"./index.js";import{P as S}from"./index-20519caf.js";import{C as K}from"./CommonTree-c4ed7838.js";import"./index-316f6ffb.js";import{u as M}from"./useRender-21ce56fb.js";import{f as Y,a as B}from"./index.esm-c216ed00.js";import{u as N,j,b as O,k as V}from"./index-c0893416.js";import{d as A,aD as E,k as c,r as H,o as U,Z as W,a9 as $,aa as q,f as w,$ as J,u as T,J as X}from"./vue-71d1abb3.js";import{a as Z}from"./assign-37f1c13d.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";function G(n){const r={};return Y(L,function(a){a.value===n.toString()&&B(r,a)}),r}const L=[{dictType:"bpm_process_instance_result",value:"0",label:"草稿",colorType:"primary",cssClass:""},{dictType:"bpm_process_instance_result",value:"1",label:"处理中",colorType:"primary",cssClass:""},{dictType:"bpm_process_instance_result",value:"2",label:"通过",colorType:"success",cssClass:""},{dictType:"bpm_process_instance_result",value:"3",label:"不通过",colorType:"danger",cssClass:""},{dictType:"bpm_process_instance_result",value:"4",label:"已取消",colorType:"info",cssClass:""},{dictType:"bpm_process_instance_result",value:"5",label:"已终止",colorType:"info",cssClass:""}],Q=[{title:"单据编号",dataIndex:"businessCode",width:160,sorter:!0,resizable:!0},{title:"任务主题",dataIndex:"description",width:200,sorter:!0,resizable:!0},{title:"流程名称",dataIndex:"name",width:160,sorter:!0,resizable:!0},{title:"当前节点",dataIndex:"taskDefKey",width:160,sorter:!0,resizable:!0},{title:"处理人",dataIndex:"assigneeName",width:100,sorter:!0,resizable:!0},{title:"申请人",dataIndex:"startUserName",width:100,sorter:!0,resizable:!0},{title:"创建时间",dataIndex:"createdOn",width:160,sorter:!0,resizable:!0},{title:"流程状态",dataIndex:"status",sorter:!0,resizable:!0,width:100,customRender:({record:n})=>{const r=G(n.status);return M.renderFlowStatus(n.status,r.label)}}],ee=[{label:"单据编号",field:"bizCode",component:"Input",colProps:{span:8}},{label:"任务主题",field:"description",component:"Input",colProps:{span:8}},{label:"流程名称",field:"name",component:"Input",colProps:{span:8}},{label:"申请人",field:"personMemberName",component:"Input",colProps:{span:8}},{label:"创建时间",field:"[startDate, endDate]",component:"RangePicker",componentProps:{format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",placeholder:["开始日期","结束日期"]},colProps:{span:8}},{field:"status",label:"流程状态",component:"DictSelectBox",componentProps:{type:"bpm_process_instance_result"},colProps:{span:8}}],te={class:"right-table-layout"},ae=A({name:"TaskCenter",__name:"index",setup(n){const{query:r}=E(),a=c([]),u=c([]),d=c([]),m=c({}),b=c("待办任务"),l=c("010001");let o=H({});const[p,{getForm:se,reload:k,setColumns:oe,setTableData:re,getPaginationRef:le}]=R({title:"任务中心台账",api:V,columns:Q,formConfig:{labelWidth:120,schemas:ee},useSearchForm:!0,bordered:!0,beforeFetch(e){Z(e,o),e.flowDataType=m.value.flowDataType;let t=D(l.value);return t&&(e.flowDataType=t),e.flowDataType||(e.flowDataType="toDoTask"),o={},e},sortFn:e=>{var s;const t=(s=e.order)==null?void 0:s.replace("end","");o.sortOrder=t,o.sortField=t?F(e.field):void 0},showTableSetting:!0,tableSetting:{fullScreen:!0},showIndexColumn:!0});function h(e){const t=X(e);l.value=="010002"?N(e.processInstanceId).then(s=>{s.result&&(_(),v(e.businessKey))}):v(t.businessKey)}function C(){return f(this,arguments,function*(e={}){var s,i,g;let t=(s=e==null?void 0:e.code)!=null?s:"";t==""||t=="todo"||t=="check"||(m.value.flowDataType=(i=e==null?void 0:e.code)!=null?i:"",l.value="",b.value=(g=e==null?void 0:e.name)!=null?g:"",k(),y())})}function x(){a.value=[{key:"01",id:"01",code:"todo",name:"待办任务",children:[{key:"010001",id:"010001",code:"toDoTask",name:"待办任务"},{key:"010002",id:"010002",code:"toReadTask",name:"待阅任务"},{key:"010004",id:"010004",code:"draftTask",name:"草稿箱"}]},{key:"02",id:"02",code:"check",name:"任务查询",children:[{key:"020001",id:"020001",code:"createdTask",name:"本人发起"},{key:"020002",id:"020002",code:"trackingTask",name:"跟踪任务"},{key:"020003",id:"020003",code:"doneTask",name:"已办任务"},{key:"020004",id:"020004",code:"readedTask",name:"已阅任务"},{key:"020005",id:"020005",code:"copyToTask",name:"我抄送的"}]}],y(),u.value=["01","02"],d.value.push(l.value)}const D=e=>{let s=[{id:"010001",code:"toDoTask",name:"待办任务"},{id:"010002",code:"toReadTask",name:"待阅任务"},{id:"020001",code:"createdTask",name:"本人发起"},{id:"020003",code:"doneTask",name:"已办任务"}].find(i=>i.id==e);return s?s.code:null},_=()=>f(this,null,function*(){setTimeout(()=>{k(),y()},1500)});function y(){return f(this,null,function*(){let e=yield j({});a.value[0].children[0].badge=e.toDo,a.value[0].children[1].badge=e.toRead,a.value[0].children[2].badge=e.draft;const t=yield O();a.value[1].children[0].badge=t})}return U(()=>{r.flowType&&(l.value=r.flowType),x(),P.getInstance().listen("task-center-page",_)}),(e,t)=>(W(),$(T(S),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:q(()=>[w(K,{title:"任务类型",onSelect:C,value:a.value,class:"left-tree-layout",expandedKeys:u.value,selectedKeys:d.value,toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value","expandedKeys","selectedKeys"]),J("div",te,[w(T(I),{class:"fix-basic-table",onRegister:T(p),onResizeColumn:t[0]||(t[0]=(s,i)=>i.width=s),onRowDbClick:t[1]||(t[1]=s=>h(s))},null,8,["onRegister"])])]),_:1}))}});const je=z(ae,[["__scopeId","data-v-58caf78d"]]);export{je as default};
//# sourceMappingURL=index-6c7c5365.js.map
