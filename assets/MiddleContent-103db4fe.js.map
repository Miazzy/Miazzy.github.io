{"version":3,"file":"MiddleContent-103db4fe.js","sources":["../../src/views/da/cockpit/composition/MiddleContent.vue"],"sourcesContent":["<template>\n  <div class=\"middle-content\" :key=\"instanceKey\">\n    <div class=\"left-section section-box\">\n      <div class=\"section-bg\">\n        <SubtitleBar :subtitle=\"`现场任务统计`\">\n          <a-select\n            ref=\"select\"\n            v-model:value=\"searchInfo.selectTaskValue\"\n            :options=\"optionsDimension\"\n            @change=\"handleTaskChange\"\n            style=\"width: 1.2rem\"\n            v-show=\"optionsDimension.length > 1\"\n          />\n        </SubtitleBar>\n        <IndicatorGroup\n          :data=\"taskData\"\n          :style=\"tabStatus === 'on' ? 'margin-top: -0.15rem' : 'margin-top: -0.2rem'\"\n          class=\"indicator-group-layout\"\n          :class=\"tabStatus === 'on' ? '' : 'fix-indicator-group-padding'\"\n        />\n        <div style=\"width: 100%; height: 2rem\">\n          <div style=\"margin-left: 0.16rem; transform: scale(0.85); transform-origin: 0 0\">\n            <EchartLineBarChart\n              :data=\"taskChartData\"\n              :width=\"`36.14vw`\"\n              :height=\"tabStatus === 'on' ? `34.8vh` : `39vh`\"\n              :category=\"taskChartData.categories\"\n              ybgcolor=\"#01B7D730\"\n              :name=\"taskChartData.chartSeriesName\"\n              :dataZoomDisabled=\"false\"\n              :dataZoomDefaultValueRange=\"[0, 5]\"\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"middle-section section-box\">\n      <div class=\"section-bg\">\n        <SubtitleBar :subtitle=\"`持证率统计`\">\n          <a-select\n            ref=\"select\"\n            v-model:value=\"searchInfo.selectPersonCertValue\"\n            :options=\"optionsDimension\"\n            style=\"width: 1.2rem\"\n            @change=\"handlePersonCertChange\"\n            v-show=\"optionsDimension.length > 1\"\n          />\n        </SubtitleBar>\n        <IndicatorGroup\n          :data=\"personCertData\"\n          :style=\"tabStatus === 'on' ? 'margin-top: -0.15rem' : 'margin-top: -0.2rem'\"\n          class=\"indicator-group-layout\"\n          :class=\"tabStatus === 'on' ? '' : 'fix-indicator-group-padding'\"\n          @clickItem=\"toBiReport('ddzRate')\"\n        />\n        <div style=\"width: 100%; height: 2rem\">\n          <div style=\"margin-left: 0.16rem; transform: scale(0.85); transform-origin: 0 0\">\n            <EchartLineBarChart\n              :data=\"lbarChartData\"\n              :width=\"`36.14vw`\"\n              :height=\"tabStatus === 'on' ? `34.5vh` : `39vh`\"\n              :category=\"lbarChartData.categories\"\n              ybgcolor=\"#01B7D730\"\n              :name=\"lbarChartData.seriesName\"\n              @clickItem=\"handlePersonCert\"\n              :dataZoomDisabled=\"false\"\n              :dataZoomDefaultValueRange=\"[0, 5]\"\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"right-section section-box\">\n      <div class=\"section-bg\">\n        <SubtitleBar :subtitle=\"`合同统计`\" />\n        <div class=\"donut-chart-layout\">\n          <!-- <DonutChart\n            class=\"chart\"\n            :data=\"contractData.pieData\"\n            width=\"32.28vw\"\n            height=\"31.85vh\"\n            radius=\"100\"\n            title=\"总合同数\"\n          /> -->\n          <EchartPieChart\n            id=\"contract-stat-pie\"\n            :width=\"`32.23vw`\"\n            :height=\"tabStatus === 'on' ? `33.08vh` : `36.41vh`\"\n            :data=\"contractData.pieData\"\n            :roseType=\"false\"\n            :radius=\"['40%', '60%']\"\n            showLegend\n            showLabel\n            :pieCenter=\"['45%', '50%']\"\n            :legendOptions=\"{ top: 'center', bottom: 'auto', left: '80%', orient: 'vertical' }\"\n          />\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\n  import { reactive, UnwrapRef, ref, onMounted, watch } from 'vue';\n  import SubtitleBar from '/@/components/Framework/Chart/SubtitleBar.vue';\n  import IndicatorGroup from '/@/components/Framework/Chart/IndicatorGroup.vue';\n  import EchartLineBarChart from '/@/components/Framework/Chart/EchartLineBarChart.vue';\n  import EchartPieChart from '/@/components/Framework/Chart/EchartPieChart.vue';\n  import { assign } from 'lodash-es';\n  import { getPersonCertData, getContractData, getTaskResultData } from './data';\n  import * as CommonApi from '@/api/da/common';\n  import { handleRouteChange } from '../../utils.ts';\n  import { buildUUID } from '@/utils/uuid';\n  // import DonutChart from '/@/components/Framework/Chart/DonutChart.vue';\n\n  //搜索参数\n  const searchInfo: UnwrapRef<any> = reactive({\n    //任务统计\n    selectTaskValue: 'station',\n    // 持证率统计\n    selectPersonCertValue: 'station',\n  });\n  interface Props {\n    searchInfoByTime?: {};\n    tabStatus?: '';\n  }\n  const props = withDefaults(defineProps<Props>(), {});\n  const optionsDimension: any = ref([]);\n  const instanceKey = ref(buildUUID());\n\n  watch(\n    () => props.searchInfoByTime,\n    (value) => {\n      assign(searchInfo, value);\n      queryPersonCertData();\n      queryContractData();\n      queryTaskResultData();\n    },\n  );\n\n  onMounted(async () => {\n    const sts = await CommonApi.getDictDataMap({ dictType: 'cockpit_three_dimension' });\n    sts.result.forEach((e) => {\n      optionsDimension.value.push({ value: e.value, label: e.label });\n    });\n    assign(searchInfo, props.searchInfoByTime);\n  });\n\n  //=============================== 任务统计=============================================\n  const taskData = ref({});\n\n  const taskChartData = ref({\n    barData: [[], []],\n    categories: [],\n    lineData: [[]],\n    colors: [\n      ['#488FF6', '#60D1F3'],\n      ['#078C5D', '#68E4B8'],\n      ['#E59837', '#FAE895'],\n      ['#e59837', '#fae895'],\n      ['#078C5D', '#68E4B8'],\n    ],\n    dataZoomDefaultValueRange: [0.5],\n    chartSeriesName: [['超期完成', '未完成'], ['完成率(%)']],\n  });\n\n  const queryTaskResultData = async () => {\n    searchInfo.dimension = searchInfo.selectTaskValue;\n    const taskResult = await getTaskResultData(searchInfo);\n    if (taskResult.result) {\n      taskData.value = [\n        { value: taskResult.result.actualCompleteNum, label: '按期完成(项)' },\n        { value: taskResult.result.unCompleteNum, label: '未完成(项)' },\n        { value: taskResult.result.rate, label: '完成率(%)' },\n      ];\n      taskChartData.value.barData = taskResult.result.barData || [];\n      taskChartData.value.categories = taskResult.result.categories || [];\n      // if (taskResult.lineData?.length) {\n      //   taskChartData.value.lineData[0] = taskResult.lineData;\n      // } else {\n      //   taskChartData.value.lineData = [];\n      // }\n    }\n  };\n  const handleTaskChange = (value: string) => {\n    searchInfo.selectTaskValue = value;\n    queryTaskResultData();\n  };\n\n  //=============================== 持证率=============================================\n  const personCertData = ref({});\n\n  const lbarChartData = ref({\n    barData: [[], [], []],\n    // colors: [\n    //   ['#488FF6', '#60D1F3'],\n    //   ['#078C5D', '#68E4B8'],\n    //   ['#E59837', '#FAE895'],\n    //   '#9cf312',\n    //   '#f39c12',\n    // ],\n    categories: [],\n    seriesName: [['调度证', '高压电工证', '安全员证']],\n  });\n  const queryPersonCertData = async () => {\n    searchInfo.dimension = searchInfo.selectPersonCertValue;\n    let data = await getPersonCertData(searchInfo);\n    if (data.result) {\n      lbarChartData.value.barData = data.result.barData;\n      lbarChartData.value.categories = data.result.categories;\n      personCertData.value = [\n        { value: data.result.ddzRate, label: '调度证(%)' },\n        { value: data.result.gydgzRate, label: '高压电工证(%)' },\n        { value: data.result.aqzgzRate, label: '安全员证(%)' },\n      ];\n    }\n  };\n  const handlePersonCertChange = (value: string) => {\n    searchInfo.selectPersonCertValue = value;\n    queryPersonCertData();\n  };\n\n  //=============================== 合同统计=============================================\n  const contractData = ref({\n    pieData: [],\n  });\n  const queryContractData = async () => {\n    let data = await getContractData(searchInfo);\n    if (data.result) {\n      let pieData = [];\n      data.result.pieData.forEach((item) => {\n        item.name = item.label;\n        pieData.push(item);\n      });\n      contractData.value.pieData = data.result.pieData;\n    }\n  };\n\n  //=============================== 数据穿透=============================================\n  const toBiReport = async (type: string) => {\n    if (type === 'ddzRate') {\n      //持证率\n      handleRouteChange('/bi/integrated/personnelQualifications', {});\n    }\n  };\n\n  function handlePersonCert(params) {\n    handleRouteChange('/bi/integrated/personnelQualifications', {\n      selectType: searchInfo.selectPersonCertValue,\n      id: params.data.id,\n      name: params.data.fullName,\n    });\n  }\n\n  // 更新组件函数\n  const handleUpdate = () => {\n    instanceKey.value = buildUUID();\n  };\n\n  defineExpose({\n    handleUpdate,\n  });\n</script>\n\n<style lang=\"less\" scoped>\n  .middle-content {\n    display: flex;\n    flex: 44.34%;\n    justify-content: space-between;\n    height: 44.34%;\n    padding-top: 0.93vh;\n\n    .section-box {\n      flex: 33.3333%;\n      width: 33.3333%;\n      height: 100%;\n    }\n\n    .section-bg {\n      width: 100%;\n      height: 100%;\n      background: url('../../../../assets/images/da/section_bg_4.png') no-repeat center/100% 100%;\n    }\n\n    .left-section {\n      padding-right: 0.56vw;\n    }\n\n    .middle-section {\n      padding: 0 0.28vw;\n\n      .section-bg {\n        background: url('../../../../assets/images/da/section_bg_5.png') no-repeat center/100% 100%;\n      }\n\n      :deep(.subtitle-bar) {\n        padding-left: 0.22rem;\n      }\n    }\n\n    .right-section {\n      padding-left: 0.56vw;\n    }\n\n    :deep(.ant-select:not(.ant-select-customize-input) .ant-select-selector) {\n      height: 0.26rem !important;\n      border: 0.01rem solid #07a6ff70;\n      border-radius: 0;\n      background-color: transparent;\n    }\n\n    :deep(.ant-select-single .ant-select-selector .ant-select-selection-placeholder) {\n      height: 0.26rem;\n      line-height: 0.26rem;\n    }\n\n    :deep(.ant-select-arrow) {\n      color: rgb(255 255 255 / 50%);\n    }\n\n    .indicator-group-layout {\n      padding: 0.08rem 1.2rem 0;\n\n      &.fix-indicator-group-padding {\n        padding-top: 1.8vh;\n      }\n    }\n  }\n</style>\n"],"names":["searchInfo","reactive","optionsDimension","ref","instanceKey","buildUUID","watch","props","value","assign","queryPersonCertData","queryContractData","queryTaskResultData","onMounted","__async","CommonApi.getDictDataMap","e","taskData","taskChartData","taskResult","getTaskResultData","handleTaskChange","personCertData","lbarChartData","data","getPersonCertData","handlePersonCertChange","contractData","getContractData","item","toBiReport","type","handleRouteChange","handlePersonCert","params","__expose"],"mappings":"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"}