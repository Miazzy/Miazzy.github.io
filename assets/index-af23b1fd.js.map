{"version":3,"file":"index-af23b1fd.js","sources":["../../src/views/bi/fault/index.ts","../../src/views/bi/fault/index.vue"],"sourcesContent":["import { BasicColumn, FormSchema } from '@/components/Table';\nimport { defHttp } from '@/utils/http/axios';\nimport dayjs from 'dayjs';\nimport { useUserStore } from '/@/store/modules/user';\n\nenum Api {\n  getPage = '/bi/fault/list',\n  getStation = '/baseset/common/list-station',\n  getOrgInfoUrl = '/bi/common/org/info',\n  exportExcelUrl = '/bi/fault/export-excel',\n}\n\nconst getOrgInfoData = (params) =>\n  defHttp.get({ url: Api.getOrgInfoUrl, params }, { isOnlyResult: true });\nconst getStation = (params) => {\n  return defHttp.post({ url: Api.getStation, params });\n};\n\n// 查询列表\nexport function getPage(params) {\n  return defHttp.post({ url: Api.getPage, params });\n}\nexport const exportExcel = (params) =>\n  defHttp.post(\n    { url: Api.exportExcelUrl, params, responseType: 'blob' },\n    { isReturnNativeResponse: true },\n  );\n\nexport const columns: BasicColumn[] = [\n  {\n    title: '所属公司',\n    dataIndex: 'stationOrganName',\n    align: 'left',headAlign:'center',\n    width: 160,\n    customCell: (record, index, column) => {\n      return {\n        rowSpan: record.rowSpan,\n      };\n    },\n    resizable: true,\n    ifShow:useUserStore().isMultiOrganization\n  },\n  { title: '电站名称', dataIndex: 'stationName',align: 'left',headAlign:'center', width: 160,resizable: true },\n  {\n    title: '发现缺陷',\n    dataIndex: 'find',\n    width: 160,resizable: true,\n    children: [\n      { title: '重大', dataIndex: 'findmajor',align: 'right',headAlign:'center', width: 80,resizable: true },\n      { title: '较大', dataIndex: 'findmore_serious',align: 'right',headAlign:'center', width: 80,resizable: true },\n      { title: '严重', dataIndex: 'findserious',align: 'right',headAlign:'center', width: 80,resizable: true },\n      { title: '一般', dataIndex: 'findgenerally',align: 'right',headAlign:'center', width: 80,resizable: true },\n    ],\n  },\n  {\n    title: '消缺缺陷',\n    dataIndex: 'solve',\n    width: 160,resizable: true,\n    children: [\n      { title: '重大', dataIndex: 'solvemajor',align: 'right',headAlign:'center', width: 80,resizable: true },\n      { title: '较大', dataIndex: 'solvemore_serious',align: 'right',headAlign:'center', width: 80,resizable: true },\n      { title: '严重', dataIndex: 'solveserious',align: 'right',headAlign:'center', width: 80,resizable: true },\n      { title: '一般', dataIndex: 'solvegenerally',align: 'right',headAlign:'center', width: 80,resizable: true },\n    ],\n  },\n  { title: '缺陷总数', dataIndex: 'findTotal',align: 'right',headAlign:'center', width: 160,resizable: true },\n  { title: '消缺总数', dataIndex: 'solveTotal',align: 'right',headAlign:'center', width: 160,resizable: true },\n  { title: '消缺率(%)', dataIndex: 'solveRate',align: 'right',headAlign:'center', width: 160,resizable: true },\n];\n\nexport const searchFormSchema: FormSchema[] = [\n  {\n    label: '时间维度',\n    field: 'dateType',\n    required: true,\n    defaultValue: 'year',\n    component: 'Select',\n    componentProps: ({ formModel })=>{\n      return {\n        allowClear:false,\n        options: [\n          { value: 'year', label: '年' },\n          { value: 'month', label: '月' },\n          { value: 'day', label: '自然日' },\n        ],\n        onChange: (value) => {\n          // if (value === 'year') {\n          //   formModel['[startDate, endDate]'] = [];\n          // } else if (value === 'month' || value === 'day') {\n          //   formModel.year = '';\n          // } else {\n          //   formModel.year = '';\n          //   formModel['[startMonth, endMonth]'] = [];\n          // }\n          formModel.year = '';\n          formModel['[startMonth, endMonth]'] = [null,null];\n          formModel['[startDate, endDate]'] = [null,null];\n        },\n      }\n    },\n    colProps: { span: 8 },\n  },\n  {\n    field: '[startDate, endDate]',\n    label: '发现时间',\n    component: 'RangePicker',\n    colProps: { span: 8 },\n    componentProps: {\n      allowClear:false,\n      picker: 'month',\n      format: 'YYYY-MM',\n      valueFormat: 'YYYY-MM-DD',\n      placeholder: ['开始日期', '结束日期'],\n    },\n\n    show: ({ values }) => {\n      return values.dateType == 'month';\n    },\n    dynamicRules: ({ values }) => {\n      return values.dateType == 'month' ? [{ required: true, message: '时间必填' }] : [];\n    },\n  },\n  {\n    field: '[startDate, endDate]',\n    label: '发现时间',\n    component: 'RangePicker',\n    colProps: { span: 8 },\n    componentProps: {\n      allowClear:false,\n      format: 'YYYY-MM-DD',\n      valueFormat: 'YYYY-MM-DD',\n      placeholder: ['开始日期', '结束日期'],\n    },\n    show: ({ values }) => {\n      return values.dateType == 'day';\n    },\n    dynamicRules: ({ values }) => {\n      return values.dateType == 'day' ? [{ required: true, message: '时间必填' }] : [];\n    },\n  },\n  {\n    field: 'year',\n    label: '发现时间',\n    component: 'DatePicker',\n    colProps: { span: 8 },\n    defaultValue: dayjs(new Date()).format('YYYY'),\n    componentProps: {\n      style:'width:100%',\n      allowClear:false,\n      picker: 'year',\n      format: 'YYYY',\n      valueFormat: 'YYYY-MM-DD',\n      placeholder: '年份',\n    },\n    show: ({ values }) => {\n      return values.dateType == 'year';\n    },\n    dynamicRules: ({ values }) => {\n      return values.dateType == 'year' ? [{ required: true, message: '年份必填' }] : [];\n    },\n  },\n  {\n    label: '所属公司',\n    field: 'stationOrganId',\n    component: 'ApiSelect',\n    componentProps: {\n      options: [],\n      api: getOrgInfoData,\n    },\n    colProps: { span: 8 }\n    ,ifShow:useUserStore().isMultiOrganization\n  },\n  {\n    label: '选择电站',\n    field: 'stationId',\n    component: 'ApiSelect',\n    componentProps: {\n      options: [],\n      api: async () => {\n        const sts = await getStation({});\n        const map: any = [];\n        sts.result.forEach((e) => {\n          map.push({ value: e.powerStationId, label: e.powerStationName });\n        });\n\n        return map;\n      },\n    },\n    colProps: { span: 8 },\n  },\n];\n","<template>\n  <BasicTable\n    @register=\"registerTable\"\n    @resize-column=\"(w, col) => (col.width = w)\"\n    class=\"w-4/4 xl:w-12/12\"\n  >\n    <template #toolbar>\n      <a-button class=\"yellow-btn\" :preIcon=\"IconEnum.EXPORT\" @click=\"handleExport\">{{\n        t('common.action.export')\n      }}</a-button>\n    </template>\n  </BasicTable>\n</template>\n\n<script lang=\"ts\" setup>\n  import { BasicTable, useTable } from '@/components/Table';\n  import { onMounted, ref } from 'vue';\n  import dayjs from 'dayjs';\n  import { IconEnum } from '/@/enums/appEnum';\n  import { useMessage } from '/@/hooks/web/useMessage';\n  import { exportExcelFile } from '/@/utils/file/download';\n  import { useUserStore } from '/@/store/modules/user';\n  import { columns, searchFormSchema, getPage, exportExcel } from './index';\n  import { useI18n } from '/@/hooks/web/useI18n';\n  import { urlToPath } from '/@/utils/route';\n\n  let { params } = urlToPath() as any;\n  if (params.startDate?.length == 7) {\n    params.startDate = params.startDate + '-01';\n  }\n  if (params.endDate?.length == 7) {\n    params.endDate = params.endDate + '-01';\n  }\n  const { t } = useI18n();\n  const { createConfirm, createMessage } = useMessage();\n\n  const queryParam: any = ref({\n    dateType: 'year',\n    year: dayjs(new Date()).format('YYYY-MM-DD'),\n  });\n\n  const [registerTable, { getForm }] = useTable({\n    title: '缺陷统计',\n    api: async () => {\n      Object.assign(queryParam.value, params);\n      queryParam.value._random_ = undefined;\n      let dataObj = await getPage(queryParam.value);\n      return dataObj.result;\n    },\n    columns,\n    bordered: true,\n    rowKey: 'id',\n    formConfig: {\n      labelWidth: 120,\n      schemas: searchFormSchema,\n      showAdvancedButton:useUserStore().isMultiOrganization,\n      autoAdvancedLine:1, \n    },\n    useSearchForm: true,\n    showTableSetting: false,\n    pagination: false,\n    rowSelection: {\n      type: 'checkbox',\n    },\n    handleSearchInfoFn(info) {\n      for (const key in info) {\n        queryParam.value[key] = info[key];\n      }\n    },\n  });\n  function handleExport() {\n    createConfirm({\n      title: t('common.message.confirmTitle'),\n      iconType: 'warning',\n      content: t('common.message.exportMessage'),\n      async onOk() {\n        queryParam.value.filename = '缺陷统计报表.xls';\n        queryParam.value.excelList = columns;\n        await exportExcel(queryParam.value).then((res) => {\n          exportExcelFile(res?.data, queryParam.value.filename);\n        });\n        queryParam.value.filename = null;\n        queryParam.value.excelList = null;\n        createMessage.success(t('common.exportSuccessText'));\n      },\n    });\n  }\n\n  onMounted(() => {\n    getForm().setFieldsValue({ ...params });\n  });\n</script>\n"],"names":["getOrgInfoData","params","defHttp","getStation","getPage","exportExcel","columns","record","index","column","useUserStore","searchFormSchema","formModel","value","values","dayjs","__async","sts","map","e","urlToPath","_a","_b","t","useI18n","createConfirm","createMessage","useMessage","queryParam","ref","registerTable","getForm","useTable","info","key","handleExport","res","exportExcelFile","onMounted","__spreadValues"],"mappings":"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"}