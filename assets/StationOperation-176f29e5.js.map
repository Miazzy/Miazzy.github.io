{"version":3,"file":"StationOperation-176f29e5.js","sources":["../../src/views/da/stationOperation/stationData.ts","../../src/views/da/stationOperation/StationOperation.vue"],"sourcesContent":["import { defHttp } from '/@/utils/http/axios';\n\nenum Api {\n  //电站基础信息\n  getPowerStationInfoUrl = '/da/station-operation/stationInfo',\n}\n\nexport const getPowerStationInfo = (params) =>\n  defHttp.get({ url: Api.getPowerStationInfoUrl, params }, {});\n","<template>\n  <div class=\"layout rem-layout\">\n    <div class=\"dashboard\">\n      <Header class=\"header-layout\" :title=\"title\" />\n      <div class=\"content\" v-if=\"loading\">\n        <Overview\n          ref=\"overviewRef\"\n          v-if=\"selectedMenu === '1'\"\n          :searchStationInfo=\"searchStationInfo\"\n        />\n        <Monitor\n          ref=\"monitorRef\"\n          v-if=\"selectedMenu === '2'\"\n          :searchStationInfo=\"searchStationInfo\"\n        />\n        <Operation\n          ref=\"operationRef\"\n          v-if=\"selectedMenu === '3'\"\n          :searchStationInfo=\"searchStationInfo\"\n        />\n        <Device\n          ref=\"deviceRef\"\n          v-if=\"selectedMenu === '4'\"\n          :searchStationInfo=\"searchStationInfo\"\n        />\n\n        <div v-if=\"selectedMenu !== '4'\" class=\"bg-box\">\n          <a-carousel class=\"img-carousel\" autoplay>\n            <div v-for=\"(item, index) in urls\">\n              <img class=\"bg-img\" :src=\"item\" alt=\"\" />\n            </div>\n          </a-carousel>\n        </div>\n        <a-button class=\"back-btn\" type=\"primary\" @click=\"handleBack\">返回</a-button>\n\n        <!-- 地图 -->\n        <SatelliteMap v-if=\"selectedMenu === '4'\" />\n      </div>\n      <Footer class=\"footer-layout\" :selectedKey=\"selectedMenu\" @change=\"handleMenuChange\" />\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\n  import '../rem.ts';\n  import { reactive, UnwrapRef, ref, onMounted } from 'vue';\n  import Header from '/@/components/Framework/OperationScreen/Header.vue';\n  import Footer from '/@/components/Framework/OperationScreen/Footer.vue';\n  import Overview from './overview/Overview.vue';\n  import Monitor from './monitor/Monitor.vue';\n  import Operation from './operation/Operation.vue';\n  import Device from './device/Device.vue';\n  import { getPowerStationInfo } from './stationData';\n  import { useRoute, useRouter } from 'vue-router';\n  import { useGo } from '/@/hooks/web/usePage';\n  import SatelliteMap from './SatelliteMap.vue';\n  import { MsgManager } from '/@/message/MsgManager';\n  import * as FileApi from '@/api/infra/file';\n  import { formatDate } from '/@/utils/dateUtil';\n  import dayjs, { Dayjs } from 'dayjs';\n\n  const route = useRoute();\n  const go = useGo();\n  const urls = ref([]);\n  const router = useRouter();\n  const overviewRef = ref();\n  const monitorRef = ref();\n  const operationRef = ref();\n  const deviceRef = ref();\n  const stationUuidKey = 'OPERATION_SCREEN_STATION_UUID';\n\n  const title = ref('电站运营');\n\n  const searchStationInfo: UnwrapRef<any> = reactive({});\n  const loading = ref<boolean>(false);\n  const showDate = ref<Dayjs>();\n\n  const queryPowerStationInfo = async () => {\n    let data = await getPowerStationInfo(searchStationInfo);\n    if (data.result) {\n      loading.value = true;\n      searchStationInfo.stationId = data.result.stationId;\n      let fileData = await FileApi.getFiles({ bizId: data.result.bizFileId });\n      let urlTemp = [];\n      if (fileData.length > 0) {\n        fileData.forEach((element) => {\n          urlTemp.push(FileApi.attachmentDownloadUrl(element.url));\n        });\n        urls.value = urlTemp;\n      }\n    }\n  };\n\n  const selectedMenu = ref('1');\n  const handleMenuChange = (item) => {\n    selectedMenu.value = item.key;\n    MsgManager.getInstance().sendMsg('smart-device-clear-overlays', null);\n  };\n\n  // 返回\n  const handleBack = () => {\n    go({ path: '/groupOperation' });\n  };\n\n  const handlePageUpdate = () => {\n    const originKey = selectedMenu.value;\n    const path = router.currentRoute.value?.path;\n    if (path === '/stationoperation') {\n      switch (originKey) {\n        case '1':\n          overviewRef.value?.handleUpdate();\n          break;\n        case '2':\n          monitorRef.value?.handleUpdate();\n          break;\n        case '3':\n          operationRef.value?.handleUpdate();\n          break;\n        case '4':\n          deviceRef.value?.handleUpdate();\n          break;\n      }\n    }\n  };\n\n  onMounted(() => {\n    searchStationInfo.statDimension = 'year';\n    let current = new Date(); //获取新的时间\n    //获取当前年份,并且转为字符串\n    searchStationInfo.year = current.getFullYear().toString();\n    // // 默认湖北天门电站 存当前电站\n    searchStationInfo.stationUUId =\n      route.query.id || localStorage.getItem(stationUuidKey) || 'fc0f88bd7f909f2a50e2721f72315750';\n    // searchStationInfo.stationUUId = 'B6717C6744F44E53814F00AEEDEBFA74';\n    localStorage.setItem(stationUuidKey, searchStationInfo.stationUUId);\n    // 电站信息\n    queryPowerStationInfo();\n    // 监听 resize 事件\n    window.addEventListener('resize', handlePageUpdate);\n  });\n</script>\n\n<style lang=\"less\">\n  @import '../style/operationScreenCommon.less';\n</style>\n\n<style lang=\"less\" scoped>\n  .layout {\n    width: 100%;\n    height: 100%;\n\n    .dashboard {\n      position: relative;\n      width: 100%;\n      height: 100%;\n\n      .content {\n        position: relative;\n        width: 100%;\n        height: 100vh;\n\n        .bg-box {\n          width: 100%;\n          height: 100vh;\n          background: url('../../../assets/images/operationScreen/station-operation-bg.png')\n            no-repeat center/100% 100%;\n\n          .img-carousel {\n            position: absolute;\n            top: calc(11.01vh + 0.96rem);\n            left: 25vw;\n            width: 50vw;\n            height: calc(88.07vh - 1.86rem);\n\n            .bg-img {\n              width: 50vw;\n              height: calc(88.07vh - 1.86rem);\n            }\n          }\n        }\n\n        .back-btn {\n          display: none;\n          position: absolute;\n          top: 2.2rem;\n          left: 25%;\n        }\n      }\n\n      .header-layout {\n        position: absolute;\n        z-index: 11;\n        top: 0;\n        left: 0;\n      }\n\n      .footer-layout {\n        position: absolute;\n        z-index: 11;\n        bottom: 0;\n        left: 0;\n      }\n    }\n  }\n</style>\n"],"names":["getPowerStationInfo","params","defHttp","stationUuidKey","route","useRoute","go","useGo","urls","ref","router","useRouter","overviewRef","monitorRef","operationRef","deviceRef","title","searchStationInfo","reactive","loading","queryPowerStationInfo","__async","data","fileData","FileApi.getFiles","urlTemp","element","FileApi.attachmentDownloadUrl","selectedMenu","handleMenuChange","item","MsgManager","handleBack","handlePageUpdate","originKey","_a","_b","_c","_d","_e","onMounted","current"],"mappings":"2lGAOa,MAAAA,GAAuBC,GAClCC,EAAQ,IAAI,CAAE,IAAK,oCAA4B,OAAAD,CAAU,EAAA,EAAE,wHC6DrDE,EAAiB,yEARvB,MAAMC,EAAQC,IACRC,EAAKC,IACLC,EAAOC,EAAI,CAAA,CAAE,EACbC,EAASC,IACTC,EAAcH,IACdI,EAAaJ,IACbK,EAAeL,IACfM,EAAYN,IAGZO,EAAQP,EAAI,MAAM,EAElBQ,EAAoCC,EAAS,CAAA,CAAE,EAC/CC,EAAUV,EAAa,EAAK,EACjBA,EAAW,EAE5B,MAAMW,EAAwB,IAAYC,EAAA,sBACpC,IAAAC,EAAO,MAAMtB,GAAoBiB,CAAiB,EACtD,GAAIK,EAAK,OAAQ,CACfH,EAAQ,MAAQ,GACEF,EAAA,UAAYK,EAAK,OAAO,UACtC,IAAAC,EAAW,MAAMC,EAAiB,CAAE,MAAOF,EAAK,OAAO,SAAA,CAAW,EAClEG,EAAU,CAAA,EACVF,EAAS,OAAS,IACXA,EAAA,QAASG,GAAY,CAC5BD,EAAQ,KAAKE,EAA8BD,EAAQ,GAAG,CAAC,CAAA,CACxD,EACDlB,EAAK,MAAQiB,EAEjB,CAAA,GAGIG,EAAenB,EAAI,GAAG,EACtBoB,EAAoBC,GAAS,CACjCF,EAAa,MAAQE,EAAK,IAC1BC,EAAW,YAAY,EAAE,QAAQ,8BAA+B,IAAI,CAAA,EAIhEC,EAAa,IAAM,CACpB1B,EAAA,CAAE,KAAM,iBAAA,CAAmB,CAAA,EAG1B2B,EAAmB,IAAM,eAC7B,MAAMC,EAAYN,EAAa,MAE/B,KADaO,EAAAzB,EAAO,aAAa,QAApB,YAAAyB,EAA2B,QAC3B,oBACX,OAAQD,EAAW,CACjB,IAAK,KACHE,EAAAxB,EAAY,QAAZ,MAAAwB,EAAmB,eACnB,MACF,IAAK,KACHC,EAAAxB,EAAW,QAAX,MAAAwB,EAAkB,eAClB,MACF,IAAK,KACHC,EAAAxB,EAAa,QAAb,MAAAwB,EAAoB,eACpB,MACF,IAAK,KACHC,EAAAxB,EAAU,QAAV,MAAAwB,EAAiB,eACjB,KACJ,CACF,EAGF,OAAAC,EAAU,IAAM,CACdvB,EAAkB,cAAgB,OAC9B,IAAAwB,MAAc,KAElBxB,EAAkB,KAAOwB,EAAQ,YAAY,EAAE,SAAS,EAExDxB,EAAkB,YAChBb,EAAM,MAAM,IAAM,aAAa,QAAQD,CAAc,GAAK,mCAE/C,aAAA,QAAQA,EAAgBc,EAAkB,WAAW,EAE5CG,IAEf,OAAA,iBAAiB,SAAUa,CAAgB,CAAA,CACnD"}