{"version":3,"file":"index-cf91a298.js","sources":["../../src/views/oa/info/informationquery/index.ts","../../src/views/oa/info/informationquery/index.vue"],"sourcesContent":["import { BasicColumn, FormSchema } from '@/components/Table';\nimport { defHttp } from '/@/utils/http/axios';\n\nenum Api {\n  getPage = '/oa/information/queryPage',\n}\n\nexport const getPage = (params) => {\n  return defHttp.get({ url: Api.getPage, params }, {});\n};\n\nexport const columns: BasicColumn[] = [\n  { title: '主题', dataIndex: 'subject',align:'left',headAlign:'center', width: 120,sorter: true,resizable: true },\n  { title: '信息类型', dataIndex: 'typeText', width: 120,sorter: true,resizable: true },\n  { title: '发布人', dataIndex: 'publisher', width: 120,sorter: true,align: 'left',headAlign:'center',resizable: true },\n  { title: '发布日期', dataIndex: 'publishedDate', width: 120,sorter: true,resizable: true },\n];\n\nexport const formSearchSchemas : FormSchema[] =[\n  { label: '信息主题', field: 'subject', component: 'Input', colProps: { span: 8 } },\n  {\n    label: '信息类型',\n    field: 'type',\n    component: 'DictSelectBox',\n    componentProps: {\n      type: 'information_type',\n    },\n    colProps: { span: 8 },\n  },\n  {\n    field: '[startPublishedDate, endPublishedDate]',\n    label: '发布时间',\n    component: 'RangePicker',\n    colProps: { span: 8 },\n    componentProps: {\n      format: 'YYYY-MM-DD',\n      valueFormat: 'YYYY-MM-DD',\n      placeholder: ['开始日期', '结束日期'],\n    },\n  },\n];\n  ","<template>\n  <PageWrapper dense contentFullHeight fixedHeight  contentClass=\"flex\" style=\"position: relative\">\n    <div class=\"w-6/6 tab-model\">\n      <div class=\"tab-button-div\">\n        <BasicForm @register=\"formRegister\"/>\n       </div>\n      <div class=\"tab-table-div\">\n        <BasicTable @register=\"registerTable\" \n            @row-dbClick=\"dbClick\"\n            @resize-column=\"(w, col) => (col.width = w)\">\n          </BasicTable>\n      </div>\n    </div>\n  </PageWrapper>\n</template>\n<script lang=\"ts\" setup>\n\n  import { PageWrapper } from '/@/components/Page';\n  import { onMounted, ref } from 'vue';\n\n  import { BasicTable, useTable, SorterResult } from '@/components/Table';\n\n  import { BasicForm, useForm } from '@/components/Form';\n  import {  columns, getPage, formSearchSchemas } from './index';\n  import { addTabPage } from '@/utils/route';\n  import { MsgManager } from '/@/message/MsgManager';\n\n\n  const queryParam: any = ref({\n    pageNo: 1,\n    pageSize: 10,\n    sortField: 'sort',\n    sortOrder: 'desc'\n  });\n\n\n  function dbClick(record) {\n    //手工编辑\n    if(record.source === '2'){\n      addTabPage(\n        `/oa/info/informationquery/view?bizId=${record.id}`,\n        '查看资讯'\n      );\n    } else {\n      window.open(record.url, '_blank');\n    }\n  }\n\n   const [formRegister, { resetFields, getFieldsValue }] = useForm({\n    labelWidth: 120,\n    baseColProps: { span: 8 },\n    actionColOptions: {\n      span: 24,\n    },\n    schemas: formSearchSchemas,\n    compact: true,\n    resetButtonOptions: {\n      onClick: async () => {\n        await resetFields();\n        reload();\n      },\n    },\n    submitFunc: () => {\n      reload();\n      return Promise.resolve();\n    },\n  });\n\n  const [\n    registerTable,\n    {\n      reload: reload,\n      getPaginationRef: pageRef,\n    },\n  ] = useTable({\n    title: '资讯查询',\n    api: async () => {\n      const paginationRef = pageRef() as any;\n      Object.assign(queryParam.value,getFieldsValue());\n      \n      queryParam.value.pageNo = paginationRef.current;\n      queryParam.value.pageSize = paginationRef.pageSize;\n      let dataObj = await getPage(queryParam.value);\n      return dataObj.result;\n    },\n    columns,\n    bordered: true,\n    rowKey:'id',\n    useSearchForm: false,\n    showTableSetting: true,\n    sortFn: (sortInfo: SorterResult) => {\n      if (sortInfo.order) {\n        queryParam.value.sortField = sortInfo.field.replace('Text', '');\n        queryParam.value.sortOrder = sortInfo.order.replace('end', '');\n      } else {\n          queryParam.value.sortField = 'sort';\n          queryParam.value.sortOrder = 'desc';\n        }\n    },\n    handleSearchInfoFn(info) {\n      for (const key in info) {\n        queryParam.value[key] = info[key];\n      }\n    }\n  });\n\n\n  onMounted(async () => {\n    MsgManager.getInstance().listen('info-reload', () => {\n      reload();\n    });\n    \n  });\n</script>\n\n<style lang=\"less\" >\n   .tab-model {\n    height: 100vh;\n    padding: 10px 10px 0;\n  }\n\n  .tab-button-div {\n    .ant-form {\n      margin-bottom: 10px;\n      padding: 12px 6px 4px 16px;\n    }\n\n    .vben-basic-form {\n      .ant-row .ant-col.ant-col-8 {\n        flex: 0 0 27.5%;\n        max-width: 27.5%;\n      }\n\n      .ant-col.ant-col-24 {\n        position: fixed;\n        right: 1rem;\n      }\n    }\n  }\n</style>"],"names":["getPage","params","defHttp","columns","formSearchSchemas","queryParam","ref","dbClick","record","addTabPage","formRegister","resetFields","getFieldsValue","useForm","__async","reload","registerTable","pageRef","useTable","paginationRef","sortInfo","info","key","onMounted","MsgManager"],"mappings":"+nCAOa,MAAAA,EAAWC,GACfC,EAAQ,IAAI,CAAE,IAAK,4BAAa,OAAAD,CAAO,EAAG,CAAA,CAAE,EAGxCE,EAAyB,CACpC,CAAE,MAAO,KAAM,UAAW,UAAU,MAAM,OAAO,UAAU,SAAU,MAAO,IAAI,OAAQ,GAAK,UAAW,EAAK,EAC7G,CAAE,MAAO,OAAQ,UAAW,WAAY,MAAO,IAAI,OAAQ,GAAK,UAAW,EAAK,EAChF,CAAE,MAAO,MAAO,UAAW,YAAa,MAAO,IAAI,OAAQ,GAAK,MAAO,OAAO,UAAU,SAAS,UAAW,EAAK,EACjH,CAAE,MAAO,OAAQ,UAAW,gBAAiB,MAAO,IAAI,OAAQ,GAAK,UAAW,EAAK,CACvF,EAEaC,EAAkC,CAC7C,CAAE,MAAO,OAAQ,MAAO,UAAW,UAAW,QAAS,SAAU,CAAE,KAAM,EAAI,EAC7E,CACE,MAAO,OACP,MAAO,OACP,UAAW,gBACX,eAAgB,CACd,KAAM,kBACR,EACA,SAAU,CAAE,KAAM,CAAE,CACtB,EACA,CACE,MAAO,yCACP,MAAO,OACP,UAAW,cACX,SAAU,CAAE,KAAM,CAAE,EACpB,eAAgB,CACd,OAAQ,aACR,YAAa,aACb,YAAa,CAAC,OAAQ,MAAM,CAC9B,CACF,CACF,iHCZE,MAAMC,EAAkBC,EAAI,CAC1B,OAAQ,EACR,SAAU,GACV,UAAW,OACX,UAAW,MAAA,CACZ,EAGD,SAASC,EAAQC,EAAQ,CAEpBA,EAAO,SAAW,IACnBC,EACE,wCAAwCD,EAAO,EAAE,GACjD,MAAA,EAGK,OAAA,KAAKA,EAAO,IAAK,QAAQ,CAEpC,CAEC,KAAM,CAACE,EAAc,CAAE,YAAAC,EAAa,eAAAC,CAAgB,CAAA,EAAIC,EAAQ,CAC/D,WAAY,IACZ,aAAc,CAAE,KAAM,CAAE,EACxB,iBAAkB,CAChB,KAAM,EACR,EACA,QAAST,EACT,QAAS,GACT,mBAAoB,CAClB,QAAS,IAAYU,EAAA,sBACnB,MAAMH,EAAY,EACXI,GACT,EACF,EACA,WAAY,KACHA,IACA,QAAQ,UACjB,CACD,EAEK,CACJC,EACA,CACE,OAAAD,EACA,iBAAkBE,CACpB,GACEC,EAAS,CACX,MAAO,OACP,IAAK,IAAYJ,EAAA,sBACf,MAAMK,EAAgBF,IACtB,cAAO,OAAOZ,EAAW,MAAMO,EAAgB,CAAA,EAEpCP,EAAA,MAAM,OAASc,EAAc,QAC7Bd,EAAA,MAAM,SAAWc,EAAc,UAC5B,MAAMnB,EAAQK,EAAW,KAAK,GAC7B,MACjB,GACA,QAAAF,EACA,SAAU,GACV,OAAO,KACP,cAAe,GACf,iBAAkB,GAClB,OAASiB,GAA2B,CAC9BA,EAAS,OACXf,EAAW,MAAM,UAAYe,EAAS,MAAM,QAAQ,OAAQ,EAAE,EAC9Df,EAAW,MAAM,UAAYe,EAAS,MAAM,QAAQ,MAAO,EAAE,IAE3Df,EAAW,MAAM,UAAY,OAC7BA,EAAW,MAAM,UAAY,OAEnC,EACA,mBAAmBgB,EAAM,CACvB,UAAWC,KAAOD,EAChBhB,EAAW,MAAMiB,CAAG,EAAID,EAAKC,CAAG,CAEpC,CAAA,CACD,EAGD,OAAAC,EAAU,IAAYT,EAAA,sBACpBU,EAAW,YAAY,EAAE,OAAO,cAAe,IAAM,CAC5CT,GAAA,CACR,CAAA,EAEF"}