{"version":3,"file":"SessionTimeoutLogin-735a004f.js","sources":["../../src/views/sys/login/SessionTimeoutLogin.vue"],"sourcesContent":["<template>\n  <transition>\n    <div :class=\"prefixCls\">\n      <Login sessionTimeout />\n    </div>\n  </transition>\n</template>\n<script lang=\"ts\" setup>\n  import { onBeforeUnmount, onMounted, ref } from 'vue';\n  import Login from './Login.vue';\n  import { useDesign } from '/@/hooks/web/useDesign';\n  import { useUserStore } from '/@/store/modules/user';\n  import { usePermissionStore } from '/@/store/modules/permission';\n  import { useAppStore } from '/@/store/modules/app';\n  import { PermissionModeEnum } from '/@/enums/appEnum';\n  import { type Nullable } from '@vben/types';\n\n  const { prefixCls } = useDesign('st-login');\n  const userStore = useUserStore();\n  const permissionStore = usePermissionStore();\n  const appStore = useAppStore();\n  const userId = ref<Nullable<number | string>>(0);\n\n  const isBackMode = () => {\n    return appStore.getProjectConfig.permissionMode === PermissionModeEnum.BACK;\n  };\n\n  onMounted(() => {\n    // 记录当前的UserId\n    userId.value = userStore.getUserInfo?.userId;\n    console.log('Mounted', userStore.getUserInfo);\n  });\n\n  onBeforeUnmount(() => {\n    if (userId.value && userId.value !== userStore.getUserInfo.userId) {\n      // 登录的不是同一个用户，刷新整个页面以便丢弃之前用户的页面状态\n      // document.location.reload();\n    } else if (isBackMode() && permissionStore.getLastBuildMenuTime === 0) {\n      // 后台权限模式下，没有成功加载过菜单，就重新加载整个页面。这通常发生在会话过期后按F5刷新整个页面后载入了本模块这种场景\n      // document.location.reload();\n    }\n  });\n</script>\n<style lang=\"less\" scoped>\n  @prefix-cls: ~'@{namespace}-st-login';\n\n  .@{prefix-cls} {\n    position: fixed;\n    z-index: 9999999;\n    width: 100%;\n    height: 100%;\n    background: @component-background;\n  }\n</style>\n"],"names":["prefixCls","useDesign","userStore","useUserStore","permissionStore","usePermissionStore","appStore","useAppStore","userId","ref","isBackMode","PermissionModeEnum","onMounted","_a","onBeforeUnmount"],"mappings":"y0BAiBE,KAAM,CAAE,UAAAA,CAAA,EAAcC,EAAU,UAAU,EACpCC,EAAYC,IACZC,EAAkBC,IAClBC,EAAWC,IACXC,EAASC,EAA+B,CAAC,EAEzCC,EAAa,IACVJ,EAAS,iBAAiB,iBAAmBK,EAAmB,KAGzE,OAAAC,EAAU,IAAM,OAEPJ,EAAA,OAAQK,EAAAX,EAAU,cAAV,YAAAW,EAAuB,OAC9B,QAAA,IAAI,UAAWX,EAAU,WAAW,CAAA,CAC7C,EAEDY,EAAgB,IAAM,CAChBN,EAAO,OAASA,EAAO,QAAUN,EAAU,YAAY,QAGhDQ,EAAgB,GAAAN,EAAgB,oBAG3C,CACD"}