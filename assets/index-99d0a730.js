var l=(v,r,a)=>new Promise((u,o)=>{var f=s=>{try{i(a.next(s))}catch(m){o(m)}},h=s=>{try{i(a.throw(s))}catch(m){o(m)}},i=s=>s.done?u(s.value):Promise.resolve(s.value).then(f,h);i((a=a.apply(v,r)).next())});import{B as j}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as A}from"./useTable-109483b3.js";import{a2 as w}from"./antd-15ac76ed.js";import{b as H,au as W,a7 as X,av as S,ax as x,_ as Z}from"./index.js";import{P as q}from"./index-20519caf.js";import{C as G}from"./CommonTree-c4ed7838.js";import{g as J,d as Q,e as U,c as Y,s as ee,a as te}from"./data-46d0e574.js";import{e as ae}from"./download-03e71dd5.js";import{a as T}from"./assign-37f1c13d.js";import{d as oe,r as y,k as N,o as ne,al as ie,Z as re,a9 as se,aa as d,f as p,$ as ce,u as n,E as b,ad as _}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";const le={class:"right-table-layout"},de=oe({__name:"index",setup(v){const{t:r}=H(),a=y({}),u=N([]),o=y({}),{createConfirm:f,createMessage:h}=W();let i=N("");ne(()=>{s(),X.getInstance().listen("person-certificate",g)});function s(){return l(this,null,function*(){u.value=yield J({}),g()})}function m(e){a.stationOrganId=null,a.stationId=null,a.periodId=null,e&&(a.stationOrganId=e.organId,a.stationId=e.powerStationId,a.periodId=e.powerStationPeriodId,o.stationOrganId=e.organId,o.stationOrganName=e.organName,o.stationId=e.powerStationId,o.stationName=e.powerStationName,o.periodId=e.powerStationPeriodId,o.periodName=e.powerStationPeriodName,o.nodeKindId=e.nodeKindId),g()}const O=()=>l(this,null,function*(){const e=D(),t=y({});return T(t,a),t.pageNo=e.current,t.pageSize=e.pageSize,yield te(t)}),[k,{getForm:F,reload:g,getSelectRows:P,clearSelectedRowKeys:R,getPaginationRef:D}]=A({title:"持证列表",api:O,columns:Y,formConfig:ee,useSearchForm:!0,fetchSetting:{listField:"list",pageField:"pageNo",sizeField:"pageSize",totalField:"total"},handleSearchInfoFn(e){return T(a,e),e},clickToRowSelect:!0,bordered:!0,pagination:{pageSize:20},showIndexColumn:!0,showTableSetting:!0,tableSetting:{fullScreen:!0},rowSelection:{type:"radio",fixed:!0,onSelect:z},sortFn:e=>{e.order?(a.sortField=e.field,a.sortOrder=e.order.replace("end","")):(a.sortField="",a.sortOrder="")}});function E({keys:e,rows:t}){if(t&&t.length>0){const c=t[0];i.value=c.id}else i.value=""}function z(e,t){t?i.value=e.id:i.value=""}function B(){if(!o.stationId){w.error("请先选择电站。");return}x("/po/integrated/personcertificate/create","添加人员持证",{stationOrganId:o.stationOrganId,stationOrganName:o.stationOrganName,stationId:o.stationId,stationName:o.stationName})}function M(){const e=C();e.id&&x(`/po/integrated/personcertificate/create?id=${e.id}`,"修改人员持证")}function V(e){e.id&&x("/po/integrated/personcertificate/create","查看人员持证",{id:e.id,type:"view",page_readonly:"true"})}function C(){const e=P();return e.length==0?(w.error("请选择一行数据"),!1):e[0]}function K(){return l(this,null,function*(){const e=C();e.id&&f({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return l(this,null,function*(){Q(e.id).then(()=>{w.success("已删除"),R(),g()})})}})})}function L(){f({title:r("common.exportTitle"),iconType:"warning",content:r("common.message.exportMessage"),onOk(){return l(this,null,function*(){yield U(F().getFieldsValue()).then(t=>{ae(t==null?void 0:t.data,"人员持证.xls")}),h.success(r("common.exportSuccessText"))})}})}return(e,t)=>{const c=ie("a-button");return re(),se(n(q),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:d(()=>[p(G,{title:"电站组织",onSelect:m,value:u.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),ce("div",le,[p(n(j),{onRegister:n(k),class:"fix-basic-table",searchInfo:a,onResizeColumn:t[1]||(t[1]=(I,$)=>$.width=I),onRowDbClick:t[2]||(t[2]=I=>V(I)),onSelectionChange:E},{toolbar:d(()=>[p(c,{type:"primary",preIcon:n(S).ADD,onClick:t[0]||(t[0]=I=>B())},{default:d(()=>[b(_(n(r)("common.action.create")),1)]),_:1},8,["preIcon"]),p(c,{type:"primary",disabled:n(i)=="",preIcon:n(S).EDIT,onClick:M},{default:d(()=>[b(_(n(r)("common.action.edit")),1)]),_:1},8,["disabled","preIcon"]),p(c,{class:"red-btn",disabled:n(i)=="",preIcon:n(S).DELETE,onClick:K},{default:d(()=>[b(_(n(r)("common.delText")),1)]),_:1},8,["disabled","preIcon"]),p(c,{class:"yellow-btn",preIcon:n(S).EXPORT,onClick:L},{default:d(()=>[b(_(n(r)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister","searchInfo"])])]),_:1})}}});const Le=Z(de,[["__scopeId","data-v-22b0bcd4"]]);export{Le as default};
//# sourceMappingURL=index-99d0a730.js.map
