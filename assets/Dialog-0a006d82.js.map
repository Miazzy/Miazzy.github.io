{"version":3,"file":"Dialog-0a006d82.js","sources":["../../src/components/Framework/Modal/Dialog.vue"],"sourcesContent":["<template>\n  <teleport v-if=\"['body', '#app'].includes(props.target)\" :to=\"props.target\">\n    <div class=\"modal-mask\" v-if=\"visible\" @mousewheel.prevent>\n      <div class=\"modal-mask-container\" @mousewheel.prevent></div>\n    </div>\n  </teleport>\n  <teleport v-if=\"['body', '#app'].includes(props.target)\" :to=\"props.target\">\n    <div class=\"modal-mask\" v-if=\"visible\">\n      <div\n        v-if=\"['body', '#app'].includes(props.target)\"\n        class=\"modal-mask-container\"\n        @mousewheel.prevent\n      ></div>\n      <div\n        class=\"modal-container\"\n        :target=\"props.target\"\n        :style=\"{\n          width: typeof width == 'number' ? width + 'px' : width,\n          height: typeof height == 'number' ? height + 'px' : height,\n        }\"\n      >\n        <div class=\"modal-header\">\n          <span :style=\"`font-size: ${props.tsize}px; font-weight: ${props.tweight};`\">{{\n            title\n          }}</span>\n          <button class=\"modal-close\" @click=\"closeModal\">×</button>\n        </div>\n        <div\n          class=\"modal-body\"\n          :style=\"{ height: bodyHeight + 'px', overflowY: overflowY, overflowX: overflowX }\"\n        >\n          <!-- 插槽：用于自定义弹框内容 -->\n          <slot v-if=\"props.mode !== 'iframe'\"></slot>\n          <iframe v-else :src=\"props.url\" frameborder=\"0\" width=\"100%\" height=\"100%\"></iframe>\n        </div>\n        <div v-if=\"props.showBtm\" class=\"modal-footer\" style=\"position: relative\">\n          <!-- 底部按钮插槽：可以包含“取消”、“确定”按钮 -->\n          <div class=\"footer-button\" style=\"\">\n            <slot name=\"footer\">\n              <a-button @click=\"cancel\">取消</a-button>\n              <a-button type=\"primary\" @click=\"confirm\">确定</a-button>\n            </slot>\n          </div>\n        </div>\n      </div>\n    </div>\n  </teleport>\n  <template v-if=\"!['body', '#app'].includes(props.target)\">\n    <div class=\"modal-mask\" v-if=\"visible\">\n      <div\n        class=\"modal-container\"\n        :target=\"props.target\"\n        :style=\"{\n          width: typeof width == 'number' ? width + 'px' : width,\n          height: typeof height == 'number' ? height + 'px' : height,\n        }\"\n      >\n        <div class=\"modal-header\">\n          <span :style=\"`font-size: ${props.tsize}px; font-weight: ${props.tweight};`\">{{\n            title\n          }}</span>\n          <button class=\"modal-close\" @click=\"closeModal\">×</button>\n        </div>\n        <div\n          class=\"modal-body\"\n          :style=\"{ height: bodyHeight + 'px', overflowY: overflowY, overflowX: overflowX }\"\n        >\n          <!-- 插槽：用于自定义弹框内容 -->\n          <slot v-if=\"props.mode !== 'iframe'\"></slot>\n          <iframe v-else :src=\"props.url\" frameborder=\"0\" width=\"100%\" height=\"100%\"></iframe>\n        </div>\n        <div v-if=\"props.showBtm\" class=\"modal-footer\" style=\"position: relative\">\n          <!-- 底部按钮插槽：可以包含“取消”、“确定”按钮 -->\n          <div class=\"footer-button\" style=\"\">\n            <slot name=\"footer\">\n              <a-button @click=\"cancel\">取消</a-button>\n              <a-button type=\"primary\" @click=\"confirm\">确定</a-button>\n            </slot>\n          </div>\n        </div>\n      </div>\n    </div>\n  </template>\n</template>\n\n<script lang=\"ts\" setup>\n  import {\n    ref,\n    defineProps,\n    defineEmits,\n    computed,\n    watch,\n    nextTick,\n    onMounted,\n    getCurrentInstance,\n    defineExpose,\n  } from 'vue';\n  import { MsgManager } from '/@/message/MsgManager';\n  import { SysMessage } from '/@/hooks/web/useMessage';\n  import { onMountedOrActivated } from '@vben/hooks';\n  import { useUserStoreWithOut } from '/@/store/modules/user';\n  import { dialogMaskOpen, dialogMaskClose } from '@/utils/mask';\n\n  defineOptions({\n    name: 'Dialog',\n  });\n\n  const props = defineProps({\n    visible: Boolean, // 是否显示弹框\n    title: String, // 弹框标题\n    smode: { type: String, default: 'simple' },\n    tweight: { type: Number, default: 400 },\n    tsize: { type: String, default: '16' }, // 标题大小\n    width: { type: [Number, String], default: 800 }, // 弹框宽度\n    height: { type: [Number, String], default: 600 }, // 弹框高度\n    pheight: { type: Number, default: 121 }, // 弹框高度\n    showBtm: { type: Boolean, default: true },\n    mode: { type: String, default: '' },\n    url: { type: String, default: '' },\n    target: { type: String, default: 'body' },\n    overflowY: { type: String, default: 'hidden' },\n    overflowX: { type: String, default: 'hidden' },\n  });\n\n  const userStore = useUserStoreWithOut();\n  const emit = defineEmits(['update:visible', 'cancel', 'confirm', 'ok', 'close', 'open']); // 定义事件\n  const instance = ref();\n\n  const appDom = document.querySelector('div#app');\n\n  const closeModal = () => {\n    emit('update:visible', false); // 关闭弹框\n    emit('close');\n    dialogMaskClose();\n  };\n\n  const openModal = () => {\n    emit('update:visible', true); // 关闭弹框\n    emit('open');\n    dialogMaskOpen();\n  };\n\n  const cancel = () => {\n    emit('cancel'); // 发送取消事件\n    if (props.smode !== 'simple') {\n      //\n    } else {\n      emit('update:visible', false); // 关闭弹框\n      dialogMaskClose();\n    }\n  };\n\n  const confirm = () => {\n    emit('confirm'); // 发送确定事件\n    emit('ok'); // 发送确定事件\n    if (props.smode == 'simple') {\n      emit('update:visible', false); // 关闭弹框\n      dialogMaskClose();\n    }\n  };\n\n  // 计算 modal-body 的高度，减去 header 和 footer 的高度\n  const bodyHeight = computed(() => {\n    return props.height - props.pheight; // 64 是 header 和 footer 的高度之和\n  });\n\n  // 禁用事件回调函数\n  const callback = function (event) {\n    event.preventDefault();\n  };\n\n  // 在 setup 中创建一个变量来保存滚动位置\n  const scrollPosition = ref({ x: 0, y: 0 });\n\n  // 在弹出对话框时保存当前滚动位置\n  const saveScrollPosition = () => {\n    scrollPosition.value = {\n      x: window.pageXOffset || document.documentElement.scrollLeft,\n      y: window.pageYOffset || document.documentElement.scrollTop,\n    };\n    window.scrollTo(0, 0);\n  };\n\n  // 在关闭对话框时恢复滚动位置\n  const restoreScrollPosition = () => {\n    window.scrollTo(scrollPosition.value.x, scrollPosition.value.y);\n  };\n\n  // 禁止页面滚动事件\n  const disableScroll = () => {\n    if (props.target === 'body') {\n      saveScrollPosition();\n      appDom.addEventListener('mousewheel', callback, { passive: false });\n      nextTick(() => {\n        appDom.classList.add('modal-open');\n        dialogMaskOpen();\n      });\n    }\n  };\n\n  // 恢复页面滚动事件\n  const enableScroll = () => {\n    appDom.removeEventListener('mousewheel', callback, { passive: false });\n    appDom.classList.remove('modal-open');\n    dialogMaskClose();\n    restoreScrollPosition();\n  };\n\n  // 监听当前Dialog是否显示\n  watch(\n    () => props.visible,\n    (value) => {\n      if (value) {\n        disableScroll();\n      } else {\n        enableScroll();\n      }\n    },\n    { deep: true },\n  );\n\n  defineExpose({\n    closeModal,\n    openModal,\n  });\n\n  onMountedOrActivated(() => {\n    // 监听check-iframe-framepage消息\n    instance.value = getCurrentInstance();\n\n    MsgManager.getInstance().listen('iframe-dialog-close', () => {\n      closeModal();\n      enableScroll();\n    });\n\n    if (props.target === 'body' && props.visible) {\n      disableScroll();\n    }\n  });\n</script>\n\n<style lang=\"less\">\n  .ant-modal-wrap {\n    z-index: 10010;\n  }\n</style>\n<style lang=\"less\" scoped>\n  .modal-mask {\n    display: flex;\n    position: fixed;\n    z-index: 10000;\n    top: 0;\n    left: 0;\n    align-items: center;\n    justify-content: center;\n    width: 100%;\n    height: 100%;\n    background-color: rgb(0 0 0 / 15%);\n\n    .modal-mask-container {\n      display: flex;\n      position: absolute;\n      z-index: 10000;\n      top: 0;\n      left: 0;\n      align-items: center;\n      justify-content: center;\n      width: 100%;\n      height: 100%;\n      background-color: rgb(0 0 0 / 15%);\n    }\n  }\n\n  .modal-container {\n    z-index: 10005;\n    width: 400px;\n    max-width: 80%;\n    border-radius: 4px;\n    box-shadow: 0 2px 4px rgb(0 0 0 / 20%);\n    text-align: center;\n  }\n\n  .modal-header {\n    position: relative;\n    height: 54px;\n    padding: 0 5px 0 10px;\n    line-height: 54px;\n\n    span {\n      position: absolute;\n      top: 0;\n      left: 20px;\n    }\n  }\n\n  .modal-title {\n    font-size: 18px;\n    font-weight: bold;\n  }\n\n  .modal-body {\n    margin: 0;\n    padding: 10px 16px;\n\n    :deep(.ant-form-item-control) {\n      text-align: left;\n    }\n  }\n\n  .modal-footer {\n    height: 67px;\n    padding: 10px 16px;\n    line-height: 67px;\n    text-align: right;\n\n    .footer-button {\n      display: flex;\n      justify-content: flex-end;\n      align-items: center;\n      height: 100%;\n\n      button {\n        margin-right: 10px;\n        &:last-child {\n          margin-right: 0;\n        }\n      }\n    }\n  }\n\n  .modal-close {\n    position: absolute;\n    top: 7px;\n    right: 7px;\n    font-size: 16px;\n    cursor: pointer;\n  }\n\n  button.modal-close {\n    width: 30px;\n    height: 30px;\n    margin-left: 10px;\n    padding: 0 10px;\n    border: none;\n    border-radius: 4px;\n    background-color: transparent;\n    line-height: 30px;\n    cursor: pointer;\n  }\n\n  :deep(.ant-form-item-control) {\n    text-align: left;\n  }\n</style>\n"],"names":["useUserStoreWithOut","instance","ref","appDom","closeModal","emit","dialogMaskClose","openModal","dialogMaskOpen","cancel","props","confirm","bodyHeight","computed","callback","event","scrollPosition","saveScrollPosition","restoreScrollPosition","disableScroll","nextTick","enableScroll","watch","value","__expose","onMountedOrActivated","getCurrentInstance","MsgManager"],"mappings":"8rCA4HoBA,EAAoB,EAEtC,MAAMC,EAAWC,IAEXC,EAAS,SAAS,cAAc,SAAS,EAEzCC,EAAa,IAAM,CACvBC,EAAK,iBAAkB,EAAK,EAC5BA,EAAK,OAAO,EACIC,GAAA,EAGZC,EAAY,IAAM,CACtBF,EAAK,iBAAkB,EAAI,EAC3BA,EAAK,MAAM,EACIG,GAAA,EAGXC,EAAS,IAAM,CACnBJ,EAAK,QAAQ,EACTK,EAAM,QAAU,WAGlBL,EAAK,iBAAkB,EAAK,EACZC,IAClB,EAGIK,EAAU,IAAM,CACpBN,EAAK,SAAS,EACdA,EAAK,IAAI,EACLK,EAAM,OAAS,WACjBL,EAAK,iBAAkB,EAAK,EACZC,IAClB,EAIIM,EAAaC,EAAS,IACnBH,EAAM,OAASA,EAAM,OAC7B,EAGKI,EAAW,SAAUC,EAAO,CAChCA,EAAM,eAAe,CAAA,EAIjBC,EAAiBd,EAAI,CAAE,EAAG,EAAG,EAAG,EAAG,EAGnCe,EAAqB,IAAM,CAC/BD,EAAe,MAAQ,CACrB,EAAG,OAAO,aAAe,SAAS,gBAAgB,WAClD,EAAG,OAAO,aAAe,SAAS,gBAAgB,SAAA,EAE7C,OAAA,SAAS,EAAG,CAAC,CAAA,EAIhBE,EAAwB,IAAM,CAClC,OAAO,SAASF,EAAe,MAAM,EAAGA,EAAe,MAAM,CAAC,CAAA,EAI1DG,EAAgB,IAAM,CACtBT,EAAM,SAAW,SACAO,IACnBd,EAAO,iBAAiB,aAAcW,EAAU,CAAE,QAAS,GAAO,EAClEM,EAAS,IAAM,CACNjB,EAAA,UAAU,IAAI,YAAY,EAClBK,GAAA,CAChB,EACH,EAIIa,EAAe,IAAM,CACzBlB,EAAO,oBAAoB,aAAcW,EAAU,CAAE,QAAS,GAAO,EAC9DX,EAAA,UAAU,OAAO,YAAY,EACpBG,IACMY,GAAA,EAIxB,OAAAI,EACE,IAAMZ,EAAM,QACXa,GAAU,CACLA,EACYJ,IAEDE,GAEjB,EACA,CAAE,KAAM,EAAK,CAAA,EAGFG,EAAA,CACX,WAAApB,EACA,UAAAG,CAAA,CACD,EAEDkB,EAAqB,IAAM,CAEzBxB,EAAS,MAAQyB,IAEjBC,EAAW,YAAY,EAAE,OAAO,sBAAuB,IAAM,CAChDvB,IACEiB,GAAA,CACd,EAEGX,EAAM,SAAW,QAAUA,EAAM,SACrBS,GAChB,CACD"}