var g=(x,C,c)=>new Promise((T,h)=>{var m=i=>{try{p(c.next(i))}catch(t){h(t)}},f=i=>{try{p(c.throw(i))}catch(t){h(t)}},p=i=>i.done?T(i.value):Promise.resolve(i.value).then(m,f);p((c=c.apply(x,C)).next())});import{d as ae,ax as oe,aD as ne,r as B,k as v,o as se,al as u,Z as w,_ as ie,f as o,aa as n,$ as _,u as I,a9 as z,E as le,ac as E,J as A}from"./vue-71d1abb3.js";import{au as re,aB as me,av as ue,_ as ce}from"./index.js";import{U as pe}from"./UploadBox-636ecf02.js";import{B as de}from"./BasicTable-0434a334.js";import{T as fe}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as ve}from"./useTable-109483b3.js";import{a2 as H,P as _e}from"./antd-15ac76ed.js";import{B as be}from"./BillTitle-d17ab3e4.js";import{W as ge}from"./WfApproveBox-a3448232.js";import{c as he,a as ye}from"./index-37d352b6.js";import"./Dialog-0a006d82.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./index.esm-c216ed00.js";import"./index-fda2d66c.js";import"./index-c0893416.js";import"./index-33af41d1.js";import"./tree-fc0e156a.js";const Ie={class:"load"},Ce={class:"process-box"},Te={class:"content"},ke={class:"left-panel"},we={class:"clearfix"},xe={class:"clearfix"},De={class:"right-panel"},Se=ae({name:"OALeaveCreate",__name:"detail",setup(x){const C=oe(),{query:c}=ne(),T={span:2},h={span:12},m=B({});m.title="请假申请",m.infoItems=[];const f=v([]),p=v(null),i=v(),t=B({id:"",type:"",startTime:void 0,endTime:void 0,reason:"",status:0,spinning:!1,bizFileId:""}),M={type:[{required:!0,message:"请选择请假类型",trigger:"change"}],startTime:[{required:!0,message:"请选择开始时间",trigger:"change"}],endTime:[{required:!0,message:"请选择结束时间",trigger:"change"}],reason:[{required:!0,message:"请输入请假事由",trigger:"blur"}]},{createMessage:y}=re(),d=v(""),Y=v([]),D=v(),F=()=>{const e=V(),a={key:`${Date.now()}`};e.push(a)},N=[{title:"附件",dataIndex:"name6",editRow:!0,align:"left",editComponent:"UploadBox",editComponentProps:{width:800,height:550,maxCount:20,maxSize:100*1024*1024,application:"po",module:"oaleave",bizId:()=>t.bizFileId,callback:(e,a)=>{D.value}},width:150}],[U,{getDataSource:V}]=ve({columns:N,showIndexColumn:!1,showTableSetting:!0,tableSetting:{fullScreen:!0},actionColumn:{width:160,title:"操作",dataIndex:"action"},dataSource:Y});function q({column:e,value:a,record:s}){e.dataIndex==="id"&&(s.editValueRefs.name4.value=`${a}`),console.log(e,a,s)}function L(e){var a;try{Reflect.has(d,"value")&&(d.value=e.key,D.value=e,(a=e.onEdit)==null||a.call(e,!0))}catch(s){}}function O(e){return g(this,null,function*(){var s,l;if(y.loading({content:"正在保存...",duration:0,key:"saving"}),yield(s=e.onValid)==null?void 0:s.call(e))try{const b=_e(e.editValueRefs);console.log(b),(yield(l=e.onEdit)==null?void 0:l.call(e,!1,!0))&&(d.value=""),y.success({content:"数据已保存",key:"saving"})}catch(b){y.error({content:"保存失败",key:"saving"})}else y.error({content:"请填写正确的数据",key:"saving"})})}function P(e){var a;try{Reflect.has(d,"value")&&(d.value="",(a=e.onEdit)==null||a.call(e,!1,!1))}catch(s){}}function $(e){return e.editable?[{label:"保存",onClick:O.bind(null,e)},{label:"取消",popConfirm:{title:"是否取消编辑",confirm:P.bind(null,e)}}]:[{label:"编辑",disabled:d.value?d.value!==e.key:!1,onClick:L.bind(null,e)}]}const K=()=>{S(0)},W=()=>{i.value.validate().then(()=>{const e=A(t);if(!Z(e.endTime,e.startTime)){j("请确认开始时间和结束时间。");return}S(1)}).catch(e=>{console.log("onSubmit=》error",e)})},S=e=>g(this,null,function*(){t.spinning=!0;try{const a=A(t);a.status=e,console.log("formData",a),yield he(a),G(e==1?"提交成功。":"保存成功"),C.push("/hr/manage/oaleave")}catch(a){console.log("error",a)}finally{t.spinning=!1}}),J=()=>g(this,null,function*(){ye(t.id).then(e=>{t.type=e.type+"",t.startTime=e.startTime,t.endTime=e.endTime,t.reason=e.reason,t.status=e.status,t.bizFileId=e.bizFileId,t.status>0&&(m.infoItems.push({key:"billCode",label:"单据编号",value:e.billCode,position:"left"}),m.infoItems.push({key:"fillinDate",label:"制单日期",value:e.fillinDate,position:"center"}),m.infoItems.push({key:"createPerson",label:"创建人",value:e.deptName+"."+e.personMemberName,position:"right"}))})});se(()=>g(this,null,function*(){f.value.push({label:"病假",value:"1"}),f.value.push({label:"事假",value:"2"}),f.value.push({label:"婚假",value:"3"}),c.processInstanceId&&(p.value=c.processInstanceId,me(p.value).then(e=>{t.id=e.businessKey,J()}))}));const Z=(e,a)=>{let s=new Date(Date.parse(e)),l=new Date(Date.parse(a));return s>l},j=e=>{H.warning(e)},G=e=>{H.success(e)};return(e,a)=>{const s=u("a-select"),l=u("a-form-item"),b=u("a-date-picker"),R=u("a-textarea"),Q=u("a-form"),k=u("a-card"),X=u("a-button"),ee=u("a-spin");return w(),ie("div",Ie,[o(ee,{spinning:t.spinning,tip:"Loading..."},{default:n(()=>[_("div",Ce,[o(be,{options:m},null,8,["options"]),_("div",Te,[_("div",ke,[o(k,{title:"基本信息"},{default:n(()=>[o(Q,{"label-col":T,"wrapper-col":h,ref_key:"formRef",ref:i,model:t,rules:M},{default:n(()=>[o(l,{label:"请假类型",name:"type"},{default:n(()=>[o(s,{value:t.type,"onUpdate:value":a[0]||(a[0]=r=>t.type=r),allowClear:"",options:f.value,placeholder:"请选择请假类型",disabled:t.status!=0},null,8,["value","options","disabled"])]),_:1}),o(l,{label:"开始时间",name:"startTime"},{default:n(()=>[o(b,{value:t.startTime,"onUpdate:value":a[1]||(a[1]=r=>t.startTime=r),"show-time":{format:"HH:mm:mm"},valueFormat:"YYYY-MM-DD HH:mm:mm",placeholder:"请选择",disabled:t.status!=0},null,8,["value","disabled"])]),_:1}),o(l,{label:"结束时间",name:"endTime"},{default:n(()=>[o(b,{value:t.endTime,"onUpdate:value":a[2]||(a[2]=r=>t.endTime=r),"show-time":{format:"HH:mm:mm"},valueFormat:"YYYY-MM-DD HH:mm:mm",placeholder:"请选择",disabled:t.status!=0},null,8,["value","disabled"])]),_:1}),o(l,{label:"请假事由",name:"reason"},{default:n(()=>[o(R,{value:t.reason,"onUpdate:value":a[3]||(a[3]=r=>t.reason=r),disabled:t.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},8,["model"])]),_:1}),o(k,{title:"附件信息"},{default:n(()=>[_("div",we,[o(pe,{width:800,height:550,maxCount:20,maxSize:100*1024*1024,application:"po",module:"inventory",vmode:t.status==0?"box":"view",bizId:t.bizFileId},null,8,["vmode","bizId"])])]),_:1}),o(k,{title:"表格附件信息"},{default:n(()=>[_("div",xe,[o(I(de),{onRegister:I(U),onEditChange:q},{toolbar:n(()=>[t.status===0?(w(),z(X,{key:0,type:"primary",preIcon:I(ue).ADD,onClick:F},{default:n(()=>[le(" 添加 ")]),_:1},8,["preIcon"])):E("",!0)]),bodyCell:n(({column:r,record:te})=>[r.key==="action"?(w(),z(I(fe),{key:0,actions:$(te)},null,8,["actions"])):E("",!0)]),_:1},8,["onRegister"])])]),_:1})]),_("div",De,[o(ge,{onSave:K,onSubmit:W,processStatus:t.status,processInstanceId:p.value},null,8,["processStatus","processInstanceId"])])])])]),_:1},8,["spinning"])])}}});const it=ce(Se,[["__scopeId","data-v-529b56f7"]]);export{it as default};
//# sourceMappingURL=detail-90265018.js.map
