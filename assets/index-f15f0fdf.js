var B=Object.defineProperty;var C=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var T=(a,o,n)=>o in a?B(a,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[o]=n,k=(a,o)=>{for(var n in o||(o={}))V.call(o,n)&&T(a,n,o[n]);if(C)for(var n of C(o))j.call(o,n)&&T(a,n,o[n]);return a};var u=(a,o,n)=>new Promise((h,d)=>{var c=s=>{try{m(n.next(s))}catch(g){d(g)}},r=s=>{try{m(n.throw(s))}catch(g){d(g)}},m=s=>s.done?h(s.value):Promise.resolve(s.value).then(c,r);m((n=n.apply(a,o)).next())});import{P as H}from"./index-20519caf.js";import{a0 as $,a5 as _,aj as q,au as L,b as W,a7 as K,av as b,ax as S,at as x,_ as U}from"./index.js";import{B as X}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as Z}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{s as G,a as J}from"./stationTree-56a32762.js";import"./index-316f6ffb.js";import{u as Q}from"./useRender-21ce56fb.js";import{e as ee}from"./download-03e71dd5.js";import{d as te,k as D,o as ae,al as oe,Z as ne,a9 as re,aa as p,f,$ as se,u as l,E as y,ad as I}from"./vue-71d1abb3.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./CommonTree-c4ed7838.js";import"./index-3801a970.js";function ie(a){return _.get({url:"/po/safety-tools/page",params:a})}function le(a){return _.delete({url:"/po/safety-tools/delete?id="+a})}function ce(a){return _.download({url:"/po/safety-tools/export-excel",params:a},{isReturnNativeResponse:!0})}const de={0:"#fb5252",1:"#4ace6e",2:"#fda941",3:"#929292",4:"#338ed1"},ue=[{title:"所属公司",dataIndex:"stationOrganName",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0,ifShow:$().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"工器具名称",dataIndex:"name",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"工器具编码",dataIndex:"code",align:"left",headAlign:"center",width:180,sorter:!0,resizable:!0},{title:"规格型号",dataIndex:"specification",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"购买日期",dataIndex:"purchasingDate",width:120,sorter:!0,resizable:!0},{title:"检验周期(月)",dataIndex:"cycle",align:"right",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"计划下次检验日期",dataIndex:"nextCheckDate",width:120,sorter:!0,resizable:!0},{title:"检验次数",dataIndex:"checkTimes",align:"right",headAlign:"center",width:120,sorter:!0,resizable:!0},{title:"有效性",dataIndex:"toolsStatusText",sorter:!0,resizable:!0,customRender:({text:a,record:o})=>Q.renderTag(a,de[o.toolsStatus])}],pe=[{label:"工器具名称",field:"name",component:"Input",colProps:{span:7}},{label:"工器具编码",field:"code",component:"Input",colProps:{span:7}},{label:"规格型号",field:"specification",component:"Input",colProps:{span:7}},{field:"[nextCheckDateStart, nextCheckDateEnd]",label:"计划下次检验日期",component:"RangePicker",colProps:{span:7},componentProps:{format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",placeholder:["开始日期","结束日期"]}},{label:"有效性",field:"toolStatus",colProps:{span:7},component:"DictSelectBox",componentProps:{type:"safety_tools_status"}}],fe={class:"right-table-layout"},me=te({__name:"index",setup(a){let{params:o}=q();const{createConfirm:n,createMessage:h}=L(),{t:d}=W();let c=D("");const r=D({name:"",code:o.code,specification:"",nextCheckDate:"",bizStatus:"",toolStatus:o.toolStatus,pageNo:1,pageSize:10,sortField:"purchasingDate",sortOrder:"desc"}),[m,{reload:s,getPaginationRef:g,getForm:v,getSelectRows:w}]=Z({title:"安全工器具台账",api:()=>u(this,null,function*(){const e=g();return r.value.pageNo=e.current,r.value.pageSize=e.pageSize,(yield ie(r.value)).result}),columns:ue,rowKey:"id",formConfig:{labelWidth:120,showAdvancedButton:!0,autoAdvancedLine:1,schemas:pe},bordered:!0,useSearchForm:!0,showTableSetting:!0,rowSelection:{type:"radio",fixed:!0,onSelect:z},sortFn:e=>{e.order?(r.value.sortField=e.field.replace("Text",""),r.value.sortOrder=e.order.replace("end","")):(r.value.sortField="purchasingDate",r.value.sortOrder="desc")},handleSearchInfoFn(e){for(const t in e)r.value[t]=e[t]}});function z(e,t){t?c.value=e.id:c.value=""}function P({keys:e,rows:t}){if(t&&t.length>0){const i=t[0];c.value=i.id}else c.value=""}function O(e){J(e,r,{powerStationCode:""},s)}const R=(e,t,i)=>{S(`/po/safetytools/safetytools/create?id=${e.id}&status=1`,"查看安全工器具")};function F(){if(!r.value.stationId){x.getInstance().info("请选中电站添加");return}S("/po/safetytools/safetytools/create?id=","添加安全工器具",{stationId:r.value.stationId,stationName:r.value.stationName,stationOrganId:r.value.stationOrganId,stationOrganName:r.value.stationOrganName,powerStationCode:r.value.powerStationCode})}function M(){let e=w();if(e.length!==1)return x.getInstance().info("请选择一条数据."),!1;let t=e[0];S(`/po/safetytools/safetytools/create?id=${t.id}`,t.status==0?"修改安全工器具":"查看安全工器具")}function N(){return u(this,null,function*(){let e=w();if(e.length!==1)return x.getInstance().info("请选择一条数据."),!1;let t=e[0];n({title:"提示",iconType:"warning",content:"确定要删除选中的记录？",onOk(){return u(this,null,function*(){if(t.bizStatus==3)return x.getInstance().info("已生成报废单，不能删除."),!1;yield le(t.id),h.success("删除成功"),s()})}})})}function A(){return u(this,null,function*(){n({title:d("common.exportTitle"),iconType:"warning",content:d("common.exportMessage"),onOk(){return u(this,null,function*(){let t=v().getFieldsValue();Object.assign(t,r.value),yield ce(t).then(i=>{ee(i==null?void 0:i.data,"安全工器具台账.xls")}),h.success(d("common.exportSuccessText"))})}})})}return ae(()=>{v().setFieldsValue(k({},o)),K.getInstance().listen("safety-tools",()=>{s()})}),(e,t)=>{const i=oe("a-button");return ne(),re(l(H),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:p(()=>[f(G,{onSelectTree:O}),se("div",fe,[f(l(X),{onRegister:l(m),class:"fix-basic-table",onResizeColumn:t[0]||(t[0]=(E,Y)=>Y.width=E),onSelectionChange:P,onRowDbClick:R},{toolbar:p(()=>[f(i,{type:"primary",preIcon:l(b).ADD,onClick:F},{default:p(()=>[y(I("添加"))]),_:1},8,["preIcon"]),f(i,{type:"primary",disabled:l(c)=="",preIcon:l(b).EDIT,onClick:M},{default:p(()=>[y(I("修改"))]),_:1},8,["disabled","preIcon"]),f(i,{class:"red-btn",disabled:l(c)=="",preIcon:l(b).DELETE,onClick:N},{default:p(()=>[y(I("删除"))]),_:1},8,["disabled","preIcon"]),f(i,{class:"yellow-btn",preIcon:l(b).EXPORT,onClick:A},{default:p(()=>[y(I("导出"))]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])])]),_:1})}}});const qe=U(me,[["__scopeId","data-v-1f731b7b"]]);export{qe as default};
//# sourceMappingURL=index-f15f0fdf.js.map
