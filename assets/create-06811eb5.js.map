{"version":3,"file":"create-06811eb5.js","sources":["../../src/views/po/inspection/inspectionplan/create.vue"],"sourcesContent":["<template>\n  <PageWrapper dense contentFullHeight fixedHeight  contentClass=\"flex\" style=\"position: relative\">\n  <div class=\"load\">\n\t<a-spin :spinning=\"formState.spinning\" tip=\"Loading...\">\n  <div class=\"process-box\">\n    <div class=\"header-box\">\n      <BillTitle :options=\"billTitle\" />\n      <div class=\"header-right\"  >\n          <a-button type=\"primary\" html-type=\"submit\" \n               @click=\"onFinish\">保存</a-button>\n        </div>\n    </div>\n    <div class=\"content\">\n      <a-form\n        :model=\"formState\"\n        name=\"basic\"\n        ref=\"formRef\"\n        autocomplete=\"off\"\n      >\n        <a-card title=\"基本信息\" :bordered=\"false\">\n          <a-row :gutter=\"32\">\n            <a-col :span=\"12\">\n              <a-form-item\n                label=\"主题\"\n                name=\"subject\"\n                :labelCol=\"{ style: { width: '124px'} }\" \n                :rules=\"[{ required: true, message: '主题不能为空。' }]\"\n              >\n                <a-input\n                  v-model:value=\"formState.subject\"\n                  :disabled=\"formState.editable != 0\"\n                  maxlength=\"128\"\n                />\n              </a-form-item>\n            </a-col>\n            <a-col :span=\"12\">\n              <a-form-item\n                label=\"巡检区域\"\n                name=\"inspectionAreaType\"\n                :labelCol=\"{ style: { width: '124px'} }\" \n                :rules=\"[{ required: true, message: '巡检区域不能为空。' }]\"\n              >\n                <DictSelectBox\n                  :type=\"`commDeviceCategory`\"\n                  :disabled=\"formState.editable != 0\"\n                  v-model:value=\"formState.inspectionAreaType\"\n                  style=\"width: 100%\"\n                />\n              </a-form-item>\n            </a-col>\n   \n\n            <a-col :span=\"24\">\n              <a-form-item\n                label=\"巡检要求\"\n                name=\"requirement\"\n                :labelCol=\"{ style: { width: '124px'} }\" \n                :rules=\"[{ required: true, message: '巡检要求不能为空' }]\"\n              >\n                <a-textarea\n                  v-model:value=\"formState.requirement\"\n                  row=\"3\"\n                  maxlength=\"1000\"\n                  :disabled=\"formState.editable != 0\"\n                />\n              </a-form-item>\n            </a-col>\n          </a-row>\n        </a-card>\n      </a-form>\n      <a-card title=\"\" :bordered=\"false\">\n        <div id=\"more-tab-content\" class=\"tab-table-div\">\n        <a-tabs v-model:activeKey=\"activeKey\" @change=\"switchCom\">\n          <a-tab-pane key=\"dtlChild\" tab=\"巡检清单\">\n            <dtlList ref=\"dtlChild\" />\n          </a-tab-pane>\n          <a-tab-pane key=\"stationChild\" tab=\"电站\" force-render>\n            <stationList ref=\"stationChild\" />\n          </a-tab-pane>\n        </a-tabs>\n      </div>\n      </a-card>\n    </div>\n  </div>\n  </a-spin>\n  </div>\n</PageWrapper>\n</template>\n<script lang=\"ts\" setup>\n  import { PageWrapper } from '/@/components/Page';\n  import { reactive, ref, onMounted } from 'vue';\n  import { urlToPath } from '/@/utils/route';\n  import { FormInstance } from 'ant-design-vue';\n  // import PrintButton from '/@/components/Framework/Button/PrintButton.vue';\n  import {  getPlanData, createPlan } from './create';\n  import DictSelectBox from '@/components/Framework/Combox/DictSelectBox.vue';\n  import BillTitle from '/@/components/Framework/BillTitle/BillTitle.vue';\n  import dtlList from './dtlList.vue';\n  import stationList from './stationList.vue';\n  import { SysMessage } from '/@/hooks/web/useMessage';\n\n  // import { closeCurrentTab } from '@/utils/route';\n  import { getDictDataMap } from '/@/api/bpm/system/dict/data';\n\n  import { MsgManager } from '/@/message/MsgManager';\n\n\n  \n  const isRequire = ref(true);\n  const checkPeriodList = ref([]);\n\n  const formRef = ref<FormInstance>();\n\n\n  const dtlChild: any = ref(null);\n  const stationChild: any = ref(null);\n  const activeKey = ref('dtlChild');\n\n  const switchCom = (index) => {\n    dtlChild.value.reloadGrid({ inspectionPlanId: formState.id,activeKey:activeKey.value });\n    stationChild.value.reloadGrid({ inspectionPlanId: formState.id,activeKey:activeKey.value });\n  };\n\n  let {params:query} = urlToPath() as any;\n  const formState:any = reactive({\n    id: query.id || '',\n    status: 0,\n    spinning:false,\n  });\n  const billTitle = reactive<any>({subject : '巡检计划'});\n \n  const onFinish = () => {\n    const value = formRef.value;\n    if (!value) {\n      return;\n    }\n    value\n      .validateFields()\n      .then(() => {\n        formState.dtl = dtlChild.value.getDataSource();\n        let stationList = stationChild.value.getDataSource();\n        for(let i=0;i<stationList.length;i++){\n          let e = stationList[i];\n          if(!e.inspectionPeriod){\n            SysMessage.getInstance().error('巡检频率不能为空.');\n              return false;\n          }\n          if(!e.acount){\n            SysMessage.getInstance().error('次数不能为空.');\n              return false;\n          }\n          if(!e.startDate){\n            SysMessage.getInstance().error('起算日期不能为空.');\n              return false;\n          }\n        }\n        \n        formState.stationDtl = stationList;\n        formState.spinning=true;\n        createPlan(formState)\n          .then((rsp) => {\n            if (rsp.result != '') {\n              formState.id = rsp.result;\n              dtlChild.value.reloadGrid({ inspectionPlanId: formState.id,forceReload:true });\n              stationChild.value.reloadGrid({ inspectionPlanId: formState.id,forceReload:true });\n              SysMessage.getInstance().success( '保存成功.');\n              MsgManager.getInstance().sendMsg('inspection-plan', {});\n\n            } else {\n              formState.status = 0;\n            \n              SysMessage.getInstance().error('保存失败.');\n            }\n            formState.spinning=false;\n          })\n          .catch((e) => {\n            isRequire.value = false;\n            formState.status = 0;\n            formState.spinning=false;\n            console.log(e);\n          });\n    });\n  };\n\n\n  // global\n  onMounted(async () => {\n    getPlanData({ id: formState.id }).then((rsp) => {\n      let rs = rsp.result;\n      if (formState.id) {\n        for (let key in rs) {\n          formState[key] = rs[key];\n        }\n        formState.status = Number(formState.status);\n      } else {\n        formState.billCode = rs.billCode;\n        formState.personMemberName = rs.personMemberName;\n        formState.fillinDate = rs.fillinDate;\n        formState.deptName=rs.deptName;\n        formState.editable=0;\n      }\n      let { billCode, fillinDate, personMemberName,deptName } = rs;\n      Object.assign(billTitle, { billCode, fillinDate, personMemberName,deptName });\n      dtlChild.value.reloadGrid({ inspectionPlanId: formState.id });\n\n    });\n    const response = await getDictDataMap({ dictTypeList: 'check_period' });\n    checkPeriodList.value = response.result.check_period;\n  });\n</script>\n\n<style lang=\"less\" scoped>\n  .customer_require::before {\n    content: '*';\n    display: inline-block;\n    margin-right: 4px;\n    color: #ff4d4f;\n    font-family: SimSun, sans-serif;\n    font-size: 14px;\n    line-height: 1;\n  }\n\n  :deep(.vben-basic-table-header__toolbar) {\n    margin-top: 8px;\n  }\n</style>\n"],"names":["isRequire","ref","checkPeriodList","formRef","dtlChild","stationChild","activeKey","switchCom","index","formState","query","urlToPath","reactive","billTitle","onFinish","value","stationList","i","e","SysMessage","createPlan","rsp","MsgManager","onMounted","__async","getPlanData","rs","key","billCode","fillinDate","personMemberName","deptName","response","getDictDataMap"],"mappings":"uiDA4GQ,MAAAA,EAAYC,EAAI,EAAI,EACpBC,EAAkBD,EAAI,CAAA,CAAE,EAExBE,EAAUF,IAGVG,EAAgBH,EAAI,IAAI,EACxBI,EAAoBJ,EAAI,IAAI,EAC5BK,EAAYL,EAAI,UAAU,EAE1BM,EAAaC,GAAU,CAClBJ,EAAA,MAAM,WAAW,CAAE,iBAAkBK,EAAU,GAAG,UAAUH,EAAU,KAAA,CAAO,EACzED,EAAA,MAAM,WAAW,CAAE,iBAAkBI,EAAU,GAAG,UAAUH,EAAU,KAAA,CAAO,CAAA,EAG5F,GAAI,CAAC,OAAOI,CAAK,EAAIC,EAAU,EAC/B,MAAMF,EAAgBG,EAAS,CAC7B,GAAIF,EAAM,IAAM,GAChB,OAAQ,EACR,SAAS,EAAA,CACV,EACKG,EAAYD,EAAc,CAAC,QAAU,MAAO,CAAA,EAE5CE,EAAW,IAAM,CACrB,MAAMC,EAAQZ,EAAQ,MACjBY,GAIFA,EAAA,iBACA,KAAK,IAAM,CACAN,EAAA,IAAML,EAAS,MAAM,cAAc,EACzCY,IAAAA,EAAcX,EAAa,MAAM,cAAc,EACnD,QAAQY,EAAE,EAAEA,EAAED,EAAY,OAAOC,IAAI,CAC/B,IAAAC,EAAIF,EAAYC,CAAC,EAClB,GAAA,CAACC,EAAE,iBACO,OAAAC,EAAA,YAAA,EAAc,MAAM,WAAW,EACjC,GAER,GAAA,CAACD,EAAE,OACO,OAAAC,EAAA,YAAA,EAAc,MAAM,SAAS,EAC/B,GAER,GAAA,CAACD,EAAE,UACO,OAAAC,EAAA,YAAA,EAAc,MAAM,WAAW,EACjC,EAEb,CAEAV,EAAU,WAAaO,EACvBP,EAAU,SAAS,GACnBW,EAAWX,CAAS,EACjB,KAAMY,GAAQ,CACTA,EAAI,QAAU,IAChBZ,EAAU,GAAKY,EAAI,OACVjB,EAAA,MAAM,WAAW,CAAE,iBAAkBK,EAAU,GAAG,YAAY,GAAM,EAChEJ,EAAA,MAAM,WAAW,CAAE,iBAAkBI,EAAU,GAAG,YAAY,GAAM,EACtEU,EAAA,YAAA,EAAc,QAAS,OAAO,EACzCG,EAAW,YAAY,EAAE,QAAQ,kBAAmB,CAAE,CAAA,IAGtDb,EAAU,OAAS,EAERU,EAAA,YAAA,EAAc,MAAM,OAAO,GAExCV,EAAU,SAAS,EAAA,CACpB,EACA,MAAOS,GAAM,CACZlB,EAAU,MAAQ,GAClBS,EAAU,OAAS,EACnBA,EAAU,SAAS,GACnB,QAAQ,IAAIS,CAAC,CAAA,CACd,CAAA,CACN,CAAA,EAKH,OAAAK,EAAU,IAAYC,EAAA,sBACRC,EAAA,CAAE,GAAIhB,EAAU,EAAA,CAAI,EAAE,KAAMY,GAAQ,CAC9C,IAAIK,EAAKL,EAAI,OACb,GAAIZ,EAAU,GAAI,CAChB,QAASkB,KAAOD,EACJjB,EAAAkB,CAAG,EAAID,EAAGC,CAAG,EAEflB,EAAA,OAAS,OAAOA,EAAU,MAAM,CAAA,MAE1CA,EAAU,SAAWiB,EAAG,SACxBjB,EAAU,iBAAmBiB,EAAG,iBAChCjB,EAAU,WAAaiB,EAAG,WAC1BjB,EAAU,SAASiB,EAAG,SACtBjB,EAAU,SAAS,EAErB,GAAI,CAAE,SAAAmB,EAAU,WAAAC,EAAY,iBAAAC,EAAiB,SAAAC,GAAaL,EAC1D,OAAO,OAAOb,EAAW,CAAE,SAAAe,EAAU,WAAAC,EAAY,iBAAAC,EAAiB,SAAAC,EAAU,EAC5E3B,EAAS,MAAM,WAAW,CAAE,iBAAkBK,EAAU,GAAI,CAAA,CAE7D,EACD,MAAMuB,EAAW,MAAMC,EAAe,CAAE,aAAc,cAAgB,CAAA,EACtD/B,EAAA,MAAQ8B,EAAS,OAAO,YAAA,EACzC"}