{"version":3,"file":"create-c692df2c.js","sources":["../../src/views/po/danger/create.ts","../../src/views/po/danger/create.vue"],"sourcesContent":["import { defHttp } from '@/utils/http/axios';\n\nenum Api {\n  //查询隐患内容\n  addHiddenDangerData = '/po/hidden-danger/create',\n  getHiddenDangerData = '/po/hidden-danger/get',\n  //发现人\n  getStationPerson = '/baseset/common/list-stationPerson?stationId=',\n}\n\n//执行单据\nexport function getHiddenDangerData(params) {\n  return defHttp.get({ url: Api.getHiddenDangerData, params });\n}\n\n// 新增安全检查模版\nexport function addHiddenDangerData(data) {\n  return defHttp.post({ url: Api.addHiddenDangerData, data });\n}\n//发现人\nexport function getStationPerson(data) {\n  return defHttp.post({ url: Api.getStationPerson + data.stationId });\n}\n","<template>\n  <PageWrapper dense contentFullHeight fixedHeight  contentClass=\"flex\" style=\"position: relative\">\n  <div class=\"load\">\n    <a-spin :spinning=\"formState.spinning\" tip=\"Loading...\">\n    <div class=\"process-box\">\n      <div class=\"header-box\">\n        <BillTitle :options=\"billTitleOptions\" />\n        <div class=\"header-right\"  v-if=\"query.readonly !== '1'\">\n          <a-button type=\"primary\" html-type=\"submit\" \n               @click=\"onFinish\">保存</a-button>\n        </div>\n      </div>\n      <div class=\"content\">\n        <a-form\n          :model=\"formState\"\n          name=\"basic\"\n          ref=\"formRef\"\n          autocomplete=\"off\"\n          \n        >\n          <a-card title=\"基本信息\" :bordered=\"false\">\n            <a-row :gutter=\"32\">\n              <a-col :span=\"12\">\n                <a-form-item\n                  label=\"电站名称\"\n                  name=\"stationName\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: false }]\"\n                >\n                  <a-input v-model:value=\"formState.stationName\" disabled />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"12\">\n                <a-form-item\n                  label=\"发现时间\"\n                  name=\"hanppendDate\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: false }]\"\n                >\n                  <a-input v-model:value=\"formState.hanppendDate\" disabled />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"12\">\n                <a-form-item\n                  label=\"隐患类别\"\n                  name=\"hiddenDangerType\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: true, message: '请选择隐患类别' }]\"\n                >\n                  <DictSelectBox\n                    :type=\"`hidden_danger_type`\"\n                    :disabled=\"disabledInput\"\n                    v-model:value=\"formState.hiddenDangerType\"\n                    style=\"width: 100%\"\n                  />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"12\">\n                <a-form-item\n                  label=\"来源任务\"\n                  name=\"sourceBillCode\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: false }]\"\n                >\n                  <!-- <a-input\n                    v-model:value=\"formState.sourceBillCode\"\n                    disabled\n                    style=\"color: blue; text-decoration: underline; cursor: pointer\"\n                  /> -->\n                  <a-button type=\"link\" @click=\"forwardPage\">{{ formState.sourceBillCode }}</a-button>\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"12\">\n                <a-form-item\n                  label=\"发现人\"\n                  name=\"findById\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: true, message: '发现人' }]\"\n                >\n                  <a-select\n                    v-model:value=\"formState.findById\"\n                    allowClear\n                    :options=\"findList\"\n                    :disabled=\"disabledInput\"\n                    @change=\"\n                      (id, item) => {\n                        formState.findById = id;\n                        formState.findByName = item.label;\n                      }\n                    \"\n                  />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"24\">\n                <a-form-item\n                  label=\"检查内容\"\n                  name=\"resultContent\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: true, message: '检查内容' }]\"\n                >\n                  <a-textarea\n                    v-model:value=\"formState.resultContent\"\n                    row=\"3\"\n                    :disabled=\"disabledInput\"\n                    maxlength=\"512\"\n                  />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"24\">\n                <a-form-item\n                  label=\"检查情况\"\n                  name=\"result\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: true, message: '检查情况' }]\"\n                >\n                  <a-textarea\n                    v-model:value=\"formState.result\"\n                    row=\"3\"\n                    :disabled=\"disabledInput\"\n                    maxlength=\"128\"\n                  />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"24\">\n                <a-form-item\n                  label=\"计划整改措施\"\n                  name=\"rectificationMeasures\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: true, message: '计划整改措施' }]\"\n                >\n                  <a-textarea\n                    v-model:value=\"formState.rectificationMeasures\"\n                    row=\"3\"\n                    :disabled=\"disabledInput\"\n                    maxlength=\"512\"\n                  />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"12\">\n                <a-form-item\n                  label=\"计划完成日期\"\n                  name=\"finishedRectificationDate\"\n                  :labelCol=\"{ style: { width: '124px'} }\" \n                  :rules=\"[{ required: true, message: '计划完成日期' }]\"\n                >\n                  <a-date-picker\n                    v-model:value=\"formState.finishedRectificationDate\"\n                    show-time\n                    style=\"width: 100%;\"\n                    valueFormat=\"YYYY-MM-DD HH:mm\"\n                    format=\"YYYY-MM-DD HH:mm\"\n                    :disabled=\"disabledInput\"\n                  />\n                </a-form-item>\n              </a-col>\n            </a-row>\n          </a-card>\n          <a-card title=\"附件上传\" :bordered=\"false\">\n            <UploadBox\n              :width=\"800\"\n              :height=\"550\"\n              :maxCount=\"20\"\n              :maxSize=\"100 * 1024 * 1024\"\n              :application=\"`po`\"\n              :module=\"`inventory`\"\n              :vmode=\"!disabledInput ? `box` : `view`\"\n              :bizId=\"formState.bizFileId\"\n            />\n          </a-card>\n        </a-form>\n      </div>\n    </div>\n  </a-spin>\n  </div>\n</PageWrapper>\n</template>\n<script lang=\"ts\" setup>\n  //form\n  import { PageWrapper } from '/@/components/Page';\n  import { reactive, ref, onMounted,toRaw,computed } from 'vue';\n  import { SysMessage } from '/@/hooks/web/useMessage';\n  import { MsgManager } from '/@/message/MsgManager';\n  import { FormInstance } from 'ant-design-vue';\n  // import PrintButton from '/@/components/Framework/Button/PrintButton.vue';\n  import { addHiddenDangerData, getHiddenDangerData, getStationPerson } from './create';\n  import DictSelectBox from '@/components/Framework/Combox/DictSelectBox.vue';\n  import BillTitle from '/@/components/Framework/BillTitle/BillTitle.vue';\n  import { closeCurrentTab, addTabPage } from '@/utils/route';\n  import UploadBox from '@/components/Framework/Combox/UploadBox.vue';\n  import { buildShortUUID } from '@/utils/uuid';\n  import { urlToPath } from '/@/utils/route';\n  import { useUserStore } from '/@/store/modules/user';\n\n\n  const userStore = useUserStore();\n  const userInfo = toRaw(userStore.getUserInfo);\n\n\n  const disabledInput=computed(()=>{\n    return query.readonly===\"1\" || (formState.workBillId!=null && formState.workBillId!='') \n        || (formState.sourceId!=null && formState.sourceId!='')\n        ||  (formState.personMemberId !='' && formState.personMemberId.substring(0,32) != userInfo.userId);\n  })\n  let {params:query} = urlToPath() as any;\n  const findList: any = ref([]);\n  const formRef = ref<FormInstance>();\n  const formState:any = reactive({\n    id: query.id || '',\n    status: 0,\n    stationOrganId: query.stationOrganId || '',\n    stationOrganName: query.stationOrganName || '',\n    stationId: query.stationId || '',\n    stationName: query.stationName || '',\n    hanppendDate: '',\n    hiddenDangerType: '',\n    hiddenType: '',\n    sourceParentId: '',\n    personMemberId: '',\n    sourceId: '',\n    sourceType: '',\n    findById: '',\n    findByName: '',\n    sourceBillCode: '',\n    resultContent: '',\n    result: '',\n    billCode: '',\n    fillinDate: '',\n    rectificationMeasures: '',\n    finishedRectificationDate: '',\n    bizFileId: '',\n    spinning:false,\n  });\n\n  const forwardPage = () => {\n    if (!formState.sourceId || !formState.sourceParentId) {\n      return;\n    }\n    switch (formState.sourceType) {\n      case 'dqSafeCheckExecution':\n      case 'zxSafeCheckExecution':\n        // router.push({\n        //   path: `/po/safety/safecheckexecution/create/checkType__1`,\n        //   query: { id: formState.sourceParentId },\n        // });\n        addTabPage(`/po/safety/safecheckexecution/create/checkType__1`, '', {\n          id: formState.sourceParentId,\n          checkType: 1,\n        });\n        break;\n      case 'inspectionExecution':\n        // router.push({\n        //   path: `/po/inspection/inspectionexecution/create`,\n        //   query: { id: formState.sourceParentId },\n        // });\n        addTabPage(`/po/inspection/inspectionexecution/create`, '', {\n          id: formState.sourceParentId,\n        });\n        break;\n      case 'vehicleExecution':\n        // router.push({\n        //   path: `/po/safety/vehicleexecution/create`,\n        //   query: { id: formState.sourceParentId },\n        // });\n        addTabPage(`/po/safety/vehicleexecution/create`, '', { id: formState.sourceParentId });\n        break;\n    }\n  };\n\n  const onFinish = () => {\n\n    const value = formRef.value;\n    if (!value) {\n      return;\n    }\n    formState.spinning=true;\n    value\n      .validateFields()\n      .then(() => {\n        addHiddenDangerData(formState)\n          .then((rsp) => {\n            if (rsp.result != '') {\n              formState.id = rsp.result;\n              SysMessage.getInstance().success('保存成功');\n              setTimeout(() => {\n                closeCurrentTab();\n                MsgManager.getInstance().sendMsg('po-hidden-danger', {});\n              }, 100);\n            } else {\n              SysMessage.getInstance().error('保存失败.');\n            }\n            formState.spinning=false;\n          })\n          .catch((e) => {\n            formState.spinning=false;\n            console.log(e);\n          });\n      })\n      .catch((e) => {\n        console.log(e);\n        formState.spinning=false;\n      });\n  };\n  const billTitleOptions = reactive<any>({\n    subject : '隐患管理'\n  });\n  \n\n  // global\n  onMounted(async () => {\n    getHiddenDangerData({\n      id: formState.id,\n    }).then((rsp) => {\n      let rs = rsp.result;\n      if (formState.id) {\n        for (let key in rs) {\n          formState[key] = rs[key];\n        }\n        formState.status = Number(formState.status);\n      } else {\n        formState.hanppendDate = rs.hanppendDate;\n        formState.billCode = rs.billCode;\n        formState.personMemberName = rs.personMemberName;\n        formState.deptName=rs.deptName;\n        formState.fillinDate = rs.fillinDate;\n        formState.bizFileId = buildShortUUID();\n      }\n      \n      let { billCode, fillinDate, personMemberName,deptName } = rs;\n      Object.assign(billTitleOptions, { billCode, fillinDate, personMemberName,deptName });\n\n      getStationPerson({ stationId: formState.stationId }).then((rsp) => {\n        let tmp={};\n          rsp.result.forEach((e) => {\n            tmp[e.userId]=e.name;\n          });\n          for(let k in tmp){\n            findList.value.push({\n              label: tmp[k],\n              value: k,\n            });\n          }\n      });\n    });\n  });\n</script>\n\n"],"names":["getHiddenDangerData","params","defHttp","addHiddenDangerData","data","getStationPerson","userStore","useUserStore","userInfo","toRaw","disabledInput","computed","query","formState","urlToPath","findList","ref","formRef","reactive","forwardPage","addTabPage","onFinish","value","rsp","SysMessage","closeCurrentTab","MsgManager","e","billTitleOptions","onMounted","__async","rs","key","buildShortUUID","billCode","fillinDate","personMemberName","deptName","tmp","k"],"mappings":"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"}