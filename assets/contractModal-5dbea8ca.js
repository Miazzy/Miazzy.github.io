var v=(A,h,e)=>new Promise((q,N)=>{var M=b=>{try{f(e.next(b))}catch(x){N(x)}},d=b=>{try{f(e.throw(b))}catch(x){N(x)}},f=b=>b.done?q(b.value):Promise.resolve(b.value).then(M,d);f((e=e.apply(A,h)).next())});import{d as ne,r as $,k,ax as oe,u as I,o as re,al as u,Z as y,_ as ie,f as t,aa as s,$ as Y,a9 as w,ac as D,v as p,A as c,E as de,ad as ue}from"./vue-71d1abb3.js";import{d as pe,h as ce,b as L,i as me,s as fe}from"./contract-905202c8.js";import{W as be}from"./WfApproveBox-a3448232.js";import{b as ve,a0 as _e,ak as ge,bP as Ie,aB as ye,av as De,a7 as xe,aC as Ce}from"./index.js";import{B as ke}from"./BillTitle-d17ab3e4.js";import{B as we}from"./BasicTable-0434a334.js";import{T as Ne}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as Me}from"./useTable-109483b3.js";import{a2 as O}from"./antd-15ac76ed.js";import{_ as Ye}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{U as he}from"./UploadBox-636ecf02.js";import{a as _}from"./assign-37f1c13d.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useRender-21ce56fb.js";import"./index.esm-c216ed00.js";import"./index-fda2d66c.js";import"./OrganDialog-dd1023ce.js";import"./Dialog-0a006d82.js";import"./index-c0893416.js";import"./index-33af41d1.js";import"./tree-fc0e156a.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";const Ue={class:"load"},Be={class:"process-box"},Te={class:"header-box"},Se={class:"content"},Ae={class:"clearfix",style:{"padding-bottom":"15px","padding-left":"15px"}},ft=ne({__name:"contractModal",setup(A){const{t:h}=ve(),e=$({spinning:!1}),N=_e().getUserInfo,M=k(),d=k(!0),f=$({});f.subject="合同信息",f.infoItems=[];const b=oe(),{currentRoute:x}=b;I(x);const m=ge.getInstance().getQuery(),z=k();function F(l){const a=k([]);if(U().forEach((o,r)=>{const i=k({});_(i.value,o),i.value.sort=r+1,a.value.push(i.value)}),a.value.length==0){O.error("请添加至少一条主要内容明细。");return}e.dtlList=a.value,e.spinning=!0;try{l=l||0,z.value.validateFields().then(()=>{e.status=l,fe(e).then(o=>{e.id=o,L({id:o}).then(r=>{_(e,r.result)}),O.success(l==1?"提交成功。":"保存成功"),xe.getInstance().sendMsg("integrated-contract",{}),l==1&&(d.value=!0,Ce())})})}catch(o){console.log("error",o)}finally{e.spinning=!1}}const[P,{getDataSource:U}]=Me(_({dataSource:M,columns:pe},ce)),E=()=>v(this,null,function*(){M.value=yield V({})}),V=l=>v(this,null,function*(){const a=yield j(l);return(yield me(a)).result}),j=l=>v(this,null,function*(){const a=yield R();return{contractId:l.contractId?l.id:a+""}});function K(){Q({})}function Q(l){U().push(W(l))}function W(l){return l.editable=!0,l.isNew=!0,l.key=`${Date.now()}`,l}function Z(l){const a=U();let o=a.indexOf(l);o!==-1&&a.splice(o,1)}function G(){F(1)}function H(){F(0)}_(e,{processInstanceId:"",id:"",billCode:"",fillinDate:"",organId:"",organName:"",deptId:"",deptName:"",positionId:"",positionName:"",personMemberId:"",personMemberName:"",fullId:"",status:0,bizFileId:"",subject:"",finishedDate:"",contractDate:"",contractType:"",contractName:"",contractAmount:"",partyA:"",partyB:"",startDate:"",endDate:"",remark:""}),re(()=>v(this,null,function*(){m.id=yield R(),yield L({id:m.id}).then(l=>{m.id?(_(e,l.result),e.status==0&&e.personMemberId.substring(0,32)!=N.userId&&(e.status=10)):(_(e,m),e.spinning=!1,e.status=0,e.billCode=l.result.billCode,e.personMemberName=l.result.personMemberName,e.fillinDate=l.result.fillinDate,e.deptName=l.result.deptName),e.status==1&&(d.value=!0)}),m.id||(d.value=!1),yield X(),E(),(e.bizFileId==null||e.bizFileId==null||e.bizFileId=="")&&J()}));const J=()=>v(this,null,function*(){Ie().then(l=>{e.bizFileId=l})}),R=()=>v(this,null,function*(){let l=m.id;if(!l&&m.processInstanceId){const o=(yield ye(m.processInstanceId)).businessKey;m.id=o,l=o}return l}),X=()=>v(this,null,function*(){d.value=e.status!=0,f.title="合同信息",e.processInstanceId=m.processInstanceId;let{billCode:l,fillinDate:a,personMemberName:o,deptName:r}=e;_(f,{billCode:l,fillinDate:a,personMemberName:o,deptName:r})});return(l,a)=>{const o=u("a-input"),r=u("a-form-item"),i=u("a-col"),g=u("a-row"),B=u("a-date-picker"),ee=u("a-input-number"),te=u("a-textarea"),T=u("a-card"),ae=u("a-button"),se=u("a-form"),le=u("a-spin");return y(),ie("div",Ue,[t(le,{spinning:e.spinning,tip:"Loading..."},{default:s(()=>[Y("div",Be,[Y("div",Te,[t(ke,{options:f},null,8,["options"]),e.status!=10?(y(),w(be,{key:0,onSave:H,onSubmit:G,processInstanceId:e.processInstanceId,processStatus:e.status},null,8,["processInstanceId","processStatus"])):D("",!0)]),Y("div",Se,[t(se,{ref_key:"formRef",ref:z,model:e,labelAlign:"right",autocomplete:"off"},{default:s(()=>[t(T,{title:"基本信息",bordered:!1},{default:s(()=>[t(g,{gutter:24},{default:s(()=>[p(t(i,{span:12},{default:s(()=>[t(r,{name:"stationName",label:"电站名称",labelCol:{span:6},rules:[{required:!0,message:"请输入电站名称"}]},{default:s(()=>[t(o,{disabled:"",value:e.stationName,"onUpdate:value":a[0]||(a[0]=n=>e.stationName=n),placeholder:"请输入电站名称"},null,8,["value"]),D("",!0)]),_:1})]),_:1},512),[[c,!0]]),p(t(i,{span:12},{default:s(()=>[t(r,{name:"periodName",label:"期数",labelCol:{span:6},rules:[{required:!0,message:"请输入期数"}]},{default:s(()=>[t(o,{disabled:"",value:e.periodName,"onUpdate:value":a[2]||(a[2]=n=>e.periodName=n),placeholder:"请输入期数"},null,8,["value"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),t(g,{gutter:24},{default:s(()=>[p(t(i,{span:12},{default:s(()=>[t(r,{name:"contractDate",label:"合同日期",labelCol:{span:6},rules:[{required:!0,message:"请选择合同日期"}]},{default:s(()=>[t(B,{value:e.contractDate,"onUpdate:value":a[3]||(a[3]=n=>e.contractDate=n),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]]),p(t(i,{span:12},{default:s(()=>[t(r,{name:"contractType",label:"合同类型",labelCol:{span:6},rules:[{required:!0,message:"请选择合同类型"}]},{default:s(()=>[t(Ye,{type:"OaContractType",onChange:a[4]||(a[4]=n=>"()=> detailFormState.contractType = value"),value:e.contractType,"onUpdate:value":a[5]||(a[5]=n=>e.contractType=n),style:{width:"100%"},disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),t(g,{gutter:24},{default:s(()=>[p(t(i,{span:12},{default:s(()=>[t(r,{name:"contractName",label:"合同名称",labelCol:{span:6},rules:[{required:!0,message:"请输入合同名称"}]},{default:s(()=>[t(o,{value:e.contractName,"onUpdate:value":a[6]||(a[6]=n=>e.contractName=n),placeholder:"请输入合同名称",disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]]),p(t(i,{span:12},{default:s(()=>[t(r,{name:"contractAmount",label:"合同金额(元)",labelCol:{span:6},rules:[{required:!1,message:"请输入合同金额"}]},{default:s(()=>[t(ee,{value:e.contractAmount,"onUpdate:value":a[7]||(a[7]=n=>e.contractAmount=n),placeholder:"请输入合同金额",precision:"2",max:"1000000000",disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),t(g,{gutter:24},{default:s(()=>[p(t(i,{span:12},{default:s(()=>[t(r,{name:"partyA",label:"甲方",labelCol:{span:6},rules:[{required:!0,message:"请输入甲方"}]},{default:s(()=>[t(o,{value:e.partyA,"onUpdate:value":a[8]||(a[8]=n=>e.partyA=n),placeholder:"请输入甲方",disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]]),p(t(i,{span:12},{default:s(()=>[t(r,{name:"partyB",label:"乙方",labelCol:{span:6},rules:[{required:!0,message:"请输入乙方"}]},{default:s(()=>[t(o,{value:e.partyB,"onUpdate:value":a[9]||(a[9]=n=>e.partyB=n),placeholder:"请输入乙方",disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),t(g,{gutter:24},{default:s(()=>[p(t(i,{span:12},{default:s(()=>[t(r,{name:"startDate",label:"服务开始日期",labelCol:{span:6},rules:[{required:!0,message:"请选择服务开始日期"}]},{default:s(()=>[t(B,{value:e.startDate,"onUpdate:value":a[10]||(a[10]=n=>e.startDate=n),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]]),p(t(i,{span:12},{default:s(()=>[t(r,{name:"endDate",label:"服务结束日期",labelCol:{span:6},rules:[{required:!0,message:"请选择服务结束日期"}]},{default:s(()=>[t(B,{value:e.endDate,"onUpdate:value":a[11]||(a[11]=n=>e.endDate=n),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},disabled:e.status!=0},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1}),t(g,{gutter:24},{default:s(()=>[p(t(i,{span:24},{default:s(()=>[t(r,{name:"remark",label:"备注",labelCol:{span:3},rules:[{required:!1,message:"请输入备注"}]},{default:s(()=>[t(te,{value:e.remark,"onUpdate:value":a[12]||(a[12]=n=>e.remark=n),row:"8","show-count":"",style:{height:"200px"},disabled:d.value,maxlength:1e3},null,8,["value","disabled"])]),_:1})]),_:1},512),[[c,!0]])]),_:1})]),_:1}),t(T,{bordered:!1},{default:s(()=>[t(I(we),{title:"主要内容",onRegister:I(P)},{toolbar:s(()=>[d.value?D("",!0):(y(),w(ae,{key:0,type:"primary",preIcon:I(De).ADD,onClick:a[13]||(a[13]=n=>K())},{default:s(()=>[de(ue(I(h)("common.action.create")),1)]),_:1},8,["preIcon"]))]),bodyCell:s(({column:n,record:C})=>[n.dataIndex==="contractKind"?(y(),w(o,{key:0,value:C[n.dataIndex],"onUpdate:value":S=>C[n.dataIndex]=S,maxLength:1e3,disabled:d.value},null,8,["value","onUpdate:value","disabled"])):D("",!0),n.dataIndex==="contractContent"?(y(),w(o,{key:1,value:C[n.dataIndex],"onUpdate:value":S=>C[n.dataIndex]=S,maxLength:1e3,disabled:d.value},null,8,["value","onUpdate:value","disabled"])):D("",!0),n.dataIndex==="action"?(y(),w(I(Ne),{key:2,actions:[{tooltip:"删除",color:"error",icon:"ant-design:delete-outlined",ifShow:!d.value,onClick:Z.bind(null,C)}]},null,8,["actions"])):D("",!0)]),_:1},8,["onRegister"])]),_:1}),t(T,{title:"附件信息",bordered:!1},{default:s(()=>[Y("div",Ae,[t(he,{width:800,height:550,maxCount:20,maxSize:100*1024*1024,application:"po",module:"contract",vmode:e.status==0?"box":"view",bizId:e.bizFileId},null,8,["vmode","bizId"])])]),_:1})]),_:1},8,["model"])])])]),_:1},8,["spinning"])])}}});export{ft as default};
//# sourceMappingURL=contractModal-5dbea8ca.js.map
