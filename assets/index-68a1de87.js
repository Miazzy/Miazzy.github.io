var m=(t,s,l)=>new Promise((h,i)=>{var b=c=>{try{p(l.next(c))}catch(r){i(r)}},I=c=>{try{p(l.throw(c))}catch(r){i(r)}},p=c=>c.done?h(c.value):Promise.resolve(c.value).then(b,I);p((l=l.apply(t,s)).next())});import{B as v}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as z}from"./useTable-109483b3.js";import{K as O}from"./antd-15ac76ed.js";import{a0 as S,a5 as g,b as P,au as R,av as T,aO as y}from"./index.js";import{d as D,r as F,ax as _,u,o as V,al as k,Z as E,a9 as N,aa as w,f as x,E as q,ad as B}from"./vue-71d1abb3.js";import{e as W}from"./download-03e71dd5.js";import{P as j}from"./index-20519caf.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";const A=t=>g.post({url:"/bi/grid/export-record",params:t,responseType:"blob"},{isReturnNativeResponse:!0}),H=t=>g.get({url:"/bi/grid/record",params:t},{isOnlyResult:!0}),L=t=>g.get({url:"/bi/common/org/info",params:t},{isOnlyResult:!0}),G=t=>g.post({url:"/baseset/common/list-station",params:t}),K={labelWidth:120,actionColOptions:{span:24},autoAdvancedLine:1,showAdvancedButton:!0,baseColProps:{span:7},autoSubmitOnEnter:!0,noHideBtnFlag:!0,schemas:[{field:"dateCycle",label:"时间维度",component:"Select",required:!0,defaultValue:"year",componentProps:{options:[{value:"year",label:"年份"},{value:"month",label:"月份"}]}},{field:"yearValue",label:"年份",component:"YearPicker",defaultValue:O(new Date).format("YYYY"),componentProps:{format:"YYYY",valueFormat:"YYYY",style:{width:"100%"}},show:({values:t})=>t.dateCycle=="year",dynamicRules:({values:t})=>t.dateCycle=="year"?[{required:!0,message:"年份必填"}]:[]},{field:"[startMonth, endMonth]",label:"月份",component:"RangePicker",componentProps:{picker:"month",format:"YYYY-MM",valueFormat:"YYYY-MM",style:{width:"100%"},placeholder:["开始月份","结束月份"]},show:({values:t})=>t.dateCycle=="month",dynamicRules:({values:t})=>t.dateCycle=="month"?[{required:!0,message:"月份必填"}]:[]},{field:"orgId",label:"所属公司",component:"ApiSelect",componentProps:{options:[],api:L,placeholder:"请选择所属公司"},show:S().isMultiOrganization},{field:"stationId",label:"电站名称",component:"ApiSelect",componentProps:{options:[],api:()=>m(void 0,null,function*(){const t=yield G({}),s=[];return t.result.forEach(l=>{s.push({value:l.powerStationId,label:l.powerStationName})}),s}),placeholder:"请输入电站名称"}},{field:"periodName",label:"期数",component:"Input",componentProps:{placeholder:"请输入期数"}}]},Y=[{title:"所属公司",dataIndex:"orgName",width:150,customCell:t=>({rowSpan:t.rowOrgSpan}),resizable:!0,ifShow:S().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",width:150,customCell:t=>({rowSpan:t.rowStationSpan}),resizable:!0},{title:"期数",dataIndex:"periodName",width:150,customCell:t=>({rowSpan:t.rowPeriodSpan}),resizable:!0},{title:"建设规模(MW)",dataIndex:"buildScale",width:150,resizable:!0},{title:"并网日期",dataIndex:"gridDate",width:150,resizable:!0},{title:"光伏并网容量(MW)",dataIndex:"connectCapacity",width:150,resizable:!0},{title:"储能并网容量(MW)",dataIndex:"accessCapacity",width:150,resizable:!0},{title:"组件厂家",dataIndex:"componentVender",width:150,resizable:!0},{title:"组件功率",dataIndex:"componentType",width:150,resizable:!0},{title:"逆变器厂家",dataIndex:"inverterVender",width:150,resizable:!0},{title:"逆变器型号",dataIndex:"inverterType",width:150,resizable:!0}],we=D({__name:"index",setup(t){const{t:s}=P(),{createConfirm:l,createMessage:h}=R(),i=F({});function b(){l({title:s("common.message.confirmTitle"),iconType:"warning",content:s("common.message.exportMessage"),onOk(){return m(this,null,function*(){Object.assign(i,f().getFieldsValue()),i.filename="并网记录统计.xls",i.excelList=Y,yield A(i).then(e=>{W(e==null?void 0:e.data,i.filename)}),i.filename=null,i.excelList=null,h.success(s("common.exportSuccessText"))})}})}const I=_(),{currentRoute:p}=I,r=u(p).query,C=()=>m(this,null,function*(){const a=f().getFieldsValue();return a.dateCycle=="month"&&(a.startMonth=y(a.startDate,"YYYY-MM"),a.endMonth=y(a.endDate,"YYYY-MM")),yield H(a)});V(()=>m(this,null,function*(){if(r){const a=f().getFieldsValue();if(r.startDate&&(a.dateCycle=r.dateType,a.startMonth=r.startDate,a.endMonth=r.endDate),r.stationId!=null){debugger;a.stationId=r.stationId}r.orgId!=null&&(a.orgId=r.orgId),f().setFieldsValue(a)}}));const[M,{getForm:f}]=z({title:"并网记录统计",api:C,columns:Y,formConfig:K,useSearchForm:!0,bordered:!0,pagination:!1,showIndexColumn:!0,showTableSetting:!0,tableSetting:{redo:!1,size:!1,setting:!0,fullScreen:!1},afterFetch:function(a){const e={};for(let d=0;d<a.length;d++){const o=a[d];e[o.orgId]&&e[o.orgId]++,e[o.stationId]&&e[o.stationId]++,e[o.periodId]&&e[o.periodId]++,e[o.orgId]||(e[o.orgId]=1),e[o.stationId]||(e[o.stationId]=1),e[o.periodId]||(e[o.periodId]=1)}for(let d=0;d<a.length;d++){const o=a[d];for(const n in e)o.orgId===n&&(o.rowOrgSpan=e[n],e[n]=0),o.stationId===n&&(o.rowStationSpan=e[n],e[n]=0),o.periodId===n&&(o.rowPeriodSpan=e[n],e[n]=0)}return a}});return(a,e)=>{const d=k("a-button");return E(),N(u(j),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:w(()=>[x(u(v),{onRegister:u(M),onResizeColumn:e[0]||(e[0]=(o,n)=>n.width=o)},{toolbar:w(()=>[x(d,{class:"yellow-btn",preIcon:u(T).EXPORT,onClick:b},{default:w(()=>[q(B(u(s)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])]),_:1})}}});export{we as default};
//# sourceMappingURL=index-68a1de87.js.map
