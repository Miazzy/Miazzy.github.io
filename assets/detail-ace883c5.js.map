{"version":3,"file":"detail-ace883c5.js","sources":["../../src/views/baseset/monitor/smartdevices/eleworkcard/detail.vue"],"sourcesContent":["<template>\n  <div class=\"load\">\n    <a-spin :spinning=\"detailFormState.spinning\" tip=\"Loading...\">\n      <div class=\"process-box\">\n        <!-- 标题 -->\n        <div class=\"header-box\">\n          <div class=\"header-left\">电子工牌</div>\n          <div v-if=\"!disabledInput\" class=\"header-right\">\n            <a-button @click=\"handleCancel\"> 取消</a-button>\n            <a-button class=\"!ml-4\" type=\"primary\" @click=\"onSave\" :loading=\"isLoading\">\n              保存</a-button\n            >\n          </div>\n        </div>\n        <!-- 表单内容 -->\n        <div class=\"content\">\n          <a-form ref=\"formRef\" :model=\"detailFormState\" labelAlign=\"right\" autocomplete=\"off\">\n            <a-card title=\"基本信息\" :bordered=\"false\">\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"assetCode\"\n                    label=\"资产编号\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: false, message: '请输入资产编号' }]\"\n                  >\n                    <a-input disabled v-model:value=\"detailFormState.assetCode\" />\n                  </a-form-item>\n                </a-col>\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"deviceType\"\n                    label=\"智能设备类型\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: true, message: '请输入智能设备类型' }]\"\n                  >\n                    <a-input\n                      v-model:value=\"detailFormState.deviceType\"\n                      placeholder=\"请输入智能设备类型\"\n                      disabled\n                    />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"deviceCode\"\n                    label=\"设备编号\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: true, message: '请输入设备编号' }]\"\n                  >\n                    <a-input\n                      :disabled=\"disabledInput\"\n                      v-model:value=\"detailFormState.deviceCode\"\n                      placeholder=\"请输入设备编号\"\n                      :maxlength=\"100\"\n                    />\n                  </a-form-item>\n                </a-col>\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"simNumber\"\n                    label=\"SIM卡号\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: true, message: '请输入SIM卡号' }]\"\n                  >\n                    <a-input\n                      :disabled=\"disabledInput\"\n                      v-model:value=\"detailFormState.simNumber\"\n                      placeholder=\"请输入SIM卡号\"\n                      :maxlength=\"50\"\n                    />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"isWireless\"\n                    label=\"是否无线设备\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: true, message: '请选择是否无线设备' }]\"\n                  >\n                    <DictSelectBox\n                      v-model:value=\"detailFormState.isWireless\"\n                      :disabled=\"disabledInput\"\n                      :type=\"`yes_or_no`\"\n                    />\n                  </a-form-item>\n                </a-col>\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"purchaseDate\"\n                    label=\"购买日期\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: true, message: '请选择购买日期' }]\"\n                  >\n                    <a-date-picker\n                      v-model:value=\"detailFormState.purchaseDate\"\n                      format=\"YYYY-MM-DD\"\n                      value-format=\"YYYY-MM-DD 00:00:00\"\n                      style=\"width: 100%\"\n                      :disabled=\"disabledInput\"\n                    />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"startDate\"\n                    label=\"启用日期\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: true, message: '请选择启用日期' }]\"\n                  >\n                    <a-date-picker\n                      v-model:value=\"detailFormState.startDate\"\n                      format=\"YYYY-MM-DD\"\n                      value-format=\"YYYY-MM-DD 00:00:00\"\n                      style=\"width: 100%\"\n                      :disabled=\"disabledInput\"\n                    />\n                  </a-form-item>\n                </a-col>\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"endDate\"\n                    label=\"有效期止\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: true, message: '请选择有效期止' }]\"\n                  >\n                    <a-date-picker\n                      v-model:value=\"detailFormState.endDate\"\n                      format=\"YYYY-MM-DD\"\n                      value-format=\"YYYY-MM-DD 00:00:00\"\n                      style=\"width: 100%\"\n                      :disabled=\"disabledInput\"\n                    />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"brand\"\n                    label=\"品牌\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: true, message: '请输入品牌' }]\"\n                  >\n                    <a-input\n                      v-model:value=\"detailFormState.brand\"\n                      placeholder=\"请输入品牌\"\n                      :disabled=\"disabledInput\"\n                      :maxlength=\"50\"\n                    />\n                  </a-form-item>\n                </a-col>\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"model\"\n                    label=\"型号\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: true, message: '请输入型号' }]\"\n                  >\n                    <a-input\n                      v-model:value=\"detailFormState.model\"\n                      placeholder=\"请输入型号\"\n                      :disabled=\"disabledInput\"\n                      :maxlength=\"50\"\n                    />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"stationName\"\n                    label=\"所属电站\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: true, message: '请选择所属电站' }]\"\n                  >\n                    <a-select\n                      v-model:value=\"detailFormState.stationName\"\n                      allow-clear\n                      show-search\n                      style=\"width: 100%\"\n                      placeholder=\"请选择电站\"\n                      :options=\"stationOptions\"\n                      :disabled=\"disabledInput\"\n                      @change=\"handleChange\"\n                    />\n                  </a-form-item>\n                </a-col>\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"userName\"\n                    label=\"当前使用人\"\n                    :labelCol=\"{ span: 6 }\"\n                    :rules=\"[{ required: false, message: '请选择当前使用人' }]\"\n                  >\n                    <a-select\n                      v-model:value=\"detailFormState.userName\"\n                      show-search\n                      allow-clear\n                      style=\"width: 100%\"\n                      placeholder=\"请选择当前使用人\"\n                      :options=\"stationPersonOptions\"\n                      @change=\"handleChangeOperator\"\n                      :disabled=\"disabledInput\"\n                    />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"24\">\n                  <a-form-item\n                    name=\"remark\"\n                    label=\"备注\"\n                    :labelCol=\"{ span: 3 }\"\n                    :rules=\"[{ required: false, message: '备注' }]\"\n                  >\n                    <a-input\n                      :maxlength=\"500\"\n                      :disabled=\"disabledInput\"\n                      v-model:value=\"detailFormState.remark\"\n                    />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n            </a-card>\n\n            <a-card title=\"使用记录\" :bordered=\"false\">\n              <BasicTable @register=\"registerTaskTable\" />\n            </a-card>\n\n            <a-card title=\"附件信息\" :bordered=\"false\">\n              <div class=\"clearfix\" style=\"padding-left: 15px\">\n                <UploadBox\n                  :width=\"800\"\n                  :height=\"550\"\n                  :maxCount=\"20\"\n                  :maxSize=\"100 * 1024 * 1024\"\n                  :application=\"`base`\"\n                  :module=\"`eleWorkCard`\"\n                  :vmode=\"!disabledInput ? `box` : `view`\"\n                  :bizId=\"detailFormState.bizFileId\"\n                />\n              </div>\n            </a-card>\n          </a-form>\n        </div>\n      </div>\n    </a-spin>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\n  import { reactive, ref, onMounted, unref } from 'vue';\n  import {\n    saveData,\n    getIndex,\n    getStationPerson,\n    getDetailList,\n    detailColumns,\n    detailTableProps,\n    getStation,\n  } from './index';\n  import { FormInstance, SelectProps, message } from 'ant-design-vue';\n  import { useRouter } from 'vue-router';\n  import { assign } from 'lodash-es';\n\n  import BillTitle from '/@/components/Framework/BillTitle/BillTitle.vue';\n  import { BasicTable, useTable } from '/@/components/Table';\n  import DictSelectBox from '@/components/Framework/Combox/DictSelectBox.vue';\n  import * as FileApi from '@/api/infra/file';\n  import UploadBox from '@/components/Framework/Combox/UploadBox.vue';\n  import { closeCurrentTab } from '@/utils/route';\n  import { MsgManager } from '/@/message/MsgManager';\n\n  const detailFormState = reactive({ spinning: false });\n  const stationOptions = ref<SelectProps['options']>([]) as any;\n  const isLoading = ref(false);\n  const detailDataSource = ref<any[]>();\n  const stationPersonOptions = ref<SelectProps['options']>([]) as any;\n  const disabledInput = ref<boolean>(true);\n  const billTitleOption = reactive<any>({});\n  billTitleOption.title = '电子工牌设置';\n  billTitleOption.infoItems = [];\n  const router = useRouter();\n  const { currentRoute } = router;\n  const route = unref(currentRoute);\n  const query = route.query;\n\n  function handleChangeOperator(value: string, option) {\n    if (option != undefined) {\n      detailFormState.userName = option.value;\n      detailFormState.user = option.lable;\n    } else {\n      detailFormState.userName = null;\n      detailFormState.user = null;\n    }\n  }\n\n  function initStationOptions() {\n    getStation({}).then((res) => {\n      if (res.result && res.result.length > 0) {\n        res.result.forEach((item) => {\n          stationOptions.value.push({ value: item.powerStationName, lable: item.id });\n        });\n      }\n    });\n  }\n\n  function handleChange(value: string, option) {\n    if (detailFormState.stationId != option.value) {\n      detailFormState.userName = null;\n      detailFormState.user = null;\n    }\n    detailFormState.stationId = option.lable;\n\n    initStationPersonOptions();\n  }\n\n  function initStationPersonOptions() {\n    stationPersonOptions.value = [];\n    getStationPerson('?stationId=' + detailFormState.stationId).then((res) => {\n      if (res.result && res.result.length > 0) {\n        res.result.forEach((item) => {\n          stationPersonOptions.value.push({ value: item.name, lable: item.userId });\n        });\n      }\n    });\n  }\n  const formRef = ref<FormInstance>();\n\n  // 取消按钮\n  function handleCancel() {\n    closeCurrentTab();\n  }\n\n  function onSave() {\n    detailFormState.spinning = true;\n    try {\n      formRef.value.validateFields().then(() => {\n        saveData(detailFormState).then((data) => {\n          detailFormState.id = data;\n\n          getIndex({ id: data }).then((data) => {\n            assign(detailFormState, data.result);\n            initTableData();\n          });\n          message.success('保存成功');\n          MsgManager.getInstance().sendMsg('eleWorkCard', {});\n        });\n      });\n    } catch (error) {\n      console.log('error', error);\n    } finally {\n      detailFormState.spinning = false;\n    }\n  }\n\n  const [registerTaskTable, { reload }] = useTable(\n    assign(\n      {\n        dataSource: detailDataSource,\n        columns: detailColumns,\n      },\n      detailTableProps,\n    ),\n  );\n\n  const initTableData = async () => {\n    detailDataSource.value = await getTaskData({});\n  };\n\n  const getTaskData = async (paramObj) => {\n    const param = await getDetailQueryParam(paramObj);\n    const dataObj = await getDetailList(param);\n\n    return dataObj.result;\n  };\n\n  const getDetailQueryParam = async (paramObj) => {\n    const id = await getBizParamId();\n    return { eleWorkCardId: paramObj.eleWorkCardId ? paramObj.id : id + '' };\n  };\n\n  onMounted(async () => {\n    query.id = await getBizParamId();\n\n    if (query.id) {\n      await getIndex({ id: query.id }).then((data) => {\n        assign(detailFormState, data.result);\n      });\n    } else {\n      assign(detailFormState, query);\n      detailFormState.spinning = false;\n      detailFormState.status = 1;\n    }\n\n    disabledInput.value = query.disabledInput == 'false' ? false : true;\n\n    await getRecordable();\n    initStationPersonOptions();\n    initTableData();\n    initStationOptions();\n\n    if (\n      detailFormState.bizFileId == null ||\n      detailFormState.bizFileId == undefined ||\n      detailFormState.bizFileId == ''\n    ) {\n      getBizFileId();\n    }\n  });\n\n  const getBizParamId = async () => {\n    let id = query.id;\n    if (!id && detailFormState.id) {\n      query.id = detailFormState.id;\n      id = detailFormState.id;\n    }\n    return id;\n  };\n\n  const getRecordable = async () => {\n    billTitleOption.title = '电子工牌设置';\n  };\n\n  //==================================附件资料  begin ==================================\n\n  const getBizFileId = async () => {\n    FileApi.getBizId().then((res) => {\n      detailFormState.bizFileId = res;\n    });\n  };\n\n  //==================================附件资料  end ==================================\n</script>\n<style lang=\"less\" scoped></style>\n"],"names":["detailFormState","reactive","stationOptions","ref","isLoading","detailDataSource","stationPersonOptions","disabledInput","billTitleOption","router","useRouter","currentRoute","query","unref","handleChangeOperator","value","option","initStationOptions","getStation","res","item","handleChange","initStationPersonOptions","getStationPerson","formRef","handleCancel","closeCurrentTab","onSave","saveData","data","getIndex","assign","initTableData","message","MsgManager","error","registerTaskTable","reload","useTable","detailColumns","detailTableProps","__async","getTaskData","paramObj","param","getDetailQueryParam","getDetailList","id","getBizParamId","onMounted","getRecordable","getBizFileId","FileApi.getBizId"],"mappings":"oiDA8RE,MAAMA,EAAkBC,EAAS,CAAE,SAAU,EAAO,CAAA,EAC9CC,EAAiBC,EAA4B,CAAA,CAAE,EAC/CC,EAAYD,EAAI,EAAK,EACrBE,EAAmBF,IACnBG,EAAuBH,EAA4B,CAAA,CAAE,EACrDI,EAAgBJ,EAAa,EAAI,EACjCK,EAAkBP,EAAc,CAAA,CAAE,EACxCO,EAAgB,MAAQ,SACxBA,EAAgB,UAAY,GAC5B,MAAMC,EAASC,KACT,CAAE,aAAAC,CAAiB,EAAAF,EAEnBG,EADQC,EAAMF,CAAY,EACZ,MAEX,SAAAG,EAAqBC,EAAeC,EAAQ,CAC/CA,GAAU,MACZhB,EAAgB,SAAWgB,EAAO,MAClChB,EAAgB,KAAOgB,EAAO,QAE9BhB,EAAgB,SAAW,KAC3BA,EAAgB,KAAO,KAE3B,CAEA,SAASiB,GAAqB,CAC5BC,GAAW,CAAE,CAAA,EAAE,KAAMC,GAAQ,CACvBA,EAAI,QAAUA,EAAI,OAAO,OAAS,GAChCA,EAAA,OAAO,QAASC,GAAS,CACZlB,EAAA,MAAM,KAAK,CAAE,MAAOkB,EAAK,iBAAkB,MAAOA,EAAK,EAAA,CAAI,CAAA,CAC3E,CACH,CACD,CACH,CAES,SAAAC,EAAaN,EAAeC,EAAQ,CACvChB,EAAgB,WAAagB,EAAO,QACtChB,EAAgB,SAAW,KAC3BA,EAAgB,KAAO,MAEzBA,EAAgB,UAAYgB,EAAO,MAEVM,GAC3B,CAEA,SAASA,GAA2B,CAClChB,EAAqB,MAAQ,GAC7BiB,GAAiB,cAAgBvB,EAAgB,SAAS,EAAE,KAAMmB,GAAQ,CACpEA,EAAI,QAAUA,EAAI,OAAO,OAAS,GAChCA,EAAA,OAAO,QAASC,GAAS,CACNd,EAAA,MAAM,KAAK,CAAE,MAAOc,EAAK,KAAM,MAAOA,EAAK,MAAA,CAAQ,CAAA,CACzE,CACH,CACD,CACH,CACA,MAAMI,EAAUrB,IAGhB,SAASsB,GAAe,CACNC,IAClB,CAEA,SAASC,GAAS,CAChB3B,EAAgB,SAAW,GACvB,GAAA,CACFwB,EAAQ,MAAM,eAAiB,EAAA,KAAK,IAAM,CACxCI,GAAS5B,CAAe,EAAE,KAAM6B,GAAS,CACvC7B,EAAgB,GAAK6B,EAErBC,EAAS,CAAE,GAAID,CAAM,CAAA,EAAE,KAAMA,GAAS,CAC7BE,EAAA/B,EAAiB6B,EAAK,MAAM,EACrBG,GAAA,CACf,EACDC,GAAQ,QAAQ,MAAM,EACtBC,GAAW,YAAY,EAAE,QAAQ,cAAe,CAAE,CAAA,CAAA,CACnD,CAAA,CACF,QACMC,EAAO,CACN,QAAA,IAAI,QAASA,CAAK,CAAA,QAC1B,CACAnC,EAAgB,SAAW,EAC7B,CACF,CAEA,KAAM,CAACoC,EAAmB,CAAE,OAAAC,EAAA,CAAQ,EAAIC,GACtCP,EACE,CACE,WAAY1B,EACZ,QAASkC,EACX,EACAC,EACF,CAAA,EAGIR,EAAgB,IAAYS,EAAA,sBAChCpC,EAAiB,MAAQ,MAAMqC,EAAY,CAAE,CAAA,CAAA,GAGzCA,EAAqBC,GAAaF,EAAA,sBAChC,MAAAG,EAAQ,MAAMC,EAAoBF,CAAQ,EAGhD,OAFgB,MAAMG,GAAcF,CAAK,GAE1B,MAAA,GAGXC,EAA6BF,GAAaF,EAAA,sBACxC,MAAAM,EAAK,MAAMC,IACjB,MAAO,CAAE,cAAeL,EAAS,cAAgBA,EAAS,GAAKI,EAAK,GAAG,GAGzEE,GAAU,IAAYR,EAAA,sBACd7B,EAAA,GAAK,MAAMoC,IAEbpC,EAAM,GACF,MAAAkB,EAAS,CAAE,GAAIlB,EAAM,GAAI,EAAE,KAAMiB,GAAS,CACvCE,EAAA/B,EAAiB6B,EAAK,MAAM,CAAA,CACpC,GAEDE,EAAO/B,EAAiBY,CAAK,EAC7BZ,EAAgB,SAAW,GAC3BA,EAAgB,OAAS,GAG3BO,EAAc,MAAQK,EAAM,eAAiB,QAE7C,MAAMsC,EAAc,EACK5B,IACXU,IACKf,KAGjBjB,EAAgB,WAAa,MAC7BA,EAAgB,WAAa,MAC7BA,EAAgB,WAAa,KAEhBmD,GACf,EACD,EAED,MAAMH,EAAgB,IAAYP,EAAA,sBAChC,IAAIM,EAAKnC,EAAM,GACX,MAAA,CAACmC,GAAM/C,EAAgB,KACzBY,EAAM,GAAKZ,EAAgB,GAC3B+C,EAAK/C,EAAgB,IAEhB+C,CAAA,GAGHG,EAAgB,IAAYT,EAAA,sBAChCjC,EAAgB,MAAQ,QAAA,GAKpB2C,EAAe,IAAYV,EAAA,sBAC/BW,GAAiB,EAAE,KAAMjC,GAAQ,CAC/BnB,EAAgB,UAAYmB,CAAA,CAC7B,CAAA"}