var S=(r,w,C)=>new Promise((h,N)=>{var T=d=>{try{m(C.next(d))}catch(f){N(f)}},D=d=>{try{m(C.throw(d))}catch(f){N(f)}},m=d=>d.done?h(d.value):Promise.resolve(d.value).then(T,D);m((C=C.apply(r,w)).next())});import{d as ye,k as u,r as W,e as Ie,o as we,al as c,Z as X,a9 as Ce,aa as n,f as t,$ as U,E as v,u as b,_ as Te,ad as Z,ac as xe,v as E,A as F}from"./vue-71d1abb3.js";import{a5 as I,au as Se,a0 as Ne,av as K,_ as De}from"./index.js";import{P as ze}from"./index-20519caf.js";import{C as ke}from"./CommonTree-c4ed7838.js";import"./index-74ac3212.js";import{_ as Ue}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{e as Ee}from"./download-03e71dd5.js";import{D as J}from"./Dialog-0a006d82.js";import{bE as Fe,a2 as p}from"./antd-15ac76ed.js";import{j as Ke}from"./Export2Excel-389a8fc9.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-3801a970.js";import"./index-316f6ffb.js";import"./useForm-dea3ed18.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./OrganDialog-dd1023ce.js";import"./uniqBy-92d3bc7f.js";const Oe=r=>I.post({url:"/baseset/comm-machine/tree",params:r},{}),Le=r=>I.post({url:"/baseset/device-info-address/page",params:r},{});function Me(r){return I.download({url:"/baseset/device-info-address/export",params:r},"电表数据.xls")}const $e=r=>I.delete({url:"/baseset/device-info-address/empty",params:r},{}),Be=r=>I.post({url:"/baseset/comm-machine/create",params:r},{}),Re=r=>I.delete({url:"/baseset/comm-machine/delete?id="+r},{}),He={class:"right-table-layout tab-model"},qe={class:"tab-button-div"},Pe={class:"tab-table-div tab-table-content"},Ve={key:0},Ye={class:"tab-button"},Ae=ye({__name:"deviceInfoSet",setup(r){const{createConfirm:w,createMessage:C}=Se(),h=u("2"),N=Ne(),T=u([]),D=u("/admin-api/baseset/device-info-address/import"),m={authorization:"Bearer "+N.getToken,stationId:"",machineCode:"",infoType:"",version:"4.5.4",_t:new Date().getTime()},d=u(!1),f=u(!1),O=u(""),M=u(),o=W({stationId:"",machineCode:"",deviceType:"",areaName:"",infoType:"2",pageSize:20,pageNo:1,searchId:"",nodeKindId:""}),$=u([]),B=u([{title:"管理机名称",dataIndex:"machineName",align:"center",sorter:!0,resizable:!0,showSorterTooltip:!1,width:100},{title:"管理机编码",dataIndex:"machineCode",align:"center",sorter:!0,showSorterTooltip:!1,resizable:!0,width:160},{title:"区域名称",dataIndex:"areaName",align:"center",showSorterTooltip:!1,sorter:!0,resizable:!0,width:160},{title:"esn编码",dataIndex:"esn",showSorterTooltip:!1,align:"center",sorter:!0,resizable:!0},{title:"设备名称",dataIndex:"deviceName",align:"center",sorter:!0,resizable:!0,showSorterTooltip:!1,width:120},{title:"点号",dataIndex:"addressNum",align:"center",sorter:!0,resizable:!0,showSorterTooltip:!1,width:120},{title:"点编码",dataIndex:"addressField",align:"center",sorter:!0,showSorterTooltip:!1,resizable:!0,width:120},{title:"点描述",dataIndex:"addressDesc",align:"left"}]),l=W({id:"",stationId:"",stationName:"",code:"",name:"",sort:""});let R=u([]),H=u([]);const z=u({defaultPageSize:20,showTotal:e=>`共${e}条数据`,pageSizeOptions:["20","50","100","200"],total:0,showSizeChanger:!0,showQuickJumper:!0}),q=Ie(()=>document.documentElement.clientHeight-234),Q=(e,a,s)=>{s.order?(o.sortField=s.field,o.sortOrder=s.order.replace("end","")):(o.sortField="",o.sortOrder=""),o.pageSize=e.pageSize,o.pageNo=e.current,o.infoType=1,_()},G=(e,a,s)=>{s.order?(o.sortField=s.field,o.sortOrder=s.order.replace("end","")):(o.sortField="",o.sortOrder=""),o.pageSize=e.pageSize,o.pageNo=e.current,o.infoType=2,_()};function ee(e){o.infoType=e,_()}function te(){if(l.nodeKindId!="machine"){p.error("请选择通讯管理机。");return}T.value=[],m.stationId=l.stationId,m.machineCode=l.code,m.infoType=o.infoType,f.value=!0,m._t=new Date().getTime()}const ae=()=>{m._t=new Date().getTime(),D.value="/admin-api/baseset/device-info-address/import?_t="+new Date().getTime()},oe=e=>{e.file.status!=="uploading"&&console.log(e.file,e.fileList),e.file.status==="done"?e.file.response.code===0?p.success(`${e.file.name} 导入成功。`):p.error(`${e.file.name} 导入失败。错误提示：${e.file.response.msg}`):e.file.status==="error"&&p.error(`${e.file.name} 导入失败。`)};function ne(){f.value=!1}function le(){w({title:"提示",iconType:"warning",content:"确定要导出所有记录？",onOk(){return S(this,null,function*(){Me(o).then(a=>{Ee(a==null?void 0:a.data,"点表数据.xls")})})}})}function ie(){if(o.machineCode==""||o.machineCode==null){p.error("请选择通讯管理机");return}w({title:"提示",iconType:"warning",content:"将清空该管理机下的所有数据，是否继续？",onOk(){return S(this,null,function*(){$e(o)})}})}function se(){w({title:"模板",iconType:"warning",content:"确认下载模板？",onOk(){return S(this,null,function*(){Ke({data:[],header:{esn:"设备esn",addressNum:"点号",addressField:"点编码",addressDesc:"点描述"},filename:"点号导入模板.xlsx"})})}})}function re(e=[]){e!=null&&(l.stationId=e.powerStationId,l.nodeKindId=e.nodeKindId,l.name=e.name,l.code=e.machineCode,l.stationName=e.name,o.machineCode=e.machineCode,o.stationId=e.powerStationId,o.nodeKindId=e.nodeKindId),e.nodeKindId=="org"?o.orgId=e.id:o.orgId=null,_()}function P(){return S(this,null,function*(){const a=yield Oe({parentId:"HZ93a0a37bcad63b017bd784ee2012e7"});$.value=a.result})}function de(){if(l.nodeKindId!="station"){p.error("请选择电站。");return}l.name="",l.code="",l.sort="",O.value="新增通讯管理机",d.value=!0}function ue(e){e.nodeKindId=="machine"?(O.value="编辑通讯管理机",l.name=e.name,l.code=e.machineCode,l.stationId=e.powerStationId,l.sort=e.fullSequence,l.stationName=e.powerStationName,l.id=e.id,d.value=!0):p.error("请选择通讯管理机")}function ce(e){if(e.nodeKindId!="machine"){p.error("请选择通讯管理机。");return}else Re(e.id).then(()=>{p.success("已删除"),L()})}function L(){P()}function me(){M.value.validateFields().then(()=>{Be(l).then(()=>{p.success("已保存"),L(),d.value=!1}).catch(()=>{})}),console.info(l)}function pe(){d.value=!1}function _(){Le(o).then(e=>{h.value=="1"?(R.value=e.result.list,z.value.total=e.result.total):h.value=="2"&&(H.value=e.result.list,z.value.total=e.result.total)})}function fe(){_()}function ve(){o.deviceType=null,o.areaName=null,_()}return we(()=>{P(),_()}),(e,a)=>{const s=c("a-form-item"),x=c("a-input"),g=c("a-button"),V=c("a-form"),Y=c("a-table"),A=c("a-tab-pane"),be=c("a-tabs"),he=c("a-upload"),k=c("a-col"),j=c("a-row"),_e=c("a-input-number");return X(),Ce(b(ze),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:n(()=>[t(ke,{title:"电站组织",onSelect:re,value:$.value,class:"left-tree-layout",onAdd:de,onEdit:ue,onDelete:ce,onRefresh:L,isShowOperationBtns:!0,fieldNames:{key:"id",title:"name"}},null,8,["value"]),U("div",He,[U("div",qe,[t(V,{model:o,name:"horizontal_login",layout:"inline",autocomplete:"off"},{default:n(()=>[t(s,{label:"设备类型",name:"deviceType",style:{width:"22%","margin-left":"60px"},colon:!1},{default:n(()=>[t(Ue,{width:"280px",value:o.deviceType,"onUpdate:value":a[0]||(a[0]=i=>o.deviceType=i),type:"commDeviceType"},null,8,["value"])]),_:1}),t(s,{label:"区域名称",name:"areaName",style:{width:"22%","margin-left":"60px"},colon:!1},{default:n(()=>[t(x,{style:{width:"280px"},value:o.areaName,"onUpdate:value":a[1]||(a[1]=i=>o.areaName=i)},null,8,["value"])]),_:1}),t(s,{class:"tab-button"},{default:n(()=>[t(g,{onClick:ve},{default:n(()=>[v("重置")]),_:1}),t(g,{type:"primary",style:{"margin-right":"9px","margin-left":"8px"},onClick:fe},{default:n(()=>[v("查询")]),_:1})]),_:1})]),_:1},8,["model"])]),U("div",Pe,[t(be,{activeKey:h.value,"onUpdate:activeKey":a[4]||(a[4]=i=>h.value=i),onChange:a[5]||(a[5]=i=>ee(h.value))},{rightExtra:n(()=>[U("div",Ye,[t(g,{class:"tab-button yellow-btn",preIcon:b(K).IMPORT,onClick:te},{default:n(()=>[v("导入")]),_:1},8,["preIcon"]),t(g,{class:"tab-button yellow-btn",preIcon:b(K).EXPORT,onClick:le},{default:n(()=>[v("导出")]),_:1},8,["preIcon"]),t(g,{class:"tab-button red-btn",preIcon:b(K).DELETE,onClick:ie},{default:n(()=>[v("清空")]),_:1},8,["preIcon"]),t(g,{class:"tab-button yellow-btn",preIcon:b(K).DOWNLOAD,onClick:se},{default:n(()=>[v("模板")]),_:1},8,["preIcon"])])]),default:n(()=>[t(A,{key:"2",tab:"遥测",class:"full-pane"},{default:n(()=>[t(Y,{columns:B.value,"data-source":b(H),pagination:z.value,onChange:G,size:"small",bordered:"",scroll:{x:500,y:q.value},onResizeColumn:a[2]||(a[2]=(i,y)=>y.width=i)},{bodyCell:n(({column:i,text:y,record:ge})=>[i.dataIndex==="name"?(X(),Te("a",Ve,Z(y),1)):xe("",!0)]),_:1},8,["columns","data-source","pagination","scroll"])]),_:1}),t(A,{key:"1",tab:"遥信",class:"full-pane"},{default:n(()=>[t(Y,{columns:B.value,"data-source":b(R),pagination:z.value,size:"small",bordered:"",onChange:Q,scroll:{x:500,y:q.value},onResizeColumn:a[3]||(a[3]=(i,y)=>y.width=i)},{bodyCell:n(({column:i,text:y,record:ge})=>[v(Z(y),1)]),_:1},8,["columns","data-source","pagination","scroll"])]),_:1})]),_:1},8,["activeKey"])])]),t(J,{visible:f.value,"onUpdate:visible":a[7]||(a[7]=i=>f.value=i),title:"导入点表数据",width:600,height:240,smode:"simple",overflowY:"scroll",onConfirm:ne},{default:n(()=>[t(he,{"file-list":T.value,"onUpdate:fileList":a[6]||(a[6]=i=>T.value=i),name:"file",headers:m,onChange:oe,beforeUpload:ae,action:D.value},{default:n(()=>[t(g,null,{default:n(()=>[t(b(Fe)),v(" 上传 ")]),_:1})]),_:1},8,["file-list","action"])]),_:1},8,["visible"]),t(J,{visible:d.value,"onUpdate:visible":a[12]||(a[12]=i=>d.value=i),title:O.value,width:600,height:400,smode:"normal",onConfirm:me,onCancel:pe},{default:n(()=>[t(V,{ref_key:"machineFormRef",ref:M,model:l,name:"machineForm"},{default:n(()=>[t(j,{gutter:24},{default:n(()=>[E(t(k,{span:24},{default:n(()=>[t(s,{label:"所属电站",name:"stationName",labelCol:{span:4}},{default:n(()=>[t(x,{disabled:"",value:l.stationName,"onUpdate:value":a[8]||(a[8]=i=>l.stationName=i),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1},512),[[F,!0]]),E(t(k,{span:24},{default:n(()=>[t(s,{label:"名称",name:"name",labelCol:{span:4},rules:[{required:!0,message:"名称不能为空"}]},{default:n(()=>[t(x,{value:l.name,"onUpdate:value":a[9]||(a[9]=i=>l.name=i),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1},512),[[F,!0]])]),_:1}),t(j,{gutter:24},{default:n(()=>[E(t(k,{span:24},{default:n(()=>[t(s,{label:"编码",name:"code",labelCol:{span:4},rules:[{required:!0,message:"编码不能为空"}]},{default:n(()=>[t(x,{value:l.code,"onUpdate:value":a[10]||(a[10]=i=>l.code=i),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1},512),[[F,!0]]),E(t(k,{span:24},{default:n(()=>[t(s,{label:"排序",name:"sort",labelCol:{span:4},rules:[{required:!0,message:"排序号不能为空"}]},{default:n(()=>[t(_e,{value:l.sort,"onUpdate:value":a[11]||(a[11]=i=>l.sort=i),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1},512),[[F,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])]),_:1})}}});const ht=De(Ae,[["__scopeId","data-v-1fef64b0"]]);export{ht as default};
//# sourceMappingURL=deviceInfoSet-888453a2.js.map
