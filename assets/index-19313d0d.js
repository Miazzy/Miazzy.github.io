var Y=Object.defineProperty;var P=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var T=(r,t,n)=>t in r?Y(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n,O=(r,t)=>{for(var n in t||(t={}))W.call(t,n)&&T(r,n,t[n]);if(P)for(var n of P(t))$.call(t,n)&&T(r,n,t[n]);return r};var c=(r,t,n)=>new Promise((o,f)=>{var x=d=>{try{g(n.next(d))}catch(m){f(m)}},k=d=>{try{g(n.throw(d))}catch(m){f(m)}},g=d=>d.done?o(d.value):Promise.resolve(d.value).then(x,k);g((n=n.apply(r,t)).next())});import{P as j}from"./index-20519caf.js";import{a0 as V,a5 as _,aj as q,b as L,au as K,a7 as U,av as I,ax as C,at as l,_ as X}from"./index.js";import{B as Z}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as G}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{s as J,a as Q}from"./stationTree-56a32762.js";import{e as ee}from"./download-03e71dd5.js";import"./index-316f6ffb.js";import{u as te}from"./useRender-21ce56fb.js";import{d as ne,k as S,o as ae,al as re,Z as oe,a9 as ie,aa as u,f as p,u as s,$ as se,E as h,ad as b}from"./vue-71d1abb3.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./CommonTree-c4ed7838.js";import"./index-3801a970.js";function le(r){return _.get({url:"/po/hidden-danger/page",params:r})}function de(r){return _.delete({url:"/po/hidden-danger/delete?id="+r})}function ce(r){return _.post({url:"/po/workorder/generate/hidden",params:r})}function ue(r){return _.download({url:"/po/hidden-danger/export-excel",params:r},{isReturnNativeResponse:!0})}const pe=[{title:"单据编号",dataIndex:"billCode",width:180,sorter:!0,resizable:!0},{title:"工单编号",dataIndex:"workBillCode",width:180,sorter:!0,resizable:!0},{title:"所属公司",dataIndex:"stationOrganName",align:"left",headAlign:"center",width:160,sorter:!0,resizable:!0,ifShow:V().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",align:"left",headAlign:"center",width:160,sorter:!0,resizable:!0},{title:"发现时间",dataIndex:"hanppendDate",width:160,sorter:!0,resizable:!0},{title:"来源任务",dataIndex:"sourceBillCode",width:200,sorter:!0,resizable:!0,customRender:({text:r,record:t})=>{let n="";switch(t.sourceType){case"dqSafeCheckExecution":n=`/po/safety/safecheckexecution/create/checkType__1?processInstanceId=${t.sourceParentProcessId}`;break;case"zxSafeCheckExecution":n=`/po/safety/safecheckexecution/create/checkType__1?processInstanceId=${t.sourceParentProcessId}`;break;case"inspectionExecution":n=`/po/inspection/inspectionexecution/create?processInstanceId=${t.sourceParentProcessId}`;break;case"vehicleExecution":n=`/po/safety/vehicleexecution/create?processInstanceId=${t.sourceParentProcessId}`;break}return te.renderIframeLink(n,r,null,r)}},{title:"隐患类别",dataIndex:"hiddenDangerTypeText",width:160,sorter:!0,resizable:!0},{title:"检查内容",dataIndex:"resultContent",align:"left",headAlign:"center",width:160,sorter:!0,resizable:!0},{title:"检查情况",dataIndex:"result",align:"left",headAlign:"center",width:160,sorter:!0,resizable:!0},{title:"计划完成日期",dataIndex:"finishedRectificationDate",width:160,sorter:!0,resizable:!0},{title:"隐患状态",dataIndex:"validateResultText",width:160,sorter:!0,resizable:!0},{title:"创建人",dataIndex:"personMemberName",width:160,sorter:!0,resizable:!0},{title:"创建时间",dataIndex:"fillinDate",width:160,sorter:!0,resizable:!0}],fe=[{label:"单据编号",field:"billCode",component:"Input",colProps:{span:8}},{label:"隐患类别",field:"hiddenDangerType",component:"DictSelectBox",componentProps:{type:"hidden_danger_type"},colProps:{span:7}},{field:"[startHanppendDate, endHanppendDate]",label:"发现时间",component:"RangePicker",colProps:{span:7},componentProps:{format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",placeholder:["开始日期","结束日期"]}},{label:"检查内容",field:"resultContent",component:"Input",colProps:{span:7}},{label:"是否转工单",field:"isConvertWorkBill",component:"DictSelectBox",componentProps:{type:"yes_or_no"},colProps:{span:8}},{label:"隐患状态",field:"resolutionStatus",component:"DictSelectBox",componentProps:{type:"validate_result"},colProps:{span:8}}],ge={class:"right-table-layout"},me=ne({__name:"index",setup(r){let{params:t}=q(),n=S("");const o=S({status:"",dtlIds:t.dtlIds||[],hiddenDangerType:"",resultContent:"",isConvertWorkBill:t.isConvertWorkBill,startHanppendDate:t.startHanppendDate,endHanppendDate:t.endHanppendDate,stationOrganId:t.stationOrganId,stationId:t.stationId,resolutionStatus:t.resolutionStatus,pageNo:1,pageSize:10,sortField:"billCode",sortOrder:"desc"}),{t:f}=L(),{createConfirm:x,createMessage:k}=K();function g(a){Q(a,o,null,y)}const d=(a,e,i)=>{C(`/po/danger/create?id=${a.id}&readonly=1`,"查看隐患")},[m,{getForm:v,reload:y,getPaginationRef:B,getSelectRows:w}]=G({title:"隐患管理",api:()=>c(this,null,function*(){const a=B();return o.value.pageNo=a.current,o.value.pageSize=a.pageSize,(yield le(o.value)).result.page}),columns:pe,rowKey:"id",bordered:!0,formConfig:{labelWidth:120,schemas:fe,showAdvancedButton:!0,autoAdvancedLine:1},useSearchForm:!0,showTableSetting:!0,rowSelection:{type:"radio",fixed:!0,onSelect:z},handleSearchInfoFn(a){for(const e in a)o.value[e]=a[e]},sortFn:a=>{a.order?(o.value.sortField=a.field.replace("Text",""),o.value.sortOrder=a.order.replace("end","")):(o.value.sortField="billCode",o.value.sortOrder="desc")}});function z(a,e){e?n.value=a.id:n.value=""}function N({keys:a,rows:e}){if(e&&e.length>0){const i=e[0];n.value=i.id}else n.value=""}function R(){if(!o.value.stationId){l.getInstance().info("请选中电站添加");return}C("/po/danger/create?id=","添加隐患",{stationId:o.value.stationId,stationName:o.value.stationName,stationOrganId:o.value.stationOrganId,stationOrganName:o.value.stationOrganName})}function E(){let a=w();if(a.length!==1)return l.getInstance().info("请选择一条数据."),!1;let e=a[0];if(e.workBillCode)return l.getInstance().info("已转工单不能修改."),!1;C(`/po/danger/create?id=${e.id}`,e.status!=0||e.sourceId!=""?"查看隐患":"修改隐患")}function M(){return c(this,null,function*(){let a=w();if(a.length!==1)return l.getInstance().info("请选择一条数据."),!1;let e=a[0];x({title:"提示",iconType:"warning",content:"确定要删除选中的记录？",onOk(){return c(this,null,function*(){if(e.workBillCode)return l.getInstance().info("已转工单不能删除."),!1;yield de(e.id).then(D=>{l.getInstance().info("删除成功"),y()})})}})})}function F(){return c(this,null,function*(){x({title:f("common.exportTitle"),iconType:"warning",content:f("common.exportMessage"),onOk(){return c(this,null,function*(){let e=v().getFieldsValue();Object.assign(e,o.value),yield ue(e).then(i=>{ee(i==null?void 0:i.data,"隐患管理.xls")}),k.success(f("common.exportSuccessText"))})}})})}function H(){return c(this,null,function*(){let a=w();if(a.length!==1){l.getInstance().info("只能选择一条记录。");return}let e=a[0];if(e.workBillCode)return l.getInstance().info("不能重复转工单."),!1;ce({stationId:e.stationId,stationName:e.stationName,stationOrganId:e.stationOrganId,stationOrganName:e.stationOrganName,sourceId:e.id,sourceCode:e.billCode,planEndDate:e.finishedRectificationDate,subject:"",hidden:{findById:e.findById,findByName:e.findByName,findDate:e.hanppendDate,hiddenDangerType:e.hiddenDangerType,checkContent:e.resultContent,result:e.result,planMeasure:e.rectificationMeasures}}).then(i=>{i.code==0?(l.getInstance().info("工单生成成功."),y()):l.getInstance().error("工单生成失败.原因:"+i.message)})})}return ae(()=>{v().setFieldsValue(O({},t)),U.getInstance().listen("po-hidden-danger",()=>{y()})}),(a,e)=>{const i=re("a-button");return oe(),ie(s(j),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:u(()=>[p(J,{onSelectTree:g,stationId:s(t).stationId,stationOrganId:s(t).stationOrganId},null,8,["stationId","stationOrganId"]),se("div",ge,[p(s(Z),{onRegister:s(m),class:"fix-basic-table",onResizeColumn:e[0]||(e[0]=(D,A)=>A.width=D),onSelectionChange:N,onRowDbClick:d},{toolbar:u(()=>[p(i,{type:"primary",preIcon:s(I).ADD,onClick:R},{default:u(()=>[h(b("添加"))]),_:1},8,["preIcon"]),p(i,{type:"primary",disabled:s(n)=="",preIcon:s(I).EDIT,onClick:E},{default:u(()=>[h(b("修改"))]),_:1},8,["disabled","preIcon"]),p(i,{class:"red-btn",disabled:s(n)=="",preIcon:s(I).DELETE,onClick:M},{default:u(()=>[h(b("删除"))]),_:1},8,["disabled","preIcon"]),p(i,{class:"yellow-btn",preIcon:s(I).EXPORT,onClick:F},{default:u(()=>[h(b("导出"))]),_:1},8,["preIcon"]),p(i,{type:"primary",disabled:s(n)=="",preIcon:s(I).ADD,onClick:H},{default:u(()=>[h(b("转工单"))]),_:1},8,["disabled","preIcon"])]),_:1},8,["onRegister"])])]),_:1})}}});const qe=X(me,[["__scopeId","data-v-de6438b1"]]);export{qe as default};
//# sourceMappingURL=index-19313d0d.js.map
