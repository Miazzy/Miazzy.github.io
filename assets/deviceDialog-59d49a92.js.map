{"version":3,"file":"deviceDialog-59d49a92.js","sources":["../../src/views/monitor/PVArea/subareaOverview/deviceDialog.vue"],"sourcesContent":["<template>\n  <Dialog\n    ref=\"deviceDialog\"\n    :title=\"props.data.deviceName\"\n    :visible=\"modalVisible\"\n    :showBtm=\"false\"\n    @update:visible=\"updateVisible\"\n    :width=\"width\"\n    :height=\"height\"\n  >\n    <div class=\"device-dialog-content\">\n      <ul class=\"tab-bar-list\">\n        <li\n          v-for=\"(item, index) in tabBarList\"\n          :key=\"index\"\n          class=\"tab-bar-item\"\n          :class=\"{ active: activeTabKey === index }\"\n          @click=\"handleClickTab(index)\"\n          >{{ item }}</li\n        >\n      </ul>\n      <!-- 实时信息 -->\n      <div v-show=\"activeTabKey === 0\" class=\"tab-panel1\">\n        <div class=\"chart-box\">\n          <div class=\"device-items\">\n            <div\n              class=\"device-item-box\"\n              :style=\"{ margin: getDeviceIcons.length === 1 ? '0 auto' : '' }\"\n              v-for=\"(item, index) in getDeviceIcons\"\n              :key=\"index\"\n            >\n              <div class=\"device-item-img-box\">\n                <i\n                  class=\"iconfont\"\n                  :class=\"item.icon\"\n                  :style=\"{\n                    color:\n                      (getDeviceIcons.length > 1 && index == 1) || getDeviceIcons.length === 1\n                        ? deviceAbnormalTypeColors[data.deviceShowFlag]\n                        : '#019CFC',\n                    fontSize: '54px',\n                    lineHeight: 1,\n                  }\"\n                ></i>\n              </div>\n              <div class=\"line\"></div>\n              <div class=\"label-box\">{{ item.deviceName || data.deviceName }}</div>\n            </div>\n          </div>\n          <div\n            class=\"flow-line-box\"\n            v-if=\"deviceIconList[data.deviceType] && deviceIconList[data.deviceType].length > 1\"\n          >\n            <div class=\"flow-line\">\n              <div class=\"line-move\">\n                <div class=\"blue-line position1\"></div>\n                <div class=\"blue-line position2\"></div>\n              </div>\n            </div>\n            <div class=\"flow-line\">\n              <div class=\"line-move\">\n                <div class=\"blue-line position1\"></div>\n                <div class=\"blue-line position2\"></div>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class=\"data-box\">\n          <div class=\"left-part\" v-if=\"props.ycData.length > 0\">\n            <div class=\"part-header\">\n              <div class=\"header-left\">\n                <span class=\"header-icon\"></span>\n                <span class=\"header-text\">遥测</span>\n              </div>\n              <div class=\"header-right\">\n                {{ ycDateTime }}\n              </div>\n            </div>\n            <div class=\"part-content\">\n              <div class=\"data-list-box\" v-if=\"props.ycData.length\">\n                <ul class=\"data-list\" v-for=\"(item, index) in formatYcData\" :key=\"index\">\n                  <li class=\"data-item\" v-for=\"(n, i) in item\" :key=\"i\">\n                    <span class=\"data-label align-center\">\n                      {{ n.addressDesc }}{{ n.unit ? `(${n.unit})` : '' }}\n                    </span>\n                    <span class=\"data-value align-right\" :class=\"{ 'red-text': n.isAlarm == 1 }\">\n                      {{ n.data }}\n                    </span>\n                  </li>\n                  <!-- <li class=\"data-item\">\n                  <span class=\"data-label\">AB电压(V)</span>\n                  <span class=\"data-value warning-text\">35.64</span>\n                </li> -->\n                </ul>\n              </div>\n            </div>\n          </div>\n          <div class=\"right-part\" v-if=\"props.ycData.length > 0\">\n            <div class=\"part-header\">\n              <div class=\"header-left\">\n                <span class=\"header-icon\"></span>\n                <span class=\"header-text\">遥信</span>\n              </div>\n              <div class=\"header-right\"> {{ props.yxTime }} </div>\n            </div>\n            <div class=\"part-content\" style=\"height: 457px; overflow: auto\">\n              <div class=\"info-list\" v-for=\"(item, index) in formatYxData\" :key=\"index\">\n                <div\n                  class=\"info-item\"\n                  :class=\"{ 'red-bg': n.is_alarm == 1, blink: n.isAlarmNow == 1 }\"\n                  v-for=\"(n, i) in item\"\n                  :key=\"i\"\n                  >{{ n.addressDesc }}</div\n                >\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <!-- 设备告警 -->\n      <div v-show=\"activeTabKey === 1\" class=\"tab-panel2\">\n        <DeviceWarning :height=\"525\" :esn=\"title\" />\n      </div>\n      <!-- 数据明细 -->\n      <div v-show=\"activeTabKey === 2\" class=\"tab-panel3\">\n        <DataDetail :indexType=\"ycData\" :esn=\"title\" :echartWidth=\"1270\" />\n      </div>\n      <!-- 数据对比 -->\n      <div v-show=\"activeTabKey === 3\" class=\"tab-panel4\">\n        <DataComparison\n          :tableColumns=\"detailColumns\"\n          :indexType=\"ycData\"\n          :esn=\"title\"\n          :echartWidth=\"1270\"\n        />\n      </div>\n    </div>\n  </Dialog>\n</template>\n\n<script lang=\"ts\" setup>\n  import { ref, onMounted, watch, computed } from 'vue';\n  import Dialog from '@/components/Framework/Modal/Dialog.vue';\n  import DeviceWarning from '../../component/deviceWarning.vue';\n  import DataDetail from '../../component/dataDetail.vue';\n  import DataComparison from '../../component/dataComparison.vue';\n  import { formatToDateTime } from '@/utils/dateUtil';\n\n  const props = defineProps({\n    visible: Boolean, // 是否显示弹框\n    title: String, // 弹框标题\n    data: {\n      type: Object,\n      default: {},\n    },\n    width: { type: Number, default: 1080 }, // 弹框宽度\n    height: { type: Number, default: 800 }, // 弹框高度\n    ycData: { type: Array, default: [] }, // 遥测实时数据\n    yxData: { type: Array, default: [] }, // 遥信实时数据\n    yxTime: String, // 遥信时间\n  });\n  const emit = defineEmits(['update:visible']); // 定义事件\n  const modalVisible = ref(false); // 是否显示弹框\n  const updateVisible = ($event) => {\n    modalVisible.value = $event;\n    emit('update:visible', false); // 关闭弹框\n  };\n\n  // 设备状态颜色对应\n  const deviceAbnormalTypeColors = {\n    normal: '#019CFC', // 正常\n    halt: '#FF8184', // 停机\n    alarm: '#E3C700', // 告警\n    interrupt: '#D2D2D2', // 通讯中断\n  };\n\n  // 设备图标\n  const deviceIconList = {\n    StringFormation: [\n      {\n        icon: 'icon-zuchuan',\n        deviceName: '组串',\n      },\n      {\n        icon: 'icon-zuchuannibianqi',\n        deviceName: '',\n      },\n      {\n        icon: 'icon-xiangbian',\n        deviceName: '箱变',\n      },\n    ], // 组串式逆变器：组串->组串式逆变器->箱变\n    Concentrate: [\n      {\n        icon: 'icon-huiliuxiang',\n        deviceName: '直流汇流箱',\n      },\n      {\n        icon: 'icon-jizhongshinibianqi',\n        deviceName: '',\n      },\n      {\n        icon: 'icon-xiangbian',\n        deviceName: '箱变',\n      },\n    ], // 集中式逆变器: 直流汇流箱->集中式逆变器->箱变\n    CombinerDc: [\n      {\n        icon: 'icon-zuchuan',\n        deviceName: '组串',\n      },\n      {\n        icon: 'icon-huiliuxiang',\n        deviceName: '',\n      },\n      {\n        icon: 'icon-jizhongshinibianqi',\n        deviceName: '集中式逆变器',\n      },\n    ], // 直流汇流箱: 组串->直流汇流箱->集中式逆变器\n    Transformer: [\n      {\n        icon: 'icon-tongyong',\n        deviceName: '逆变器',\n      },\n      {\n        icon: 'icon-xiangbian',\n        deviceName: '',\n      },\n      {\n        icon: 'icon-tongyong',\n        deviceName: '集电线路',\n      },\n    ], // 箱变: 逆变器->箱变->集电线路\n    DataCollector: [\n      {\n        icon: 'icon-shucai',\n        deviceName: '',\n      },\n    ], // 数采\n    TransformerMeter: [\n      {\n        icon: 'icon-xiangbiandianbiao',\n        deviceName: '',\n      },\n    ], // 箱变电表\n    TrackingAxis: [\n      {\n        icon: 'icon-genzongzhou',\n        deviceName: '',\n      },\n    ], // 跟踪轴\n    MeasureControl: [\n      {\n        icon: 'icon-cekong',\n        deviceName: '',\n      },\n    ], // 测控\n    Protect: [\n      {\n        icon: 'icon-baohu',\n        deviceName: '',\n      },\n    ], // 保护\n    EMSController: [\n      {\n        icon: 'icon-tongyong',\n        deviceName: '',\n      },\n    ], // EMS控制器\n    PowerConversionSystem: [\n      {\n        icon: 'icon-tongyong',\n        deviceName: '',\n      },\n    ], // PCS\n    BatteryManagementSystem: [\n      {\n        icon: 'icon-BMS',\n        deviceName: '',\n      },\n    ], // BMS\n    Svg: [\n      {\n        icon: 'icon-SVG',\n        deviceName: '',\n      },\n    ], // SVG\n    Yanaco: [\n      {\n        icon: 'icon-huanjingyi',\n        deviceName: '',\n      },\n    ], // 环境仪\n    DcScreen: [\n      {\n        icon: 'icon-zhiliuping',\n        deviceName: '',\n      },\n    ], // 直流屏\n    LocalController: [\n      {\n        icon: 'icon-tongyong',\n        deviceName: '',\n      },\n    ], // 本地控制器\n    AGC: [\n      {\n        icon: 'icon-tongyong',\n        deviceName: '',\n      },\n    ], // AGC\n    ElectricityMeter: [\n      {\n        icon: 'icon-dianbiao',\n        deviceName: '',\n      },\n    ], // 电表\n  };\n\n  const getDeviceIcons = computed(() => {\n    return deviceIconList[props.data.deviceType] || [{ icon: 'icon-tongyong', deviceName: '' }];\n  });\n\n  // tab\n  const tabBarList = ref(['实时信息', '设备告警', '数据明细', '数据对比']);\n  const activeTabKey = ref(0);\n  const handleClickTab = (index) => {\n    activeTabKey.value = index;\n  };\n\n  // 列表表头\n  const detailColumns: BasicColumn[] = [\n    {\n      title: '时间',\n      dataIndex: 'time',\n      width: 150,\n    },\n    {\n      title: '指标1',\n      dataIndex: 'target1',\n      sorter: true, // 排序\n      width: 80,\n    },\n    {\n      title: '指标2',\n      dataIndex: 'target2',\n      sorter: true, // 排序\n      width: 80,\n    },\n    {\n      title: '指标3',\n      dataIndex: 'target3',\n      sorter: true, // 排序\n      width: 80,\n    },\n    {\n      title: '指标4',\n      dataIndex: 'target4',\n      sorter: true, // 排序\n      width: 80,\n    },\n  ];\n  const tableData = ref([\n    {\n      time: '16:25:00 ',\n      target1: '10V',\n      target2: '10A',\n      target3: '10KW',\n      target4: '10V',\n    },\n  ]);\n\n  watch(\n    () => props.visible,\n    (newValue) => {\n      modalVisible.value = newValue;\n      activeTabKey.value = 0;\n      dealTime();\n    },\n  );\n\n  // 时间\n  const ycDateTime = computed(() => {\n    let time = props.ycData.filter((item) => item.addressField == 'time');\n    if (time?.length > 0 && time[0].data) {\n      return time[0].data;\n    }\n    return '';\n  });\n\n  // 处理遥测遥信时间；\n  const dealTime = () => {};\n\n  // 遥测遥信数据(除时间)分两列\n  const halfSliceArr = (data: Array) => {\n    let newArr = data.filter((item) => item.addressField !== 'time');\n    let sliceIndex = Math.ceil(newArr.length / 2);\n    let result = [];\n    if (newArr.slice(0, sliceIndex)?.length) {\n      result.push(newArr.slice(0, sliceIndex));\n    }\n    if (newArr.slice(sliceIndex)?.length) {\n      result.push(newArr.slice(sliceIndex));\n    }\n    return result;\n  };\n  const formatYcData = computed(() => {\n    return halfSliceArr(props.ycData);\n  });\n  const formatYxData = computed(() => {\n    return halfSliceArr(props.yxData);\n  });\n\n  onMounted(() => {\n    modalVisible.value = props.visible; // 根据传入参数控制Dialog显示\n  });\n</script>\n\n<style lang=\"less\" scoped>\n  .device-dialog-content {\n    @keyframes line-move-animation {\n      0% {\n        left: -318px;\n      }\n\n      100% {\n        left: 318px;\n      }\n    }\n\n    @keyframes blink {\n      0% {\n        background-color: #ed706b; /* 完全不透明 */\n      }\n\n      50% {\n        background-color: transparent; /* 完全透明 */\n      }\n\n      100% {\n        background-color: #ed706b; /* 再次变为不透明 */\n      }\n    }\n\n    .tab-bar-list {\n      display: flex;\n      align-items: center;\n      margin-bottom: 0;\n      padding: 28px 18px 0;\n\n      .tab-bar-item {\n        margin-right: 40px;\n        padding-bottom: 9px;\n        border-bottom: 2px solid transparent;\n        font-size: 16px;\n        line-height: 1;\n        cursor: pointer;\n\n        &:last-child {\n          margin-right: 0;\n        }\n      }\n    }\n\n    .chart-box {\n      position: relative;\n      height: 124px;\n\n      .flow-line-box {\n        display: flex;\n        position: absolute;\n        top: 58px;\n        justify-content: space-between;\n        width: 100%;\n        padding: 0 186px;\n\n        .flow-line {\n          position: relative;\n          width: 320px;\n          height: 2px;\n          overflow: hidden;\n\n          .blue-line {\n            position: absolute;\n            top: 0;\n            width: 80px;\n            height: 2px;\n            border-radius: 1px;\n            background: linear-gradient(\n              90deg,\n              rgb(51 193 174 / 0%) 0%,\n              rgb(33 195 255 / 0%) 0%,\n              #21c3ff 100%\n            );\n\n            &.position1 {\n              left: 0;\n            }\n\n            &.position2 {\n              left: 134px;\n            }\n          }\n\n          .line-move {\n            position: absolute;\n            top: 0;\n            left: -318px;\n            animation: line-move-animation 1.5s cubic-bezier(0.4, 0, 0.2, 1) infinite;\n          }\n        }\n      }\n    }\n\n    .device-items {\n      display: flex;\n      position: absolute;\n      z-index: 1;\n      top: 28px;\n      left: 0;\n      justify-content: space-between;\n      width: 100%;\n      padding: 0 120px;\n\n      .device-item-box {\n        .device-item-img-box {\n          display: inline-block;\n          width: 80px;\n        }\n\n        .line {\n          width: 2px;\n          height: 16px;\n          margin: 0 auto;\n        }\n\n        .label-box {\n          display: inline-block;\n          height: 26px;\n          padding: 0 8px;\n          border-radius: 2px;\n          font-size: 12px;\n          line-height: 24px;\n        }\n      }\n    }\n\n    .data-box {\n      display: flex;\n      width: calc(100% - 20px);\n      height: 495px;\n      margin: 20px 10px 0;\n      border-radius: 2px;\n\n      .part-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 20px 16px 0;\n        line-height: 1;\n\n        .header-left {\n          display: flex;\n          align-items: center;\n\n          .header-icon {\n            width: 3px;\n            height: 16px;\n            margin-right: 10px;\n          }\n\n          .header-text {\n            font-size: 14px;\n          }\n        }\n\n        .header-right {\n          font-size: 12px;\n        }\n      }\n\n      .left-part {\n        flex: 1;\n\n        .data-list-box {\n          display: flex;\n          height: 457px;\n          margin-bottom: 0;\n          padding: 26px 18px 18px;\n          overflow-y: auto;\n\n          .data-list {\n            width: 50%;\n            height: fit-content;\n          }\n\n          .data-item {\n            display: flex;\n            font-size: 12px;\n            line-height: 1;\n            text-align: left;\n\n            & > span {\n              height: 31px;\n              padding: 0 6px;\n            }\n\n            .data-label {\n              flex: 5;\n            }\n\n            .data-value {\n              flex: 6;\n            }\n\n            .align-center {\n              display: flex;\n              align-items: center;\n            }\n\n            .align-right {\n              display: flex;\n              align-items: center;\n              justify-content: right;\n            }\n          }\n        }\n      }\n\n      .right-part {\n        flex: 1;\n\n        .part-content {\n          display: flex;\n          padding: 26px 16px 0;\n        }\n\n        .info-list {\n          // display: flex;\n          // flex-wrap: wrap;\n          // padding: 26px 16px 0;\n\n          .info-item {\n            width: 224px;\n            height: 32px;\n            margin: 0 7px 4px 0;\n            background-color: #63d575;\n            font-size: 14px;\n            line-height: 32px;\n\n            &.red-bg {\n              background-color: #ed706b;\n            }\n          }\n        }\n      }\n    }\n\n    .red-text {\n      color: #ff4d4f;\n    }\n\n    .blink {\n      animation: blink 0.5s infinite; /* 每1秒执行一次，无限次数 */\n    }\n  }\n</style>\n"],"names":["modalVisible","ref","updateVisible","$event","emit","deviceAbnormalTypeColors","deviceIconList","getDeviceIcons","computed","props","tabBarList","activeTabKey","handleClickTab","index","detailColumns","watch","newValue","dealTime","ycDateTime","time","item","halfSliceArr","data","newArr","sliceIndex","result","_a","_b","formatYcData","formatYxData","onMounted"],"mappings":"szFAkKQA,EAAeC,EAAI,EAAK,EACxBC,EAAiBC,GAAW,CAChCH,EAAa,MAAQG,EACrBC,EAAK,iBAAkB,EAAK,CAAA,EAIxBC,EAA2B,CAC/B,OAAQ,UACR,KAAM,UACN,MAAO,UACP,UAAW,SAAA,EAIPC,EAAiB,CACrB,gBAAiB,CACf,CACE,KAAM,eACN,WAAY,IACd,EACA,CACE,KAAM,uBACN,WAAY,EACd,EACA,CACE,KAAM,iBACN,WAAY,IACd,CACF,EACA,YAAa,CACX,CACE,KAAM,mBACN,WAAY,OACd,EACA,CACE,KAAM,0BACN,WAAY,EACd,EACA,CACE,KAAM,iBACN,WAAY,IACd,CACF,EACA,WAAY,CACV,CACE,KAAM,eACN,WAAY,IACd,EACA,CACE,KAAM,mBACN,WAAY,EACd,EACA,CACE,KAAM,0BACN,WAAY,QACd,CACF,EACA,YAAa,CACX,CACE,KAAM,gBACN,WAAY,KACd,EACA,CACE,KAAM,iBACN,WAAY,EACd,EACA,CACE,KAAM,gBACN,WAAY,MACd,CACF,EACA,cAAe,CACb,CACE,KAAM,cACN,WAAY,EACd,CACF,EACA,iBAAkB,CAChB,CACE,KAAM,yBACN,WAAY,EACd,CACF,EACA,aAAc,CACZ,CACE,KAAM,mBACN,WAAY,EACd,CACF,EACA,eAAgB,CACd,CACE,KAAM,cACN,WAAY,EACd,CACF,EACA,QAAS,CACP,CACE,KAAM,aACN,WAAY,EACd,CACF,EACA,cAAe,CACb,CACE,KAAM,gBACN,WAAY,EACd,CACF,EACA,sBAAuB,CACrB,CACE,KAAM,gBACN,WAAY,EACd,CACF,EACA,wBAAyB,CACvB,CACE,KAAM,WACN,WAAY,EACd,CACF,EACA,IAAK,CACH,CACE,KAAM,WACN,WAAY,EACd,CACF,EACA,OAAQ,CACN,CACE,KAAM,kBACN,WAAY,EACd,CACF,EACA,SAAU,CACR,CACE,KAAM,kBACN,WAAY,EACd,CACF,EACA,gBAAiB,CACf,CACE,KAAM,gBACN,WAAY,EACd,CACF,EACA,IAAK,CACH,CACE,KAAM,gBACN,WAAY,EACd,CACF,EACA,iBAAkB,CAChB,CACE,KAAM,gBACN,WAAY,EACd,CACF,CAAA,EAGIC,EAAiBC,EAAS,IACvBF,EAAeG,EAAM,KAAK,UAAU,GAAK,CAAC,CAAE,KAAM,gBAAiB,WAAY,EAAI,CAAA,CAC3F,EAGKC,EAAaT,EAAI,CAAC,OAAQ,OAAQ,OAAQ,MAAM,CAAC,EACjDU,EAAeV,EAAI,CAAC,EACpBW,EAAkBC,GAAU,CAChCF,EAAa,MAAQE,CAAA,EAIjBC,EAA+B,CACnC,CACE,MAAO,KACP,UAAW,OACX,MAAO,GACT,EACA,CACE,MAAO,MACP,UAAW,UACX,OAAQ,GACR,MAAO,EACT,EACA,CACE,MAAO,MACP,UAAW,UACX,OAAQ,GACR,MAAO,EACT,EACA,CACE,MAAO,MACP,UAAW,UACX,OAAQ,GACR,MAAO,EACT,EACA,CACE,MAAO,MACP,UAAW,UACX,OAAQ,GACR,MAAO,EACT,CAAA,EAEgBb,EAAI,CACpB,CACE,KAAM,YACN,QAAS,MACT,QAAS,MACT,QAAS,OACT,QAAS,KACX,CAAA,CACD,EAEDc,EACE,IAAMN,EAAM,QACXO,GAAa,CACZhB,EAAa,MAAQgB,EACrBL,EAAa,MAAQ,EACZM,GACX,CAAA,EAII,MAAAC,EAAaV,EAAS,IAAM,CAC5B,IAAAW,EAAOV,EAAM,OAAO,OAAQW,GAASA,EAAK,cAAgB,MAAM,EACpE,OAAID,GAAA,YAAAA,EAAM,QAAS,GAAKA,EAAK,CAAC,EAAE,KACvBA,EAAK,CAAC,EAAE,KAEV,EAAA,CACR,EAGKF,EAAW,IAAM,CAAA,EAGjBI,EAAgBC,GAAgB,SACpC,IAAIC,EAASD,EAAK,OAAQF,GAASA,EAAK,eAAiB,MAAM,EAC3DI,EAAa,KAAK,KAAKD,EAAO,OAAS,CAAC,EACxCE,EAAS,CAAA,EACb,OAAIC,EAAAH,EAAO,MAAM,EAAGC,CAAU,IAA1B,MAAAE,EAA6B,QAC/BD,EAAO,KAAKF,EAAO,MAAM,EAAGC,CAAU,CAAC,GAErCG,EAAAJ,EAAO,MAAMC,CAAU,IAAvB,MAAAG,EAA0B,QAC5BF,EAAO,KAAKF,EAAO,MAAMC,CAAU,CAAC,EAE/BC,CAAA,EAEHG,EAAepB,EAAS,IACrBa,EAAaZ,EAAM,MAAM,CACjC,EACKoB,EAAerB,EAAS,IACrBa,EAAaZ,EAAM,MAAM,CACjC,EAED,OAAAqB,EAAU,IAAM,CACd9B,EAAa,MAAQS,EAAM,OAAA,CAC5B"}