var h=(l,b,_)=>new Promise((r,x)=>{var s=m=>{try{o(_.next(m))}catch(d){x(d)}},f=m=>{try{o(_.throw(m))}catch(d){x(d)}},o=m=>m.done?r(m.value):Promise.resolve(m.value).then(s,f);o((_=_.apply(l,b)).next())});import{d as ie,k as c,r as R,o as re,al as g,Z as oe,a9 as se,aa as i,f as n,$ as ue,u as p,E as q,v as T,A as D}from"./vue-71d1abb3.js";import{D as de}from"./Dialog-0a006d82.js";import{_ as ce}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{B as me}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as pe}from"./useTable-109483b3.js";import{a2 as C}from"./antd-15ac76ed.js";import{a0 as fe,a5 as v,au as ge,av as F,_ as ve}from"./index.js";import{P as be}from"./index-20519caf.js";import{C as _e}from"./CommonTree-c4ed7838.js";import"./index-74ac3212.js";import{x as xe}from"./index-66d20ba6.js";import{a as E}from"./assign-37f1c13d.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";function he(){return[{title:"所属公司",dataIndex:"organName",headAlign:"center",align:"left",resizable:!0,sorter:!0,ifShow:fe().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",width:180,headAlign:"center",align:"left",resizable:!0,sorter:!0},{title:"在职人数",dataIndex:"num",width:120,headAlign:"center",align:"right",resizable:!0,sorter:!0},{title:"证书类型",dataIndex:"certificateTypeText",width:120,align:"center",resizable:!0,sorter:!0},{title:"最低持证要求",dataIndex:"minRequirement",width:120,headAlign:"center",align:"right",resizable:!0,sorter:!0},{title:"创建人",dataIndex:"creator",width:80,align:"center",resizable:!0,sorter:!0},{title:"创建时间",dataIndex:"createTime",align:"center",resizable:!0,sorter:!0},{title:"修改人",dataIndex:"updater",width:80,align:"center",resizable:!0,sorter:!0},{title:"修改时间",dataIndex:"updateTime",align:"center",resizable:!0,sorter:!0}]}const Ie=l=>v.post({url:"/baseset/common/list-orgStationTree",params:l},{}),ye=l=>v.get({url:"/baseset/personnel-qualifications/page",params:l},{}),U=l=>v.get({url:"/baseset/personnel-qualifications/get",params:l},{}),we=l=>v.post({url:"/baseset/personnel-qualifications/create",params:l},{}),Te=l=>v.put({url:"/baseset/personnel-qualifications/update",params:l},{}),De=l=>v.get({url:"/baseset/personnel-qualifications/get-num",params:l},{}),Ce=l=>l.id?Te(l):we(l),Ne=l=>v.delete({url:"/baseset/personnel-qualifications/delete",params:l},{}),ze={class:"right-table-layout"},Se=ie({__name:"index",setup(l){let b=c("");const{createConfirm:_}=ge(),r=R({}),x=c([]),s=c({});let f=!1;const o=R({open:{type:c(!1),index:c(!1)},title:{type:c(""),index:c("")}}),m=c(!1),d=c([]),P=he(),a=R({id:"",organId:"",organName:"",stationId:"",stationName:"",num:"",certificateType:"",minRequirement:""}),L=c(),N=c(),k=c([]),K=()=>h(this,null,function*(){let e=yield ye(r);return k.value=e.result,j(),k.value}),V={baseColProps:{span:7},labelWidth:120,showAdvancedButton:!1,schemas:[{label:"证书类型",field:"certificateType",component:"Select",componentProps:{options:[{label:"调度证",value:"ddz"},{label:"高压电工证",value:"gydgz"},{label:"登高作业证",value:"dgzyz"},{label:"安全资格证",value:"aqzgz"}]}}]},[H,{reload:z,getPaginationRef:M,clearSelectedRowKeys:j}]=pe({title:"人员资质配置",api:()=>h(this,null,function*(){const e=M();return r.pageNo=e.current,r.pageSize=e.pageSize,yield K()}),columns:P,useSearchForm:!0,formConfig:V,showTableSetting:!0,pagination:{pageSize:20},bordered:!0,rowKey:"id",rowSelection:{type:"radio",onChange:W},handleSearchInfoFn(e){return r.certificateType=e.certificateType,e},sortFn:e=>{e.order?(r.sortField=e.field,r.sortOrder=e.order.replace("end","")):(r.sortField=null,r.sortOrder=null)}});function W(e,t){t.length>0?(d.value=[e[0]],b.value=e[0]):(d.value=[],b.value="")}function $(){return h(this,null,function*(){const e=yield Ie({});x.value=e.result})}function Z(e){return e.id?"修改":"添加"}function G(){let e=N.value;e&&e.validateFields().then(()=>{m.value=!0;let t=Z(a);a.name=xe.trim(a.name),Ce(a).then(()=>{C.success(t+"成功"),B(),z(),o.open.index=!1,m.value=!1}).catch(()=>{m.value=!1})}).catch(()=>{})}function J(){B(),o.open.index=!1}function B(){var e,t;(e=L.value)==null||e.resetFields(),(t=N.value)==null||t.resetFields()}function Q(e){s.value.stationId=null,r.organId=null,r.stationId=null,e&&(e.nodeKindId=="org"&&(r.organId=e.id),e.nodeKindId=="station"&&(s.value.stationId=e.id,s.value.stationName=e.name,r.stationId=e.id,x.value.forEach(t=>{t.id==e.parentId&&(s.value.organId=t.id,s.value.organName=t.name)}))),z()}function X(){return h(this,null,function*(){if(s.value.stationId==null){C.error("请先选择电站。");return}f=!1;const e=yield De({stationId:s.value.stationId});a.id="",a.organId=s.value.organId,a.organName=s.value.organName,a.stationId=s.value.stationId,a.stationName=s.value.stationName,a.certificateType="",a.minRequirement=null,a.num=e.result,o.open.index=!0,o.title.index="添加人员资质配置"})}function O(){return d.value.length==0||d.value.length>1||!d.value[0]?(C.error("请选择一行数据"),!1):!0}function Y(){O()&&(U({id:d.value[0]}).then(e=>{E(a,e.result)}),f=!1,o.open.index=!0,o.title.index="修改人员资质配置")}function ee(e){U({id:e.id}).then(t=>{E(a,t.result)}),f=!0,o.open.index=!0,o.title.index="查看人员资质配置"}function te(){O()&&_({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return h(this,null,function*(){Ne("?id="+d.value[0]).then(()=>{C.success("已删除"),d.value=[],z()})})}})}return re(()=>{$()}),(e,t)=>{const S=g("a-button"),A=g("a-input"),I=g("a-form-item"),y=g("a-col"),w=g("a-row"),ae=g("a-input-number"),ne=g("a-form");return oe(),se(p(be),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:i(()=>[n(_e,{title:"电站组织",onSelect:Q,value:x.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),ue("div",ze,[n(p(me),{class:"fix-basic-table",onRegister:p(H),searchInfo:r,onResizeColumn:t[0]||(t[0]=(u,le)=>le.width=u),onRowDbClick:t[1]||(t[1]=u=>ee(u))},{toolbar:i(()=>[n(S,{type:"primary",preIcon:p(F).ADD,onClick:X},{default:i(()=>[q("添加")]),_:1},8,["preIcon"]),n(S,{type:"primary",disabled:p(b)=="",preIcon:p(F).EDIT,onClick:Y},{default:i(()=>[q("修改")]),_:1},8,["disabled","preIcon"]),n(S,{class:"red-btn",disabled:p(b)=="",preIcon:p(F).DELETE,onClick:te},{default:i(()=>[q("删除")]),_:1},8,["disabled","preIcon"])]),_:1},8,["onRegister","searchInfo"])]),n(de,{visible:o.open.index,"onUpdate:visible":t[6]||(t[6]=u=>o.open.index=u),title:o.title.index,onOk:G,onCancel:J,height:400,width:800,smode:"normal",showBtm:!p(f)},{default:i(()=>[n(ne,{ref_key:"modalIndexFormRef",ref:N,model:a,name:"userIndexForm"},{default:i(()=>[n(w,null,{default:i(()=>[T(n(y,{span:24},{default:i(()=>[n(I,{label:"电站名称",name:"stationName",labelCol:{style:{width:"124px"}}},{default:i(()=>[n(A,{value:a.stationName,"onUpdate:value":t[2]||(t[2]=u=>a.stationName=u),disabled:!0},null,8,["value"])]),_:1})]),_:1},512),[[D,!0]])]),_:1}),n(w,null,{default:i(()=>[T(n(y,{span:24},{default:i(()=>[n(I,{label:"在职人数",name:"num",labelCol:{style:{width:"124px"}}},{default:i(()=>[n(A,{value:a.num,"onUpdate:value":t[3]||(t[3]=u=>a.num=u),disabled:!0},null,8,["value"])]),_:1})]),_:1},512),[[D,!0]])]),_:1}),n(w,null,{default:i(()=>[T(n(y,{span:24},{default:i(()=>[n(I,{label:"证书类型",name:"certificateType",labelCol:{style:{width:"124px"}},rules:[{required:!0}]},{default:i(()=>[n(ce,{value:a.certificateType,"onUpdate:value":t[4]||(t[4]=u=>a.certificateType=u),disabled:p(f),type:"certificate"},null,8,["value","disabled"])]),_:1})]),_:1},512),[[D,!0]])]),_:1}),n(w,null,{default:i(()=>[T(n(y,{span:24},{default:i(()=>[n(I,{label:"最低持证要求",name:"minRequirement",labelCol:{style:{width:"124px"}},rules:[{required:!0}]},{default:i(()=>[n(ae,{id:"inputNumber",value:a.minRequirement,"onUpdate:value":t[5]||(t[5]=u=>a.minRequirement=u),min:1,max:100,disabled:p(f)},null,8,["value","disabled"])]),_:1})]),_:1},512),[[D,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","showBtm"])]),_:1})}}});const ot=ve(Se,[["__scopeId","data-v-770dcf5e"]]);export{ot as default};
//# sourceMappingURL=index-41a4b01d.js.map
