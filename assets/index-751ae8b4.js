var U=(f,L,b)=>new Promise((_,y)=>{var i=c=>{try{T(b.next(c))}catch(h){y(h)}},o=c=>{try{T(b.throw(c))}catch(h){y(h)}},T=c=>c.done?_(c.value):Promise.resolve(c.value).then(i,o);T((b=b.apply(f,L)).next())});import{d as ce,r as O,k as C,o as ve,al as k,Z as I,a9 as B,aa as l,f as e,u,E as g,ac as S,_ as M,ad as be,F as ge,v as d,A as p,q as he}from"./vue-71d1abb3.js";import{B as ye}from"./BasicTable-0434a334.js";import{T as xe}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as _e}from"./useTable-109483b3.js";import{a2 as F}from"./antd-15ac76ed.js";import{a5 as E,b as we,au as Ce,av as D,_ as ke}from"./index.js";import{P as Ie}from"./index-20519caf.js";import{_ as H}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{D as J}from"./Dialog-0a006d82.js";import{a as P}from"./assign-37f1c13d.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";const Te=[{field:"name",component:"Input",label:"指标名称",colProps:{span:7},required:!1}],Ae=[{title:"指标类别",dataIndex:"kindText",align:"center",resizable:!0,width:100},{title:"指标编码",dataIndex:"code",sorter:!0,resizable:!0,width:100},{title:"指标名称",dataIndex:"name",resizable:!0,align:"center",width:100},{title:"评价方式",dataIndex:"evaluationMethodText",resizable:!0,width:80},{title:"考核目标",dataIndex:"assessTarget",resizable:!0,align:"left",width:200},{title:"评分规则",dataIndex:"scoreRuleDesc",resizable:!0,align:"left",width:400},{title:"是否可填附加分",dataIndex:"allowOverrunText",resizable:!0,align:"center",width:120},{title:"配置状态",dataIndex:"ruleConfigStatusText",resizable:!0,align:"center",width:80},{title:"状态",dataIndex:"status",resizable:!0,align:"center",width:80},{title:"排序号",dataIndex:"sort",sorter:!0,resizable:!0,align:"center",width:100},{title:"指标修改人",dataIndex:"updaterName",resizable:!0,align:"center",width:100},{title:"指标修改时间",dataIndex:"updateTime",sorter:!0,resizable:!0,align:"center",width:150},{title:"配置人",dataIndex:"configurerName",resizable:!0,align:"center",width:100},{title:"配置时间",dataIndex:"configTime",sorter:!0,resizable:!0,align:"center"}],Se=f=>E.get({url:"/po/evaluation-index/page",params:f},{isOnlyResult:!0}),Q=f=>E.post({url:"/po/evaluation-index/save",params:f},{}),Fe=f=>E.put({url:"/po/evaluation-index/update",params:f},{}),De=f=>E.delete({url:"/po/evaluation-index/delete?id="+f},{}),qe=f=>E.post({url:"/po/evaluation-index/config",params:f},{}),Ue=f=>E.post({url:"/po/evaluation-index/saveSort",params:f},{}),Ee=["onClick"],Re={key:0,style:{color:"red"}},ze={key:1,style:{color:"#30ca5a"}},Ne=ce({__name:"index",setup(f){we();const{createConfirm:L}=Ce(),b=O({}),_=C(!1),y=C(!1),i=O({name:"",id:"",kind:"",evaluationMethod:"",assessTarget:"",scoreRuleDesc:"",allowOverrun:""}),o=O({}),T=C(""),c=C(!1),h=C(!1),R=C(),V=C();let A=O({}),v=C("");const X=()=>U(this,null,function*(){let n=te().getFieldsValue();return n.sortField=b.sortField,n.sortOrder=b.sortOrder,yield Se(n)}),[ee,{reload:q,getForm:te,getDataSource:le}]=_e({title:"评价指标",api:X,rowKey:"id",columns:Ae,useSearchForm:!0,showTableSetting:!0,bordered:!0,pagination:{pageSize:100},handleSearchInfoFn(n){return n},formConfig:{labelWidth:120,actionColOptions:{span:24},autoAdvancedLine:1,baseColProps:{span:7},schemas:Te,autoSubmitOnEnter:!0,noHideBtnFlag:!0},rowSelection:{type:"radio",fixed:!0,onSelect:ne},sortFn:n=>{n.order?(b.sortField=n.field,b.sortOrder=n.order.replace("end","")):(b.sortField="",b.sortOrder="")}});function ae({keys:n,rows:t}){if(t&&t.length>0){const m=t[0];v.value=m.id,A=m}else v.value="",A=null}function ne(n,t){t?(v.value=n.id,A=n):(v.value="",A=null)}function ie({record:n,index:t,key:m,value:W}){Q(n).then(()=>{F.success("已保存"),q()}).catch(()=>{})}const oe=n=>U(this,null,function*(){P(o,n),_.value=!0,h.value=!0}),re=()=>U(this,null,function*(){var n;T.value="添加评价指标",y.value=!0,(n=R.value)==null||n.resetFields(),c.value=!1});function se(){if(v.value==""){F.error("请先选择数据。");return}T.value="修改评价指标",he(()=>{P(i,A)}),y.value=!0,c.value=!0}function ue(){R.value.validateFields().then(()=>{Q(i).then(()=>{var n;F.success("保存成功"),q(),(n=R.value)==null||n.resetFields(),y.value=!1}).catch(()=>{})})}function $(){y.value=!1}function de(){if(v.value==""){F.error("请先选择数据。");return}if(A.evaluationMethod!="system"){F.warning("非系统评价，无须配置。");return}P(o,A),_.value=!0,h.value=!1}function j(){_.value=!1}function pe(){V.value.validateFields().then(()=>{qe(o).then(()=>{var n;F.success("配置成功"),(n=V.value)==null||n.resetFields(),_.value=!1,q()}).catch(()=>{})})}function K(n){let t={id:v.value,status:n};Fe(t).then(()=>{q()})}function me(){L({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return U(this,null,function*(){De(v.value).then(()=>{q()})})}})}function fe(){let n=le().map(t=>({id:t.id,sort:t.sort}));Ue(n).then(t=>{F.success("已保存"),q()})}return ve(()=>U(this,null,function*(){})),(n,t)=>{const m=k("a-button"),W=k("a-input-number"),r=k("a-form-item"),s=k("a-col"),x=k("a-input"),z=k("a-textarea"),Y=k("a-row"),Z=k("a-form");return I(),B(u(Ie),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:l(()=>[e(u(ye),{class:"fix-basic-table",onRegister:u(ee),searchInfo:b,onEditEnd:ie,onSelectionChange:ae,onResizeColumn:t[2]||(t[2]=(a,w)=>w.width=a)},{toolbar:l(()=>[e(m,{type:"primary",preIcon:u(D).ADD,onClick:re},{default:l(()=>[g("添加")]),_:1},8,["preIcon"]),e(m,{type:"primary",disabled:u(v)=="",preIcon:u(D).EDIT,onClick:se},{default:l(()=>[g("修改")]),_:1},8,["disabled","preIcon"]),e(m,{class:"red-btn",disabled:u(v)=="",preIcon:u(D).DELETE,onClick:me},{default:l(()=>[g("删除")]),_:1},8,["disabled","preIcon"]),e(m,{type:"primary",disabled:u(v)=="",preIcon:u(D).ADD,onClick:de},{default:l(()=>[g("评分规则")]),_:1},8,["disabled","preIcon"]),e(m,{type:"primary",preIcon:u(D).ADD,onClick:fe},{default:l(()=>[g("保存排序号")]),_:1},8,["preIcon"]),e(m,{class:"green-btn",disabled:u(v)=="",preIcon:u(D).ENABLE,onClick:t[0]||(t[0]=a=>K(1))},{default:l(()=>[g("启用")]),_:1},8,["disabled","preIcon"]),e(m,{class:"grey-btn",disabled:u(v)=="",preIcon:u(D).DISABLE,onClick:t[1]||(t[1]=a=>K(0))},{default:l(()=>[g("禁用")]),_:1},8,["disabled","preIcon"])]),bodyCell:l(({text:a,column:w,record:N})=>[w.key==="action"?(I(),B(u(xe),{key:0,actions:n.getAccountAction(n.handleView,N)},null,8,["actions"])):S("",!0),w.key==="sort"?(I(),B(W,{key:1,value:N[w.dataIndex],"onUpdate:value":G=>N[w.dataIndex]=G},null,8,["value","onUpdate:value"])):S("",!0),w.key==="code"?(I(),M("span",{key:2,style:{color:"#338ed1"},onClick:G=>oe(N)},be(a),9,Ee)):S("",!0),w.key==="status"?(I(),M(ge,{key:3},[a==0?(I(),M("span",Re,"禁用")):S("",!0),a==1?(I(),M("span",ze,"启用")):S("",!0)],64)):S("",!0)]),_:1},8,["onRegister","searchInfo"]),e(J,{visible:y.value,"onUpdate:visible":t[13]||(t[13]=a=>y.value=a),title:T.value,onCancel:$,height:600,width:800,smode:"normal",overflowY:"auto"},{footer:l(()=>[e(m,{style:{"margin-right":"10px"},key:"back",onClick:$},{default:l(()=>[g("取消")]),_:1}),e(m,{key:"submit",type:"primary",onClick:ue},{default:l(()=>[g("确定")]),_:1})]),default:l(()=>[e(Z,{id:"index-form",ref_key:"indexFormRef",ref:R,model:i,name:"indexForm",labelAlign:"center"},{default:l(()=>[e(Y,null,{default:l(()=>[d(e(s,{span:24},{default:l(()=>[e(r,{label:"指标类别",name:"kind",labelAlign:"right",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请选择指标类别"}]},{default:l(()=>[e(H,{style:{width:"100%"},disabled:c.value,value:i.kind,"onUpdate:value":t[3]||(t[3]=a=>i.kind=a),type:"EvaluationIndexKind"},null,8,["disabled","value"])]),_:1})]),_:1},512),[[p,!0]]),d(e(s,{span:24},{default:l(()=>[e(r,{label:"指标名称",name:"name",labelAlign:"right",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请输入指标名称"}]},{default:l(()=>[e(x,{disabled:c.value,value:i.name,"onUpdate:value":t[4]||(t[4]=a=>i.name=a),maxlength:64},null,8,["disabled","value"])]),_:1})]),_:1},512),[[p,!0]]),d(e(s,{span:24},{default:l(()=>[e(r,{label:"评价方式",name:"evaluationMethod",labelAlign:"right",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请选择评价方式"}]},{default:l(()=>[e(H,{style:{width:"100%"},disabled:c.value,value:i.evaluationMethod,"onUpdate:value":t[5]||(t[5]=a=>i.evaluationMethod=a),type:"evaluation_method"},null,8,["disabled","value"])]),_:1})]),_:1},512),[[p,!0]]),d(e(s,{span:24},{default:l(()=>[e(r,{label:"考核目标",name:"assessTarget",labelAlign:"right",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请输入考核目标"}]},{default:l(()=>[e(z,{rows:4,value:i.assessTarget,"onUpdate:value":t[6]||(t[6]=a=>i.assessTarget=a),"show-count":"",maxlength:128},null,8,["value"])]),_:1})]),_:1},512),[[p,!0]]),d(e(s,{span:24},{default:l(()=>[e(r,{label:"评分规则",name:"scoreRuleDesc",labelAlign:"right",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请输入评分规则"}]},{default:l(()=>[e(z,{rows:4,value:i.scoreRuleDesc,"onUpdate:value":t[7]||(t[7]=a=>i.scoreRuleDesc=a),"show-count":"",maxlength:500},null,8,["value"])]),_:1})]),_:1},512),[[p,!0]]),d(e(s,{span:24},{default:l(()=>[e(r,{label:"是否可填附加分",name:"allowOverrun",labelAlign:"right",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请选择是否可填附加分"}]},{default:l(()=>[e(H,{style:{width:"100%"},disabled:c.value,value:i.allowOverrun,"onUpdate:value":t[8]||(t[8]=a=>i.allowOverrun=a),type:"yes_or_no"},null,8,["disabled","value"])]),_:1})]),_:1},512),[[p,!0]]),d(e(s,{span:24},{default:l(()=>[e(r,{label:"指标修改人",name:"updaterName",labelAlign:"right",labelCol:{style:{width:"124px"}}},{default:l(()=>[e(x,{disabled:"",value:i.updaterName,"onUpdate:value":t[9]||(t[9]=a=>i.updaterName=a)},null,8,["value"])]),_:1})]),_:1},512),[[p,!0]]),d(e(s,{span:24},{default:l(()=>[e(r,{label:"指标修改时间",name:"updateTime",labelAlign:"right",labelCol:{style:{width:"124px"}}},{default:l(()=>[e(x,{disabled:"",value:i.updateTime,"onUpdate:value":t[10]||(t[10]=a=>i.updateTime=a)},null,8,["value"])]),_:1})]),_:1},512),[[p,!0]]),d(e(s,{span:24},{default:l(()=>[e(r,{label:"配置人",name:"configurerName",labelAlign:"right",labelCol:{style:{width:"124px"}}},{default:l(()=>[e(x,{disabled:"",value:i.configurerName,"onUpdate:value":t[11]||(t[11]=a=>i.configurerName=a)},null,8,["value"])]),_:1})]),_:1},512),[[p,!0]]),d(e(s,{span:24},{default:l(()=>[e(r,{label:"配置时间",name:"configTime",labelAlign:"right",labelCol:{style:{width:"124px"}}},{default:l(()=>[e(x,{disabled:"",value:i.configTime,"onUpdate:value":t[12]||(t[12]=a=>i.configTime=a)},null,8,["value"])]),_:1})]),_:1},512),[[p,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),e(J,{visible:_.value,"onUpdate:visible":t[20]||(t[20]=a=>_.value=a),title:"评分规则",onCancel:j,height:600,width:1e3,smode:"normal",overflowY:"auto"},{footer:l(()=>[e(m,{key:"back",style:{"margin-right":"10px"},onClick:j},{default:l(()=>[g("取消")]),_:1}),h.value?S("",!0):(I(),B(m,{key:"submit",type:"primary",onClick:pe},{default:l(()=>[g("确定")]),_:1}))]),default:l(()=>[e(Z,{id:"sql-form",ref_key:"sqlFormRef",ref:V,model:o,name:"sqlForm",labelAlign:"center"},{default:l(()=>[e(Y,{gutter:32},{default:l(()=>[d(e(s,{span:24},{default:l(()=>[e(r,{label:"指标名称",name:"name",labelAlign:"right",labelCol:{style:{width:"124px"}}},{default:l(()=>[e(x,{disabled:"",value:o.name,"onUpdate:value":t[14]||(t[14]=a=>o.name=a)},null,8,["value"])]),_:1})]),_:1},512),[[p,!0]]),d(e(s,{span:24},{default:l(()=>[e(r,{label:"指标编码",name:"code",labelAlign:"right",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请输入指标编码"}]},{default:l(()=>[e(x,{disabled:h.value,value:o.code,"onUpdate:value":t[15]||(t[15]=a=>o.code=a),maxlength:32},null,8,["disabled","value"])]),_:1})]),_:1},512),[[p,!0]]),d(e(s,{span:24},{default:l(()=>[e(r,{label:"评分规则",name:"scoreRuleDesc",labelAlign:"right",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请输入评分规则"}]},{default:l(()=>[e(z,{rows:4,value:o.scoreRuleDesc,"onUpdate:value":t[16]||(t[16]=a=>o.scoreRuleDesc=a),"show-count":"",disabled:h.value,maxlength:500},null,8,["value","disabled"])]),_:1})]),_:1},512),[[p,!0]]),d(e(s,{span:24},{default:l(()=>[e(r,{label:"计算sql",name:"calculationStatement",labelAlign:"right",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请输入计算sql"}]},{default:l(()=>[e(z,{disabled:h.value,rows:4,value:o.calculationStatement,"onUpdate:value":t[17]||(t[17]=a=>o.calculationStatement=a),"show-count":"",maxlength:1e3},null,8,["disabled","value"])]),_:1})]),_:1},512),[[p,!0]]),d(e(s,{span:12},{default:l(()=>[e(r,{label:"配置人",name:"configurerName",labelAlign:"right",labelCol:{style:{width:"124px"}}},{default:l(()=>[e(x,{disabled:"",value:o.configurerName,"onUpdate:value":t[18]||(t[18]=a=>o.configurerName=a)},null,8,["value"])]),_:1})]),_:1},512),[[p,!0]]),d(e(s,{span:12},{default:l(()=>[e(r,{label:"配置时间",name:"configTime",labelAlign:"right",labelCol:{style:{width:"124px"}}},{default:l(()=>[e(x,{disabled:"",value:o.configTime,"onUpdate:value":t[19]||(t[19]=a=>o.configTime=a)},null,8,["value"])]),_:1})]),_:1},512),[[p,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])]),_:1})}}});const ut=ke(Ne,[["__scopeId","data-v-c4c7deff"]]);export{ut as default};
//# sourceMappingURL=index-751ae8b4.js.map
