{"version":3,"file":"create-a4226959.js","sources":["../../src/views/po/drone/droneinspection/create.vue"],"sourcesContent":["<template>\n  <div class=\"load\">\n    <a-spin :spinning=\"detailFormState.spinning\" tip=\"Loading...\">\n      <div class=\"process-box\">\n        <div class=\"header-box\">\n          <BillTitle :options=\"billTitleOption\" />\n          <div class=\"header-right\" style=\"width: 15%\">\n            <a-button\n              :disabled=\"!disabledInput\"\n              type=\"primary\"\n              @click=\"perform\"\n              :loading=\"isLoading\"\n            >\n              执行\n            </a-button>\n            <a-button\n              class=\"!ml-4\"\n              :disabled=\"!disabledInput\"\n              type=\"primary\"\n              @click=\"save\"\n              :loading=\"isLoading\"\n            >\n              保存\n            </a-button>\n            <a-button class=\"!ml-4\" @click=\"handleCancel\">关闭</a-button>\n          </div>\n        </div>\n        <div class=\"content\">\n          <a-form ref=\"formRef\" :model=\"detailFormState\" labelAlign=\"right\" autocomplete=\"off\">\n            <a-card title=\"告警信息\" :bordered=\"false\">\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"powerStationName\"\n                    label=\"电站\"\n                    :labelCol=\"{ span: 4 }\"\n                    :rules=\"[{ required: false }]\"\n                  >\n                    <a-input disabled v-model:value=\"detailFormState.powerStationName\" />\n                  </a-form-item>\n                </a-col>\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"equipmentName\"\n                    label=\"告警设备\"\n                    :labelCol=\"{ span: 4 }\"\n                    :rules=\"[{ required: false }]\"\n                  >\n                    <a-input disabled v-model:value=\"detailFormState.equipmentName\" />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"alarmContent\"\n                    label=\"告警内容\"\n                    :labelCol=\"{ span: 4 }\"\n                    :rules=\"[{ required: false }]\"\n                  >\n                    <a-input disabled v-model:value=\"detailFormState.alarmContent\" />\n                  </a-form-item>\n                </a-col>\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"alarmTime\"\n                    label=\"告警时间\"\n                    :labelCol=\"{ span: 4 }\"\n                    :rules=\"[{ required: false }]\"\n                  >\n                    <a-input disabled v-model:value=\"detailFormState.alarmTime\" />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n            </a-card>\n            <a-card title=\"巡检信息\" :bordered=\"false\">\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"statusText\"\n                    label=\"状态\"\n                    :labelCol=\"{ span: 4 }\"\n                    :rules=\"[{ required: false }]\"\n                  >\n                    <a-input disabled v-model:value=\"detailFormState.statusText\" />\n                  </a-form-item>\n                </a-col>\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"startTime\"\n                    label=\"巡检开始时间\"\n                    :labelCol=\"{ span: 4 }\"\n                    :rules=\"[{ required: false }]\"\n                  >\n                    <a-input disabled v-model:value=\"detailFormState.startTime\" />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-form-item\n                    name=\"endTime\"\n                    label=\"巡检结束时间\"\n                    :labelCol=\"{ span: 4 }\"\n                    :rules=\"[{ required: false }]\"\n                  >\n                    <a-input disabled v-model:value=\"detailFormState.endTime\" />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"24\">\n                  <a-form-item\n                    name=\"results\"\n                    label=\"巡检结果\"\n                    :labelCol=\"{ span: 2 }\"\n                    :rules=\"[{ required: false }]\"\n                  >\n                    <a-textarea\n                      disabled\n                      v-model:value=\"detailFormState.results\"\n                      :auto-size=\"{ minRows: 8, maxRows: 10 }\"\n                    />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n            </a-card>\n            <a-card title=\"巡检详情\" :bordered=\"false\">\n              <a-row :gutter=\"24\">\n                <a-col v-show=\"true\" :span=\"12\">\n                  <a-button\n                    :disabled=\"detailFormState.status != 2\"\n                    type=\"primary\"\n                    @click=\"toDetail\"\n                    :loading=\"isLoading\"\n                  >\n                    查看\n                  </a-button>\n                </a-col>\n              </a-row>\n            </a-card>\n          </a-form>\n        </div>\n      </div>\n    </a-spin>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\n  import { reactive, ref, onMounted, unref, Ref, toRaw } from 'vue';\n  import { saveData, getIndex, saveAndPerform } from './index';\n  import { FormInstance, message } from 'ant-design-vue';\n  import { useRouter } from 'vue-router';\n  import { assign } from 'lodash-es';\n  import BillTitle from '/@/components/Framework/BillTitle/BillTitle.vue';\n\n  import { closeCurrentTab, addTabPage } from '@/utils/route';\n  import { MsgManager } from '/@/message/MsgManager';\n  import { Memory } from '@/router/index';\n\n  const detailFormState = reactive({ spinning: false });\n  const showPageFooter: Ref = ref(true);\n  const isLoading = ref(false);\n\n  const disabledInput = ref<boolean>(false);\n  const billTitleOption = reactive<any>({});\n  billTitleOption.subject = '无人机巡检';\n  billTitleOption.infoItems = [];\n  const router = useRouter();\n  const { currentRoute } = router;\n  const route = unref(currentRoute);\n  const query = Memory.getInstance().getQuery(); // route.query;\n\n  // 取消按钮\n  function handleCancel() {\n    closeCurrentTab();\n  }\n\n  const formRef = ref<FormInstance>();\n\n  function save() {\n    detailFormState.spinning = true;\n    try {\n      formRef.value.validateFields().then(() => {\n        saveData(detailFormState).then((data) => {\n          detailFormState.id = data.result;\n          message.success('保存成功');\n          MsgManager.getInstance().sendMsg('droneinspection', {});\n          closeCurrentTab();\n        });\n      });\n    } catch (error) {\n      console.log('error', error);\n    } finally {\n      detailFormState.spinning = false;\n    }\n  }\n\n  function perform() {\n    detailFormState.spinning = true;\n    try {\n      formRef.value.validateFields().then(() => {\n        saveAndPerform(detailFormState).then((data) => {\n          detailFormState.id = data.result;\n          message.success('下发成功，请稍后查看结果。');\n          MsgManager.getInstance().sendMsg('droneinspection', {});\n          closeCurrentTab();\n        });\n      });\n    } catch (error) {\n      console.log('error', error);\n    } finally {\n      detailFormState.spinning = false;\n    }\n  }\n\n  function toDetail() {\n    var form = {\n      content: detailFormState.content,\n    };\n    addTabPage(`/po/drone/droneinspection/content`, '查看巡检详情', toRaw(form));\n  }\n\n  const droneInspectionStatus = ['未执行', '执行中', '已执行', '执行失败'];\n\n  onMounted(async () => {\n    await getIndex({ id: query.id, billCode: query.billCode }).then((data) => {\n      if (query.id || query.billCode) {\n        assign(detailFormState, data.result);\n      } else {\n        const mergedObject = { ...data.result, ...query };\n        assign(detailFormState, mergedObject);\n        detailFormState.spinning = false;\n      }\n      detailFormState.statusText = droneInspectionStatus[detailFormState.status];\n      detailFormState.spinning = false;\n    });\n\n    await getRecordable();\n  });\n\n  const getRecordable = async () => {\n    disabledInput.value = detailFormState.status == 0;\n    billTitleOption.title = '无人机巡检';\n    let { billCode, fillinDate, personMemberName, deptName } = detailFormState;\n    assign(billTitleOption, { billCode, fillinDate, personMemberName, deptName });\n  };\n</script>\n<style lang=\"less\" scoped>\n  .process-box {\n    width: calc(100% - 20px);\n    height: calc(100% - 20px);\n\n    .content {\n      .left-panel {\n        width: 77.5%;\n        height: calc(100vh - 200px);\n        margin: 5px 0;\n        padding: 10px 0 5px;\n        float: left;\n        overflow-y: auto;\n        border: 1px solid #f0f0f0;\n      }\n\n      .right-panel {\n        width: 22.25%;\n        height: calc(100vh - 200px);\n        margin: 5px 0;\n        padding: 10px 0 5px;\n        float: right;\n        border: 1px solid #f0f0f0;\n\n        .button-content {\n          margin: 16px 0 0 16px;\n\n          .ant-btn {\n            margin: 0 10px 0 0;\n          }\n        }\n      }\n    }\n  }\n\n  .bill-title-box {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    width: 100%;\n\n    .bill-title {\n      font-size: 16px;\n    }\n  }\n</style>\n"],"names":["detailFormState","reactive","ref","isLoading","disabledInput","billTitleOption","router","useRouter","currentRoute","unref","query","Memory","handleCancel","closeCurrentTab","formRef","save","saveData","data","message","MsgManager","error","perform","saveAndPerform","toDetail","form","addTabPage","toRaw","droneInspectionStatus","onMounted","__async","getIndex","assign","mergedObject","__spreadValues","getRecordable","billCode","fillinDate","personMemberName","deptName"],"mappings":"4lCAkKE,MAAMA,EAAkBC,EAAS,CAAE,SAAU,EAAO,CAAA,EACxBC,EAAI,EAAI,EAC9B,MAAAC,EAAYD,EAAI,EAAK,EAErBE,EAAgBF,EAAa,EAAK,EAClCG,EAAkBJ,EAAc,CAAA,CAAE,EACxCI,EAAgB,QAAU,QAC1BA,EAAgB,UAAY,GAC5B,MAAMC,EAASC,IACT,CAAE,aAAAC,CAAiB,EAAAF,EACXG,EAAMD,CAAY,EAChC,MAAME,EAAQC,GAAO,YAAY,EAAE,SAAS,EAG5C,SAASC,GAAe,CACNC,GAClB,CAEA,MAAMC,EAAUZ,IAEhB,SAASa,GAAO,CACdf,EAAgB,SAAW,GACvB,GAAA,CACFc,EAAQ,MAAM,eAAiB,EAAA,KAAK,IAAM,CACxCE,GAAShB,CAAe,EAAE,KAAMiB,GAAS,CACvCjB,EAAgB,GAAKiB,EAAK,OAC1BC,EAAQ,QAAQ,MAAM,EACtBC,EAAW,YAAY,EAAE,QAAQ,kBAAmB,CAAE,CAAA,EACtCN,GAAA,CACjB,CAAA,CACF,QACMO,EAAO,CACN,QAAA,IAAI,QAASA,CAAK,CAAA,QAC1B,CACApB,EAAgB,SAAW,EAC7B,CACF,CAEA,SAASqB,GAAU,CACjBrB,EAAgB,SAAW,GACvB,GAAA,CACFc,EAAQ,MAAM,eAAiB,EAAA,KAAK,IAAM,CACxCQ,GAAetB,CAAe,EAAE,KAAMiB,GAAS,CAC7CjB,EAAgB,GAAKiB,EAAK,OAC1BC,EAAQ,QAAQ,eAAe,EAC/BC,EAAW,YAAY,EAAE,QAAQ,kBAAmB,CAAE,CAAA,EACtCN,GAAA,CACjB,CAAA,CACF,QACMO,EAAO,CACN,QAAA,IAAI,QAASA,CAAK,CAAA,QAC1B,CACApB,EAAgB,SAAW,EAC7B,CACF,CAEA,SAASuB,GAAW,CAClB,IAAIC,EAAO,CACT,QAASxB,EAAgB,OAAA,EAE3ByB,GAAW,oCAAqC,SAAUC,EAAMF,CAAI,CAAC,CACvE,CAEA,MAAMG,EAAwB,CAAC,MAAO,MAAO,MAAO,MAAM,EAE1DC,EAAU,IAAYC,EAAA,sBACpB,MAAMC,GAAS,CAAE,GAAIpB,EAAM,GAAI,SAAUA,EAAM,QAAU,CAAA,EAAE,KAAMO,GAAS,CACpE,GAAAP,EAAM,IAAMA,EAAM,SACbqB,EAAA/B,EAAiBiB,EAAK,MAAM,MAC9B,CACL,MAAMe,EAAeC,IAAA,GAAKhB,EAAK,QAAWP,GAC1CqB,EAAO/B,EAAiBgC,CAAY,EACpChC,EAAgB,SAAW,EAC7B,CACgBA,EAAA,WAAa2B,EAAsB3B,EAAgB,MAAM,EACzEA,EAAgB,SAAW,EAAA,CAC5B,EAED,MAAMkC,EAAc,CAAA,EACrB,EAED,MAAMA,EAAgB,IAAYL,EAAA,sBAClBzB,EAAA,MAAQJ,EAAgB,QAAU,EAChDK,EAAgB,MAAQ,QACxB,GAAI,CAAE,SAAA8B,EAAU,WAAAC,EAAY,iBAAAC,EAAkB,SAAAC,GAAatC,EAC3D+B,EAAO1B,EAAiB,CAAE,SAAA8B,EAAU,WAAAC,EAAY,iBAAAC,EAAkB,SAAAC,EAAU,CAAA"}