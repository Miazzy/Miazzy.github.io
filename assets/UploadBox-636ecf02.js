var r=(y,o,e)=>new Promise((d,a)=>{var u=c=>{try{b(e.next(c))}catch(f){a(f)}},g=c=>{try{b(e.throw(c))}catch(f){a(f)}},b=c=>c.done?d(c.value):Promise.resolve(c.value).then(u,g);b((e=e.apply(y,o)).next())});import{am as W,I as C,bt as X,at as v,bu as Y,bv as ee,aa as R,_ as J,w as P,bw as te}from"./index.js";import{D as ae}from"./Dialog-0a006d82.js";import{a0 as le,ai as ne}from"./antd-15ac76ed.js";import{d as Z,k as s,e as G,w as h,o as H,al as j,Z as x,a9 as E,aa as I,$ as m,f as p,E as U,ad as V,_ as F,u as oe,ac as T,F as ie,ae as se}from"./vue-71d1abb3.js";const de=["id"],ue={class:"top-content"},ce={class:"main-content"},re={style:{"overflow-y":"scroll",height:"100%","max-height":"100%"}},pe={class:"footer-container"},fe=Z({__name:"UploadDialog",props:{visible:Boolean,title:String,value:{type:Array,default:[]},tweight:{type:Number,default:500},width:{type:Number,default:700},height:{type:Number,default:500},tdata:{type:Array},maxCount:{type:Number,default:10},maxSize:{type:Number,default:104857600},application:{type:String,default:""},module:{type:String,default:""},bizId:{type:String,default:""},fileKindId:{type:String,default:""},tmessage:{type:String,default:""},format:{type:String,default:"png,jpg,jpeg,bmp,wps,pdf,txt,doc,docx,xls,xlsx,ppt,pptx,zip,rar,mp3,mp4"}},emits:["update:visible","update:value","change","cancel","confirm","close"],setup(y,{emit:o}){const e=y,d=s(!1),a=s([]),u=s(!1),g="upload-button-"+(Math.random()*1e4).toFixed(0),b=s(),c=s(W()),f=G(()=>{let n=!1;try{a.value.forEach(t=>{t.id||(n=!0)})}catch(t){}return!n}),z=()=>{o("cancel")},D=()=>{o("confirm",[])},N=()=>{o("close",[])},L=n=>{d.value=n,o("update:visible",n)},_=(n,t="")=>r(this,null,function*(){if(typeof n=="undefined"||n==null||n=="")return[];const i=yield R({bizId:n,fileKindId:t});return typeof i=="string"?JSON.parse(i):i}),$=n=>r(this,null,function*(){return yield new Promise((l,k)=>{le.confirm({title:"确认操作",content:"请确认是否删除此附件？",onOk:()=>r(this,null,function*(){try{let w=a.value.indexOf(n);if(a.value.splice(w,1),Reflect.has(n,"id"))yield X(n.id),o("change",a.value),o("update:value",a.value);else{const q=".dialog-content > .main-content .ant-upload-list",A=`.dialog-content > .main-content .ant-upload-list .ant-upload-list-text-container:nth-child(${++w})`,O=document.querySelector(q),Q=document.querySelector(A);O.removeChild(Q)}}catch(w){}l(!0)}),onCancel(){o("update:value",a.value),o("change",a.value),k(!1)}})})}),B=n=>{if(a.value.length+1>e.maxCount)return v.getInstance().warning("超过文件上传数量限制，最大上传文件数："+e.maxCount),!1;if(n.size>e.maxSize)return v.getInstance().warning(`文件大小超过最大限度${Math.floor(e.maxSize/1048576)}MB`),!1;if(n.size===0)return v.getInstance().warning("不能上传空文件或目录，请重新选择"),!1;for(let l=0;l<a.value.length;l++)if(a.value[l].name===n.name)return v.getInstance().warning("不允许上传重复文件"),!1;const t=n.name.slice(n.name.lastIndexOf(".")+1).toLowerCase();return`,${e.format},`.includes(`,${t},`)?(a.value=[...a.value,n],!1):(v.getInstance().warning(`不支持${t}类型的文件上传`),!1)},K=()=>{var i;let n=!1;const t=new FormData;if(t.append("application",e.application),t.append("module",e.module),t.append("bizId",e.bizId),t.append("fileKindId",e.fileKindId),!e.bizId)return v.getInstance().warning("bizId不能为空"),!1;if((i=a==null?void 0:a.value)==null||i.forEach(l=>{l.id||(t.append("files[]",l),n=!0)}),!n)return v.getInstance().error("请选择文件后再进行上传操作！");u.value=!0,Y(t).then(()=>r(this,null,function*(){u.value=!1,a.value=yield _(e.bizId,e.fileKindId),o("update:value",a.value),o("change",a.value),v.getInstance().success("操作成功")})).catch(()=>{u.value=!1,v.getInstance().error("操作失败")})},S=()=>{try{document.querySelector("#"+g+".upload-button").click()}catch(n){console.error(n)}},M=()=>{d.value=!1,o("update:visible",!1),ee()};return h(()=>e.visible,(n,t)=>r(this,null,function*(){d.value=n,n!=t&&n==!0&&(e.value!=null&&e.value.length>0?a.value=e.value:a.value=yield _(e.bizId,e.fileKindId))})),h(()=>e.tdata,()=>{}),h(()=>e.bizId,()=>r(this,null,function*(){e.bizId&&e.fileKindId&&(a.value=yield _(e.bizId,e.fileKindId))})),H(()=>{d.value=e.visible}),(n,t)=>{const i=j("a-alert"),l=j("a-button"),k=j("a-upload");return x(),E(ae,{title:y.title,tweight:e.tweight,visible:d.value,"onUpdate:visible":L,width:e.width,height:e.height,onCancel:z,onConfirm:D,onClose:N},{footer:I(()=>[m("div",pe,[p(l,{onClick:S},{default:I(()=>[p(C,{icon:"ant-design:select-outlined"}),U(" 选择文件 ")]),_:1}),p(l,{type:"primary",disabled:f.value,loading:u.value,style:{"margin-top":"16px"},onClick:K},{default:I(()=>[p(C,{icon:"material-symbols-light:upload"}),U(" "+V(u.value?"上传中...":"开始上传"),1)]),_:1},8,["disabled","loading"]),p(l,{onClick:M},{default:I(()=>[p(C,{icon:"carbon:close-outline"}),U(" 关闭 ")]),_:1})])]),default:I(()=>[m("div",{id:c.value,class:"dialog-content"},[m("div",ue,[p(i,{message:"温馨提示",description:e.tmessage,type:"info",style:{color:"#1890FF"}},null,8,["description"])]),m("div",ce,[m("div",re,[p(k,{ref_key:"antUpload",ref:b,"file-list":a.value,multiple:!0,"before-upload":B,onRemove:$},{default:I(()=>[p(l,{id:g,class:"upload-button",style:{display:"none"}})]),_:1},8,["file-list"])])])],8,de)]),_:1},8,["title","tweight","visible","width","height"])}}});const ve=J(fe,[["__scopeId","data-v-aaa2116a"]]),me={class:"upload-box"},ge={key:1,class:"ant-upload-list ant-upload-list-text"},be={class:"ant-upload-list-item-info"},he={class:"ant-upload-span"},ye={role:"img","aria-label":"paper-clip",class:"anticon anticon-paper-clip"},_e=["size","title","href"],xe=Z({__name:"UploadBox",props:{vmode:{type:String,default:"edit"},title:{type:String,default:"上传附件"},tname:{type:String,default:"上传附件"},disabled:{type:Boolean,default:!1},width:{type:[Number],default:800},height:{type:[Number],default:600},twidth:{type:[Boolean,Number],default:!0},type:{type:String,default:""},value:{type:[String,Array],default:null},maxCount:{type:[Number],default:10},maxSize:{type:[Number],default:104857600},application:{type:String,default:""},module:{type:String,default:""},bizId:{type:[String,Function,Object],default:"-1"},fileKindId:{type:String,default:""},format:{type:String,default:"png,jpg,jpeg,bmp,wps,pdf,txt,doc,docx,xls,xlsx,ppt,pptx,zip,rar,mp3,mp4"},multiple:{type:[String,Boolean],default:!1},callback:{type:Function,default:null},tfields:{type:Object,default:{label:"label",value:"value"}},btnSize:{type:String,default:""}},emits:["update:value","change","cancel","confirm","loaded"],setup(y,{emit:o}){const e=y,d=s(!1),a=s([]),u=s(""),g=s(!1),b=s(0),c=s(""),f=s(""),z=s(""),D=s(!1),N=G(()=>g.value||D.value),_=P(()=>r(this,null,function*(){new Date().getTime()-b.value>1e3&&(a.value=yield n(u.value,e.fileKindId),o("update:value",a.value),o("change",a.value),b.value=new Date().getTime())}),150),$=()=>{d.value=!0},B=()=>{d.value=!1,o("cancel",!1),e.callback!=null&&e.callback(a.value)},K=()=>{d.value=!1,o("confirm",!1),e.callback!=null&&e.callback(a.value)},S=()=>{try{if(typeof e.bizId=="string")return e.bizId||"-1";if(typeof e.bizId=="function")return e.bizId();if(typeof e.bizId=="object")return e.bizId[e.tfields.value]}catch(t){return e.bizId}},M=()=>r(this,null,function*(){const t=S();u.value=t,_(),setTimeout(()=>{e.callback!=null&&e.callback(a.value)},300)}),n=(t,i="")=>r(this,null,function*(){return yield new Promise(w=>{P(()=>{(typeof t=="undefined"||t==null||t==""||t=="-1")&&w([]),R({bizId:t,fileKindId:i}).then(O=>{w(O)})},1e3)()})});return h(()=>e.bizId,()=>r(this,null,function*(){const t=S();u.value=t,t=="-1"||t==""||_()})),h(()=>e.value,()=>{}),h(()=>e.fileKindId,t=>{z.value=t}),h(()=>e.disabled,()=>{g.value=e.disabled}),h(()=>e.format,t=>{c.value=t,f.value=`文件只能上传${t}类型文件！`}),H(()=>r(this,null,function*(){try{const t=S();u.value=t,t=="-1"||t==""||_(),g.value=e.disabled,c.value=e.format,f.value=`文件只能上传${e.format}类型文件！`,z.value=e.fileKindId,e.callback!=null&&e.callback(a.value),setTimeout(()=>{o("loaded",a.value)},300)}catch(t){console.error(t)}})),(t,i)=>(x(),F("div",me,[e.vmode=="edit"||e.vmode=="box"?(x(),E(oe(ne),{key:0,onClick:$,disabled:N.value,style:{margin:"0 10px 0 0"},size:y.btnSize},{default:I(()=>[p(C,{icon:"material-symbols-light:upload"}),U(" "+V(e.tname),1)]),_:1},8,["disabled","size"])):T("",!0),e.vmode!="edit"||e.vmode=="box"||e.vmode=="view"?(x(),F("div",ge,[(x(!0),F(ie,null,se(a.value,l=>(x(),F("div",{key:`${l.id}`,class:"ant-upload-list-item"},[m("div",be,[m("span",he,[m("span",ye,[p(C,{icon:"ph:file-light"})]),m("a",{target:"_blank",class:"ant-upload-list-item-name",size:l==null?void 0:l.size,title:l==null?void 0:l.name,href:te(l==null?void 0:l.url,l==null?void 0:l.name)},V(l==null?void 0:l.name),9,_e)])])]))),128))])):T("",!0),e.vmode=="edit"||e.vmode=="box"?(x(),E(ve,{key:2,visible:d.value,"onUpdate:visible":i[0]||(i[0]=l=>d.value=l),value:a.value,"onUpdate:value":i[1]||(i[1]=l=>a.value=l),title:e.title,width:e.width,height:e.height,maxCount:e.maxCount,maxSize:e.maxSize,application:e.application,module:e.module,format:c.value,bizId:u.value,fileKindId:z.value,tmessage:f.value,onChange:M,onCancel:B,onConfirm:K},null,8,["visible","value","title","width","height","maxCount","maxSize","application","module","format","bizId","fileKindId","tmessage"])):T("",!0)]))}});const Ce=J(xe,[["__scopeId","data-v-61c1355c"]]);export{Ce as U};
//# sourceMappingURL=UploadBox-636ecf02.js.map
