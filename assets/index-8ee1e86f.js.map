{"version":3,"file":"index-8ee1e86f.js","sources":["../../src/views/oa/info/information/index.ts","../../src/views/oa/info/information/index.vue"],"sourcesContent":["import { BasicColumn, FormSchema } from '@/components/Table';\nimport { defHttp } from '@/utils/http/axios';\n\nenum Api {\n  getPage = '/oa/information/page',\n  getData = '/oa/information/get',\n  deleteData = '/oa/information/delete?id=',\n  updateStatus = '/oa/information/update',\n  saveSort = '/oa/information/saveSort',\n  exportData = '/oa/information/export-excel',\n}\n// 查询列表\nexport function getPage(params) {\n  return defHttp.get({ url: Api.getPage, params });\n}\n//查询详情\nexport function getData(params) {\n  return defHttp.get({ url: Api.getData, params });\n}\nexport function saveSort(params) {\n  return defHttp.put({ url: Api.saveSort, params });\n}\nexport function updateStatus(params) {\n  return defHttp.put({ url: Api.updateStatus, params });\n}\nexport function deleteData(id) {\n  return defHttp.delete({ url: Api.deleteData+id });\n}\n// 导出\nexport function exportData(params) {\n  return defHttp.download({ url: Api.exportData, params }, { isReturnNativeResponse: true });\n}\nexport const columns: BasicColumn[] = [\n  { title: '主题', dataIndex: 'subject',align: 'left',headAlign:'center', width: 120,sorter: true,resizable: true },\n  { title: '信息来源', dataIndex: 'sourceText', width: 120,sorter: true,resizable: true },\n  { title: '信息类别', dataIndex: 'typeText', width: 120,sorter: true,resizable: true },\n  { title: '发布人', dataIndex: 'publisher',align: 'left',headAlign:'center', width: 120,sorter: true,resizable: true },\n  { title: '发布日期', dataIndex: 'publishedDate', width: 120,sorter: true,resizable: true },\n  { title: '排序号', dataIndex: 'sort', width: 80,align: 'right',headAlign:'center',sorter: true,resizable: true },\n  { title: '状态', dataIndex: 'statusText', width: 120,sorter: true,resizable: true },\n  { title: '备注', dataIndex: 'remark', width: 120,align: 'left',headAlign:'center',sorter: true,resizable: true },\n];\nexport const searchFormSchema: FormSchema[] = [\n  { label: '主题', field: 'subject', component: 'Input', colProps: { span: 8 } },\n  {\n    label: '信息类型',\n    field: 'type',\n    component: 'DictSelectBox',\n    componentProps: {\n      type: 'information_type',\n    },\n    colProps: { span: 8 },\n  },\n  {\n    field: '[startPublishedDate, endPublishedDate]',\n    label: '发布时间',\n    component: 'RangePicker',\n    colProps: { span: 8 },\n    componentProps: {\n      format: 'YYYY-MM-DD',\n      valueFormat: 'YYYY-MM-DD',\n      placeholder: ['开始日期', '结束日期'],\n    },\n  },\n  { \n    label: '状态', \n    field: 'status', \n    component: 'DictSelectBox', \n    colProps: { span: 8 },  \n    componentProps: {\n      type: 'enable_or_disable',\n    }, \n  }\n];\n","<template>\n<PageWrapper dense contentFullHeight fixedHeight  contentClass=\"flex\" style=\"position: relative\">\n    <BasicTable @register=\"registerTable\"  \n    @resize-column=\"(w, col) => (col.width = w)\"\n    @selection-change=\"handleSelectChange\"\n    @row-dbClick=\"dbClick\">\n      <template #toolbar>\n        <a-button type=\"primary\" :preIcon=\"IconEnum.ADD\" @click=\"handleCreate\">\n          {{ '添加' }}\n        </a-button>\n        <a-button type=\"primary\" :disabled=\"selectedRowId == ''\" :preIcon=\"IconEnum.EDIT\" @click=\"handleEdit\">\n          {{ '修改' }}\n        </a-button>\n        <a-button  class=\"red-btn\" :disabled=\"selectedRowId == ''\" :preIcon=\"IconEnum.DELETE\" @click=\"handleDelete\">\n          {{ '删除' }}\n        </a-button>\n\n        <a-button type=\"primary\" :preIcon=\"IconEnum.EDIT\" @click=\"handleSaveSort\">\n          {{ '保存排序号' }}\n        </a-button>\n        <a-button class=\"green-btn\" :disabled=\"selectedRowId == ''\" :preIcon=\"IconEnum.ENABLE\" @click=\"handleEnable\">\n          {{ '启用' }}\n        </a-button>\n        <a-button class=\"grey-btn\" :disabled=\"selectedRowId == ''\" :preIcon=\"IconEnum.DISABLE\" @click=\"handleDisable\">\n          {{ '禁用' }}\n        </a-button>\n      </template>\n      <template #bodyCell=\"{ column, record }\">\n        <template v-if=\"column.dataIndex === 'sort'\">\n          <a-input-number v-model:value=\"record[column.dataIndex]\" style=\"width: 100%;text-align: right;\" :min=\"1\" />\n        </template>\n      </template>\n    </BasicTable>\n</PageWrapper>\n</template>\n\n<script lang=\"ts\" setup>\n  import { PageWrapper } from '/@/components/Page';\n  // import { useI18n } from '@/hooks/web/useI18n';\n  import { useMessage, SysMessage } from '@/hooks/web/useMessage';\n  import { IconEnum } from '@/enums/appEnum';\n  import { BasicTable, useTable,SorterResult } from '@/components/Table';\n  import { MsgManager } from '/@/message/MsgManager';\n  import { ref, onMounted } from 'vue';\n  // import { exportExcelFile } from '@/utils/file/download';\n  import {\n    columns,\n    searchFormSchema,\n    getPage,\n    updateStatus,\n    // exportData,\n    saveSort,\n    deleteData,\n  } from './index';\n  import { addTabPage } from '@/utils/route';\n\n   const { createConfirm } = useMessage();\n   let selectedRowId = ref('');\n  const queryParam:any = ref({\n    status: '',\n    subject: '',\n    infoKindId: '',\n    startFinisheddate: '',\n    endFinisheddate: '',\n    pageNo: 1,\n    pageSize: 10,\n    sortField: 'sort',\n    sortOrder: 'desc'\n  });\n\n  // const { t } = useI18n();\n\n  const [registerTable, { reload, getPaginationRef, getSelectRowKeys,  getDataSource }] =\n    useTable({\n      title: '资讯发布',\n      api: async () => {\n        const paginationRef = getPaginationRef() as any;\n        queryParam.value.pageNo = paginationRef.current;\n        queryParam.value.pageSize = paginationRef.pageSize;\n        let dataObj = await getPage(queryParam.value);\n        return dataObj.result;\n      },\n      columns,\n      rowKey: 'id',\n      bordered: true,\n      showTableSetting: true,\n      formConfig: { \n        labelWidth: 120, \n        schemas: searchFormSchema,\n        showAdvancedButton:true,\n        autoAdvancedLine:1, \n      },\n      sortFn: (sortInfo: SorterResult) => {\n      if (sortInfo.order) {\n        queryParam.value.sortField = sortInfo.field.replace('Text', '');\n        queryParam.value.sortOrder = sortInfo.order.replace('end', '');\n      } else {\n          queryParam.value.sortField = 'sort';\n          queryParam.value.sortOrder = 'desc';\n        }\n    },\n      useSearchForm: true,\n      rowSelection: {\n        type: 'radio',\n        fixed: true,\n        onSelect: onSelect\n      },\n      handleSearchInfoFn(info) {\n        for (const key in info) {\n          queryParam.value[key] = info[key];\n        }\n      },\n    });\n  function onSelect(record, selected) {\n    if (selected) {\n      selectedRowId.value = record.id;\n    } else {\n      selectedRowId.value = '';\n    }\n  }\n  function handleSelectChange({ keys, rows }) {\n    if (rows && rows.length > 0) {\n      const record = rows[0];\n      selectedRowId.value = record.id;\n    } else {\n      selectedRowId.value = '';\n    }\n  }\n  function handleCreate() {\n    addTabPage(`/oa/info/information/create?id=`, '添加资讯');\n  }\n  const handleDisable = () => {\n    let keys = getSelectRowKeys();\n    if (keys.length != 1) {\n      SysMessage.getInstance().info('请选择一行记录操作');\n      return;\n    }\n    updateStatus({ id: keys[0], status: 0 }).then((rsp) => {\n      if (rsp.code == 0) {\n        SysMessage.getInstance().info('禁用成功.');\n        reload();\n      } else {\n        SysMessage.getInstance().error('禁用成功.原因:' + rsp.message);\n      }\n    });\n  };\n\n  const dbClick=(record, index, event)=>{\n    \n    addTabPage(`/oa/info/information/create?id=${record.id}&readonly=1`, '查看资讯详情');\n  }\n\n  const handleEnable = () => {\n    let keys = getSelectRowKeys();\n    if (keys.length != 1) {\n      SysMessage.getInstance().info('请选择一行记录操作');\n      return;\n    }\n    updateStatus({ id: keys[0], status: 1 }).then((rsp) => {\n      if (rsp.code == 0) {\n        SysMessage.getInstance().info('启用成功.');\n        reload();\n      } else {\n        SysMessage.getInstance().error('启用成功.原因:' + rsp.message);\n      }\n    });\n  };\n\n  function handleEdit() {\n    let keys = getSelectRowKeys();\n    if (keys.length != 1) {\n      SysMessage.getInstance().info('请选择一行记录操作');\n      return;\n    }\n    addTabPage(`/oa/info/information/create?id=${keys[0]}`, '修改资讯详情');\n  }\n  const handleDelete = () => {\n    let keys = getSelectRowKeys();\n    if (keys.length != 1) {\n      SysMessage.getInstance().info('请选择一行记录操作');\n      return;\n    }\n    createConfirm({\n      title: '提示',\n      iconType: 'warning',\n      content: '确定要删除选中的记录？',\n      async onOk() {\n        deleteData(keys[0]).then((rsp) => {\n          if (rsp.code == 0) {\n            SysMessage.getInstance().info('删除成功.');\n          } else {\n            SysMessage.getInstance().error('删除失败.原因:' + rsp.message);\n          }\n          reload();\n        });\n      },\n    });\n\n   \n  };\n\n  const handleSaveSort = () => {\n    let rows = getDataSource();\n    if (rows.length == 0) {\n      return;\n    }\n    let obj = {};\n    rows.forEach((e) => {\n      obj[e.id] = e.sort;\n    });\n    saveSort(obj).then((resp) => {\n      console.log(resp);\n      SysMessage.getInstance().info('保存成功');\n    });\n  };\n  onMounted(() => {\n    MsgManager.getInstance().listen('oa-information',  ()=>{\n      reload()\n    });\n  });\n</script>\n"],"names":["getPage","params","defHttp","saveSort","updateStatus","deleteData","id","columns","searchFormSchema","createConfirm","useMessage","selectedRowId","ref","queryParam","registerTable","reload","getPaginationRef","getSelectRowKeys","getDataSource","useTable","__async","paginationRef","sortInfo","onSelect","info","key","record","selected","handleSelectChange","keys","rows","handleCreate","addTabPage","handleDisable","SysMessage","rsp","dbClick","index","event","handleEnable","handleEdit","handleDelete","handleSaveSort","obj","e","resp","onMounted","MsgManager"],"mappings":"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"}