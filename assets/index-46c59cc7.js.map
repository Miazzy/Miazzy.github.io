{"version":3,"file":"index-46c59cc7.js","sources":["../../src/views/bi/safety/disasterwarning/data.ts","../../src/views/bi/safety/disasterwarning/index.vue"],"sourcesContent":["import { BasicColumn } from '/@/components/Table';\nimport { useRender } from '@/components/Table';\n\nexport const columns: BasicColumn[] = [\n  {\n    title: '电站名称',\n    dataIndex: 'locationName',\n    width: 150,\n    headAlign: 'center',\n    align: 'left',\n    resizable: true,\n    sorter: true,\n  },\n  {\n    title: '发布单位',\n    dataIndex: 'sender',\n    width: 150,\n    headAlign: 'center',\n    align: 'left',\n    resizable: true,\n    sorter: true,\n  },\n  {\n    title: '预警级别',\n    dataIndex: 'level',\n    width: 150,\n    headAlign: 'center',\n    align: 'left',\n    resizable: true,\n    sorter: true,\n  },\n  {\n    title: '预警类型',\n    dataIndex: 'typeName',\n    headAlign: 'center',\n    align: 'left',\n    width: 150,\n    resizable: true,\n    sorter: true,\n  },\n  {\n    title: '预警详情',\n    dataIndex: 'text',\n    headAlign: 'center',\n    align: 'left',\n    width: 300,\n    resizable: true,\n    sorter: true,\n  },\n  {\n    title: '发布时间',\n    dataIndex: 'pubTime',\n    width: 150,\n    customRender: ({ text }) => {\n      return useRender.renderDate(text);\n    },\n    resizable: true,\n    sorter: true,\n  },\n  {\n    title: '预警开始时间',\n    dataIndex: 'startTime',\n    width: 150,\n    customRender: ({ text }) => {\n      return useRender.renderDate(text);\n    },\n    resizable: true,\n    sorter: true,\n  },\n  {\n    title: '预警结束时间',\n    dataIndex: 'endTime',\n    width: 150,\n    customRender: ({ text }) => {\n      return useRender.renderDate(text);\n    },\n    resizable: true,\n    sorter: true,\n  },\n];\n","<template>\n  <PageWrapper dense contentFullHeight fixedHeight contentClass=\"flex\" style=\"position: relative\">\n    <div class=\"fix-basic-table\">\n      <div class=\"tab-button-div\">\n        <a-form\n          :model=\"searchInfo\"\n          name=\"searchInfo\"\n          layout=\"inline\"\n          autocomplete=\"off\"\n          class=\"search-form\"\n        >\n          <a-form-item\n            name=\"stationName\"\n            label=\"电站\"\n            :labelCol=\"{ span: 6 }\"\n            :rules=\"[{ required: false, message: '请选择电站' }]\"\n            style=\"width: 26.5%\"\n          >\n            <a-select\n              v-model:value=\"searchInfo.stationName\"\n              show-search\n              allow-clear\n              mode=\"multiple\"\n              style=\"width: 100%\"\n              placeholder=\"请选择电站\"\n              :options=\"stationOptions\"\n              @change=\"handleChange\"\n              labelInValue\n              max-tag-count=\"responsive\"\n            />\n          </a-form-item>\n          <a-form-item\n            name=\"warnLevel\"\n            label=\"预警级别\"\n            :labelCol=\"{ span: 12 }\"\n            :rules=\"[{ required: false, message: '请选择预警级别' }]\"\n            style=\"width: 26.5%\"\n          >\n            <DictSelectBox\n              :type=\"`warnLevel`\"\n              @change=\"`()=> searchInfo.warnLevel = value`\"\n              v-model:value=\"searchInfo.warnLevel\"\n              :width=\"'100%'\"\n            />\n          </a-form-item>\n\n          <a-form-item class=\"search-btns\">\n            <a-button style=\"margin: 0 8px\" @click=\"resetFrom\">重置</a-button>\n            <a-button type=\"primary\" class=\"tab-button\" @click=\"searchList\">查询</a-button>\n          </a-form-item>\n        </a-form>\n      </div>\n      <div class=\"tab-table-div\">\n        <BasicTable @register=\"registerTable\" @resize-column=\"(w, col) => (col.width = w)\">\n          <template #bodyCell=\"{ column, text, record }\">\n            <template v-if=\"column.dataIndex === 'level'\">\n              <span style=\"color: red\" v-if=\"text == '红色'\">红色</span>\n              <span style=\"color: orange\" v-if=\"text == '橙色'\">橙色</span>\n              <span style=\"color: #e9d30e\" v-if=\"text == '黄色'\">黄色</span>\n              <span style=\"color: blue\" v-if=\"text == '蓝色'\">蓝色</span>\n            </template>\n          </template>\n        </BasicTable>\n      </div>\n    </div>\n  </PageWrapper>\n</template>\n\n<script lang=\"ts\" setup>\n  import { BasicTable, useTable, SorterResult } from '@/components/Table';\n  import { columns } from './data';\n  import { onMounted, reactive, ref, unref } from 'vue';\n  import { defHttp } from '/@/utils/http/axios';\n  import { SelectProps } from 'ant-design-vue';\n  import DictSelectBox from '@/components/Framework/Combox/DictSelectBox.vue';\n  import { PageWrapper } from '/@/components/Page';\n  import { useRouter } from 'vue-router';\n\n  const stationOptions = ref<SelectProps['options']>([]) as any;\n\n  enum Api {\n    getDisasterWarningUrl = '/bi/safety/disasterWarning',\n    LIST_STATION_URL = '/bi/common/station/info',\n  }\n\n  const searchInfo = reactive<any>({\n    warnLevel: null,\n    stationId: null,\n    pageNo: 1,\n    pageSize: 10,\n  }); // 查询信息\n\n  const getDisasterWarningData = async () => {\n    let stationNames = [];\n    let stationIdIds = [];\n    if (Array.isArray(searchInfo.stationName)) {\n      searchInfo.stationName.forEach((item) => {\n        if (item.option != undefined) {\n          stationNames.push(item.option.value);\n          stationIdIds.push(item.option.lable);\n        }\n      });\n\n      if (stationNames.length > 0) {\n        let stn = stationNames.join('|');\n        let sti = stationIdIds.join('|');\n        searchInfo.stationId = sti;\n        searchInfo.stationName = stn;\n      } else {\n        let stn = searchInfo.stationName.join('|');\n        let sti = searchInfo.stationId.join('|');\n        searchInfo.stationId = sti;\n        searchInfo.stationName = stn;\n      }\n    }\n\n    let areaList = await getDisasterWarningDataList(searchInfo);\n\n    if (searchInfo.stationId != undefined) {\n      searchInfo.stationId = searchInfo.stationId.split('|');\n      searchInfo.stationName = searchInfo.stationName.split('|');\n    }\n\n    return areaList;\n  };\n\n  const getDisasterWarningDataList = (params) =>\n    defHttp.get(\n      {\n        url: Api.getDisasterWarningUrl,\n        params,\n      },\n      { isOnlyResult: true },\n    );\n\n  const getStation = (params) =>\n    defHttp.get(\n      {\n        url: Api.LIST_STATION_URL,\n        params,\n      },\n      {},\n    );\n\n  function handleChange(value: string, option) {\n    if (value.length == 0) {\n      searchInfo.stationId = undefined;\n      searchInfo.stationName = undefined;\n    }\n  }\n\n  function initStationOptions() {\n    getStation({}).then((res) => {\n      if (res.result && res.result.length > 0) {\n        res.result.forEach((item) => {\n          stationOptions.value.push({ value: item.stationName, lable: item.id });\n        });\n      }\n    });\n  }\n\n  //-----------------跳转相关--------------------\n  const router = useRouter();\n  const { currentRoute } = router;\n  const route = unref(currentRoute);\n  const routeParam = route.query;\n  // const dealJumpParam = async () => {\n  //   // searchInfo.stationId = routeParam.stationId;\n  //   // searchInfo.stationName = routeParam.stationName;\n  //   searchInfo.warnLevel = routeParam.warnLevel;\n  //   reload();\n  // };\n\n  onMounted(async () => {\n    initStationOptions();\n    if (routeParam.warnLevel) {\n      searchInfo.warnLevel = routeParam.warnLevel;\n    }\n    if (routeParam.stationId) {\n      searchInfo.stationId = routeParam.stationId;\n      searchInfo.stationName = routeParam.stationName;\n    }\n  });\n\n  const [registerTable, { reload, getPaginationRef }] = useTable({\n    title: '自然灾害预警',\n    api: async () => {\n      const paginationRef = getPaginationRef() as any;\n      searchInfo.pageNo = paginationRef.current;\n      searchInfo.pageSize = paginationRef.pageSize;\n      let dataObj = await getDisasterWarningData();\n      return dataObj;\n    },\n    columns: columns,\n    useSearchForm: false,\n    bordered: true,\n    pagination: {\n      pageSize: 20,\n    },\n    showIndexColumn: false,\n    showTableSetting: true,\n    tableSetting: { fullScreen: true },\n    sortFn: (sortInfo: SorterResult) => {\n      if (sortInfo.order) {\n        searchInfo.sortField = sortInfo.field;\n        searchInfo.sortOrder = sortInfo.order.replace('end', '');\n      } else {\n        searchInfo.sortField = null;\n        searchInfo.sortOrder = null;\n      }\n    },\n  });\n\n  function resetFrom() {\n    searchInfo.warnLevel = null;\n    searchInfo.stationId = undefined;\n    searchInfo.stationName = undefined;\n    reload();\n  }\n\n  // 查询\n  function searchList() {\n    reload();\n  }\n</script>\n<style lang=\"less\" scoped>\n  .tab-button-div {\n    padding-top: 12px;\n    padding-bottom: 12px;\n\n    :deep(.ant-form-item-label) {\n      width: 120px;\n      max-width: 120px;\n      text-align-last: right;\n    }\n  }\n\n  .tab-table-div {\n    margin-top: 10px;\n  }\n\n  .tab-button {\n    margin-right: 5px;\n\n    &:last-child {\n      margin-right: 0;\n    }\n  }\n\n  .search-form {\n    position: relative;\n\n    .search-btns {\n      position: absolute;\n      right: 0;\n      bottom: 0;\n    }\n  }\n\n  .fix-basic-table {\n    padding: 10px;\n\n    :deep(&.vben-basic-table .ant-table-wrapper) {\n      padding: 10px 16px 12px;\n    }\n\n    :deep(.table-settings .anticon-setting) {\n      margin-right: 0;\n    }\n  }\n</style>\n"],"names":["columns","text","useRender","stationOptions","ref","searchInfo","reactive","getDisasterWarningData","__async","stationNames","stationIdIds","item","stn","sti","areaList","getDisasterWarningDataList","params","defHttp","getStation","handleChange","value","option","initStationOptions","res","router","useRouter","currentRoute","routeParam","unref","onMounted","registerTable","reload","getPaginationRef","useTable","paginationRef","sortInfo","resetFrom","searchList"],"mappings":"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"}