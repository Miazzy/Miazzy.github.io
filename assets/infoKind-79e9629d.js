var T=(n,H,b)=>new Promise(($,q)=>{var G=I=>{try{u(b.next(I))}catch(_){q(_)}},j=I=>{try{u(b.throw(I))}catch(_){q(_)}},u=I=>I.done?$(I.value):Promise.resolve(I.value).then(G,j);u((b=b.apply(n,H)).next())});import{r as A,d as Ze,k as f,ax as Ge,e as fe,o as Je,al as N,Z as h,a9 as Z,aa as l,f as a,$ as ne,u as i,E as R,_ as w,F as me,ac as y,ad as Qe,v as U,A as E}from"./vue-71d1abb3.js";import{D as ge}from"./Dialog-0a006d82.js";import{B as ve}from"./BasicTable-0434a334.js";import{T as Xe}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as he}from"./useTable-109483b3.js";import{a2 as c}from"./antd-15ac76ed.js";import{a5 as g,b6 as Ye,b as et,au as tt,av as z,_ as nt}from"./index.js";import{P as at}from"./index-20519caf.js";import{C as lt}from"./CommonTree-c4ed7838.js";import{x as ae}from"./index-66d20ba6.js";import{_ as ot}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{a as le}from"./assign-37f1c13d.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";function rt(){return[{title:"编码",dataIndex:"code",width:100,resizable:!0,sorter:!0},{title:"大类",dataIndex:"kind",width:100,customRender:({text:n})=>n.split("-")[0],resizable:!0,sorter:!0},{title:"小类",dataIndex:"infoKindTypeName",width:100,resizable:!0,sorter:!0},{title:"名称",dataIndex:"name",width:120,resizable:!0,sorter:!0,headAlign:"center",align:"left"},{title:"是否启用",dataIndex:"status",width:120,resizable:!0,sorter:!0},{title:"排序",dataIndex:"sort",width:120,editRow:!0,resizable:!0,sorter:!0}]}const it=n=>g.get({url:"/oa/infoKind/type/getTree",params:n},{}),st=n=>g.get({url:"/oa/infoKind/type/get",params:n},{}),ut=n=>g.post({url:"/oa/infoKind/type/create",params:n},{}),dt=n=>g.put({url:"/oa/infoKind/type/update",params:n},{}),ct=n=>n.id?dt(n):ut(n),pt=n=>g.delete({url:"/oa/infoKind/type/delete",params:n},{}),ft=n=>g.get({url:"/oa/infoKind/page",params:n},{}),mt=n=>g.get({url:"/oa/infoKind/get",params:n},{}),gt=n=>g.post({url:"/oa/infoKind/create",params:n},{}),vt=n=>g.put({url:"/oa/infoKind/update",params:n},{}),ht=n=>g.post({url:"/oa/infoKind/saveDetail",params:n},{}),yt=n=>n.id?vt(n):gt(n),ye=n=>g.put({url:"/oa/infoKind/updateStatus",params:n},{}),It=n=>g.put({url:"/oa/infoKind/updateBatchSort",params:n},{}),_t=n=>g.delete({url:"/oa/infoKind/delete",params:n},{}),bt=n=>g.post({url:"/oa/infoKind/detailList",params:n},{}),xt=n=>g.delete({url:"/oa/infoKind/deleteDetail",params:n},{}),Tt=n=>g.post({url:"/system/org/list-tree",params:n},{}),s=A({id:"",code:"",name:"",status:"1",infoKindType:"",infoKindTypeName:"",sort:"",isApprove:"",isDefaultRead:"",createTime:"",updateTime:"",creator:"",updater:""}),wt=[{title:"ID",dataIndex:"id",defaultHidden:!0},{title:"组织",dataIndex:"fullName",width:300},{title:"类型",dataIndex:"orgKindId",width:100}],Nt={title:"授权",pagination:!1,striped:!1,useSearchForm:!1,showTableSetting:!1,bordered:!0,showIndexColumn:!0,canResize:!1,actionColumn:{width:80,title:"操作",dataIndex:"action"}},Ct={class:"right-table-layout"},Kt={class:"top-table-layout"},kt={key:0,style:{color:"#19be6b"}},St={key:1,style:{color:"red"}},Dt={class:"bottom-table-layout"},Ft={key:0},Rt={key:1},Ut={key:2},Et={key:3},Ot={key:0,class:"dialog-mask"},zt=Ze({__name:"infoKind",setup(n){Ye();const H=f(),{t:b}=et(),{createConfirm:$}=tt(),q=()=>T(this,null,function*(){const e=yield Tt({orgKindIds:"ogn,dpt,pos,psm",showPosition:!0,status:1});H.value=j(e.result)});function G(e){e.bizId=p.value[0],ht(e).then(t=>{B()})}function j(e){const t=[];for(let m=0;m<e.length;m++){const v=e[m],M={label:v.name,value:v.id,orgKindId:v.orgKindId,fullId:v.fullId,fullName:v.fullName,orgUnitId:v.id,orgUnitName:v.name};v.children&&v.children.length>0&&(M.children=j(v.children)),t.push(M)}return t}const u=A({infoKindType:""}),I=f([]),_=f({typeId:"",fullName:"",id:"",name:"",codePre:"",existChildNode:!1});Ge();const d=A({open:{type:f(!1),index:f(!1)},title:{type:f(""),index:f("")}}),C=f(!1),Ie=f(!1),p=f([]),_e=rt(),r=A({id:"",name:"",fullId:"",codePre:"",infoKindTypeName:"",infoKindType:"",fullName:"",parentId:"",checkItem:"",description:"",parentName:"",parentFullId:"",parentFullName:""});A({id:"",bizId:"",kindId:"",orgKindId:"",orgUnitId:"",orgUnitName:"",fullId:"",fullName:""});const oe=f(),J=f(),Q=f(),K=f([]),be=()=>T(this,null,function*(){let e=yield ft(u);return K.value=e.result,p.value=[],Ce(),B(),K.value}),xe={baseColProps:{span:8},labelWidth:120,showAdvancedButton:!1,schemas:[{label:"是否启用",field:"status",component:"DictSelectBox",componentProps:{type:"yes_or_no"}}]};function Te(){let e=Q.value;e&&e.validateFields().then(()=>{C.value=!0;let t=V(r);s.name=ae.trim(s.name),yt(s).then(()=>{c.success(t+"成功"),Y(),O(),d.open.index=!1,C.value=!1}).catch(()=>{C.value=!1})})}const[we,{reload:O,getPaginationRef:Ne,clearSelectedRowKeys:Ce}]=he({title:"信息",api:()=>T(this,null,function*(){const e=Ne();return u.pageNo=e.current,u.pageSize=e.pageSize,yield be()}),columns:_e,useSearchForm:!0,showIndexColumn:!1,formConfig:xe,showTableSetting:!0,pagination:!0,canResize:!0,bordered:!0,rowKey:"id",rowSelection:{type:"radio",onChange:Ke},handleSearchInfoFn(e){return u.status=e.status,e},sortFn:e=>{e.order?(u.sortField=e.field,u.sortOrder=e.order.replace("end","")):(u.sortField=null,u.sortOrder=null)}});function Ke(e,t){t.length>0?p.value=[e[0]]:p.value=[],B()}function re(){return T(this,null,function*(){const e=yield it({code:"checkIndexType"});I.value=e.result})}function ke(e){if(r.id="",r.codePre="",r.parentId="root",r.fullId="",r.parentName="",r.parentFullName="",r.name="",e&&(r.parentId=e.id,r.codePre=e.codePre,r.parentName=e.name,r.fullId=e.fullId,r.parentFullName=e.fullName,e.fullId&&e.fullId.split("/").length>4)){c.error("最多允许新增4个层级");return}const t=V(r);se(e,t)&&(d.open.type=!0,d.title.type=t+"信息类型")}function ie(e){return e?!0:(c.error("请选择信息类型节点"),!1)}function Se(e){if(!ie(e))return;const t=V({id:e.id});if(e.parentId==="root"){c.error(`父节点，不能${t}`);return}if(e.children.length>0){c.error(`该信息类型存在子节点，不能${t}`);return}se(e,t)&&(st({id:e.id}).then(m=>{le(r,m.result)}),d.open.type=!0,d.title.type=t+"信息类型")}function se(e,t){return e&&e.children.length==0&&e.fullId&&K.value&&K.value.list.length>0?(c.error("该信息分类存在信息，不能"+t),!1):!0}function De(e){if(ie(e)){if(e.children.length>0)return c.error("该信息类型存在子节点，不能删除"),!1;if(K.value.list.length>0)return c.error("该信息类型信息数据，不能删除"),!1;ue(function(){pt("?id="+e.id).then(()=>{X()})})}}function ue(e){$({title:b("common.message.confirmTitle"),iconType:"warning",content:b("common.message.delMessage"),onOk(){return T(this,null,function*(){yield e(),c.success(b("common.delSuccessText"))})}})}function X(){re()}function Fe(){let e=J.value;e&&e.validateFields().then(()=>{C.value=!0,r.fullName=Re();let t=V(r);ct(r).then(()=>{c.success(t+"成功"),Y(),X(),d.open.type=!1,C.value=!1}).catch(()=>{C.value=!1})})}function V(e){return e.id?"修改":"添加"}function Re(){let e=r.parentFullName;return e?e+"-"+ae.trim(r.name):ae.trim(r.name)}function de(){Y(),d.open.type=!1,d.open.index=!1}function Y(){var e,t;(e=J.value)==null||e.resetFields(),(t=Q.value)==null||t.resetFields()}function Ue(e){u.typeFullId=null,u.infoKindType=null,u.infoKindTypeName=null,e&&(u.typeFullId=e.fullId,u.infoKindType=e.id,u.infoKindTypeName=e.name,_.value={typeId:e.id,fullName:e.fullName,id:e.id,name:e.name,codePre:e.codePre,existChildNode:e.children!=null&&e.children.length>0}),O()}function Ee(){const e=oe.value.getSelectedTreeNode();if(!e){c.error("请选择信息类型");return}if(e.children.length>0){c.error("请选择信息类型的末级节点");return}r.infoKindTypeName=_.value.name,r.infoKindType=_.value.id,s.id=null,s.code=_.value.codePre,s.name=null,s.sort=K.value.list.length+1,s.infoKindType=_.value.id,s.infoKindTypeName=_.value.name,d.open.index=!0,d.title.index="添加信息类型"}function P(){return console.log("checkedKeys",p),p.value.length==0||p.value.length>1||!p.value[0]?(c.error("请选择一行数据"),!1):!0}function Oe(){P()&&mt({id:p.value[0]}).then(e=>{le(s,e.result),d.open.index=!0,d.title.index="修改信息类型"})}function ze(){P()&&$({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return T(this,null,function*(){_t("?id="+p.value[0]).then(()=>{c.success("已删除"),delete p.value[0],O(),B()})})}})}function Pe(){if(!P())return;const e="?id="+p.value[0]+"&status=1";ye(e).then(()=>{c.success("已启用"),O()})}function Be(){if(!P())return;const e="?id="+p.value[0]+"&status=0";ye(e).then(()=>{c.success("已禁用"),O()})}function Le(){const e=f([]);K.value.list.forEach(t=>{if(!t.sort)throw c.error("排序不能为空"),Error("排序不能为空");e.value.push({id:t.id,sort:t.sort})}),It(e.value).then(()=>{c.success("保存排序成功"),O()})}const ee=f(window.innerHeight),Ae=fe(()=>{const e=ee.value/2-145;return e>0?e:90}),He=fe(()=>{const e=ee.value/2-207;return e>0?e:90});Je(()=>{re(),q(),window.addEventListener("resize",()=>{ee.value=window.innerHeight})});const te=f(),[$e,{getDataSource:ce}]=he(le({dataSource:te,columns:wt},Nt)),B=()=>T(this,null,function*(){if(p.value.length==0||p.value.length>1||!p.value[0])return te.value=[],!1;te.value=yield qe({bizId:p.value[0]})}),qe=e=>T(this,null,function*(){return(yield bt(e)).result});function je(){if(!P())return;Ve({})}function Ve(e){ce().push(Me(e))}function Me(e){return e.editable=!0,e.isNew=!0,e.key=`${Date.now()}`,e}function We(e){ue(function(){const t=ce();let m=t.indexOf(e);m!==-1&&t.splice(m,1),xt("?id="+e.id).then(()=>{B()})})}return(e,t)=>{const m=N("a-button"),v=N("a-input-number"),M=N("a-tree-select"),L=N("a-input"),k=N("a-form-item"),S=N("a-col"),D=N("a-row"),pe=N("a-form");return h(),Z(i(at),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:l(()=>[a(lt,{ref_key:"treeRef",ref:oe,title:"信息分类",style:{"font-size":"1px"},onSelect:Ue,value:I.value,class:"left-tree-layout",toolbar:!0,isShowOperationBtns:!0,fieldNames:{key:"id",title:"name"},onAdd:ke,onEdit:Se,onDelete:De,onRefresh:X},null,8,["value"]),ne("div",Ct,[ne("div",Kt,[a(i(ve),{class:"fix-basic-table",onRegister:i(we),searchInfo:u,scroll:{y:Ae.value},onResizeColumn:t[0]||(t[0]=(o,x)=>x.width=o)},{toolbar:l(()=>[a(m,{type:"primary",preIcon:i(z).ADD,onClick:Ee},{default:l(()=>[R("添加")]),_:1},8,["preIcon"]),a(m,{type:"primary",preIcon:i(z).EDIT,onClick:Oe},{default:l(()=>[R("修改")]),_:1},8,["preIcon"]),a(m,{class:"red-btn",preIcon:i(z).DELETE,onClick:ze},{default:l(()=>[R("删除")]),_:1},8,["preIcon"]),a(m,{type:"primary",onClick:Le},{default:l(()=>[R("保存排序")]),_:1}),a(m,{class:"green-btn",preIcon:i(z).ENABLE,onClick:Pe},{default:l(()=>[R("启用")]),_:1},8,["preIcon"]),a(m,{class:"grey-btn",preIcon:i(z).DISABLE,onClick:Be},{default:l(()=>[R("禁用")]),_:1},8,["preIcon"])]),bodyCell:l(({column:o,text:x,record:F})=>[o.dataIndex==="status"?(h(),w(me,{key:0},[x==1?(h(),w("span",kt,"启用")):y("",!0),x==0?(h(),w("span",St,"禁用")):y("",!0)],64)):y("",!0),o.dataIndex==="sort"?(h(),Z(v,{key:1,value:F[o.dataIndex],"onUpdate:value":W=>F[o.dataIndex]=W,min:1,max:1e4,step:1,precision:0,status:"error"},null,8,["value","onUpdate:value"])):y("",!0)]),_:1},8,["onRegister","searchInfo","scroll"])]),ne("div",Dt,[a(i(ve),{class:"fix-basic-table",onRegister:i($e),scroll:{y:He.value}},{toolbar:l(()=>[a(m,{type:"primary",preIcon:i(z).ADD,onClick:t[1]||(t[1]=o=>je())},{default:l(()=>[R(Qe(i(b)("common.action.create")),1)]),_:1},8,["preIcon"])]),bodyCell:l(({column:o,text:x,record:F})=>[o.dataIndex==="fullName"?(h(),Z(M,{key:0,value:F[o.dataIndex],"onUpdate:value":W=>F[o.dataIndex]=W,"show-search":"",style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},"allow-clear":"","tree-default-expand-all":"","tree-data":H.value,"tree-node-filter-prop":"label",onChange:W=>G(F)},null,8,["value","onUpdate:value","tree-data","onChange"])):y("",!0),o.dataIndex==="orgKindId"?(h(),w(me,{key:1},[x=="ogn"?(h(),w("span",Ft,"机构")):y("",!0),x=="dpt"?(h(),w("span",Rt,"部门")):y("",!0),x=="psm"?(h(),w("span",Ut,"人员")):y("",!0),x=="pos"?(h(),w("span",Et,"岗位")):y("",!0)],64)):y("",!0),o.dataIndex==="action"?(h(),Z(i(Xe),{key:2,actions:[{tooltip:"删除",color:"error",icon:"ant-design:delete-outlined",ifShow:!0,onClick:We.bind(null,F)}]},null,8,["actions"])):y("",!0)]),_:1},8,["onRegister","scroll"])])]),a(ge,{visible:d.open.type,"onUpdate:visible":t[4]||(t[4]=o=>d.open.type=o),title:d.title.type,onOk:Fe,onCancel:de,height:250,width:600},{default:l(()=>[a(pe,{ref_key:"modalFormRef",ref:J,model:r,name:"userForm"},{default:l(()=>[a(D,{gutter:24},{default:l(()=>[U(a(S,{span:22},{default:l(()=>[a(k,{label:"所属类型",name:"parentName",labelCol:{span:5}},{default:l(()=>[a(L,{value:r.parentName,"onUpdate:value":t[2]||(t[2]=o=>r.parentName=o),disabled:!0},null,8,["value"])]),_:1})]),_:1},512),[[E,!0]])]),_:1}),a(D,{gutter:24},{default:l(()=>[U(a(S,{span:22},{default:l(()=>[a(k,{label:"信息类型",name:"name",labelCol:{span:5},rules:[{required:!0,max:30}]},{default:l(()=>[a(L,{value:r.name,"onUpdate:value":t[3]||(t[3]=o=>r.name=o),maxlength:30,disabled:Ie.value},null,8,["value","disabled"])]),_:1})]),_:1},512),[[E,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),a(ge,{visible:d.open.index,"onUpdate:visible":t[11]||(t[11]=o=>d.open.index=o),title:d.title.index,onOk:Te,onCancel:de,height:450,width:800},{default:l(()=>[a(pe,{ref_key:"modalIndexFormRef",ref:Q,model:i(s),name:"userIndexForm"},{default:l(()=>[a(D,{gutter:24},{default:l(()=>[U(a(S,{span:22},{default:l(()=>[a(k,{label:"上级类型",name:"infoKindTypeName",labelCol:{span:5},rules:[{required:!1}]},{default:l(()=>[a(L,{value:i(s).infoKindTypeName,"onUpdate:value":t[5]||(t[5]=o=>i(s).infoKindTypeName=o),disabled:"",style:{color:"#0e7fe9"}},null,8,["value"])]),_:1})]),_:1},512),[[E,!0]])]),_:1}),a(D,{gutter:24},{default:l(()=>[U(a(S,{span:22},{default:l(()=>[a(k,{label:"编码",name:"code",labelCol:{span:5},rules:[{required:!1}]},{default:l(()=>[a(L,{value:i(s).code,"onUpdate:value":t[6]||(t[6]=o=>i(s).code=o),min:1,max:1e5,disabled:""},null,8,["value"])]),_:1})]),_:1},512),[[E,!0]])]),_:1}),a(D,{gutter:24},{default:l(()=>[U(a(S,{span:22},{default:l(()=>[a(k,{label:"名称",name:"name",labelCol:{span:5},rules:[{required:!0,message:"请填写名称"}]},{default:l(()=>[a(L,{value:i(s).name,"onUpdate:value":t[7]||(t[7]=o=>i(s).name=o),min:1,max:1e5},null,8,["value"])]),_:1})]),_:1},512),[[E,!0]])]),_:1}),a(D,{gutter:24},{default:l(()=>[U(a(S,{span:22},{default:l(()=>[a(k,{name:"status",label:" 是否启用",labelCol:{span:5},rules:[{required:!0,message:"请选择是否启用"}]},{default:l(()=>[a(ot,{type:"yes_or_no",onChange:t[8]||(t[8]=o=>"()=> formIndexState.status = value"),value:i(s).status,"onUpdate:value":t[9]||(t[9]=o=>i(s).status=o)},null,8,["value"])]),_:1})]),_:1},512),[[E,!0]])]),_:1}),a(D,{gutter:24},{default:l(()=>[U(a(S,{span:22},{default:l(()=>[a(k,{label:"排序",name:"sort",labelCol:{span:5},rules:[{required:!0,message:"请填写排序"}]},{default:l(()=>[a(v,{value:i(s).sort,"onUpdate:value":t[10]||(t[10]=o=>i(s).sort=o)},null,8,["value"])]),_:1})]),_:1},512),[[E,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),C.value?(h(),w("div",Ot)):y("",!0)]),_:1})}}});const fn=nt(zt,[["__scopeId","data-v-79500f0f"]]);export{fn as default};
//# sourceMappingURL=infoKind-79e9629d.js.map
