var u=(E,f,l)=>new Promise((i,v)=>{var a=s=>{try{p(l.next(s))}catch(g){v(g)}},h=s=>{try{p(l.throw(s))}catch(g){v(g)}},p=s=>s.done?i(s.value):Promise.resolve(s.value).then(a,h);p((l=l.apply(E,f)).next())});import{aj as H,b as W,au as K,a7 as X,av as x,ax as P,bT as O,at as k,az as Z,aA as J,_ as Q}from"./index.js";import{P as Y}from"./index-20519caf.js";import{B as ee}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as te}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{d as ae,ax as oe,k as F,o as se,al as ne,Z as C,a9 as b,aa as d,f as I,$ as re,u as n,E as R,ad as T,ac as S,_ as ce}from"./vue-71d1abb3.js";import{s as le,a as ie}from"./stationTree-56a32762.js";import{e as pe}from"./download-03e71dd5.js";import{C as m,g as ue,s as de,a as me,e as fe}from"./safecheckexecution-9a1cbf60.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./CommonTree-c4ed7838.js";import"./index-3801a970.js";import"./useRender-21ce56fb.js";const he={class:"right-table-layout"},ge=["onClick"],ye=ae({name:"SafecheckExecution",__name:"index",setup(E){const f=oe(),{currentRoute:l}=f;let i=F(""),{params:v}=H();const a=F({status:"",safetyCheckType:v.checkType,subject:"",billCode:"",pageNo:1,pageSize:10,sortField:"fillinDate",sortOrder:"desc"}),{t:h}=W(),{createConfirm:p,createMessage:s}=K(),g=e=>{P("/po/danger/index?dtlIds="+e)};function N(e){ie(e,a,null,_)}const w=()=>{const e=l.value.path,t=O(e);a.value.safetyCheckType=t.checkType};w();function A(){const e=l.value.path,t=O(e);return me(t.checkType)}const[B,{getForm:D,reload:_,getPaginationRef:L,getSelectRows:M}]=te({title:a.value.safetyCheckType==m.REGULAR?"定期检查":"专项检查",api:()=>u(this,null,function*(){const e=L();return a.value.pageNo=e.current,a.value.pageSize=e.pageSize,(yield ue(a.value)).result}),columns:A(),rowKey:"id",bordered:!0,formConfig:{labelWidth:120,schemas:de,showAdvancedButton:!1},useSearchForm:!0,showTableSetting:!0,rowSelection:{type:"radio",fixed:!0,onSelect:U},sortFn:e=>{e.order?(a.value.sortField=e.field.replace("Text",""),a.value.sortOrder=e.order.replace("end","")):(a.value.sortField="fillinDate",a.value.sortOrder="desc")},handleSearchInfoFn(e){for(const t in e)a.value[t]=e[t]}});function U(e,t){t?i.value=e.id:i.value=""}function j({keys:e,rows:t}){if(t&&t.length>0){const o=t[0];i.value=o.id}else i.value=""}const z=(e,t,o)=>{V(e)};function G(){if(!a.value.stationId){k.getInstance().info("请选中电站添加");return}const{currentRoute:e}=f,o=e.value.path.split("/"),r=o[o.length-1];let c=a.value.safetyCheckType==m.REGULAR?"添加定期检查":"添加专项检查";P(`/po/safety/safecheckexecution/create/${r}?id=`,c,{stationId:a.value.stationId,stationName:a.value.stationName,safetyCheckType:a.value.safetyCheckType,stationOrganId:a.value.stationOrganId,stationOrganName:a.value.stationOrganName})}function V(e){const{currentRoute:t}=f,r=t.value.path.split("/");r[r.length-1];let c="",y="";e.safetyCheckType==m.REGULAR?y=c+"定期检查":y=c+"专项检查",Z(e.id,y)}const $=()=>u(this,null,function*(){let e=M();if(e.length!=1){k.getInstance().success("请选择一行数据");return}let t=e[0];p({title:"提示",iconType:"warning",content:"确定要删除选中的记录？",onOk(){return u(this,null,function*(){if(t.status!=0){k.getInstance().success("非草稿状态不能删除");return}yield J(t.processInstanceId),k.getInstance().success("删除成功"),_()})}})});function q(){return u(this,null,function*(){p({title:h("common.exportTitle"),iconType:"warning",content:h("common.exportMessage"),onOk(){return u(this,null,function*(){let t=D().getFieldsValue();Object.assign(t,a.value),yield fe(t).then(o=>{pe(o==null?void 0:o.data,(a.value.safetyCheckType==m.SPECIAL?"专项":"定期")+"检查.xls")}),s.success(h("common.exportSuccessText"))})}})})}return se(()=>{w(),X.getInstance().listen("safe-check-execution",()=>{_()})}),(e,t)=>{const o=ne("a-button");return C(),b(n(Y),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:d(()=>[I(le,{onSelectTree:N}),re("div",he,[I(n(ee),{onRegister:n(B),onSelectionChange:j,class:"fix-basic-table",onResizeColumn:t[0]||(t[0]=(r,c)=>c.width=r),onRowDbClick:z},{toolbar:d(()=>[a.value.safetyCheckType==n(m).REGULAR?(C(),b(o,{key:0,type:"primary",preIcon:n(x).ADD,onClick:G},{default:d(()=>[R(T("添加"))]),_:1},8,["preIcon"])):S("",!0),a.value.safetyCheckType==n(m).REGULAR?(C(),b(o,{key:1,class:"red-btn",disabled:n(i)=="",preIcon:n(x).DELETE,onClick:$},{default:d(()=>[R(T("删除"))]),_:1},8,["disabled","preIcon"])):S("",!0),I(o,{class:"yellow-btn",preIcon:n(x).EXPORT,onClick:q},{default:d(()=>[R(T("导出"))]),_:1},8,["preIcon"])]),bodyCell:d(({column:r,text:c,record:y})=>[r.dataIndex==="rectification"?(C(),ce("a",{key:0,onClick:ve=>g(`${y.dtlIds}`),target:"_blank"},T(c),9,ge)):S("",!0)]),_:1},8,["onRegister"])])]),_:1})}}});const Xe=Q(ye,[["__scopeId","data-v-b3448f89"]]);export{Xe as default};
//# sourceMappingURL=index-dbdfd3e3.js.map
