var d=(y,p,e)=>new Promise((f,o)=>{var n=u=>{try{i(e.next(u))}catch(r){o(r)}},l=u=>{try{i(e.throw(u))}catch(r){o(r)}},i=u=>u.done?f(u.value):Promise.resolve(u.value).then(n,l);i((e=e.apply(y,p)).next())});import{bs as x,b6 as T,b7 as D}from"./index.js";import{d as B,k as h,e as F,w as K,K as M,o as N,al as A,Z as b,_ as S,a9 as L,a6 as O,ac as _,ad as I,F as V}from"./vue-71d1abb3.js";const E={key:1},U=B({__name:"DictSelectBox",props:{vmode:{type:String,default:"edit"},disabled:{type:Boolean,default:!1},mode:{type:String,default:"group"},width:{type:[Number,String],default:"100%"},type:{type:String,default:""},subtype:{type:String,default:""},filter:{type:Function,default:null},value:{type:[String,Number,Array],default:null},delaytimes:{type:Number,default:900},multiple:{type:String,default:"combobox"},callback:{type:Function,default:null},maxTagCount:{type:Number,default:10}},emits:["update:value","change"],setup(y,{emit:p}){const e=y,f=x(),o=T(),n=h(),l=h([]),i=h(!1),u=F(()=>e.disabled||i.value),r=(a,t)=>{p("update:value",a),p("change",a,t,l.value),e.callback!=null&&e.callback(a,t,l.value)},v=()=>{var a;e.multiple=="multiple"?n.value=e.value==null?[]:e.value:typeof e.value=="string"?n.value=e.value==="null"?"":e.value:typeof e.value=="number"?n.value=e.value:n.value=e.value==null?"":e.value;try{e.multiple!=="multiple"&&(l.value&&e.value!=null&&e.value!="null"&&l.value.length>0&&typeof((a=l.value[0])==null?void 0:a.value)=="string"?n.value=String(e.value):(e.value==null||e.value=="null")&&(n.value="")),e.subtype!=""&&(l.value=l==null?void 0:l.value.filter(t=>Reflect.has(t,"relationDict")?t.relationDict===e.subtype:!1))}catch(t){}},k=(a,t)=>e.filter==null?t.label.toLowerCase().indexOf(a.toLowerCase())>=0:e.filter(a,t),C=a=>{const t=l.value.find(s=>s.value==a);return t?t==null?void 0:t.label:a},m=()=>{const{type:a}=e,t=l.value;(!t||(t==null?void 0:t.length)==0)&&(console.warn("dict select box of type:",a," has not loaded, and load this data again."),w())},w=()=>d(this,null,function*(){try{const{type:a}=e;e.multiple=="multiple"||e.multiple=="tags"?n.value=[]:(e.value==null||e.value=="null")&&(n.value="");let t=yield f.fget(D+a);if(t)l.value=t,v();else if(e.mode!=="group"){const s=yield o.fetchBackendData("",e);l.value=s,v()}else{const s=e.delaytimes*(Math.random()+Math.random()+Math.random())/2;o.setDictKey(e.type),setTimeout(()=>d(this,null,function*(){const g=o.getDictKey.join(",");if(t=yield f.fget(D+a),t)l.value=t;else{let c=yield o.fetchBackendData(g,e);l.value=c,(!c||c.length==0)&&(c=yield o.fetchBackendData(a,e),l.value=c)}v()}),s)}}catch(a){console.error("Failed to fetch data:",a)}});return K(()=>e.value,()=>{v()}),M(()=>d(this,null,function*(){setTimeout(()=>{m()},1500)})),N(()=>d(this,null,function*(){w(),setTimeout(()=>{m()},1500)})),(a,t)=>{const s=A("a-select");return b(),S(V,null,[e.vmode=="edit"||e.disabled?(b(),L(s,{key:0,value:n.value,"onUpdate:value":t[0]||(t[0]=g=>n.value=g),"show-search":"","allow-clear":"",mode:e.multiple,disabled:u.value,maxTagCount:e.maxTagCount,style:O(`width: ${typeof e.width=="number"?e.width+"px":e.width}`),options:l.value,"filter-option":k,placeholder:"请选择数据...",onMouseenter:m,onInputKeyDown:m,onChange:r},null,8,["value","mode","disabled","maxTagCount","style","options"])):_("",!0),e.vmode=="view"?(b(),S("span",E,I(C(e.value)),1)):_("",!0)],64)}}});export{U as _};
//# sourceMappingURL=DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js.map
