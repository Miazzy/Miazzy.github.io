var v=(h,m,b)=>new Promise((M,x)=>{var e=i=>{try{f(b.next(i))}catch(k){x(k)}},P=i=>{try{f(b.throw(i))}catch(k){x(k)}},f=i=>i.done?M(i.value):Promise.resolve(i.value).then(e,P);f((b=b.apply(h,m)).next())});import{B as oe}from"./BasicTable-0434a334.js";import{T as ie}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as re}from"./useTable-109483b3.js";import{bB as de,bC as ue,a2 as T}from"./antd-15ac76ed.js";import{au as ce,b as pe,a7 as me,av as N,ax as fe,az as ve,bQ as ye,bR as be,aA as ge,a0 as Ie,_ as Ce}from"./index.js";import{P as he}from"./index-20519caf.js";import{C as _e}from"./CommonTree-c4ed7838.js";import"./index-74ac3212.js";import{_ as L}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{g as z,a as we,f as o,b as V,e as xe,c as ke}from"./safetyFiles-3e6b7883.js";import{d as Se,k as d,r as Te,ax as Ne,o as Oe,al as O,Z as y,_ as Y,f as l,aa as n,$ as F,a9 as R,ac as E,E as C,F as j,u as c,J as Re,aG as Ee,aH as Fe}from"./vue-71d1abb3.js";import{j as Pe}from"./Export2Excel-389a8fc9.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";import"./useRender-21ce56fb.js";const Be=h=>(Ee("data-v-ffc1a612"),h=h(),Fe(),h),De={class:"right-table-layout"},Ke={class:"tab-button-div"},Le=Be(()=>F("div",{style:{width:"10px",opacity:"0"}},null,-1)),Ye={class:"tab-table-div"},Me=Se({__name:"index",setup(h){const m=d(!1),{createConfirm:b,createMessage:M}=ce(),{t:x}=pe(),e=Te({fileType:null,particularYear:null,serviceCompany:null,isRectificationCompleted:null,status:null,billCode:null}),P=d([]);d({});const f=d({}),i=d([]);d([]);const k=z();Ne(),d([{label:"草稿",value:"0"},{label:"处理中",value:"1"},{label:"通过",value:"2"},{label:"不通过",value:"3"},{label:"已取消",value:"4"},{label:"已终止",value:"5"},{label:"退回",value:"6"}]);const B=d([]),A=()=>v(this,null,function*(){let a=yield ke(e);return B.value=a.result,a.result}),H={baseColProps:{lg:6,md:8},labelWidth:90,schemas:[]};function $(){X(),m.value=!m.value}const[G,{reload:g,getPaginationRef:W,getForm:Ue,redoHeight:X}]=re({title:"安全信息列表",api:()=>v(this,null,function*(){const a=W();return e.pageNo=a.current,e.pageSize=a.pageSize,yield A()}),columns:k,useSearchForm:!1,formConfig:H,showTableSetting:!0,bordered:!0,rowKey:"id",rowSelection:{type:"radio",onChange:J},handleSearchInfoFn(a){return e.status=a.status,e.fileType=a.fileType,e.particularYear=a.particularYear,e.isRectificationCompleted=a.isRectificationCompleted,e.serviceCompany=a.serviceCompany,a},sortFn:a=>{a.order?(e.sortField=a.field,e.sortOrder=a.order.replace("end","")):(e.sortField=null,e.sortOrder=null)}});let D=d("");function J(a,t){t.length>0?(i.value=[a[0]],D.value=a[0]):(i.value=[],D.value="")}function Q(){return v(this,null,function*(){const a=yield we({});P.value=a.result,g()})}function Z(){if(o.id="",o.fileType="",o.particularYear="",o.completionDate="",o.isRectificationCompleted="",o.serviceCompany="",o.isPowerGridFiling="",o.handledByName="",o.rectificationPlan="",e.periodId==null){T.error("请先选择电站分期。");return}e.nodeKindId=="station"&&q(),e.nodeKindId=="period"&&q(),fe("/po/safety/safetyfiles/create","添加安全信息",Re(o))}function U(a){a.status==0||a.status==1,ve(a.id)}const ee=a=>v(this,null,function*(){const t=yield V({id:a.id}),{value:_}=yield ye.prompt("请输入取消原因","取消流程",{confirmButtonText:x("common.okText"),cancelButtonText:x("common.cancelText"),inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"取消原因不能为空"});yield be(t.result.processInstanceId,_),T.success("已取消"),g()});function ae(){return v(this,null,function*(){if(console.log(i.value),i.value.length!=1)return T.info("请选择一条数据."),!1;const a=yield V({id:i.value[0]});b({title:"提示",iconType:"warning",content:"确定要删除选中记录？",onOk(){return v(this,null,function*(){if(a.result.status!=0){T.error("非草稿状态不能删除。");return}yield ge(a.result.processInstanceId),T.success("已删除。"),i.value=[],g()})}})})}function te(){e.fileType=null,e.particularYear=null,e.serviceCompany=null,e.isRectificationCompleted=null,e.status=null,e.billCode=null,g()}function le(){g()}function q(){f.value.stationId}function se(a={}){e.stationId=null,e.stationName=null,e.periodName=null,e.periodId=null,e.stationOrganId=null,e.stationOrganName=null,e.nodeKindId=null,f.value.nodeKindId=null,e.searchId=null,a!=null&&(e.stationOrganId=a.organId,e.stationOrganName=a.organName,a.nodeKindId=="station"&&(e.stationId=a.powerStationId,e.stationName=a.name,f.value.stationId=a.powerStationId),a.nodeKindId=="period"&&(e.stationId=a.powerStationId,e.stationName=a.orgName,e.periodName=a.powerStationPeriodName,e.periodId=a.powerStationPeriodId,f.value.stationId=a.powerStationId,o.stationId=e.stationId,o.stationName=e.stationName,o.periodName=e.periodName,o.periodId=e.periodId,o.stationOrganId=e.stationOrganId,o.stationOrganName=e.stationOrganName),e.nodeKindId=a.nodeKindId,f.value.nodeKindId=a.nodeKindId,e.searchId=a.id),g()}function ne(){return v(this,null,function*(){b({title:"导出",iconType:"warning",content:"确定要导出所有记录？",onOk(){return v(this,null,function*(){const t=d({index:"序号"}),_=z(),u=d([]),S=d([]);_.forEach(r=>{r.dataIndex!=="id"&&(r.dataIndex==="stationOrganName"&&Ie().isMultiOrganization||r.dataIndex!=="stationOrganName")&&(t.value[r.dataIndex]=r.title,S.value.push(r.dataIndex))});let I=yield xe(e);B.value=I.result,B.value.forEach(function(r,s){let p="";switch(r.status){case 0:p="草稿";break;case 1:p="处理中";break;case 2:p="通过";break;case 3:p="不通过";break;case 4:p="已取消";break;case 5:p="已终止";break;case 6:p="退回/驳回";break}let w=d({index:s+1});S.value.forEach(K=>{w.value[K]=K==="status"?p:r[K]}),u.value.push(w.value)}),Pe({data:u.value,header:t.value,filename:"安全信息.xlsx"})})}})})}return Oe(()=>{Q(),me.getInstance().listen("safetyFiles",function(){setTimeout(()=>{g()},500)})}),(a,t)=>{const _=O("a-input"),u=O("a-form-item"),S=O("a-date-picker"),I=O("a-button"),r=O("a-form");return y(),Y("div",null,[l(c(he),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:n(()=>[l(_e,{title:"电站组织",onSelect:se,value:P.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),F("div",De,[F("div",Ke,[l(r,{model:e,name:"searchInfo",layout:"inline",autocomplete:"off",class:"search-form ant-advanced-search-form"},{default:n(()=>[l(u,{name:"billCode",label:"单据编号",labelCol:{span:6},rules:[{required:!1,message:"请输入单据编号"}],style:{width:"26.5%"},colon:!1},{default:n(()=>[l(_,{value:e.billCode,"onUpdate:value":t[0]||(t[0]=s=>e.billCode=s),placeholder:"请输入单据编号",style:{width:"100%"}},null,8,["value"])]),_:1}),l(u,{name:"fileType",label:"类型",labelCol:{span:6},rules:[{required:!1,message:"请选择类型"}],style:{width:"26.5%"},colon:!1},{default:n(()=>[l(L,{type:"poSafetyFileType",value:e.fileType,"onUpdate:value":t[1]||(t[1]=s=>e.fileType=s),width:"100%"},null,8,["value"])]),_:1}),l(u,{name:"particularYear",label:"年度",labelCol:{span:6},rules:[{message:"请选择年度"}],style:{width:"26.5%"},colon:!1},{default:n(()=>[l(S,{value:e.particularYear,"onUpdate:value":t[2]||(t[2]=s=>e.particularYear=s),"value-format":"YYYY",style:{width:"100%"},picker:"year"},null,8,["value"])]),_:1}),m.value?(y(),R(u,{key:0,style:{width:"100%",height:"10px"}})):E("",!0),m.value?(y(),R(u,{key:1,name:"serviceCompany",label:"服务单位",labelCol:{span:6},rules:[{required:!1,message:"请输入服务单位"}],style:{width:"26.5%"},colon:!1},{default:n(()=>[l(_,{value:e.serviceCompany,"onUpdate:value":t[3]||(t[3]=s=>e.serviceCompany=s),placeholder:"请输入服务单位",style:{width:"100%"}},null,8,["value"])]),_:1})):E("",!0),m.value?(y(),R(u,{key:2,name:"isRectificationCompleted",label:"整改是否完成",labelCol:{span:12},rules:[{required:!1,message:"请输入整改是否完成"}],style:{width:"26.5%"},colon:!1},{default:n(()=>[l(L,{type:"yes_or_no",value:e.isRectificationCompleted,"onUpdate:value":t[4]||(t[4]=s=>e.isRectificationCompleted=s),width:"100%"},null,8,["value"])]),_:1})):E("",!0),m.value?(y(),R(u,{key:3,name:"status",label:"审批状态",labelCol:{span:6},rules:[{required:!1,message:"请选择审批状态"}],style:{width:"26.5%"},colon:!1},{default:n(()=>[l(L,{type:"bpm_process_instance_result",onChange:t[5]||(t[5]=s=>"()=> searchInfo.status = value"),value:e.status,"onUpdate:value":t[6]||(t[6]=s=>e.status=s),width:"100%"},null,8,["value"])]),_:1})):E("",!0),l(u,{class:"placeholder-btns"},{default:n(()=>[Le]),_:1}),l(u,{class:"search-btns"},{default:n(()=>[l(I,{style:{margin:"0 8px"},onClick:te},{default:n(()=>[C("重置")]),_:1}),l(I,{type:"primary",class:"tab-button",onClick:le},{default:n(()=>[C("查询")]),_:1}),F("a",{style:{"margin-left":"12px","font-size":"14px"},onClick:$},[m.value?(y(),Y(j,{key:0},[C(" 收起 "),l(c(de))],64)):(y(),Y(j,{key:1},[C(" 展开 "),l(c(ue))],64))])]),_:1})]),_:1},8,["model"])]),F("div",Ye,[l(c(oe),{class:"fix-basic-table",onRegister:c(G),onResizeColumn:t[7]||(t[7]=(s,p)=>p.width=s),onRowDbClick:t[8]||(t[8]=s=>U(s))},{toolbar:n(()=>[l(I,{type:"primary",preIcon:c(N).ADD,onClick:Z},{default:n(()=>[C("添加")]),_:1},8,["preIcon"]),l(I,{class:"red-btn",disabled:c(D)=="",preIcon:c(N).DELETE,onClick:ae},{default:n(()=>[C("删除")]),_:1},8,["disabled","preIcon"]),l(I,{class:"yellow-btn",preIcon:c(N).EXPORT,onClick:ne},{default:n(()=>[C("导出")]),_:1},8,["preIcon"])]),bodyCell:n(({column:s,text:p,record:w})=>[s.key==="action"?(y(),R(c(ie),{key:0,actions:[{icon:c(N).LOG,label:"进度",onClick:U.bind(null,w)},{icon:c(N).DELETE,danger:!0,label:"取消",ifShow:()=>w.status==0,onClick:ee.bind(null,w)}]},null,8,["actions"])):E("",!0)]),_:1},8,["onRegister"])])])]),_:1})])}}});const ga=Ce(Me,[["__scopeId","data-v-ffc1a612"]]);export{ga as default};
//# sourceMappingURL=index-0bc70c0b.js.map
