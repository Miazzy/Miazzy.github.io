var m=(A,r,t)=>new Promise((p,o)=>{var f=v=>{try{_(t.next(v))}catch(c){o(c)}},S=v=>{try{_(t.throw(v))}catch(c){o(c)}},_=v=>v.done?p(v.value):Promise.resolve(v.value).then(f,S);_((t=t.apply(A,r)).next())});import{d as ce,k as d,r as P,e as ie,w as B,o as re,v as T,b as ue,al as q,Z as k,_ as U,a9 as $,aa as E,f as I,A as de,$ as w,an as pe,u as C,B as fe,a6 as ve,ad as ye,q as b}from"./vue-71d1abb3.js";import{Q as he,b4 as ge,a5 as me,_ as we}from"./index.js";import{aS as Z}from"./antd-15ac76ed.js";const Se={class:"search-panel"},ke={class:"search-popup-subcontent"},be={class:"search-table"},_e={key:1},xe={key:2},Ce=ce({__name:"SearchBox",props:{vmode:{type:String,default:"edit"},opkey:{type:String,default:null},searchKey:{type:String,default:"name"},multiple:{type:Boolean,default:!1},columns:Array,data:Array,twidth:{type:String,default:"auto"},value:{type:String,default:""},tfields:{type:Object,default:{key:"id"}},disabled:{type:Boolean,default:!1},api:{type:[String,Function],default:null},apiParamFunc:{type:Function,default:null},vfield:{type:String,default:"name"},pagination:{type:[Boolean,Object],default:!1},callback:{type:Function,default:null},validateFunc:{type:Function,default:null}},emits:["update:value","select","change","search","searchclick","clear","update:searchText"],setup(A,{emit:r}){const t=A,p=d(!1),o=d(""),f=P({text:""}),S=d(null),_=d(null),v=d(!1),c=P([]),L=d(260),z=d([]),h=d(""),y=d([]),F=d(!1),N=d("100%"),u=P({size:"small",total:0,current:1,pageSize:10,hideOnSinglePage:!1,simple:!1,disabled:!1}),G=d(!1),M=ie(()=>t.disabled||G.value),J=(e,a,l=null)=>m(this,null,function*(){var n;if((l==null||typeof l=="undefined")&&t.apiParamFunc!=null&&(l=yield(n=t.apiParamFunc)==null?void 0:n.call(t),l===!1))return{data:[],total:0};e.includes("?")||(e=e+`?${t.searchKey}={name}&pageNo={current}&pageSize={pageSize}`),e=e.replace("{name}",f.text).replace("{current}",a.current).replace("{pageSize}",a.pageSize);const s={url:e,params:l};return me.get(s,{isOnlyResult:!0})}),R=()=>{try{r("update:searchText",f.text),r("search",f.text),r("searchclick",f.text),b(()=>m(this,null,function*(){if(t.api!=null&&typeof t.api=="string"){const e=t.api,a={current:1,pageSize:u.pageSize},l=yield J(e,a);let s=[];l!=null&&l.data&&Array.isArray(l==null?void 0:l.data)?s=l==null?void 0:l.data:l!=null&&l.list&&Array.isArray(l==null?void 0:l.list)&&(s=l==null?void 0:l.list);const n=t==null?void 0:t.tfields,i=x(s,n);c.splice(0,c.length),c.push(...i),u.total=l==null?void 0:l.total,u.current=a.current}else if(t.api!=null&&typeof t.api=="function"){const e=yield t.api(),a=t==null?void 0:t.tfields,l=x(e,a);c.splice(0,c.length),c.push(...l)}else{const e=t==null?void 0:t.tfields,a=C(y.value),l=JSON.parse(JSON.stringify(a)),s=ne(l,f.text),n=x(s,e);c.splice(0,c.length),c.push(...n)}}))}catch(e){}},X=e=>{try{e.stopPropagation(),p.value=!0,D()}catch(a){}},j=e=>{e.preventDefault()},D=()=>{t.validateFunc&&t.validateFunc()},Y=e=>{r("update:value",o.value),r("change",o.value,{}),D()},V=()=>{try{f.text="",R(),ee("input.search-input")}catch(e){}},ee=(e="input.search-input")=>{try{document.querySelector(e).value=""}catch(a){}},ae={hideSelectAll:!0,preserveSelectedRowKeys:!0,onChange:(e,a)=>{},onSelect:(e,a,l,s)=>{a==!0?o.value+=O(e)+",":o.value=o.value.replace(O(e)+",",""),r("update:value",o.value),r("select",{records:o.value,keys:o.value,selectedRows:l}),r("change",o.value,{records:o.value,keys:o.value,selectedRows:l}),D(),t.callback!=null&&t.callback({records:o.value,keys:o.value,selectedRows:l})}},O=e=>{try{return Reflect.has(e,h.value)?e[h.value]:Reflect.has(e,t.tfields.key)?e[t.tfields.key]:JSON.stringify(e)}catch(a){}},te=e=>{const a={};try{for(const l in e)a[e[l]]=l}catch(l){}return a},x=(e,a)=>{if(e==null||typeof e=="undefined"||e.length===0)return[];try{const l=te(a);return e.map(s=>{const n={};for(const i in s)i in l?n[l[i]]=s[i]:n[i]=s[i];return n})}catch(l){return[]}},le=(e,a,l)=>{try{const s=JSON.parse(JSON.stringify(e));JSON.stringify(s).includes(l)&&a.push(s)}catch(s){}},ne=(e,a)=>{if(a==""||a==null||typeof a=="undefined")return e;const l=[];try{for(const s of e)le(s,l,a)}catch(s){}return l},W=e=>{try{if(V(),K(),typeof e=="boolean")return;S.value&&!S.value.contains(e.target)&&(p.value=!1)}catch(a){}},H=(e,a)=>({onclick:s=>{try{t.multiple||(o.value=e[h.value],r("update:value",e[h.value]),r("select",{record:e,index:a},s),r("change",e[h.value],{record:e,index:a},s),t.callback!=null&&t.callback({record:e,index:a,event:s}),D()),p.value=!1}catch(n){}}}),Q=(e,a,l,s)=>m(this,null,function*(){try{if(t.api!=null){const n=yield J(t.api,e);n!=null&&n.data&&Array.isArray(n==null?void 0:n.data)?y.value=n==null?void 0:n.data:n!=null&&n.list&&Array.isArray(n==null?void 0:n.list)&&(y.value=n==null?void 0:n.list);const i=t==null?void 0:t.tfields,g=C(y.value),se=JSON.parse(JSON.stringify(g)),oe=x(se,i);c.splice(0,c.length),c.push(...oe),u.total=n==null?void 0:n.total}u.current=e==null?void 0:e.current,u.pageSize=e==null?void 0:e.pageSize}catch(n){}}),K=()=>m(this,null,function*(){try{if(t.opkey!=null&&t.opkey!=""){const g=ge(t.opkey);z.value=g.columns,h.value=g.vfield,y.value=g.data,F.value=g.pagination,N.value=g.twidth}else z.value=t.columns,h.value=t.vfield,y.value=t.data,F.value=t.pagination,N.value=t.twidth;const e={current:1,pageSize:u.pageSize};let a=null;t.api!=null&&typeof t.api=="function"?(a=yield t.api(),y.value=a==null?void 0:a.list):t.api!=null&&typeof t.api=="string"&&(a=yield J(t.api,e),a!=null&&a.data&&Array.isArray(a==null?void 0:a.data)?y.value=a==null?void 0:a.data:a!=null&&a.list&&Array.isArray(a==null?void 0:a.list)&&(y.value=a==null?void 0:a.list));const l=t==null?void 0:t.tfields,s=C(y.value),n=JSON.parse(JSON.stringify(s)),i=x(n,l);c.splice(0,c.length),c.push(...i),u.disabled=!F.value,u.total=a==null?void 0:a.total,u.current=e.current,u.pageSize=e==null?void 0:e.pageSize}catch(e){}});return B(()=>p.value,()=>m(this,null,function*(){try{if(t.twidth==="auto"||t.twidth==="100%"){const e=()=>{const a=document.querySelectorAll("body .ant-dropdown");for(let l of a)l.style.width=l.style.minWidth};yield b(),yield b(),yield b(),yield b(),yield b(),e()}}catch(e){}})),B(()=>t.data,()=>{K()}),B(()=>t.value,()=>{try{o.value=t.value}catch(e){}}),B(()=>o.value,e=>{e||r("clear",e)}),re(()=>m(this,null,function*(){try{yield K(),o.value=t.value,T(S,[[he,W]])}catch(e){}})),ue(()=>{}),(e,a)=>{const l=q("a-input"),s=q("a-menu"),n=q("a-dropdown");return k(),U("div",{class:"search-box",ref_key:"searchBox",ref:S},[t.vmode=="edit"&&!t.disabled?(k(),$(n,{key:0,ref_key:"dropdown",ref:_,trigger:["click"],disabled:M.value,class:"search-dropdown-box",visible:p.value,"onUpdate:visible":a[4]||(a[4]=i=>p.value=i),onVisibleChange:W},{overlay:E(()=>[I(s,null,{default:E(()=>[T(w("div",{onClick:a[3]||(a[3]=fe(()=>{},["stop"])),class:"search-content",style:ve(`width: ${N.value||t.twidth}; display: ${p.value?"block":"none"}`)},[w("div",Se,[w("div",ke,[T(w("input",{class:"search-input","onUpdate:modelValue":a[2]||(a[2]=i=>f.text=i),onKeyup:R,placeholder:"  请输入搜索关键字..."},null,544),[[pe,f.text]]),w("button",{class:"close-button",onClick:V},"清除"),w("button",{class:"search-button",onClick:R},"搜索")])]),w("div",be,[A.multiple?(k(),$(C(Z),{key:0,rowKey:O,"row-selection":ae,columns:z.value,"data-source":c,size:"small",pagination:u,loading:v.value,bordered:!0,scroll:{y:L.value},onChange:Q,customRow:H},null,8,["columns","data-source","pagination","loading","scroll"])):(k(),$(C(Z),{key:1,rowKey:O,columns:z.value,"data-source":c,size:"small",pagination:u,loading:v.value,bordered:!0,scroll:{y:L.value},onChange:Q,customRow:H},null,8,["columns","data-source","pagination","loading","scroll"]))])],4),[[de,p.value]])]),_:1})]),default:E(()=>[I(l,{value:o.value,"onUpdate:value":a[0]||(a[0]=i=>o.value=i),class:"search-text","allow-clear":p.value,disabled:M.value,placeholder:"请选择下拉列表中数据...",onFocus:j,onKeydown:j,onChange:Y,onClick:a[1]||(a[1]=i=>X(i))},null,8,["value","allow-clear","disabled"])]),_:1},8,["disabled","visible"])):t.vmode=="view"?(k(),U("span",_e,ye(t.value),1)):(k(),U("span",xe,[I(l,{value:t.value,class:"search-text",disabled:!0},null,8,["value"])]))],512)}}});const Be=we(Ce,[["__scopeId","data-v-e0f78e0b"]]);export{Be as S};
//# sourceMappingURL=SearchBox-22bb02d6.js.map
