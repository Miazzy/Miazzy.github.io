var y=(a,o,l)=>new Promise((g,x)=>{var S=i=>{try{d(l.next(i))}catch(n){x(n)}},F=i=>{try{d(l.throw(i))}catch(n){x(n)}},d=i=>i.done?g(i.value):Promise.resolve(i.value).then(S,F);d((l=l.apply(a,o)).next())});import{a5 as b,a0 as Y,b as Q,au as tt,aO as C,av as V,_ as et}from"./index.js";import{u as at,B as ot}from"./useForm-dea3ed18.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import{B as W}from"./BasicTable-0434a334.js";import"./index-085d06c7.js";import{u as B}from"./useTable-109483b3.js";import{K as nt}from"./antd-15ac76ed.js";import{e as E}from"./download-03e71dd5.js";import{k as w,d as it,ax as rt,u as c,r as st,o as lt,al as N,Z as M,_ as K,$ as u,f as p,aa as h,a9 as j,E as q,ad as A,ac as k,aG as dt,aH as ct}from"./vue-71d1abb3.js";import{_ as ut}from"./NtgaleChart.vue_vue_type_script_setup_true_lang-0930fb50.js";import{_ as mt}from"./EchartLineBarChart.vue_vue_type_style_index_0_lang-90edad95.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./index-d8a2358f.js";import"./install-58e0bd81.js";import"./NoData-1ab5cc7b.js";const pt=a=>b.post({url:"/bi/grid/export-station-capacity",params:a,responseType:"blob"},{isReturnNativeResponse:!0}),ht=a=>b.post({url:"/bi/grid/export-org-capacity",params:a,responseType:"blob"},{isReturnNativeResponse:!0}),bt=a=>b.get({url:"/bi/common/org/info",params:a},{isOnlyResult:!0}),gt=a=>b.post({url:"/baseset/common/list-station",params:a}),ft=a=>b.get({url:"/bi/grid/org/capacity",params:a},{}),yt=a=>b.get({url:"/bi/grid/station/capacity",params:a},{}),_t=a=>b.get({url:"/bi/grid/capacity/echar",params:a},{}),L=w([{title:"所属公司",dataIndex:"name",width:150,resizable:!0},{title:"地面",dataIndex:"dm",children:[{title:"光伏并网容量(MW)",dataIndex:"dmConnectCapacity",width:100,resizable:!0},{title:"数量(座)",dataIndex:"dmStationNum",width:100,resizable:!0},{title:"占比(%)",dataIndex:"dmRate",width:100,resizable:!0}]},{title:"渔光",dataIndex:"yg",children:[{title:"光伏并网容量(MW)",dataIndex:"ygConnectCapacity",width:100,resizable:!0},{title:"数量(座)",dataIndex:"ygStationNum",width:100,resizable:!0},{title:"占比(%)",dataIndex:"ygRate",width:100,resizable:!0}]},{title:"农光",dataIndex:"ng",children:[{title:"光伏并网容量(MW)",dataIndex:"ngConnectCapacity",width:100,resizable:!0},{title:"数量(座)",dataIndex:"ngStationNum",width:100,resizable:!0},{title:"占比(%)",dataIndex:"ngRate",width:100,resizable:!0}]},{title:"分布式",dataIndex:"fbs",children:[{title:"光伏并网容量(MW)",dataIndex:"fbsConnectCapacity",width:100,resizable:!0},{title:"数量(座)",dataIndex:"fbsStationNum",width:100,resizable:!0},{title:"占比(%)",dataIndex:"fbsRate",width:100,resizable:!0}]},{title:"小计",dataIndex:"total",children:[{title:"光伏并网容量(MW)",dataIndex:"totalConnectCapacity",width:100,resizable:!0},{title:"数量(座)",dataIndex:"totalNum",width:100,resizable:!0}]}]),G=a=>{const o=[{title:"所属公司",dataIndex:"orgName",width:150,customCell:l=>({rowSpan:l.rowOrgSpan}),resizable:!0},{title:"电站名称",dataIndex:"stationName",width:150,customCell:l=>({rowSpan:l.rowStationSpan}),resizable:!0},{title:"期数",dataIndex:"periodName",width:150,resizable:!0},{title:"电站类型",dataIndex:"stationType",width:150,resizable:!0},{title:"是否全容量",dataIndex:"isGridAll",width:150,resizable:!0},{title:"建设规模(MW)",dataIndex:"buildScale",width:150,resizable:!0},{title:"光伏并网容量(MW)",dataIndex:"connectCapacity",width:150,resizable:!0},{title:"储能并网容量(MW)",dataIndex:"accessCapacity",width:150,resizable:!0}];return Y().isMultiOrganization||o.shift(),o},wt=a=>[{field:"dateCycle",label:"时间维度",component:"Select",required:!0,defaultValue:"year",componentProps:{options:[{value:"year",label:"年份"},{value:"month",label:"月份"},{value:"day",label:"自然日"}]}},{field:"yearValue",label:"年份",component:"YearPicker",defaultValue:nt(new Date).format("YYYY"),componentProps:{format:"YYYY",valueFormat:"YYYY",style:{width:"100%"}},show:({values:o})=>o.dateCycle=="year",dynamicRules:({values:o})=>o.dateCycle=="year"?[{required:!0,message:"年份必填"}]:[]},{field:"[startMonth, endMonth]",label:"月份",component:"RangePicker",componentProps:{picker:"month",format:"YYYY-MM",valueFormat:"YYYY-MM",style:{width:"100%"},placeholder:["开始月份","结束月份"]},show:({values:o})=>o.dateCycle=="month",dynamicRules:({values:o})=>o.dateCycle=="month"?[{required:!0,message:"月份必填"}]:[]},{field:"[startDate, endDate]",label:"时间段",component:"RangePicker",componentProps:{format:"YYYY-MM-DD",style:{width:"100%"},valueFormat:"YYYY-MM-DD",placeholder:["开始时间","结束时间"]},show:({values:o})=>o.dateCycle=="day",dynamicRules:({values:o})=>o.dateCycle=="day"?[{required:!0,message:"时间段必填"}]:[]},{field:"orgId",label:"所属公司",component:"ApiSelect",componentProps:{options:[],api:bt,placeholder:"请选择所属公司"},show:Y().isMultiOrganization},{field:"stationId",label:"电站名称",component:"ApiSelect",componentProps:{options:[],api:()=>y(void 0,null,function*(){const o=yield gt({}),l=[];return o.result.forEach(g=>{l.push({value:g.powerStationId,label:g.powerStationName})}),l}),placeholder:"请输入电站名称"}}],H=a=>(dt("data-v-e2986088"),a=a(),ct(),a),xt={class:"tab-model"},It={class:"tab-button-div"},vt={id:"grid-table-tab-content",class:"tab-table-div"},Ct={class:"tab-content"},Mt={class:"tab-content-top"},Yt={class:"tab-content-bottom"},St={key:0,class:"chart"},zt={id:"left-chart",class:"left-chart"},Rt=H(()=>u("h3",null,"项目规模分布(MW)",-1)),Dt={id:"right-chart",class:"right-chart"},Tt=H(()=>u("h3",null,"在运电站规模",-1)),Ot=it({__name:"index",setup(a){const{t:o}=Q(),{createConfirm:l,createMessage:g}=tt(),x=rt(),{currentRoute:S}=x,d=c(S).query,i=w("summary"),n=st({}),z=w(!0),R=w([]),f=w({barData:[[]],lineData:[[]],categories:[],seriesName:[["在运规模(MW)"],["个数(座)"]]});lt(()=>{if(d){const t=I();d.startDate&&(t.dateCycle=d.dateType,t.startMonth=d.startDate,t.endMonth=d.endDate,v(t)),d.stationId&&(t.stationId=d.stationId,v(t)),d.activeKey&&(i.value=d.activeKey),Y().isMultiOrganization||(i.value="detail")}});const $=t=>{t==="summary"?(D(),z.value=!0):t==="detail"&&(T(),z.value=!1)},[U,{resetFields:X,getFieldsValue:I,setFieldsValue:v}]=at({labelWidth:120,baseColProps:{span:8},actionColOptions:{span:24},autoAdvancedLine:1,schemas:wt(),compact:!0,showAdvancedButton:!0,resetButtonOptions:{onClick:()=>y(this,null,function*(){yield X(),D(),T()})},submitFunc:()=>(D(),T(),Promise.resolve())}),[Z,{reload:D}]=B({api:()=>y(this,null,function*(){const t=I();t.dateCycle=="month"&&(t.startMonth=C(t.startMonth,"YYYY-MM"),t.endMonth=C(t.endMonth,"YYYY-MM"),v(t)),Object.assign(n,t);let e=yield ft(n),r=yield _t(t);return r.result&&(R.value=r.result.pieData,f.value.lineData[0]=r.result.lineData,f.value.barData[0]=r.result.barData,f.value.categories=r.result.categories),e.result}),target:"#grid-table-tab-content",targetTabKey:"summary",targetTabValue:i,columns:L,useSearchForm:!1,bordered:!0,pagination:!1,showTableSetting:!1,maxHeight:220,scroll:{y:220},tableSetting:{fullScreen:!0},showIndexColumn:!0}),[J,{reload:T}]=B({api:()=>y(this,null,function*(){const t=I();return t.dateCycle=="month"&&(t.startMonth=C(t.startMonth,"YYYY-MM"),t.endMonth=C(t.endMonth,"YYYY-MM"),v(t)),Object.assign(n,t),(yield yt(n)).result}),target:"#grid-table-tab-content",targetTabKey:"detail",targetTabValue:i,columns:G(),useSearchForm:!1,bordered:!0,pagination:!1,showTableSetting:!1,tableSetting:{fullScreen:!0},showIndexColumn:!0,afterFetch:function(t){const e={};for(let r=0;r<t.length;r++){const s=t[r];e[s.orgId]&&e[s.orgId]++,e[s.stationId]&&e[s.stationId]++,e[s.orgId]||(e[s.orgId]=1),e[s.stationId]||(e[s.stationId]=1)}for(let r=0;r<t.length;r++){const s=t[r];for(const m in e)s.orgId===m&&(s.rowOrgSpan=e[m],e[m]=0),s.stationId===m&&(s.rowStationSpan=e[m],e[m]=0)}return t}});function P(){l({title:"提示",iconType:"warning",content:"确定要导出所有记录？",onOk(){return y(this,null,function*(){Object.assign(n,I()),i.value=="summary"?(n.filename="并网容量统计.xls",n.excelList=L,yield ht(n).then(e=>{E(e==null?void 0:e.data,n.filename)})):i.value=="detail"&&(n.filename="并网容量电站明细.xls",n.excelList=G(),yield pt(n).then(e=>{E(e==null?void 0:e.data,n.filename)})),g.success(o("common.exportSuccessText"))})}})}return(t,e)=>{const r=N("a-button"),s=N("a-tab-pane"),m=N("a-tabs");return M(),K("div",xt,[u("div",It,[p(c(ot),{onRegister:c(U)},null,8,["onRegister"])]),u("div",vt,[p(m,{activeKey:i.value,"onUpdate:activeKey":e[2]||(e[2]=_=>i.value=_),onChange:$},{default:h(()=>[c(Y)().isMultiOrganization?(M(),j(s,{key:"summary",tab:"统计报表"},{default:h(()=>[u("div",Ct,[u("div",Mt,[p(c(W),{onRegister:c(Z),onResizeColumn:e[0]||(e[0]=(_,O)=>O.width=_)},{toolbar:h(()=>[p(r,{class:"yellow-btn",preIcon:c(V).EXPORT,onClick:P},{default:h(()=>[q(A(c(o)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])]),u("div",Yt,[z.value?(M(),K("div",St,[u("div",zt,[Rt,R.value.length?(M(),j(ut,{key:0,id:"omChart",width:450,height:350,data:R.value,showLabel:"",roseType:!1},null,8,["data"])):k("",!0)]),u("div",Dt,[Tt,p(mt,{data:f.value,width:"40rem",height:"20rem",category:f.value.categories,name:f.value.seriesName,rotate:0,ybgcolor:"#c0c0c060",txtColor:"#c0c0c0"},null,8,["data","category","name"])])])):k("",!0)])])]),_:1})):k("",!0),p(s,{key:"detail",tab:"电站明细","force-render":""},{default:h(()=>[p(c(W),{onRegister:c(J),onResizeColumn:e[1]||(e[1]=(_,O)=>O.width=_)},{toolbar:h(()=>[p(r,{class:"yellow-btn",preIcon:c(V).EXPORT,onClick:P},{default:h(()=>[q(A(c(o)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])]),_:1})]),_:1},8,["activeKey"])])])}}});const se=et(Ot,[["__scopeId","data-v-e2986088"]]);export{se as default};
//# sourceMappingURL=index-4a9126bb.js.map
