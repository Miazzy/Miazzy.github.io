{"version":3,"file":"view-19ac3073.js","sources":["../../src/views/oa/info/officedoc/view.ts","../../src/views/oa/info/officedoc/view.vue"],"sourcesContent":["import { defHttp } from '/@/utils/http/axios';\nenum Api {\n  getDocOfficalData = '/oa/official-doc-release/getView',\n  getInfoNoticeData = '/oa/info-notice-release/getView',\n  getFile='/infra/file/getFiles?bizId=',\n  cancelCollection = '/oa/info-release-collection/cancelCollection?infoReleaseId=',\n  addCollection = '/oa/info-release-collection/create',\n  readStr = '/oa/info-query/read',\n  noticeStr = '/oa/info-query/notify',\n  getOrgTree = '/system/org/list-tree',\n}\n\n  \nexport function getOrgTree(params) {\n  return defHttp.post({ url: Api.getOrgTree, params });\n}\nexport function sendRead(params) {\n  return defHttp.post({ url: Api.readStr, params });\n}\nexport function sendNotice(params) {\n  return defHttp.post({ url: Api.noticeStr, params });\n}\n\nexport const getDocOfficalData = (params) => {\n  return defHttp.get({ url: Api.getDocOfficalData, params }, {});\n};\nexport const getInfoNoticeData = (params) => {\n  return defHttp.get({ url: Api.getInfoNoticeData, params }, {});\n};\nexport const getFile = (id) => {\n  return defHttp.get({ url: Api.getFile + id },{});\n};\n\nexport const cancelCollection = (infoReleaseId) => {\n  return defHttp.put({ url: Api.cancelCollection + infoReleaseId }, {});\n};\n\nexport const addCollection = (params) => {\n  return defHttp.post({ url: Api.addCollection ,params }, {});\n};","<template>\n  <a-row :gutter=\"24\" style=\"margin-bottom: 20px\">\n    <a-col :span=\"19\" :offset=\"1\">\n      <div style=\"text-align: center\">\n        <h1\n          style=\"\n            width: 90vw;\n            overflow: hidden;\n            color: #1890ff;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n          \"\n          >{{ formState.subject }}</h1\n        ></div\n      >\n      <div style=\"text-align: center\"\n        >发布人：{{ formState.personMemberName }} &nbsp;&nbsp;发布时间：{{\n          formState.finishedDate\n        }}</div\n      >\n    </a-col>\n    <a-col :span=\"1.5\" style=\"margin-top: 30px\">\n      <a-button\n        v-if=\"formState.isAllowCopy == 1\"\n        type=\"primary\"\n        style=\"color: white\"\n        :icon=\"h(SendOutlined)\"\n        @click=\"openNotice\"\n      >\n        {{ '知会' }}\n      </a-button>\n    </a-col>\n    <a-col :span=\"1\" style=\"margin-top: 30px\">\n      <a-button\n        type=\"danger\"\n        style=\"background-color: rgb(255 149 0); color: white\"\n        :icon=\"h(StarFilled)\"\n        @click=\"collec\"\n      >\n        {{ formState.collectStatus == 0 ? '收藏' : '取消收藏' }}\n      </a-button>\n    </a-col>\n  </a-row>\n  <a-row :gutter=\"24\">\n    <a-col :span=\"22\" :offset=\"1\">\n      <Tinymce\n        v-if=\"visible\"\n        class=\"tinymce-comp-content\"\n        v-model=\"formState.content\"\n        :width=\"`100%`\"\n        :height=\"`calc(100vh - 188px)`\"\n        :disabled=\"true\"\n        :auto-resize=\"true\"\n      />\n    </a-col>\n  </a-row>\n  <a-row :gutter=\"24\">\n    <a-col :span=\"22\" :offset=\"1\" style=\"position: fixed; bottom: 0; width: 100%; height: 78px\">\n      <UploadTable\n        ref=\"uploadTable\"\n        :width=\"`101.55%`\"\n        :height=\"`78px`\"\n        :rows=\"uploadRows\"\n        :colwidths=\"['20%', '85%']\"\n        :application=\"`oa`\"\n        :module=\"formState.module\"\n        :mode=\"`view`\"\n        fixed=\"bottom\"\n        :operate=\"operate\"\n      />\n    </a-col>\n  </a-row>\n\n  <OrganDialog\n      title=\"选择知会人\"\n      v-model:visible=\"openHandlerDialog\"\n      :value=\"tmpPerson\"\n      :tdata=\"personTreeData\"\n      :tfields=\"{ key: 'value', title: 'label' }\"\n      :width=\"800\"\n      :height=\"600\"\n      @cancel=\"handlerCancel\"\n      @confirm=\"handlerConfirm\"\n    />\n</template>\n<script lang=\"ts\" setup>\n  import { reactive, h, ref, onMounted, onActivated, nextTick } from 'vue';\n  import { Tinymce } from '/@/components/Tinymce/index';\n  import { StarFilled,SendOutlined } from '@ant-design/icons-vue';\n  import UploadTable from '/@/components/Framework/Table/UploadTable.vue';\n  import OrganDialog from '@/components/Framework/Modal/OrganDialog.vue';\n  import { urlToPath } from '/@/utils/route';\n  import { message } from 'ant-design-vue';\n  import { MsgManager } from '/@/message/MsgManager';\n  import type { TreeSelectProps } from 'ant-design-vue';\n  import {\n    getDocOfficalData,\n    getInfoNoticeData,\n    cancelCollection,\n    addCollection,\n    sendRead,\n    getOrgTree,\n    sendNotice,\n  } from './view';\n\n  let { params: query } = urlToPath() as any;\n\n  const formState: any = reactive({});\n  const uploadRows = ref<any[]>([]);\n  const visible = ref(true);\n  const tmpPerson:any = ref([]);\n  const operate = ref('preview');\n  const openHandlerDialog = ref(false);\n  const personTreeData = ref<TreeSelectProps['treeData']>();\n  //收藏\n  const collec = () => {\n    if (formState.collectStatus == 1) {\n      cancelCollection(formState.bizId).then((rsp) => {\n        if (rsp.code == 0) {\n          message.info('取消成功');\n          formState.collectStatus = 0;\n        } else {\n          message.error('取消失败.原因:' + rsp.message);\n        }\n      });\n    } else {\n      addCollection({\n        infoReleaseId: formState.bizId,\n      }).then((rsp) => {\n        if (rsp.code == 0) {\n          message.info('收藏成功');\n          formState.collectStatus = 1;\n        } else {\n          message.error('收藏失败.原因:' + rsp.message);\n        }\n      });\n    }\n  };\n\n  const openNotice=()=>{\n    openHandlerDialog.value=true;\n  }\n  \n  const handlerCancel = () => {\n    openHandlerDialog.value = false; // 关闭弹框\n  };\n  const handlerConfirm = (nodeList, allList) => {\n    tmpPerson.value=[]\n    if (nodeList && nodeList.length > 0) {\n\n      nodeList.forEach((e) => {\n        tmpPerson.value.push({ \n          orgUnitId: e.value, \n          name: e.label ,\n          value:e.value,\n          label:e.label,\n          kindId:'copyFor',\n          type:query.module\n        });\n      });\n      sendNotice({\n        bizId:formState.bizId,\n        list:tmpPerson.value\n      }).then((rsp)=>{\n        if(rsp.code == 0){\n          message.info('知会成功');\n          openHandlerDialog.value = false;\n          tmpPerson.value=[]\n        } else {\n          message.info('知会失败,原因：'+rsp.message);\n          openHandlerDialog.value = false;\n        }\n      })\n    }\n\n  };\n\n  const getOrgTreeData = async () => {\n    const typeList = await getOrgTree({\n      orgId: '',\n      orgKindIds: 'ogn,dpt,psm',\n      showPosition: false,\n      status: 1,\n    });\n    personTreeData.value = dig(typeList.result, true);\n  };\n  function dig(data, selectPerson) {\n    const list: TreeSelectProps['treeData'] = [];\n    for (let i = 0; i < data.length; i++) {\n      const item = data[i];\n\n      const treeNode: TreeSelectProps['treeData'][number] = {\n        label: item.name,\n        value: item.id,\n        orgId: item.orgId,\n        parent_node: item.parent_node,\n        parentId: item.parentId,\n        disabled:  !(item.orgKindId === 'psm'  || item.orgKindId === 'dpt' ),\n      };\n\n      if (item.children && item.children.length > 0) {\n        treeNode.children = dig(item.children, selectPerson);\n      }\n      list.push(treeNode);\n    }\n    return list;\n  }\n  const initData = async () => {\n    let params = { id: query.bizId } as any;\n    let resp;\n    if (query.module === 'officeDoc') {\n      resp = await getDocOfficalData(params);\n    } else {\n      resp = await getInfoNoticeData(params);\n    }\n    if (resp.result) {\n      formState.bizId = query.bizId;\n      formState.module = query.module;\n      Object.assign(formState,resp.result);\n      sendRead({ infoReleaseId: formState.bizId }).then(()=>{\n        MsgManager.getInstance().sendMsg('info-query', {});\n      });\n      if(formState.isAllowDownloadFile == 1){\n        operate.value = 'preview,download';\n      }\n\n\n      uploadRows.value = [\n        {\n          filetype: formState.module === 'officeDoc' ? '公文附件' : '通知附件',\n          fnamelist: '',\n          bizId: formState.bizFileId,\n          maxCount: 20,\n          maxSize: 100 * 1024 * 1024,\n          required: false,\n          vmode: 'view',\n          fileKindId: '',\n        },\n      ];\n    }\n  };\n\n  onActivated(() => {\n    visible.value = false;\n    nextTick(() => {\n      visible.value = true;\n    });\n  });\n\n  onMounted(() => {\n    initData();\n    getOrgTreeData();\n  });\n</script>\n<style lang=\"less\" scoped>\n  :deep(.tox-tinymce) {\n    border: 0 solid #ccc;\n    border-radius: 0;\n  }\n</style>\n"],"names":["getOrgTree","params","defHttp","sendRead","sendNotice","getDocOfficalData","getInfoNoticeData","cancelCollection","infoReleaseId","addCollection","query","urlToPath","formState","reactive","uploadRows","ref","visible","tmpPerson","operate","openHandlerDialog","personTreeData","collec","rsp","message","openNotice","handlerCancel","handlerConfirm","nodeList","allList","e","getOrgTreeData","__async","typeList","dig","data","selectPerson","list","i","item","treeNode","initData","resp","MsgManager","onActivated","nextTick","onMounted"],"mappings":"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"}