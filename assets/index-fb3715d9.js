var f=(i,F,I)=>new Promise((L,_)=>{var d=b=>{try{s(I.next(b))}catch(T){_(T)}},h=b=>{try{s(I.throw(b))}catch(T){_(T)}},s=b=>b.done?L(b.value):Promise.resolve(b.value).then(d,h);s((I=I.apply(i,F)).next())});import{d as Oe,ax as Se,u as l,k as N,r as S,o as ke,al as p,Z as D,a9 as J,aa as r,$ as x,f as a,ac as ze,v as W,A as V,E as y,ad as k,_ as Y,F as ee,a5 as te}from"./vue-71d1abb3.js";import{a as C}from"./index.esm-c216ed00.js";import{a5 as w,a0 as R,b as Ne,au as De,bX as H,av as K,_ as Re}from"./index.js";import{B as A}from"./BasicTable-0434a334.js";import{g as Fe,a as qe}from"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as j}from"./useTable-109483b3.js";import{bB as Ee,bC as Pe}from"./antd-15ac76ed.js";import{_ as Me}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{e as Be,a as Ue}from"./index-5d738211.js";import{e as X}from"./download-03e71dd5.js";import{P as We}from"./index-20519caf.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";function Ve(i){return w.get({url:"/bi/equipment-balance/page",params:i},{isOnlyResult:!0})}function He(i){return w.get({url:"/bi/equipment-balance/getEquipmentWarehousingDtlPage",params:i},{isOnlyResult:!0})}function Ke(i){return w.get({url:"/bi/equipment-balance/getEquipmentOutboundDtlPage",params:i},{isOnlyResult:!0})}function Ae(i){return w.download({url:"/bi/equipment-balance/export-excel",params:i},{isReturnNativeResponse:!0})}function je(i){return w.download({url:"/bi/equipment-balance/export-excel-warehousing",params:i},{isReturnNativeResponse:!0})}function Xe(i){return w.download({url:"/bi/equipment-balance/export-excel-outbound",params:i},{isReturnNativeResponse:!0})}const Le=[{title:"所属公司",dataIndex:"stationOrganName",width:160,sorter:!0,resizable:!0,ifShow:R().isMultiOrganization},{title:"库房名称",align:"left",dataIndex:"warehouseName",width:160,headAlign:"center",sorter:!0,resizable:!0},{title:"库房类型",dataIndex:"warehouseType",width:160,sorter:!0,resizable:!0,customRender:({record:i})=>i.warehouseTypeText},{title:"物料编码",dataIndex:"materialCode",width:160,sorter:!0,resizable:!0},{title:"物料类别",dataIndex:"materialCategoryName",width:160,sorter:!0,resizable:!0},{title:"物料名称",dataIndex:"materialName",width:160,sorter:!0,resizable:!0},{title:"入库数量",dataIndex:"warehousingQty",width:160,sorter:!0,resizable:!0},{title:"出库数量",dataIndex:"outboundQty",width:160,sorter:!0,resizable:!0},{title:"结存数量",dataIndex:"balanceQty",width:160,sorter:!0,resizable:!0}],Qe=[{label:"物料名称",field:"materialName",component:"Input",colProps:{span:8}},{label:"物料类别",field:"materialCategoryId",component:"Input",colProps:{span:8}}],$e=[{title:"物料名称",dataIndex:"materialName",width:160,sorter:!0,resizable:!0},{title:"入库批次",dataIndex:"billCode",width:160,sorter:!0,resizable:!0},{title:"入库类型",dataIndex:"warehousingType",width:160,sorter:!0,resizable:!0,customRender:({record:i})=>i.warehousingTypeText},{title:"入库日期",dataIndex:"warehousingDate",width:160,sorter:!0,resizable:!0},{title:"入库数量",dataIndex:"qty",width:160,sorter:!0,resizable:!0},{title:"单位",dataIndex:"unitName",width:160,sorter:!0,resizable:!0},{title:"备注",dataIndex:"remark",width:160,sorter:!0,resizable:!0},{title:"创建人",dataIndex:"personMemberName",width:160,sorter:!0,resizable:!0},{title:"创建时间",dataIndex:"fillinDate",width:160,sorter:!0,resizable:!0}],Ze=[{title:"物料名称",dataIndex:"materialName",width:160,sorter:!0,resizable:!0},{title:"出库批次",dataIndex:"billCode",width:160,sorter:!0,resizable:!0},{title:"出库类型",dataIndex:"outboundType",width:160,sorter:!0,resizable:!0,customRender:({record:i})=>i.outboundTypeText},{title:"出库日期",dataIndex:"outboundDate",width:160,sorter:!0,resizable:!0},{title:"入库批次",dataIndex:"warehousingCode",width:160,sorter:!0,resizable:!0},{title:"出库数量",dataIndex:"qty",width:160,sorter:!0,resizable:!0},{title:"单位",dataIndex:"unitName",width:160,sorter:!0,resizable:!0},{title:"备注",dataIndex:"remark",width:160,sorter:!0,resizable:!0},{title:"创建人",dataIndex:"personMemberName",width:160,sorter:!0,resizable:!0},{title:"创建时间",dataIndex:"fillinDate",width:160,sorter:!0,resizable:!0}],Ge={class:"tab-model"},Je={class:"tab-button-div"},Ye={class:"a-checkbox-group-div"},et={class:"top-table-content"},tt={class:"bottom-table-content"},at=Oe({name:"EquipmentBalance",__name:"index",setup(i){const F=Se(),{currentRoute:I}=F,_=l(I).query,{t:d}=Ne(),h=De(),s=N(!1),b=N([]),T=()=>f(this,null,function*(){(yield Be({})).forEach(e=>{b.value.push({value:e.powerStationId,label:e.powerStationName})})}),ae=t=>w.get({url:"/bi/common/org/info",params:t},{isOnlyResult:!0}),Q=N([]);function oe(){return f(this,null,function*(){const t=yield Ue();Q.value=t})}const re=(t,e)=>{let n=e.selectedNodes,g=[],c=[];if(Array.isArray(n)&&(n.forEach(v=>{c.push(v.name),g.push(v.id)}),c.length>0)){let v=c.join(","),U=g.join(",");o.materialCategoryIds=U,o.materialCategoryNames=v}},z=N("1"),ne=()=>{q()},le=()=>{o.stationOrganId="",o.stationId="",o.materialName="",o.warehouseType="",o.materialCategoryId="",o.materialCategoryIds=[],o.materialCategoryNames=[],o.inStock=[],q()},q=()=>{se(),setTimeout(()=>{const t=ue();$(null,t),de(0)},500)},o=S({stationOrganId:"",stationId:"",materialName:"",warehouseType:"",materialCategoryId:"",materialCategoryIds:[],materialCategoryNames:[],inStock:[]}),m=S({stationOrganId:"",warehouseId:"",materialId:""});function $(t,e){if(e.length==0)m.stationOrganId="0",m.warehouseId="0",m.materialId="0";else{let n=e[0];m.stationOrganId=n.stationOrganId,m.warehouseId=n.warehouseId,m.materialId=n.materialId}be(),setTimeout(()=>{xe()},200)}const E=S({}),[ie,{getForm:P,reload:se,getDataSource:ue,selectTableRow:de,setProps:me}]=j({title:"库存结存",api:Ve,columns:Le,formConfig:{labelWidth:120,schemas:Qe},useSearchForm:!1,bordered:!0,beforeFetch(t){return t.stationOrganId=o.stationOrganId,t.stationId=o.stationId,t.materialName=o.materialName,t.warehouseType=o.warehouseType,o.materialCategoryIds.length>0&&(t.materialCategoryId=o.materialCategoryIds.join(",")),o.inStock.length>0&&o.inStock.join(",")=="1"&&(t.inStock=!0),C(t,E),t},maxHeight:s.value?204:224,rowSelection:{type:"radio",onChange:$},sortFn:t=>{var n;const e=(n=t.order)==null?void 0:n.replace("end","");E.sortOrder=e,E.sortField=e?H(t.field):void 0},showTableSetting:!0,tableSetting:{fullScreen:!0},showIndexColumn:!0});function ce(){return f(this,null,function*(){h.createConfirm({title:d("common.exportTitle"),iconType:"warning",content:d("common.exportMessage"),onOk(){return f(this,null,function*(){let e=P().getFieldsValue()||{};C(e,o),yield Ae(e).then(n=>{X(n==null?void 0:n.data,"库存结存.xls")}),h.success(d("common.exportSuccessText"))})}})})}const M=S({}),[pe,{reload:be,setProps:ge}]=j({api:He,target:".bottom-table-content",targetTabKey:"1",targetTabValue:z,columns:$e,useSearchForm:!1,bordered:!0,immediate:!1,beforeFetch(t){return t.stationOrganId=m.stationOrganId,t.warehouseId=m.warehouseId,t.materialId=m.materialId,C(t,M),t},maxHeight:s.value?204:224,sortFn:t=>{var n;const e=(n=t.order)==null?void 0:n.replace("end","");M.sortOrder=e,M.sortField=e?H(t.field):void 0},showTableSetting:!1,tableSetting:{fullScreen:!0},showIndexColumn:!0});function fe(){return f(this,null,function*(){h.createConfirm({title:d("common.exportTitle"),iconType:"warning",content:d("common.exportMessage"),onOk(){return f(this,null,function*(){let e=P().getFieldsValue()||{};C(e,m),yield je(e).then(n=>{X(n==null?void 0:n.data,"入库明细.xls")}),h.success(d("common.exportSuccessText"))})}})})}const B=S({}),[he,{reload:xe,setProps:ye}]=j({api:Ke,target:".bottom-table-content",targetTabKey:"2",targetTabValue:z,columns:Ze,useSearchForm:!1,bordered:!0,immediate:!1,beforeFetch(t){return t.stationOrganId=m.stationOrganId,t.warehouseId=m.warehouseId,t.materialId=m.materialId,C(t,B),t},maxHeight:s.value?204:224,sortFn:t=>{var n;const e=(n=t.order)==null?void 0:n.replace("end","");B.sortOrder=e,B.sortField=e?H(t.field):void 0},showTableSetting:!1,tableSetting:{fullScreen:!0},showIndexColumn:!0});function we(){return f(this,null,function*(){h.createConfirm({title:d("common.exportTitle"),iconType:"warning",content:d("common.exportMessage"),onOk(){return f(this,null,function*(){let e=P().getFieldsValue()||{};C(e,m),yield Xe(e).then(n=>{X(n==null?void 0:n.data,"出库明细.xls")}),h.success(d("common.exportSuccessText"))})}})})}const Ie=()=>{s.value=!s.value,setTimeout(()=>{me({maxHeight:s.value?204:224}),ge({maxHeight:s.value?204:224}),ye({maxHeight:s.value?204:224})},300)};return ke(()=>{_&&_.warehouseType&&(o.warehouseType=_.warehouseType),q(),oe(),T()}),(t,e)=>{const n=p("a-input"),g=p("a-form-item"),c=p("a-col"),v=p("a-select"),U=p("a-checkbox"),_e=p("a-checkbox-group"),Z=p("a-row"),O=p("a-button"),ve=p("a-form"),G=p("a-tab-pane"),Ce=p("a-tabs");return D(),J(l(We),{dense:"",contentFullHeight:"",contentClass:"flex",style:{position:"relative"}},{default:r(()=>[x("div",Ge,[x("div",Je,[a(ve,{model:o,autocomplete:"off"},{default:r(()=>[a(Z,null,{default:r(()=>[a(c,{flex:"78%"},{default:r(()=>[a(Z,{gutter:32},{default:r(()=>[a(c,{span:8},{default:r(()=>[a(g,{name:"materialName",label:"物料名称",labelCol:{style:{width:"120px"}},colon:!1},{default:r(()=>[a(n,{value:o.materialName,"onUpdate:value":e[0]||(e[0]=u=>o.materialName=u),maxlength:"64"},null,8,["value"])]),_:1})]),_:1}),a(c,{span:8},{default:r(()=>[a(g,{name:"warehouseType",label:"库房类型",labelCol:{style:{width:"120px"}},colon:!1},{default:r(()=>[a(Me,{type:"warehouse_type",onChange:e[1]||(e[1]=u=>"()=> seachFormState.warehouseType = value"),value:o.warehouseType,"onUpdate:value":e[2]||(e[2]=u=>o.warehouseType=u),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),l(R)().isMultiOrganization?(D(),J(c,{key:0,span:8},{default:r(()=>[a(g,{name:"stationOrganId",label:"所属公司",labelCol:{style:{width:"120px"}},colon:!1},{default:r(()=>[a(Fe,{value:o.stationOrganId,"onUpdate:value":e[3]||(e[3]=u=>o.stationOrganId=u),api:ae},null,8,["value"])]),_:1})]),_:1})):ze("",!0),W(a(c,{span:8},{default:r(()=>[a(g,{name:"stationId",label:"电站",labelCol:{style:{width:"120px"}},colon:!1},{default:r(()=>[a(v,{value:o.stationId,"onUpdate:value":e[4]||(e[4]=u=>o.stationId=u),allowClear:"",options:b.value,placeholder:"请选择电站"},null,8,["value","options"])]),_:1})]),_:1},512),[[V,l(R)().isMultiOrganization&&s.value||!l(R)().isMultiOrganization]]),W(a(c,{span:8},{default:r(()=>[a(g,{label:"物料类别",name:"materialCategoryNames",labelCol:{style:{width:"120px"}},colon:!1},{default:r(()=>[a(qe,{value:o.materialCategoryNames,"onUpdate:value":e[5]||(e[5]=u=>o.materialCategoryNames=u),skeys:o.materialCategoryIds,"onUpdate:skeys":e[6]||(e[6]=u=>o.materialCategoryIds=u),multiple:!0,tfields:{key:"id",title:"name",children:"children"},data:Q.value,"expand-all":!0,onSelect:re},null,8,["value","skeys","data"])]),_:1})]),_:1},512),[[V,s.value]]),W(a(c,{span:8},{default:r(()=>[a(g,{name:"inStock",labelCol:{style:{width:"120px"}}},{default:r(()=>[x("div",Ye,[a(_e,{value:o.inStock,"onUpdate:value":e[7]||(e[7]=u=>o.inStock=u)},{default:r(()=>[a(U,{value:"1",name:"inStock"},{default:r(()=>[y("只显示库存>0")]),_:1})]),_:1},8,["value"])])]),_:1})]),_:1},512),[[V,s.value]])]),_:1})]),_:1}),a(c,{flex:"22%"},{default:r(()=>[a(g,{class:"tab-button",style:{"text-align":"right"}},{default:r(()=>[a(O,{class:"tab-button",onClick:le},{default:r(()=>[y(k(l(d)("common.resetText")),1)]),_:1}),a(O,{type:"primary",class:"tab-button",onClick:ne},{default:r(()=>[y(k(l(d)("common.queryText")),1)]),_:1}),x("a",{style:{"font-size":"12px"},onClick:Ie},[s.value?(D(),Y(ee,{key:0},[y(" 收起 "),a(l(Ee))],64)):(D(),Y(ee,{key:1},[y(" 展开 "),a(l(Pe))],64))])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),x("div",{class:te(["tab-table-div",s.value?"fix-table-height":""])},[x("div",et,[a(l(A),{onRegister:l(ie),onResizeColumn:e[8]||(e[8]=(u,Te)=>Te.width=u),class:"fix-basic-table"},{toolbar:r(()=>[a(O,{class:"yellow-btn",preIcon:l(K).EXPORT,onClick:ce},{default:r(()=>[y(k(l(d)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])])],2),x("div",{class:te(["tab-table-div",s.value?"fix-table-height":""])},[x("div",tt,[a(Ce,{activeKey:z.value,"onUpdate:activeKey":e[9]||(e[9]=u=>z.value=u)},{default:r(()=>[a(G,{key:"1",tab:"入库明细"},{default:r(()=>[a(l(A),{onRegister:l(pe)},{toolbar:r(()=>[a(O,{class:"yellow-btn",preIcon:l(K).EXPORT,onClick:fe},{default:r(()=>[y(k(l(d)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])]),_:1}),a(G,{key:"2",tab:"出库明细"},{default:r(()=>[a(l(A),{onRegister:l(he)},{toolbar:r(()=>[a(O,{class:"yellow-btn",preIcon:l(K).EXPORT,onClick:we},{default:r(()=>[y(k(l(d)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])]),_:1})]),_:1},8,["activeKey"])])],2)])]),_:1})}}});const Nt=Re(at,[["__scopeId","data-v-832a0171"]]);export{Nt as default};
//# sourceMappingURL=index-fb3715d9.js.map
