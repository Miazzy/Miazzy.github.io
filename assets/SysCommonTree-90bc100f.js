var W=Object.defineProperty;var R=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var B=(t,l,r)=>l in t?W(t,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[l]=r,O=(t,l)=>{for(var r in l||(l={}))X.call(l,r)&&B(t,r,l[r]);if(R)for(var r of R(l))Y.call(l,r)&&B(t,r,l[r]);return t};var g=(t,l,r)=>new Promise((d,T)=>{var _=s=>{try{m(r.next(s))}catch(a){T(a)}},o=s=>{try{m(r.throw(s))}catch(a){T(a)}},m=s=>s.done?d(s.value):Promise.resolve(s.value).then(_,o);m((r=r.apply(t,l)).next())});import{d as ee,k as i,r as A,w as te,o as ae,al as p,Z as re,_ as ne,f as u,a5 as le,aa as c,v as E,A as U,F as oe}from"./vue-71d1abb3.js";import{C as se}from"./CommonTree-c4ed7838.js";import{a5 as v,b as ie,au as ue,_ as me}from"./index.js";import{x as q}from"./index-66d20ba6.js";import{D as ce}from"./Dialog-0a006d82.js";import{a as fe}from"./assign-37f1c13d.js";import{a2 as f}from"./antd-15ac76ed.js";import"./index-3801a970.js";const pe=t=>v.get({url:"/system/common-tree/getTree",params:t},{}),de=t=>v.get({url:"/system/common-tree/get",params:t},{}),ye=t=>v.post({url:"/system/common-tree/create",params:t},{}),ve=t=>v.put({url:"/system/common-tree/update",params:t},{}),Te=t=>t.id?ve(t):ye(t),_e=t=>v.delete({url:"/system/common-tree/delete",params:t},{}),ge=ee({__name:"SysCommonTree",props:{treeType:{type:String},title:{type:String},toolbar:{type:Boolean},search:{type:Boolean},treeClass:{type:String},beforeDelete:{type:Function,default:()=>!0}},emits:["select","afterSave"],setup(t,{emit:l}){const r=t,{t:d}=ie(),{createConfirm:T}=ue(),_=i([]),o=A({open:{type:i(!1),index:i(!1)},title:{type:i(""),index:i("")}}),m=i(!1),s=i(!1),a=A({id:"",name:"",fullId:"",remark:"",fullName:"",parentId:"",checkItem:"",description:"",parentName:"",parentFullId:"",parentFullName:"",kindId:"",readOnly:!1}),M=i(),h=i(),z=i();function x(){return g(this,null,function*(){const e=yield pe({treeType:r.treeType});_.value=e.result})}function L(e){if(a.id="",a.parentId="root",a.fullId="",a.parentName="",a.parentFullName="",a.name="",a.remark="",e)a.parentId=e.id,a.parentName=e.name,a.fullId=e.fullId,a.parentFullName=e.fullName,a.kindId=e.kindId;else{f.error("请选择要添加的节点。");return}const n=F(a);C(e)&&(o.open.type=!0,o.title.type=n+r.title)}function S(e){return e?!0:(f.error("请选择"+r.title+"节点"),!1)}function $(e){if(!S(e))return;const n=F({id:e.id});if(e.parentId==="root"){f.error(`父节点，不能${n}`);return}if(e.children.length>0){f.error("该"+r.title+`存在子节点，不能${n}`);return}C(e)&&(de({id:e.id}).then(k=>{fe(a,k.result)}),o.open.type=!0,o.title.type=n+r.title)}function C(e,n){return!0}function I(e){l("afterSave",e)}const H=e=>g(this,null,function*(){if(!S(e))return;if(e.children.length>0)return f.error("该"+r.title+"存在子节点，不能删除"),!1;let n=!0;r.beforeDelete&&(n=yield r.beforeDelete(e)),n&&V(function(){_e("?id="+e.id).then(()=>{b()})})});function V(e){T({title:d("common.message.confirmTitle"),iconType:"warning",content:d("common.message.delMessage"),onOk(){return g(this,null,function*(){yield e(),f.success(d("common.delSuccessText"))})}})}function b(){x()}function Z(){let e=h.value;e&&e.validateFields().then(()=>{m.value=!0,a.fullName=j();let n=F(a);Te(a).then(()=>{f.success(n+"成功"),I(O({},a)),N(),b(),o.open.type=!1,m.value=!1}).catch(()=>{m.value=!1})})}function F(e){return e.id?"修改":"添加"}function j(){let e=a.parentFullName;return e?e+"/"+q.trim(a.name):q.trim(a.name)}function G(){N(),o.open.type=!1}function N(){var e,n;(e=h.value)==null||e.resetFields(),(n=z.value)==null||n.resetFields()}function J(e){l("select",e)}return te(()=>r.treeType,()=>{x()}),ae(()=>{r.treeType&&x()}),(e,n)=>{const k=p("a-input"),w=p("a-form-item"),D=p("a-col"),K=p("a-textarea"),P=p("a-row"),Q=p("a-form");return re(),ne(oe,null,[u(se,{treeType:t.treeType,title:t.title,toolbar:t.toolbar,search:t.search,class:le(t.treeClass),ref_key:"treeRef",ref:M,style:{"font-size":"1px"},onSelect:J,value:_.value,isShowOperationBtns:!0,fieldNames:{key:"id",title:"name"},onAdd:L,onEdit:$,onDelete:H,onRefresh:b,onAfterSave:I},null,8,["treeType","title","toolbar","search","class","value"]),u(ce,{visible:o.open.type,"onUpdate:visible":n[2]||(n[2]=y=>o.open.type=y),title:o.title.type,maskClosable:!1,onOk:Z,onCancel:G,height:350,width:600},{default:c(()=>[u(Q,{ref_key:"modalFormRef",ref:h,model:a,name:"userForm"},{default:c(()=>[u(P,{gutter:24},{default:c(()=>[E(u(D,{span:23},{default:c(()=>[u(w,{label:"类型名称",name:"name",labelCol:{span:6},rules:[{required:!0,max:30}]},{default:c(()=>[u(k,{value:a.name,"onUpdate:value":n[0]||(n[0]=y=>a.name=y),maxlength:30,disabled:s.value,style:{"margin-top":"10px"}},null,8,["value","disabled"])]),_:1})]),_:1},512),[[U,!0]]),E(u(D,{span:23},{default:c(()=>[u(w,{label:"备注",name:"remark",labelCol:{span:6},rules:[{required:!1,max:250}]},{default:c(()=>[u(K,{value:a.remark,"onUpdate:value":n[1]||(n[1]=y=>a.remark=y),maxlength:250,disabled:s.value,rows:5},null,8,["value","disabled"])]),_:1})]),_:1},512),[[U,!0]])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])],64)}}});const we=me(ge,[["__scopeId","data-v-33ecac32"]]);export{we as default};
//# sourceMappingURL=SysCommonTree-90bc100f.js.map
