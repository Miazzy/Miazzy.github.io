var d=(n,e,t)=>new Promise((c,b)=>{var y=r=>{try{o(t.next(r))}catch(a){b(a)}},v=r=>{try{o(t.throw(r))}catch(a){b(a)}},o=r=>r.done?c(r.value):Promise.resolve(r.value).then(y,v);o((t=t.apply(n,e)).next())});import{B as W}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as H}from"./useTable-109483b3.js";import{K as S}from"./antd-15ac76ed.js";import{a0 as A,a5 as x,aj as X,b as Z,au as $,bA as G,av as J,_ as Q}from"./index.js";import"./index-d8a2358f.js";import{e as ee}from"./download-03e71dd5.js";import{u as te,B as ae}from"./useForm-dea3ed18.js";import{d as ne,k as m,r as ie,o as oe,q as re,al as _,Z as le,_ as se,$ as I,f as p,u as h,aa as g,E as de,ad as ce,a6 as ue}from"./vue-71d1abb3.js";import{i as me}from"./install-58e0bd81.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./uniqBy-92d3bc7f.js";const pe=n=>x.get({url:"/bi/common/org/info",params:n},{isOnlyResult:!0}),he=n=>x.post({url:"/baseset/common/list-station",params:n}),ge=n=>x.post({url:"/bi/inspection/export-excel",params:n,responseType:"blob"},{isReturnNativeResponse:!0});function M(n){return x.post({url:"/bi/inspection/list",params:n})}const R=[{title:"所属公司",dataIndex:"stationOrganName",width:160,resizable:!0,align:"left",headAlign:"center",customCell:(n,e,t)=>({rowSpan:n.rowSpan}),ifShow:A().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",width:160,align:"left",headAlign:"center",resizable:!0},{title:"应巡检数",dataIndex:"should",width:100,resizable:!0,children:[{title:"光伏区",dataIndex:"shouldPvAreaDev",align:"right",headAlign:"center",width:80,resizable:!0},{title:"升压站",dataIndex:"shouldBoostDev",align:"right",headAlign:"center",width:80,resizable:!0},{title:"小计",dataIndex:"shouldTotal",align:"right",headAlign:"center",width:80,resizable:!0}]},{title:"已巡检数",dataIndex:"done",width:100,resizable:!0,children:[{title:"光伏区",dataIndex:"donePvAreaDev",align:"right",headAlign:"center",width:80,resizable:!0},{title:"升压站",dataIndex:"doneBoostDev",align:"right",headAlign:"center",width:80,resizable:!0},{title:"小计",dataIndex:"doneTotal",align:"right",headAlign:"center",width:80,resizable:!0}]},{title:"未巡检数",dataIndex:"not",width:100,resizable:!0,children:[{title:"光伏区",dataIndex:"notPvAreaDev",align:"right",headAlign:"center",width:80,resizable:!0},{title:"升压站",dataIndex:"notBoostDev",align:"right",headAlign:"center",width:80,resizable:!0},{title:"小计",dataIndex:"notTotal",align:"right",headAlign:"center",width:80,resizable:!0}]},{title:"超期次数",dataIndex:"overTimes",width:100,resizable:!0,children:[{title:"光伏区",dataIndex:"overTimesPvAreaDev",align:"right",headAlign:"center",width:80,resizable:!0},{title:"升压站",dataIndex:"overTimesBoostDev",align:"right",headAlign:"center",width:80,resizable:!0},{title:"小计",dataIndex:"overTimesTotal",align:"right",headAlign:"center",width:80,resizable:!0}]},{title:"巡检异常项",dataIndex:"abnormalTimes",width:100,resizable:!0,children:[{title:"光伏区",dataIndex:"abnormalTimesPvAreaDev",align:"right",headAlign:"center",width:80,resizable:!0},{title:"升压站",dataIndex:"abnormalTimesBoostDev",align:"right",headAlign:"center",width:80,resizable:!0},{title:"小计",dataIndex:"abnormalTimesTotal",align:"right",headAlign:"center",width:80,resizable:!0}]},{title:"及时率(%)",dataIndex:"rectRateInTime",align:"right",headAlign:"center",width:80,resizable:!0},{title:"巡检完成率(%)",dataIndex:"rectRate",align:"right",headAlign:"center",width:80,resizable:!0}],be=String(S().year()),ve=n=>[{field:"dateType",label:"时间维度",component:"Select",defaultValue:"year",componentProps:({formModel:e})=>({allowClear:!1,options:[{value:"year",label:"年度"},{value:"month",label:"月份"},{value:"day",label:"自然日"}],onChange:t=>{e.year="",e["[startMonth, endMonth]"]=[null,null],e["[startDate, endDate]"]=[null,null]}})},{field:"year",label:"发现时间",component:"DatePicker",defaultValue:be,componentProps:{allowClear:!1,format:"YYYY",valueFormat:"YYYY-MM-DD",picker:"year",style:"width: 100%"},show:({values:e})=>e.dateType==="year"},{field:"[startDate, endDate]",label:"发现时间",component:"RangePicker",componentProps:{allowClear:!1,format:"YYYY-MM",valueFormat:"YYYY-MM-DD",picker:"month",placeholder:["开始月份","结束月份"],style:"width: 100%"},show:({values:e})=>e.dateType==="month"},{field:"[startDate, endDate]",label:"发现时间",component:"RangePicker",componentProps:{allowClear:!1,format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",picker:"day",placeholder:["开始日期","结束日期"],style:"width: 100%"},show:({values:e})=>e.dateType==="day"},{field:"stationOrganId",label:"所属公司",component:"ApiSelect",componentProps:({formModel:e})=>({api:()=>d(void 0,null,function*(){return yield pe({})}),onChange:t=>{e.stationIds=[]}}),ifShow:A().isMultiOrganization},{field:"stationId",label:"电站名称",component:"ApiSelect",componentProps:{api:()=>d(void 0,null,function*(){const e=yield he({}),t=[];return e.result&&e.result.length>0&&e.result.forEach(c=>{t.push({value:c.id,label:c.name})}),t}),filterOption:(e,t)=>t.label.toLowerCase().indexOf(e.toLowerCase())>=0}}],fe={class:"tab-model"},xe={class:"tab-button-div"},ye={id:"inspection-tab-content",class:"tab-table-div tab-table-content"},we=ne({__name:"index",setup(n){var C,O;let{params:e}=X();const{t}=Z(),{createConfirm:c,createMessage:b}=$(),y=G();let v;const o=m("statistics"),r=m(!1),a=ie({dateType:"year",year:S(new Date).format("YYYY-MM-DD")}),z=m("#303030");let B=m();e.dateType&&(((C=e.startDate)==null?void 0:C.length)==7&&(e.startDate=e.startDate+"-01"),((O=e.endDate)==null?void 0:O.length)==7&&(e.endDate=e.endDate+"-01"),B.value=[e.startDate,e.endDate]),e.dateType&&Object.assign(a,e);let f=m(0);const s=m({stationNames:[],rectRate:[],notTotal:[]}),k=()=>{const u=y.getTheme;z.value=u.includes("theme1")?"#fefefe":"#303030"},w=()=>{o.value==="statistics"&&V(),o.value==="map"&&Y()},F=u=>{!r.value&&o.value==="map"&&(setTimeout(()=>{Y()},200),r.value=!0)},[N,{resetFields:L,getFieldsValue:T,setFieldsValue:E}]=te({labelWidth:120,baseColProps:{span:8},actionColOptions:{span:24},autoAdvancedLine:1,schemas:ve(),compact:!0,showAdvancedButton:A().isMultiOrganization,resetButtonOptions:{onClick:()=>d(this,null,function*(){yield L(),w()})},submitFunc:()=>(w(),Promise.resolve())}),Y=()=>d(this,null,function*(){Object.assign(a,T());var u=me(document.getElementById("echarMap"));let l=yield M(a);s.value.stationNames=[],s.value.notTotal=[],s.value.rectRate=[],l.result.forEach(i=>{i.isTotal!=="true"&&(s.value.stationNames.push(i.stationName),s.value.rectRate.push(i.rectRate),s.value.notTotal.push(i.notTotal),f.value=Number(i.notTotal)>f.value?Number(i.notTotal):f.value)}),v={tooltip:{trigger:"axis",axisPointer:{crossStyle:{color:"#999"}}},toolbox:{feature:{dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!1}}},legend:{data:["未巡检次数","巡检完成率"],textStyle:{color:z.value},itemWidth:14,itemHeight:10},xAxis:[{type:"category",data:s.value.stationNames,axisPointer:{type:"shadow"},axisLabel:{interval:0}}],yAxis:[{splitLine:{show:!1},type:"value",name:"巡检完成率",min:0,max:100,interval:10,axisLabel:{formatter:"{value} %"}},{splitLine:{show:!1},type:"value",name:"未巡检次数",min:0,max:f.value,interval:50,axisLabel:{formatter:"{value} 次"}}],series:[{name:"巡检完成率",type:"line",tooltip:{valueFormatter:function(i){return i+" %"}},data:s.value.rectRate},{name:"未巡检次数",type:"bar",yAxisIndex:1,tooltip:{valueFormatter:function(i){return i+" 次"}},data:s.value.notTotal}]},u.setOption(v)}),[j,{reload:V}]=H({title:"",target:"#inspection-tab-content",targetTabKey:"statistics",targetTabValue:o,api:()=>d(this,null,function*(){return Object.assign(a,T()),(yield M(a)).result}),columns:R,rowKey:"id",bordered:!0,useSearchForm:!1,pagination:!1});function K(){c({title:t("common.message.confirmTitle"),iconType:"warning",content:t("common.message.exportMessage"),onOk(){return d(this,null,function*(){Object.assign(a,T()),a.filename="巡检统计报表.xls",a.excelList=R,yield ge(a).then(l=>{ee(l==null?void 0:l.data,a.filename)}),a.filename=null,a.excelList=null,b.success(t("common.exportSuccessText"))})}})}return oe(()=>d(this,null,function*(){re(k),e.dataType&&E(e)})),(u,l)=>{const i=_("a-button"),P=_("a-tab-pane"),q=_("a-tabs");return le(),se("div",fe,[I("div",xe,[p(h(ae),{onRegister:h(N),onAdvancedChange:w},null,8,["onRegister"])]),I("div",ye,[p(q,{activeKey:o.value,"onUpdate:activeKey":l[1]||(l[1]=D=>o.value=D),onChange:F},{default:g(()=>[p(P,{key:"statistics",tab:"统计报表"},{default:g(()=>[p(h(W),{onRegister:h(j),onResizeColumn:l[0]||(l[0]=(D,U)=>U.width=D),class:"w-4/4 xl:w-12/12"},{toolbar:g(()=>[p(i,{class:"yellow-btn",preIcon:h(J).EXPORT,onClick:K},{default:g(()=>[de(ce(h(t)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])]),_:1}),p(P,{key:"map",tab:"图表",forceRender:!0},{default:g(()=>[I("div",{id:"echarMap",style:ue({width:"100%",height:"calc(100vh - 148px)"})},null,4)]),_:1})]),_:1},8,["activeKey"])])])}}});const He=Q(we,[["__scopeId","data-v-6e991638"]]);export{He as default};
//# sourceMappingURL=index-c35269f1.js.map
