var d=(T,s,i)=>new Promise((g,n)=>{var o=r=>{try{m(i.next(r))}catch(c){n(c)}},I=r=>{try{m(i.throw(r))}catch(c){n(c)}},m=r=>r.done?g(r.value):Promise.resolve(r.value).then(o,I);m((i=i.apply(T,s)).next())});import{b as V,au as z,a7 as q,av as h,ax as A,aA as K,az as H,_ as W}from"./index.js";import{B as X}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as Z}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{P as j}from"./index-20519caf.js";import{C as G}from"./CommonTree-c4ed7838.js";import{e as J}from"./download-03e71dd5.js";import{c as y,s as U,g as Y,a as ee,b as te,e as ae}from"./operationticket.data-6214dc37.js";import{a as S}from"./assign-37f1c13d.js";import{d as ne,k as x,r as v,o as oe,al as se,Z as ie,a9 as re,aa as p,f,$ as le,u as l,E as b,ad as w}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";import"./useRender-21ce56fb.js";const ce={class:"right-table-layout"},me=ne({__name:"index",setup(T){const{t:s}=V(),i=z(),g=x([]),n=v({}),o=v({}),I=x(!0),m=e=>{const t=N(),a={};return S(a,n),a.sortOrder||(a.sortField="fillinDate",a.sortOrder="desc"),e&&(a.pageNo=t.current,a.pageSize=t.pageSize),a},r=()=>d(this,null,function*(){const e=m(!0);return(yield Y(e)).result}),c=x("操作票"),[C,{reload:_,getPaginationRef:N,getSelectRows:O,clearSelectedRowKeys:k}]=Z({title:c,api:r,columns:y(),useSearchForm:!0,formConfig:U,bordered:!0,rowSelection:{type:"radio"},sortFn:e=>{var a;const t=(a=e.order)==null?void 0:a.replace("end","");n.sortOrder=t,n.sortField=t?e.field:void 0},handleSearchInfoFn(e){return S(n,e),n.startQualifiedTime&&(n.startQualifiedTime=n.startQualifiedTime+" 00:00"),n.endQualifiedTime&&(n.endQualifiedTime=n.endQualifiedTime+" 23:59"),e},showTableSetting:!0,tableSetting:{fullScreen:!0},showIndexColumn:!0});function P(){if(!o.stationId){i.error("请选择电站组织");return}A(`/po/ticket/operationticket/create?stationId=${o.stationId}&stationName=${o.stationName}&stationOrganId=${o.stationOrganId}
      &stationOrganName=${o.stationOrganName}`,F())}function D(){const e=O();return e.length==0?(i.error("请选择一行数据"),!1):e[0]}const $=()=>d(this,null,function*(){var a,u;const e=D();if(!e)return;if(yield i.delConfirm(),e.status!=0){i.error(s("common.message.delNotDraftMessage"));return}const t=yield ee({id:e.id});yield K((u=(a=t.result)==null?void 0:a.processVariable)==null?void 0:u.processInstanceId),i.success(s("common.delSuccess")),k(),_()});function E(e){H(e.id,c.value)}const F=e=>{const t=c.value;return e!=null&&e.id?(e==null?void 0:e.status)===0?`${s("common.action.edit")}${t}`:(e==null?void 0:e.status)===1||(e==null?void 0:e.status)===6?`审批${t}`:`查看${t}`:`${s("common.action.create")}${t}`};function R(){return d(this,null,function*(){const e=yield te({});g.value=e.result})}function B(e){n.stationOrganId=null,n.stationId=null,o.stationId="",o.stationName="",o.stationOrganId="",o.stationOrganName="",e&&(e.nodeKindId==="org"&&(n.stationOrganId=e.id),e.nodeKindId==="station"&&(n.stationId=e.powerStationId,o.stationId=e.powerStationId,o.stationName=e.powerStationName,o.stationOrganId=e.organId,o.stationOrganName=e.organName)),_()}function L(){i.createConfirm({title:s("common.message.confirmTitle"),iconType:"warning",content:s("common.message.exportMessage"),onOk(){return d(this,null,function*(){const t=m(!1);t.filename=`${c.value}.xls`,t.excelList=y(),yield ae(t).then(a=>{J(a==null?void 0:a.data,t.filename)}),i.success(s("common.exportSuccessText"))})}})}function M({rows:e}){I.value=e.length===0}return oe(()=>{R(),q.getInstance().listen("operation-ticket",_)}),(e,t)=>{const a=se("a-button");return ie(),re(l(j),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:p(()=>[f(G,{title:"电站组织",onSelect:B,value:g.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),le("div",ce,[f(l(X),{onRegister:l(C),class:"fix-basic-table",searchInfo:n,onResizeColumn:t[0]||(t[0]=(u,Q)=>Q.width=u),onRowDbClick:t[1]||(t[1]=u=>E(u)),onSelectionChange:M},{toolbar:p(()=>[f(a,{type:"primary",preIcon:l(h).ADD,onClick:P},{default:p(()=>[b(w(l(s)("common.action.create")),1)]),_:1},8,["preIcon"]),f(a,{disabled:I.value,class:"red-btn",preIcon:l(h).DELETE,onClick:$},{default:p(()=>[b(w(l(s)("common.delText")),1)]),_:1},8,["disabled","preIcon"]),f(a,{class:"yellow-btn",preIcon:l(h).EXPORT,onClick:L},{default:p(()=>[b(w(l(s)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister","searchInfo"])])]),_:1})}}});const ze=W(me,[["__scopeId","data-v-27003814"]]);export{ze as default};
//# sourceMappingURL=index-970e8c86.js.map
