var u=(M,k,t)=>new Promise((c,f)=>{var g=l=>{try{v(t.next(l))}catch(m){f(m)}},i=l=>{try{v(t.throw(l))}catch(m){f(m)}},v=l=>l.done?c(l.value):Promise.resolve(l.value).then(g,i);v((t=t.apply(M,k)).next())});import{d as V,k as y,r as N,o as U,b as W,Z as j,_ as F,v as R,A as $,$ as r,ad as L,E as w,aF as q}from"./vue-71d1abb3.js";import{a5 as J,B as K,a7 as p,aa as Q,ab as X,_ as Y}from"./index.js";import{s as ee}from"./station-5523435f.js";import{a as I}from"./index.esm-c216ed00.js";import"./antd-15ac76ed.js";const ae=M=>J.post({url:"/da/group-operation/overview/station/info",params:M},{}),te={ewc:{online:"/images/work_card_online.svg",leave:"/images/work_card_leave.svg",offline:"/images/work_card_offline.svg"},dr:{online:"/images/dashcam_online.svg",leave:"/images/dashcam_leave.svg",offline:"/images/dashcam_offline.svg"},ii:{online:"/images/itinerant_detector_online.svg",leave:"/images/itinerant_detector_leave.svg",offline:"/images/itinerant_detector_offline.svg"}},ne={class:"satellite-map"},oe=q('<div id="map-container" class="map-container" data-v-87f94061></div><div class="mask-left" data-v-87f94061></div><div class="mask-top" data-v-87f94061></div><div class="mask-right" data-v-87f94061></div><div class="mask-bottom" data-v-87f94061></div>',5),se={class:"station-modal"},ie={class:"station-img-box"},le=["src"],re={class:"info-box"},ce={class:"station-data-box"},de={class:"data-item"},pe={class:"blue-text"},ve={class:"data-item"},ue={class:"blue-text"},ge=V({__name:"SatelliteMap",setup(M,{expose:k}){const t=y(),c=y(),f=K(),g=y(!1),i=N({}),v=()=>{t.value=new BMapGL.Map("map-container"),t.value.enableScrollWheelZoom(!0),t.value.setMapType(BMAP_EARTH_MAP),t.value.centerAndZoom(new BMapGL.Point(118.8,37.5),8)},l=(a,e)=>{let o={position:a,offset:new BMapGL.Size(15,-30)},n=new BMapGL.Label(e,o);return n.setStyle({width:"auto !important",color:"white",fontSize:"12px",backgroundColor:"rgba(0,0,0, 0.7)",border:0,padding:"3px 10px",borderRadius:"4px",lineHeight:1.5}),n},m=()=>{f({path:"/stationOperation",query:{id:i.bizUuid}})},x=(a,e)=>{let o=new BMapGL.Icon(ee,new BMapGL.Size(30,30),{anchor:new BMapGL.Size(15,30)}),n=new BMapGL.Marker(a,{icon:o});t.value.addOverlay(n),n.onclick=()=>u(this,null,function*(){I(i,{}),g.value=!0;const d=yield Q({bizId:e.bizFileId});d.length>0&&(i.url=X(d[0].url)),I(i,e)});let s=l(a,e.name);t.value.addOverlay(s)},B=()=>u(this,null,function*(){var e;let a=yield ae({});_(),(e=a.result)!=null&&e.length&&a.result.forEach(n=>{let s=new BMapGL.Point(n.longitude,n.latitude);x(s,n)})}),b=(a,e,o)=>{let n=new BMapGL.Icon(te[o][e.status],new BMapGL.Size(30,44),{anchor:new BMapGL.Size(15,44)}),s=new BMapGL.Marker(a,{icon:n});t.value.addOverlay(s),s.onclick=()=>u(this,null,function*(){p.getInstance().sendMsg("smart-device-modal-info",{type:o,record:e})});const d=l(a,e.stationShortName);s.onmouseover=()=>{t.value.addOverlay(d)},s.onmouseout=()=>{t.value.removeOverlay(d)}};let O=new BMapGL.Geocoder;const G=a=>{O.getLocation(new BMapGL.Point(a.longitude,a.latitude),function(e){e&&(a.address=e.address)})},z=o=>u(this,[o],function*({type:a,data:e}){_(),t.value.centerAndZoom(new BMapGL.Point(112,34),5),e!=null&&e.length&&e.forEach(n=>{if(G(n),n.status==="online"){const s=new BMapGL.Point(n.longitude,n.latitude);b(s,n,a)}})}),D=({type:a,record:e})=>{p.getInstance().sendMsg("smart-device-modal",!1),G(e),t.value.getZoom();const o=new BMapGL.Point(e.longitude,e.latitude);t.value.centerAndZoom(o,14),b(o,e,a)},A=({trackParams:a,data:e})=>{switch(a.type){case"track":Z(a,e);break;case"replay":c.value.setDuration(a.duration),c.value.start();break;case"pause":c.value.pause();break;case"continue":c.value.continue();break;case"cancel":c.value.cancel();break}},E=(a,e)=>{const o=new BMapGL.Point(a,e);let n=new BMapGL.Icon("/images/marker_start.png",new BMapGL.Size(30,50),{anchor:new BMapGL.Size(15,50)}),s=new BMapGL.Marker(o,{icon:n});t.value.addOverlay(s)},T=(a,e)=>{const o=new BMapGL.Point(a,e);let n=new BMapGL.Icon("/images/marker_end.png",new BMapGL.Size(30,50),{anchor:new BMapGL.Size(15,50)}),s=new BMapGL.Marker(o,{icon:n});t.value.addOverlay(s)},_=()=>{t.value.clearOverlays()},Z=(a,e)=>u(this,null,function*(){_(),E(e[0].longitude,e[0].latitude),T(e[e.length-1].longitude,e[e.length-1].latitude);let o=[];e.forEach(d=>{const H=new BMapGL.Point(d.longitude,d.latitude);o.push(H)});const n=new BMapGL.Polyline(o,S("blue"));t.value.addOverlay(n);const s=new BMapGL.Polyline(o,S("green"));c.value=new BMapGLLib.TrackAnimation(t.value,s,{overallView:!0,tilt:30,duration:a.trackDuration,delay:0})}),S=a=>({enableEditing:!1,enableClicking:!0,icons:[],strokeStyle:"dashed",strokeColor:a,strokeWeight:8,strokeOpacity:.8,strokeTexture:{url:`https://mapopen-pub-jsapigl.bj.bcebos.com/svgmodel/Icon_road_${a}_arrow.png`,width:16,height:64}}),C=()=>{p.getInstance().listen("smart-device-all-point-mark",z),p.getInstance().listen("smart-device-point-mark",D),p.getInstance().listen("smart-device-track",A),p.getInstance().listen("smart-device-clear-overlays",_),p.getInstance().listen("smart-device-reload-map",({type:a})=>{a!=4?B():_()})},P=a=>{a.target.classList.contains("BMap_noprint")||(a.target.closest(".satellite-map")||a.target.closest(".footer.footer-layout"))&&(g.value=!1)},h=()=>{var a;try{const e=document.getElementById("map-container");t.value&&((a=t.value)==null||a.destroy(),t.value=null),e&&(e.innerHTML="")}catch(e){console.error("destory map error:",e)}};return k({destory:h,initMap:v}),U(()=>{h(),v(),B(),C(),window.addEventListener("click",P)}),W(()=>{h(),window.removeEventListener("click",P)}),(a,e)=>(j(),F("div",ne,[oe,R(r("div",se,[r("div",ie,[r("img",{src:i.url},null,8,le)]),r("div",re,[r("div",{class:"station-name",onClick:m},L(i.name),1),r("div",ce,[r("div",de,[w(" 今日发电量 "),r("span",pe,L(i.outputPowerDay),1),w(" 万kWh ")]),r("div",ve,[w(" 实时功率 "),r("span",ue,L(i.activePower),1),w(" MW ")])])])],512),[[$,g.value]])]))}});const he=Y(ge,[["__scopeId","data-v-87f94061"]]);export{he as default};
//# sourceMappingURL=SatelliteMap-2f4f1ab2.js.map
