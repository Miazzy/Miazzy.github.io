{"version":3,"file":"index-5ab987ff.js","sources":["../../src/views/po/drone/droneautoinspection/index.ts","../../src/views/po/drone/droneautoinspection/index.vue"],"sourcesContent":["import { defHttp } from '/@/utils/http/axios';\nimport { BasicColumn } from '/@/components/Table';\nimport { reactive, ref } from 'vue';\n\nenum Api {\n  treeData = '/baseset/common/list-orgStationTree',\n  areaList = '/po/drone-archive/droneStatusPage',\n  getPageUrl = '/po/droneinspection/getPageUrl',\n}\n\nexport function getDroneInspectionListColumns(options: any[]): BasicColumn[] {\n  return [\n    {\n      title: '电站',\n      dataIndex: 'useStationName',\n      width: 160,\n      resizable: true,\n      sorter: true,\n      headAlign: 'center',\n      align: 'left',\n    },\n    {\n      title: '编号',\n      dataIndex: 'code',\n      width: 160,\n      sorter: true,\n      resizable: true,\n      headAlign: 'center',\n      align: 'left',\n    },\n    {\n      title: '机场类别',\n      dataIndex: 'droneTypeText',\n      width: 160,\n      headAlign: 'center',\n      align: 'left',\n      resizable: true,\n      sorter: true,\n    },\n    {\n      title: 'SN编码',\n      dataIndex: 'snNumber',\n      width: 160,\n      headAlign: 'center',\n      align: 'center',\n      resizable: true,\n      sorter: true,\n    },\n    {\n      title: '机场描述',\n      dataIndex: 'airportDescribe',\n      width: 160,\n      headAlign: 'center',\n      align: 'center',\n      resizable: true,\n      sorter: true,\n    },\n    {\n      title: '状态',\n      dataIndex: 'droneOnlineStatus',\n      width: 160,\n      resizable: true,\n      sorter: true,\n    },\n  ];\n}\n// 列表表头\n\nexport interface DeptListItem {\n  id: string;\n  orderNo: string;\n  createTime: string;\n  remark: string;\n  status: number;\n}\n\n// 组织树数据\nexport const getTreeData = (params) =>\n  defHttp.post(\n    {\n      url: Api.treeData,\n      params,\n    },\n    {},\n  );\n\n// 列表数据\nexport const getDroneInspectionList = (params) =>\n  defHttp.get(\n    {\n      url: Api.areaList,\n      params,\n    },\n    {},\n  );\n\nexport const getPageUrl = (params) =>\n  defHttp.get(\n    {\n      url: Api.getPageUrl,\n      params,\n    },\n    {},\n  );\n\n// Form表单对象\nexport const detailFormState = reactive({ spinning: false });\nexport const formState = reactive({\n  spinning: false,\n});\n","<template>\n  <div>\n    <PageWrapper dense contentFullHeight fixedHeight contentClass=\"flex\" style=\"position: relative\">\n      <!-- 电站组织树 -->\n\n      <CommonTree\n        title=\"电站组织\"\n        @select=\"handleSelect\"\n        :value=\"treeData\"\n        class=\"left-tree-layout\"\n        :toolbar=\"true\"\n        :canEdit=\"false\"\n        :canAdd=\"false\"\n        :canDelete=\"false\"\n        :isShowOperationBtns=\"false\"\n        :fieldNames=\"{ key: 'id', title: 'name' }\"\n      />\n\n      <!-- 数据表格 -->\n      <div class=\"right-table-layout\">\n        <BasicTable\n          class=\"fix-basic-table\"\n          @register=\"registerTable\"\n          :searchInfo=\"searchInfo\"\n          @resize-column=\"(w, col) => (col.width = w)\"\n          @row-db-click=\"(record) => handleAdvice(record)\"\n        >\n          <template #bodyCell=\"{ column, text }\">\n            <template v-if=\"column.dataIndex === 'droneOnlineStatus'\">\n              <span style=\"color: green\" v-if=\"text == true\">在线</span>\n              <span style=\"color: red\" v-if=\"text == false\">离线</span>\n            </template>\n          </template>\n          <template #action=\"{ record }\">\n            <TableAction :actions=\"getAction(record)\" />\n          </template>\n        </BasicTable>\n      </div>\n    </PageWrapper>\n  </div>\n  <!-- <settlemenElecModal @reload=\"handleReload\" @register=\"registerDrawer\" /> -->\n</template>\n<script lang=\"ts\" setup>\n  import type { FormProps } from '/@/components/Form/src/types/form';\n  import { onMounted, reactive, ref, toRaw } from 'vue';\n  import { BasicTable, useTable, TableAction, SorterResult } from '/@/components/Table';\n  import { TreeItem } from '/@/components/Tree';\n  import { PageWrapper } from '/@/components/Page';\n  import CommonTree from '@/components/Framework/Tree/CommonTree.vue';\n  import { SelectProps } from 'ant-design-vue';\n\n  import {\n    getDroneInspectionList,\n    getTreeData,\n    formState,\n    getDroneInspectionListColumns,\n    getPageUrl,\n  } from './index';\n\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { addTabPage } from '@/utils/route';\n  import { assign } from 'lodash-es';\n\n  const { t } = useI18n();\n  const searchInfo = reactive<any>({}); // 查询信息\n  const treeData = ref<TreeItem[]>([]); // 左侧电站树数据\n  const periodParam = ref({}); // 查询分期下拉框数据的参数\n\n  const checkedKeys = ref<Array<string | number>>([]); // 复选框的选择的数据\n  const options = ref<SelectProps['options']>([]); //电站分期\n  const areaColumn = getDroneInspectionListColumns(options);\n\n  const indexList = ref<Array<any>>([]);\n  const getDroneInspectionListByParam = async () => {\n    let areaList = await getDroneInspectionList(searchInfo);\n    indexList.value = areaList.result;\n    return areaList.result;\n  };\n  let selectedRowId = ref('');\n  const searchForm: FormProps = {\n    showAdvancedButton: false,\n    baseColProps: { span: 8 },\n    labelWidth: 120,\n    autoAdvancedLine: 1,\n    schemas: [\n      {\n        field: 'droneOnlineStatus',\n        label: '状态',\n        component: 'DictSelectBox',\n        componentProps: {\n          type: 'droneOnlineStatus',\n        },\n      },\n    ],\n  };\n  const [registerTable, { reload, getPaginationRef }] = useTable({\n    title: '无人机列表',\n    api: async () => {\n      const paginationRef = getPaginationRef() as any;\n      searchInfo.pageNo = paginationRef.current;\n      searchInfo.pageSize = paginationRef.pageSize;\n      let dataObj = await getDroneInspectionListByParam();\n      return dataObj;\n    },\n    columns: areaColumn,\n    useSearchForm: true,\n    formConfig: searchForm,\n    showTableSetting: true,\n    bordered: true,\n    rowKey: 'id',\n    rowSelection: {\n      type: 'radio',\n      onChange: onSelect,\n    },\n    handleSearchInfoFn(info) {\n      assign(searchInfo, info);\n      return info;\n    },\n    sortFn: (sortInfo: SorterResult) => {\n      if (sortInfo.order) {\n        searchInfo.sortField = sortInfo.field;\n        searchInfo.sortOrder = sortInfo.order.replace('end', '');\n      } else {\n        searchInfo.sortField = null;\n        searchInfo.sortOrder = null;\n      }\n    },\n    actionColumn: {\n      width: 200,\n      title: '操作',\n      dataIndex: 'action',\n      slots: { customRender: 'action' },\n    },\n  });\n\n  const getAction = (record: any) => {\n    return [\n      {\n        label: '查看',\n        icon: 'mdi:eye-outline',\n        onClick: handleAdvice.bind(null, record),\n      },\n    ];\n  };\n\n  const handleAdvice = (record) => {\n    const param = {\n      snNumber: record.snNumber,\n    };\n\n    getPageUrl(param).then((data) => {\n      var form = {\n        content: data.result,\n      };\n\n      addTabPage(`/po/drone/droneinspection/content`, '查看巡检详情', toRaw(form));\n    });\n  };\n\n  function onSelect(record, selected) {\n    if (selected.length > 0) {\n      checkedKeys.value = [record[0]];\n      selectedRowId.value = record[0];\n    } else {\n      checkedKeys.value = [];\n      selectedRowId.value = '';\n    }\n  }\n\n  // 查询左侧电站树数据\n  async function queryDeptTreeList() {\n    const deptList = (await getTreeData({})) as unknown as TreeItem[];\n    treeData.value = deptList.result;\n    reload();\n  }\n\n  // 根据电站id获取分期信息\n  // 左侧树状菜单选中事件\n  function handleSelect(node = {}) {\n    searchInfo.stationId = null;\n    searchInfo.stationName = null;\n    searchInfo.stationOrganId = null;\n    searchInfo.stationOrganName = null;\n    searchInfo.nodeKindId = null;\n    periodParam.value.nodeKindId = null;\n    searchInfo.searchId = null;\n    if (node != null) {\n      searchInfo.stationOrganId = node.organId;\n      searchInfo.stationOrganName = node.organName;\n      if (node.nodeKindId == 'station') {\n        searchInfo.stationId = node.powerStationId;\n        searchInfo.stationName = node.name;\n        periodParam.value.stationId = node.powerStationId;\n\n        formState.stationId = searchInfo.stationId;\n        formState.stationName = searchInfo.stationName;\n        formState.stationOrganId = searchInfo.stationOrganId;\n        formState.stationOrganName = searchInfo.stationOrganName;\n      }\n\n      searchInfo.nodeKindId = node.nodeKindId;\n      periodParam.value.nodeKindId = node.nodeKindId;\n      searchInfo.searchId = node.id;\n    }\n\n    reload();\n  }\n\n  // 启动执行代码\n  onMounted(() => {\n    queryDeptTreeList();\n  });\n</script>\n<style lang=\"less\" scoped>\n  .dialog-loading {\n    position: absolute;\n    z-index: 1000 !important;\n    top: 45%;\n    left: 45%;\n  }\n\n  .dialog-mask {\n    position: absolute;\n    z-index: 1001 !important;\n    top: -1px;\n    width: 100%;\n    height: 100%;\n    opacity: 0.3;\n    background: #ccc;\n  }\n\n  .left-tree-layout {\n    flex-shrink: 0;\n    width: 298px;\n    border-radius: 2px;\n  }\n\n  .right-table-layout {\n    width: calc(100% - 308px);\n  }\n\n  .fix-basic-table {\n    :deep(&.vben-basic-table .ant-table-wrapper) {\n      padding: 10px 16px 12px;\n    }\n\n    :deep(.table-settings) {\n      margin-right: 0;\n    }\n\n    :deep(.table-settings .anticon-setting) {\n      margin-right: 0;\n    }\n  }\n</style>\n"],"names":["getDroneInspectionListColumns","options","getTreeData","params","defHttp","getDroneInspectionList","getPageUrl","reactive","formState","useI18n","searchInfo","treeData","ref","periodParam","checkedKeys","areaColumn","indexList","getDroneInspectionListByParam","__async","areaList","selectedRowId","searchForm","registerTable","reload","getPaginationRef","useTable","paginationRef","onSelect","info","assign","sortInfo","getAction","record","handleAdvice","param","data","form","addTabPage","toRaw","selected","queryDeptTreeList","deptList","handleSelect","node","onMounted"],"mappings":"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"}