var J=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var M=(r,n,o)=>n in r?J(r,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[n]=o,S=(r,n)=>{for(var o in n||(n={}))ae.call(n,o)&&M(r,o,n[o]);if(C)for(var o of C(n))ne.call(n,o)&&M(r,o,n[o]);return r},E=(r,n)=>ee(r,te(n));var f=(r,n,o)=>new Promise((m,y)=>{var i=u=>{try{I(o.next(u))}catch(_){y(_)}},s=u=>{try{I(o.throw(u))}catch(_){y(_)}},I=u=>u.done?m(u.value):Promise.resolve(u.value).then(i,s);I((o=o.apply(r,n)).next())});import{b as oe,ak as se,au as ie,a7 as re,av as T,ax as le,aD as ce,az as ue,aA as de,_ as me}from"./index.js";import{B as pe}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as fe}from"./useTable-109483b3.js";import{bC as ge,K as P}from"./antd-15ac76ed.js";import{P as ye}from"./index-20519caf.js";import{C as Ie}from"./CommonTree-c4ed7838.js";import{e as _e}from"./download-03e71dd5.js";import{g as F,s as we,a as he,b as xe,e as ve,c as be}from"./workorder.data-e18a6fd9.js";import{a as Se}from"./assign-37f1c13d.js";import{d as Te,k as w,r as ke,o as Oe,al as h,Z as Ne,a9 as De,aa as l,f as c,$ as Ce,u as d,E as g,ad as k}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";import"./useRender-21ce56fb.js";const Me={class:"right-table-layout"},Ee=Te({__name:"index",setup(r){const{t:n}=oe(),o=se.getInstance().getQuery(),m=ie(),y=w([]);let i=w({stationOrganId:o.stationOrganId,stationId:o.stationId});const s=ke({}),I=w([o.stationOrganId]),u=w(!0),_=e=>{const a=N(),t={};if(Se(t,o,a.getFieldsValue(),i.value),e){const p=B();t.pageNo=p.current,t.pageSize=p.pageSize}return i.value.sortField||(t.sortField="fillinDate",t.sortOrder="desc"),t.status instanceof Array&&t.status.length>0&&(t.status=t.status.join(",")),t.startMonth&&(t.startMonth=P(t.startMonth).format("YYYY-MM")),t.endMonth&&(t.endMonth=P(t.endMonth).format("YYYY-MM")),t.planStartDate&&(t.planStartDate=t.planStartDate+" 00:00"),t.planEndDate&&(t.planEndDate=t.planEndDate+" 23:59"),t},K=()=>f(this,null,function*(){const e=_(!0);return(yield he(e)).result}),O=w("工单管理"),[R,{reload:x,getPaginationRef:B,getForm:N,getSelectRows:Y,clearSelectedRowKeys:$}]=fe({title:O,api:K,columns:F(),useSearchForm:!0,formConfig:we,bordered:!0,rowSelection:{type:"radio"},sortFn:e=>{var t;const a=(t=e.order)==null?void 0:t.replace("end","");i.value.sortOrder=a,i.value.sortField=a?e.field:void 0},showTableSetting:!0,showIndexColumn:!0}),L=e=>{if(!s.periodId){m.warning("请选择电站组织期数节点");return}const a=e.item.title;le("/po/workorder/create",j(null,a),E(S({},s),{workOrderType:e.key,workOrderTypeText:a,bizFileId:ce()}))};function V(){return f(this,null,function*(){const e=yield xe({});y.value=e.result})}function z(e){i.value.periodId=null,i.value.stationId=null,i.value.stationOrganId=null,s.periodId="",s.periodName="",s.stationId="",s.stationName="",s.stationOrganId="",s.stationOrganName="",e&&(e.nodeKindId==="org"&&(i.value.stationOrganId=e.id),e.nodeKindId==="station"&&(i.value.stationId=e.powerStationId,s.stationId=e.powerStationId,s.stationName=e.powerStationName,s.stationOrganId=e.organId,s.stationOrganName=e.organName),e.nodeKindId==="period"&&(i.value.periodId=e.powerStationPeriodId,i.value.stationId=e.powerStationId,s.periodId=e.powerStationPeriodId,s.periodName=e.powerStationPeriodName,s.stationId=e.powerStationId,s.stationName=e.powerStationName,s.stationOrganId=e.organId,s.stationOrganName=e.organName)),x()}function q(e){ue(e.id,e.workOrderTypeText)}const j=(e,a)=>{const t=e!=null&&e.workOrderTypeText?e==null?void 0:e.workOrderTypeText:a;return e!=null&&e.id?(e==null?void 0:e.status)===0?`${n("common.action.edit")}${t}`:(e==null?void 0:e.status)===1||(e==null?void 0:e.status)===6?`审批${t}`:`查看${t}`:`${n("common.action.create")}${t}`};function A(){m.createConfirm({title:n("common.message.confirmTitle"),iconType:"warning",content:n("common.message.exportMessage"),onOk(){return f(this,null,function*(){const a=_(!1);a.filename=`${O.value}.xls`,a.excelList=F(),yield ve(a).then(t=>{_e(t==null?void 0:t.data,a.filename)}),m.success(n("common.exportSuccessText"))})}})}function Q(){const e=Y();return e.length==0?(m.error("请选择一行数据"),!1):e[0]}const H=()=>f(this,null,function*(){var t,p;const e=Q();if(!e)return;if(yield m.delConfirm(),e.status!=0){m.error(n("common.message.delNotDraftMessage"));return}const a=yield be({id:e.id});yield de((p=(t=a.result)==null?void 0:t.processVariable)==null?void 0:p.processInstanceId),m.success(n("common.delSuccess")),$(),x()}),D=w([]),U=e=>f(this,null,function*(){if(!e)return;let a="";setTimeout(()=>f(this,null,function*(){y.value.forEach(t=>{t.children&&t.children.forEach(p=>{p.id===e&&(a=t.id)})}),D.value=[a,e],I.value=[e]}),500)}),W=()=>f(this,null,function*(){yield U(o.stationId);const e=N(),a=o.status;a&&(o.status=a.split(",")),e.setFieldsValue(S({},o))});function X({rows:e}){u.value=e.length===0}return Oe(()=>f(this,null,function*(){yield V(),yield W(),re.getInstance().listen("work-order",x)})),(e,a)=>{const t=h("a-menu-item"),p=h("a-menu"),v=h("a-button"),Z=h("a-dropdown");return Ne(),De(d(ye),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:l(()=>[c(Ie,{title:"电站组织",onSelect:z,value:y.value,class:"left-tree-layout",toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,fieldNames:{key:"id",title:"name"},selectedKeys:I.value,expandedKeys:D.value},null,8,["value","selectedKeys","expandedKeys"]),Ce("div",Me,[c(d(pe),{onRegister:d(R),class:"fix-basic-table",onResizeColumn:a[0]||(a[0]=(b,G)=>G.width=b),onRowDbClick:a[1]||(a[1]=b=>q(b)),onSelectionChange:X},{toolbar:l(()=>[c(Z,null,{overlay:l(()=>[c(p,{onClick:L},{default:l(()=>[c(t,{key:"cc",title:"除草工单"},{default:l(()=>[g("除草工单")]),_:1}),c(t,{key:"zjqx",title:"组件清洗工单"},{default:l(()=>[g("组件清洗工单")]),_:1}),c(t,{key:"lsjg",title:"螺栓紧固工单"},{default:l(()=>[g("螺栓紧固工单")]),_:1}),c(t,{key:"ff",title:"防腐工单"},{default:l(()=>[g("防腐工单")]),_:1})]),_:1})]),default:l(()=>[c(v,{type:"primary",preIcon:d(T).ADD},{default:l(()=>[g(k(d(n)("common.action.create"))+" ",1),c(d(ge))]),_:1},8,["preIcon"])]),_:1}),c(v,{disabled:u.value,class:"red-btn",preIcon:d(T).DELETE,onClick:H},{default:l(()=>[g(k(d(n)("common.delText")),1)]),_:1},8,["disabled","preIcon"]),c(v,{class:"yellow-btn",preIcon:d(T).EXPORT,onClick:A},{default:l(()=>[g(k(d(n)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])])]),_:1})}}});const ct=me(Ee,[["__scopeId","data-v-94a7cbda"]]);export{ct as default};
//# sourceMappingURL=index-4e8e0a49.js.map
