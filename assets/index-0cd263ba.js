var c=(m,s,d)=>new Promise((T,l)=>{var v=p=>{try{I(d.next(p))}catch(h){l(h)}},O=p=>{try{I(d.throw(p))}catch(h){l(h)}},I=p=>p.done?T(p.value):Promise.resolve(p.value).then(v,O);I((d=d.apply(m,s)).next())});import{d as fe,k as y,r as F,K as ge,o as we,al as b,Z as R,_ as E,f as a,aa as n,$ as D,E as f,ad as _,u as i,F as $,v as ve,A as xe,J as ye}from"./vue-71d1abb3.js";import{b6 as _e,a0 as L,b as Ie,au as he,a7 as Te,av as S,ax as Ce,aA as De,az as Se,bX as B,_ as Oe}from"./index.js";import{B as H}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as W}from"./useTable-109483b3.js";import{bB as Ne,bC as ze}from"./antd-15ac76ed.js";import{P as ke}from"./index-20519caf.js";import{C as Fe}from"./CommonTree-c4ed7838.js";import{_ as A}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{e as Y}from"./download-03e71dd5.js";import{e as Re,a as Ee,g as Me,b as Pe}from"./index-09349b18.js";import{c as Ue}from"./index-5d738211.js";import{g as Ke}from"./index-c462aef4.js";import"./index-316f6ffb.js";import{u as qe}from"./useRender-21ce56fb.js";import{a as Ve}from"./assign-37f1c13d.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./index-3801a970.js";_e();const $e=[{title:"出库批次",dataIndex:"billCode",width:220,sorter:!0,resizable:!0},{title:"出库类型",dataIndex:"outboundType",width:200,sorter:!0,resizable:!0,customRender:({record:m})=>m.outboundTypeText},{title:"所属公司",dataIndex:"stationOrganName",sorter:!0,resizable:!0,ifShow:L().isMultiOrganization},{title:"库房名称",dataIndex:"warehouseName",sorter:!0,resizable:!0},{title:"库房类型",dataIndex:"warehouseType",width:200,sorter:!0,resizable:!0,customRender:({record:m})=>m.warehouseTypeText},{title:"出库日期",dataIndex:"outboundDate",width:200,sorter:!0,resizable:!0},{title:"审批状态",dataIndex:"status",sorter:!0,resizable:!0,width:120,customRender:({text:m,record:s})=>qe.renderFlowStatus(m,s.statusText)}],Be=[{title:"出库批次",dataIndex:"billCode",width:160,sorter:!0,resizable:!0},{title:"出库类型",dataIndex:"outboundType",width:160,sorter:!0,resizable:!0,customRender:({record:m})=>m.outboundTypeText},{title:"所属公司",dataIndex:"stationOrganName",width:160,sorter:!0,resizable:!0,ifShow:L().isMultiOrganization},{title:"库房名称",dataIndex:"warehouseName",width:160,sorter:!0,resizable:!0},{title:"库房类型",dataIndex:"warehouseType",width:160,sorter:!0,resizable:!0,customRender:({record:m})=>m.warehouseTypeText},{title:"出库日期",dataIndex:"outboundDate",width:160,sorter:!0,resizable:!0},{title:"物料编码",dataIndex:"materialCode",width:160,sorter:!0,resizable:!0},{title:"物料",dataIndex:"materialName",width:160,sorter:!0,resizable:!0},{title:"物料全称",dataIndex:"materialWholeName",width:160,sorter:!0,resizable:!0},{title:"物料类别",dataIndex:"materialCategoryName",width:160,sorter:!0,resizable:!0},{title:"出库数量",dataIndex:"qty",width:160,sorter:!0,resizable:!0},{title:"计量单位",dataIndex:"unitName",width:160,sorter:!0,resizable:!0},{title:"备注",dataIndex:"remark",width:160,sorter:!0,resizable:!0}],He={class:"right-table-layout tab-model"},We={class:"tab-button-div"},Ae={id:"outbound-tab-content",class:"tab-table-div tab-table-content"},Ye=fe({name:"Outbound",__name:"index",setup(m){const{t:s}=Ie(),d=he(),T=y([]),l=y({}),v=y(!1);function O(e={}){if(l.value.stationOrganId=e.organId,l.value.stationOrganName=e.organName,l.value.stationId=e.powerStationId,l.value.stationName=e.powerStationName,l.value.warehouseId=null,l.value.warehouseName=null,l.value.warehouseType=null,e.nodeKindId=="Warehouse"){if(e.status==0)return;l.value.warehouseId=e.id,l.value.warehouseName=e.name,l.value.warehouseType=e.stationType}M()}function I(){return c(this,null,function*(){const e=yield Ue();T.value=e})}const p=y("1"),h=y(),o=F({billCode:"",outboundType:"",outboundDate:[],materialCode:"",materialName:"",status:""}),M=()=>{C(),K()},X=()=>{o.billCode="",o.outboundType="",o.outboundDate=[],o.materialCode="",o.materialName="",o.status="",C(),K()},J=()=>P().length==0,N=F({}),[Z,{getForm:j,reload:C,getSelectRows:P,clearSelectedRowKeys:G,redoHeight:Q}]=W({api:Me,target:"#outbound-tab-content",targetTabKey:"1",targetTabValue:p,columns:$e,useSearchForm:!1,bordered:!0,rowSelection:{type:"radio"},beforeFetch(e){return e.stationOrganId=l.value.stationOrganId,e.stationId=l.value.stationId,e.warehouseId=l.value.warehouseId,e.billCode=o.billCode,e.outboundType=o.outboundType,o.outboundDate!=null&&o.outboundDate.length>0&&(e.startDate=o.outboundDate[0],e.endDate=o.outboundDate[1]),e.materialCode=o.materialCode,e.materialName=o.materialName,e.status=o.status,Ve(e,N),e},sortFn:e=>{var u;const t=(u=e.order)==null?void 0:u.replace("end","");N.sortOrder=t,N.sortField=t?B(e.field):void 0},showTableSetting:!1,tableSetting:{fullScreen:!0},showIndexColumn:!0});function ee(){return c(this,null,function*(){if(l.value.warehouseType==null){d.warning("请选择库房。");return}if(yield Ke(l.value.warehouseId)){d.error("当前有在途（审批中）盘点单，请完成后再出库。");return}const t=ye(l.value);Ce("/po/equipment/outbound/create",le(),t)})}function te(){const e=P();return e.length==0?(d.warning("请选择一行数据"),!1):e[0]}const ae=()=>c(this,null,function*(){const e=te();e&&(yield d.delConfirm(),yield De(e.processInstanceId),d.success(s("common.delSuccess")),G(),C())});function oe(e){Se(e.id)}const ne=y("设备出库"),le=e=>{const t=ne.value;return!(e!=null&&e.id)||(e==null?void 0:e.status)===0?`${s("common.action.create")}${t}`:(e==null?void 0:e.status)===1||(e==null?void 0:e.status)===6?`审核${t}`:`查看${t}`};function re(){return c(this,null,function*(){d.createConfirm({title:s("common.exportTitle"),iconType:"warning",content:s("common.exportMessage"),onOk(){return c(this,null,function*(){let t=j().getFieldsValue()||{};t.stationOrganId=l.value.stationOrganId,t.stationId=l.value.stationId,t.warehouseId=l.value.warehouseId,yield Re(t).then(u=>{Y(u==null?void 0:u.data,"出库记录.xls")}),d.success(s("common.exportSuccessText"))})}})})}const U=F({}),[se,{getForm:ue,reload:K,redoHeight:ie}]=W({api:Pe,target:"#outbound-tab-content",targetTabKey:"2",targetTabValue:p,columns:Be,useSearchForm:!1,bordered:!0,beforeFetch(e){return e.stationOrganId=l.value.stationOrganId,e.stationId=l.value.stationId,e.warehouseId=l.value.warehouseId,e.billCode=o.billCode,e.outboundType=o.outboundType,o.outboundDate!=null&&o.outboundDate.length>0&&(e.startDate=o.outboundDate[0],e.endDate=o.outboundDate[1]),e.materialCode=o.materialCode,e.materialName=o.materialName,e.status=o.status,e},sortFn:e=>{var u;const t=(u=e.order)==null?void 0:u.replace("end","");U.sortOrder=t,U.sortField=t?B(e.field):void 0},showTableSetting:!1,tableSetting:{fullScreen:!0},showIndexColumn:!0});function de(){return c(this,null,function*(){d.createConfirm({title:s("common.exportTitle"),iconType:"warning",content:s("common.exportMessage"),onOk(){return c(this,null,function*(){let t=ue().getFieldsValue()||{};t.stationOrganId=l.value.stationOrganId,t.stationId=l.value.stationId,t.warehouseId=l.value.warehouseId,yield Ee(t).then(u=>{Y(u==null?void 0:u.data,"出库明细.xls")}),d.success(s("common.exportSuccessText"))})}})})}const z=()=>{Q(),ie()},me=()=>{v.value=!v.value,setTimeout(z,300)};return ge(()=>{z()}),we(()=>{I(),Te.getInstance().listen("outbound-page",C)}),(e,t)=>{const u=b("a-input"),g=b("a-form-item"),w=b("a-col"),pe=b("a-range-picker"),x=b("a-button"),q=b("a-row"),be=b("a-form"),V=b("a-tab-pane"),ce=b("a-tabs");return R(),E("div",null,[a(i(ke),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:n(()=>[a(Fe,{title:"电站组织",onSelect:O,value:T.value,class:"left-tree-layout",toolbar:!1,fieldNames:{key:"id",title:"name"}},null,8,["value"]),D("div",He,[D("div",We,[a(be,{class:"search-form-box",ref_key:"formRef",ref:h,model:o,autocomplete:"off"},{default:n(()=>[a(q,{gutter:32},{default:n(()=>[a(w,{flex:"27.5%"},{default:n(()=>[a(g,{name:"billCode",label:"出库批次",labelCol:{style:{width:"120px"}},colon:!1},{default:n(()=>[a(u,{value:o.billCode,"onUpdate:value":t[0]||(t[0]=r=>o.billCode=r),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),a(w,{flex:"27.5%"},{default:n(()=>[a(g,{name:"warehouseType",label:"出库类型",labelCol:{style:{width:"120px"}},colon:!1},{default:n(()=>[a(A,{type:"po_outbound_type",onChange:t[1]||(t[1]=r=>"()=> formState.outboundType = value"),value:o.outboundType,"onUpdate:value":t[2]||(t[2]=r=>o.outboundType=r),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),a(w,{flex:"27.5%"},{default:n(()=>[a(g,{name:"outboundDate",label:"出库日期",labelCol:{style:{width:"120px"}},colon:!1},{default:n(()=>[a(pe,{value:o.outboundDate,"onUpdate:value":t[3]||(t[3]=r=>o.outboundDate=r),"value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),a(w,{flex:"17.5%"},{default:n(()=>[a(g,{style:{"text-align":"right"}},{default:n(()=>[a(x,{class:"tab-button",onClick:X},{default:n(()=>[f(_(i(s)("common.resetText")),1)]),_:1}),a(x,{type:"primary",class:"tab-button",onClick:M},{default:n(()=>[f(_(i(s)("common.queryText")),1)]),_:1}),D("a",{style:{"font-size":"12px"},onClick:me},[v.value?(R(),E($,{key:0},[f(" 收起 "),a(i(Ne))],64)):(R(),E($,{key:1},[f(" 展开 "),a(i(ze))],64))])]),_:1})]),_:1})]),_:1}),ve(a(q,{gutter:32},{default:n(()=>[a(w,{flex:"27.5%"},{default:n(()=>[a(g,{name:"materialCode",label:"物料编码",labelCol:{style:{width:"120px"}},colon:!1},{default:n(()=>[a(u,{value:o.materialCode,"onUpdate:value":t[4]||(t[4]=r=>o.materialCode=r),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),a(w,{flex:"27.5%"},{default:n(()=>[a(g,{name:"materialName",label:"物料",labelCol:{style:{width:"120px"}},colon:!1},{default:n(()=>[a(u,{value:o.materialName,"onUpdate:value":t[5]||(t[5]=r=>o.materialName=r),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),a(w,{flex:"27.5%"},{default:n(()=>[a(g,{name:"status",label:"状态",labelCol:{style:{width:"120px"}},colon:!1},{default:n(()=>[a(A,{type:"bpm_process_instance_result",onChange:t[6]||(t[6]=r=>"()=> formState.status = value"),value:o.status,"onUpdate:value":t[7]||(t[7]=r=>o.status=r),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[xe,v.value]])]),_:1},8,["model"])]),D("div",Ae,[a(ce,{activeKey:p.value,"onUpdate:activeKey":t[11]||(t[11]=r=>p.value=r),onChange:z},{default:n(()=>[a(V,{key:"1",tab:"出库记录"},{default:n(()=>[a(i(H),{onRegister:i(Z),class:"fix-basic-table",onResizeColumn:t[8]||(t[8]=(r,k)=>k.width=r),onRowDbClick:t[9]||(t[9]=r=>oe(r))},{toolbar:n(()=>[a(x,{type:"primary",preIcon:i(S).ADD,onClick:ee},{default:n(()=>[f(_(i(s)("common.action.create")),1)]),_:1},8,["preIcon"]),a(x,{class:"red-btn",disabled:J(),preIcon:i(S).DELETE,onClick:ae},{default:n(()=>[f(_(i(s)("common.delText")),1)]),_:1},8,["disabled","preIcon"]),a(x,{class:"yellow-btn",preIcon:i(S).EXPORT,onClick:re},{default:n(()=>[f(_(i(s)("common.action.export")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])]),_:1}),a(V,{key:"2",tab:"出库明细"},{default:n(()=>[a(i(H),{onRegister:i(se),class:"fix-basic-table",onResizeColumn:t[10]||(t[10]=(r,k)=>k.width=r)},{toolbar:n(()=>[a(x,{class:"yellow-btn",preIcon:i(S).EXPORT,onClick:de},{default:n(()=>[f(_(i(s)("common.exportTitle")),1)]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])]),_:1})]),_:1},8,["activeKey"])])])]),_:1})])}}});const Ct=Oe(Ye,[["__scopeId","data-v-684ba0ac"]]);export{Ct as default};
//# sourceMappingURL=index-0cd263ba.js.map
