var w=(c,o,m)=>new Promise((_,b)=>{var C=g=>{try{e(m.next(g))}catch(v){b(v)}},l=g=>{try{e(m.throw(g))}catch(v){b(v)}},e=g=>g.done?_(g.value):Promise.resolve(g.value).then(C,l);e((m=m.apply(c,o)).next())});import{d as ne,k as x,r as Y,ax as le,u as h,o as ie,al as p,Z as f,a9 as k,aa as u,$ as z,f as r,v as F,A as E,ac as O,E as I,_ as S,F as V}from"./vue-71d1abb3.js";import{B as oe}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as se}from"./useTable-109483b3.js";import{bB as re,bC as ue}from"./antd-15ac76ed.js";import{a0 as A,a5 as N,b as de,au as ce,av as me,_ as he}from"./index.js";import{P as ge}from"./index-20519caf.js";import{e as pe}from"./download-03e71dd5.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";const fe=[{title:"所属公司",dataIndex:"stationOrganName",width:150,resizable:!0,headAlign:"center",align:"left",customCell:c=>({rowSpan:c.rowOrgSpan}),ifShow:A().isMultiOrganization},{title:"电站名称",dataIndex:"stationName",headAlign:"center",align:"left",width:150,resizable:!0},{title:"安全培训",dataIndex:"",resizable:!0,children:[{title:"安全培训次数",dataIndex:"strainingCount",headAlign:"center",align:"right",width:100,resizable:!0},{title:"安全培训时长",dataIndex:"strainingHours",headAlign:"center",align:"right",width:100,resizable:!0},{title:"计划人数",dataIndex:"splannedNumber",headAlign:"center",align:"right",width:100,resizable:!0},{title:"参与人数",dataIndex:"sactualNumber",headAlign:"center",align:"right",width:100,resizable:!0}]},{title:"专业培训",dataIndex:"",resizable:!0,children:[{title:"专业培训次数",dataIndex:"mtrainingCount",headAlign:"center",align:"right",width:100,resizable:!0},{title:"专业培训时长",dataIndex:"mtrainingHours",headAlign:"center",align:"right",width:100,resizable:!0},{title:"计划人数",dataIndex:"mplannedNumber",headAlign:"center",align:"right",width:100,resizable:!0},{title:"参与人数",dataIndex:"mactualNumber",headAlign:"center",align:"right",width:100,resizable:!0}]},{title:"合计",dataIndex:"",resizable:!0,children:[{title:"培训总次数",dataIndex:"count",width:100,resizable:!0,headAlign:"center",align:"right",customRender:({text:c,record:o})=>(o.strainingCount|0)+(o.mtrainingCount|0)},{title:"培训总时长",dataIndex:"hours",width:100,resizable:!0,headAlign:"center",align:"right",customRender:({text:c,record:o})=>o.strainingHours+o.mtrainingHours},{title:"计划人数",dataIndex:"planNumber",width:100,resizable:!0,headAlign:"center",align:"right",customRender:({text:c,record:o})=>(o.splannedNumber|0)+(o.mplannedNumber|0)},{title:"参与人数",dataIndex:"actualNumber",width:100,resizable:!0,headAlign:"center",align:"right",customRender:({text:c,record:o})=>(o.sactualNumber|0)+(o.mactualNumber|0)}]}],be=c=>N.download({url:"/bi/trainingStatistics/trainingStatisticsDetail/export-excel",params:c},{isReturnNativeResponse:!0}),ve={class:"fix-basic-table"},ye={class:"tab-button-div"},xe={class:"tab-table-div"},Ie=ne({__name:"index",setup(c){const{t:o}=de(),m=x(!1),_=x([]),b=x([]);let C=x([{label:"年份",value:"year"},{label:"月份",value:"month"}]);const l=Y({searchMonth:null,searchDate:null}),e=Y({ognId:null,stationId:null,dateCycle:"year",yearValue:new Date().getFullYear()+"",startMonth:null,endMonth:null,startDate:null,endDate:null}),g=()=>w(this,null,function*(){let a=yield v(e);return e.stationId!=null&&(e.stationId=e.stationId.split("|"),e.stationName=e.stationName.split("|")),a}),v=a=>N.get({url:"/bi/trainingStatistics/trainingStatisticsDetail",params:a},{isOnlyResult:!0}),H=a=>N.get({url:"/bi/common/station/info",params:a},{}),q=a=>N.get({url:"/bi/common/org/info",params:a},{}),{createConfirm:B,createMessage:U}=ce();function j(){B({title:o("common.message.confirmTitle"),iconType:"warning",content:o("common.message.exportMessage"),onOk(){return w(this,null,function*(){const t=e;t.filename="培训统计.xls",yield be(t).then(n=>{pe(n==null?void 0:n.data,t.filename)}),t.filename=null,U.success(o("common.exportSuccessText"))})}})}function P(a,t){a.length==0&&(e.stationId=void 0,e.stationName=void 0)}function L(a,t){e.ognName=t.value,e.ognId=t.lable}function W(){H({}).then(a=>{a.result&&a.result.length>0&&a.result.forEach(t=>{_.value.push({value:t.stationName,lable:t.id})})}),q({}).then(a=>{a.result&&a.result.length>0&&a.result.forEach(t=>{b.value.push({value:t.label,lable:t.value})})})}const X=le(),{currentRoute:Z}=X,s=h(Z).query;ie(()=>w(this,null,function*(){W(),s.startDate&&(e.dateCycle=s.dateType,l.searchMonth=[s.startDate,s.endDate],T(),s.selectType=="station"&&(e.stationName=s.name,e.stationId=s.id),s.selectType=="company"&&(e.ognName=s.name,e.ognId=s.id),s.stationId!=null&&s.stationId!=null&&s.stationId!=""&&(e.stationId=s.stationId.split("|")),s.stationName!=null&&s.stationName!=null&&(e.stationName=s.stationName.split("|")))}));function $(){J(),m.value=!m.value}const[G,{reload:R,redoHeight:J}]=se({title:"培训统计",api:g,columns:fe,useSearchForm:!1,bordered:!0,pagination:!1,showIndexColumn:!1,showTableSetting:!1,tableSetting:{fullScreen:!0},afterFetch:function(a){const t={};for(let n=0;n<a.length;n++){const i=a[n];if(t[i.stationOrganId]){t[i.stationOrganId]++;continue}t[i.stationOrganId]=1}for(let n=0;n<a.length;n++){const i=a[n];for(const y in t)i.stationOrganId===y&&(i.rowOrgSpan=t[y],t[y]=0)}return a}});function K(){e.ognId=null,e.stationId=void 0,e.ognName=null,e.stationName=void 0,e.dateCycle="year",e.yearValue=new Date().getFullYear()+"",e.startMonth=null,e.endMonth=null,e.startDate=null,e.endDate=null,l.searchDate=null,l.searchMonth=null,R()}const M=x();function Q(){let a=[],t=[];M.value&&M.value.validateFields().then(()=>{if(Array.isArray(e.stationName))if(e.stationName.forEach(n=>{n.option!=null&&(a.push(n.option.value),t.push(n.option.lable))}),a.length>0){let n=a.join("|"),i=t.join("|");e.stationId=i,e.stationName=n}else{let n=e.stationName.join("|"),i=e.stationId.join("|");e.stationId=i,e.stationName=n}l.searchMonth!=null&&(e.startMonth=l.searchMonth[0],e.endMonth=l.searchMonth[1]),l.searchDate!=null&&(e.startDate=l.searchDate[0],e.endDate=l.searchDate[1]),R()})}const T=()=>{e.startMonth=null,e.endMonth=null,e.startDate=null,e.endDate=null,l.searchMonth!=null&&(e.startMonth=l.searchMonth[0],e.endMonth=l.searchMonth[1]),l.searchDate!=null&&(e.startDate=l.searchDate[0],e.endDate=l.searchDate[1])};return(a,t)=>{const n=p("a-select"),i=p("a-form-item"),y=p("a-date-picker"),ee=p("a-range-picker"),D=p("a-button"),te=p("a-form");return f(),k(h(ge),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:u(()=>[z("div",ve,[z("div",ye,[r(te,{model:e,name:"searchInfo",layout:"inline",autocomplete:"off",class:"search-form",ref_key:"searchFormRef",ref:M},{default:u(()=>[r(i,{label:"时间纬度",name:"dateCycle",rules:[{required:!0,max:30}],labelCol:{span:15},style:{width:"26.5%"}},{default:u(()=>[r(n,{value:e.dateCycle,"onUpdate:value":t[0]||(t[0]=d=>e.dateCycle=d),"allow-clear":"",options:h(C),style:{width:"100%"}},null,8,["value","options"])]),_:1}),F(r(i,{name:"yearValue",label:"年度",labelCol:{span:6},rules:[{required:e.dateCycle=="year",message:"请选择年度"}],style:{width:"26.5%"}},{default:u(()=>[r(y,{value:e.yearValue,"onUpdate:value":t[1]||(t[1]=d=>e.yearValue=d),"value-format":"YYYY",style:{width:"100%"},picker:"year"},null,8,["value"])]),_:1},8,["rules"]),[[E,e.dateCycle=="year"]]),F(r(i,{name:"startMonth",label:"月份",labelCol:{span:6},rules:[{required:e.dateCycle=="month",message:"请选择月份"}],style:{width:"26.5%"}},{default:u(()=>[r(ee,{value:l.searchMonth,"onUpdate:value":t[2]||(t[2]=d=>l.searchMonth=d),format:"YYYY-MM","value-format":"YYYY-MM",style:{width:"100%"},picker:"month",onChange:T},null,8,["value"])]),_:1},8,["rules"]),[[E,e.dateCycle=="month"]]),r(i,{name:"stationName",label:"电站",labelCol:{span:6},rules:[{required:!1,message:"请选择电站"}],style:{width:"26.5%"}},{default:u(()=>[r(n,{value:e.stationName,"onUpdate:value":t[3]||(t[3]=d=>e.stationName=d),"show-search":"","allow-clear":"",mode:"multiple",style:{width:"100%"},placeholder:"请选择电站",options:_.value,onChange:P,labelInValue:"","max-tag-count":"responsive"},null,8,["value","options"])]),_:1}),m.value?(f(),k(i,{key:0,style:{width:"100%",height:"10px"}})):O("",!0),h(A)().isMultiOrganization&&m.value?(f(),k(i,{key:1,name:"ognName",label:"所属公司",labelCol:{span:6},rules:[{required:!1,message:"请选择所属公司"}],style:{width:"26.5%"}},{default:u(()=>[r(n,{value:e.ognName,"onUpdate:value":t[4]||(t[4]=d=>e.ognName=d),"show-search":"","allow-clear":"",style:{width:"100%"},placeholder:"请选择所属公司",options:b.value,onChange:L},null,8,["value","options"])]),_:1})):O("",!0),r(i,{class:"tab-button"},{default:u(()=>[r(D,{style:{margin:"0 8px"},onClick:K},{default:u(()=>[I("重置")]),_:1}),r(D,{type:"primary",class:"tab-button",onClick:Q},{default:u(()=>[I("查询")]),_:1}),h(A)().isMultiOrganization?(f(),S("a",{key:0,style:{"margin-left":"12px","font-size":"14px"},onClick:$},[m.value?(f(),S(V,{key:0},[I(" 收起 "),r(h(re))],64)):(f(),S(V,{key:1},[I(" 展开 "),r(h(ue))],64))])):O("",!0)]),_:1})]),_:1},8,["model"])]),z("div",xe,[r(h(oe),{onRegister:h(G),onResizeColumn:t[5]||(t[5]=(d,ae)=>ae.width=d)},{toolbar:u(()=>[r(D,{class:"yellow-btn",preIcon:h(me).EXPORT,onClick:j},{default:u(()=>[I("导出")]),_:1},8,["preIcon"])]),_:1},8,["onRegister"])])])]),_:1})}}});const Ze=he(Ie,[["__scopeId","data-v-aa250bfa"]]);export{Ze as default};
//# sourceMappingURL=index-adfa29f7.js.map
