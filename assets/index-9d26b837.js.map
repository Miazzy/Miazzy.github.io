{"version":3,"mappings":"0jBAmBE,MAAMA,EAASC,EAAI,EAAK,EAElBC,EAAe,IAAM,CACzBF,EAAO,MAAQ,EACnB,EAEQG,EAAmB,IAAM,CAC7BH,EAAO,MAAQ,EACnB,EAEQI,EAAoB,IAAM,CAC9B,WAAW,IAAM,CACfJ,EAAO,MAAQ,EAChB,EAAE,EAAE,CACT,+RCYEK,GAAeC,EAAgB,CAC7B,KAAM,eACN,WAAY,CACV,SAAAC,EACA,KAAAC,EACA,SAAUC,EAAqB,IAAMC,EAAA,WAAO,4BAAoB,EAAC,uIACjE,YAAaF,EAAK,QAClB,WAAYC,EAAqB,IAAMC,EAAA,WAAO,yBAAuB,w7BAAC,CACxE,EACA,MAAO,CACL,MAAOC,EAAU,MAAM,CAAC,OAAQ,OAAO,CAAC,CAC1C,EACA,OAAQ,CACN,KAAM,CAAE,UAAAC,CAAA,EAAcC,EAAU,sBAAsB,EAChD,CAAE,GAAMC,IACR,CAAE,WAAAC,EAAY,eAAAC,CAAe,EAAIC,EAAiB,EAClDC,EAAYC,IACZC,EAAYnB,EAAI,EAAE,EAElBoB,EAAe,CAACC,EAAMC,EAAY,KAClCD,GAAQ,MAAQ,OAAOA,GAAQ,YAC7B,OAAOA,GAAQ,UAAYA,EAAK,QAAUC,EACrCD,EAEAA,EAAK,MAAM,EAAGC,CAAS,EAAI,MAG7B,GAILC,EAAcC,EAAS,IAAM,CAC3B,MACJ,SAAAC,EAAW,GACX,SAAAC,EAAW,GACX,OAAAC,EACA,KAAAC,EACA,KAAAC,EACA,MAAAC,GAAQ,CAAC,GACPb,EAAU,aAAe,GAC7B,OAAAE,EAAU,MAAQQ,EACX,CAAE,SAAUF,GAAYC,IAAYG,GAAA,YAAAA,EAAM,IAAI,OAAQF,GAAUI,EAAW,KAAAH,EAAK,CACxF,EAEK,CAACI,EAAU,CAAE,UAAAC,CAAU,CAAC,EAAIC,EAAS,EAE3C,SAASC,GAAa,CACpBF,EAAU,EAAI,CAChB,CAEA,SAASG,GAAkB,CAClB,gBAAS,cAAc,6CAA6C,CAC7E,CAGA,SAASC,GAAiB,CACxBpB,EAAU,gBAAgB,CAC5B,CAGA,SAASqB,GAAU,CACjBC,EAAWC,CAAO,CACpB,CAGA,SAASC,GAAa,CACpBC,EAAW,+BAAgC,MAAM,CACnD,CAEA,SAASC,EAAgBC,EAAa,CACpC,OAAQA,EAAE,IAAkB,CAC1B,IAAK,SACYP,IACf,MACF,IAAK,OACQF,IACX,MACF,IAAK,MACKG,IACR,MACF,IAAK,OACQG,IACX,KACJ,CACF,CAEA,OAAAI,EAAU,IAAM,CACdC,EAAW,YAAY,EAAE,OAAO,wBAA0BC,GAAY,CAChEA,GAAA,MAAAA,EAAS,OACD5B,EAAA,OAAQ4B,GAAA,YAAAA,EAAS,OAAQ5B,EAAU,MAC/C,CACD,EACF,EAEM,CACL,UAAAR,EACA,EACA,aAAAS,EACA,YAAAG,EACA,gBAAAoB,EACA,WAAA7B,EACA,SAAAkB,EACA,WAAAG,EACA,gBAAAC,EACA,UAAAjB,EACA,eAAAJ,EACA,cAAAiC,CAAA,CAEJ,CACF,CAAC,gHA/IY,OAAAC,IACTC,EAOOC,EAAA,MAPPC,EAAAC,EAOO,CAPA,UAAO,WAC0E,QAAAC,EAAA,KAAAF,EAAtFG,EAAsF,SAAAC,EAAA,0BAAxEF,EAAM,KAAAF,EAAQK,EAAa,CAAuB,IAAI,YAAAD,EAAA,aAAAA,EAAA,sBACpE,qBACE,KAAI,EAAQ,UAAAJ,EACLK,EAAC,CACR,IAAI,cAAAD,EAAA,sGAfV,CAOO,IAPK,QAAAF,EAAA,KAAAI,EAAA,QACV,MAAoFC,EAAA,EAAAH,EAAA,aAAAA,EAAA,cAAAA,EAAA,sBAAzC,MAAY,OAAAG,EAAA,GAAAH,EAAA,qBACvD,IAIOA,EAAA,UAAAA,EAAA,UAAAA,EAAA,eAJA,KAAK,GAAAI,EAAA,EAAAF,EAAA,QACV,MAEOC,EAAA,GAAAH,EAAA,qCADFE,EAAA,cAAAC,EAAA,IAAAH,EAAA,yFAgBX","names":["isOpen","ref","openDropdown","keepDropdownOpen","closeDropdownOpen","_sfc_main","defineComponent","Dropdown","Menu","createAsyncComponent","__vitePreload","propTypes","prefixCls","useDesign","useI18n","getShowDoc","getUseLockPage","useHeaderSetting","userStore","useUserStore","avatarURL","truncateName","name","maxLength","getUserInfo","computed","realName","username","avatar","desc","user","roles","headerImg","register","openModal","useModal","handleLock","handleContainer","handleLoginOut","openDoc","openWindow","DOC_URL","handleUser","addTabPage","handleMenuClick","e","onMounted","MsgManager","message","defaultAvatar","_openBlock","_createElementBlock","_Fragment","_createVNode","_component_Dropdown","_withCtx","_component_Menu","_ctx","_component_MenuItem","_createElementVNode","_normalizeClass","_hoisted_1"],"sources":["../../src/components/Framework/Dropdown/Dropdown.vue","../../src/layouts/default/header/components/user-dropdown/index.vue"],"sourcesContent":["<template>\n  <div class=\"dropdown\" @mouseover=\"openDropdown\">\n    <slot></slot>\n    <template v-if=\"isOpen\">\n      <div\n        class=\"dropdown-menu\"\n        @mouseover=\"keepDropdownOpen\"\n        @mouseleave=\"closeDropdownOpen\"\n        @click=\"closeDropdownOpen\"\n      >\n        <slot name=\"overlay\"></slot>\n      </div>\n    </template>\n  </div>\n</template>\n\n<script setup>\n  import { ref } from 'vue';\n\n  const isOpen = ref(false);\n\n  const openDropdown = () => {\n    isOpen.value = true;\n  };\n\n  const keepDropdownOpen = () => {\n    isOpen.value = true;\n  };\n\n  const closeDropdownOpen = () => {\n    setTimeout(() => {\n      isOpen.value = false;\n    }, 10);\n  };\n</script>\n<style lang=\"less\">\n  [data-theme='dark'] .theme1.my-layout .dropdown .dropdown-menu ul.ant-menu {\n    background: rgba(10, 36, 74, 0.99);\n    color: #c9d1d9;\n\n    > li.ant-menu-item {\n      border-border: 1px solid #0e73e733 !important;\n    }\n  }\n\n  [data-theme='light'] .theme3.my-layout .dropdown .dropdown-menu ul.ant-menu {\n    background: #fefefe;\n    color: #333;\n  }\n</style>\n<style lang=\"less\" scoped>\n  .dropdown {\n    display: inline-block;\n    position: relative;\n    cursor: pointer;\n\n    .dropdown-menu {\n      display: none;\n      position: absolute;\n      z-index: 19999;\n      top: 100%;\n      left: 0;\n      cursor: pointer;\n    }\n\n    &:hover .dropdown-menu {\n      display: block;\n      z-index: 19999;\n      cursor: pointer;\n    }\n\n    :deep(.ant-menu-item) {\n      margin: 0 !important;\n      cursor: pointer;\n\n      &:first-child {\n        border-bottom: 1px solid #cecece10;\n      }\n    }\n  }\n</style>\n","<template>\n  <Dropdown placement=\"bottom\">\n    <span :class=\"[prefixCls, `${prefixCls}--${theme}`]\" class=\"flex\">\n      <img :class=\"`${prefixCls}__header`\" :src=\"avatarURL ? avatarURL : defaultAvatar\" />\n      <span :class=\"`${prefixCls}__info hidden md:block`\">\n        <span :class=\"`${prefixCls}__name  `\" class=\"truncate\">\n          {{ truncateName(getUserInfo.realName) }}\n        </span>\n      </span>\n    </span>\n\n    <template #overlay>\n      <Menu @click=\"handleMenuClick\">\n        <MenuItem key=\"user\" :text=\"truncateName(getUserInfo.realName)\" icon=\"ph:user-thin\" />\n        <MenuItem\n          key=\"logout\"\n          :text=\"t('layout.header.dropdownItemLoginOut')\"\n          icon=\"ion:power-outline\"\n        />\n      </Menu>\n    </template>\n  </Dropdown>\n  <LockAction @register=\"register\" />\n</template>\n<script lang=\"ts\">\n  import { Menu } from 'ant-design-vue';\n  import Dropdown from '@/components/Framework/Dropdown/Dropdown.vue';\n  import type { MenuInfo } from 'ant-design-vue/lib/menu/src/interface';\n  import { defineComponent, computed, onMounted, ref } from 'vue';\n  import { DOC_URL } from '/@/settings/siteSetting';\n  import { useUserStore } from '/@/store/modules/user';\n  import { useHeaderSetting } from '/@/hooks/setting/useHeaderSetting';\n  import { useI18n } from '/@/hooks/web/useI18n';\n  import { useDesign } from '/@/hooks/web/useDesign';\n  import { useModal } from '/@/components/Modal';\n  import headerImg from '/@/assets/images/header.jpg';\n  import { propTypes } from '/@/utils/propTypes';\n  import { openWindow } from '/@/utils';\n  import { createAsyncComponent } from '/@/utils/factory/createAsyncComponent';\n  import { addTabPage } from '@/utils/route';\n  import { MsgManager } from '/@/message/MsgManager';\n  import defaultAvatar from '@/assets/images/default-avatar-s.png';\n\n  type MenuEvent = 'logout' | 'doc' | 'lock' | 'user';\n\n  export default defineComponent({\n    name: 'UserDropdown',\n    components: {\n      Dropdown,\n      Menu,\n      MenuItem: createAsyncComponent(() => import('./DropMenuItem.vue')),\n      MenuDivider: Menu.Divider,\n      LockAction: createAsyncComponent(() => import('../lock/LockModal.vue')),\n    },\n    props: {\n      theme: propTypes.oneOf(['dark', 'light']),\n    },\n    setup() {\n      const { prefixCls } = useDesign('header-user-dropdown');\n      const { t } = useI18n();\n      const { getShowDoc, getUseLockPage } = useHeaderSetting();\n      const userStore = useUserStore();\n      const avatarURL = ref('');\n\n      const truncateName = (name, maxLength = 10) => {\n        if (name != null && typeof name != 'undefined') {\n          if (typeof name == 'string' && name.length <= maxLength) {\n            return name;\n          } else {\n            return name.slice(0, maxLength) + '...';\n          }\n        } else {\n          return '';\n        }\n      };\n\n      const getUserInfo = computed(() => {\n        const {\n          realName = '',\n          username = '',\n          avatar,\n          desc,\n          user,\n          roles = [],\n        } = userStore.getUserInfo || {};\n        avatarURL.value = avatar;\n        return { realName: realName || username || user?.id, avatar: avatar || headerImg, desc };\n      });\n\n      const [register, { openModal }] = useModal();\n\n      function handleLock() {\n        openModal(true);\n      }\n\n      function handleContainer() {\n        return document.querySelector('div#app .main-layout .app-header .user-info');\n      }\n\n      //  login out\n      function handleLoginOut() {\n        userStore.confirmLoginOut();\n      }\n\n      // open doc\n      function openDoc() {\n        openWindow(DOC_URL);\n      }\n\n      // 跳转到用户页面\n      function handleUser() {\n        addTabPage('/system/rbac/org/userProfile', '个人信息');\n      }\n\n      function handleMenuClick(e: MenuInfo) {\n        switch (e.key as MenuEvent) {\n          case 'logout':\n            handleLoginOut();\n            break;\n          case 'lock':\n            handleLock();\n            break;\n          case 'doc':\n            openDoc();\n            break;\n          case 'user':\n            handleUser();\n            break;\n        }\n      }\n\n      onMounted(() => {\n        MsgManager.getInstance().listen('avatar-update-message', (message) => {\n          if (message?.path) {\n            avatarURL.value = message?.path || avatarURL.value;\n          }\n        });\n      });\n\n      return {\n        prefixCls,\n        t,\n        truncateName,\n        getUserInfo,\n        handleMenuClick,\n        getShowDoc,\n        register,\n        handleLock,\n        handleContainer,\n        avatarURL,\n        getUseLockPage,\n        defaultAvatar,\n      };\n    },\n  });\n</script>\n<style lang=\"less\">\n  @prefix-cls: ~'@{namespace}-header-user-dropdown';\n\n  .@{prefix-cls} {\n    align-items: center;\n    height: @header-height;\n    padding: 0 0 0 10px;\n    padding-right: 10px;\n    overflow: hidden;\n    font-size: 12px;\n    cursor: pointer;\n\n    img {\n      width: 24px;\n      height: 24px;\n      margin-right: 12px;\n    }\n\n    &__header {\n      border-radius: 50%;\n    }\n\n    &__name {\n      font-size: 14px;\n    }\n\n    &--dark {\n      &:hover {\n        background-color: @header-dark-bg-hover-color;\n      }\n    }\n\n    &--light {\n      &:hover {\n        background-color: @header-light-bg-hover-color;\n      }\n\n      .@{prefix-cls}__name {\n        color: @text-color-base;\n      }\n\n      .@{prefix-cls}__desc {\n        color: @header-light-desc-color;\n      }\n    }\n\n    &-dropdown-overlay {\n      .ant-dropdown-menu-item {\n        min-width: 160px;\n      }\n    }\n  }\n</style>\n"],"file":"assets/index-9d26b837.js"}