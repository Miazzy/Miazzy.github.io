var M=(s,C,g)=>new Promise((D,c)=>{var i=p=>{try{b(g.next(p))}catch(d){c(d)}},f=p=>{try{b(g.throw(p))}catch(d){c(d)}},b=p=>p.done?D(p.value):Promise.resolve(p.value).then(i,f);b((g=g.apply(s,C)).next())});import{B as oe}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as re}from"./useTable-109483b3.js";import{a2 as o}from"./antd-15ac76ed.js";import{a5 as x,b as se,au as ie,av as h,_ as ue}from"./index.js";import{P as de}from"./index-20519caf.js";import ce from"./materialCategory-4133ba9a.js";import{D as me}from"./Dialog-0a006d82.js";import{_ as pe}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{e as fe}from"./download-03e71dd5.js";import{d as ge,k as v,r as z,o as be,al as _,Z as N,a9 as _e,aa as n,f as l,$ as ye,u,E as w,_ as F,F as he,ac as B,a7 as ve}from"./vue-71d1abb3.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useContentViewHeight-7f845167.js";import"./CommonTree-c4ed7838.js";import"./index-3801a970.js";const we=[{key:"fullName",title:"物料类型",dataIndex:"fullName",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0},{key:"code",title:"物料编码",dataIndex:"code",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0},{key:"name",title:"物料名称",dataIndex:"name",align:"left",headAlign:"center",width:120,sorter:!0,resizable:!0},{key:"unitText",title:"计量单位",dataIndex:"unitText",align:"center",width:120,sorter:!0,resizable:!0},{key:"warrantyMonth",title:"质保期(月)",dataIndex:"warrantyMonth",align:"right",headAlign:"center",width:120,sorter:!0,resizable:!0},{key:"status",title:"状态",dataIndex:"status",align:"center",width:120,sorter:!0,resizable:!0}],xe=s=>x.get({url:"/baseset/material/page",params:s},{}),Ce=s=>x.post({url:"/baseset/material/create",params:s},{}),Ie=s=>x.put({url:"/baseset/material/update",params:s},{}),O=s=>x.put({url:"/baseset/material/updateStatus",params:s},{}),ke=s=>x.delete({url:"/baseset/material/delete",params:s},{}),Se=s=>x.download({url:"/baseset/material/export-excel",params:s},{}),Me={class:"right-table-layout"},Te={key:0,style:{color:"#19be6b"}},Ne={key:1,style:{color:"red"}},De=ge({__name:"material",setup(s){const{t:C}=se(),{createConfirm:g,createMessage:D}=ie();let c=v("");const i=z({sortField:"code",sortOrder:"desc"}),f=v({}),b=v(""),p=v(),d=v(!1),I=v(!1),t=z({id:"",name:"",code:"",status:"",unit:"",materialCategoryId:"",fullName:"",warrantyMonth:""}),P=()=>M(this,null,function*(){L();let a=i;const e=q();return a.pageNo=e.current,a.pageSize=e.pageSize,(yield xe(a)).result}),[U,{reload:y,getSelectRows:K,getSelectRowKeys:R,getPaginationRef:q,clearSelectedRowKeys:L}]=re({title:"物料列表",api:P,rowKey:"id",columns:we,useSearchForm:!0,formConfig:{labelWidth:120,showAdvancedButton:!1,schemas:[{label:"物料名称",field:"name",component:"Input",colProps:{span:8}},{label:"物料编码",field:"code",component:"Input",colProps:{span:8}},{label:"状态",field:"status",component:"DictSelectBox",componentProps:{type:"enable_or_disable"},colProps:{span:8}}]},showTableSetting:!0,bordered:!0,pagination:!0,rowSelection:{type:"radio",fixed:!0,onSelect:j},sortFn:a=>{a.order?(i.sortField=a.field.replace("Text",""),i.sortOrder=a.order.replace("end","")):(i.sortField="code",i.sortOrder="desc")},handleSearchInfoFn(a){return i.code=a.code,i.name=a.name,i.status=a.status,a}}),H={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}}},V=()=>{d.value=!1,A()};function $({keys:a,rows:e}){if(e&&e.length>0){const m=e[0];c.value=m.id}else c.value=""}function j(a,e){e?c.value=a.id:c.value=""}function W(a){t.unit=a}function A(){t.id="",t.name="",t.code="",t.status="",t.unit="",t.materialCategoryId="",t.fullName="",t.warrantyMonth=""}function X(){if(!f.value.id)return o.info("请选择分类"),!1;if(f.value.hasChildren)return o.info("有子节点,不能新增物料"),!1;t.fullName=f.value.fullName,t.code="",t.name="",t.unit="",t.warrantyMonth="",t.materialCategoryId=f.value.id,b.value="新增物料",d.value=!0}function Z(){let a=K();if(a.length!==1){o.info("请选择一行数据");return}let e=a[0];t.id=e.id,t.code=e.code,t.name=e.name,t.materialCategoryId=e.materialCategoryId,t.fullName=e.fullName,t.status=e.status,t.unit=e.unit,t.warrantyMonth=e.warrantyMonth,b.value="修改物料",d.value=!0}function G(){let a=R();if(a.length!=1){o.info("请选择一行数据");return}g({title:"提示",iconType:"warning",content:"确定要删除选中的记录？",onOk(){return M(this,null,function*(){ke(`?id=${a[0]}`).then(m=>{m.code=="0"?(o.success("数据已删除。"),y()):o.success("数据删除失败。"),d.value=!1})})}})}function J(){let a=R();if(a.length!=1){o.info("请选择一行数据");return}O({id:a[0],status:1}).then(e=>{e.code=="0"?(o.success("启用成功。"),y()):o.success("启用失败。"),I.value=!1})}function Q(){let a=R();if(a.length!=1){o.info("请选择一行数据");return}O({id:a[0],status:0}).then(e=>{e.code=="0"?(o.success("禁用成功。"),y()):o.success("标用失败。"),I.value=!1})}function Y(){g({title:C("common.exportTitle"),iconType:"warning",content:C("common.exportMessage"),onOk(){return M(this,null,function*(){yield Se(i).then(e=>{fe(e==null?void 0:e.data,"物料xls")}),D.success(C("common.exportSuccessText"))})}})}function ee(a){a?(f.value=a,i.materialCategoryCode=a.code):(f.value={},i.materialCategoryCode=""),y()}const te=()=>{p.value.validateFields().then(()=>M(this,null,function*(){I.value=!0,t.id==""?(yield Ce(t)).code==0?(o.success("数据已生成。"),y(),d.value=!1,A()):o.error("数据生成失败。"):(yield Ie(t)).code==0?(o.success("数据已更新。"),y(),d.value=!1,A()):o.error("数据更新失败。"),I.value=!1})).catch(e=>{console.log(e),I.value=!1})};return be(()=>{}),(a,e)=>{const m=_("a-button"),E=_("a-input"),k=_("a-form-item"),S=_("a-col"),ae=_("a-input-number"),le=_("a-row"),ne=_("a-form");return N(),_e(u(de),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:n(()=>[l(ce,{onSelectTree:ee}),ye("div",Me,[l(u(oe),{onResizeColumn:e[0]||(e[0]=(r,T)=>T.width=r),onRegister:u(U),searchInfo:i,onSelectionChange:$,resizeHeightOffset:32},{toolbar:n(()=>[l(m,{type:"primary",preIcon:u(h).ADD,onClick:X},{default:n(()=>[w("新增")]),_:1},8,["preIcon"]),l(m,{type:"primary",disabled:u(c)=="",preIcon:u(h).EDIT,onClick:Z},{default:n(()=>[w("修改")]),_:1},8,["disabled","preIcon"]),l(m,{class:"red-btn",disabled:u(c)=="",preIcon:u(h).DELETE,onClick:G},{default:n(()=>[w("删除")]),_:1},8,["disabled","preIcon"]),l(m,{class:"yellow-btn",preIcon:u(h).EXPORT,onClick:Y},{default:n(()=>[w("导出")]),_:1},8,["preIcon"]),l(m,{class:"green-btn",disabled:u(c)=="",preIcon:u(h).ENABLE,onClick:J},{default:n(()=>[w("启用")]),_:1},8,["disabled","preIcon"]),l(m,{class:"grey-btn",disabled:u(c)=="",preIcon:u(h).DISABLE,onClick:Q},{default:n(()=>[w("禁用")]),_:1},8,["disabled","preIcon"])]),bodyCell:n(({column:r,text:T})=>[r.key==="status"?(N(),F(he,{key:0},[T==1?(N(),F("span",Te,"启用")):B("",!0),T==0?(N(),F("span",Ne,"禁用")):B("",!0)],64)):B("",!0)]),_:1},8,["onRegister","searchInfo"])]),l(me,{visible:d.value,"onUpdate:visible":e[6]||(e[6]=r=>d.value=r),smode:"default",title:b.value,width:600,height:400,onOk:te,okText:"确定",onCancel:V,cancelText:"取消"},{default:n(()=>[l(ne,ve({model:t,name:"createMaterial",labelAlign:"center",ref_key:"formStateRef",ref:p},H),{default:n(()=>[l(le,{gutter:32},{default:n(()=>[l(S,{span:24},{default:n(()=>[l(k,{label:"物料类型",name:"fullName",labelCol:{style:{width:"124px"}},rules:[{required:!1,message:"请选择物料类别"}]},{default:n(()=>[l(E,{value:t.fullName,"onUpdate:value":e[1]||(e[1]=r=>t.fullName=r),disabled:""},null,8,["value"])]),_:1})]),_:1}),l(S,{span:24},{default:n(()=>[l(k,{label:"物料编码",name:"code",labelCol:{style:{width:"124px"}},rules:[{required:!1,message:"请选择物料编码"}]},{default:n(()=>[l(E,{value:t.code,"onUpdate:value":e[2]||(e[2]=r=>t.code=r),disabled:""},null,8,["value"])]),_:1})]),_:1}),l(S,{span:24},{default:n(()=>[l(k,{label:"物料名称",name:"name",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请输入物料名称"}]},{default:n(()=>[l(E,{value:t.name,"onUpdate:value":e[3]||(e[3]=r=>t.name=r)},null,8,["value"])]),_:1})]),_:1}),l(S,{span:24},{default:n(()=>[l(k,{label:"计量单位",name:"unit",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请选择计量单位"}]},{default:n(()=>[l(pe,{type:"safety_tpl_unit",onChange:W,value:t.unit,"onUpdate:value":e[4]||(e[4]=r=>t.unit=r),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),l(S,{span:24},{default:n(()=>[l(k,{label:"质保期(月)",name:"warrantyMonth",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"请输入质保期(月)"}]},{default:n(()=>[l(ae,{value:t.warrantyMonth,"onUpdate:value":e[5]||(e[5]=r=>t.warrantyMonth=r),min:1,max:1e5},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},16,["model"])]),_:1},8,["visible","title"])]),_:1})}}});const ot=ue(De,[["__scopeId","data-v-b4c40557"]]);export{ot as default};
//# sourceMappingURL=material-54a5819a.js.map
