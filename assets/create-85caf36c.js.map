{"version":3,"file":"create-85caf36c.js","sources":["../../src/views/po/inspection/inspectionpause/create.ts","../../src/views/po/inspection/inspectionpause/create.vue"],"sourcesContent":["\nimport { defHttp } from '@/utils/http/axios';\n\nenum Api {\n  addPauseData = '/po/inspection-pause/create',\n  getPauseData = '/po/inspection-pause/get',\n  getInspectionAreaType = '/po/inspection-plan/selectInspectionAreaType',\n}\n\n//查询\nexport function getPauseData(params) {\n  return defHttp.get({ url: Api.getPauseData, params });\n}\n\n// 新增\nexport function createPause(data) {\n  return defHttp.post({ url: Api.addPauseData, data });\n}\n\nexport function getInspectionAreaType(params) {\n  return defHttp.get({ url: Api.getInspectionAreaType, params });\n}\n","<template>\n  <PageWrapper dense contentFullHeight fixedHeight  contentClass=\"flex\" style=\"position: relative\">\n  <div class=\"load\">\n\t<a-spin :spinning=\"formState.spinning\" tip=\"Loading...\">\n  <div class=\"process-box\">\n    <div class=\"header-box\">\n      <BillTitle :options=\"billTitle\" />\n      <WfApproveBox\n        :processInstanceId=\"processInstanceId\"\n        @agree=\"flowOption.handleAgree\"\n        @save=\"flowOption.handleSave\"\n        @submit=\"flowOption.handleSubmit\"\n        :processStatus=\"formState.status\"\n        :listenMessage=\"`inspection-pause`\"\n      />\n      <!-- <PrintButton style=\"margin-left: 10px\" v-if=\"formState.status === 2\" /> -->\n    </div>\n    <div class=\"content\">\n      <a-form\n        :model=\"formState\"\n        name=\"basic\"\n        ref=\"formRef\"\n        autocomplete=\"off\"\n        @finish=\"onFinish\"\n      >\n        <a-card title=\"基本信息\" :bordered=\"false\">\n          <a-row :gutter=\"32\">\n            <a-col :span=\"12\">\n              <a-form-item\n                label=\"电站名称\"\n                name=\"stationName\"\n                :labelCol=\"{ style: { width: '124px'} }\" \n                :rules=\"[{ required: false, message: '电站名称不能为空。' }]\"\n              >\n                <a-input :disabled=\"true\" v-model:value=\"formState.stationName\" />\n              </a-form-item>\n            </a-col>\n            <a-col :span=\"12\">\n              <a-form-item\n                label=\"巡检区域\"\n                name=\"inspectionAreaType\"\n                :labelCol=\"{ style: { width: '124px'} }\" \n                :rules=\"[{ required: true, message: '巡检区域不能为空。' }]\"\n              >\n                <a-select\n                  v-model:value=\"formState.inspectionAreaType\"\n                  :options=\"inspectionAreData\"\n                  :disabled=\"disabledInput\"\n                  @change=\"changeInspectionAreaType\"\n                />\n              </a-form-item>\n            </a-col>\n\n            <a-col :span=\"12\">\n              <a-form-item\n                label=\"巡检频率\"\n                name=\"inspectionPeriod\"\n                :labelCol=\"{ style: { width: '124px'} }\" \n                :rules=\"[{ required: false, message: '巡检频率不能为空' }]\"\n              >\n                <a-input v-model:value=\"formState.inspectionPeriod\" :disabled=\"true\" />\n              </a-form-item>\n            </a-col>\n\n            <a-col :span=\"12\">\n              <a-form-item\n                label=\"暂停开始日期\"\n                name=\"startDate\"\n                :labelCol=\"{ style: { width: '124px'} }\" \n                :rules=\"[{ required: true, message: '暂停开始日期不能为空。' }]\"\n              >\n                <a-date-picker\n                  :disabled=\"disabledInput\"\n                  v-model:value=\"formState.startDate\"\n                  format=\"YYYY-MM-DD\"\n                  valueFormat=\"YYYY-MM-DD\"\n                  style=\"width: 100%\"\n                />\n              </a-form-item>\n            </a-col>\n            <a-col :span=\"12\">\n              <a-form-item\n                label=\"暂停结束日期\"\n                name=\"endDate\"\n                :labelCol=\"{ style: { width: '124px'} }\" \n                :rules=\"[{ required: true, message: '暂停结束日期不能为空。' }]\"\n              >\n                <a-date-picker\n                  :disabled=\"disabledInput\"\n                  v-model:value=\"formState.endDate\"\n                  format=\"YYYY-MM-DD\"\n                  valueFormat=\"YYYY-MM-DD\"\n                  style=\"width: 100%\"\n                />\n              </a-form-item>\n            </a-col>\n\n            <a-col :span=\"24\">\n              <a-form-item\n                label=\"暂停原因\"\n                name=\"pauseReason\"\n                :labelCol=\"{ style: { width: '124px'} }\" \n                :rules=\"[{ required: true, message: '暂停原因不能为空' }]\"\n              >\n                <a-textarea\n                  v-model:value=\"formState.pauseReason\"\n                  row=\"3\"\n                  maxlength=\"1000\"\n                  :disabled=\"disabledInput\"\n                />\n              </a-form-item>\n            </a-col>\n          </a-row>\n        </a-card>\n        <a-card title=\"附件上传\" :bordered=\"false\">\n          <UploadBox\n            :width=\"800\"\n            :height=\"550\"\n            :maxCount=\"20\"\n            :maxSize=\"100 * 1024 * 1024\"\n            :application=\"`po`\"\n            :module=\"`inspectionpause`\"\n            :vmode=\"formState.status == 0 ? `box` : `view`\"\n            :bizId=\"formState.bizFileId\"\n          />\n        </a-card>\n      </a-form>\n    </div>\n  </div>\n  </a-spin>\n  </div>\n</PageWrapper>\n</template>\n<script lang=\"ts\" setup>\n  import { PageWrapper } from '/@/components/Page';\n  import { reactive, ref, onMounted,toRaw,computed } from 'vue';\n  import { urlToPath } from '/@/utils/route';\n  import { FormInstance } from 'ant-design-vue';\n  // import PrintButton from '/@/components/Framework/Button/PrintButton.vue';\n  import { getPauseData, createPause, getInspectionAreaType } from './create';\n  import BillTitle from '/@/components/Framework/BillTitle/BillTitle.vue';\n  import WfApproveBox from '/@/components/Framework/WorkFlow/WfApproveBox.vue';\n  import * as ProcessInstanceApi from '@/api/bpm/processInstance';\n  import { closeCurrentTab } from '@/utils/route';\n  import { SysMessage } from '/@/hooks/web/useMessage';\n  import { MsgManager } from '/@/message/MsgManager';\n  import UploadBox from '@/components/Framework/Combox/UploadBox.vue';\n  import { buildShortUUID } from '@/utils/uuid';\n  import { useUserStore } from '/@/store/modules/user';\n\n  const userStore = useUserStore();\n  const userInfo = toRaw(userStore.getUserInfo);\n\n  const isRequire = ref(true);\n\n  const formRef = ref<FormInstance>();\n  const inspectionAreData: any = ref([]);\n  const processInstanceId = ref('');\n  let { params: query } = urlToPath() as any;\n  const disabledInput=computed(()=>{\n    return formState.status!=0 || (formState.status==0 && \n          formState.personMemberId !='' && \n          formState.personMemberId.substring(0,32) != userInfo.userId);\n  })\n  const formState: any = reactive({\n    id: query.id || '',\n    status: 0,\n    stationName: query.stationName || '',\n    stationId: query.stationId || '',\n    stationOrganName: query.stationOrganName || '',\n    stationOrganId: query.stationOrganId || '',\n    powerStationType: query.stationType,\n    personMemberId:'',\n    spinning:false,\n  });\n  const billTitle = reactive<any>({subject : '巡检暂停'});\n \n  const onFinish = () => {\n    formState.spinning=true;\n    createPause(formState)\n      .then((rsp) => {\n        if (rsp.result != '') {\n          formState.id = rsp.result;\n          SysMessage.getInstance().success(formState.status == 1 ? '提交成功' : '保存成功.');\n          if (formState.status == 1) {\n            setTimeout(() => {\n              closeCurrentTab();\n              MsgManager.getInstance().sendMsg('inspection-pause', {});\n            }, 100);\n          }\n        } else {\n          formState.status = 0;\n        \n          SysMessage.getInstance().error('保存失败.');\n        }\n        formState.spinning=false;\n      })\n      .catch((e) => {\n        isRequire.value = false;\n        formState.status = 0;\n        formState.spinning=false;\n        console.log(e);\n      });\n  };\n\n  const flowOption = {\n    handleAgree: (flowData) => {\n      console.log('同意', flowData);\n    },\n\n    handleSave: (flowData) => {\n      console.log('保存', flowData);\n      isRequire.value = false;\n      formState.status = 0;\n      onFinish();\n    },\n\n    handleSubmit: (flowData) => {\n      console.log('提交', flowData);\n      isRequire.value = true;\n      formState.status = 1;\n      const value = formRef.value;\n      if (!value) {\n        return;\n      }\n      value\n        .validateFields()\n        .then(() => {\n          onFinish();\n        })\n        .catch((e) => {\n          console.log(e);\n          formState.status = 0;\n        });\n    },\n  };\n\n  const changeInspectionAreaType = (id, item) => {\n    formState.planId = item.planId;\n    formState.planStationId = item.planStationId;\n    formState.inspectionPeriod = item.inspectionPeriodText + item.acount + '次';\n  };\n\n  // global\n  onMounted(async () => {\n    processInstanceId.value = query.processInstanceId as unknown as string;\n\n    if (!formState.id && query.processInstanceId) {\n      let processInstance = null;\n      try {\n        processInstance = await ProcessInstanceApi.getProcessInstance(processInstanceId.value);\n      } catch (error) {\n        //\n      }\n      formState.id = processInstance?.businessKey;\n    }\n\n    const rsp = await getPauseData({ id: formState.id });\n\n    let rs = rsp.result;\n    if (formState.id) {\n      for (let key in rs) {\n        formState[key] = rs[key];\n      }\n      formState.status = Number(formState.status);\n    } else {\n      formState.bizFileId = buildShortUUID();\n      formState.billCode = rs.billCode;\n      formState.personMemberName = rs.personMemberName;\n      formState.deptName=rs.deptName;\n      formState.fillinDate = rs.fillinDate;\n    }\n\n    let { billCode, fillinDate, personMemberName,deptName } = rs;\n    Object.assign(billTitle, { billCode, fillinDate, personMemberName,deptName });\n\n    \tformState.deptName=rs.deptName;\n    const resp = await getInspectionAreaType({ stationId: formState.stationId });\n    resp.result.forEach((e) => {\n      inspectionAreData.value.push({\n        value: e.inspectionAreaType,\n        label: e.inspectionAreaTypeText,\n        planName: e.subject,\n        planId: e.planId,\n        planStationId: e.planStationId,\n        inspectionPeriodText: e.inspectionPeriodText,\n        acount: e.acount,\n      });\n    });\n  });\n</script>\n\n<style lang=\"less\" scoped>\n  .customer_require::before {\n    content: '*';\n    display: inline-block;\n    margin-right: 4px;\n    color: #ff4d4f;\n    font-family: SimSun, sans-serif;\n    font-size: 14px;\n    line-height: 1;\n  }\n</style>\n"],"names":["getPauseData","params","defHttp","createPause","data","getInspectionAreaType","userStore","useUserStore","userInfo","toRaw","isRequire","ref","formRef","inspectionAreData","processInstanceId","query","urlToPath","disabledInput","computed","formState","reactive","billTitle","onFinish","rsp","SysMessage","closeCurrentTab","MsgManager","e","flowOption","flowData","value","changeInspectionAreaType","id","item","onMounted","__async","processInstance","ProcessInstanceApi.getProcessInstance","error","rs","key","buildShortUUID","billCode","fillinDate","personMemberName","deptName"],"mappings":"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"}