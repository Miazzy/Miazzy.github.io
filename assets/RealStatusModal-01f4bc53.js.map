{"version":3,"file":"RealStatusModal-01f4bc53.js","sources":["../../src/views/da/stationOperation/device/RealStatusModal.vue"],"sourcesContent":["<template>\n  <div\n    class=\"modal-box\"\n    :style=\"`width: ${\n      infoData.bizType === 'ewc' || infoData.status === 'offline' ? '4.57rem' : '8.57rem'\n    }`\"\n  >\n    <div\n      class=\"left-box\"\n      :style=\"`width: ${\n        infoData.bizType === 'ewc' || infoData.status === 'offline' ? '100%' : '45%'\n      }`\"\n    >\n      <div class=\"tab-box\">\n        <div\n          class=\"tab-item\"\n          :class=\"{ active: curTabIndex === item.tabIndex }\"\n          v-for=\"(item, index) in tabList\"\n          :key=\"index\"\n          @click=\"handleTabClick(item)\"\n          >{{ item.tabLabel }}</div\n        >\n      </div>\n      <div class=\"left-content\">\n        <div v-if=\"curTabIndex === '1'\" class=\"basic-info\">\n          <!-- 电子工牌 -->\n          <template v-if=\"infoData.bizType === 'ewc'\">\n            <div class=\"info-item\">\n              <div class=\"label-box\">设备编号：</div>\n              <div class=\"value-box\">\n                <span class=\"value-text\" :title=\"infoData.deviceCode\">{{\n                  infoData.deviceCode\n                }}</span>\n              </div>\n            </div>\n            <div class=\"info-item\">\n              <div class=\"label-box\">状态：</div>\n              <div class=\"value-box\">\n                <div :class=\"`status-tag ${infoData.status}`\">{{ infoData.statusText }}</div>\n              </div>\n            </div>\n            <div class=\"info-item\">\n              <div class=\"label-box\">SIM卡号：</div>\n              <div class=\"value-box\">\n                <div class=\"value-text\">{{ infoData.simNumber }}</div>\n              </div>\n            </div>\n            <div class=\"info-item\">\n              <div class=\"label-box\">姓名：</div>\n              <div class=\"value-box\">\n                <div class=\"value-text\">{{ infoData.userName }}</div>\n              </div>\n            </div>\n            <div class=\"info-item\">\n              <div class=\"label-box\">最近定位时间：</div>\n              <div class=\"value-box\">\n                <div class=\"value-text\">{{ infoData.locDate }}</div>\n              </div>\n            </div>\n            <div class=\"info-item\">\n              <div class=\"label-box\">最近定位：</div>\n              <div class=\"value-box\">\n                <div class=\"value-text\">{{ infoData.address }}</div>\n              </div>\n            </div>\n          </template>\n          <!-- 巡检仪 -->\n          <template v-if=\"infoData.bizType === 'ii'\">\n            <div class=\"info-item\">\n              <div class=\"label-box\">设备编号：</div>\n              <div class=\"value-box\">\n                <span class=\"value-text\" :title=\"infoData.deviceCode\">{{\n                  infoData.deviceCode\n                }}</span>\n              </div>\n            </div>\n            <div class=\"info-item\">\n              <div class=\"label-box\">状态：</div>\n              <div class=\"value-box\">\n                <div :class=\"`status-tag ${infoData.status}`\">{{ infoData.statusText }}</div>\n              </div>\n            </div>\n            <div v-if=\"infoData.status === 'online'\" class=\"info-item\">\n              <div class=\"label-box\">实时视频：</div>\n              <div class=\"value-box\">\n                <button class=\"value-btn\" @click=\"handleViewVideo\">\n                  <i class=\"iconfont icon-bofang btn-icon\"></i><span class=\"btn-text\">查看</span>\n                </button>\n              </div>\n            </div>\n            <div class=\"info-item\">\n              <div class=\"label-box\">所属电站：</div>\n              <div class=\"value-box\">\n                <div class=\"value-text\">{{ infoData.stationShortName }}</div>\n              </div>\n            </div>\n            <div class=\"info-item\">\n              <div class=\"label-box\">定位时间：</div>\n              <div class=\"value-box\">\n                <div class=\"value-text\">{{ infoData.locDate }}</div>\n              </div>\n            </div>\n            <div class=\"info-item\">\n              <div class=\"label-box\">位置：</div>\n              <div class=\"value-box\">\n                <div class=\"value-text\">{{ infoData.address }}</div>\n              </div>\n            </div>\n          </template>\n          <!-- 行车记录仪 -->\n          <template v-if=\"infoData.bizType === 'dr'\">\n            <div class=\"info-item\">\n              <div class=\"label-box\">设备编号：</div>\n              <div class=\"value-box\">\n                <span class=\"value-text\" :title=\"infoData.deviceCode\">{{\n                  infoData.deviceCode\n                }}</span>\n              </div>\n            </div>\n            <div class=\"info-item\">\n              <div class=\"label-box\">状态：</div>\n              <div class=\"value-box\">\n                <div :class=\"`status-tag ${infoData.status}`\">{{ infoData.statusText }}</div>\n              </div>\n            </div>\n            <div v-if=\"infoData.status === 'online'\" class=\"info-item\">\n              <div class=\"label-box\">实时视频：</div>\n              <div class=\"value-box\">\n                <button class=\"value-btn\" @click=\"handleViewVideo\">\n                  <i class=\"iconfont icon-bofang btn-icon\"></i><span class=\"btn-text\">查看</span>\n                </button>\n              </div>\n            </div>\n            <div class=\"info-item\">\n              <div class=\"label-box\">车牌号：</div>\n              <div class=\"value-box\">\n                <div class=\"value-text\">{{ infoData.plateNumber }}</div>\n              </div>\n            </div>\n            <div class=\"info-item\">\n              <div class=\"label-box\">车辆类型：</div>\n              <div class=\"value-box\">\n                <div class=\"value-text\">{{ infoData.vehicleTypeText }}</div>\n              </div>\n            </div>\n            <div class=\"info-item\">\n              <div class=\"label-box\">指定驾驶员：</div>\n              <div class=\"value-box\">\n                <div class=\"value-text\">{{ infoData.responsiblePersonName }}</div>\n              </div>\n            </div>\n            <div class=\"info-item\">\n              <div class=\"label-box\">测速定位时间：</div>\n              <div class=\"value-box\">\n                <div class=\"value-text\">{{ infoData.locDate }}</div>\n              </div>\n            </div>\n            <div class=\"info-item\">\n              <div class=\"label-box\">速度(km/h)：</div>\n              <div class=\"value-box\">\n                <div class=\"value-text\">{{ infoData.speed }}</div>\n              </div>\n            </div>\n            <div class=\"info-item\">\n              <div class=\"label-box\">位置：</div>\n              <div class=\"value-box\">\n                <div class=\"value-text\">{{ infoData.address }}</div>\n              </div>\n            </div>\n          </template>\n        </div>\n        <div v-if=\"curTabIndex === '2'\" class=\"basic-info\">\n          <TrackReplay\n            :infoData=\"infoData\"\n            :disabledBtn=\"disabledBtn\"\n            @search=\"handleSearch\"\n            @replay=\"handleReplay\"\n            @pause=\"handlePause\"\n            @go-on=\"handleGoOn\"\n            @end=\"handleEnd\"\n            @change-date=\"handleChangeDate\"\n            @change-time=\"handleChangeTime\"\n          />\n        </div>\n        <div v-if=\"curTabIndex === '3'\" class=\"basic-info\">\n          <HistoryVideo\n            :inspectionInstrumentId=\"infoData.inspectionInstrumentId\"\n            @row-click=\"handleRowClick\"\n          />\n        </div>\n      </div>\n    </div>\n    <div\n      v-if=\"\n        infoData.status === 'online' && (infoData.bizType === 'ii' || infoData.bizType === 'dr')\n      \"\n      class=\"right-box\"\n    >\n      <MonitorVideoItem\n        ref=\"monitorVideoRef\"\n        :devId=\"infoData.deviceCode\"\n        :videoType=\"videoType\"\n        :videoSrc=\"videoSrc\"\n        :width=\"`100%`\"\n        :height=\"`auto`\"\n        :title=\"infoData.deviceCode\"\n      />\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\n  import { ref, onMounted, reactive, onUnmounted } from 'vue';\n  import MonitorVideoItem from '/@/components/Framework/OperationScreen/MonitorVideoItem.vue';\n  import { useMessage } from '/@/hooks/web/useMessage';\n  import dayjs from 'dayjs';\n  import TrackReplay from '../../components/TrackReplay.vue';\n  import HistoryVideo from './HistoryVideo.vue';\n  import * as SmartDeviceApi from '/@/api/monitor/smartdevice';\n  import { MsgManager } from '@/message/MsgManager';\n\n  const props = defineProps({\n    infoData: {\n      type: Object,\n      require: true,\n      default: () => {},\n    },\n    closeModal: {\n      type: Function,\n      require: true,\n      default: () => {},\n    },\n  });\n  const message = useMessage();\n  const curTabIndex = ref('1');\n  const tabList = ref<Array<any>>([]);\n  const initTabList = () => {\n    // 目前只显示基本信息\n    let tabs = [\n      { tabIndex: '1', tabLabel: '基本信息' },\n      // { tabIndex: '2', tabLabel: '轨迹回放' },\n    ];\n    // if (props.infoData.bizType === 'ii') {\n    //   tabs.push({ tabIndex: '3', tabLabel: '历史视频' });\n    // }\n    tabList.value = tabs;\n  };\n  const searchInfo = reactive({\n    locDate: dayjs().format('YYYY-MM-DD'),\n    startLocDate: '',\n    endLocDate: '',\n  });\n  const disabledBtn = reactive({ replay: true, pause: true, goOn: true, end: true });\n  // 轨迹动画持续时长ms\n  const trackDuration = ref<number>(60000);\n  const monitorVideoRef = ref();\n  const videoType = ref<string>('real');\n  const videoSrc = ref();\n\n  const handleTabClick = (item) => {\n    curTabIndex.value = item.tabIndex;\n  };\n\n  // 查看实时视频\n  const handleViewVideo = () => {\n    monitorVideoRef.value.openVideo();\n  };\n\n  const getGpsList = async () => {\n    if (props.infoData.bizType === 'ewc') {\n      return await SmartDeviceApi.getEwcGpsList({\n        eleWorkCardId: props.infoData.eleWorkCardId,\n        ...searchInfo,\n      });\n    }\n    if (props.infoData.bizType === 'dr') {\n      return await SmartDeviceApi.getDrGpsList({\n        drivingRecorderId: props.infoData.drivingRecorderId,\n        ...searchInfo,\n      });\n    }\n    if (props.infoData.bizType === 'ii') {\n      return await SmartDeviceApi.getIiGpsList({\n        inspectionInstrumentId: props.infoData.inspectionInstrumentId,\n        ...searchInfo,\n      });\n    }\n    return [];\n  };\n\n  // 查询\n  const handleSearch = async () => {\n    if (!searchInfo.locDate) {\n      message.error('请选择日期');\n      return;\n    }\n    const data = await getGpsList();\n    if (!data || data.length == 0) {\n      message.error('未查询到轨迹数据');\n      disabledBtn.replay = true;\n      return;\n    }\n    disabledBtn.replay = false;\n    // 发送绘制轨迹消息\n    MsgManager.getInstance().sendMsg('smart-device-track', {\n      trackParams: {\n        type: 'track',\n        trackDuration: trackDuration.value,\n      },\n      record: props.infoData,\n      data: data,\n    });\n  };\n\n  // 回放\n  const handleReplay = (speed) => {\n    let duration = trackDuration.value;\n    if (speed > 0) {\n      duration = duration / speed;\n    }\n    // 发送回放消息\n    MsgManager.getInstance().sendMsg('smart-device-track', {\n      trackParams: {\n        type: 'replay',\n        duration: duration,\n      },\n    });\n\n    disabledBtn.pause = false;\n    disabledBtn.end = false;\n  };\n\n  // 暂停\n  const handlePause = () => {\n    // 发送暂停消息\n    MsgManager.getInstance().sendMsg('smart-device-track', {\n      trackParams: {\n        type: 'pause',\n      },\n    });\n\n    disabledBtn.goOn = false;\n  };\n\n  // 继续\n  const handleGoOn = () => {\n    // 发送继续消息\n    MsgManager.getInstance().sendMsg('smart-device-track', {\n      trackParams: {\n        type: 'continue',\n      },\n    });\n  };\n\n  // 结束\n  const handleEnd = () => {\n    // 发送结束消息\n    MsgManager.getInstance().sendMsg('smart-device-track', {\n      trackParams: {\n        type: 'cancel',\n      },\n    });\n\n    disabledBtn.pause = true;\n    disabledBtn.goOn = true;\n  };\n\n  const handleChangeDate = (value) => {\n    searchInfo.locDate = value;\n  };\n\n  const handleChangeTime = (values: Array<string>) => {\n    searchInfo.startLocDate = dayjs(values[0]).format('HH:mm');\n    searchInfo.endLocDate = dayjs(values[1]).format('HH:mm');\n  };\n\n  const handleRowClick = (record) => {\n    videoType.value = 'history';\n    videoSrc.value = 'http://' + record.filePath;\n  };\n\n  const closeInspectionModal = (e) => {\n    // 点击地图覆盖物不关闭\n    if (e.target.classList.contains('BMap_noprint')) {\n      return;\n    }\n    if (e.target.closest('.satellite-map') || e.target.closest('.footer.footer-layout')) {\n      props.closeModal();\n    }\n  };\n\n  onMounted(() => {\n    initTabList();\n    window.addEventListener('click', closeInspectionModal);\n  });\n\n  onUnmounted(() => {\n    window.removeEventListener('click', closeInspectionModal);\n  });\n</script>\n\n<style lang=\"less\" scoped>\n  .modal-box {\n    display: flex;\n    position: absolute;\n    z-index: 12;\n    top: 50vh;\n    left: 40%;\n    align-items: center;\n    width: 8.57rem;\n    padding: 0.16rem;\n    transform: translateY(-50%);\n    background: url('../../../../assets/images/operationScreen/modal-bg.png') no-repeat center/100%\n      100%;\n\n    .left-box {\n      width: 45%;\n    }\n\n    .right-box {\n      width: 55%;\n      padding-left: 0.2rem;\n    }\n\n    .tab-box {\n      display: flex;\n      justify-content: flex-start;\n\n      .tab-item {\n        padding: 0.17rem 0.03rem 0.11rem;\n        border-bottom: 0.03rem solid transparent;\n        color: #fff;\n        font-size: 0.16rem;\n        line-height: 1;\n        cursor: pointer;\n\n        &.active {\n          border-bottom-color: #1890ff;\n          color: #1890ff;\n        }\n\n        & + .tab-item {\n          margin-left: 0.32rem;\n        }\n      }\n    }\n\n    .basic-info {\n      .info-item {\n        display: flex;\n        width: 100%;\n        height: 0.49rem;\n        border-bottom: 0.01rem solid rgb(220 223 230 / 24%);\n        color: #fff;\n        font-size: 0.14rem;\n        line-height: 1;\n\n        .label-box {\n          width: 7em;\n          margin-right: 0.14rem;\n          padding-top: 0.17rem;\n          text-align: right;\n        }\n\n        &:last-child {\n          border-bottom-color: transparent;\n        }\n\n        .value-box {\n          flex: 1;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n        }\n\n        .value-btn {\n          height: 0.24rem;\n          margin-top: 0.12rem;\n          margin-left: 0.06rem;\n          padding: 0 0.1rem;\n          border-radius: 0.02rem;\n          background-color: #1890ff;\n          color: #fff;\n          font-size: 0.12rem;\n          line-height: 0.24rem;\n          cursor: pointer;\n\n          .btn-icon {\n            margin-right: 0.04rem;\n            font-size: 0.12rem;\n            line-height: 0.24rem;\n          }\n        }\n\n        .value-text {\n          display: inline-block;\n          padding-top: 0.15rem;\n          line-height: 0.18rem;\n        }\n\n        .status-tag {\n          display: inline-block;\n          height: 0.2rem;\n          margin-top: 0.14rem;\n          padding: 0 0.08rem;\n          border: 0.01rem solid transparent;\n          border-radius: 0.02rem;\n          font-size: 0.12rem;\n          line-height: 0.18rem;\n\n          &.online {\n            border-color: rgb(82 196 26 / 100%);\n            background-color: rgb(82 196 26 / 20%);\n            color: rgb(82 196 26 / 70%);\n          }\n\n          &.offline {\n            border-color: rgb(255 77 79 / 100%);\n            background-color: rgb(255 77 79 / 20%);\n            color: rgb(255 77 79 / 70%);\n          }\n        }\n      }\n    }\n  }\n</style>\n"],"names":["message","useMessage","curTabIndex","ref","tabList","initTabList","tabs","searchInfo","reactive","dayjs","disabledBtn","trackDuration","monitorVideoRef","videoType","videoSrc","handleTabClick","item","handleViewVideo","getGpsList","__async","props","SmartDeviceApi.getEwcGpsList","__spreadValues","SmartDeviceApi.getDrGpsList","SmartDeviceApi.getIiGpsList","handleSearch","data","MsgManager","handleReplay","speed","duration","handlePause","handleGoOn","handleEnd","handleChangeDate","value","handleChangeTime","values","handleRowClick","record","closeInspectionModal","e","onMounted","onUnmounted"],"mappings":"wiJAyOQA,EAAUC,IACVC,EAAcC,EAAI,GAAG,EACrBC,EAAUD,EAAgB,CAAA,CAAE,EAC5BE,EAAc,IAAM,CAExB,IAAIC,EAAO,CACT,CAAE,SAAU,IAAK,SAAU,MAAO,CAAA,EAMpCF,EAAQ,MAAQE,CAAA,EAEZC,EAAaC,EAAS,CAC1B,QAASC,EAAA,EAAQ,OAAO,YAAY,EACpC,aAAc,GACd,WAAY,EAAA,CACb,EACKC,EAAcF,EAAS,CAAE,OAAQ,GAAM,MAAO,GAAM,KAAM,GAAM,IAAK,EAAM,CAAA,EAE3EG,EAAgBR,EAAY,GAAK,EACjCS,EAAkBT,IAClBU,EAAYV,EAAY,MAAM,EAC9BW,EAAWX,IAEXY,EAAkBC,GAAS,CAC/Bd,EAAY,MAAQc,EAAK,QAAA,EAIrBC,EAAkB,IAAM,CAC5BL,EAAgB,MAAM,WAAU,EAG5BM,EAAa,IAAYC,EAAA,sBACzB,OAAAC,EAAM,SAAS,UAAY,MACtB,MAAMC,GAA6BC,EAAA,CACxC,cAAeF,EAAM,SAAS,eAC3Bb,EACJ,EAECa,EAAM,SAAS,UAAY,KACtB,MAAMG,GAA4BD,EAAA,CACvC,kBAAmBF,EAAM,SAAS,mBAC/Bb,EACJ,EAECa,EAAM,SAAS,UAAY,KACtB,MAAMI,GAA4BF,EAAA,CACvC,uBAAwBF,EAAM,SAAS,wBACpCb,EACJ,EAEI,EAAC,GAIJkB,EAAe,IAAYN,EAAA,sBAC3B,GAAA,CAACZ,EAAW,QAAS,CACvBP,EAAQ,MAAM,OAAO,EACrB,MACF,CACM,MAAA0B,EAAO,MAAMR,IACnB,GAAI,CAACQ,GAAQA,EAAK,QAAU,EAAG,CAC7B1B,EAAQ,MAAM,UAAU,EACxBU,EAAY,OAAS,GACrB,MACF,CACAA,EAAY,OAAS,GAEViB,EAAA,YAAA,EAAc,QAAQ,qBAAsB,CACrD,YAAa,CACX,KAAM,QACN,cAAehB,EAAc,KAC/B,EACA,OAAQS,EAAM,SACd,KAAAM,CAAA,CACD,CAAA,GAIGE,EAAgBC,GAAU,CAC9B,IAAIC,EAAWnB,EAAc,MACzBkB,EAAQ,IACVC,EAAWA,EAAWD,GAGbF,EAAA,YAAA,EAAc,QAAQ,qBAAsB,CACrD,YAAa,CACX,KAAM,SACN,SAAAG,CACF,CAAA,CACD,EAEDpB,EAAY,MAAQ,GACpBA,EAAY,IAAM,EAAA,EAIdqB,EAAc,IAAM,CAEbJ,EAAA,YAAA,EAAc,QAAQ,qBAAsB,CACrD,YAAa,CACX,KAAM,OACR,CAAA,CACD,EAEDjB,EAAY,KAAO,EAAA,EAIfsB,EAAa,IAAM,CAEZL,EAAA,YAAA,EAAc,QAAQ,qBAAsB,CACrD,YAAa,CACX,KAAM,UACR,CAAA,CACD,CAAA,EAIGM,EAAY,IAAM,CAEXN,EAAA,YAAA,EAAc,QAAQ,qBAAsB,CACrD,YAAa,CACX,KAAM,QACR,CAAA,CACD,EAEDjB,EAAY,MAAQ,GACpBA,EAAY,KAAO,EAAA,EAGfwB,EAAoBC,GAAU,CAClC5B,EAAW,QAAU4B,CAAA,EAGjBC,EAAoBC,GAA0B,CAClD9B,EAAW,aAAeE,EAAM4B,EAAO,CAAC,CAAC,EAAE,OAAO,OAAO,EACzD9B,EAAW,WAAaE,EAAM4B,EAAO,CAAC,CAAC,EAAE,OAAO,OAAO,CAAA,EAGnDC,EAAkBC,GAAW,CACjC1B,EAAU,MAAQ,UACTC,EAAA,MAAQ,UAAYyB,EAAO,QAAA,EAGhCC,EAAwBC,GAAM,CAE9BA,EAAE,OAAO,UAAU,SAAS,cAAc,IAG1CA,EAAE,OAAO,QAAQ,gBAAgB,GAAKA,EAAE,OAAO,QAAQ,uBAAuB,IAChFrB,EAAM,WAAW,CACnB,EAGF,OAAAsB,GAAU,IAAM,CACFrC,IACL,OAAA,iBAAiB,QAASmC,CAAoB,CAAA,CACtD,EAEDG,GAAY,IAAM,CACT,OAAA,oBAAoB,QAASH,CAAoB,CAAA,CACzD"}