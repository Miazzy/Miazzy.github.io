{"version":3,"file":"index-554ed12e.js","sources":["../../src/views/po/safety/safecheckissue/safeCheckIssue.ts","../../src/views/po/safety/safecheckissue/index.vue"],"sourcesContent":["import { BasicColumn, FormSchema, useRender } from '@/components/Table';\nimport { defHttp } from '@/utils/http/axios';\n\n\nenum Api {\n  getSafeCheckIssuePage = '/po/safe-check-issue/page',\n  getIssueData = '/po/safe-check-issue/get',\n  // deleteIssueData = '/po/safe-check-issue/delete',\n  exportIssueData = '/po/safe-check-issue/export-excel',\n}\n\n// 查询安全检查模版下发列表\nexport function getSafeCheckIssuePage(params) {\n  return defHttp.get({ url: Api.getSafeCheckIssuePage, params });\n}\n// 删除安全检查模版下发\n// export function deleteSafeCheckIssue(id: string) {\n//   return defHttp.delete({ url: Api.deleteIssueData + '?id=' + id });\n// }\nexport function getIssueData(params) {\n  return defHttp.get({ url: Api.getIssueData, params });\n}\n\n// 导出安全检查模版下发 Excel\nexport function exportSafeCheckIssue(params) {\n  return defHttp.download({ url: Api.exportIssueData, params }, { isReturnNativeResponse: true });\n}\n\nconst statusColor = {\n  0: '#dc0000', // 草稿\n  1: '#338ed1', // 处理中\n  2: '#30ca5a', // 通过\n  3: '#929292', // 不通过\n  4: '#929292', // 已取消\n  5: '#929292', // 已终止\n  6: '#fda941', // 退回/驳回\n};\nexport const columns: BasicColumn[] = [\n  { title: '单据编号', dataIndex: 'billCode', width: 165, sorter: true, resizable: true },\n  { title: '主题', dataIndex: 'subject', align: 'left',headAlign:'center', width: 165, sorter: true, resizable: true },\n  { title: '任务日期', dataIndex: 'taskDate', width: 165, sorter: true, resizable: true },\n  { title: '专项检查模板', dataIndex: 'templateName', width: 200, sorter: true, resizable: true },\n  { title: '下发人', dataIndex: 'issuedPersonName', width: 130, sorter: true, resizable: true },\n  { title: '下发电站', dataIndex: 'issueComplete',align: 'right',headAlign:'center', width: 130, sorter: true, resizable: true },\n  { title: '已完成电站', dataIndex: 'issueCompleteNum',align: 'right',headAlign:'center', width: 130, sorter: true, resizable: true },\n  {\n    title: '审批状态',\n    dataIndex: 'statusText',\n    width: 130,\n    sorter: true,\n    resizable: true,\n    customRender: ({ text, record }) => {\n      return useRender.renderTag(text, statusColor[record.status]);\n    },\n  },\n  { title: '创建人', dataIndex: 'personMemberName', width: 130, sorter: true, resizable: true },\n  { title: '创建时间', dataIndex: 'fillinDate', sorter: true, resizable: true },\n];\n\nexport const searchFormSchema: FormSchema[] = [\n  {\n    label: '单据编号',\n    field: 'billCode',\n    component: 'Input',\n    colProps: { span: 8 },\n  },\n  {\n    label: '主题',\n    field: 'subject',\n    component: 'Input',\n    colProps: { span: 8 },\n  },\n  {\n    field: '[startTaskDate, endTaskDate]',\n    label: '任务时间',\n    component: 'RangePicker',\n    colProps: { span: 8 },\n    componentProps: {\n      format: 'YYYY-MM-DD',\n      valueFormat: 'YYYY-MM-DD',\n      placeholder: ['开始日期', '结束日期'],\n    },\n  },\n  {\n    label: '状态',\n    field: 'status',\n    component: 'DictSelectBox',\n    componentProps: {\n      type: 'bpm_process_instance_result',\n    },\n    colProps: { span: 8 },\n  },\n];\n","<template>\n<PageWrapper dense contentFullHeight fixedHeight contentClass=\"flex\"  style=\"position: relative\">\n    <BasicTable @register=\"registerTable\"\n    @resize-column=\"(w, col) => (col.width = w)\"\n    @row-dbClick=\"dbClick\"\n    @selection-change=\"handleSelectChange\"\n    >\n      <template #toolbar>\n        <a-button type=\"primary\" :preIcon=\"IconEnum.ADD\" @click=\"handleCreate\">\n          {{ '添加' }}\n        </a-button>\n        <a-button class=\"red-btn\" :disabled=\"selectedRowId == ''\" :preIcon=\"IconEnum.DELETE\" @click=\"handleCancel\">\n          {{ '删除' }}\n        </a-button>\n        <a-button class=\"yellow-btn\" :preIcon=\"IconEnum.EXPORT\" @click=\"handleExport\">\n          {{ '导出' }}\n        </a-button>\n      </template>\n      <template #bodyCell=\"{ column, text, record }\">\n        <template v-if=\"column.dataIndex === 'templateName'\">\n          <a @click=\"openPage(`${record.templateId}`)\" target=\"_blank\">\n            {{ text }}\n          </a>\n        </template>\n      </template>\n    </BasicTable>\n  </PageWrapper>\n</template>\n\n<script lang=\"ts\" setup>\n\timport * as CommonUtil from '/@/utils/common';\n  import { PageWrapper } from '/@/components/Page';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { useMessage,SysMessage } from '@/hooks/web/useMessage';\n  import { IconEnum } from '@/enums/appEnum';\n  import { BasicTable, useTable,SorterResult } from '@/components/Table';\n  import { MsgManager } from '/@/message/MsgManager';\n  import { ref, onMounted } from 'vue';\n  import { exportExcelFile } from '@/utils/file/download';\n  import { deleteProcessInstance } from '@/api/bpm/processInstance';\n  import {\n    columns,\n    searchFormSchema,\n    getSafeCheckIssuePage,\n    exportSafeCheckIssue,\n  } from './safeCheckIssue';\n  import { addTabPage } from '@/utils/route';\n\n  const queryParam:any = ref({\n    status: '',\n    checkType: '',\n    subject: '',\n    billCode: '',\n    startTaskDate: '',\n    endTaskDate: '',\n    pageNo: 1,\n    pageSize: 10,\n    sortField: 'fillinDate',\n    sortOrder: 'desc'\n  });\n  let selectedRowId = ref('');\n  defineOptions({ name: 'SafeCheckIssue' });\n\n  const openPage = (templateId) => {\n    // router.push(`/po/safety/safechecktemplate/create?id=` + templateId);\n    addTabPage(`/po/safety/safechecktemplate/create?id=` + templateId,'查看专项检查下发');\n  };\n\n  const { t } = useI18n();\n  const { createConfirm, createMessage } = useMessage();\n\n  const [registerTable, { getForm, reload, getPaginationRef,getSelectRows }] = useTable({\n    title: '专项检查下发',\n    api: async () => {\n      const paginationRef = getPaginationRef() as any;\n      queryParam.value.pageNo = paginationRef.current;\n      queryParam.value.pageSize = paginationRef.pageSize;\n      let dataObj = await getSafeCheckIssuePage(queryParam.value);\n      return dataObj.result;\n    },\n    columns,\n    rowKey: 'id',\n    bordered: true,\n    formConfig: { \n      labelWidth: 120,\n      schemas: searchFormSchema,\n      showAdvancedButton:true,\n      autoAdvancedLine:1, \n     },\n     sortFn: (sortInfo: SorterResult) => {\n      if (sortInfo.order) {\n        queryParam.value.sortField = sortInfo.field.replace('Text', '');\n        queryParam.value.sortOrder = sortInfo.order.replace('end', '');\n      } else {\n        queryParam.value.sortField = 'fillinDate';\n        queryParam.value.sortOrder = 'desc';\n      }\n    },\n    useSearchForm: true,\n    showTableSetting: true,\n    rowSelection: {\n      type: 'radio',\n      fixed: true,\n      onSelect: onSelect\n    },\n    handleSearchInfoFn(info) {\n      for (const key in info) {\n        queryParam.value[key] = info[key];\n      }\n    }\n  });\n\n  function onSelect(record, selected) {\n    if (selected) {\n      selectedRowId.value = record.id;\n    } else {\n      selectedRowId.value = '';\n    }\n  }\n  function handleSelectChange({ keys, rows }) {\n    if (rows && rows.length > 0) {\n      const record = rows[0];\n      selectedRowId.value = record.id;\n    } else {\n      selectedRowId.value = '';\n    }\n  }\n\n  function handleCreate() {\n    // router.push(`/po/safety/safecheckissue/create?id=`);\n    addTabPage(`/po/safety/safecheckissue/create?id=`,'添加专项检查下发');\n  }\n  const dbClick=(record, index, event)=>{\n        handleEdit(record);\n  }\n  function handleEdit(record) {\n    // let str='';\n    // if(record.status==0){\n    //   str='修改'\n    // } else if (record.status==1){\n    //   str='审批'\n    // } else {\n    //   str='查看'\n    // }\n    // addTabPage(\n    //   `/po/safety/safecheckissue/create?id=${record.id}&processInstanceId=${record.processInstanceId}`,\n    //   (str+'专项检查下发')\n    // );\n    CommonUtil.toFlowPage(record.id);\n  }\n\n  const handleCancel = async () => {\n    let rows = getSelectRows();\n    if(rows.length != 1){\n      SysMessage.getInstance().success('请选择一行数据');\n      return;\n    }\n    let record = rows[0];\n\n    createConfirm({\n      title: '提示',\n      iconType: 'warning',\n      content: '确定要删除选中的记录？',\n      async onOk() {\n        if(record.status !=0){\n          SysMessage.getInstance().success('非草稿状态不能删除');\n          return;\n        }\n        await deleteProcessInstance(record.processInstanceId);\n        SysMessage.getInstance().success('删除成功');\n        reload();\n      },\n    });\n   \n  };\n\n  async function handleExport() {\n    createConfirm({\n      title: t('common.exportTitle'),\n      iconType: 'warning',\n      content: t('common.exportMessage'),\n      async onOk() {\n        let exportParams = getForm().getFieldsValue();\n        Object.assign(exportParams,queryParam.value);\n        await exportSafeCheckIssue(exportParams).then((res) => {\n          exportExcelFile(res?.data, '专项检查下发.xls');\n        });\n        createMessage.success(t('common.exportSuccessText'));\n      },\n    });\n  }\n  onMounted(() => {\n    MsgManager.getInstance().listen('safe-check-issue',  ()=>{\n      reload()\n    });\n  });\n</script>\n"],"names":["getSafeCheckIssuePage","params","defHttp","exportSafeCheckIssue","statusColor","columns","text","record","useRender","searchFormSchema","queryParam","ref","selectedRowId","openPage","templateId","addTabPage","t","useI18n","createConfirm","createMessage","useMessage","registerTable","getForm","reload","getPaginationRef","getSelectRows","useTable","__async","paginationRef","sortInfo","onSelect","info","key","selected","handleSelectChange","keys","rows","handleCreate","dbClick","index","event","handleEdit","CommonUtil.toFlowPage","handleCancel","SysMessage","deleteProcessInstance","handleExport","exportParams","res","exportExcelFile","onMounted","MsgManager"],"mappings":"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"}