{"version":3,"file":"index-d31b651c.js","sources":["../../src/views/system/loginfo/loginlog/index.ts","../../src/views/system/loginfo/loginlog/index.vue"],"sourcesContent":["import { defHttp } from '/@/utils/http/axios';\nimport { BasicColumn, FormSchema } from '/@/components/Table';\n\nenum Api {\n  indexPage = '/system/login-log/page',\n  exportExcel = '/system/login-log/export',\n}\n\nexport const searchFormSchema: FormSchema[] = [\n  {\n    field: 'userIp',\n    component: 'Input',\n    label: '登陆地址',\n    colProps: {\n      span: 7,\n    },\n    required: false,\n  },\n  {\n    field: 'username',\n    component: 'Input',\n    label: '用户名称',\n    colProps: {\n      span: 7,\n    },\n    required: false,\n  },\n  {\n    field: 'status',\n    label: '登录状态',\n    component: 'Select',\n    componentProps: {\n      options: [\n        { value: 1, label: '成功' },\n        { value: 0, label: '失败' },\n      ],\n    },\n    colProps: {\n      span: 7,\n    },\n    required: false,\n  },\n  {\n    field: 'createTime',\n    component: 'RangePicker',\n    label: '登录时间',\n    componentProps: {\n      showTime: true,\n      width: '100%',\n      // format: 'YYYY-MM-DD',\n      format: 'YYYY-MM-DD HH:mm:ss',\n      valueFormat: 'YYYY-MM-DD HH:mm:ss',\n    },\n    colProps: {\n      span: 7,\n    },\n    required: false,\n  },\n];\n\n// 列表表头\nexport const columns: BasicColumn[] = [\n  {\n    title: '访问编码',\n    dataIndex: 'id',\n    align: 'center',\n    resizable: true,\n    width: 100,\n  },\n  {\n    title: '日志类型',\n    dataIndex: 'logTypeText',\n    resizable: true,\n    width: 100,\n  },\n  {\n    title: '用户名称',\n    dataIndex: 'username',\n    resizable: true,\n    align: 'center',\n    width: 100,\n  },\n  {\n    title: '登录地址',\n    dataIndex: 'userIp',\n    resizable: true,\n    width: 120,\n  },\n  {\n    title: '结果',\n    dataIndex: 'resultText',\n    resizable: true,\n    align: 'left',\n    width: 120,\n  },\n  {\n    title: '登陆日期',\n    dataIndex: 'createTime',\n    resizable: true,\n    align: 'center',\n    width: 120,\n  },\n];\n\n// 列表数据\nexport const getDataPage = (params) =>\n  defHttp.post(\n    {\n      url: Api.indexPage,\n      params,\n    },\n    { isOnlyResult: true },\n  );\n\n// 导出\nexport function exportExcel(params) {\n  return defHttp.download({ url: Api.exportExcel, params }, '登录日志.xls');\n}\n","<template>\n  <PageWrapper dense contentFullHeight fixedHeight contentClass=\"flex\" style=\"position: relative\">\n    <!-- 数据表格 -->\n    <BasicTable\n      class=\"fix-basic-table\"\n      @register=\"registerTable\"\n      :searchInfo=\"searchInfo\"\n      @edit-end=\"handleEditEnd\"\n      @selection-change=\"handleSelectChange\"\n      @resize-column=\"(w, col) => (col.width = w)\"\n    >\n      <template #toolbar>\n        <a-button class=\"yellow-btn\" @click=\"exportData\" :preIcon=\"IconEnum.EXPORT\">\n          导出\n        </a-button>\n      </template>\n      <template #bodyCell=\"{ text, column, record }\"> </template>\n    </BasicTable>\n  </PageWrapper>\n</template>\n<script lang=\"ts\" setup>\n  import { onMounted, reactive, ref, nextTick } from 'vue';\n  import { BasicTable, useTable, TableAction } from '/@/components/Table';\n  import { PageWrapper } from '/@/components/Page';\n  import { IconEnum } from '@/enums/appEnum';\n  import { message } from 'ant-design-vue';\n  import DictSelectBox from '@/components/Framework/Combox/DictSelectBox.vue';\n  import PrintButton from '/@/components/Framework/Button/PrintButton.vue';\n  import { columns, getDataPage, searchFormSchema, exportExcel } from './index.ts';\n  import { assign } from 'lodash-es';\n  import { updateIndex } from '/@/views/baseset/operation/safecheck/safeCheckSet';\n  import { exportExcelFile } from '@/utils/file/download';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { useMessage } from '@/hooks/web/useMessage';\n  const { t } = useI18n();\n  const { createConfirm, createMessage } = useMessage();\n\n  const searchInfo = reactive<Recordable>({}); // 查询信息\n  const configVisible = ref<boolean>(false);\n  const detailVisible = ref<boolean>(false);\n  const formState = reactive({\n    name: '',\n    id: '',\n    kind: '',\n    evaluationMethod: '',\n    assessTarget: '',\n    scoreRuleDesc: '',\n    allowOverrun: '',\n  });\n  const sqlFormState = reactive({});\n  const detailTitle = ref('');\n  const isEdit = ref<boolean>(false);\n  const isShow = ref<boolean>(false);\n  const indexFormRef = ref<FormInstance>();\n  const sqlFormRef = ref<FormInstance>();\n  let selectedRow = reactive({});\n  let selectedRowId = ref('');\n\n  const getDataListParam = async () => {\n    let searchForm = getForm().getFieldsValue();\n    const paginationRef = getPaginationRef() as any;\n    searchForm.pageNo = paginationRef.current;\n    searchForm.pageSize = paginationRef.pageSize;\n    let dataObj = await getDataPage(searchForm);\n    return dataObj;\n  };\n\n  const [registerTable, { reload, getForm, getDataSource, getPaginationRef }] = useTable({\n    title: '登录日志',\n    api: getDataListParam,\n    rowKey: 'id',\n    columns,\n    useSearchForm: true,\n    showTableSetting: true,\n    bordered: true,\n    pagination: { pageSize: 20, pageSizeOptions: ['20', '50', '100', '200'] },\n    handleSearchInfoFn(info) {\n      return info;\n    },\n    formConfig: {\n      labelWidth: 120,\n      actionColOptions: { span: 24 },\n      autoAdvancedLine: 1,\n      baseColProps: { span: 7 },\n      schemas: searchFormSchema,\n      autoSubmitOnEnter: true,\n      noHideBtnFlag: true,\n    },\n    sortFn: (sortInfo: SorterResult) => {\n      if (sortInfo.order) {\n        searchInfo.sortField = sortInfo.field;\n        searchInfo.sortOrder = sortInfo.order.replace('end', '');\n      } else {\n        searchInfo.sortField = '';\n        searchInfo.sortOrder = '';\n      }\n    },\n  });\n\n  // 导出\n  async function exportData() {\n    createConfirm({\n      title: '提示',\n      iconType: 'warning',\n      content: t('common.message.exportMessage'),\n      async onOk() {\n        await exportExcel(getForm().getFieldsValue()).then((res) => {\n          exportExcelFile(res?.data, '登录日志.xls');\n        });\n        createMessage.success(t('common.exportSuccessText'));\n      },\n    });\n  }\n\n  function handleSelectChange({ keys, rows }) {\n    if (rows && rows.length > 0) {\n      const record = rows[0];\n      selectedRowId.value = record.id;\n      selectedRow = record;\n    } else {\n      selectedRowId.value = '';\n      selectedRow = null;\n    }\n  }\n\n  function onSelect(record, selected) {\n    if (selected) {\n      selectedRowId.value = record.id;\n      selectedRow = record;\n    } else {\n      selectedRowId.value = '';\n      selectedRow = null;\n    }\n  }\n  function handleEditEnd({ record, index, key, value }: Recordable) {\n    saveIndex(record)\n      .then(() => {\n        message.success('已保存');\n        reload();\n      })\n      .catch(() => {});\n  }\n\n  //---------------------------------操作按钮---------------------------------------\n  // 查看指标sql配置\n  const toSqlConfig = async (record: any) => {\n    assign(sqlFormState, record);\n    configVisible.value = true;\n    isShow.value = true;\n  };\n  // 新增\n  const handleAdd = async () => {\n    detailTitle.value = '添加评价指标';\n    detailVisible.value = true;\n    indexFormRef.value?.resetFields();\n\n    isEdit.value = false;\n  };\n  // 修改\n  function handleEdit() {\n    if (selectedRowId.value == '') {\n      message.error('请先选择数据。');\n      return;\n    }\n    detailTitle.value = '修改评价指标';\n    nextTick(() => {\n      assign(formState, selectedRow);\n    });\n\n    detailVisible.value = true;\n    isEdit.value = true;\n  }\n\n  // 保存指标数据\n  function detailHandle() {\n    indexFormRef.value.validateFields().then(() => {\n      // TODO 新增数据\n      saveIndex(formState)\n        .then(() => {\n          message.success('保存成功');\n          reload();\n          //关闭弹窗\n\n          indexFormRef.value?.resetFields();\n          detailVisible.value = false;\n        })\n        .catch(() => {});\n    });\n  }\n\n  // 关闭数据详情窗口\n  function cancelDetail() {\n    detailVisible.value = false;\n  }\n\n  // 配置sql\n  function handleConfig() {\n    if (selectedRowId.value == '') {\n      message.error('请先选择数据。');\n      return;\n    }\n    if (selectedRow.evaluationMethod != 'system') {\n      message.warning('非系统评价，无须配置。');\n      return;\n    }\n    assign(sqlFormState, selectedRow);\n    configVisible.value = true;\n    isShow.value = false;\n  }\n\n  // 关闭配置弹窗\n  function cancelConfig() {\n    configVisible.value = false;\n  }\n  // 保存配置\n  function configHandle() {\n    sqlFormRef.value.validateFields().then(() => {\n      saveSqlConfig(sqlFormState)\n        .then(() => {\n          message.success('配置成功');\n          sqlFormRef.value?.resetFields();\n          configVisible.value = false;\n          reload();\n        })\n        .catch(() => {});\n    });\n  }\n\n  // 启用/禁用\n  function updateIndexStatus(status: number) {\n    let param = { id: selectedRowId.value, status: status };\n    updateStatus(param).then(() => {\n      reload();\n    });\n  }\n\n  //删除\n  function handleDel() {\n    createConfirm({\n      title: '提示',\n      iconType: 'warning',\n      content: '确定要删除选中记录？',\n      async onOk() {\n        deleteIndex(selectedRowId.value).then(() => {\n          reload();\n        });\n      },\n    });\n  }\n\n  // 保存排序号\n  function saveSorts() {\n    let indexList = getDataSource().map((item) => {\n      return { id: item.id, sort: item.sort };\n    });\n    saveSort(indexList).then((data) => {\n      message.success('已保存');\n      reload();\n    });\n  }\n\n  // 启动执行代码\n  onMounted(async () => {});\n</script>\n<style lang=\"less\" scoped>\n  .fix-basic-table {\n    :deep(&.vben-basic-table .ant-table-wrapper) {\n      padding: 10px 16px 12px;\n    }\n\n    :deep(.table-settings .anticon-setting) {\n      margin-right: 0;\n    }\n  }\n</style>\n"],"names":["searchFormSchema","columns","getDataPage","params","defHttp","exportExcel","t","useI18n","createConfirm","createMessage","useMessage","searchInfo","reactive","ref","selectedRowId","getDataListParam","__async","searchForm","getForm","paginationRef","getPaginationRef","registerTable","reload","getDataSource","useTable","info","sortInfo","exportData","res","exportExcelFile","handleSelectChange","keys","rows","record","handleEditEnd","index","key","value","message","onMounted"],"mappings":"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"}