var f=(w,_,v)=>new Promise((E,C)=>{var p=m=>{try{y(v.next(m))}catch(b){C(b)}},U=m=>{try{y(v.throw(m))}catch(b){C(b)}},y=m=>m.done?E(m.value):Promise.resolve(m.value).then(p,U);y((v=v.apply(w,_)).next())});import{d as j,k as I,ax as K,u as x,r as B,o as J,al as c,Z as Q,a9 as Z,aa as t,$ as g,f as a,v as d,A as u,E as $,ad as G}from"./vue-71d1abb3.js";import{B as X}from"./BillTitle-d17ab3e4.js";import{b as ee,ak as ae,aB as le,at as te,a7 as se,aC as oe,_ as ne}from"./index.js";import{W as ie}from"./WfApproveBox-a3448232.js";import{P as re}from"./index-20519caf.js";import{k as de,u as ue,v as L,t as pe,n as me}from"./index-caeea670.js";import{a as M}from"./assign-37f1c13d.js";import"./antd-15ac76ed.js";import"./index.esm-c216ed00.js";import"./index-fda2d66c.js";import"./BasicTable-0434a334.js";import"./useForm-dea3ed18.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-f4fc48e6.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./uniqBy-92d3bc7f.js";import"./index-085d06c7.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./useTable-109483b3.js";import"./index-c0893416.js";import"./index-33af41d1.js";import"./tree-fc0e156a.js";import"./useContentViewHeight-7f845167.js";import"./useRender-21ce56fb.js";const ce={class:"load"},fe={class:"process-box"},ve={class:"header-box"},be={class:"content"},ge={class:"left-panel"},_e={style:{margin:"0 16px 10px"}},ye=j({__name:"monthReportCreate",setup(w){const _=I(!1),{t:v}=ee(),E=K(),{currentRoute:C}=E;x(C);const p=ae.getInstance().getQuery(),U=I(null),y=de(),m=I([]),b=I(),e=B({status:0}),h=B({});h.subject="生产月报",h.infoItems=[];const A=()=>f(this,null,function*(){if(e.monthCycle==null)return;e.requestType="month";let s=yield pe(e);e.genElec=s.result.genElec,e.offlineElec=s.result.offlineElec,e.onlineElec=s.result.onlineElec,e.theoElec=s.result.theoElec,e.facUsed=s.result.facUsed,e.totalLoss=s.result.totalLoss,e.validHours=s.result.validHours,e.facRatio=s.result.facRatio,e.sysEfficiency=s.result.sysEfficiency,e.avgTemp=s.result.avgTemp,e.avgWind=s.result.avgWind,e.radiation=s.result.radiation,e.connectCapacity=s.result.connectCapacity}),R=()=>f(this,null,function*(){if(e.monthCycle==null)return;e.requestType="month";let s=yield me(e);m.value=s.result});function S(){A(),R()}const D=()=>{N(0)},H=()=>{N(1)},N=s=>{b.value.validateFields().then(()=>{let l=e;l.status=s,l.lossData=m.value,ue(l).then(n=>{te.getInstance().success(v("common.saveSuccessText")),e.id=n.result,k(),s>=1&&setTimeout(function(){se.getInstance().sendMsg("day-report",{key:"month"}),oe()},200)}).catch(()=>{})})},T=s=>f(this,null,function*(){let{billCode:l,fillinDate:n,personMemberName:i,deptName:r}=s;Object.assign(h,{billCode:l,fillinDate:n,personMemberName:i,deptName:r})}),k=()=>f(this,null,function*(){let s=yield L(e.id);_.value=s.status>0,T(s),M(e,s),e.processInstanceId||(e.processInstanceId=p.processInstanceId),R()}),q=()=>f(this,null,function*(){let s=yield L("");T(s),e.billCode=s.billCode,e.fillinDate=s.fillinDate,e.stationId=p.stationId,e.stationName=p.stationName,e.periodId=p.periodId,e.periodName=p.periodName,e.stationOrganId=p.organId,e.stationOrganName=p.organName,A()});return J(()=>f(this,null,function*(){M(e,p),p.id?yield k():p.processInstanceId?(U.value=p.processInstanceId,e.processInstanceId=p.processInstanceId,le(e.processInstanceId).then(s=>f(this,null,function*(){e.id=s.businessKey,yield k()}))):q()})),(s,l)=>{const n=c("a-input"),i=c("a-form-item"),r=c("a-col"),F=c("a-date-picker"),P=c("a-textarea"),Y=c("a-row"),W=c("a-card"),O=c("a-form"),z=c("a-table");return Q(),Z(x(re),{detail:!0,dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"fix-detail-page",style:{position:"relative"}},{default:t(()=>[g("div",ce,[g("div",fe,[g("div",ve,[a(X,{options:h},null,8,["options"]),a(ie,{onSave:D,onSubmit:H,processStatus:e.status,processInstanceId:e.processInstanceId},null,8,["processStatus","processInstanceId"])]),g("div",be,[g("div",ge,[a(O,{ref_key:"monthReportFormRef",ref:b,model:e,name:"monthReportForm"},{default:t(()=>[a(W,{title:"基本信息",bordered:!1},{default:t(()=>[a(Y,{gutter:32},{default:t(()=>[d(a(r,{span:12},{default:t(()=>[a(i,{label:"电站名称",name:"stationName",labelAlign:"right",labelCol:{span:4}},{default:t(()=>[a(n,{disabled:"",value:e.stationName,"onUpdate:value":l[0]||(l[0]=o=>e.stationName=o),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1},512),[[u,!0]]),d(a(r,{span:12},{default:t(()=>[a(i,{label:"分期",name:"periodName",labelAlign:"right",labelCol:{span:4}},{default:t(()=>[a(n,{disabled:"",value:e.periodName,"onUpdate:value":l[1]||(l[1]=o=>e.periodName=o)},null,8,["value"])]),_:1})]),_:1},512),[[u,!0]]),d(a(r,{span:12},{default:t(()=>[a(i,{label:"月报周期",name:"monthCycle",labelAlign:"right",labelCol:{span:4},rules:[{required:!0,message:"请选择月份"}]},{default:t(()=>[a(F,{value:e.monthCycle,"onUpdate:value":l[2]||(l[2]=o=>e.monthCycle=o),"value-format":"YYYY-MM",onChange:S,style:{"min-width":"100%"},disabled:_.value,picker:"month"},null,8,["value","disabled"])]),_:1})]),_:1},512),[[u,!0]]),d(a(r,{span:12},{default:t(()=>[a(i,{label:"月发电量(kWh)",name:"genElec",labelAlign:"right",labelCol:{span:4}},{default:t(()=>[a(n,{disabled:"",value:e.genElec,"onUpdate:value":l[3]||(l[3]=o=>e.genElec=o)},null,8,["value"])]),_:1})]),_:1},512),[[u,!0]]),d(a(r,{span:12},{default:t(()=>[a(i,{label:"理论发电(kWh)",name:"theoElec",labelAlign:"right",labelCol:{span:4}},{default:t(()=>[a(n,{disabled:"",value:e.theoElec,"onUpdate:value":l[4]||(l[4]=o=>e.theoElec=o)},null,8,["value"])]),_:1})]),_:1},512),[[u,!0]]),d(a(r,{span:12},{default:t(()=>[a(i,{label:"外接厂用电(kWh)",name:"facUsed",labelAlign:"right",labelCol:{span:4}},{default:t(()=>[a(n,{disabled:"",value:e.facUsed,"onUpdate:value":l[5]||(l[5]=o=>e.facUsed=o)},null,8,["value"])]),_:1})]),_:1},512),[[u,!0]]),d(a(r,{span:12},{default:t(()=>[a(i,{label:"上网电量(kWh)",name:"onlineElec",labelAlign:"right",labelCol:{span:4}},{default:t(()=>[a(n,{disabled:"",value:e.onlineElec,"onUpdate:value":l[6]||(l[6]=o=>e.onlineElec=o)},null,8,["value"])]),_:1})]),_:1},512),[[u,!0]]),d(a(r,{span:12},{default:t(()=>[a(i,{label:"下网电量(kWh)",name:"offlineElec",labelAlign:"right",labelCol:{span:4}},{default:t(()=>[a(n,{disabled:"",value:e.offlineElec,"onUpdate:value":l[7]||(l[7]=o=>e.offlineElec=o)},null,8,["value"])]),_:1})]),_:1},512),[[u,!0]]),d(a(r,{span:12},{default:t(()=>[a(i,{label:"损失电量(kWh)",name:"totalLoss",labelAlign:"right",labelCol:{span:4}},{default:t(()=>[a(n,{disabled:"",value:e.totalLoss,"onUpdate:value":l[8]||(l[8]=o=>e.totalLoss=o)},null,8,["value"])]),_:1})]),_:1},512),[[u,!0]]),d(a(r,{span:12},{default:t(()=>[a(i,{label:"利用小时数(h)",name:"validHours",labelAlign:"right",labelCol:{span:4}},{default:t(()=>[a(n,{disabled:"",value:e.validHours,"onUpdate:value":l[9]||(l[9]=o=>e.validHours=o)},null,8,["value"])]),_:1})]),_:1},512),[[u,!0]]),d(a(r,{span:12},{default:t(()=>[a(i,{label:"综合厂用电率(%)",name:"facRatio",labelAlign:"right",labelCol:{span:4}},{default:t(()=>[a(n,{disabled:"",value:e.facRatio,"onUpdate:value":l[10]||(l[10]=o=>e.facRatio=o)},null,8,["value"])]),_:1})]),_:1},512),[[u,!0]]),d(a(r,{span:12},{default:t(()=>[a(i,{label:"系统效率(%)",name:"sysEfficiency",labelAlign:"right",labelCol:{span:4}},{default:t(()=>[a(n,{disabled:"",value:e.sysEfficiency,"onUpdate:value":l[11]||(l[11]=o=>e.sysEfficiency=o)},null,8,["value"])]),_:1})]),_:1},512),[[u,!0]]),d(a(r,{span:12},{default:t(()=>[a(i,{label:"平均温度(℃)",name:"avgTemp",labelAlign:"right",labelCol:{span:4}},{default:t(()=>[a(n,{disabled:"",value:e.avgTemp,"onUpdate:value":l[12]||(l[12]=o=>e.avgTemp=o)},null,8,["value"])]),_:1})]),_:1},512),[[u,!0]]),d(a(r,{span:12},{default:t(()=>[a(i,{label:"平均风速(m/s)",name:"avgWind",labelAlign:"right",labelCol:{span:4}},{default:t(()=>[a(n,{disabled:"",value:e.avgWind,"onUpdate:value":l[13]||(l[13]=o=>e.avgWind=o)},null,8,["value"])]),_:1})]),_:1},512),[[u,!0]]),d(a(r,{span:12},{default:t(()=>[a(i,{label:"月辐照值(万KJ/㎡)",name:"radiation",labelAlign:"right",labelCol:{span:4}},{default:t(()=>[a(n,{disabled:"",value:e.radiation,"onUpdate:value":l[14]||(l[14]=o=>e.radiation=o)},null,8,["value"])]),_:1})]),_:1},512),[[u,!0]]),d(a(r,{span:24,class:"textarea-item"},{default:t(()=>[a(i,{label:"生产数据分析",name:"remark",labelAlign:"right",labelCol:{span:2},rules:[{required:!0,message:"请输入生产数据分析"}]},{default:t(()=>[a(P,{rows:10,value:e.remark,"onUpdate:value":l[15]||(l[15]=o=>e.remark=o),placeholder:"1000字以内",disabled:_.value,maxlength:1e3,"show-count":""},null,8,["value","disabled"])]),_:1})]),_:1},512),[[u,!0]])]),_:1})]),_:1})]),_:1},8,["model"]),a(W,{title:"损失电量",bordered:!1},{default:t(()=>[g("div",_e,[a(z,{columns:x(y),"data-source":m.value,pagination:!1,size:"small",bordered:"","row-selection":s.rowSelection,onChange:s.handleTableYxChange,scroll:{x:480,y:620}},{bodyCell:t(({column:o,text:V,record:Ce})=>[$(G(V),1)]),_:1},8,["columns","data-source","row-selection","onChange"])])]),_:1})])])])])]),_:1})}}});const la=ne(ye,[["__scopeId","data-v-b9be6567"]]);export{la as default};
//# sourceMappingURL=monthReportCreate-7977bb60.js.map
