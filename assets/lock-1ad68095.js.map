{"version":3,"file":"lock-1ad68095.js","sources":["../../src/store/modules/lock.ts"],"sourcesContent":["import type { LockInfo } from '/#/store';\n\nimport { defineStore } from 'pinia';\n\nimport { LOCK_INFO_KEY } from '/@/enums/cacheEnum';\nimport { Persistent } from '/@/utils/cache/persistent';\nimport { useUserStore } from './user';\n\ninterface LockState {\n  lockInfo: Nullable<LockInfo>;\n}\n\nexport const useLockStore = defineStore({\n  id: 'app-lock',\n  state: (): LockState => ({\n    lockInfo: Persistent.getLocal(LOCK_INFO_KEY),\n  }),\n  getters: {\n    getLockInfo(state): Nullable<LockInfo> {\n      return state.lockInfo;\n    },\n  },\n  actions: {\n    setLockInfo(info: LockInfo) {\n      this.lockInfo = Object.assign({}, this.lockInfo, info);\n      Persistent.setLocal(LOCK_INFO_KEY, this.lockInfo, true);\n    },\n    resetLockInfo() {\n      Persistent.removeLocal(LOCK_INFO_KEY, true);\n      this.lockInfo = null;\n    },\n    // Unlock\n    async unLock(password?: string) {\n      const userStore = useUserStore();\n      if (this.lockInfo?.pwd === password) {\n        this.resetLockInfo();\n        return true;\n      }\n      const tryLogin = async () => {\n        try {\n          const username = userStore.getUserInfo?.username;\n          const res = await userStore.login({\n            username,\n            password: password!,\n            goHome: false,\n            mode: 'none',\n          });\n          if (res) {\n            this.resetLockInfo();\n          }\n          return res;\n        } catch (error) {\n          return false;\n        }\n      };\n      return await tryLogin();\n    },\n  },\n});\n"],"names":["useLockStore","defineStore","Persistent","LOCK_INFO_KEY","state","info","password","__async","userStore","useUserStore","_a","username","res","error"],"mappings":"oSAYO,MAAMA,EAAeC,EAAY,CACtC,GAAI,WACJ,MAAO,KAAkB,CACvB,SAAUC,EAAW,SAASC,CAAa,CAAA,GAE7C,QAAS,CACP,YAAYC,EAA2B,CACrC,OAAOA,EAAM,QACf,CACF,EACA,QAAS,CACP,YAAYC,EAAgB,CAC1B,KAAK,SAAW,OAAO,OAAO,CAAI,EAAA,KAAK,SAAUA,CAAI,EACrDH,EAAW,SAASC,EAAe,KAAK,SAAU,EAAI,CACxD,EACA,eAAgB,CACHD,EAAA,YAAYC,EAAe,EAAI,EAC1C,KAAK,SAAW,IAClB,EAEM,OAAOG,EAAmB,QAAAC,EAAA,4BAC9B,MAAMC,EAAYC,IACd,QAAAC,EAAA,KAAK,WAAL,YAAAA,EAAe,OAAQJ,GACzB,KAAK,cAAc,EACZ,IAmBF,MAjBU,IAAYC,EAAA,4BACvB,GAAA,CACI,MAAAI,GAAWD,EAAAF,EAAU,cAAV,YAAAE,EAAuB,SAClCE,EAAM,MAAMJ,EAAU,MAAM,CAChC,SAAAG,EACA,SAAAL,EACA,OAAQ,GACR,KAAM,MAAA,CACP,EACD,OAAIM,GACF,KAAK,cAAc,EAEdA,QACAC,EAAO,CACP,MAAA,EACT,CAAA,IAEoB,CACxB,GACF,CACF,CAAC"}