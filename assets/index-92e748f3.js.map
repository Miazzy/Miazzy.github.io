{"version":3,"file":"index-92e748f3.js","sources":["../../src/views/bpm/manage/form/index.vue"],"sourcesContent":["<template>\n  <ContentWrap>\n    <!-- 搜索工作栏 -->\n    <el-form\n      ref=\"queryFormRef\"\n      :inline=\"true\"\n      :model=\"queryParams\"\n      class=\"-mb-15px\"\n      label-width=\"68px\"\n    >\n      <el-form-item label=\"表单名\" prop=\"name\">\n        <el-input\n          v-model=\"queryParams.name\"\n          class=\"!w-240px\"\n          clearable\n          placeholder=\"请输入表单名\"\n          @keyup.enter=\"handleQuery\"\n        />\n      </el-form-item>\n      <el-form-item>\n        <el-button @click=\"handleQuery\">\n          <Icon class=\"mr-5px\" icon=\"ep:search\" />\n          搜索\n        </el-button>\n        <el-button @click=\"resetQuery\">\n          <Icon class=\"mr-5px\" icon=\"ep:refresh\" />\n          重置\n        </el-button>\n        <el-button v-hasPermi=\"['bpm:form:create']\" plain type=\"primary\" @click=\"openForm\">\n          <Icon class=\"mr-5px\" icon=\"ep:plus\" />\n          新增\n        </el-button>\n      </el-form-item>\n    </el-form>\n  </ContentWrap>\n\n  <!-- 列表 -->\n  <ContentWrap>\n    <el-table v-loading=\"loading\" :data=\"list\">\n      <el-table-column align=\"center\" label=\"编号\" prop=\"id\" />\n      <el-table-column align=\"center\" label=\"表单名\" prop=\"name\" />\n      <el-table-column align=\"center\" label=\"状态\" prop=\"status\">\n        <template #default=\"scope\">\n          <dict-tag :type=\"DICT_TYPE.COMMON_STATUS\" :value=\"scope.row.status\" />\n        </template>\n      </el-table-column>\n      <el-table-column align=\"center\" label=\"备注\" prop=\"remark\" />\n      <el-table-column\n        :formatter=\"dateFormatter\"\n        align=\"center\"\n        label=\"创建时间\"\n        prop=\"createTime\"\n      />\n      <el-table-column align=\"center\" label=\"操作\">\n        <template #default=\"scope\">\n          <el-button\n            v-hasPermi=\"['bpm:form:update']\"\n            link\n            type=\"primary\"\n            @click=\"openForm(scope.row.id)\"\n          >\n            编辑\n          </el-button>\n          <el-button v-hasPermi=\"['bpm:form:query']\" link @click=\"openDetail(scope.row.id)\">\n            详情\n          </el-button>\n          <el-button\n            v-hasPermi=\"['bpm:form:delete']\"\n            link\n            type=\"danger\"\n            @click=\"handleDelete(scope.row.id)\"\n          >\n            删除\n          </el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n    <!-- 分页 -->\n    <Pagination\n      v-model:limit=\"queryParams.pageSize\"\n      v-model:page=\"queryParams.pageNo\"\n      :total=\"total\"\n      @pagination=\"getList\"\n    />\n  </ContentWrap>\n\n  <!-- 表单详情的弹窗 -->\n  <Dialog v-model=\"detailVisible\" title=\"表单详情\" width=\"800\">\n    <form-create :option=\"detailData.option\" :rule=\"detailData.rule\" />\n  </Dialog>\n</template>\n\n<script lang=\"ts\" setup>\n  import { DICT_TYPE } from '@/utils/dict';\n  import { dateFormatter } from '@/utils/dateUtil';\n  import * as FormApi from '@/api/bpm/form';\n  import { setConfAndFields2 } from '@/utils/formCreate';\n  import { ref, reactive, watch, onMounted } from 'vue';\n  import { useI18n } from 'vue-i18n';\n  import { useRouter } from 'vue-router';\n  import { useMessage } from '/@/hooks/web/useMessage';\n\n  defineOptions({ name: 'BpmForm' });\n\n  const message = useMessage(); // 消息弹窗\n  const { t } = useI18n(); // 国际化\n  const { currentRoute, push } = useRouter(); // 路由\n\n  const loading = ref(true); // 列表的加载中\n  const total = ref(0); // 列表的总页数\n  const list = ref([]); // 列表的数据\n  const queryParams = reactive({\n    pageNo: 1,\n    pageSize: 10,\n    name: null,\n  });\n  const queryFormRef = ref(); // 搜索的表单\n\n  /** 查询列表 */\n  const getList = async () => {\n    loading.value = true;\n    try {\n      const data = await FormApi.getFormPage(queryParams);\n      list.value = data.list;\n      total.value = data.total;\n    } finally {\n      loading.value = false;\n    }\n  };\n\n  /** 搜索按钮操作 */\n  const handleQuery = () => {\n    queryParams.pageNo = 1;\n    getList();\n  };\n\n  /** 重置按钮操作 */\n  const resetQuery = () => {\n    queryFormRef.value.resetFields();\n    handleQuery();\n  };\n\n  /** 添加/修改操作 */\n  const openForm = (id?: number) => {\n    const toRouter: { name: string; query?: { id: number } } = {\n      name: 'BpmFormEditor',\n    };\n    // 表单新建的时候id传的是event需要排除\n    if (typeof id === 'number') {\n      toRouter.query = {\n        id,\n      };\n    }\n    push(toRouter);\n  };\n\n  /** 删除按钮操作 */\n  const handleDelete = async (id: number) => {\n    try {\n      // 删除的二次确认\n      await message.delConfirm();\n      // 发起删除\n      await FormApi.deleteForm(id);\n      message.success(t('common.delSuccess'));\n      // 刷新列表\n      await getList();\n    } catch {}\n  };\n\n  /** 详情操作 */\n  const detailVisible = ref(false);\n  const detailData = ref({\n    rule: [],\n    option: {},\n  });\n  const openDetail = async (rowId: number) => {\n    // 设置表单\n    const data = await FormApi.getForm(rowId);\n    setConfAndFields2(detailData, data.conf, data.fields);\n    // 弹窗打开\n    detailVisible.value = true;\n  };\n  /**表单保存返回后重新加载列表 */\n  watch(\n    () => currentRoute.value,\n    () => {\n      getList();\n    },\n    {\n      immediate: true,\n    },\n  );\n  /** 初始化 **/\n  onMounted(() => {\n    getList();\n  });\n</script>\n"],"names":["message","useMessage","t","useI18n","currentRoute","push","useRouter","loading","ref","total","list","queryParams","reactive","queryFormRef","getList","__async","data","FormApi.getFormPage","handleQuery","resetQuery","openForm","id","toRouter","handleDelete","FormApi.deleteForm","e","detailVisible","detailData","openDetail","rowId","FormApi.getForm","setConfAndFields2","watch","onMounted"],"mappings":"2nBAwGE,MAAMA,EAAUC,KACV,CAAE,EAAAC,GAAMC,KACR,CAAE,aAAAC,EAAc,KAAAC,CAAK,EAAIC,EAAU,EAEnCC,EAAUC,EAAI,EAAI,EAClBC,EAAQD,EAAI,CAAC,EACbE,EAAOF,EAAI,CAAA,CAAE,EACbG,EAAcC,EAAS,CAC3B,OAAQ,EACR,SAAU,GACV,KAAM,IAAA,CACP,EACKC,EAAeL,IAGfM,EAAU,IAAYC,EAAA,sBAC1BR,EAAQ,MAAQ,GACZ,GAAA,CACF,MAAMS,EAAO,MAAMC,GAAoBN,CAAW,EAClDD,EAAK,MAAQM,EAAK,KAClBP,EAAM,MAAQO,EAAK,KAAA,QACnB,CACAT,EAAQ,MAAQ,EAClB,CAAA,GAIIW,EAAc,IAAM,CACxBP,EAAY,OAAS,EACbG,GAAA,EAIJK,EAAa,IAAM,CACvBN,EAAa,MAAM,cACPK,GAAA,EAIRE,EAAYC,GAAgB,CAChC,MAAMC,EAAqD,CACzD,KAAM,eAAA,EAGJ,OAAOD,GAAO,WAChBC,EAAS,MAAQ,CACf,GAAAD,CAAA,GAGJhB,EAAKiB,CAAQ,CAAA,EAITC,EAAsBF,GAAeN,EAAA,sBACrC,GAAA,CAEF,MAAMf,EAAQ,aAER,MAAAwB,GAAmBH,CAAE,EACnBrB,EAAA,QAAQE,EAAE,mBAAmB,CAAC,EAEtC,MAAMY,EAAQ,CAAA,OACRW,EAAA,CAAC,CAAA,GAILC,EAAgBlB,EAAI,EAAK,EACzBmB,EAAanB,EAAI,CACrB,KAAM,CAAC,EACP,OAAQ,CAAC,CAAA,CACV,EACKoB,EAAoBC,GAAkBd,EAAA,sBAE1C,MAAMC,EAAO,MAAMc,GAAgBD,CAAK,EACxCE,GAAkBJ,EAAYX,EAAK,KAAMA,EAAK,MAAM,EAEpDU,EAAc,MAAQ,EAAA,GAGxB,OAAAM,EACE,IAAM5B,EAAa,MACnB,IAAM,CACIU,GACV,EACA,CACE,UAAW,EACb,CAAA,EAGFmB,EAAU,IAAM,CACNnB,GAAA,CACT"}