{"version":3,"file":"index-a5bb754a.js","sources":["../../src/views/bpm/manage/task/done/done.data.ts","../../src/views/bpm/manage/task/done/index.vue"],"sourcesContent":["import { assign, forEach } from 'min-dash';\nimport { useRender } from '@/components/Table';\nimport { formatPast2 } from '@/utils/dateUtil';\n\nconst bpmProcessInstanceResult = [\n  {\n    dictType: 'bpm_process_instance_result',\n    value: '1',\n    label: '处理中',\n    colorType: 'primary',\n    cssClass: '',\n  },\n  {\n    dictType: 'bpm_process_instance_result',\n    value: '2',\n    label: '通过',\n    colorType: 'success',\n    cssClass: '',\n  },\n  {\n    dictType: 'bpm_process_instance_result',\n    value: '3',\n    label: '不通过',\n    colorType: 'danger',\n    cssClass: '',\n  },\n  {\n    dictType: 'bpm_process_instance_result',\n    value: '4',\n    label: '已取消',\n    colorType: 'info',\n    cssClass: '',\n  },\n  {\n    dictType: 'bpm_process_instance_result',\n    value: '5',\n    label: '终止',\n    colorType: 'info',\n    cssClass: '',\n  },\n];\n\nexport const searchFormSchema: FormSchema[] = [\n  {\n    label: '单据编号',\n    field: 'businessCode',\n    component: 'Input',\n    colProps: { span: 8 },\n  },\n  // {\n  //   label: '任务名称',\n  //   field: 'name',\n  //   component: 'Input',\n  //   colProps: { span: 8 },\n  // },\n  {\n    label: '创建时间',\n    field: 'createTime',\n    component: 'RangePicker',\n    componentProps: {\n      showTime: true,\n      format: 'YYYY-MM-DD HH:mm:ss',\n      valueFormat: 'x',\n    },\n    colProps: { span: 8 },\n  },\n];\n\nexport const columns: BasicColumn[] = [\n  {\n    title: '单据编号',\n    dataIndex: 'businessCode',\n    width: 150,\n  },\n  {\n    title: '标题',\n    dataIndex: 'description',\n    width: 200,\n  },\n  {\n    title: '流程名称',\n    dataIndex: 'processInstance.name',\n    width: 200,\n    customRender: ({ record }) => {\n      return record.processInstance.name;\n    },\n  },\n  {\n    title: '申请部门',\n    dataIndex: 'deptName',\n    width: 100,\n    customRender: ({ record }) => {\n      return record.processInstance.deptName;\n    },\n  },\n  {\n    title: '申请人',\n    dataIndex: 'startUserNickname',\n    width: 100,\n    customRender: ({ record }) => {\n      return record.processInstance.startUserNickname;\n    },\n  },\n  {\n    title: '结果',\n    dataIndex: 'result',\n    width: 100,\n    customRender: ({ text }) => {\n      return getTypeObj('bpmProcessInstanceResult', text)['label'];\n      // return useRender.renderDict(text, 'bpmProcessInstanceStatus');\n    },\n  },\n  {\n    title: '审批意见',\n    dataIndex: 'reason',\n    width: 180,\n  },\n  {\n    title: '申请时间',\n    dataIndex: 'createTime',\n    width: 200,\n    customRender: ({ text }) => {\n      return useRender.renderDate(text);\n    },\n  },\n  {\n    title: '审批时间',\n    dataIndex: 'endTime',\n    width: 180,\n    customRender: ({ text }) => {\n      return useRender.renderDate(text);\n    },\n  },\n  {\n    title: '耗时',\n    dataIndex: 'durationInMillis',\n    width: 180,\n    customRender: ({ text }) => {\n      return formatPast2(text);\n    },\n  },\n];\n\nexport function getTypeObj(dictType: string, type: any) {\n  const obj = {};\n  if (dictType == 'bpmProcessInstanceResult') {\n    forEach(bpmProcessInstanceResult, function (def) {\n      if (def.value === type.toString()) {\n        assign(obj, def);\n      }\n    });\n  }\n  return obj;\n}\n","<script lang=\"ts\" setup>\n  import { onMounted } from 'vue';\n  import { columns, searchFormSchema } from './done.data';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { IconEnum } from '@/enums/appEnum';\n  import { BasicTable, useTable, TableAction } from '@/components/Table';\n\n  import * as TaskApi from '@/api/bpm/task';\n  import { addTabPage } from '@/utils/route';\n  import { MsgManager } from '/@/message/MsgManager';\n\n  defineOptions({ name: 'BpmDoneTask' });\n\n  const { t } = useI18n();\n\n  const [registerTable, { reload }] = useTable({\n    title: '已办任务',\n    api: TaskApi.getDoneTaskPage,\n    columns,\n    formConfig: { labelWidth: 120, schemas: searchFormSchema },\n    useSearchForm: true,\n    showTableSetting: true,\n    bordered: true,\n    actionColumn: {\n      width: 140,\n      title: t('common.operate'),\n      dataIndex: 'action',\n      fixed: 'right',\n    },\n  });\n\n  /** 查看详情 */\n  const handleDetail = (row) => {\n    addTabPage(\n      `${row.bpmProcessDefinitionRespVO.formCustomViewPath}?processInstanceId=${row.processInstance.id}`,\n    );\n  };\n\n  onMounted(() => {\n    MsgManager.getInstance().listen('workflow-task-done', () => {\n      setTimeout(() => {\n        reload(); // 此处需延时一段时间再查询数据，否则数据后端还未处理，可能是原数据\n      }, 500);\n    });\n  });\n</script>\n<template>\n  <div>\n    <BasicTable @register=\"registerTable\">\n      <template #bodyCell=\"{ column, record }\">\n        <template v-if=\"column.key === 'action'\">\n          <TableAction\n            :actions=\"[\n              {\n                icon: IconEnum.VIEW,\n                label: '详情',\n                onClick: handleDetail.bind(null, record),\n              },\n            ]\"\n          />\n        </template>\n      </template>\n    </BasicTable>\n  </div>\n</template>\n"],"names":["bpmProcessInstanceResult","searchFormSchema","columns","record","text","getTypeObj","useRender","formatPast2","dictType","type","obj","forEach","def","assign","t","useI18n","registerTable","reload","useTable","TaskApi.getDoneTaskPage","handleDetail","row","addTabPage","onMounted","MsgManager"],"mappings":"y/BAIA,MAAMA,EAA2B,CAC/B,CACE,SAAU,8BACV,MAAO,IACP,MAAO,MACP,UAAW,UACX,SAAU,EACZ,EACA,CACE,SAAU,8BACV,MAAO,IACP,MAAO,KACP,UAAW,UACX,SAAU,EACZ,EACA,CACE,SAAU,8BACV,MAAO,IACP,MAAO,MACP,UAAW,SACX,SAAU,EACZ,EACA,CACE,SAAU,8BACV,MAAO,IACP,MAAO,MACP,UAAW,OACX,SAAU,EACZ,EACA,CACE,SAAU,8BACV,MAAO,IACP,MAAO,KACP,UAAW,OACX,SAAU,EACZ,CACF,EAEaC,EAAiC,CAC5C,CACE,MAAO,OACP,MAAO,eACP,UAAW,QACX,SAAU,CAAE,KAAM,CAAE,CACtB,EAOA,CACE,MAAO,OACP,MAAO,aACP,UAAW,cACX,eAAgB,CACd,SAAU,GACV,OAAQ,sBACR,YAAa,GACf,EACA,SAAU,CAAE,KAAM,CAAE,CACtB,CACF,EAEaC,EAAyB,CACpC,CACE,MAAO,OACP,UAAW,eACX,MAAO,GACT,EACA,CACE,MAAO,KACP,UAAW,cACX,MAAO,GACT,EACA,CACE,MAAO,OACP,UAAW,uBACX,MAAO,IACP,aAAc,CAAC,CAAE,OAAAC,KACRA,EAAO,gBAAgB,IAElC,EACA,CACE,MAAO,OACP,UAAW,WACX,MAAO,IACP,aAAc,CAAC,CAAE,OAAAA,KACRA,EAAO,gBAAgB,QAElC,EACA,CACE,MAAO,MACP,UAAW,oBACX,MAAO,IACP,aAAc,CAAC,CAAE,OAAAA,KACRA,EAAO,gBAAgB,iBAElC,EACA,CACE,MAAO,KACP,UAAW,SACX,MAAO,IACP,aAAc,CAAC,CAAE,KAAAC,KACRC,EAAW,2BAA4BD,CAAI,EAAE,KAGxD,EACA,CACE,MAAO,OACP,UAAW,SACX,MAAO,GACT,EACA,CACE,MAAO,OACP,UAAW,aACX,MAAO,IACP,aAAc,CAAC,CAAE,KAAAA,KACRE,EAAU,WAAWF,CAAI,CAEpC,EACA,CACE,MAAO,OACP,UAAW,UACX,MAAO,IACP,aAAc,CAAC,CAAE,KAAAA,KACRE,EAAU,WAAWF,CAAI,CAEpC,EACA,CACE,MAAO,KACP,UAAW,mBACX,MAAO,IACP,aAAc,CAAC,CAAE,KAAAA,KACRG,EAAYH,CAAI,CAE3B,CACF,EAEgB,SAAAC,EAAWG,EAAkBC,EAAW,CACtD,MAAMC,EAAM,CAAA,EACZ,OAAIF,GAAY,4BACNG,EAAAX,EAA0B,SAAUY,EAAK,CAC3CA,EAAI,QAAUH,EAAK,SAAA,GACrBI,EAAOH,EAAKE,CAAG,CACjB,CACD,EAEIF,CACT,wDC5IQ,KAAA,CAAE,EAAAI,GAAMC,IAER,CAACC,EAAe,CAAE,OAAAC,CAAQ,CAAA,EAAIC,EAAS,CAC3C,MAAO,OACP,IAAKC,EACL,QAAAjB,EACA,WAAY,CAAE,WAAY,IAAK,QAASD,CAAiB,EACzD,cAAe,GACf,iBAAkB,GAClB,SAAU,GACV,aAAc,CACZ,MAAO,IACP,MAAOa,EAAE,gBAAgB,EACzB,UAAW,SACX,MAAO,OACT,CAAA,CACD,EAGKM,EAAgBC,GAAQ,CAC5BC,EACE,GAAGD,EAAI,2BAA2B,kBAAkB,sBAAsBA,EAAI,gBAAgB,EAAE,EAAA,CAClG,EAGF,OAAAE,EAAU,IAAM,CACdC,EAAW,YAAY,EAAE,OAAO,qBAAsB,IAAM,CAC1D,WAAW,IAAM,CACRP,KACN,GAAG,CAAA,CACP,CAAA,CACF"}