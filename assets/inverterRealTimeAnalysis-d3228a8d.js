var d=(y,K,f)=>new Promise((C,g)=>{var r=m=>{try{w(f.next(m))}catch(b){g(b)}},S=m=>{try{w(f.throw(m))}catch(b){g(b)}},w=m=>m.done?C(m.value):Promise.resolve(m.value).then(r,S);w((f=f.apply(y,K)).next())});import{C as te}from"./CommonTree-c4ed7838.js";import{B as ae}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as le}from"./useTable-109483b3.js";import"./antd-15ac76ed.js";import{au as oe,av as ie,_ as se}from"./index.js";import{e as ne}from"./download-03e71dd5.js";import{o as re,E as de,h as ce,F as ue,G as pe}from"./monitorApi-44e70004.js";import"./index-d8a2358f.js";import{d as ve,k as s,o as me,al as A,Z as B,_ as R,f as v,aa as _,$ as o,ad as he,u as P,E as W,a5 as _e,ac as ye,aG as fe,aH as xe}from"./vue-71d1abb3.js";import{i as ge}from"./install-58e0bd81.js";import"./index-3801a970.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";const k=y=>(fe("data-v-1bb3d589"),y=y(),xe(),y),we={class:"real-time-analysis"},be={class:"right-box"},Ce={class:"right-row-box"},Se={class:"box-header"},Ie={class:"header-left"},Te={class:"header-right"},Ae=k(()=>o("div",{class:"box-content"},[o("div",{class:"chart-box"},[o("div",{id:"customerChart",style:{width:"1300px",height:"320px"}})])],-1)),ke={class:"right-row-box"},Ke={class:"data-table-box"},Ee=k(()=>o("div",{class:"table-title-line"},null,-1)),ze={class:"select-box"},De=k(()=>o("div",{class:"select-label-box"},"区域",-1)),Ne={class:"select-box"},Pe=k(()=>o("div",{class:"select-label-box"},"类型",-1)),Le={style:{"margin-top":"-7px","padding-left":"8px"}},Oe=ve({__name:"inverterRealTimeAnalysis",setup(y){const{createConfirm:K}=oe(),f={normal:"green",alarm:"red",interrupt:"grey",halt:"white"},C=s([]),g=s([]),r=s(""),S=s([]);function w(){return d(this,null,function*(){let e=yield re();S.value=e,setTimeout(()=>d(this,null,function*(){g.value=[e[0].id,e[0].children[0].id],C.value=[e[0].children[0].id],r.value=e[0].children[0].id,yield O(),N(),I()}),500)})}function m(){return d(this,arguments,function*(e={}){r.value=null,e.id!=null&&e.nodeKindId=="station"&&(r.value=e.powerStationId,c.value=[],yield O(),N())})}function b(){K({title:"提示",iconType:"warning",content:"确定要导出所有记录？",onOk(){return d(this,null,function*(){let t=0;h.value=="StringFormation"&&(t=1);let a={stationId:r.value,areaIds:c.value,deviceType:h.value,needSerialsTmp:t};a.fileName="逆变器实时数据",a.excelList=E.value,yield de(a).then(l=>{ne(l==null?void 0:l.data,a.fileName)})})}})}const c=s([]),L=s([]),F=e=>{console.log(`selected ${e}`),c.value=e,D(),I()},O=()=>d(this,null,function*(){let e=yield ce({stationId:r.value});if(e!=null&&e.length){let t=[];e.forEach(a=>{t.push({value:a.id,label:a.name})}),c.value.length==0&&c.value.push(e[0].id),L.value=t,I()}}),h=s("StringFormation"),M=s([{value:"StringFormation",label:"组串式"},{value:"Concentrate",label:"集中式"}]),V=e=>{I(),N()};function U(){c.value=[],h.value=""}const x=s({label:"等效小时数",value:"ppr",dataKind:"bar"}),G=s([{label:"日发电量",value:"outputPower",dataKind:"line"},{label:"PV容量",value:"installedCapacity",dataKind:"line"},{label:"等效小时数",value:"ppr",dataKind:"line"},{label:"平均转换效率",value:"inverterEfficiencyAverage",dataKind:"line"},{label:"最大输出功率",value:"activePowerMax",dataKind:"line"},{label:"最大输入功率",value:"dcInputTotalPowerMax",dataKind:"line"},{label:"平均输出功率",value:"activePowerAverage",dataKind:"line"}]);function J(e,t){return d(this,null,function*(){x.value=t,D()})}const E=s([]),z=s(0),Z=()=>d(this,null,function*(){let e=[{title:"区域",dataIndex:"areaName",width:100},{title:"设备名称",dataIndex:"deviceName",sorter:!0,width:100},{title:"状态",dataIndex:"status",sorter:!0,width:100},{title:"装机容量(kWp)",dataIndex:"installedCapacity",sorter:!0,width:120},{title:"等效小时数(h)",dataIndex:"ppr",sorter:!0,width:120},{title:"日发电量(kWh)",dataIndex:"outputPower",sorter:!0,width:120},{title:"平均转换效率(%)",dataIndex:"inverterEfficiencyAverage",sorter:!0,width:150},{title:"最大输出功率(kW)",dataIndex:"activePowerMax",sorter:!0,width:150},{title:"平均输出功率(kW)",dataIndex:"activePowerAverage",sorter:!0,width:150},{title:"kW输出功率(kW)",dataIndex:"activePower",sorter:!0,width:150}];if(z.value>0)for(let t=1;t<=z.value;t++){let a=[],l={title:"平均电流",dataIndex:t+"_i_avg",width:100},u={title:"平均电压",dataIndex:t+"_p_avg",width:100},p={title:"最大功率",dataIndex:t+"_p_max",width:100},i={title:"平均功率",dataIndex:t+"_u_avg",width:100};a.push(l),a.push(u),a.push(p),a.push(i);let n={title:"组串"+t,width:240,children:a};e.push(n)}E.value=e}),$=s([]),q=()=>d(this,null,function*(){var u;if(r.value=="")return;let e=0;h.value=="StringFormation"&&(e=1);const t=X();let a={stationId:r.value,areaIds:c.value,deviceType:h.value,needSerialsTmp:e,pageNo:t.current,pageSize:t.pageSize},l=yield pe(a);return z.value=l.columnSize,((u=l.data.list)==null?void 0:u.length)>0&&l.data.list.forEach(p=>{if(p.serialsTmp!=null){let i=p.serialsTmp;for(let n in i)p[n+"_i_avg"]=i[n].i_avg,p[n+"_p_avg"]=i[n].p_avg,p[n+"_p_max"]=i[n].p_max,p[n+"_u_avg"]=i[n].u_avg}}),$.value=l.data.list,yield Z(),l.data}),[H,{reload:I,getPaginationRef:X}]=le({api:q,title:"数据列表",columns:E,bordered:!0,pagination:{pageSize:20,pageSizeOptions:["20","50","100","200"]}}),j=s(!1),Q={dataZoom:[{type:"inside"}],tooltip:{trigger:"axis",axisPointer:{type:"line",lineStyle:{type:"dashed",color:"rgba(252,171,40,.5)"}},backgroundColor:" #f5fbfb",borderColor:"#c6ecea",borderWidth:1,textStyle:{color:"#666"},formatter:e=>{}},grid:{top:55,bottom:30,left:40,right:10},xAxis:[{type:"category",axisLine:{lineStyle:{color:"#ccc"}},axisLabel:{color:"#888"},axisTick:{alignWithLabel:!0,show:!1},data:[]}],yAxis:[{type:"value",nameTextStyle:{color:"#888"},axisLine:{show:!0,lineStyle:{color:"#ccc"}},axisLabel:{color:"#888",formatter:"{value}"},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgba(0, 0, 0, .1)",type:"dashed"}}}],series:[{name:"功率",type:"line",showSymbol:!0,symbol:"circle",symbolSize:12,smooth:0,lineStyle:{width:2,color:"rgba(64,202,192,1)"},itemStyle:{normal:{shadowColor:"rgba(0,0,0,0.1)",shadowBlur:6,borderWidth:3,borderColor:"#fff",color:"#40cac0"}}}]},D=()=>d(this,null,function*(){if(r.value==null||x.value==null)return;let e={stationId:r.value,showData:x.value.value,deviceType:h.value,areaIds:c.value},t=yield ue(e);Y(t)});function N(){D()}const T=s({});function Y(e,t){let a=JSON.parse(JSON.stringify(Q)),l=[];a.xAxis[0].data=e.x,a.yAxis[0].name=e.unit,l.push({name:t,data:e.y,type:"line",showSymbol:!0,symbol:"circle",symbolSize:12,smooth:0,lineStyle:{width:2,color:"rgba(64,202,192,1)"},itemStyle:{normal:{shadowColor:"rgba(0,0,0,0.1)",shadowBlur:6,borderWidth:3,borderColor:"#fff",color:"#40cac0"}}}),a.series=l,a.tooltip.formatter=u=>'<p style="text-align: left;color:#666;opacity: .8; line-height: 20px;font-size:12px;">'+u[0].axisValue+'</p> <p style="font-size:12px;color:#666;">'+t+'  <span style="color: #3ccacc;font-size:13px;font-weight:bold;">'+u[0].data+"</span> "+e.unit+"</p>",setTimeout(()=>{j.value=!0,ee(a)})}function ee(e,t){const a=document.getElementById("customerChart");T.value=ge(a),T.value.setOption(e,!0),t&&t(T),window.addEventListener("resize",()=>{T.value.resize()})}return me(()=>d(this,null,function*(){yield w()})),(e,t)=>{const a=A("a-col"),l=A("a-select"),u=A("a-button"),p=A("a-row");return B(),R("div",we,[v(p,{class:"real-time-analysis-row",type:"flex",wrap:!1},{default:_(()=>[v(a,{flex:"298px"},{default:_(()=>[v(te,{toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,class:"fit-common-tree",title:"电站组织",value:S.value,fieldNames:{key:"id",title:"name"},onSelect:m,selectedKeys:C.value,expandedKeys:g.value},null,8,["value","selectedKeys","expandedKeys"])]),_:1}),v(a,{flex:"auto"},{default:_(()=>[o("div",be,[o("div",Ce,[o("div",Se,[o("div",Ie,he(x.value.label),1),o("div",Te,[v(l,{value:x.value,"onUpdate:value":t[0]||(t[0]=i=>x.value=i),"allow-clear":"",style:{"min-width":"206px"},placeholder:"选择指标项",options:G.value,showArrow:"",onChange:J},null,8,["value","options"])])]),Ae]),o("div",ke,[o("div",Ke,[Ee,v(P(ae),{onRegister:P(H)},{tableTitle:_(()=>[o("div",ze,[De,v(l,{value:c.value,"onUpdate:value":t[1]||(t[1]=i=>c.value=i),"allow-clear":"",mode:"multiple",style:{"min-width":"256px"},placeholder:"选择区域",options:L.value,"max-tag-count":2,showArrow:"",onChange:F},null,8,["value","options"])]),o("div",Ne,[Pe,v(l,{value:h.value,"onUpdate:value":t[2]||(t[2]=i=>h.value=i),"allow-clear":"",style:{"min-width":"256px"},placeholder:"选择类型",options:M.value,showArrow:"",onChange:V},null,8,["value","options"])])]),toolbar:_(()=>[o("div",Le,[v(u,{onClick:U},{default:_(()=>[W(" 重置 ")]),_:1}),v(u,{class:"yellow-btn",style:{"margin-left":"8px"},onClick:b,preIcon:P(ie).EXPORT},{default:_(()=>[W(" 导出 ")]),_:1},8,["preIcon"])])]),bodyCell:_(({column:i,record:n})=>[i.key==="status"?(B(),R("span",{key:0,class:_e(["status-icon",f[n.status]])},null,2)):ye("",!0)]),_:1},8,["onRegister"])])])])]),_:1})]),_:1})])}}});const ut=se(Oe,[["__scopeId","data-v-1bb3d589"]]);export{ut as default};
//# sourceMappingURL=inverterRealTimeAnalysis-d3228a8d.js.map
