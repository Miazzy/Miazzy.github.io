var I=(c,S,d)=>new Promise((_,y)=>{var m=u=>{try{v(d.next(u))}catch(b){y(b)}},D=u=>{try{v(d.throw(u))}catch(b){y(b)}},v=u=>u.done?_(u.value):Promise.resolve(u.value).then(m,D);v((d=d.apply(c,S)).next())});import{P as de}from"./index-20519caf.js";import{K as ue}from"./antd-15ac76ed.js";import{a5 as w,a0 as pe,au as me,aj as fe,aB as he,av as N,at as j,aC as be,a7 as ge,_ as _e}from"./index.js";import{D as ve}from"./Dialog-0a006d82.js";import{B as Y}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as L}from"./useTable-109483b3.js";import{_ as W}from"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import{B as Ie}from"./BillTitle-d17ab3e4.js";import{W as ke}from"./WfApproveBox-a3448232.js";import{d as ye,k as h,J as xe,e as Ce,r as H,o as Te,al as p,Z as we,a9 as Se,aa as n,$ as k,f as a,u as r,ag as De,E as A}from"./vue-71d1abb3.js";import"./useContentViewHeight-7f845167.js";import"./useWindowSizeFn-13b1b8a2.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./download-03e71dd5.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";import"./index.esm-c216ed00.js";import"./index-fda2d66c.js";import"./index-c0893416.js";import"./index-33af41d1.js";import"./tree-fc0e156a.js";function Pe(c){return w.get({url:"/po/safe-check-template/dtl/list",params:c})}function Me(c){return w.get({url:"/po/safe-check-template/get",params:c})}function K(c){return c.status=1,w.post({url:"/baseset/safeCheck/list-byCheckType",params:c})}function Re(c){return w.post({url:"/po/safe-check-template/create",data:c})}const Oe=[{title:"检查类型",dataIndex:"checkTypeText",width:80},{title:"项目",dataIndex:"checkItem",width:80},{title:"内容",dataIndex:"description",width:160}],Ne=[{title:"检查项目",dataIndex:"indexItem",width:80},{title:"检查内容",dataIndex:"indexContent",width:160,align:"left",headAlign:"center"}],U=[{label:"检查类型",field:"checkType",component:"DictSelectBox",componentProps:{type:"checkIndexType"},colProps:{span:8}},{label:"项目",field:"checkItem",component:"Input",colProps:{span:8}},{label:"内容",field:"description",component:"Input",colProps:{span:8}}],z={SPECIAL:"2",REGULAR:"1"},je={class:"load"},Ae={class:"process-box"},Ue={class:"header-box"},Be={class:"content"},Ee=ye({__name:"createOrUpdate",setup(c){const S=pe(),d=h(!0),_=h(!0),y=xe(S.getUserInfo),m=Ce(()=>e.status!=0||e.status==0&&e.personMemberId!=""&&e.personMemberId.substring(0,32)!=y.userId),D=h(!1),{createConfirm:v}=me(),u=h(),b=h(""),B=H({subject:"安全检查模板"});let{params:x}=fe();const e=H({id:x.id||"",subject:"",checkType:"",checkPeriod:"",num:0,status:0,spinning:!1,billCode:"",personMemberId:"",fillinDate:"",validDate:ue().format("YYYY-MM-DD"),description:"",dtl:{}}),V=s=>{e.checkPeriod=s};function $(){X(Q())}function G(){v({title:"提示",iconType:"warning",content:"确定引入全部检查数据?",onOk(){return I(this,null,function*(){D.value=!1;let t=yield K({usePage:0}),i=[];t.result.list.forEach(o=>{i.push({indexId:o.id,indexItem:o.checkItem,indexContent:o.description})}),E(i)})}})}const P=()=>{e.dtl=q(),e.spinning=!0,Re(e).then(s=>{s.result!=""?(e.id=s.result,j.getInstance().success(e.status==1?"提交成功":"保存成功"),e.status==1&&setTimeout(()=>{be(),ge.getInstance().sendMsg("safe-check-template",{})},100)):(d.value=!1,j.getInstance().error("保存失败.")),e.spinning=!1}).catch(s=>{d.value=!1,e.status=0,e.spinning=!1,console.log(s)})},M={handleAgree:s=>{console.log("同意",s)},handleSave:s=>{console.log("保存",s),d.value=!1,e.status=0,P()},handleSubmit:s=>{console.log("提交",s),e.status=1;const t=u.value;t&&t.validateFields().then(()=>{P()}).catch(i=>{console.log(i),e.status=0})}},J=s=>{e.checkType=s,_.value=s=="1"},[Z,{setTableData:E,getSelectRowKeys:Q,deleteTableDataRecord:X,getDataSource:q,reload:ee}]=L({api:()=>I(this,null,function*(){return(yield Pe({safeCheckTemplateId:e.id})).result}),columns:Ne,pagination:!1,useSearchForm:!1,showTableSetting:!1,rowSelection:{type:"checkbox"}}),C=h(!1),g=h({checkItem:"",description:"",pageNo:1,pageSize:10,usePage:1}),te=()=>{C.value=!0},ae=()=>{let s=ne();if(s.length==0)return j.getInstance().info("请选择指标"),!1;C.value=!1;let t=q(),i={};t.forEach(o=>{i[o.indexId]=o.indexId}),s.forEach(o=>{i[o.id]||t.push({indexId:o.id,indexItem:o.checkItem,indexContent:o.description})}),E(t),le()},[se,{getSelectRows:ne,getPaginationRef:oe,clearSelectedRowKeys:le}]=L({api:()=>I(this,null,function*(){const s=oe();return g.value.pageNo=s.current,g.value.pageSize=s.pageSize,(yield K(g.value)).result}),columns:Oe,bordered:!0,useSearchForm:!0,formConfig:{labelWidth:120,showAdvancedButton:!1,schemas:U,baseColProps:{lg:4,md:4}},showTableSetting:!1,rowSelection:{type:"checkbox"},handleSearchInfoFn(s){g.value.description=s.description,g.value.checkItem=s.checkItem,g.value.checkType=s.checkType},maxHeight:343});return Te(()=>I(this,null,function*(){if(b.value=x.processInstanceId,!e.id&&x.processInstanceId){const s=yield he(x.processInstanceId);e.id=s.businessKey}Me({id:e.id}).then(s=>{let t=s.result;if(e.id){for(let T in t)e[T]=t[T];e.status=Number(e.status),_.value=e.checkType=="1",ee()}else e.billCode=t.billCode,e.personMemberName=t.personMemberName,e.deptName=t.deptName,e.fillinDate=t.fillinDate;let{billCode:i,fillinDate:o,personMemberName:f,deptName:R}=t;Object.assign(B,{billCode:i,fillinDate:o,personMemberName:f,deptName:R})})})),(s,t)=>{const i=p("a-input"),o=p("a-form-item"),f=p("a-col"),R=p("a-input-number"),T=p("a-date-picker"),ie=p("a-row"),F=p("a-card"),O=p("a-button"),re=p("a-form"),ce=p("a-spin");return we(),Se(r(de),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex",style:{position:"relative"}},{default:n(()=>[k("div",je,[a(ce,{spinning:e.spinning,tip:"Loading..."},{default:n(()=>[k("div",Ae,[k("div",Ue,[a(Ie,{options:B},null,8,["options"]),a(ke,{onAgree:M.handleAgree,onSave:M.handleSave,onSubmit:M.handleSubmit,processInstanceId:b.value,processStatus:e.status,listenMessage:"safe-check-template"},null,8,["onAgree","onSave","onSubmit","processInstanceId","processStatus"])]),k("div",Be,[a(re,{model:e,name:"basic",ref_key:"formRef",ref:u,autocomplete:"off",onFinish:P},{default:n(()=>[a(F,{title:"检查情况",bordered:!1},{default:n(()=>[a(ie,{gutter:32},{default:n(()=>[a(f,{span:24},{default:n(()=>[a(o,{label:"主题",name:"subject",labelCol:{style:{width:"124px"}},rules:[{required:!0,message:"主题"}]},{default:n(()=>[a(i,{value:e.subject,"onUpdate:value":t[0]||(t[0]=l=>e.subject=l),disabled:m.value,maxlength:"128"},null,8,["value","disabled"])]),_:1})]),_:1}),a(f,{span:12},{default:n(()=>[a(o,{label:"检查类型",name:"checkType",labelCol:{style:{width:"124px"}},rules:[{required:d.value,message:"请选检查类型"}]},{default:n(()=>[a(W,{type:"check_type",onChange:J,value:e.checkType,"onUpdate:value":t[1]||(t[1]=l=>e.checkType=l),style:{width:"100%"},disabled:m.value},null,8,["value","disabled"])]),_:1},8,["rules"])]),_:1}),a(f,{span:9},{default:n(()=>[a(o,{label:"检查频率",name:"checkPeriod",labelCol:{style:{width:"124px"}},rules:[{required:_.value,message:"检查频率"}]},{default:n(()=>[a(W,{type:"check_period",onChange:V,value:e.checkPeriod,"onUpdate:value":t[2]||(t[2]=l=>e.checkPeriod=l),style:{width:"100%"},disabled:m.value||e.checkType==r(z).SPECIAL},null,8,["value","disabled"])]),_:1},8,["rules"])]),_:1}),a(f,{span:3},{default:n(()=>[a(o,{label:"次数",name:"num",labelCol:{span:0},wrapperCol:3,rules:[{required:d.value,message:"次数"}]},{default:n(()=>[a(R,{value:e.num,"onUpdate:value":t[3]||(t[3]=l=>e.num=l),min:0,max:99,"addon-after":"次",disabled:m.value||e.checkType==r(z).SPECIAL},null,8,["value","disabled"])]),_:1},8,["rules"])]),_:1}),a(f,{span:12},{default:n(()=>[a(o,{label:"设置日期",name:"validDate",labelCol:{style:{width:"124px"}},rules:[{required:d.value,message:"设置日期"}]},{default:n(()=>[a(T,{value:e.validDate,"onUpdate:value":t[4]||(t[4]=l=>e.validDate=l),valueFormat:"YYYY-MM-DD",style:{width:"100%"},disabled:m.value},null,8,["value","disabled"])]),_:1},8,["rules"])]),_:1}),a(f,{span:12}),a(f,{span:24},{default:n(()=>[a(o,{label:"说明",name:"description",labelCol:{style:{width:"124px"}},rules:[{required:!1,message:"说明"}]},{default:n(()=>[a(i,{value:e.description,"onUpdate:value":t[5]||(t[5]=l=>e.description=l),disabled:m.value,maxlength:"300"},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),a(F,{bordered:!1},{default:n(()=>[a(r(Y),{title:"检查项目",onRegister:r(Z),searchInfo:r(U)},De({_:2},[e.status==0&&!m.value?{name:"toolbar",fn:n(()=>[a(O,{onClick:te,style:{"margin-right":"10px"},preIcon:r(N).ADD},{default:n(()=>[A("添加")]),_:1},8,["preIcon"]),a(O,{onClick:$,style:{"margin-right":"10px"},preIcon:r(N).DELETE},{default:n(()=>[A("删除")]),_:1},8,["preIcon"]),a(O,{onClick:G,preIcon:r(N).DOWNLOAD},{default:n(()=>[A("批量引入")]),_:1},8,["preIcon"])]),key:"0"}:void 0]),1032,["onRegister","searchInfo"])]),_:1})]),_:1},8,["model"]),k("div",null,[a(ve,{visible:C.value,"onUpdate:visible":t[6]||(t[6]=l=>C.value=l),title:"选择检查指标",maskClosable:!1,onOk:ae,width:1e3},{default:n(()=>[a(r(Y),{onRegister:r(se),class:"table-in-dialog",searchInfo:r(U)},null,8,["onRegister","searchInfo"])]),_:1},8,["visible"])])])])]),_:1},8,["spinning"])])]),_:1})}}});const gt=_e(Ee,[["__scopeId","data-v-b19f7954"]]);export{gt as default};
//# sourceMappingURL=createOrUpdate-cdc55844.js.map
