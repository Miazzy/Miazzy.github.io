{"version":3,"file":"index-771b992f.js","sources":["../../src/views/baseset/operation/powerstation/index.vue"],"sourcesContent":["<template>\n  <PageWrapper dense contentFullHeight fixedHeight contentClass=\"flex\" style=\"position: relative\">\n    <BasicTable\n      @register=\"registerTable\"\n      :searchInfo=\"searchInfo\"\n      @resize-column=\"(w, col) => (col.width = w)\"\n      @row-db-click=\"(record) => handleView(record)\"\n      @selection-change=\"handleSelectChange\"\n    >\n      <template #toolbar>\n        <a-button type=\"primary\" :preIcon=\"IconEnum.ADD\" @click=\"handleCreate()\">\n          {{ t('common.action.create') }}\n        </a-button>\n        <a-button\n          type=\"primary\"\n          :disabled=\"selectedRowId == ''\"\n          :preIcon=\"IconEnum.EDIT\"\n          @click=\"handleEdit\"\n          >{{ t('common.action.edit') }}</a-button\n        >\n        <a-button\n          class=\"red-btn\"\n          :disabled=\"selectedRowId == ''\"\n          :preIcon=\"IconEnum.DELETE\"\n          @click=\"handleDelete\"\n          >{{ t('common.delText') }}</a-button\n        >\n        <a-button type=\"primary\" @click=\"handleUpdateSortIndex\">{{ '保存排序号' }}</a-button>\n        <a-button class=\"yellow-btn\" :preIcon=\"IconEnum.EXPORT\" @click=\"handleExport\">\n          {{ t('common.action.export') }}\n        </a-button>\n      </template>\n      <template #bodyCell=\"{ column, record }\">\n        <template v-if=\"column.dataIndex === 'sequence'\">\n          <a-input-number\n            v-model:value=\"record[column.dataIndex]\"\n            class=\"input-center\"\n            :min=\"1\"\n            :max=\"999\"\n            :step=\"1\"\n            :precision=\"0\"\n            status=\"error\"\n          />\n        </template>\n\n        <template v-if=\"column.key === 'action'\">\n          <TableAction\n            :actions=\"[\n              {\n                label: '查看',\n                icon: 'clarity:bullet-list-line',\n                onClick: handleView.bind(null, record),\n              },\n            ]\"\n          />\n        </template>\n      </template>\n    </BasicTable>\n  </PageWrapper>\n</template>\n<script lang=\"ts\" setup>\n  import { reactive, onMounted, ref } from 'vue';\n  import { BasicTable, useTable, TableAction, SorterResult } from '/@/components/Table';\n  import { IconEnum } from '@/enums/appEnum';\n  import { useI18n } from '@/hooks/web/useI18n';\n  import { message } from 'ant-design-vue';\n  import { assign } from 'lodash-es';\n  import { useMessage } from '@/hooks/web/useMessage';\n  import { exportExcelFile } from '@/utils/file/download';\n  import {\n    formConfig,\n    columns,\n    getPowerStaionList,\n    deletePowerStation,\n    updateBatchSortData,\n    exportPowerStationData,\n  } from './data';\n  import { addTabPage } from '@/utils/route';\n  import { MsgManager } from '@/message/MsgManager';\n  import { PageWrapper } from '/@/components/Page';\n\n  const { createConfirm, createMessage } = useMessage();\n  const { t } = useI18n();\n  const searchInfo = reactive<any>({});\n\n  let selectedRowId = ref('');\n\n  //代码启动执行\n  onMounted(() => {\n    MsgManager.getInstance().listen('power_station', reload);\n  });\n\n  const [registerTable, { getSelectRows, reload, clearSelectedRowKeys, getDataSource }] = useTable({\n    title: '电站信息列表',\n    api: getPowerStaionList,\n    columns: columns,\n    bordered: true,\n    useSearchForm: true,\n    formConfig: formConfig,\n    tableSetting: {\n      redo: false,\n      size: false,\n      setting: true,\n      fullScreen: false,\n    },\n\n    fetchSetting: {\n      listField: 'list', // 请求返回结果list字段\n      pageField: 'pageNo', // page字段\n      sizeField: 'pageSize', // pageSize字段\n      totalField: 'total', // 请求返回结果total字段\n    },\n    handleSearchInfoFn(info) {\n      assign(searchInfo, info);\n      return info;\n    },\n    rowSelection: {\n      type: 'radio',\n      fixed: true,\n      onSelect: onSelect,\n    },\n    pagination: { pageSize: 20 },\n    showTableSetting: true,\n    showIndexColumn: true,\n\n    indexColumnProps: { fixed: 'left' },\n    sortFn: (sortInfo: SorterResult) => {\n      if (sortInfo.order) {\n        searchInfo.sortField = sortInfo.field;\n        searchInfo.sortOrder = sortInfo.order.replace('end', '');\n      } else {\n        searchInfo.sortField = '';\n        searchInfo.sortOrder = '';\n      }\n    },\n  });\n\n  // 保存排序\n  function handleUpdateSortIndex() {\n    const stationList = getDataSource();\n    const params = ref<Array<any>>([]);\n    stationList.forEach((item) => {\n      if (!item.sequence) {\n        message.error('排序不能为空');\n        throw Error('排序不能为空');\n      }\n      params.value.push({ id: item.id, sequence: item.sequence });\n    });\n    updateBatchSortData(params.value).then(() => {\n      message.success('保存排序成功');\n      reload();\n    });\n  }\n\n  //新增\n  function handleCreate() {\n    addTabPage(`/baseset/operation/powerstation/create`, '添加电站设置');\n  }\n\n  //修改\n  function handleEdit() {\n    const row = checkSelectData();\n    if (!row.id) {\n      return;\n    }\n    addTabPage(`/baseset/operation/powerstation/create?id=${row.id}`, '修改电站设置');\n  }\n\n  //查看\n  function handleView(record: any) {\n    if (!record.id) {\n      return;\n    }\n    addTabPage(`/baseset/operation/powerstation/create`, '查看电站设置', {\n      id: record.id,\n      type: 'view',\n      page_readonly: 'true',\n      ifShow: false,\n    });\n  }\n\n  //获取表格选择数据\n  function checkSelectData() {\n    const selectRows = getSelectRows();\n    if (selectRows.length == 0) {\n      message.error('请选择一行数据');\n      return false;\n    }\n    return selectRows[0] as any;\n  }\n\n  function handleSelectChange({ keys, rows }) {\n    if (rows && rows.length > 0) {\n      const record = rows[0];\n      selectedRowId.value = record.id;\n    } else {\n      selectedRowId.value = '';\n    }\n  }\n\n  function onSelect(record, selected) {\n    if (selected) {\n      selectedRowId.value = record.id;\n    } else {\n      selectedRowId.value = '';\n    }\n  }\n  //删除\n  async function handleDelete() {\n    const row = checkSelectData();\n    if (!row.id) {\n      return;\n    }\n    createConfirm({\n      title: '提示',\n      iconType: 'warning',\n      content: '确定要删除选中记录？',\n      async onOk() {\n        deletePowerStation(row.id).then(() => {\n          message.success('已删除');\n          clearSelectedRowKeys();\n          reload();\n        });\n      },\n    });\n  }\n\n  // 导出\n  function handleExport() {\n    createConfirm({\n      title: t('common.exportTitle'),\n      iconType: 'warning',\n      content: t('common.exportMessage'),\n      async onOk() {\n        await exportPowerStationData(searchInfo).then((res) => {\n          exportExcelFile(res?.data, '电站信息.xls');\n        });\n        createMessage.success(t('common.exportSuccessText'));\n      },\n    });\n  }\n</script>\n<style lang=\"less\" scoped>\n  .ant-input-number.input-center :deep(input) {\n    text-align: center;\n  }\n</style>\n"],"names":["createConfirm","createMessage","useMessage","t","useI18n","searchInfo","reactive","selectedRowId","ref","onMounted","MsgManager","reload","registerTable","getSelectRows","clearSelectedRowKeys","getDataSource","useTable","getPowerStaionList","columns","formConfig","info","assign","onSelect","sortInfo","handleUpdateSortIndex","stationList","params","item","message","updateBatchSortData","handleCreate","addTabPage","handleEdit","row","checkSelectData","handleView","record","selectRows","handleSelectChange","keys","rows","selected","handleDelete","__async","deletePowerStation","handleExport","exportPowerStationData","res","exportExcelFile"],"mappings":"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"}