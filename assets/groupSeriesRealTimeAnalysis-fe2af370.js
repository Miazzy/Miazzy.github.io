var u=(f,E,b)=>new Promise((T,n)=>{var S=v=>{try{s(b.next(v))}catch(d){n(d)}},I=v=>{try{s(b.throw(v))}catch(d){n(d)}},s=v=>v.done?T(v.value):Promise.resolve(v.value).then(S,I);s((b=b.apply(f,E)).next())});import{C as de}from"./CommonTree-c4ed7838.js";import{B as ue}from"./BasicTable-0434a334.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1ba7be9e.js";import"./index-085d06c7.js";import{u as pe}from"./useTable-109483b3.js";import{K as ve,aC as me}from"./antd-15ac76ed.js";import{au as he,ay as _e,av as ge,_ as ye}from"./index.js";import"./index-d8a2358f.js";import{o as fe,K as be,L as xe,c as we,h as Ce,M as Te}from"./monitorApi-44e70004.js";import{e as Se}from"./download-03e71dd5.js";import{d as Ie,r as W,k as l,e as De,I as ke,o as Le,al as k,Z as P,_ as M,f as p,aa as g,$ as o,ad as Ee,u as L,E as V,a5 as Ae,ac as Fe,aG as Ke,aH as Ne}from"./vue-71d1abb3.js";import{i as ze}from"./install-58e0bd81.js";import"./index-3801a970.js";import"./useForm-dea3ed18.js";import"./uniqBy-92d3bc7f.js";import"./index-316f6ffb.js";import"./useWindowSizeFn-13b1b8a2.js";import"./index-f4fc48e6.js";import"./useTabs-2b062e85.js";import"./index-5d49b7a7.js";import"./SearchBox-22bb02d6.js";import"./UploadBox-636ecf02.js";import"./Dialog-0a006d82.js";import"./DictSelectBox.vue_vue_type_script_setup_true_lang-e03e9fe8.js";import"./OrganDialog-dd1023ce.js";import"./sortable.esm-4ae27e0b.js";import"./dict-c04c0dd8.js";const C=f=>(Ke("data-v-83ab2577"),f=f(),Ne(),f),Be={class:"real-time-analysis"},Re={class:"right-box"},Oe={class:"right-row-box"},We={class:"box-header"},Pe={class:"header-left"},Me={class:"header-right"},Ve=C(()=>o("div",{class:"box-content"},[o("div",{class:"chart-box"},[o("div",{id:"customerChart",style:{width:"1300px",height:"320px"}})])],-1)),Ue={class:"right-row-box"},Ye={class:"data-table-box"},Ge=C(()=>o("div",{class:"table-title-line"},null,-1)),$e={class:"select-box"},He=C(()=>o("div",{class:"select-label-box"},"区域",-1)),Je={class:"select-box"},Ze=C(()=>o("div",{class:"select-label-box"},"设备类型",-1)),je={class:"select-box"},qe=C(()=>o("div",{class:"select-label-box"},"指标",-1)),Xe={style:{"margin-top":"-7px","padding-left":"8px"}},Qe=Ie({__name:"groupSeriesRealTimeAnalysis",setup(f){const{createConfirm:E}=he();W({barData:[],lineData:[],categories:[],units:[],colors:[["#078C5D","#68E4B8"],["#E59837","#FAE895"],["#078C5D","#68E4B8"]]}),l([]);const b={normal:"green",alarm:"red",interrupt:"grey",halt:"white"},T=l([]),n=l(""),S=De(()=>[n.value]),I=l([]),s=l(["all"]),v=l([]),d=l([]),z=l([]),U={StringFormation:{value:"StringFormation",label:"组串式逆变器"},CombinerDc:{value:"CombinerDc",label:"直流汇流箱"}},Y=e=>{d.value=e,x(),y()},B=()=>u(this,null,function*(){let e=yield we({stationId:n.value}),a=[],t=["StringFormation","CombinerDc"],r=[];e!=null&&e.forEach(c=>{t.includes(c.deviceType)&&(a.push(U[c.deviceType]),r.push(c.deviceType))}),z.value=a,d.value=r}),A=l([]),F=l(0),G=()=>u(this,null,function*(){let e=[{title:"区域",dataIndex:"areaName",width:100},{title:"设备名称",dataIndex:"deviceName",width:100},{title:"状态",dataIndex:"statusText",width:100}];if(F.value>0){let a=K.value.filter(t=>h.value.includes(t.value));for(let t=1;t<=F.value;t++){let r=[];a.forEach(m=>{let i={title:m.label,dataIndex:t+"_"+m.value,width:100};r.push(i)});let c={title:"组串"+t,width:a.length*100,children:r};e.push(c)}}A.value=e}),$=l([]);l(!1);const H=()=>u(this,null,function*(){var r;if(n.value==""||s.value.length===0||d.value.length===0)return;const e=Z();let a={stationId:n.value,areaIds:s.value,deviceTypeList:d.value,pageNo:e.current,pageSize:e.pageSize,needSerialsTmp:1,indexList:h.value},t=yield Te(a);return F.value=t.columnSize,yield G(),((r=t.data.list)==null?void 0:r.length)>0&&t.data.list.forEach(c=>{if(c.serialsTmp!=null){let m=c.serialsTmp,i=K.value.filter(w=>h.value.includes(w.value));for(let w in m)i.forEach(O=>{c[w+"_"+O.value]=m[w][O.value]})}}),$.value=t.data.list,t.data}),[J,{reload:x,getPaginationRef:Z}]=pe({api:H,columns:A,bordered:!0,pagination:{pageSize:200,pageSizeOptions:["20","50","100","200"]}}),R=()=>u(this,null,function*(){let e=yield Ce({stationId:n.value});if(e!=null&&e.length){s.value=["all"];let a=[{label:"全部区域",value:"all"}];e.forEach(t=>{a.push({value:t.id,label:t.name})}),v.value=a}}),j=e=>{console.log(`selected ${e}`),e.length>1&&e.includes("all")?e[e.length-1]==="all"?s.value=["all"]:s.value=e.slice(1):s.value=e,x(),y()};function q(){return u(this,null,function*(){let e=yield fe();T.value=e,setTimeout(()=>u(this,null,function*(){I.value=[e[0].id,e[0].children[0].id],S.value=[e[0].children[0].id],n.value=e[0].children[0].id,yield R(),yield B(),x(),y()}),500)})}function X(){return u(this,arguments,function*(e={}){n.value=null,(e==null?void 0:e.id)!=null&&(e==null?void 0:e.nodeKindId)=="station"&&(n.value=e.powerStationId,yield R(),yield B(),x(),y())})}const h=l(["p_avg","p_max"]),K=l([{value:"pv_total",label:"PV容量"},{value:"p_avg",label:"平均功率"},{value:"p_avg_kw",label:"平均功率/kW"},{value:"p_max",label:"峰值功率"},{value:"p_max_kw",label:"峰值功率/kW"},{value:"p_out_put_power",label:"日发电量"},{value:"p_out_put_power_kw",label:"日发电量/kW"}]),Q=e=>{console.log(`selected ${e}`),h.value=e,x(),y()};function ee(){s.value=[],d.value=[],h.value=[],x(),y()}const ae=()=>u(this,null,function*(){E({title:"提示",iconType:"warning",content:"确定要导出所有记录？",onOk(){return u(this,null,function*(){let a={stationId:n.value,areaIds:s.value,deviceTypeList:d.value,needSerialsTmp:1,indexList:h.value};a.fileName="组串实时数据",a.excelList=A.value,yield be(a).then(t=>{Se(t==null?void 0:t.data,a.fileName)})})}})}),te=l(),N=W({stationId:"",areaId:"",esn:""}),le=e=>{N.stationId=n.value,N.areaId=e.areaId,N.esn=e.esn},_=l({label:"PV容量",value:"pv_total",dataKind:"line"}),oe=l([{label:"pv容量",value:"pv_total",dataKind:"line"},{label:"平均功率",value:"p_avg",dataKind:"line"},{label:"平均给功率/kW",value:"p_avg_kw",dataKind:"line"},{label:"峰值功率",value:"p_max",dataKind:"line"},{label:"峰值功率/kW",value:"p_max_kw",dataKind:"line"},{label:"日发电量",value:"pv_output_power_day",dataKind:"line"},{label:"日发电量/kW",value:"pv_output_power_day_kw",dataKind:"line"}]);function se(e,a){return u(this,null,function*(){_.value=a,y()})}const y=()=>u(this,null,function*(){let e=[];if(n.value==""||s.value.length===0||d.value.length===0)e=[];else{let a={stationId:n.value,showData:_.value.value,deviceTypeList:d.value,areaIds:s.value,indexList:[_.value.value]};e=yield xe(a)}re(e)}),ie=l(!1),ne={color:["#1729F6","#FCAB28","#09D963","#FF1EE9","#B32630","#009588","#C9930F","#FF5906","#f3a33f","#fe8466","#8A69FF","#FF7669"],tooltip:{show:!0,trigger:"axis",formatter:"台",axisPointer:{type:"line",lineStyle:{type:"dashed",color:"rgba(1,180,241,.5)"},crossStyle:{type:"dashed",color:"rgba(1,180,241,.5)"}},backgroundColor:" #f5fbfb",borderColor:"#c6ecea",borderWidth:1},dataZoom:[{type:"inside"}],legend:{top:20,right:200,padding:[10,0],itemGap:14,itemWidth:14,itemHeight:10,textStyle:{color:"#bce2e3"}},grid:{top:50,bottom:30,left:40,right:10},xAxis:{type:"category",boundaryGap:!0,axisTick:{alignWithLabel:!0,show:!1},axisLine:{lineStyle:{color:"#ccc"}},axisLabel:{color:"#888"}},yAxis:{type:"value",nameTextStyle:{color:"#888"},axisLine:{show:!0,lineStyle:{color:"#ccc"}},axisLabel:{color:"#888",formatter:"{value}"},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgba(0, 0, 0, .1)",type:"dashed"}}}},D=ke({});function re(e,a){let t=JSON.parse(JSON.stringify(ne)),r=[],c=[];t.xAxis.data=e.xList,r.push(_.value.label);let m=_.value.label;c.push({name:a,data:e.yList,type:"line",showSymbol:!0,symbol:"circle",symbolSize:10,smooth:0,lineStyle:{width:2,color:"rgba(64,202,192,1)"},itemStyle:{normal:{shadowColor:"rgba(0,0,0,0.1)",shadowBlur:6,borderWidth:3,borderColor:"#fff",color:"#40cac0"}}}),t.series=c,t.legend.data=r,t.tooltip.formatter=i=>'<p style="text-align: left;color:#666;opacity: .8; line-height: 20px;font-size:12px;">'+i[0].axisValue+'</p> <p style="font-size:12px;color:#666;">'+m+':  <span style="color: #3ccacc;font-size:13px;font-weight:bold;">'+i[0].data+"</span></p>",setTimeout(()=>{ie.value=!0,ce(t)})}function ce(e,a){const t=document.getElementById("customerChart");D.value=ze(t),D.value.setOption(e,!0),a&&a(D),window.addEventListener("resize",()=>{D.value.resize()})}return Le(()=>{q();let e=new Date;te.value=ve(_e(e),"YYYY-MM-DD")}),(e,a)=>{const t=k("a-col"),r=k("a-select"),c=k("a-button"),m=k("a-row");return P(),M("div",Be,[p(m,{class:"real-time-analysis-row",type:"flex",wrap:!1},{default:g(()=>[p(t,{flex:"298px"},{default:g(()=>[p(de,{toolbar:!0,canEdit:!1,canAdd:!1,canDelete:!1,isShowOperationBtns:!1,class:"fit-common-tree",title:"电站组织",value:T.value,fieldNames:{key:"id",title:"name"},onSelect:X,selectedKeys:S.value,expandedKeys:I.value},null,8,["value","selectedKeys","expandedKeys"])]),_:1}),p(t,{flex:"auto"},{default:g(()=>[o("div",Re,[o("div",Oe,[o("div",We,[o("div",Pe,Ee(_.value.label),1),o("div",Me,[p(r,{value:_.value,"onUpdate:value":a[0]||(a[0]=i=>_.value=i),"allow-clear":"",style:{"min-width":"206px"},placeholder:"选择指标项",options:oe.value,showArrow:"",onChange:se},null,8,["value","options"])])]),Ve]),o("div",Ue,[o("div",Ye,[Ge,p(L(ue),{onRegister:L(J),onRowDbClick:le},{tableTitle:g(()=>[o("div",$e,[He,p(r,{value:s.value,"onUpdate:value":a[1]||(a[1]=i=>s.value=i),"allow-clear":"",style:{"min-width":"256px"},mode:"multiple",placeholder:"选择区域",options:v.value,"max-tag-count":1,showArrow:"",maxTagTextLength:6,onChange:j},null,8,["value","options"])]),o("div",Je,[Ze,p(L(me),{value:d.value,"onUpdate:value":a[2]||(a[2]=i=>d.value=i),mode:"multiple",style:{"min-width":"256px"},placeholder:"选择类型",options:z.value,showArrow:"",onChange:Y},null,8,["value","options"])]),o("div",je,[qe,p(r,{value:h.value,"onUpdate:value":a[3]||(a[3]=i=>h.value=i),mode:"multiple",style:{"min-width":"256px"},placeholder:"选择指标",options:K.value,"max-tag-count":1,showArrow:"",maxTagTextLength:6,onChange:Q},null,8,["value","options"])])]),toolbar:g(()=>[o("div",Xe,[p(c,{onClick:ee},{default:g(()=>[V(" 重置 ")]),_:1}),p(c,{class:"yellow-btn",style:{"margin-left":"8px"},onClick:ae,preIcon:L(ge).EXPORT},{default:g(()=>[V(" 导出 ")]),_:1},8,["preIcon"])])]),bodyCell:g(({column:i,record:w})=>[i.key==="statusText"?(P(),M("span",{key:0,class:Ae(["status-icon",b[w.status]])},null,2)):Fe("",!0)]),_:1},8,["onRegister"])])])])]),_:1})]),_:1})])}}});const ka=ye(Qe,[["__scopeId","data-v-83ab2577"]]);export{ka as default};
//# sourceMappingURL=groupSeriesRealTimeAnalysis-fe2af370.js.map
